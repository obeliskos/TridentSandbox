!function(global){!function(e){"function"==typeof define&&define.amd?define([],e):(global.msWriteProfilerMark&&msWriteProfilerMark("WinJS.3.1 3.1.0.winjs.2014.10.5 WinJS.js,StartTM"),e(global.WinJS),global.msWriteProfilerMark&&msWriteProfilerMark("WinJS.3.1 3.1.0.winjs.2014.10.5 WinJS.js,StopTM"))}(function(WinJS){var require,define;!function(){"use strict";function e(e,t){var i=e.split("/");return i.pop(),t.map(function(e){if("."===e[0]){var t=e.split("/"),n=i.slice(0);return t.forEach(function(e){".."===e?n.pop():"."!==e&&n.push(e)}),n.join("/")}return e})}function t(e,t){return e.map(function(e){if("exports"===e)return t;if("require"===e)return require;var r=n[e];if(!r)throw new Error("Undefined dependency: "+e);return r.resolved||(r.resolved=i(r.dependencies,r.factory,r.exports),r.exports&&(r.resolved=r.exports)),r.resolved})}function i(e,i,n){var r=t(e,n);return i&&i.apply?i.apply(null,r):i}var n={};define=function(t,i,r){Array.isArray(i)||(r=i,i=[]);var s={dependencies:e(t,i),factory:r};-1!==i.indexOf("exports")&&(s.exports={}),n[t]=s},require=function(e,t){Array.isArray(e)||(e=[e]),i(e,t)}}(),define("amd",function(){}),define("WinJS/Core/_WinJS",{}),function(e){"use strict";define("WinJS/Core/_Global",e)}(this),define("WinJS/Core/_BaseCoreUtils",["./_Global"],function(e){"use strict";function t(e){return e.supportedForProcessing=!0,e}var i=!!e.Windows;return{hasWinRT:i,markSupportedForProcessing:t,_setImmediate:e.setImmediate?e.setImmediate.bind(e):function(t){e.setTimeout(t,0)}}}),define("WinJS/Core/_WriteProfilerMark",["./_Global"],function(e){"use strict";return e.msWriteProfilerMark||function(){}}),define("WinJS/Core/_Base",["./_WinJS","./_Global","./_BaseCoreUtils","./_WriteProfilerMark"],function(e,t,i,n){"use strict";function r(e,t,i){var n,r,s,o=Object.keys(t),a=Array.isArray(e);for(r=0,s=o.length;s>r;r++){var l=o[r],c=95!==l.charCodeAt(0),u=t[l];!u||"object"!=typeof u||void 0===u.value&&"function"!=typeof u.get&&"function"!=typeof u.set?c?a?e.forEach(function(e){e[l]=u}):e[l]=u:(n=n||{},n[l]={value:u,enumerable:c,configurable:!0,writable:!0}):(void 0===u.enumerable&&(u.enumerable=c),i&&u.setName&&"function"==typeof u.setName&&u.setName(i+"."+l),n=n||{},n[l]=u)}n&&(a?e.forEach(function(e){Object.defineProperties(e,n)}):Object.defineProperties(e,n))}return function(){function i(i,n){var r=i||{};if(n){var s=n.split(".");r===t&&"WinJS"===s[0]&&(r=e,s.splice(0,1));for(var o=0,a=s.length;a>o;o++){var l=s[o];r[l]||Object.defineProperty(r,l,{value:{},writable:!1,enumerable:!0,configurable:!0}),r=r[l]}}return r}function s(e,t,n){var s=i(e,t);return n&&r(s,n,t||"<ANONYMOUS>"),s}function o(e,i){return s(t,e,i)}function a(e){var t,i,r=u.uninitialized;return{setName:function(e){t=e},get:function(){switch(r){case u.initialized:return i;case u.uninitialized:r=u.working;try{n("WinJS.Namespace._lazy:"+t+",StartTM"),i=e()}finally{n("WinJS.Namespace._lazy:"+t+",StopTM"),r=u.uninitialized}return e=null,r=u.initialized,i;case u.working:throw"Illegal: reentrancy on initialization";default:throw"Illegal"}},set:function(e){switch(r){case u.working:throw"Illegal: reentrancy on initialization";default:r=u.initialized,i=e}},enumerable:!0,configurable:!0}}function l(e,n,s){var o=[e],a=null;return n&&(a=i(t,n),o.push(a)),r(o,s,n||"<ANONYMOUS>"),a}var c=e;c.Namespace||(c.Namespace=Object.create(Object.prototype));var u={uninitialized:1,working:2,initialized:3};Object.defineProperties(c.Namespace,{defineWithParent:{value:s,writable:!0,enumerable:!0,configurable:!0},define:{value:o,writable:!0,enumerable:!0,configurable:!0},_lazy:{value:a,writable:!0,enumerable:!0,configurable:!0},_moduleDefine:{value:l,writable:!0,enumerable:!0,configurable:!0}})}(),function(){function t(e,t,n){return e=e||function(){},i.markSupportedForProcessing(e),t&&r(e.prototype,t),n&&r(e,n),e}function n(e,n,s,o){if(e){n=n||function(){};var a=e.prototype;return n.prototype=Object.create(a),i.markSupportedForProcessing(n),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,configurable:!0,enumerable:!0}),s&&r(n.prototype,s),o&&r(n,o),n}return t(n,s,o)}function s(e){e=e||function(){};var t,i;for(t=1,i=arguments.length;i>t;t++)r(e.prototype,arguments[t]);return e}e.Namespace.define("WinJS.Class",{define:t,derive:n,mix:s})}(),{Namespace:e.Namespace,Class:e.Class}}),define("WinJS/Core/_ErrorFromName",["./_Base"],function(e){"use strict";var t=e.Class.derive(Error,function(e,t){this.name=e,this.message=t||e},{},{supportedForProcessing:!1});return e.Namespace.define("WinJS",{ErrorFromName:t}),t}),define("WinJS/Core/_WinRT",["exports","./_Global","./_Base"],function(e,t,i){"use strict";e.msGetWeakWinRTProperty=t.msGetWeakWinRTProperty,e.msSetWeakWinRTProperty=t.msSetWeakWinRTProperty;var n=["Windows.ApplicationModel.DesignMode.designModeEnabled","Windows.ApplicationModel.Resources.Core.ResourceContext","Windows.ApplicationModel.Resources.Core.ResourceManager","Windows.ApplicationModel.Search.Core.SearchSuggestionManager","Windows.ApplicationModel.Search.SearchQueryLinguisticDetails","Windows.Data.Text.SemanticTextQuery","Windows.Foundation.Collections.CollectionChange","Windows.Foundation.Uri","Windows.Globalization.ApplicationLanguages","Windows.Globalization.Calendar","Windows.Globalization.DateTimeFormatting","Windows.Globalization.Language","Windows.Phone.UI.Input.HardwareButtons","Windows.Storage.ApplicationData","Windows.Storage.CreationCollisionOption","Windows.Storage.BulkAccess.FileInformationFactory","Windows.Storage.FileIO","Windows.Storage.FileProperties.ThumbnailType","Windows.Storage.FileProperties.ThumbnailMode","Windows.Storage.FileProperties.ThumbnailOptions","Windows.Storage.KnownFolders","Windows.Storage.Search.FolderDepth","Windows.Storage.Search.IndexerOption","Windows.Storage.Streams.RandomAccessStreamReference","Windows.UI.ApplicationSettings.SettingsEdgeLocation","Windows.UI.ApplicationSettings.SettingsCommand","Windows.UI.ApplicationSettings.SettingsPane","Windows.UI.Core.AnimationMetrics","Windows.UI.Input.EdgeGesture","Windows.UI.Input.EdgeGestureKind","Windows.UI.Input.PointerPoint","Windows.UI.ViewManagement.HandPreference","Windows.UI.ViewManagement.InputPane","Windows.UI.ViewManagement.UISettings","Windows.UI.WebUI.Core.WebUICommandBar","Windows.UI.WebUI.Core.WebUICommandBarBitmapIcon","Windows.UI.WebUI.Core.WebUICommandBarClosedDisplayMode","Windows.UI.WebUI.Core.WebUICommandBarIconButton","Windows.UI.WebUI.Core.WebUICommandBarSymbolIcon","Windows.UI.WebUI.WebUIApplication"];n.forEach(function(n){var r=n.split("."),s={};s[r[r.length-1]]={get:function(){return r.reduce(function(e,t){return e?e[t]:null},t)}},i.Namespace.defineWithParent(e,r.slice(0,-1).join("."),s)})}),define("WinJS/Core/_Events",["exports","./_Base"],function(e,t){"use strict";function i(e){var t="_on"+e+"state";return{get:function(){var e=this[t];return e&&e.userHandler},set:function(i){var n=this[t];i?(n||(n={wrapper:function(e){return n.userHandler(e)},userHandler:i},Object.defineProperty(this,t,{value:n,enumerable:!1,writable:!0,configurable:!0}),this.addEventListener(e,n.wrapper,!1)),n.userHandler=i):n&&(this.removeEventListener(e,n.wrapper,!1),this[t]=null)},enumerable:!0}}function n(){for(var e={},t=0,n=arguments.length;n>t;t++){var r=arguments[t];e["on"+r]=i(r)}return e}var r=t.Class.define(function(e,t,i){this.detail=t,this.target=i,this.timeStamp=Date.now(),this.type=e},{bubbles:{value:!1,writable:!1},cancelable:{value:!1,writable:!1},currentTarget:{get:function(){return this.target}},defaultPrevented:{get:function(){return this._preventDefaultCalled}},trusted:{value:!1,writable:!1},eventPhase:{value:0,writable:!1},target:null,timeStamp:null,type:null,preventDefault:function(){this._preventDefaultCalled=!0},stopImmediatePropagation:function(){this._stopImmediatePropagationCalled=!0},stopPropagation:function(){}},{supportedForProcessing:!1}),s={_listeners:null,addEventListener:function(e,t,i){i=i||!1,this._listeners=this._listeners||{};for(var n=this._listeners[e]=this._listeners[e]||[],r=0,s=n.length;s>r;r++){var o=n[r];if(o.useCapture===i&&o.listener===t)return}n.push({listener:t,useCapture:i})},dispatchEvent:function(e,t){var i=this._listeners&&this._listeners[e];if(i){var n=new r(e,t,this);i=i.slice(0,i.length);for(var s=0,o=i.length;o>s&&!n._stopImmediatePropagationCalled;s++)i[s].listener(n);return n.defaultPrevented||!1}return!1},removeEventListener:function(e,t,i){i=i||!1;var n=this._listeners&&this._listeners[e];if(n)for(var r=0,s=n.length;s>r;r++){var o=n[r];if(o.listener===t&&o.useCapture===i){n.splice(r,1),0===n.length&&delete this._listeners[e];break}}}};t.Namespace._moduleDefine(e,"WinJS.Utilities",{_createEventProperty:i,createEventProperties:n,eventMixin:s})}),define("require-json",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("require-json!en-US/ui.resjson",{appBarAriaLabel:"App Bar",appBarCommandAriaLabel:"App Bar Item",autoSuggestBoxAriaLabel:"Autosuggestbox",autoSuggestBoxAriaLabelInputNoPlaceHolder:"Autosuggestbox, enter to submit query, esc to clear text",autoSuggestBoxAriaLabelInputPlaceHolder:"Autosuggestbox, {0}, enter to submit query, esc to clear text",autoSuggestBoxAriaLabelQuery:"Suggestion: {0}","_autoSuggestBoxAriaLabelQuery.comment":"Suggestion: query text (example: Suggestion: contoso)",autoSuggestBoxAriaLabelSeparator:"Separator: {0}","_autoSuggestBoxAriaLabelSeparator.comment":"Separator: separator text (example: Separator: People or Separator: Apps)",autoSuggestBoxAriaLabelResult:"Result: {0}, {1}","_autoSuggestBoxAriaLabelResult.comment":"Result: text, detailed text (example: Result: contoso, www.contoso.com)",averageRating:"Average Rating",backbuttonarialabel:"Back",clearYourRating:"Clear your rating",closeOverlay:"Close",datePicker:"Date Picker",flipViewPanningContainerAriaLabel:"Scrolling Container",flyoutAriaLabel:"Flyout",hubViewportAriaLabel:"Scrolling Container",listViewViewportAriaLabel:"Scrolling Container",menuCommandAriaLabel:"Menu Item",menuAriaLabel:"Menu",navBarContainerViewportAriaLabel:"Scrolling Container",off:"Off",on:"On",pivotAriaLabel:"Pivot",pivotViewportAriaLabel:"Scrolling Container",searchBoxAriaLabel:"Searchbox",searchBoxAriaLabelInputNoPlaceHolder:"Searchbox, enter to submit query, esc to clear text",searchBoxAriaLabelInputPlaceHolder:"Searchbox, {0}, enter to submit query, esc to clear text",searchBoxAriaLabelButton:"Click to submit query",selectAMPM:"Select A.M P.M",selectDay:"Select Day",selectHour:"Select Hour",selectMinute:"Select Minute",selectMonth:"Select Month",selectYear:"Select Year",settingsFlyoutAriaLabel:"Settings Flyout",tentativeRating:"Tentative Rating",timePicker:"Time Picker",toolbarAriaLabel:"Toolbar",toolbarOverflowButtonAriaLabel:"View more",unrated:"Unrated",userRating:"User Rating","appBarIcons\\previous":"","_appBarIcons\\previous.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\next":"","_appBarIcons\\next.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\play":"","_appBarIcons\\play.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pause":"","_appBarIcons\\pause.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\edit":"","_appBarIcons\\edit.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\save":"","_appBarIcons\\save.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clear":"","_appBarIcons\\clear.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\delete":"","_appBarIcons\\delete.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\remove":"","_appBarIcons\\remove.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\add":"","_appBarIcons\\add.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cancel":"","_appBarIcons\\cancel.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\accept":"","_appBarIcons\\accept.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\more":"","_appBarIcons\\more.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\redo":"","_appBarIcons\\redo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\undo":"","_appBarIcons\\undo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\home":"","_appBarIcons\\home.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\up":"","_appBarIcons\\up.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\forward":"","_appBarIcons\\forward.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\right":"","_appBarIcons\\right.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\back":"","_appBarIcons\\back.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\left":"","_appBarIcons\\left.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\favorite":"","_appBarIcons\\favorite.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\camera":"","_appBarIcons\\camera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\settings":"","_appBarIcons\\settings.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\video":"","_appBarIcons\\video.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\sync":"","_appBarIcons\\sync.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\download":"","_appBarIcons\\download.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mail":"","_appBarIcons\\mail.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\find":"","_appBarIcons\\find.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\help":"","_appBarIcons\\help.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\upload":"","_appBarIcons\\upload.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\emoji":"","_appBarIcons\\emoji.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\twopage":"","_appBarIcons\\twopage.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\leavechat":"","_appBarIcons\\leavechat.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailforward":"","_appBarIcons\\mailforward.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clock":"","_appBarIcons\\clock.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\send":"","_appBarIcons\\send.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\crop":"","_appBarIcons\\crop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rotatecamera":"","_appBarIcons\\rotatecamera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\people":"","_appBarIcons\\people.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\closepane":"","_appBarIcons\\closepane.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openpane":"","_appBarIcons\\openpane.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\world":"","_appBarIcons\\world.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\flag":"","_appBarIcons\\flag.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\previewlink":"","_appBarIcons\\previewlink.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\globe":"","_appBarIcons\\globe.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\trim":"","_appBarIcons\\trim.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\attachcamera":"","_appBarIcons\\attachcamera.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoomin":"","_appBarIcons\\zoomin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bookmarks":"","_appBarIcons\\bookmarks.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\document":"","_appBarIcons\\document.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\protecteddocument":"","_appBarIcons\\protecteddocument.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\page":"","_appBarIcons\\page.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bullets":"","_appBarIcons\\bullets.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\comment":"","_appBarIcons\\comment.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mail2":"","_appBarIcons\\mail2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contactinfo":"","_appBarIcons\\contactinfo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\hangup":"","_appBarIcons\\hangup.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\viewall":"","_appBarIcons\\viewall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mappin":"","_appBarIcons\\mappin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\phone":"","_appBarIcons\\phone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\videochat":"","_appBarIcons\\videochat.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\switch":"","_appBarIcons\\switch.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contact":"","_appBarIcons\\contact.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rename":"","_appBarIcons\\rename.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pin":"","_appBarIcons\\pin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\musicinfo":"","_appBarIcons\\musicinfo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\go":"","_appBarIcons\\go.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\keyboard":"","_appBarIcons\\keyboard.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockleft":"","_appBarIcons\\dockleft.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockright":"","_appBarIcons\\dockright.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dockbottom":"","_appBarIcons\\dockbottom.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\remote":"","_appBarIcons\\remote.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\refresh":"","_appBarIcons\\refresh.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\rotate":"","_appBarIcons\\rotate.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\shuffle":"","_appBarIcons\\shuffle.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\list":"","_appBarIcons\\list.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\shop":"","_appBarIcons\\shop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\selectall":"","_appBarIcons\\selectall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\orientation":"","_appBarIcons\\orientation.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\import":"","_appBarIcons\\import.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\importall":"","_appBarIcons\\importall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\browsephotos":"","_appBarIcons\\browsephotos.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\webcam":"","_appBarIcons\\webcam.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\pictures":"","_appBarIcons\\pictures.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\savelocal":"","_appBarIcons\\savelocal.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\caption":"","_appBarIcons\\caption.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\stop":"","_appBarIcons\\stop.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\showresults":"","_appBarIcons\\showresults.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\volume":"","_appBarIcons\\volume.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repair":"","_appBarIcons\\repair.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\message":"","_appBarIcons\\message.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\page2":"","_appBarIcons\\page2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarday":"","_appBarIcons\\calendarday.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarweek":"","_appBarIcons\\calendarweek.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendar":"","_appBarIcons\\calendar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\characters":"","_appBarIcons\\characters.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailreplyall":"","_appBarIcons\\mailreplyall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\read":"","_appBarIcons\\read.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\link":"","_appBarIcons\\link.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\accounts":"","_appBarIcons\\accounts.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\showbcc":"","_appBarIcons\\showbcc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\hidebcc":"","_appBarIcons\\hidebcc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cut":"","_appBarIcons\\cut.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\attach":"","_appBarIcons\\attach.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\paste":"","_appBarIcons\\paste.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\filter":"","_appBarIcons\\filter.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\copy":"","_appBarIcons\\copy.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\emoji2":"","_appBarIcons\\emoji2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\important":"","_appBarIcons\\important.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mailreply":"","_appBarIcons\\mailreply.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\slideshow":"","_appBarIcons\\slideshow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\sort":"","_appBarIcons\\sort.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\manage":"","_appBarIcons\\manage.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\allapps":"","_appBarIcons\\allapps.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\disconnectdrive":"","_appBarIcons\\disconnectdrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mapdrive":"","_appBarIcons\\mapdrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\newwindow":"","_appBarIcons\\newwindow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openwith":"","_appBarIcons\\openwith.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contactpresence":"","_appBarIcons\\contactpresence.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\priority":"","_appBarIcons\\priority.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\uploadskydrive":"","_appBarIcons\\uploadskydrive.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\gototoday":"","_appBarIcons\\gototoday.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\font":"","_appBarIcons\\font.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontcolor":"","_appBarIcons\\fontcolor.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\contact2":"","_appBarIcons\\contact2.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\folder":"","_appBarIcons\\folder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\audio":"","_appBarIcons\\audio.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\placeholder":"","_appBarIcons\\placeholder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\view":"","_appBarIcons\\view.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\setlockscreen":"","_appBarIcons\\setlockscreen.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\settile":"","_appBarIcons\\settile.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cc":"","_appBarIcons\\cc.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\stopslideshow":"","_appBarIcons\\stopslideshow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\permissions":"","_appBarIcons\\permissions.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\highlight":"","_appBarIcons\\highlight.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\disableupdates":"","_appBarIcons\\disableupdates.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unfavorite":"","_appBarIcons\\unfavorite.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unpin":"","_appBarIcons\\unpin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openlocal":"","_appBarIcons\\openlocal.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\mute":"","_appBarIcons\\mute.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\italic":"","_appBarIcons\\italic.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\underline":"","_appBarIcons\\underline.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\bold":"","_appBarIcons\\bold.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\movetofolder":"","_appBarIcons\\movetofolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\likedislike":"","_appBarIcons\\likedislike.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\dislike":"","_appBarIcons\\dislike.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\like":"","_appBarIcons\\like.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\alignright":"","_appBarIcons\\alignright.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\aligncenter":"","_appBarIcons\\aligncenter.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\alignleft":"","_appBarIcons\\alignleft.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoom":"","_appBarIcons\\zoom.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zoomout":"","_appBarIcons\\zoomout.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\openfile":"","_appBarIcons\\openfile.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\otheruser":"","_appBarIcons\\otheruser.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\admin":"","_appBarIcons\\admin.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\street":"","_appBarIcons\\street.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\map":"","_appBarIcons\\map.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\clearselection":"","_appBarIcons\\clearselection.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontdecrease":"","_appBarIcons\\fontdecrease.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontincrease":"","_appBarIcons\\fontincrease.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fontsize":"","_appBarIcons\\fontsize.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\cellphone":"","_appBarIcons\\cellphone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\reshare":"","_appBarIcons\\reshare.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\tag":"","_appBarIcons\\tag.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repeatone":"","_appBarIcons\\repeatone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\repeatall":"","_appBarIcons\\repeatall.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\outlinestar":"","_appBarIcons\\outlinestar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\solidstar":"","_appBarIcons\\solidstar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calculator":"","_appBarIcons\\calculator.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\directions":"","_appBarIcons\\directions.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\target":"","_appBarIcons\\target.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\library":"","_appBarIcons\\library.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\phonebook":"","_appBarIcons\\phonebook.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\memo":"","_appBarIcons\\memo.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\microphone":"","_appBarIcons\\microphone.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\postupdate":"","_appBarIcons\\postupdate.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\backtowindow":"","_appBarIcons\\backtowindow.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fullscreen":"","_appBarIcons\\fullscreen.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\newfolder":"","_appBarIcons\\newfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\calendarreply":"","_appBarIcons\\calendarreply.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\unsyncfolder":"","_appBarIcons\\unsyncfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\reporthacked":"","_appBarIcons\\reporthacked.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\syncfolder":"","_appBarIcons\\syncfolder.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\blockcontact":"","_appBarIcons\\blockcontact.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\switchapps":"","_appBarIcons\\switchapps.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\addfriend":"","_appBarIcons\\addfriend.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\touchpointer":"","_appBarIcons\\touchpointer.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\gotostart":"","_appBarIcons\\gotostart.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\zerobars":"","_appBarIcons\\zerobars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\onebar":"","_appBarIcons\\onebar.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\twobars":"","_appBarIcons\\twobars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\threebars":"","_appBarIcons\\threebars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\fourbars":"","_appBarIcons\\fourbars.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\scan":"","_appBarIcons\\scan.comment":"{Locked:qps-ploc,qps-plocm}","appBarIcons\\preview":"","_appBarIcons\\preview.comment":"{Locked:qps-ploc,qps-plocm}"}),define("WinJS/Core/_Resources",["exports","./_Global","./_WinRT","./_Base","./_Events","require-json!en-US/ui.resjson"],function(e,t,i,n,r,s){"use strict";function o(e){var t=b("ms-resource://"+c+"/"+e);return t.empty&&(t=a(e)),t}function a(e){var t=e.split("/");t.shift();var i=s[t.join("\\")];return"string"==typeof i&&(i={value:i}),i||{value:e,empty:!0}}function l(e){var t=arguments;return t.length>1&&(e=e.replace(/({{)|(}})|{(\d+)}|({)|(})/g,function(e,i,n,r,s,o){if(s||o)throw l(v.malformedFormatStringInput,s||o);return i&&"{"||n&&"}"||t[(0|r)+1]})),e}var c="WinJS.3.1",u="Developer.";0===c.indexOf(u)&&(c=c.substring(u.length));var d,h,_=!1,m="contextchanged",p=n.Class.mix(n.Class.define(null,{},{supportedForProcessing:!1}),r.eventMixin),f=new p,g=r._createEventProperty,v={get malformedFormatStringInput(){return"Malformed, did you mean to escape your '{0}'?"}};n.Namespace.define("WinJS.Resources",{_getWinJSString:o}),n.Namespace._moduleDefine(e,"WinJS.Resources",{addEventListener:function(t,n,r){if(i.Windows.ApplicationModel.Resources.Core.ResourceManager&&!_&&t===m)try{var s=e._getResourceContext();s?s.qualifierValues.addEventListener("mapchanged",function(t){e.dispatchEvent(m,{qualifier:t.key,changed:t.target[t.key]})},!1):i.Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.qualifierValues.addEventListener("mapchanged",function(t){e.dispatchEvent(m,{qualifier:t.key,changed:t.target[t.key]})},!1),_=!0}catch(o){}f.addEventListener(t,n,r)},removeEventListener:f.removeEventListener.bind(f),dispatchEvent:f.dispatchEvent.bind(f),_formatString:l,_getStringWinRT:function(t){if(!d){var n=i.Windows.ApplicationModel.Resources.Core.ResourceManager.current.mainResourceMap;try{d=n.getSubtree("Resources")}catch(r){}d||(d=n)}var s,o,a;try{var l=e._getResourceContext();a=l?d.getValue(t,l):d.getValue(t),a&&(s=a.valueAsString,void 0===s&&(s=a.toString()))}catch(r){}if(!s)return e._getStringJS(t);try{o=a.getQualifierValue("Language")}catch(r){return{value:s}}return{value:s,lang:o}},_getStringJS:function(e){var i=t.strings&&t.strings[e];return"string"==typeof i&&(i={value:i}),i||{value:e,empty:!0}},_getResourceContext:function(){if(t.document&&"undefined"==typeof h){var e=i.Windows.ApplicationModel.Resources.Core.ResourceContext;h=e.getForCurrentView?e.getForCurrentView():null}return h},oncontextchanged:g(m)});var y=i.Windows.ApplicationModel.Resources.Core.ResourceManager?e._getStringWinRT:e._getStringJS,b=function(e){return y(e)};n.Namespace._moduleDefine(e,null,{_formatString:l,_getWinJSString:o}),n.Namespace._moduleDefine(e,"WinJS.Resources",{getString:{get:function(){return b},set:function(e){b=e}}})}),define("WinJS/Core/_Trace",["./_Global"],function(e){"use strict";function t(e){return e}return{_traceAsyncOperationStarting:e.Debug&&e.Debug.msTraceAsyncOperationStarting&&e.Debug.msTraceAsyncOperationStarting.bind(e.Debug)||t,_traceAsyncOperationCompleted:e.Debug&&e.Debug.msTraceAsyncOperationCompleted&&e.Debug.msTraceAsyncOperationCompleted.bind(e.Debug)||t,_traceAsyncCallbackStarting:e.Debug&&e.Debug.msTraceAsyncCallbackStarting&&e.Debug.msTraceAsyncCallbackStarting.bind(e.Debug)||t,_traceAsyncCallbackCompleted:e.Debug&&e.Debug.msTraceAsyncCallbackCompleted&&e.Debug.msTraceAsyncCallbackCompleted.bind(e.Debug)||t}}),define("WinJS/Promise/_StateMachine",["../Core/_Global","../Core/_BaseCoreUtils","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Trace"],function(e,t,i,n,r,s){"use strict";function o(){}function a(e,t){var i;i=t&&"object"==typeof t&&"function"==typeof t.then?D:N,e._value=t,e._setState(i)
}function l(e,t,i,n,r,s){return{exception:e,error:t,promise:i,handler:s,id:n,parent:r}}function c(e,t,i,n){var r=i._isException,s=i._errorId;return l(r?t:null,r?null:t,e,s,i,n)}function u(e,t,i){var n=i._isException,r=i._errorId;return b(e,r,n),l(n?t:null,n?null:t,e,r,i)}function d(e,t){var i=++U;return b(e,i),l(null,t,e,i)}function h(e,t){var i=++U;return b(e,i,!0),l(t,null,e,i)}function _(e,t,i,n){var r=s._traceAsyncOperationStarting("WinJS.Promise.done");y(e,{c:t,e:i,p:n,asyncOpID:r})}function m(e,t,i,n){e._value=t,g(e,t,i,n),e._setState(H)}function p(t,i){var n=t._value,r=t._listeners;if(r){t._listeners=null;var o,a;for(o=0,a=Array.isArray(r)?r.length:1;a>o;o++){var l=1===a?r:r[o],c=l.c,u=l.promise;if(s._traceAsyncOperationCompleted(l.asyncOpID,e.Debug&&e.Debug.MS_ASYNC_OP_STATUS_SUCCESS),u){s._traceAsyncCallbackStarting(l.asyncOpID);try{u._setCompleteValue(c?c(n):n)}catch(d){u._setExceptionValue(d)}finally{s._traceAsyncCallbackCompleted()}u._state!==D&&u._listeners&&i.push(u)}else G.prototype.done.call(t,c)}}}function f(t,i){var n=t._value,r=t._listeners;if(r){t._listeners=null;var o,a;for(o=0,a=Array.isArray(r)?r.length:1;a>o;o++){var l=1===a?r:r[o],u=l.e,d=l.promise,h=e.Debug&&(n&&n.name===T?e.Debug.MS_ASYNC_OP_STATUS_CANCELED:e.Debug.MS_ASYNC_OP_STATUS_ERROR);if(s._traceAsyncOperationCompleted(l.asyncOpID,h),d){var _=!1;try{u?(s._traceAsyncCallbackStarting(l.asyncOpID),_=!0,u.handlesOnError||g(d,n,c,t,u),d._setCompleteValue(u(n))):d._setChainedErrorValue(n,t)}catch(m){d._setExceptionValue(m)}finally{_&&s._traceAsyncCallbackCompleted()}d._state!==D&&d._listeners&&i.push(d)}else J.prototype.done.call(t,null,u)}}}function g(e,t,i,n,r){if(k._listeners[P]){if(t instanceof Error&&t.message===T)return;k.dispatchEvent(P,i(e,t,n,r))}}function v(e,t){var i=e._listeners;if(i){var n,r;for(n=0,r=Array.isArray(i)?i.length:1;r>n;n++){var s=1===r?i:i[n],o=s.p;if(o)try{o(t)}catch(a){}s.c||s.e||!s.promise||s.promise._progress(t)}}}function y(e,t){var i=e._listeners;i?(i=Array.isArray(i)?i:[i],i.push(t)):i=t,e._listeners=i}function b(e,t,i){e._isException=i||!1,e._errorId=t}function C(e,t,i,n){e._value=t,g(e,t,i,n),e._setState(W)}function w(e,t){var i;i=t&&"object"==typeof t&&"function"==typeof t.then?D:z,e._value=t,e._setState(i)}function I(e,t,i,n){var r=new j(e),o=s._traceAsyncOperationStarting("WinJS.Promise.then");return y(e,{promise:r,c:t,e:i,p:n,asyncOpID:o}),r}function S(i){var n;return new Y(function(r){i?n=e.setTimeout(r,i):t._setImmediate(r)},function(){n&&e.clearTimeout(n)})}function E(e,t){var i=function(){t.cancel()},n=function(){e.cancel()};return e.then(i),t.then(n,n),t}e.Debug&&(e.Debug.setNonUserCodeExceptions=!0);var x=i.Class.mix(i.Class.define(null,{},{supportedForProcessing:!1}),r.eventMixin),k=new x;k._listeners={};var P="error",T="Canceled",A=!1,M={promise:1,thenPromise:2,errorPromise:4,exceptionPromise:8,completePromise:16};M.all=M.promise|M.thenPromise|M.errorPromise|M.exceptionPromise|M.completePromise;var B,L,D,O,R,F,N,z,H,W,U=1;B={name:"created",enter:function(e){e._setState(L)},cancel:o,done:o,then:o,_completed:o,_error:o,_notify:o,_progress:o,_setCompleteValue:o,_setErrorValue:o},L={name:"working",enter:o,cancel:function(e){e._setState(R)},done:_,then:I,_completed:a,_error:m,_notify:o,_progress:v,_setCompleteValue:w,_setErrorValue:C},D={name:"waiting",enter:function(e){var t=e._value;if(t instanceof j&&t._state!==W&&t._state!==z)y(t,{promise:e});else{var i=function(n){t._errorId?e._chainedError(n,t):(g(e,n,c,t,i),e._error(n))};i.handlesOnError=!0,t.then(e._completed.bind(e),i,e._progress.bind(e))}},cancel:function(e){e._setState(O)},done:_,then:I,_completed:a,_error:m,_notify:o,_progress:v,_setCompleteValue:w,_setErrorValue:C},O={name:"waiting_canceled",enter:function(e){e._setState(F);var t=e._value;t.cancel&&t.cancel()},cancel:o,done:_,then:I,_completed:a,_error:m,_notify:o,_progress:v,_setCompleteValue:w,_setErrorValue:C},R={name:"canceled",enter:function(e){e._setState(F),e._cancelAction()},cancel:o,done:_,then:I,_completed:a,_error:m,_notify:o,_progress:v,_setCompleteValue:w,_setErrorValue:C},F={name:"canceling",enter:function(e){var t=new Error(T);t.name=t.message,e._value=t,e._setState(H)},cancel:o,done:o,then:o,_completed:o,_error:o,_notify:o,_progress:o,_setCompleteValue:o,_setErrorValue:o},N={name:"complete_notify",enter:function(e){if(e.done=G.prototype.done,e.then=G.prototype.then,e._listeners)for(var t,i=[e];i.length;)t=i.shift(),t._state._notify(t,i);e._setState(z)},cancel:o,done:null,then:null,_completed:o,_error:o,_notify:p,_progress:o,_setCompleteValue:o,_setErrorValue:o},z={name:"success",enter:function(e){e.done=G.prototype.done,e.then=G.prototype.then,e._cleanupAction()},cancel:o,done:null,then:null,_completed:o,_error:o,_notify:p,_progress:o,_setCompleteValue:o,_setErrorValue:o},H={name:"error_notify",enter:function(e){if(e.done=J.prototype.done,e.then=J.prototype.then,e._listeners)for(var t,i=[e];i.length;)t=i.shift(),t._state._notify(t,i);e._setState(W)},cancel:o,done:null,then:null,_completed:o,_error:o,_notify:f,_progress:o,_setCompleteValue:o,_setErrorValue:o},W={name:"error",enter:function(e){e.done=J.prototype.done,e.then=J.prototype.then,e._cleanupAction()},cancel:o,done:null,then:null,_completed:o,_error:o,_notify:f,_progress:o,_setCompleteValue:o,_setErrorValue:o};var V,q=i.Class.define(null,{_listeners:null,_nextState:null,_state:null,_value:null,cancel:function(){this._state.cancel(this),this._run()},done:function(e,t,i){this._state.done(this,e,t,i)},then:function(e,t,i){return this._state.then(this,e,t,i)},_chainedError:function(e,t){var i=this._state._error(this,e,u,t);return this._run(),i},_completed:function(e){var t=this._state._completed(this,e);return this._run(),t},_error:function(e){var t=this._state._error(this,e,d);return this._run(),t},_progress:function(e){this._state._progress(this,e)},_setState:function(e){this._nextState=e},_setCompleteValue:function(e){this._state._setCompleteValue(this,e),this._run()},_setChainedErrorValue:function(e,t){var i=this._state._setErrorValue(this,e,u,t);return this._run(),i},_setExceptionValue:function(e){var t=this._state._setErrorValue(this,e,h);return this._run(),t},_run:function(){for(;this._nextState;)this._state=this._nextState,this._nextState=null,this._state.enter(this)}},{supportedForProcessing:!1}),j=i.Class.derive(q,function(e){A&&(A===!0||A&M.thenPromise)&&(this._stack=Y._getStack()),this._creator=e,this._setState(B),this._run()},{_creator:null,_cancelAction:function(){this._creator&&this._creator.cancel()},_cleanupAction:function(){this._creator=null}},{supportedForProcessing:!1}),J=i.Class.define(function(e){A&&(A===!0||A&M.errorPromise)&&(this._stack=Y._getStack()),this._value=e,g(this,e,d)},{cancel:function(){},done:function(e,t){var i=this._value;if(t)try{t.handlesOnError||g(null,i,c,this,t);var n=t(i);return void(n&&"object"==typeof n&&"function"==typeof n.done&&n.done())}catch(r){i=r}i instanceof Error&&i.message===T||Y._doneHandler(i)},then:function(e,t){if(!t)return this;var i,n=this._value;try{t.handlesOnError||g(null,n,c,this,t),i=new G(t(n))}catch(r){i=r===n?this:new K(r)}return i}},{supportedForProcessing:!1}),K=i.Class.derive(J,function(e){A&&(A===!0||A&M.exceptionPromise)&&(this._stack=Y._getStack()),this._value=e,g(this,e,h)},{},{supportedForProcessing:!1}),G=i.Class.define(function(e){if(A&&(A===!0||A&M.completePromise)&&(this._stack=Y._getStack()),e&&"object"==typeof e&&"function"==typeof e.then){var t=new j(null);return t._setCompleteValue(e),t}this._value=e},{cancel:function(){},done:function(e){if(e)try{var t=e(this._value);t&&"object"==typeof t&&"function"==typeof t.done&&t.done()}catch(i){Y._doneHandler(i)}},then:function(e){try{var t=e?e(this._value):this._value;return t===this._value?this:new G(t)}catch(i){return new K(i)}}},{supportedForProcessing:!1}),Y=i.Class.derive(q,function(e,t){A&&(A===!0||A&M.promise)&&(this._stack=Y._getStack()),this._oncancel=t,this._setState(B),this._run();try{var i=this._completed.bind(this),n=this._error.bind(this),r=this._progress.bind(this);e(i,n,r)}catch(s){this._setExceptionValue(s)}},{_oncancel:null,_cancelAction:function(){if(this._oncancel)try{this._oncancel()}catch(e){}},_cleanupAction:function(){this._oncancel=null}},{addEventListener:function(e,t,i){k.addEventListener(e,t,i)},any:function(e){return new Y(function(t,i){var n=Object.keys(e);0===n.length&&t();var r=0;n.forEach(function(s){Y.as(e[s]).then(function(){t({key:s,value:e[s]})},function(o){return o instanceof Error&&o.name===T?void(++r===n.length&&t(Y.cancel)):void i({key:s,value:e[s]})})})},function(){var t=Object.keys(e);t.forEach(function(t){var i=Y.as(e[t]);"function"==typeof i.cancel&&i.cancel()})})},as:function(e){return e&&"object"==typeof e&&"function"==typeof e.then?e:new G(e)},cancel:{get:function(){return V=V||new J(new n(T))}},dispatchEvent:function(e,t){return k.dispatchEvent(e,t)},is:function(e){return e&&"object"==typeof e&&"function"==typeof e.then},join:function(e){return new Y(function(t,i,n){var r=Object.keys(e),s=Array.isArray(e)?[]:{},o=Array.isArray(e)?[]:{},a=0,l=r.length,c=function(e){if(0===--l){var a=Object.keys(s).length;if(0===a)t(o);else{var c=0;r.forEach(function(e){var t=s[e];t instanceof Error&&t.name===T&&c++}),c===a?t(Y.cancel):i(s)}}else n({Key:e,Done:!0})};return r.forEach(function(t){var i=e[t];void 0===i?a++:Y.then(i,function(e){o[t]=e,c(t)},function(e){s[t]=e,c(t)})}),l-=a,0===l?void t(o):void 0},function(){Object.keys(e).forEach(function(t){var i=Y.as(e[t]);"function"==typeof i.cancel&&i.cancel()})})},removeEventListener:function(e,t,i){k.removeEventListener(e,t,i)},supportedForProcessing:!1,then:function(e,t,i,n){return Y.as(e).then(t,i,n)},thenEach:function(e,t,i,n){var r=Array.isArray(e)?[]:{};return Object.keys(e).forEach(function(s){r[s]=Y.as(e[s]).then(t,i,n)}),Y.join(r)},timeout:function(e,t){var i=S(e);return t?E(i,t):i},wrap:function(e){return new G(e)},wrapError:function(e){return new J(e)},_veryExpensiveTagWithStack:{get:function(){return A},set:function(e){A=e}},_veryExpensiveTagWithStack_tag:M,_getStack:function(){if(e.Debug&&e.Debug.debuggerEnabled)try{throw new Error}catch(t){return t.stack}},_cancelBlocker:function(e,t){if(!Y.is(e))return Y.wrap(e);var i,n,r=new Y(function(e,t){i=e,n=t},function(){i=null,n=null,t&&t()});return e.then(function(e){i&&i(e)},function(e){n&&n(e)}),r}});return Object.defineProperties(Y,r.createEventProperties(P)),Y._doneHandler=function(e){t._setImmediate(function(){throw e})},{PromiseStateMachine:q,Promise:Y,state_created:B}}),define("WinJS/Promise",["./Core/_Base","./Promise/_StateMachine"],function(e,t){"use strict";return e.Namespace.define("WinJS",{Promise:t.Promise}),t.Promise}),define("WinJS/Core/_Log",["exports","./_Global","./_Base"],function(e,t,i){"use strict";function n(e,t,i){var n=e;return"function"==typeof n&&(n=n()),(i&&a.test(i)?"":i?i+": ":"")+(t?t.replace(o,":")+": ":"")+n}function r(i,n,r){var s=e.formatLog(i,n,r);t.console&&t.console[r&&a.test(r)?r:"log"](s)}function s(e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}var o=/\s+/g,a=/^(error|warn|info|log)$/,l=null;i.Namespace._moduleDefine(e,"WinJS.Utilities",{startLog:function(t){t=t||{},"string"==typeof t&&(t={tags:t});var i=t.type&&new RegExp("^("+s(t.type).replace(o," ").split(" ").join("|")+")$"),n=t.excludeTags&&new RegExp("(^|\\s)("+s(t.excludeTags).replace(o," ").split(" ").join("|")+")(\\s|$)","i"),a=t.tags&&new RegExp("(^|\\s)("+s(t.tags).replace(o," ").split(" ").join("|")+")(\\s|$)","i"),l=t.action||r;if(!(i||n||a||e.log))return void(e.log=l);var c=function(e,t,r){i&&!i.test(r)||n&&n.test(t)||a&&!a.test(t)||l(e,t,r),c.next&&c.next(e,t,r)};c.next=e.log,e.log=c},stopLog:function(){e.log=null},formatLog:n}),i.Namespace._moduleDefine(e,"WinJS",{log:{get:function(){return l},set:function(e){l=e}}})}),define("WinJS/Scheduler",["exports","./Core/_Global","./Core/_Base","./Core/_ErrorFromName","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WriteProfilerMark","./Promise"],function(e,t,i,n,r,s,o,a,l){"use strict";function c(e){var t={},i="_prev"+e,n="_next"+e;return t["_remove"+e]=function(){var e=this[i],t=this[n];t&&(t[i]=e),e&&(e[n]=t),this[i]=null,this[n]=null},t["_insert"+e+"Before"]=function(e){var t=this[i];return t&&(t[n]=e),e[n]=this,e[i]=t,this[i]=e,e},t["_insert"+e+"After"]=function(e){var t=this[n];return this[n]=e,e[n]=t,e[i]=this,t&&(t[i]=e),e},t}function u(e,t,i){return void 0!==i?"("+e+";"+t+";"+i+")":void 0!==t?"("+e+";"+t+")":void 0!==e?"("+e+")":""}function d(e,t,i,n){a("WinJS.Scheduler:"+e+u(i,n)+","+t)}function h(e,t,i,n,r){var s=e.name||void 0!==n||void 0!==r;a("WinJS.Scheduler:"+t+":"+e.id+(s?u(e.name,n,r):"")+","+i)}function _(){return!1}function m(e){throw"Illegal call by job("+e.id+") in state: "+this.name}function p(e){return function(t,i,n){t._setState(e,i,n)}}function f(e,t){e._setPriority(t)}function g(e,t){function i(e,t){r.log&&r.log(t+": MARKER: "+e.name,"winjs scheduler","log")}function n(e,t){r.log&&r.log(t+": JOB("+e.id+"): state: "+(e._state?e._state.name:"")+(e.name?", name: "+e.name:""),"winjs scheduler","log")}r.log&&r.log("highWaterMark: "+kt,"winjs scheduler","log");var s=0,o=t?Ct[Ct.length-1]:Ct[0],a=o;do a instanceof ht&&i(a,s),a instanceof q&&n(a,s),s++,a=t?a["_prev"+e]:a["_next"+e];while(a)}function v(){function e(e,i){t+="    "+(i?"*":" ")+"id: "+e.id+", priority: "+D(e.priority).name+(e.name?", name: "+e.name:"")+"\n"}var t="";t+="Jobs:\n";var i=D(kt),n=0;for(It&&(e(It,!0),n++);i.priority>=bt.min;)i instanceof q&&(e(i,!1),n++),i=i._nextJob;0===n&&(t+="     None\n"),t+="Drain requests:\n";for(var r=0,s=Et.length;s>r;r++)t+="    "+(0===r?"*":" ")+"priority: "+D(Et[r].priority).name+", name: "+Et[r].name+"\n";return 0===Et.length&&(t+="     None\n"),t}function y(){var e=Ct[0];do{if(e instanceof q)return!1;e=e._nextJob}while(e);return!0}function b(){return 0===Et.length?null:Et[0].priority}function C(e){d("drain","StartTM",e.name,D(e.priority).name)}function w(e,t){t&&d("drain-canceled","info",e.name,D(e.priority).name),d("drain","StopTM",e.name,D(e.priority).name)}function I(e,t,i){Et.push({priority:e,complete:t,name:i}),1===Et.length&&(C(Et[0]),e>kt&&(kt=e,pt=!0))}function S(e,t){var i,n=Et.length;for(i=0;n>i;i++)if(Et[i].complete===e){0===i&&(w(Et[0],t),Et[1]&&C(Et[1])),Et.splice(i,1);break}}function E(){var e=Et.shift();e&&(w(e),Et[0]&&C(Et[0]),e.complete())}function x(){var e=!1;if(Et.length)for(var t=b();+t===t&&t>kt;)mt=t,E(),e=!0,t=b();return e}function k(e){return e>=bt.aboveNormal+1?At.HIGH:e>=bt.belowNormal?At.NORMAL:At.IDLE}function P(e,t){return Mt[e]>=Mt[t]}function T(e,t){return Mt[e]>Mt[t]}function A(e){switch(e){case At.HIGH:return!1;case At.NORMAL:return At.isTaskScheduledAtPriorityOrHigher(At.HIGH);case At.IDLE:return At.isTaskScheduledAtPriorityOrHigher(At.NORMAL)}}function M(e,t){var i=D(t);i.priority>kt&&(kt=i.priority,pt=!0),i._insertJobAfter(e)}function B(e,t){var i=D(t);i.priority>kt&&(kt=i.priority,pt=!0),i._nextMarker._insertJobBefore(e)}function L(e){return e=0|e,e=Math.max(e,vt),e=Math.min(e,yt)}function D(e){return e=L(e),Ct[-1*(e-yt)]}function O(e){_t=!0,d("timeslice","StartTM");var t,i,n,r=!0,s=!1,o=!1;pt=!1;try{for(var a=Bt(),l=a+xt,c=function(){return s=!1,pt?!0:A(k(kt))?!0:Et.length?!1:Bt()>l?(s=!0,!0):!1};kt>=bt.min&&!c()&&!o;){t=!1,i=D(kt)._nextJob;do{if(mt=i.priority,i instanceof q)n!==i.priority&&(+n===n&&d("priority","StopTM",D(n).name),d("priority","StartTM",D(i.priority).name),n=i.priority),t=!0,r=!1,It=i,h(It,"job-running","StartTM",D(mt).name),i._execute(c),h(It,"job-running","StopTM",D(mt).name),It=null,r=!0;else{var u=k(kt);kt=i.priority,t=x();var _=k(kt);!T(u,_)||St&&!At.isTaskScheduledAtPriorityOrHigher(_)||(o=!0)}i=i._nextJob}while(i&&!t&&!o&&!A(k(kt)));pt=!1}}finally{It=null,r||(h(i,"job-error","info"),h(i,"job-running","StopTM",D(mt).name),i.cancel()),+n===n&&d("priority","StopTM",D(n).name);for(var m=!1;kt>=bt.min&&!m;){t=!1,i=D(kt)._nextJob;do i instanceof q?m=!0:(kt=i.priority,t=x()),i=i._nextJob;while(i&&!t&&!m)}var p;p=r?s?"timeslice exhausted":kt<bt.min?"jobs exhausted":o?"reached WWA priority boundary":"WWA host work":"job error",e&&(wt=null),_t=!1,kt>=bt.min&&R(),d("yielding","info",p),d("timeslice","StopTM")}}function R(e){+e!==e&&(e=kt);var t=k(e);if(!_t&&(!wt||St&&!P(wt,t))){var i=++Lt,n=function(){i>Dt&&(Dt=Lt,O(!0))};At.execAsyncAtPriority(n,t),wt=t}}function F(e,t){var i=gt++;void 0===t&&(t="Drain Request "+i),e=+e===e?e:bt.min,e=L(e);var n,r=new l(function(i){n=i,I(e,n,t)},function(){S(n,!0)});return _t||R(),r}function N(e){return At.execAtPriority(e,At.HIGH)}function z(){return new K}function H(e,t,i,n){t=t||bt.normal,i=i||null;var r=++ft,s=o._traceAsyncOperationStarting("WinJS.Utilities.Scheduler.schedule: "+r+u(n));return n=n||"",new q(r,e,t,i,n,s)}function W(){if(_t)return mt;switch(At.getCurrentPriority()){case At.HIGH:return bt.high;case At.NORMAL:return bt.normal;case At.IDLE:return bt.idle}}function U(e){return function(t,i){var n;return new l(function(r){n=H(function(){r(t)},e,null,i)},function(){n.cancel()})}}i.Namespace.define("WinJS.Utilities",{_linkedListMixin:c});var V={get jobInfoIsNoLongerValid(){return"The job info object can only be used while the job is running"}},q=i.Class.define(function(e,t,i,n,r,s){this._id=e,this._work=t,this._context=n,this._name=r,this._asyncOpID=s,this._setPriority(i),this._setState(Y),h(this,"job-scheduled","info")},{completed:{get:function(){return!!this._state.completed}},id:{get:function(){return this._id}},name:{get:function(){return this._name},set:function(e){this._name=e}},owner:{get:function(){return this._owner},set:function(e){this._owner&&this._owner._remove(this),this._owner=e,this._owner&&this._owner._add(this)}},priority:{get:function(){return this._priority},set:function(e){e=L(e),this._state.setPriority(this,e)}},cancel:function(){this._state.cancel(this)},pause:function(){this._state.pause(this)},resume:function(){this._state.resume(this)},_execute:function(e){this._state.execute(this,e)},_executeDone:function(e){return this._state.executeDone(this,e)},_blockedDone:function(e){return this._state.blockedDone(this,e)},_setPriority:function(e){+this._priority===this._priority&&this._priority!==e&&h(this,"job-priority-changed","info",D(this._priority).name,D(e).name),this._priority=e},_setState:function(e,t,i){this._state&&r.log&&r.log("Transitioning job ("+this.id+") from: "+this._state.name+" to: "+e.name,"winjs scheduler","log"),this._state=e,this._state.enter(this,t,i)}});i.Class.mix(q,c("Job"));var j={complete:1,"continue":2,block:3},J=i.Class.define(function(e,t){this._job=t,this._result=null,this._yieldPolicy=j.complete,this._shouldYield=e},{job:{get:function(){return this._throwIfDisabled(),this._job}},shouldYield:{get:function(){return this._throwIfDisabled(),this._shouldYield()}},setPromise:function(e){this._throwIfDisabled(),this._result=e,this._yieldPolicy=j.block},setWork:function(e){this._throwIfDisabled(),this._result=e,this._yieldPolicy=j.continue},_disablePublicApi:function(){this._publicApiDisabled=!0},_throwIfDisabled:function(){if(this._publicApiDisabled)throw new n("WinJS.Utilities.Scheduler.JobInfoIsNoLongerValid",V.jobInfoIsNoLongerValid)}}),K=i.Class.define(function(){this._jobs={}},{cancelAll:function(){var e=this._jobs,t=Object.keys(e);this._jobs={};for(var i=0,n=t.length;n>i;i++)e[t[i]].cancel()},_add:function(e){this._jobs[e.id]=e},_remove:function(e){delete this._jobs[e.id]}}),G=i.Class.define(function(e){this.name=e,this.enter=m,this.execute=m,this.executeDone=m,this.blockedDone=m,this.cancel=m,this.pause=m,this.resume=m,this.setPriority=m}),Y=new G("created"),Z=new G("scheduled"),X=new G("paused"),Q=new G("canceled"),$=new G("running"),et=new G("running_paused"),tt=new G("running_resumed"),it=new G("running_canceled"),nt=new G("running_canceled_blocked"),rt=new G("cooperative_yield"),st=new G("cooperative_yield_paused"),ot=new G("blocked"),at=new G("blocked_waiting"),lt=new G("blocked_paused"),ct=new G("blocked_paused_waiting"),ut=new G("blocked_canceled"),dt=new G("complete");Y.enter=function(e){B(e,e.priority),e._setState(Z)},Z.enter=function(){R()},Z.execute=p($),Z.cancel=p(Q),Z.pause=p(X),Z.resume=_,Z.setPriority=function(e,t){e.priority!==t&&(e._setPriority(t),e.pause(),e.resume())},X.enter=function(e){h(e,"job-paused","info"),e._removeJob()},X.cancel=p(Q),X.pause=_,X.resume=function(e){h(e,"job-resumed","info"),B(e,e.priority),e._setState(Z)},X.setPriority=f,Q.enter=function(e){h(e,"job-canceled","info"),o._traceAsyncOperationCompleted(e._asyncOpID,t.Debug&&t.Debug.MS_ASYNC_OP_STATUS_CANCELED),e._removeJob(),e._work=null,e._context=null,e.owner=null},Q.cancel=_,Q.pause=_,Q.resume=_,Q.setPriority=_,$.enter=function(e,t){e._removeJob();var i=e.priority,n=e._work,r=e._context;e._work=null,e._context=null;var s=new J(t,e);o._traceAsyncCallbackStarting(e._asyncOpID);try{At.execAtPriority(function(){n.call(r,s)},k(i))}finally{o._traceAsyncCallbackCompleted(),s._disablePublicApi()}e._context=r;var a=e._executeDone(s._yieldPolicy);e._setState(a,s._result,i)},$.executeDone=function(e,t){switch(t){case j.complete:return dt;case j.continue:return rt;case j.block:return ot}},$.cancel=function(e){pt=!0,e._setState(it)},$.pause=function(e){pt=!0,e._setState(et)},$.resume=_,$.setPriority=f,et.enter=_,et.executeDone=function(e,t){switch(t){case j.complete:return dt;case j.continue:return st;case j.block:return lt}},et.cancel=p(it),et.pause=_,et.resume=p(tt),et.setPriority=f,tt.enter=_,tt.executeDone=function(e,t){switch(t){case j.complete:return dt;case j.continue:return rt;case j.block:return ot}},tt.cancel=p(it),tt.pause=p(et),tt.resume=_,tt.setPriority=f,it.enter=_,it.executeDone=function(e,t){switch(t){case j.complete:case j.continue:return Q;case j.block:return nt}},it.cancel=_,it.pause=_,it.resume=_,it.setPriority=_,nt.enter=function(e,t){t.cancel(),e._setState(Q)},rt.enter=function(e,t,i){h(e,"job-yielded","info"),i===e.priority?M(e,e.priority):B(e,e.priority),e._work=t,e._setState(Z)},st.enter=function(e,t){h(e,"job-yielded","info"),e._work=t,e._setState(X)},ot.enter=function(e,t,i){h(e,"job-blocked","StartTM"),e._work=t,e._setState(at),t.done(function(t){h(e,"job-blocked","StopTM");var n=e._blockedDone(t);e._setState(n,t,i)},function(t){return t&&"Canceled"===t.name||h(e,"job-error","info"),h(e,"job-blocked","StopTM"),e._setState(Q),l.wrapError(t)})},at.enter=_,at.blockedDone=function(e,t){return"function"==typeof t?rt:dt},at.cancel=p(ut),at.pause=p(ct),at.resume=_,at.setPriority=f,lt.enter=function(e,t,i){h(e,"job-blocked","StartTM"),e._work=t,e._setState(ct),t.done(function(t){h(e,"job-blocked","StopTM");var n=e._blockedDone(t);e._setState(n,t,i)},function(t){return t&&"Canceled"===t.name||h(e,"job-error","info"),h(e,"job-blocked","StopTM"),e._setState(Q),l.wrapError(t)})},ct.enter=_,ct.blockedDone=function(e,t){return"function"==typeof t?st:dt},ct.cancel=p(ut),ct.pause=_,ct.resume=p(at),ct.setPriority=f,ut.enter=function(e){e._work.cancel(),e._work=null},ut.blockedDone=function(){return Q},ut.cancel=_,ut.pause=_,ut.resume=_,ut.setPriority=_,dt.completed=!0,dt.enter=function(e){o._traceAsyncOperationCompleted(e._asyncOpID,t.Debug&&t.Debug.MS_ASYNC_OP_STATUS_SUCCESS),e._work=null,e._context=null,e.owner=null,h(e,"job-completed","info")},dt.cancel=_,dt.pause=_,dt.resume=_,dt.setPriority=_;var ht=i.Class.define(function(e,t){this.priority=e,this.name=t},{});i.Class.mix(ht,c("Job"),c("Marker"));var _t,mt,pt,ft=0,gt=0,vt=-15,yt=15,bt={max:15,high:13,aboveNormal:9,normal:0,belowNormal:-9,idle:-13,min:-15},Ct=[new ht(15,"max"),new ht(14,"14"),new ht(13,"high"),new ht(12,"12"),new ht(11,"11"),new ht(10,"10"),new ht(9,"aboveNormal"),new ht(8,"8"),new ht(7,"7"),new ht(6,"6"),new ht(5,"5"),new ht(4,"4"),new ht(3,"3"),new ht(2,"2"),new ht(1,"1"),new ht(0,"normal"),new ht(-1,"-1"),new ht(-2,"-2"),new ht(-3,"-3"),new ht(-4,"-4"),new ht(-5,"-5"),new ht(-6,"-6"),new ht(-7,"-7"),new ht(-8,"-8"),new ht(-9,"belowNormal"),new ht(-10,"-10"),new ht(-11,"-11"),new ht(-12,"-12"),new ht(-13,"idle"),new ht(-14,"-14"),new ht(-15,"min"),new ht(-16,"<TAIL>")],wt=null,It=null,St=!(!t.MSApp||!t.MSApp.execAtPriority),Et=[],xt=30,kt=bt.min;Ct.reduce(function(e,t){return e&&(e._insertJobAfter(t),e._insertMarkerAfter(t)),t});var Pt=t.setImmediate?t.setImmediate.bind(t):function(e){t.setTimeout(e,16)},Tt={execAsyncAtPriority:function(e,i){i===At.HIGH&&t.setTimeout(e,0),Pt(e)},execAtPriority:function(e){return e()},getCurrentPriority:function(){return Tt.NORMAL},isTaskScheduledAtPriorityOrHigher:function(){return!1},HIGH:"high",NORMAL:"normal",IDLE:"idle"},At=St?t.MSApp:Tt,Mt={};Mt[At.IDLE]=1,Mt[At.NORMAL]=2,Mt[At.HIGH]=3;var Bt=t.performance&&t.performance.now&&t.performance.now.bind(t.performance)||Date.now.bind(Date),Lt=0,Dt=0;i.Namespace._moduleDefine(e,"WinJS.Utilities.Scheduler",{Priority:bt,schedule:H,createOwnerToken:z,execHigh:N,requestDrain:F,currentPriority:{get:W},schedulePromiseHigh:U(bt.high),schedulePromiseAboveNormal:U(bt.aboveNormal),schedulePromiseNormal:U(bt.normal),schedulePromiseBelowNormal:U(bt.belowNormal),schedulePromiseIdle:U(bt.idle),retrieveState:v,_JobNode:q,_JobInfo:J,_OwnerToken:K,_dumpList:g,_isEmpty:{get:y},_usingWwaScheduler:{get:function(){return St},set:function(e){St=e,At=St?t.MSApp:Tt}},_MSApp:{get:function(){return At},set:function(e){At=e}},_TIME_SLICE:xt})}),define("WinJS/Core/_BaseUtils",["exports","./_Global","./_Base","./_BaseCoreUtils","./_ErrorFromName","./_Resources","./_Trace","../Promise","../Scheduler"],function(e,t,i,n,r,s,o,a,l){"use strict";function c(e){return e}function u(e,t,i){return e.split(".").reduce(function(e,t){return e?i(e[t]):null},t)}function d(e,i){return e?u(e,i||t,c):null}function h(e){return e.length>0&&0!==e.indexOf("-moz")&&"-"===e.charAt(0)&&(e=e.slice(1)),e.replace(/\-[a-z]/g,function(e){return e[1].toUpperCase()})}function _(e,t){return""===e?t:e+t.charAt(0).toUpperCase()+t.slice(1)}function m(e,t){return(""!==e?"-"+e.toLowerCase()+"-":"")+t}function p(){if(!t.document)return{};for(var e={},i=t.document.documentElement.style,n=["","webkit","ms","Moz"],r=["animation","transition","transform","animation-name","animation-duration","animation-delay","animation-timing-function","animation-iteration-count","animation-direction","animation-fill-mode","grid-column","grid-columns","grid-column-span","grid-row","grid-rows","grid-row-span","transform-origin","transition-property","transition-duration","transition-delay","transition-timing-function","scroll-snap-points-x","scroll-snap-points-y","scroll-chaining","scroll-limit","scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","touch-action","overflow-style","user-select"],s={},o=0,a=r.length;a>o;o++)for(var l=r[o],c=h(l),u=0,d=n.length;d>u;u++){var p=n[u],f=_(p,c);if(f in i){var g=m(p,l);e[l]={cssName:g,scriptName:f},s[l]=p;break}}return e.animationPrefix=m(s.animation,""),e.keyframes=m(s.animation,"keyframes"),e}function f(){for(var e={},i=["","WebKit"],n=[{eventObject:"TransitionEvent",events:["transitionStart","transitionEnd"]},{eventObject:"AnimationEvent",events:["animationStart","animationEnd"]}],r=0,s=n.length;s>r;r++){for(var o=n[r],a="",l=0,c=i.length;c>l;l++){var u=i[l];if(u+o.eventObject in t){a=u.toLowerCase();break}}for(var l=0,d=o.events.length;d>l;l++){var h=o.events[l];e[h]=_(a,h),""===a&&(e[h]=e[h].toLowerCase())}}return e.manipulationStateChanged="MSManipulationEvent"in t?"ManipulationEvent":null,e}function g(e,t){function i(){return a.timeout(e).then(function(){n=null})}var n=null,r=null,s=null,o=null;return function(){r?(s=this,o=[].slice.call(arguments,0)):n?(s=this,o=[].slice.call(arguments,0),r=n.then(function(){var e=s;s=null;var a=o;o=null,n=i(),r=null,t.apply(e,a)})):(n=i(),t.apply(this,arguments))}}var v,y={get notSupportedForProcessing(){return"Value is not supported within a declarative processing context, if you want it to be supported mark it using WinJS.Utilities.markSupportedForProcessing. The value was: '{0}'"}},b=0,C={},w=!1,I=t.navigator.platform,S="iPhone"===I||"iPad"===I||"iPod"===I;i.Namespace._moduleDefine(e,"WinJS.Utilities",{_setHasWinRT:{value:function(e){n.hasWinRT=e},configurable:!1,writable:!1,enumerable:!1},hasWinRT:{get:function(){return n.hasWinRT},configurable:!1,enumerable:!0},_setIsiOS:{value:function(e){S=e},configurable:!1,writable:!1,enumerable:!1},_isiOS:{get:function(){return S},configurable:!1,enumerable:!0},_getMemberFiltered:u,getMember:d,_browserStyleEquivalents:p(),_browserEventEquivalents:f(),_getCamelCasedName:h,ready:function E(e,i){return new a(function(n,r){function s(){if(e)try{e(),n()}catch(t){r(t)}else n()}var o=E._testReadyState;o||(o=t.document?t.document.readyState:"complete"),"complete"===o||t.document&&null!==t.document.body?i?l.schedule(function(){s()},l.Priority.normal,null,"WinJS.Utilities.ready"):s():t.addEventListener("DOMContentLoaded",s,!1)})},strictProcessing:{get:function(){return!0},configurable:!1,enumerable:!0},markSupportedForProcessing:{value:n.markSupportedForProcessing,configurable:!1,writable:!1,enumerable:!0},requireSupportedForProcessing:{value:function(e){var i=!0;switch(i=i&&e!==t,i=i&&e!==t.location,i=i&&!(e instanceof t.HTMLIFrameElement),i=i&&!("function"==typeof e&&!e.supportedForProcessing),t.frames.length){case 0:break;case 1:i=i&&e!==t.frames[0];break;default:for(var n=0,o=t.frames.length;i&&o>n;n++)i=i&&e!==t.frames[n]}if(i)return e;throw new r("WinJS.Utilities.requireSupportedForProcessing",s._formatString(y.notSupportedForProcessing,e))},configurable:!1,writable:!1,enumerable:!0},_setImmediate:n._setImmediate,_requestAnimationFrame:t.requestAnimationFrame?t.requestAnimationFrame.bind(t):function(e){var i=++b;return C[i]=e,v=v||t.setTimeout(function(){var e=C,t=Date.now();C={},v=null,Object.keys(e).forEach(function(i){e[i](t)})},16),i},_cancelAnimationFrame:t.cancelAnimationFrame?t.cancelAnimationFrame.bind(t):function(e){delete C[e]},_yieldForEvents:t.setImmediate?t.setImmediate.bind(t):function(e){t.setTimeout(e,0)},_yieldForDomModification:t.setImmediate?t.setImmediate.bind(t):function(e){t.setTimeout(e,0)},_throttledFunction:g,_shallowCopy:function(e){return this._mergeAll([e])},_merge:function(e,t){return this._mergeAll([e,t])},_mergeAll:function(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},_getProfilerMarkIdentifier:function(e){var t="";return e.id&&(t+=" id='"+e.id+"'"),e.className&&(t+=" class='"+e.className+"'"),t},_now:function(){return t.performance&&t.performance.now&&t.performance.now()||Date.now()},_traceAsyncOperationStarting:o._traceAsyncOperationStarting,_traceAsyncOperationCompleted:o._traceAsyncOperationCompleted,_traceAsyncCallbackStarting:o._traceAsyncCallbackStarting,_traceAsyncCallbackCompleted:o._traceAsyncCallbackCompleted}),i.Namespace._moduleDefine(e,"WinJS",{validation:{get:function(){return w},set:function(e){w=e}}}),i.Namespace.define("WinJS",{strictProcessing:{value:function(){},configurable:!1,writable:!1,enumerable:!1}})}),define("WinJS/Core",["./Core/_Base","./Core/_BaseCoreUtils","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Global","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WinRT","./Core/_WriteProfilerMark"],function(){}),define("WinJS/_Signal",["./Core/_Base","./Promise/_StateMachine"],function(e,t){"use strict";var i=e.Class.derive(t.PromiseStateMachine,function(e){this._oncancel=e,this._setState(t.state_created),this._run()},{_cancelAction:function(){this._oncancel&&this._oncancel()},_cleanupAction:function(){this._oncancel=null}},{supportedForProcessing:!1}),n=e.Class.define(function(e){this._promise=new i(e)},{promise:{get:function(){return this._promise}},cancel:function(){this._promise.cancel()},complete:function(e){this._promise._completed(e)},error:function(e){this._promise._error(e)},progress:function(e){this._promise._progress(e)}},{supportedForProcessing:!1});return e.Namespace.define("WinJS",{_Signal:n}),n
}),define("WinJS/Utilities/_Control",["exports","../Core/_Global","../Core/_Base"],function(e,t,i){"use strict";function n(e,t){r(e,t)}function r(e,t,i){if("object"==typeof t)for(var n=Object.keys(t),r=0,s=n.length;s>r;r++){var o=n[r],a=t[o];if(o.length>2){var l=o[0],c=o[1];if(!("o"!==l&&"O"!==l||"n"!==c&&"N"!==c)&&"function"==typeof a&&e.addEventListener){e.addEventListener(o.substr(2),a);continue}}i||(e[o]=a)}}t.document&&i.Namespace._moduleDefine(e,"WinJS.UI",{DOMEventMixin:i.Namespace._lazy(function(){return{_domElement:null,addEventListener:function(e,t,i){(this.element||this._domElement).addEventListener(e,t,i||!1)},dispatchEvent:function(e,i){var n=t.document.createEvent("Event");return n.initEvent(e,!1,!1),n.detail=i,"object"==typeof i&&Object.keys(i).forEach(function(e){n[e]=i[e]}),(this.element||this._domElement).dispatchEvent(n)},removeEventListener:function(e,t,i){(this.element||this._domElement).removeEventListener(e,t,i||!1)}}}),setOptions:n,_setOptions:r})}),define("WinJS/Utilities/_ElementUtilities",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WinRT","../Promise","../Scheduler"],function(e,t,i,n,r,s,o){"use strict";function a(e){for(var t=e.length,i=t-1;i>=0;i--)e[i]||(e.splice(i,1),t--);return t}function l(e){var t=e.className||"";return"string"==typeof t?t:t.baseVal||""}function c(e,t){var i=e.className||"";return"string"==typeof i?e.className=t:e.className.baseVal=t,e}function u(e,t){if(e.classList){if(t.indexOf(" ")<0)e.classList.add(t);else{var i=t.split(" ");a(i);for(var n=0,r=i.length;r>n;n++)e.classList.add(i[n])}return e}var s,o=l(e),u=o.split(" "),d=a(u);if(t.indexOf(" ")>=0){var i=t.split(" ");a(i);for(var n=0;d>n;n++){var h=i.indexOf(u[n]);h>=0&&i.splice(h,1)}i.length>0&&(s=i.join(" "))}else{for(var _=!1,n=0;d>n;n++)if(u[n]===t){_=!0;break}_||(s=t)}return s&&(d>0&&u[0].length>0?c(e,o+" "+s):c(e,s)),e}function d(e,t){if(e.classList){if(0===e.classList.length)return e;var i=t.split(" ");a(i);for(var n=0,r=i.length;r>n;n++)e.classList.remove(i[n]);return e}var i,s,o=l(e);if(t.indexOf(" ")>=0)i=t.split(" "),s=a(i);else{if(o.indexOf(t)<0)return e;i=[t],s=1}for(var u,d=o.split(" "),h=a(d),n=h-1;n>=0;n--)i.indexOf(d[n])>=0&&(d.splice(n,1),u=!0);return u&&c(e,d.join(" ")),e}function h(e,t){if(e.classList)return e.classList.toggle(t),e;for(var i=l(e),n=i.trim().split(" "),r=n.length,s=!1,o=0;r>o;o++)n[o]===t&&(s=!0);return s?c(e,n.reduce(function(e,i){return i===t?e:e&&e.length>0?e+" "+i:i},"")):r>0&&n[0].length>0?c(e,i+" "+t):c(e,i+t),e}function _(e,t,i){e.getAttribute(t)!==""+i&&e.setAttribute(t,i)}function m(e,t,i,n){var r=Math.max(t,Math.min(i,+e));return 0===r?0:r||Math.max(t,Math.min(i,n))}function p(e,t){if(!N.test(t)&&z.test(t)){var i=e.style.left;return e.style.left=t,t=e.style.pixelLeft,e.style.left=i,t}return Math.round(parseFloat(t))||0}function f(e,i){return p(e,t.getComputedStyle(e,null)[i])}function g(e,t,i,n,r){var s=t.toLowerCase();e._eventsMap||(e._eventsMap={}),e._eventsMap[s]||(e._eventsMap[s]=[]),e._eventsMap[s].push({listener:i,useCapture:n,data:r})}function v(e,t,i,n){var r=t.toLowerCase(),s=e._eventsMap&&e._eventsMap[r];if(s)for(var o=s.length-1;o>=0;o--){var a=s[o];if(a.listener===i&&!!n==!!a.useCapture)return s.splice(o,1),a}return null}function y(e,t){var i=t.toLowerCase();return e._eventsMap&&e._eventsMap[i]&&e._eventsMap[i].slice(0)||[]}function b(e,t,i){for(;e;){for(var n=y(e,t),r=0,s=n.length;s>r;r++)n[r].listener.call(e,i);e=e.parentNode}}function C(e){return(e.relatedTarget&&"IFRAME"===e.relatedTarget.tagName||e.target&&"IFRAME"===e.target.tagName)&&(e.relatedTarget=null),e}function w(e,t,i,n){if(n)throw"This custom WinJS event only supports bubbling";g(e,t,i,n)}function I(e,t){var i=t.changedTouches,n=null;if(!i)return n;for(var r=0,s=i.length;s>r;r++){var o=i[r],a=new q(t,{pointerType:U.MSPOINTER_TYPE_TOUCH,pointerId:o.identifier,screenX:o.screenX,screenY:o.screenY,clientX:o.clientX,clientY:o.clientY,radiusX:o.radiusX,radiusY:o.radiusY,rotationAngle:o.rotationAngle,force:o.force,_currentTouch:o}),l=e(a);n=n||l}return n}function S(e,t){return t.pointerType=U.MSPOINTER_TYPE_MOUSE,t.pointerId=-1,e(t)}function E(e,t){return e(t)}function x(e,i,n,r){var s,o,a,l,c=i.toLowerCase(),u=j[c];t.MSPointerEvent?(a=function(e){return e._normalizedType=c,l=!0,E(n,e)},e.addEventListener(u.mspointer,a,r)):(u.mouse&&(s=function(e){return e._normalizedType=c,l?void(l=!1):S(n,e)},e.addEventListener(u.mouse,s,r)),u.touch&&(o=function(e){return e._normalizedType=c,l=!0,I(n,e)},e.addEventListener(u.touch,o,r))),g(e,i,n,r,{mouseWrapper:s,touchWrapper:o,mspointerWrapper:a})}function k(e,t,i,n){var r=t.toLowerCase(),s=v(e,t,i,n);if(s){var o=j[r];s.data.mouseWrapper&&e.removeEventListener(o.mouse,s.data.mouseWrapper,n),s.data.touchWrapper&&e.removeEventListener(o.touch,s.data.touchWrapper,n),s.data.mspointerWrapper&&e.removeEventListener(o.mspointer,s.data.mspointerWrapper,n)}}function P(){var e=t.document.createElement("div");e.style.direction="rtl",e.innerHTML="<div style='width: 100px; height: 100px; overflow: scroll; visibility:hidden'><div style='width: 10000px; height: 100px;'></div></div>",t.document.body.appendChild(e);var i=e.firstChild;i.scrollLeft>0&&(et=!0),i.scrollLeft+=100,0===i.scrollLeft&&(tt=!0),t.document.body.removeChild(e),$=!0}function T(e){var i=t.getComputedStyle(e),n=e.scrollLeft;return"rtl"===i.direction&&($||P(),et&&(n=e.scrollWidth-e.clientWidth-n),n=Math.abs(n)),{scrollLeft:n,scrollTop:e.scrollTop}}function A(e,i,n){if(void 0!==i){var r=t.getComputedStyle(e);"rtl"===r.direction&&($||P(),tt?i=-i:et&&(i=e.scrollWidth-e.clientWidth-i)),e.scrollLeft=i}void 0!==n&&(e.scrollTop=n)}function M(e){return T(e)}function B(e,t){t=t||{},A(e,t.scrollLeft,t.scrollTop)}function L(e){return e.uniqueID||e._uniqueID||(e._uniqueID="element__"+ ++rt),e.uniqueID||e._uniqueID}function D(e){e.id||(e.id=L(e))}function O(e){var i=t.document.documentElement,n=M(i);return{left:e.clientX+("rtl"===t.document.body.dir?-n.scrollLeft:n.scrollLeft),top:e.clientY+i.scrollTop}}function R(e,t){for(var i=[],n=0,r=t.length;r>n;n++){var s=e.querySelector("."+t[n]);s&&i.push(s)}return i}if(t.document){var F=167,N=/^-?\d+\.?\d*(px)?$/i,z=/^-?\d+/i,H=t.MSGestureEvent||{MSGESTURE_FLAG_BEGIN:1,MSGESTURE_FLAG_CANCEL:4,MSGESTURE_FLAG_END:2,MSGESTURE_FLAG_INERTIA:8,MSGESTURE_FLAG_NONE:0},W=t.MSManipulationEvent||{MS_MANIPULATION_STATE_ACTIVE:1,MS_MANIPULATION_STATE_CANCELLED:6,MS_MANIPULATION_STATE_COMMITTED:7,MS_MANIPULATION_STATE_DRAGGING:5,MS_MANIPULATION_STATE_INERTIA:2,MS_MANIPULATION_STATE_PRESELECT:3,MS_MANIPULATION_STATE_SELECTING:4,MS_MANIPULATION_STATE_STOPPED:0},U=t.MSPointerEvent||{MSPOINTER_TYPE_TOUCH:"touch",MSPOINTER_TYPE_PEN:"pen",MSPOINTER_TYPE_MOUSE:"mouse"},V=null;t.addEventListener("blur",function(){var e=V;e&&b(e,"focusout",C({type:"focusout",target:e,relatedTarget:null})),V=null}),t.document.documentElement.addEventListener("focus",function(e){var t=V;V=e.target,t&&b(t,"focusout",C({type:"focusout",target:t,relatedTarget:V})),V&&b(V,"focusin",C({type:"focusin",target:V,relatedTarget:t}))},!0);var q=function(e,t){t=t||{},this.__eventObject=e;var i=this;Object.keys(t).forEach(function(e){Object.defineProperty(i,e,{value:t[e]})})};["altKey","AT_TARGET","bubbles","BUBBLING_PHASE","button","buttons","cancelable","cancelBubble","CAPTURING_PHASE","clientX","clientY","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","getModifierState","height","hwTimestamp","initEvent","initMouseEvent","initPointerEvent","initUIEvent","isPrimary","isTrusted","layerX","layerY","metaKey","offsetX","offsetY","pageX","pageY","pointerId","pointerType","pressure","preventDefault","relatedTarget","rotation","screenX","screenY","shiftKey","srcElement","stopImmediatePropagation","stopPropagation","target","tiltX","tiltY","timeStamp","toElement","type","view","which","width","x","y","_normalizedType","_fakedBySemanticZoom"].forEach(function(e){Object.defineProperty(q.prototype,e,{get:function(){var t=this.__eventObject[e];return"function"==typeof t?t.bind(this.__eventObject):t},configurable:!0})});var j={pointerdown:{touch:"touchstart",mspointer:"MSPointerDown",mouse:"mousedown"},pointerup:{touch:"touchend",mspointer:"MSPointerUp",mouse:"mouseup"},pointermove:{touch:"touchmove",mspointer:"MSPointerMove",mouse:"mousemove"},pointerenter:{touch:"touchenter",mspointer:"MSPointerEnter",mouse:"mouseenter"},pointerover:{touch:null,mspointer:"MSPointerOver",mouse:"mouseover"},pointerout:{touch:"touchleave",mspointer:"MSPointerOut",mouse:"mouseout"},pointercancel:{touch:"touchcancel",mspointer:"MSPointerCancel",mouse:null}},J={focusout:{register:w,unregister:v},focusin:{register:w,unregister:v}};if(!t.PointerEvent){var K={register:x,unregister:k};J.pointerdown=K,J.pointerup=K,J.pointermove=K,J.pointerenter=K,J.pointerover=K,J.pointerout=K,J.pointercancel=K}var G=i.Class.define(function(e){this._callback=e,this._toDispose=[],this._attributeFilter=[],this._scheduled=!1,this._pendingChanges=[],this._observerCount=0,this._handleCallback=this._handleCallback.bind(this),this._targetElements=[]},{observe:function(e,t){-1===this._targetElements.indexOf(e)&&this._targetElements.push(e),this._observerCount++,t.attributes&&this._addRemovableListener(e,"DOMAttrModified",this._handleCallback),t.attributeFilter&&(this._attributeFilter=t.attributeFilter)},disconnect:function(){this._observerCount=0,this._targetElements=[],this._toDispose.forEach(function(e){e()})},_addRemovableListener:function(e,t,i){e.addEventListener(t,i),this._toDispose.push(function(){e.removeEventListener(t,i)})},_handleCallback:function(e){if(e.stopPropagation(),(!this._attributeFilter.length||-1!==this._attributeFilter.indexOf(e.attrName))&&-1!==this._targetElements.indexOf(e.target)){var t=e.attrName;"tabindex"===t&&(t="tabIndex"),this._pendingChanges.push({type:"attributes",target:e.target,attributeName:t}),1===this._observerCount?this._dispatchEvent():this._scheduled===!1&&(this._scheduled=!0,n._setImmediate(this._dispatchEvent.bind(this)))}},_dispatchEvent:function(){try{this._callback(this._pendingChanges)}finally{this._pendingChanges=[],this._scheduled=!1}}},{_isShim:!0}),Y=t.MutationObserver||G,Z=null,X=i.Class.define(function(){t.addEventListener("resize",this._handleResize.bind(this))},{subscribe:function(e,t){e.addEventListener(this._resizeEvent,t),u(e,this._resizeClass)},unsubscribe:function(e,t){d(e,this._resizeClass),e.removeEventListener(this._resizeEvent,t)},_handleResize:function(){for(var e=t.document.querySelectorAll("."+this._resizeClass),i=e.length,n=0;i>n;n++){var r=t.document.createEvent("Event");r.initEvent(this._resizeEvent,!1,!0),e[n].dispatchEvent(r)}},_resizeClass:{get:function(){return"win-element-resize"}},_resizeEvent:{get:function(){return"WinJSElementResize"}}}),Q=i.Class.define(function(e,t,i){i=i||{},this.registerThruWinJSCustomEvents=!!i.registerThruWinJSCustomEvents,this.objectName=e,this.object=t,this.capture={},this.bubble={}},{addEventListener:function(t,i,n,r){i=i.toLowerCase();var s=this._getHandlers(r),o=s[i];o||(o=this._getListener(i,r),o.refCount=0,s[i]=o,this.registerThruWinJSCustomEvents?e._addEventListener(this.object,i,o,r):this.object.addEventListener(i,o,r)),o.refCount++,t.addEventListener(this._getEventName(i,r),n),u(t,this._getClassName(i,r))},removeEventListener:function(t,i,n,r){i=i.toLowerCase();var s=this._getHandlers(r),o=s[i];o&&(o.refCount--,0===o.refCount&&(this.registerThruWinJSCustomEvents?e._removeEventListener(this.object,i,o,r):this.object.removeEventListener(i,o,r),delete s[i])),d(t,this._getClassName(i,r)),t.removeEventListener(this._getEventName(i,r),n)},_getHandlers:function(e){return e?this.capture:this.bubble},_getClassName:function(e,t){var i=t?"capture":"bubble";return"win-"+this.objectName.toLowerCase()+"-event-"+e+i},_getEventName:function(e,t){var i=t?"capture":"bubble";return"WinJS"+this.objectName+"Event-"+e+i},_getListener:function(e,i){var n=function(n){for(var r=t.document.querySelectorAll("."+this._getClassName(e,i)),s=r.length,o=!1,a=0;s>a;a++){var l=t.document.createEvent("Event");l.initEvent(this._getEventName(e,i),!1,!0),l.detail={originalEvent:n};var c=r[a].dispatchEvent(l);o=o||!c}return o};return n.bind(this)}}),$=!1,et=!1,tt=!1,it=!!t.HTMLElement.prototype.msZoomTo,nt=!(!t.MSPointerEvent&&!t.TouchEvent),rt=0,st=".win-selectionborder, .win-selectionbackground, .win-selectioncheckmark, .win-selectioncheckmarkbackground",ot="_msDataKey";i.Namespace._moduleDefine(e,"WinJS.Utilities",{_dataKey:ot,_supportsTouchDetection:{get:function(){return nt}},_supportsZoomTo:{get:function(){return it}},_uniqueID:L,_ensureId:D,_clamp:m,_getCursorPos:O,_getElementsByClasses:R,_createGestureRecognizer:function(){if(t.MSGesture)return new t.MSGesture;var e=function(){};return{addEventListener:e,removeEventListener:e,addPointer:e,stop:e}},_supportsTouchActionCrossSlide:{get:function(){if(void 0===this._supportsTouchActionCrossSlideValue){this._supportsTouchActionCrossSlideValue=!1;var e=n._browserStyleEquivalents["touch-action"];if(e){var i=t.document.createElement("div");i.style.touchAction="cross-slide-x",t.document.body.appendChild(i),this._supportsTouchActionCrossSlideValue="cross-slide-x"===t.getComputedStyle(i).touchAction,t.document.body.removeChild(i)}}return this._supportsTouchActionCrossSlideValue}},_detectSnapPointsSupport:function(){return this._snapPointsDetectionPromise||(this._snapPointsDetectionPromise=t.HTMLElement.prototype.msZoomTo?new s(function(e){var i=t.document.createElement("div");i.style.width="100px",i.style.overflowX="scroll",i.style.msScrollSnapType="mandatory",i.style.position="absolute",i.style.opacity="0",i.style.visibility="hidden";var n=function(){i.removeEventListener("MSManipulationStateChanged",n),t.clearTimeout(s),t.document.body.removeChild(i),e(!0)};i.addEventListener("MSManipulationStateChanged",n);var r=t.document.createElement("div");r.style.width=r.style.height="200px",i.appendChild(r),t.document.body.appendChild(i),i.msZoomTo({contentX:90});var s=t.setTimeout(function(){i.removeEventListener("MSManipulationStateChanged",n),t.document.body.removeChild(i),e(!1)},50)}):s.wrap(!1)),this._snapPointsDetectionPromise},_MSGestureEvent:H,_MSManipulationEvent:W,_elementsFromPoint:function(e,i){if(t.document.msElementsFromPoint)return t.document.msElementsFromPoint(e,i);var n=t.document.elementFromPoint(e,i);return n?[n]:null},_matchesSelector:function(e,t){var i=e.matches||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector;return i.call(e,t)},_selectionPartsSelector:st,_isSelectionRendered:function(e){return e.querySelectorAll(st).length>0},_addEventListener:function(e,t,i,r){var s=t&&t.toLowerCase(),o=J[s],a=n._browserEventEquivalents[t];o?o.register(e,t,i,r):a?e.addEventListener(a,i,r):e.addEventListener(t,i,r)},_removeEventListener:function(e,t,i,r){var s=t&&t.toLowerCase(),o=J[s],a=n._browserEventEquivalents[t];o?o.unregister(e,t,i,r):a?e.removeEventListener(a,i,r):e.removeEventListener(t,i,r)},_initEventImpl:function(e,t,i){i=i.toLowerCase();var n=j[i];if(n)switch(e.toLowerCase()){case"pointer":arguments[2]=n.mspointer;break;default:arguments[2]=n[e.toLowerCase()]}t["init"+e+"Event"].apply(t,Array.prototype.slice.call(arguments,2))},_initMouseEvent:function(e){this._initEventImpl.apply(this,["Mouse",e].concat(Array.prototype.slice.call(arguments,1)))},_initPointerEvent:function(e){this._initEventImpl.apply(this,["Pointer",e].concat(Array.prototype.slice.call(arguments,1)))},_PointerEventProxy:q,_bubbleEvent:b,_setPointerCapture:function(e,t){e.setPointerCapture&&e.setPointerCapture(t)},_releasePointerCapture:function(e,t){e.releasePointerCapture&&e.releasePointerCapture(t)},_MSPointerEvent:U,_zoomToDuration:F,_zoomTo:function(e,i){e.msZoomTo?e.msZoomTo(i):o.schedule(function(){var r=T(e),s="number"==typeof e._zoomToDestX?e._zoomToDestX:r.scrollLeft,o="number"==typeof e._zoomToDestY?e._zoomToDestY:r.scrollTop,a=t.getComputedStyle(e),l=e.scrollWidth-parseInt(a.width,10)-parseInt(a.paddingLeft,10)-parseInt(a.paddingRight,10),c=e.scrollHeight-parseInt(a.height,10)-parseInt(a.paddingTop,10)-parseInt(a.paddingBottom,10);"number"!=typeof i.contentX&&(i.contentX=s),"number"!=typeof i.contentY&&(i.contentY=o);var u=m(i.contentX,0,l),d=m(i.contentY,0,c);if(u!==s||d!==o){e._zoomToId=e._zoomToId||0,e._zoomToId++,e._zoomToDestX=u,e._zoomToDestY=d;var h=e._zoomToId,_=n._now(),p=(e._zoomToDestX-r.scrollLeft)/F,f=(e._zoomToDestY-r.scrollTop)/F,g=function(){var t=n._now()-_;e._zoomToId===h&&(t>F?(A(e,e._zoomToDestX,e._zoomToDestY),e._zoomToDestX=null,e._zoomToDestY=null):(A(e,r.scrollLeft+t*p,r.scrollTop+t*f),n._requestAnimationFrame(g)))};n._requestAnimationFrame(g)}},o.Priority.high,null,"WinJS.Utilities._zoomTo")},_setActive:function(e,i){var n=!0;try{if(t.HTMLElement&&t.HTMLElement.prototype.setActive)e.setActive();else{var r,s;i&&(r=i.scrollLeft,s=i.scrollTop),e.focus(),i&&(i.scrollLeft=r,i.scrollTop=s)}}catch(o){n=!1}return n},_MutationObserver:Y,_resizeNotifier:{get:function(){return Z||(Z=new X),Z}},_GenericListener:Q,_globalListener:new Q("Global",t,{registerThruWinJSCustomEvents:!0}),_documentElementListener:new Q("DocumentElement",t.document.documentElement,{registerThruWinJSCustomEvents:!0}),_inputPaneListener:r.Windows.UI.ViewManagement.InputPane?new Q("InputPane",r.Windows.UI.ViewManagement.InputPane.getForCurrentView()):{addEventListener:function(){},removeEventListener:function(){}},_addInsertedNotifier:function(i){var r=t.document.createElement("div");return r.style[n._browserStyleEquivalents["animation-name"].scriptName]="WinJS-node-inserted",r.style[n._browserStyleEquivalents["animation-duration"].scriptName]="0.01s",r.style.position="absolute",i.appendChild(r),e._addEventListener(r,"animationStart",function(e){if("WinJS-node-inserted"===e.animationName){var e=t.document.createEvent("Event");e.initEvent("WinJSNodeInserted",!1,!0),i.dispatchEvent(e)}},!1),r},_setFlexStyle:function(e,t){var i=e.style;"undefined"!=typeof t.grow&&(i.msFlexPositive=t.grow,i.webkitFlexGrow=t.grow,i.flexGrow=t.grow),"undefined"!=typeof t.shrink&&(i.msFlexNegative=t.shrink,i.webkitFlexShrink=t.shrink,i.flexShrink=t.shrink),"undefined"!=typeof t.basis&&(i.msFlexPreferredSize=t.basis,i.webkitFlexBasis=t.basis,i.flexBasis=t.basis)},Key:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,deleteKey:46,num0:48,num1:49,num2:50,num3:51,num4:52,num5:53,num6:54,num7:55,num8:56,num9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindows:91,rightWindows:92,menu:93,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,numLock:144,scrollLock:145,browserBack:166,browserForward:167,semicolon:186,equal:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222,IME:229},data:function(e){return e[ot]||(e[ot]={}),e[ot]},hasClass:function(e,t){if(e.classList)return e.classList.contains(t);for(var i=l(e),n=i.trim().split(" "),r=n.length,s=0;r>s;s++)if(n[s]===t)return!0;return!1},addClass:u,removeClass:d,toggleClass:h,_setAttribute:_,getRelativeLeft:function(e,t){if(!e)return 0;for(var i=e.offsetLeft,n=e.parentNode;n&&(i-=n.offsetLeft,n!==t);)n=n.parentNode;return i},getRelativeTop:function(e,t){if(!e)return 0;for(var i=e.offsetTop,n=e.parentNode;n&&(i-=n.offsetTop,n!==t);)n=n.parentNode;return i},getScrollPosition:M,setScrollPosition:B,empty:function(e){if(e.childNodes&&e.childNodes.length>0)for(var t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes.item(t));return e},_isDOMElement:function(e){return e&&"object"==typeof e&&"string"==typeof e.tagName},getContentWidth:function(e){var t=f(e,"borderLeftWidth")+f(e,"borderRightWidth"),i=f(e,"paddingLeft")+f(e,"paddingRight");return e.offsetWidth-t-i},getTotalWidth:function(e){var t=f(e,"marginLeft")+f(e,"marginRight");return e.offsetWidth+t},getContentHeight:function(e){var t=f(e,"borderTopWidth")+f(e,"borderBottomWidth"),i=f(e,"paddingTop")+f(e,"paddingBottom");return e.offsetHeight-t-i},getTotalHeight:function(e){var t=f(e,"marginTop")+f(e,"marginBottom");return e.offsetHeight+t},getPosition:function(e){for(var i=e,n=e.offsetParent,r=e.offsetTop,s=e.offsetLeft;(e=e.parentNode)&&e!==t.document.body&&e!==t.document.documentElement;){r-=e.scrollTop;var o=t.document.defaultView.getComputedStyle(e,null).direction;s-="rtl"!==o?e.scrollLeft:-T(e).scrollLeft,e===n&&(r+=e.offsetTop,s+=e.offsetLeft,n=e.offsetParent)}return{left:s,top:r,width:i.offsetWidth,height:i.offsetHeight}},getTabIndex:function(e){var t=/BUTTON|COMMAND|MENUITEM|OBJECT|SELECT|TEXTAREA/;if(e.disabled)return-1;var i=e.getAttribute("tabindex");if(null===i||void 0===i){var n=e.tagName;return t.test(n)||e.href&&("A"===n||"AREA"===n||"LINK"===n)||"INPUT"===n&&"hidden"!==e.type||"TH"===n&&e.sorted?0:-1}return parseInt(i,10)},convertToPixels:p,eventWithinElement:function(e,t){var i=t.relatedTarget;return i&&i!==e?e.contains(i):!1},_deprecated:function(e){t.console&&t.console.warn(e)},_syncRenderer:function(e,i){if(i=i||"div","function"==typeof e)return function(t,i){return i?(i.appendChild(e(t)),i):e(t)};var n;return"function"==typeof e.render?n=e:e.winControl&&"function"==typeof e.winControl.render&&(n=e.winControl),function(e,r){var s=r||t.document.createElement(i);if(n.render(e,s),r)return r;var o=s.firstElementChild;if(o&&s.dispose){var a=o.dispose;o.dispose=function(){o.dispose=a,s.appendChild(o),s.dispose()}}return o}},_getHighAndLowTabIndices:function(e){for(var t=e.getElementsByTagName("*"),i=0,n=0,r=!1,s=0,o=t.length;o>s;s++){var a=t[s].getAttribute("tabIndex");if(null!==a&&void 0!==a){var l=parseInt(a,10);l>0&&(i>l||0===i)&&(i=l),r||(0===l?(r=!0,n=0):l>n&&(n=l))}}return{highest:n,lowest:i}},_getLowestTabIndexInList:function(e){for(var t,i=0,n=0;n<e.length;n++)t=parseInt(e[n].getAttribute("tabIndex"),10),t>0&&(i>t||!i)&&(i=t);return i},_getHighestTabIndexInList:function(e){for(var t,i=0,n=0;n<e.length;n++){if(t=parseInt(e[n].getAttribute("tabIndex"),10),0===t)return t;t>i&&(i=t)}return i},_reparentChildren:function(e,t){for(var i=e.firstChild;i;){var n=i.nextSibling;t.appendChild(i),i=n}},_trySetActive:function(e,t){return this._tryFocus(e,!0,t)},_tryFocus:function(i,n,r){var s=t.document.activeElement;if(i===s)return!0;var o=e.getTabIndex(i)>=0;return o?(n?e._setActive(i,r):i.focus(),s!==t.document.activeElement?!0:!1):!1},_setActiveFirstFocusableElement:function(e,t){return this._focusFirstFocusableElement(e,!0,t)},_focusFirstFocusableElement:function(e,t,i){for(var n,r=e.getElementsByTagName("*"),s=this._getLowestTabIndexInList(r),o=0;s;){for(n=0;n<r.length;n++)if(r[n].tabIndex===s){if(this._tryFocus(r[n],t,i))return!0}else s<r[n].tabIndex&&(r[n].tabIndex<o||0===o)&&(o=r[n].tabIndex);s=o,o=0}for(n=0;n<r.length;n++)if(this._tryFocus(r[n],t,i))return!0;return!1},_setActiveLastFocusableElement:function(e,t){return this._focusLastFocusableElement(e,!0,t)},_focusLastFocusableElement:function(e,t,i){var n,r=e.getElementsByTagName("*"),s=this._getHighestTabIndexInList(r),o=0;if(0===s){for(n=r.length-1;n>=0;n--)if(r[n].tabIndex===s){if(this._tryFocus(r[n],t,i))return!0}else o<r[n].tabIndex&&(o=r[n].tabIndex);s=o,o=0}for(;s;){for(n=r.length-1;n>=0;n--)if(r[n].tabIndex===s){if(this._tryFocus(r[n],t,i))return!0}else o<r[n].tabIndex&&r[n].tabIndex<s&&(o=r[n].tabIndex);s=o,o=0}for(n=r.length-2;n>0;n--)if(this._tryFocus(r[n],t,i))return!0;return!1}})}}),define("WinJS/Utilities/_Dispose",["exports","../Core/_Base","../Core/_WriteProfilerMark","./_ElementUtilities"],function(e,t,i,n){"use strict";function r(e,t){var i=!1;n.addClass(e,"win-disposable");var r=e.winControl||e;r.dispose=function(){i||(i=!0,s(e),t&&t())}}function s(e){if(e){i("WinJS.Utilities.disposeSubTree,StartTM");for(var t=e.querySelectorAll(".win-disposable"),n=0,r=t.length;r>n;){var s=t[n];s.winControl&&s.winControl.dispose&&s.winControl.dispose(),s.dispose&&s.dispose(),n+=s.querySelectorAll(".win-disposable").length+1}i("WinJS.Utilities.disposeSubTree,StopTM")}}function o(e){if(e){var t=!1;e.winControl&&e.winControl.dispose&&(e.winControl.dispose(),t=!0),e.dispose&&(e.dispose(),t=!0),t||s(e)}}t.Namespace._moduleDefine(e,"WinJS.Utilities",{markDisposable:r,disposeSubTree:s,_disposeElement:o})}),define("WinJS/ControlProcessor/_OptionsLexer",["exports","../Core/_Base"],function optionsLexerInit(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_optionsLexer:_Base.Namespace._lazy(function(){function reservedWord(e){return{type:tokenType.reservedWord,value:e,length:e.length,keyword:!0}}function reservedWordLookup(e){switch(e.charCodeAt(0)){case 98:switch(e){case"break":return reservedWord(e)}break;case 99:switch(e){case"case":case"catch":case"class":case"const":case"continue":return reservedWord(e)}break;case 100:switch(e){case"debugger":case"default":case"delete":case"do":return reservedWord(e)}break;case 101:switch(e){case"else":case"enum":case"export":case"extends":return reservedWord(e)}break;case 102:switch(e){case"false":return tokens.falseLiteral;case"finally":case"for":case"function":return reservedWord(e)}break;case 105:switch(e){case"if":case"import":case"in":case"instanceof":return reservedWord(e)}break;case 110:switch(e){case"null":return tokens.nullLiteral;case"new":return reservedWord(e)}break;case 114:switch(e){case"return":return reservedWord(e)}break;case 115:switch(e){case"super":case"switch":return reservedWord(e)}break;case 116:switch(e){case"true":return tokens.trueLiteral;case"this":return tokens.thisKeyword;case"throw":case"try":case"typeof":return reservedWord(e)}break;case 118:switch(e){case"var":case"void":return reservedWord(e)}break;case 119:switch(e){case"while":case"with":return reservedWord(e)}}}var tokenType={leftBrace:1,rightBrace:2,leftBracket:3,rightBracket:4,separator:5,colon:6,semicolon:7,comma:8,dot:9,nullLiteral:10,trueLiteral:11,falseLiteral:12,numberLiteral:13,stringLiteral:14,identifier:15,reservedWord:16,thisKeyword:17,leftParentheses:18,rightParentheses:19,eof:20,error:21},tokens={leftBrace:{type:tokenType.leftBrace,length:1},rightBrace:{type:tokenType.rightBrace,length:1},leftBracket:{type:tokenType.leftBracket,length:1},rightBracket:{type:tokenType.rightBracket,length:1},colon:{type:tokenType.colon,length:1},semicolon:{type:tokenType.semicolon,length:1},comma:{type:tokenType.comma,length:1},dot:{type:tokenType.dot,length:1},nullLiteral:{type:tokenType.nullLiteral,length:4,value:null,keyword:!0},trueLiteral:{type:tokenType.trueLiteral,length:4,value:!0,keyword:!0},falseLiteral:{type:tokenType.falseLiteral,length:5,value:!1,keyword:!0},thisKeyword:{type:tokenType.thisKeyword,length:4,value:"this",keyword:!0},leftParentheses:{type:tokenType.leftParentheses,length:1},rightParentheses:{type:tokenType.rightParentheses,length:1},eof:{type:tokenType.eof,length:0}},lexer=function(){function isIdentifierStartCharacter(e,t,i,n){switch(e){case e>=97&&122>=e&&e:case e>=65&&90>=e&&e:case 36:case 95:return!0;case isWhitespace(e)&&e:case isLineTerminator(e)&&e:return!1;case e>127&&e:return!0;case 92:return n>i+4&&117===t.charCodeAt(i)&&isHexDigit(t.charCodeAt(i+1))&&isHexDigit(t.charCodeAt(i+2))&&isHexDigit(t.charCodeAt(i+3))&&isHexDigit(t.charCodeAt(i+4))?!0:!1;default:return!1}}function readIdentifierPart(e,t,i){for(var n=!1;i>t;){var r=e.charCodeAt(t);switch(r){case r>=97&&122>=r&&r:case r>=65&&90>=r&&r:case 36:case 95:break;case isWhitespace(r)&&r:case isLineTerminator(r)&&r:return n?-t:t;case r>127&&r:break;case r>=48&&57>=r&&r:break;case 92:if(i>t+5&&117===e.charCodeAt(t+1)&&isHexDigit(e.charCodeAt(t+2))&&isHexDigit(e.charCodeAt(t+3))&&isHexDigit(e.charCodeAt(t+4))&&isHexDigit(e.charCodeAt(t+5))){t+=5,n=!0;break}return n?-t:t;default:return n?-t:t}t++}return n?-t:t}function readIdentifierToken(e,t,i){var n=t;t=readIdentifierPart(e,t,i);var r=!1;0>t&&(t=-t,r=!0);var s=e.substr(n,t-n);r&&(s=""+JSON.parse('"'+s+'"'));var o=reservedWordLookup(s);return o?o:{type:tokenType.identifier,length:t-n,value:s}}function isHexDigit(e){switch(e){case e>=48&&57>=e&&e:case e>=97&&102>=e&&e:case e>=65&&70>=e&&e:return!0;default:return!1}}function readHexIntegerLiteral(e,t,i){for(;i>t&&isHexDigit(e.charCodeAt(t));)t++;return t}function isDecimalDigit(e){switch(e){case e>=48&&57>=e&&e:return!0;default:return!1}}function readDecimalDigits(e,t,i){for(;i>t&&isDecimalDigit(e.charCodeAt(t));)t++;return t}function readDecimalLiteral(e,t,i){if(t=readDecimalDigits(e,t,i),i>t&&46===e.charCodeAt(t)&&i>t+1&&isDecimalDigit(e.charCodeAt(t+1))&&(t=readDecimalDigits(e,t+2,i)),i>t){var n=e.charCodeAt(t);if(101===n||69===n){var r=t+1;i>r&&(n=e.charCodeAt(r),(43===n||45===n)&&r++,t=readDecimalDigits(e,r,i))}}return t}function readDecimalLiteralToken(e,t,i,n){var i=readDecimalLiteral(e,i,n),r=i-t;return{type:tokenType.numberLiteral,length:r,value:+e.substr(t,r)}}function isLineTerminator(e){switch(e){case 10:case 13:case 8232:case 8233:return!0;default:return!1}}function readStringLiteralToken(text,offset,limit){var startOffset=offset,quoteCharCode=text.charCodeAt(offset),hasEscape=!1;for(offset++;limit>offset&&!isLineTerminator(text.charCodeAt(offset));){if(limit>offset+1&&92===text.charCodeAt(offset))switch(hasEscape=!0,text.charCodeAt(offset+1)){case quoteCharCode:case 92:case 10:case 8232:case 8233:offset+=2;continue;case 13:offset+=limit>offset+2&&10===text.charCodeAt(offset+2)?3:2;continue}if(offset++,text.charCodeAt(offset-1)===quoteCharCode)break}var length=offset-startOffset;hasEscape=hasEscape||1===length||text.charCodeAt(offset-1)!==quoteCharCode;var stringValue;return stringValue=hasEscape?eval(text.substr(startOffset,length)):text.substr(startOffset+1,length-2),{type:tokenType.stringLiteral,length:length,value:stringValue}}function isWhitespace(e){switch(e){case 9:case 11:case 12:case 32:case 160:case 65279:return!0;case 5760>e&&e:return!1;case 5760:case 6158:case e>=8192&&8202>=e&&e:case 8239:case 8287:case 12288:return!0;default:return!1}}function readWhitespace(e,t,i){for(;i>t;){var n=e.charCodeAt(t);switch(n){case 9:case 11:case 12:case 32:case 160:case 65279:break;case 5760>n&&n:return t;case 5760:case 6158:case n>=8192&&8202>=n&&n:case 8239:case 8287:case 12288:break;default:return t}t++}return t}function lex(e,t,i,n){for(;n>i;){var r,s=i,o=t.charCodeAt(i++);switch(o){case isWhitespace(o)&&o:case isLineTerminator(o)&&o:i=readWhitespace(t,i,n),r={type:tokenType.separator,length:i-s};continue;case 34:case 39:r=readStringLiteralToken(t,i-1,n);break;case 40:r=tokens.leftParentheses;break;case 41:r=tokens.rightParentheses;break;case 43:case 45:if(n>i){var a=t.charCodeAt(i);if(46===a){var l=i+1;if(n>l&&isDecimalDigit(t.charCodeAt(l))){r=readDecimalLiteralToken(t,s,l,n);break}}else if(isDecimalDigit(a)){r=readDecimalLiteralToken(t,s,i,n);break}}r={type:tokenType.error,length:i-s,value:t.substring(s,i)};break;case 44:r=tokens.comma;break;case 46:r=tokens.dot,n>i&&isDecimalDigit(t.charCodeAt(i))&&(r=readDecimalLiteralToken(t,s,i,n));break;case 48:var c=n>i?t.charCodeAt(i):0;if(120===c||88===c){var u=readHexIntegerLiteral(t,i+1,n);r={type:tokenType.numberLiteral,length:u-s,value:+t.substr(s,u-s)}}else r=readDecimalLiteralToken(t,s,i,n);break;case o>=49&&57>=o&&o:r=readDecimalLiteralToken(t,s,i,n);break;case 58:r=tokens.colon;break;case 59:r=tokens.semicolon;break;case 91:r=tokens.leftBracket;break;case 93:r=tokens.rightBracket;break;case 123:r=tokens.leftBrace;break;case 125:r=tokens.rightBrace;break;default:if(isIdentifierStartCharacter(o,t,i,n)){r=readIdentifierToken(t,i-1,n);break}r={type:tokenType.error,length:i-s,value:t.substring(s,i)}}i+=r.length-1,e.push(r)}}return function(e){var t=[];
return lex(t,e,0,e.length),t.push(tokens.eof),t}}();return lexer.tokenType=tokenType,lexer})})}),define("WinJS/ControlProcessor/_OptionsParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","./_OptionsLexer"],function(e,t,i,n,r,s){"use strict";function o(){throw"Illegal"}function a(e){for(var t=Object.keys(c.tokenType),i=0,n=t.length;n>i;i++)if(e===c.tokenType[t[i]])return t[i];return"<unknown>"}var l={get invalidOptionsRecord(){return"Invalid options record: '{0}', expected to be in the format of an object literal. {1}"},get unexpectedTokenExpectedToken(){return"Unexpected token: {0}, expected token: {1}, at offset {2}"},get unexpectedTokenExpectedTokens(){return"Unexpected token: {0}, expected one of: {1}, at offset {2}"},get unexpectedTokenGeneric(){return"Unexpected token: {0}, at offset {1}"}},c=t.Namespace.defineWithParent(null,null,{lexer:t.Namespace._lazy(function(){return s._optionsLexer}),tokenType:t.Namespace._lazy(function(){return s._optionsLexer.tokenType})}),u=i.requireSupportedForProcessing,d=t.Namespace.defineWithParent(null,null,{BaseInterpreter:t.Namespace._lazy(function(){return t.Class.define(null,{_error:function(e){throw new n("WinJS.UI.ParseError",e)},_currentOffset:function(){for(var e=this._pos,t=0,i=0;e>i;i++)t+=this._tokens[i].length;return t},_evaluateAccessExpression:function(e){switch(this._current.type){case c.tokenType.dot:switch(this._read(),this._current.type){case c.tokenType.identifier:case this._current.keyword&&this._current.type:var t=this._current.value;return this._read(),e[t];default:this._unexpectedToken(c.tokenType.identifier,c.tokenType.reservedWord)}return;case c.tokenType.leftBracket:this._read();var i=this._evaluateValue();return this._read(c.tokenType.rightBracket),e[i]}},_evaluateAccessExpressions:function(e){for(;;)switch(this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:e=this._evaluateAccessExpression(e);break;default:return e}},_evaluateIdentifier:function(e,t){var i=this._readIdentifier();return t=e?t[i]:this._context[i]},_evaluateIdentifierExpression:function(){var e=this._evaluateIdentifier(!1);switch(this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:return this._evaluateAccessExpressions(e);default:return e}},_initialize:function(e,t,i,n){this._originalSource=t,this._tokens=e,this._context=i,this._functionContext=n,this._pos=0,this._current=this._tokens[0]},_read:function(e){e&&this._current.type!==e&&this._unexpectedToken(e),this._current!==c.tokenType.eof&&(this._current=this._tokens[++this._pos])},_peek:function(e){return e&&this._current.type!==e?void 0:this._current!==c.tokenType.eof?this._tokens[this._pos+1]:void 0},_readAccessExpression:function(e){switch(this._current.type){case c.tokenType.dot:switch(this._read(),this._current.type){case c.tokenType.identifier:case this._current.keyword&&this._current.type:e.push(this._current.value),this._read();break;default:this._unexpectedToken(c.tokenType.identifier,c.tokenType.reservedWord)}return;case c.tokenType.leftBracket:return this._read(),e.push(this._evaluateValue()),void this._read(c.tokenType.rightBracket)}},_readAccessExpressions:function(e){for(;;)switch(this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:this._readAccessExpression(e);break;default:return}},_readIdentifier:function(){var e=this._current.value;return this._read(c.tokenType.identifier),e},_readIdentifierExpression:function(){var e=[];switch(this._peek(c.tokenType.thisKeyword)&&0===e.length?this._read():e.push(this._readIdentifier()),this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:this._readAccessExpressions(e)}return e},_unexpectedToken:function(e){var t=this._current.type===c.tokenType.error?"'"+this._current.value+"'":a(this._current.type);if(e)if(1===arguments.length)e=a(e),this._error(r._formatString(l.unexpectedTokenExpectedToken,t,e,this._currentOffset()));else{for(var i=[],n=0,s=arguments.length;s>n;n++)i.push(a(arguments[n]));e=i.join(", "),this._error(r._formatString(l.unexpectedTokenExpectedTokens,t,e,this._currentOffset()))}else this._error(r._formatString(l.unexpectedTokenGeneric,t,this._currentOffset()))}},{supportedForProcessing:!1})}),OptionsInterpreter:t.Namespace._lazy(function(){return t.Class.derive(d.BaseInterpreter,function(e,t,i,n){this._initialize(e,t,i,n)},{_error:function(e){throw new n("WinJS.UI.ParseError",r._formatString(l.invalidOptionsRecord,this._originalSource,e))},_evaluateArrayLiteral:function(){var e=[];return this._read(c.tokenType.leftBracket),this._readArrayElements(e),this._read(c.tokenType.rightBracket),e},_evaluateObjectLiteral:function(){var e={};return this._read(c.tokenType.leftBrace),this._readObjectProperties(e),this._tryReadComma(),this._read(c.tokenType.rightBrace),e},_evaluateOptionsLiteral:function(){var e=this._evaluateValue();return this._current.type!==c.tokenType.eof&&this._unexpectedToken(c.tokenType.eof),e},_peekValue:function(){switch(this._current.type){case c.tokenType.falseLiteral:case c.tokenType.nullLiteral:case c.tokenType.stringLiteral:case c.tokenType.trueLiteral:case c.tokenType.numberLiteral:case c.tokenType.leftBrace:case c.tokenType.leftBracket:case c.tokenType.identifier:return!0;default:return!1}},_evaluateValue:function(){switch(this._current.type){case c.tokenType.falseLiteral:case c.tokenType.nullLiteral:case c.tokenType.stringLiteral:case c.tokenType.trueLiteral:case c.tokenType.numberLiteral:var e=this._current.value;return this._read(),e;case c.tokenType.leftBrace:return this._evaluateObjectLiteral();case c.tokenType.leftBracket:return this._evaluateArrayLiteral();case c.tokenType.identifier:return u(this._peek(c.tokenType.identifier).type===c.tokenType.leftParentheses?this._evaluateObjectQueryExpression():this._evaluateIdentifierExpression());default:this._unexpectedToken(c.tokenType.falseLiteral,c.tokenType.nullLiteral,c.tokenType.stringLiteral,c.tokenType.trueLiteral,c.tokenType.numberLiteral,c.tokenType.leftBrace,c.tokenType.leftBracket,c.tokenType.identifier)}},_tryReadElement:function(e){return this._peekValue()?(e.push(this._evaluateValue()),!0):!1},_tryReadComma:function(){return this._peek(c.tokenType.comma)?(this._read(),!0):!1},_tryReadElision:function(e){for(var t=!1;this._tryReadComma();)e.push(void 0),t=!0;return t},_readArrayElements:function(e){for(;!this._peek(c.tokenType.rightBracket);){var t=this._tryReadElision(e),i=this._tryReadElement(e),n=this._peek(c.tokenType.comma);if(!i||!n){if(i||t)break;this._unexpectedToken(c.tokenType.falseLiteral,c.tokenType.nullLiteral,c.tokenType.stringLiteral,c.tokenType.trueLiteral,c.tokenType.numberLiteral,c.tokenType.leftBrace,c.tokenType.leftBracket,c.tokenType.identifier);break}this._read()}},_readObjectProperties:function(e){for(;!this._peek(c.tokenType.rightBrace);){var t=this._tryReadObjectProperty(e),i=this._peek(c.tokenType.comma);if(!t||!i){if(t)break;this._unexpectedToken(c.tokenType.numberLiteral,c.tokenType.stringLiteral,c.tokenType.identifier);break}this._read()}},_tryReadObjectProperty:function(e){switch(this._current.type){case c.tokenType.numberLiteral:case c.tokenType.stringLiteral:case c.tokenType.identifier:case this._current.keyword&&this._current.type:var t=this._current.value;return this._read(),this._read(c.tokenType.colon),e[t]=this._evaluateValue(),!0;default:return!1}},_failReadObjectProperty:function(){this._unexpectedToken(c.tokenType.numberLiteral,c.tokenType.stringLiteral,c.tokenType.identifier,c.tokenType.reservedWord)},_evaluateObjectQueryExpression:function(){var e=this._current.value;this._read(c.tokenType.identifier),this._read(c.tokenType.leftParentheses);var t=this._current.value;this._read(c.tokenType.stringLiteral),this._read(c.tokenType.rightParentheses);var i=u(this._functionContext[e])(t);switch(this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:return this._evaluateAccessExpressions(i);default:return i}},run:function(){return this._evaluateOptionsLiteral()}},{supportedForProcessing:!1})}),OptionsParser:t.Namespace._lazy(function(){return t.Class.derive(d.OptionsInterpreter,function(e,t){this._initialize(e,t)},{_evaluateAccessExpression:o,_evaluateAccessExpressions:o,_evaluateIdentifier:o,_evaluateIdentifierExpression:o,_evaluateObjectQueryExpression:o,_evaluateValue:function(){switch(this._current.type){case c.tokenType.falseLiteral:case c.tokenType.nullLiteral:case c.tokenType.stringLiteral:case c.tokenType.trueLiteral:case c.tokenType.numberLiteral:var e=this._current.value;return this._read(),e;case c.tokenType.leftBrace:return this._evaluateObjectLiteral();case c.tokenType.leftBracket:return this._evaluateArrayLiteral();case c.tokenType.identifier:return this._peek(c.tokenType.identifier).type===c.tokenType.leftParentheses?this._readObjectQueryExpression():this._readIdentifierExpression();default:this._unexpectedToken(c.tokenType.falseLiteral,c.tokenType.nullLiteral,c.tokenType.stringLiteral,c.tokenType.trueLiteral,c.tokenType.numberLiteral,c.tokenType.leftBrace,c.tokenType.leftBracket,c.tokenType.identifier)}},_readIdentifierExpression:function(){var e=d.BaseInterpreter.prototype._readIdentifierExpression.call(this);return new p(e)},_readObjectQueryExpression:function(){var e=this._current.value;this._read(c.tokenType.identifier),this._read(c.tokenType.leftParentheses);var t=this._current.value;this._read(c.tokenType.stringLiteral),this._read(c.tokenType.rightParentheses);var i=new m(e,t);switch(this._current.type){case c.tokenType.dot:case c.tokenType.leftBracket:var n=[i];return this._readAccessExpressions(n),new p(n);default:return i}}},{supportedForProcessing:!1})})}),h=function(e,t,i){var n=c.lexer(e),r=new d.OptionsInterpreter(n,e,t||{},i||{});return r.run()};Object.defineProperty(h,"_BaseInterpreter",{get:function(){return d.BaseInterpreter}});var _=function(e){var t=c.lexer(e),i=new d.OptionsParser(t,e);return i.run()},m=t.Class.define(function(e,t){this.target=e,this.arg0Value=t});m.supportedForProcessing=!1;var p=t.Class.define(function(e){this.parts=e});p.supportedForProcessing=!1,t.Namespace._moduleDefine(e,"WinJS.UI",{optionsParser:h,_optionsParser:_,_CallExpression:m,_IdentifierExpression:p})}),define("WinJS/ControlProcessor",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_Resources","./Core/_WriteProfilerMark","./ControlProcessor/_OptionsParser","./Promise","./Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a,l,c){"use strict";function u(e){var i=function(i){for(var n,r=e;r;){if(r.msParentSelectorScope){var s=r.parentNode;if(s&&(n=c._matchesSelector(s,i)?s:s.querySelector(i)))break}r=r.parentNode}return n||t.document.querySelector(i)};return v(i)}function d(e,i){return new l(function(n,o){try{var l,c=e.getAttribute("data-win-options");c&&(l=a.optionsParser(c,t,{select:u(e)}));var d,h=1;i.length>2&&h++;var _=function(){h--,0===h&&(e.winControl=e.winControl||d,n(d))};d=new i(e,l,_),_()}catch(m){r.log&&r.log(s._formatString(g.errorActivatingControl,m&&m.message),"winjs controls","error"),o(m)}})}function h(e,i){return new l(function(n,r){o("WinJS.UI:processAll,StartTM"),e=e||t.document.body;var s=0,a="[data-win-control]",l=e.querySelectorAll(a),c=[];!i&&_(e)&&c.push(e);for(var u=0,h=l.length;h>u;u++)c.push(l[u]);if(0===c.length)return o("WinJS.UI:processAll,StopTM"),void n(e);for(var m=function(){s-=1,0>s&&(o("WinJS.UI:processAll,StopTM"),n(e))},f=new Array(c.length),u=0,h=c.length;h>u;u++){var g,v=c[u],b=v.winControl;b?g=b.constructor:f[u]=g=_(v),g&&g.isDeclarativeControlContainer&&(u+=v.querySelectorAll(a).length)}o("WinJS.UI:processAllActivateControls,StartTM");for(var u=0,h=c.length;h>u;u++){var C=f[u],v=c[u];if(C&&!v.winControl&&(s++,d(v,C).then(m,function(e){o("WinJS.UI:processAll,StopTM"),r(e)}),C.isDeclarativeControlContainer&&"function"==typeof C.isDeclarativeControlContainer)){var w=y(C.isDeclarativeControlContainer);w(v.winControl,p)}}o("WinJS.UI:processAllActivateControls,StopTM"),m()})}function _(e){if(e.getAttribute){var i=e.getAttribute("data-win-control");if(i)return n._getMemberFiltered(i.trim(),t,y)}}function m(e,t){return u(t)(e)}function p(e,t){return b?h(e,t):n.ready().then(function(){return b=!0,h(e,t)})}function f(e){if(e&&e.winControl)return l.as(e.winControl);var t=_(e);return t?d(e,t):l.as()}if(t.document){var g={get errorActivatingControl(){return"Error activating control: {0}"}},v=n.markSupportedForProcessing,y=n.requireSupportedForProcessing,b=!1;i.Namespace._moduleDefine(e,"WinJS.UI",{scopedSelect:m,processAll:p,process:f})}}),define("WinJS/Utilities/_ElementListUtilities",["exports","../Core/_Global","../Core/_Base","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o){"use strict";t.document&&i.Namespace._moduleDefine(e,"WinJS.Utilities",{QueryCollection:i.Class.derive(Array,function(e){e&&this.include(e)},{forEach:function(e,t){return Array.prototype.forEach.apply(this,[e,t]),this},get:function(e){return this[e]},setAttribute:function(e,t){return this.forEach(function(i){i.setAttribute(e,t)}),this},getAttribute:function(e){return this.length>0?this[0].getAttribute(e):void 0},addClass:function(e){return this.forEach(function(t){o.addClass(t,e)}),this},hasClass:function(e){return this.length>0?o.hasClass(this[0],e):!1},removeClass:function(e){return this.forEach(function(t){o.removeClass(t,e)}),this},toggleClass:function(e){return this.forEach(function(t){o.toggleClass(t,e)}),this},listen:function(e,t,i){return this.forEach(function(n){n.addEventListener(e,t,i)}),this},removeEventListener:function(e,t,i){return this.forEach(function(n){n.removeEventListener(e,t,i)}),this},setStyle:function(e,t){return this.forEach(function(i){i.style[e]=t}),this},clearStyle:function(e){return this.forEach(function(t){t.style[e]=""}),this},query:function(t){var i=new e.QueryCollection;return this.forEach(function(e){i.include(e.querySelectorAll(t))}),i},include:function(e){if("number"==typeof e.length)for(var t=0;t<e.length;t++)this.push(e[t]);else e.DOCUMENT_FRAGMENT_NODE&&e.nodeType===e.DOCUMENT_FRAGMENT_NODE?this.include(e.childNodes):this.push(e)},control:function(e,t){return e&&"function"==typeof e?this.forEach(function(i){i.winControl=new e(i,t)}):(t=e,this.forEach(function(e){n.process(e).done(function(e){e&&s.setOptions(e,t)})})),this},template:function(t,i,n){t instanceof e.QueryCollection&&(t=t[0]);var s=t.winControl;null!==i&&void 0!==i&&i.forEach||(i=[i]),n=n||function(){};var o=this,a=[];return i.forEach(function(e){o.forEach(function(t){a.push(s.render(e,t))})}),n(r.join(a)),this}},{supportedForProcessing:!1}),query:function(i,n){return new e.QueryCollection((n||t.document).querySelectorAll(i))},id:function(i){var n=t.document.getElementById(i);return new e.QueryCollection(n?[n]:[])},children:function(t){return new e.QueryCollection(t.children)}})}),define("WinJS/Utilities/_Hoverable",["exports","../Core/_Global"],function(e,t){"use strict";if(t.document&&(t.document.documentElement.classList.add("win-hoverable"),e.isHoverable=!0,!t.MSPointerEvent)){var i=function(){t.document.removeEventListener("touchstart",i),t.document.documentElement.classList.remove("win-hoverable"),e.isHoverable=!1};t.document.addEventListener("touchstart",i)}}),define("WinJS/Utilities/_ParallelWorkQueue",["exports","../Core/_Base","../Promise","../Scheduler"],function(e,t,i,n){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_ParallelWorkQueue:t.Namespace._lazy(function(){return t.Class.define(function(e){function t(){c--,u||n.schedule(r,n.Priority.normal,null,"WinJS._ParallelWorkQueue.runNext")}function r(){for(u++;e>c;c++){var i,n;do i=l.shift(),n=i&&a[i];while(i&&!n);if(!n)break;delete a[i];try{n().then(t,t)}catch(r){t()}}u--}function s(e,t,n){var s,c="w"+o++;return new i(function(i,o,u){var d=function(){return s=e().then(i,o,u)};d.data=t,a[c]=d,n?l.unshift(c):l.push(c),r()},function(){delete a[c],s&&s.cancel()})}var o=0,a={},l=[];e=e||3;var c=0,u=0;this.sort=function(e){l.sort(function(t,i){return t=a[t],i=a[i],void 0===t&&void 0===i?0:void 0===t?1:void 0===i?-1:e(t.data,i.data)})},this.queue=s},{},{supportedForProcessing:!1})})})}),define("WinJS/Utilities/_VersionManager",["exports","../Core/_Base","../_Signal"],function(e,t,i){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_VersionManager:t.Namespace._lazy(function(){return t.Class.define(function(){this._unlocked=new i,this._unlocked.complete()},{_cancelCount:0,_notificationCount:0,_updateCount:0,_version:0,locked:{get:function(){return 0!==this._notificationCount||0!==this._updateCount}},noOutstandingNotifications:{get:function(){return 0===this._notificationCount}},version:{get:function(){return this._version}},unlocked:{get:function(){return this._unlocked.promise}},_dispose:function(){this._unlocked&&(this._unlocked.cancel(),this._unlocked=null)},beginUpdating:function(){this._checkLocked(),this._updateCount++},endUpdating:function(){this._updateCount--,this._checkUnlocked()},beginNotifications:function(){this._checkLocked(),this._notificationCount++},endNotifications:function(){this._notificationCount--,this._checkUnlocked()},_checkLocked:function(){this.locked||(this._dispose(),this._unlocked=new i)},_checkUnlocked:function(){this.locked||this._unlocked.complete()},receivedNotification:function(){if(this._version++,this._cancel){var e=this._cancel;this._cancel=null,e.forEach(function(e){e&&e.cancel()})}},cancelOnNotification:function(e){return this._cancel||(this._cancel=[],this._cancelCount=0),this._cancel[this._cancelCount++]=e,this._cancelCount-1},clearCancelOnNotification:function(e){this._cancel&&delete this._cancel[e]}},{supportedForProcessing:!1})})})}),define("WinJS/Utilities/_ItemsManager",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../_Signal","../Scheduler","../Utilities/_ElementUtilities","./_ParallelWorkQueue","./_VersionManager"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";function _(e){return y(function(t,i){return t.then(function(t){return t?e(t,i):null})})}function m(e,t){var i=!1,n=!1;return e.isOnScreen().then(function(e){i=e}),t.isOnScreen().then(function(e){n=e}),(i?0:1)-(n?0:1)}function p(e){if(!/^blob:/i.test(e)&&(k[e]=!0,P.push(e),P.length>A)){var t=P;k={},P=[];for(var i=0,n=t.length-1;n>=0&&T>i;n--){var r=t[n];k[r]||(k[r]=!0,i++)}}}function f(e,i,n){var r=x++;return w=w||new d._ParallelWorkQueue(6),w.queue(function(){return new a(function(n,s){c.schedule(function(r){i||(i=t.document.createElement("img"));var o=k[e];o?(p(e),i.src=e,n(i)):r.setPromise(new a(function(r){var o=t.document.createElement("img"),a=function(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),i.src=e;var t=new Date;t-S>E&&(S=t,w.sort(m))},l=function(){r(u)},c=function(){r(d)},u=function(){p(e),a(),n(i)},d=function(){a(),s(i)};o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),o.src=e}))},c.Priority.normal,null,"WinJS.UI._ImageLoader._image"+r)})},n)}function g(e){return k[e]}function v(){return t.document.createElement("div")}var y=n.markSupportedForProcessing,b=u._uniqueID,C=_(function(e){if(u._isDOMElement(e.data))return e.data;var i=e.data;void 0===i?i="undefined":null===i?i="null":"object"==typeof i&&(i=JSON.stringify(i));var n=t.document.createElement("span");return n.textContent=i.toString(),n});i.Namespace._moduleDefine(e,"WinJS.UI",{_normalizeRendererReturn:function(e){if(e){if("object"==typeof e&&e.element){var t=a.as(e.element);return t.then(function(t){return{element:t,renderComplete:a.as(e.renderComplete)}})}var t=a.as(e);return t.then(function(e){return{element:e,renderComplete:a.as()}})}return{element:null,renderComplete:a.as()}},simpleItemRenderer:_,_trivialHtmlRenderer:C});var w,I={get listDataSourceIsInvalid(){return"Invalid argument: dataSource must be an object."},get itemRendererIsInvalid(){return"Invalid argument: itemRenderer must be a function."},get itemIsInvalid(){return"Invalid argument: item must be a DOM element that was returned by the Items Manager, and has not been replaced or released."}},S=new Date,E=64,x=0,k={},P=[],T=250,A=1e3;i.Namespace._moduleDefine(e,"WinJS.UI",{_seenUrl:p,_getSeenUrls:function(){return k},_getSeenUrlsMRU:function(){return P},_seenUrlsMaxSize:T,_seenUrlsMRUMaxSize:A}),i.Namespace._moduleDefine(e,"WinJS.UI",{_createItemsManager:i.Namespace._lazy(function(){var t=i.Class.define(function(e){this._itemsManager=e},{beginNotifications:function(){this._itemsManager._versionManager.beginNotifications(),this._itemsManager._beginNotifications()},inserted:function(e,t,i){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._inserted(e,t,i)},changed:function(e,t){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._changed(e,t)},moved:function(e,t,i){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._moved(e,t,i)},removed:function(e,t){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._removed(e,t)},countChanged:function(e,t){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._countChanged(e,t)},indexChanged:function(e,t,i){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._indexChanged(e,t,i)},affectedRange:function(e){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._affectedRange(e)},endNotifications:function(){this._itemsManager._versionManager.endNotifications(),this._itemsManager._endNotifications()},reload:function(){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._reload()}},{supportedForProcessing:!1}),n=i.Class.define(function(e,i,n,s){if(!e)throw new r("WinJS.UI.ItemsManager.ListDataSourceIsInvalid",I.listDataSourceIsInvalid);if(!i)throw new r("WinJS.UI.ItemsManager.ItemRendererIsInvalid",I.itemRendererIsInvalid);this.$pipeline_callbacksMap={},this._listDataSource=e,this.dataSource=this._listDataSource,this._elementNotificationHandler=n,this._listBinding=this._listDataSource.createListBinding(new t(this)),s&&(s.ownerElement&&(this._ownerElement=s.ownerElement),this._profilerId=s.profilerId,this._versionManager=s.versionManager||new h._VersionManager),this._indexInView=s&&s.indexInView,this._itemRenderer=i,this._viewCallsReady=s&&s.viewCallsReady,this._elementMap={},this._handleMap={},this._jobOwner=c.createOwnerToken(),this._notificationsSent=!1,this._listBinding.last&&(this.lastItem=function(){return this._elementForItem(this._listBinding.last())})},{_itemFromItemPromise:function(e){return this._waitForElement(this._elementForItem(e))},_itemFromItemPromiseThrottled:function(e){return this._waitForElement(this._elementForItem(e,!0))},_itemAtIndex:function(e){var t=this._itemPromiseAtIndex(e);this._itemFromItemPromise(t).then(null,function(e){return t.cancel(),a.wrapError(e)})},_itemPromiseAtIndex:function(e){return this._listBinding.fromIndex(e)},_waitForElement:function(e){var t=this;return new a(function(i){if(e)if(t.isPlaceholder(e)){var n=b(e),r=t.$pipeline_callbacksMap[n];r?r.push(i):t.$pipeline_callbacksMap[n]=[i]}else i(e);else i(e)})},_updateElement:function(e,t){var i=b(t),n=this.$pipeline_callbacksMap[i];n&&(delete this.$pipeline_callbacksMap[i],n.forEach(function(t){t(e)}))},_firstItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.first()))},_lastItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.last()))},_previousItem:function(e){return this._listBinding.jumpToItem(this._itemFromElement(e)),this._waitForElement(this._elementForItem(this._listBinding.previous()))},_nextItem:function(e){return this._listBinding.jumpToItem(this._itemFromElement(e)),this._waitForElement(this._elementForItem(this._listBinding.next()))},_itemFromPromise:function(e){return this._waitForElement(this._elementForItem(e))},isPlaceholder:function(e){return!!this._recordFromElement(e).elementIsPlaceholder},itemObject:function(e){return this._itemFromElement(e)},release:function(){this._listBinding.release(),this._elementNotificationHandler=null,this._listBinding=null,this._jobOwner.cancelAll(),this._released=!0},releaseItemPromise:function(e){var t=e.handle,i=this._handleMap[t];i?this._releaseRecord(i):e.cancel()},releaseItem:function(e){var t=this._elementMap[b(e)];this._releaseRecord(t)},_releaseRecord:function(e){e&&(e.renderPromise&&e.renderPromise.cancel(),e.itemPromise&&e.itemPromise.cancel(),e.imagePromises&&e.imagePromises.forEach(function(e){e.cancel()}),e.itemReadyPromise&&e.itemReadyPromise.cancel(),e.renderComplete&&e.renderComplete.cancel(),this._removeEntryFromElementMap(e.element),this._removeEntryFromHandleMap(e.itemPromise.handle,e),e.item&&this._listBinding.releaseItem(e.item))},refresh:function(){return this._listDataSource.invalidateAll()},_handlerToNotifyCaresAboutItemAvailable:function(){return!(!this._elementNotificationHandler||!this._elementNotificationHandler.itemAvailable)},_handlerToNotify:function(){return this._notificationsSent||(this._notificationsSent=!0,this._elementNotificationHandler&&this._elementNotificationHandler.beginNotifications&&this._elementNotificationHandler.beginNotifications()),this._elementNotificationHandler},_defineIndexProperty:function(e,t,i){i.indexObserved=!1,Object.defineProperty(e,"index",{get:function(){return i.indexObserved=!0,t.index}})},_renderPlaceholder:function(e){var t={},i=v(t);return e.elementIsPlaceholder=!0,i},_renderItem:function(t,i,n){function r(){t.then(function(e){s._writeProfilerMark(h+",StartTM"),u.complete(e),s._writeProfilerMark(h+",StopTM")})}var s=this,o=s._indexInView||function(){return!0},u=new l,d=new l,h="_renderItem("+i.item.index+"):itemPromise",_=!0,m=!1;t.then(function(e){m=!0,_&&u.complete(e)}),_=!1;var p=u.promise.then(function(e){if(e){var t=Object.create(e);return s._defineIndexProperty(t,e,i),t.ready=d.promise,t.isOnScreen=function(){return a.wrap(o(e.index))},t.loadImage=function(e,n){var r=f(e,n,t);return i.imagePromises?i.imagePromises.push(r):i.imagePromises=[r],r},t.isImageCached=g,t}return a.cancel});m||(n?(i.stage0=t,i.startStage1=function(){i.startStage1=null,r()}):r()),p.handle=t.handle,i.itemPromise=p,i.itemReadyPromise=d.promise,i.readyComplete=!1;var v="_renderItem("+i.item.index+(m?"):syncItemPromise":"):placeholder"),y="_renderItem("+i.item.index+"):itemReady";this._writeProfilerMark(v+",StartTM");var b=a.as(s._itemRenderer(p,i.element)).then(e._normalizeRendererReturn).then(function(e){return s._released?a.cancel:(p.then(function(e){if(i.pendingReady=function(){i.pendingReady&&(i.pendingReady=null,i.readyComplete=!0,s._writeProfilerMark(y+",StartTM"),d.complete(e),s._writeProfilerMark(y+",StopTM"))},!s._viewCallsReady){var t=c.schedule(i.pendingReady,c.Priority.normal,i,"WinJS.UI._ItemsManager._pendingReady");t.owner=s._jobOwner}}),e)});return this._writeProfilerMark(v+",StopTM"),b},_replaceElement:function(e,t){this._removeEntryFromElementMap(e.element),e.element=t,this._addEntryToElementMap(t,e)},_changeElement:function(e,t,i){e.renderPromise=null;var n=e.element,r=e.item;e.newItem&&(e.item=e.newItem,e.newItem=null),this._replaceElement(e,t),e.item&&e.elementIsPlaceholder&&!i?(e.elementDelayed=null,e.elementIsPlaceholder=!1,this._updateElement(e.element,n),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(e.element,n)):this._handlerToNotify().changed(t,n,r)},_elementForItem:function(e,t){var i,n=e.handle,r=this._recordFromHandle(n,!0);if(!n)return null;if(r)i=r.element;else{r={item:e,itemPromise:e},this._addEntryToHandleMap(n,r);var s=this,o=!1,a=!1,l=s._renderItem(e,r,t).then(function(t){var n=t.element;r.renderComplete=t.renderComplete,e.then(function(e){r.item=e,e||(o=!0,i=null)}),a=!0,r.renderPromise=null,n&&(i?s._presentElements(r,n):i=n)});o||(a||(r.renderPromise=l),i||(i=this._renderPlaceholder(r)),r.element=i,this._addEntryToElementMap(i,r),e.retain())}return i},_addEntryToElementMap:function(e,t){this._elementMap[b(e)]=t},_removeEntryFromElementMap:function(e){delete this._elementMap[b(e)]},_recordFromElement:function(e){var t=this._elementMap[b(e)];if(!t)throw this._writeProfilerMark("_recordFromElement:ItemIsInvalidError,info"),new r("WinJS.UI.ItemsManager.ItemIsInvalid",I.itemIsInvalid);return t},_addEntryToHandleMap:function(e,t){this._handleMap[e]=t},_removeEntryFromHandleMap:function(e){delete this._handleMap[e]},_handleInHandleMap:function(e){return!!this._handleMap[e]},_recordFromHandle:function(e,t){var i=this._handleMap[e];if(!i&&!t)throw new r("WinJS.UI.ItemsManager.ItemIsInvalid",I.itemIsInvalid);return i},_foreachRecord:function(e){var t=this._handleMap;for(var i in t){var n=t[i];e(n)}},_itemFromElement:function(e){return this._recordFromElement(e).item},_elementFromHandle:function(e){if(e){var t=this._recordFromHandle(e,!0);if(t&&t.element)return t.element}return null},_inserted:function(e,t,i){this._handlerToNotify().inserted(e,t,i)},_changed:function(e,t){if(this._handleInHandleMap(t.handle)){var i=this._recordFromHandle(t.handle);i.renderPromise&&i.renderPromise.cancel(),i.itemPromise&&i.itemPromise.cancel(),i.imagePromises&&i.imagePromises.forEach(function(e){e.cancel()}),i.itemReadyPromise&&i.itemReadyPromise.cancel(),i.renderComplete&&i.renderComplete.cancel(),i.newItem=e;var n=this,r=a.as(e);r.handle=i.itemPromise.handle,i.renderPromise=this._renderItem(r,i).then(function(e){i.renderComplete=e.renderComplete,n._changeElement(i,e.element,!1),n._presentElements(i)})}},_moved:function(e,t,i){var n=this._elementFromHandle(e.handle),r=this._elementFromHandle(t),s=this._elementFromHandle(i);this._handlerToNotify().moved(n,r,s,e),this._presentAllElements()},_removed:function(e,t){if(this._handleInHandleMap(e)){var i=this._elementFromHandle(e);this._handlerToNotify().removed(i,t,e),this.releaseItem(i),this._presentAllElements()}else this._handlerToNotify().removed(null,t,e)},_countChanged:function(e,t){this._elementNotificationHandler&&this._elementNotificationHandler.countChanged&&this._handlerToNotify().countChanged(e,t)},_indexChanged:function(e,t,i){var n;if(this._handleInHandleMap(e)){var r=this._recordFromHandle(e);if(r.indexObserved)if(r.elementIsPlaceholder)this._changeElement(r,this._renderPlaceholder(r),!0);else if(r.item.index!==t){r.renderPromise&&r.renderPromise.cancel(),r.renderComplete&&r.renderComplete.cancel();var s=r.newItem||r.item;s.index=t;var o=a.as(s);o.handle=r.itemPromise.handle;var l=this;r.renderPromise=this._renderItem(o,r).then(function(e){r.renderComplete=e.renderComplete,l._changeElement(r,e.element,!1),l._presentElements(r)})}n=r.element}this._elementNotificationHandler&&this._elementNotificationHandler.indexChanged&&this._handlerToNotify().indexChanged(n,t,i)},_affectedRange:function(e){this._elementNotificationHandler&&this._elementNotificationHandler.updateAffectedRange&&this._handlerToNotify().updateAffectedRange(e)},_beginNotifications:function(){this._externalBegin=!0,this._handlerToNotify()},_endNotifications:function(){this._notificationsSent&&(this._notificationsSent=!1,this._externalBegin=!1,this._elementNotificationHandler&&this._elementNotificationHandler.endNotifications&&this._elementNotificationHandler.endNotifications())},_reload:function(){this._elementNotificationHandler&&this._elementNotificationHandler.reload&&this._elementNotificationHandler.reload()},_postEndNotifications:function(){if(this._notificationsSent&&!this._externalBegin&&!this._endNotificationsPosted){this._endNotificationsPosted=!0;var e=this;c.schedule(function(){e._endNotificationsPosted=!1,e._endNotifications()},c.Priority.high,null,"WinJS.UI._ItemsManager._postEndNotifications")}},_presentElement:function(e){var t=e.element;this._replaceElement(e,e.elementDelayed),e.elementDelayed=null,e.elementIsPlaceholder=!1,this._updateElement(e.element,t),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(e.element,t)},_presentElements:function(e,t){t&&(e.elementDelayed=t),this._listBinding.jumpToItem(e.item),e.elementDelayed&&this._presentElement(e),this._postEndNotifications()
},_presentAllElements:function(){var e=this;this._foreachRecord(function(t){t.elementDelayed&&e._presentElement(t)})},_writeProfilerMark:function(e){var t="WinJS.UI._ItemsManager:"+(this._profilerId?this._profilerId+":":":")+e;o(t)}},{supportedForProcessing:!1});return function(e,t,i,r){return new n(e,t,i,r)}})})}),define("WinJS/Utilities/_TabContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","./_ElementUtilities"],function(e,t,i,n,r){"use strict";function s(e,i,n,r){var s=t.document.createEvent("UIEvent");return s.initUIEvent(i,!1,!!r,t,n?1:0),!e.dispatchEvent(s)}function o(e){var i=t.getComputedStyle(e);if("none"===i.display||"hidden"===i.visibility)return t.NodeFilter.FILTER_REJECT;if(e._tabContainer)return t.NodeFilter.FILTER_ACCEPT;if(e.parentNode&&e.parentNode._tabContainer){var n=e.parentNode._tabContainer.childFocus;return n&&e.contains(n)?c(e)>=0?t.NodeFilter.FILTER_ACCEPT:t.NodeFilter.FILTER_SKIP:t.NodeFilter.FILTER_REJECT}var r=c(e);return r>=0?t.NodeFilter.FILTER_ACCEPT:t.NodeFilter.FILTER_SKIP}function a(e){function t(){if(e.currentNode._tabContainer)r=r.concat(a(e));else if(c(e.currentNode)>=0&&r.push(e.currentNode),e.firstChild()){do t();while(e.nextSibling());e.parentNode()}}var i=e.currentNode,n=i._tabContainer.childFocus,r=[];return n?(e.currentNode=n,t(),e.currentNode=i,r):[]}function l(e,i){function n(){var e=t.document.createElement("DIV");return e.tabIndex=i?i:0,e.setAttribute("aria-hidden",!0),e}var r=e.parentNode,o=n();r.insertBefore(o,e);var a=n();r.insertBefore(a,e.nextSibling),o.addEventListener("focus",function(){s(e,"onTabEnter",!0)},!0),a.addEventListener("focus",function(){s(e,"onTabEnter",!1)},!0),this._catcherBegin=o,this._catcherEnd=a;var l=1;this.addRef=function(){l++},this.release=function(){return 0===--l&&(o.parentElement&&r.removeChild(o),a.parentElement&&r.removeChild(a)),l},this.updateTabIndex=function(e){o.tabIndex=e,a.tabIndex=e}}if(t.document){var c=r.getTabIndex,u={attach:function(e,t){return e["win-trackTabHelperObject"]?e["win-trackTabHelperObject"].addRef():e["win-trackTabHelperObject"]=new l(e,t),e["win-trackTabHelperObject"]},detach:function(e){e["win-trackTabHelperObject"].release()||delete e["win-trackTabHelperObject"]}};i.Namespace._moduleDefine(e,"WinJS.UI",{TrackTabBehavior:u,TabContainer:i.Class.define(function(e){this._element=e,this._tabIndex=0,e._tabContainer=this,null===e.getAttribute("tabindex")&&(e.tabIndex=-1);var t=this;e.addEventListener("onTabEnter",function(i){var n=s(t._element,"onTabEntered",i.detail,!0);n||(t.childFocus?t.childFocus.focus():e.focus())}),e.addEventListener("keydown",function(e){var i=e.target;if(e.keyCode===r.Key.tab){var o=!e.shiftKey,a=t._hasMoreElementsInTabOrder(i,o);if(!a){var l=s(t._element,"onTabExiting",o,!0);if(l)return e.stopPropagation(),void e.preventDefault();for(var c=t._element.querySelectorAll("a[href],area[href],button,command,input,link,menuitem,object,select,textarea,th[sorted],[tabindex]"),u=c.length,d=[],h=0;u>h;h++){var _=c[h];d.push(_.tabIndex),_.tabIndex=-1}t._elementTabHelper[o?"_catcherEnd":"_catcherBegin"].tabIndex=-1;var m=function(){i.removeEventListener("blur",m,!1);for(var e=0;u>e;e++)-1!==d[e]&&(c[e].tabIndex=d[e]);t._elementTabHelper._catcherBegin.tabIndex=t._tabIndex,t._elementTabHelper._catcherEnd.tabIndex=t._tabIndex};i.addEventListener("blur",m,!1),n._yieldForEvents(function(){s(t._element,"onTabExit",o)})}}}),this._elementTabHelper=u.attach(e,this._tabIndex),this._elementTabHelper._catcherBegin.tabIndex=0,this._elementTabHelper._catcherEnd.tabIndex=0},{dispose:function(){u.detach(this._element,this._tabIndex)},childFocus:{set:function(e){e!==this._focusElement&&(this._focusElement=e&&e.parentNode?e:null)},get:function(){return this._focusElement}},tabIndex:{set:function(e){this._tabIndex=e,this._elementTabHelper.updateTabIndex(e)},get:function(){return this._tabIndex}},_element:null,_skipper:function(e){e.stopPropagation(),e.preventDefault()},_hasMoreElementsInTabOrder:function(e,i){if(!this.childFocus)return!1;for(var n=t.document.createTreeWalker(this._element,t.NodeFilter.SHOW_ELEMENT,o,!1),r=a(n),s=0;s<r.length;s++)if(r[s]===e)return i?s<r.length-1:s>0;return!1},_focusElement:null},{supportedForProcessing:!1})})}}),define("WinJS/Utilities/_KeyboardBehavior",["exports","../Core/_Global","../Core/_Base","./_Control","./_ElementUtilities","./_TabContainer"],function(e,t,i,n,r,s){"use strict";if(t.document){var o=!1;r._addEventListener(t,"pointerdown",function(){o&&(o=!1)},!0),t.addEventListener("keydown",function(){o||(o=!0)},!0),i.Namespace._moduleDefine(e,"WinJS.UI",{_keyboardSeenLast:{get:function(){return o},set:function(e){o=e}},_WinKeyboard:function(t){r._addEventListener(t,"pointerdown",function(e){r.removeClass(e.target,"win-keyboard")},!0),t.addEventListener("keydown",function(e){r.addClass(e.target,"win-keyboard")},!0),r._addEventListener(t,"focusin",function(t){e._keyboardSeenLast&&r.addClass(t.target,"win-keyboard")},!1),r._addEventListener(t,"focusout",function(e){r.removeClass(e.target,"win-keyboard")},!1)},_KeyboardBehavior:i.Namespace._lazy(function(){var e=r.Key,o=i.Class.define(function(e,i){e=e||t.document.createElement("DIV"),i=i||{},e._keyboardBehavior=this,this._element=e,this._fixedDirection=o.FixedDirection.width,this._fixedSize=1,this._currentIndex=0,n.setOptions(this,i),this._tabContainer=new s.TabContainer(this.scroller||this._element),this._tabContainer.tabIndex=0,this._element.children.length>0&&(this._tabContainer.childFocus=this._getFocusInto(this._element.children[0])),this._element.addEventListener("keydown",this._keyDownHandler.bind(this)),r._addEventListener(this._element,"pointerdown",this._MSPointerDownHandler.bind(this))},{element:{get:function(){return this._element}},fixedDirection:{get:function(){return this._fixedDirection},set:function(e){this._fixedDirection=e}},fixedSize:{get:function(){return this._fixedSize},set:function(e){+e===e&&(e=Math.max(1,e),this._fixedSize=e)}},currentIndex:{get:function(){return this._element.children.length>0?this._currentIndex:-1},set:function(e){if(+e===e){var t=this._element.children.length;e=Math.max(0,Math.min(t-1,e)),this._currentIndex=e,this._tabContainer.childFocus=this._getFocusInto(this._element.children[e])}}},getAdjacent:{get:function(){return this._getAdjacent},set:function(e){this._getAdjacent=e}},scroller:{get:function(){return this._scroller},set:function(e){this._scroller=e}},_keyDownHandler:function(i){if(!i.altKey){if(r._matchesSelector(i.target,".win-interactive, .win-interactive *"))return;var n=!1,s=this.currentIndex,a=this._element.children.length-1,l="rtl"===t.getComputedStyle(this._element).direction,c=l?e.rightArrow:e.leftArrow,u=l?e.leftArrow:e.rightArrow,d=this.getAdjacent&&this.getAdjacent(s,i.keyCode);if(+d===d)n=!0,s=d;else{var h=s%this.fixedSize;i.keyCode===c?(n=!0,this.fixedDirection===o.FixedDirection.width?0!==h&&s--:s>=this.fixedSize&&(s-=this.fixedSize)):i.keyCode===u?(n=!0,this.fixedDirection===o.FixedDirection.width?h!==this.fixedSize-1&&s++:s+this.fixedSize-h<=a&&(s+=this.fixedSize)):i.keyCode===e.upArrow?(n=!0,this.fixedDirection===o.FixedDirection.height?0!==h&&s--:s>=this.fixedSize&&(s-=this.fixedSize)):i.keyCode===e.downArrow?(n=!0,this.fixedDirection===o.FixedDirection.height?h!==this.fixedSize-1&&s++:s+this.fixedSize-h<=a&&(s+=this.fixedSize)):i.keyCode===e.home?(n=!0,s=0):i.keyCode===e.end?(n=!0,s=this._element.children.length-1):i.keyCode===e.pageUp?n=!0:i.keyCode===e.pageDown&&(n=!0)}s=Math.max(0,Math.min(this._element.children.length-1,s)),s!==this.currentIndex&&(this._focus(s,i.keyCode),(i.keyCode===c||i.keyCode===u||i.keyCode===e.upArrow||i.keyCode===e.downArrow)&&i.stopPropagation()),n&&i.preventDefault()}},_getFocusInto:function(e,t){return e&&e.winControl&&e.winControl._getFocusInto?e.winControl._getFocusInto(t):e},_focus:function(e,t){e=+e===e?e:this.currentIndex;var i=this._element.children[e];i&&(i=this._getFocusInto(i,t),this.currentIndex=e,r._setActive(i,this.scroller))},_MSPointerDownHandler:function(e){var t=e.target;if(t!==this.element){for(;t.parentNode!==this.element;)t=t.parentNode;for(var i=-1;t;)i++,t=t.previousElementSibling;this.currentIndex=i}}},{FixedDirection:{height:"height",width:"width"}});return o})})}}),define("WinJS/Utilities/_SafeHtml",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources"],function(e,t,i,n){"use strict";var r,s,o,a,l,c,u={get nonStaticHTML(){return"Unable to add dynamic content. A script attempted to inject dynamic content, or elements previously modified dynamically, that might be unsafe. For example, using the innerHTML property or the document.write method to add a script element will generate this exception. If the content is safe and from a trusted source, use a method to explicitly manipulate elements and attributes, such as createElement, or use setInnerHTMLUnsafe (or other unsafe method)."}};r=s=function(e,t){e.innerHTML=t},o=a=function(e,t){e.outerHTML=t},l=c=function(e,t,i){e.insertAdjacentHTML(t,i)};var d=t.MSApp;if(d)s=function(e,t){d.execUnsafeLocalFunction(function(){e.innerHTML=t})},a=function(e,t){d.execUnsafeLocalFunction(function(){e.outerHTML=t})},c=function(e,t,i){d.execUnsafeLocalFunction(function(){e.insertAdjacentHTML(t,i)})};else if(t.msIsStaticHTML){var h=function(e){if(!t.msIsStaticHTML(e))throw new n("WinJS.Utitilies.NonStaticHTML",u.nonStaticHTML)};r=function(e,t){h(t),e.innerHTML=t},o=function(e,t){h(t),e.outerHTML=t},l=function(e,t,i){h(i),e.insertAdjacentHTML(t,i)}}i.Namespace._moduleDefine(e,"WinJS.Utilities",{setInnerHTML:r,setInnerHTMLUnsafe:s,setOuterHTML:o,setOuterHTMLUnsafe:a,insertAdjacentHTML:l,insertAdjacentHTMLUnsafe:c})}),define("WinJS/Utilities/_Select",["exports","../Core/_Base","./_SafeHtml"],function(e,t,i){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_Select:t.Namespace._lazy(function(){function e(e){return e.replace(a,function(e){return l[e]||""})}function n(e){return e.replace(c,"")}function r(e){return this[e]}function s(){return this.length}function o(e){return e.getValue||(e.getValue=r),e.getLength||(e.getLength=s),e}var a=/[&<>'"]/g,l={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},c=/[\u200e\u200f]/g;return t.Class.define(function(e,t){this._dataSource=o(t.dataSource),this._index=t.index||0,this._domElement=e,this._domElement.tabIndex=0,t.disabled&&this.setDisabled(t.disabled);var i=this;this._domElement.addEventListener("change",function(){i._index=i._domElement.selectedIndex},!1),this._createSelectElement()},{_index:0,_dataSource:null,dataSource:{get:function(){return this._dataSource},set:function(e){this._dataSource=o(e),this._domElement&&this._createSelectElement()}},setDisabled:function(e){e?this._domElement.setAttribute("disabled","disabled"):this._domElement.removeAttribute("disabled")},_createSelectElement:function(){for(var t=this._dataSource.getLength(),r="",s=0;t>s;s++){var o=""+this._dataSource.getValue(s),a=e(o),l=n(a);r+="<option value='"+l+"'>"+a+"</option>"}i.setInnerHTMLUnsafe(this._domElement,r),this._domElement.selectedIndex=this._index},index:{get:function(){return Math.max(0,Math.min(this._index,this._dataSource.getLength()-1))},set:function(e){if(this._index!==e){this._index=e;var t=this._domElement;t&&t.selectedIndex!==e&&(t.selectedIndex=e)}}},value:{get:function(){return this._dataSource.getValue(this.index)}}})})})}),define("WinJS/Utilities/_UI",["exports","../Core/_BaseCoreUtils","../Core/_Base"],function(e,t,i){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{eventHandler:function(e){return t.markSupportedForProcessing(e)},Orientation:{horizontal:"horizontal",vertical:"vertical"},CountResult:{unknown:"unknown"},CountError:{noResponse:"noResponse"},DataSourceStatus:{ready:"ready",waiting:"waiting",failure:"failure"},FetchError:{noResponse:"noResponse",doesNotExist:"doesNotExist"},EditError:{noResponse:"noResponse",canceled:"canceled",notPermitted:"notPermitted",noLongerMeaningful:"noLongerMeaningful"},ObjectType:{item:"item",groupHeader:"groupHeader"},SelectionMode:{none:"none",single:"single",multi:"multi"},TapBehavior:{directSelect:"directSelect",toggleSelect:"toggleSelect",invokeOnly:"invokeOnly",none:"none"},SwipeBehavior:{select:"select",none:"none"},GroupHeaderTapBehavior:{invoke:"invoke",none:"none"}})}),define("WinJS/Utilities/_Xhr",["../Core/_Global","../Core/_Base","../Promise","../Scheduler"],function(e,t,i,n){"use strict";function r(e,t,i){n.schedule(function(){e(t)},i,null,"WinJS.xhr")}function s(){}function o(t){var o;return new i(function(i,a,l){var c=n.currentPriority;o=new e.XMLHttpRequest,o.onreadystatechange=function(){return o._canceled?void(o.onreadystatechange=s):void(4===o.readyState?(o.status>=200&&o.status<300||0===o.status?r(i,o,c):r(a,o,c),o.onreadystatechange=s):r(l,o,c))},o.open(t.type||"GET",t.url,!0,t.user,t.password),o.responseType=t.responseType||"",Object.keys(t.headers||{}).forEach(function(e){o.setRequestHeader(e,t.headers[e])}),t.customRequestInitializer&&t.customRequestInitializer(o),void 0===t.data?o.send():o.send(t.data)},function(){o.onreadystatechange=s,o._canceled=!0,o.abort()})}return t.Namespace.define("WinJS",{xhr:o}),o}),define("WinJS/Utilities",["./Utilities/_Control","./Utilities/_Dispose","./Utilities/_ElementListUtilities","./Utilities/_ElementUtilities","./Utilities/_Hoverable","./Utilities/_ItemsManager","./Utilities/_KeyboardBehavior","./Utilities/_ParallelWorkQueue","./Utilities/_SafeHtml","./Utilities/_Select","./Utilities/_TabContainer","./Utilities/_UI","./Utilities/_VersionManager","./Utilities/_Xhr"],function(){}),define("WinJS/Fragments",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./Core/_WriteProfilerMark","./Promise","./Utilities/_ElementUtilities","./Utilities/_SafeHtml","./Utilities/_Xhr"],function(e,t,i,n,r,s,o,a,l,c,u,d){"use strict";function h(e,i,n,r){var s=e.src,o=!s;if(o&&(s=i+"script["+n+"]"),s=s.toLowerCase(),!(s in M)){var a=null;M[s]=!0;var c=t.document.createElement("script");if(e.language&&c.setAttribute("language","javascript"),c.setAttribute("type",e.type),c.setAttribute("async","false"),e.id&&c.setAttribute("id",e.id),o){var u=e.text;a=r.then(function(){c.text=u}).then(null,function(){})}else a=new l(function(t){c.onload=c.onerror=function(){t()},c.setAttribute("src",e.src)});return A.appendChild(c),{promise:a,inline:o}}}function _(e,t,i){var n=(t+"script["+i+"]").toLowerCase();n in B||(B[n]=!0,A.appendChild(e.cloneNode(!0)))}function m(e){var t=e.href.toLowerCase();if(!(t in L)){L[t]=!0;var i=e.cloneNode(!1);i.href=e.href,A.appendChild(i)}}function p(e,i){if("string"==typeof e)return g(e,i);var n={docfrag:c.data(e).docFragment};if(!n.docfrag){for(var r=t.document.createDocumentFragment();e.childNodes.length>0;)r.appendChild(e.childNodes[0]);n.docfrag=c.data(e).docFragment=r,e.setAttribute("data-win-hasfragment","")}return i&&S(e),l.as(n)}function f(e,t){return x(e,t).then(function(){return e.document?v(t,e):e}).then(function(){return e.document&&delete e.document,e})}function g(e,t){var i=e.toLowerCase(),n=O[i];if(n)return t&&delete O[i],n.promise?n.promise:l.as(n);n={},t||(O[i]=n);var r=n.promise=f(n,e);return n.promise.then(function(){delete n.promise}),r}function v(e,i){var n=i.document,r=n.body,s=[];T(n.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),m),T(n.getElementsByTagName("style"),function(t,i){_(t,e,i)});var o=l.as();T(n.getElementsByTagName("script"),function(t,i){var n=h(t,e,i,o);n&&(n.inline||(o=n.promise),s.push(n.promise))}),T(r.getElementsByTagName("img"),function(e){e.src=e.src}),T(r.getElementsByTagName("a"),function(e){if(""!==e.href){var t=e.getAttribute("href");t&&"#"!==t[0]&&(e.href=e.href)}});for(var a=r.getElementsByTagName("script");a.length>0;){var c=a[0];c.parentNode.removeChild(c)}return l.join(s).then(function(){for(var e=t.document.createDocumentFragment(),r=t.document.importNode(n.body,!0);r.childNodes.length>0;)e.appendChild(r.childNodes[0]);return i.docfrag=e,i})}function y(){D||(D=!0,T(A.querySelectorAll("script"),function(e){M[e.src.toLowerCase()]=!0}),T(A.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),function(e){L[e.href.toLowerCase()]=!0}))}function b(e,t){return C(e,t,!0)}function C(e,i,n){var s=(e instanceof t.HTMLElement?r._getProfilerMarkIdentifier(e):" href='"+e+"'")+"["+ ++R+"]";return F("WinJS.UI.Fragments:render"+s+",StartTM"),y(),p(e,!n).then(function(e){var t=e.docfrag;n&&(t=t.cloneNode(!0));for(var r=t.firstChild;r;)1===r.nodeType&&(r.msParentSelectorScope=!0),r=r.nextSibling;var o;return i?(i.appendChild(t),o=i):o=t,F("WinJS.UI.Fragments:render"+s+",StopTM"),o})}function w(e,t){return C(e,t,!1)}function I(e){return y(),p(e).then(function(e){return e.docfrag})}function S(e){e?"string"==typeof e?delete O[e.toLowerCase()]:(delete c.data(e).docFragment,e.removeAttribute("data-win-hasfragment")):O={}}function E(e){if(r.hasWinRT){var n=t.document.createElement("a");n.href=e;var o=n.href,a=new i.Windows.Foundation.Uri(o),l=a.schemeName;if("ms-appx"!==l)throw new s("WinJS.UI.Fragments.InvalidUri",P.invalidFragmentUri);return o}return e}function x(e,i){i=N(i);var n=t.document.implementation.createHTMLDocument("frag"),r=n.createElement("base");n.head.appendChild(r);var s=n.createElement("a");return n.body.appendChild(s),r.href=t.document.location.href,s.setAttribute("href",i),r.href=s.href,e.document=n,z(i).then(function(e){u.setInnerHTMLUnsafe(n.documentElement,e),n.head.appendChild(r)})}function k(e){return d({url:e}).then(function(e){return e.responseText})}var P={get invalidFragmentUri(){return"Unsupported uri for fragment loading. Fragments in the local context can only load from package content or local sources. To load fragments from other sources, use a web context."}};if(t.document){var T=function(e,t){for(var i=0,n=e.length;n>i;i++)t(e[i],i)},A=t.document.head||t.document.getElementsByTagName("head")[0],M={},B={},L={},D=!1,O={},R=1,F=a,N=E,z=k;n.Namespace._moduleDefine(e,"WinJS.UI.Fragments",{renderCopy:b,render:w,cache:I,clearCache:S,_cacheStore:{get:function(){return O}},_forceLocal:{get:function(){return N},set:function(e){N=e}},_getFragmentContents:{get:function(){return z},set:function(e){z=e}},_writeProfilerMark:{get:function(){return F},set:function(e){F=e}}})}}),define("WinJS/Application/_State",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise"],function(e,t,i,n,r,s){"use strict";function o(){var t,r,s,o=n.Class.define(function(e){this.folder=e,this._path=e.path,e.tryGetItemAsync&&(this._tryGetItemAsync=e.tryGetItemAsync.bind(e))},{_tryGetItemAsync:function(e){return this.folder.getFileAsync(e).then(null,function(){return!1})},exists:function(e){return this._tryGetItemAsync(e).then(function(e){return e?!0:!1})},remove:function(e){return this._tryGetItemAsync(e).then(function(e){return e?e.deleteAsync():!1}).then(null,function(){return!1})},writeText:function(e,t){var n=i.Windows.Storage,r=this;return r.folder.createFileAsync(e,n.CreationCollisionOption.openIfExists).then(function(e){return n.FileIO.writeTextAsync(e,t)})},readText:function(e,t){var n=i.Windows.Storage;return this._tryGetItemAsync(e).then(function(e){return e?n.FileIO.readTextAsync(e):t}).then(null,function(){return t})}},{supportedForProcessing:!1});n.Namespace._moduleDefine(e,"WinJS.Application",{local:{get:function(){return t||(t=new o(i.Windows.Storage.ApplicationData.current.localFolder)),t}},temp:{get:function(){return r||(r=new o(i.Windows.Storage.ApplicationData.current.temporaryFolder)),r}},roaming:{get:function(){return s||(s=new o(i.Windows.Storage.ApplicationData.current.roamingFolder)),s}}})}function a(){var t=n.Class.define(function(){this.storage={}},{exists:function(e){return s.as(void 0!==this.storage[e])},remove:function(e){return delete this.storage[e],s.as()},writeText:function(e,t){return this.storage[e]=t,s.as(t.length)},readText:function(e,t){var i=this.storage[e];return s.as("string"==typeof i?i:t)}},{supportedForProcessing:!1});n.Namespace._moduleDefine(e,"WinJS.Application",{local:new t,temp:new t,roaming:new t})}i.Windows.Storage.FileIO&&i.Windows.Storage.ApplicationData&&i.Windows.Storage.CreationCollisionOption?o():a();var l={};n.Namespace._moduleDefine(e,"WinJS.Application",{sessionState:{get:function(){return l},set:function(e){l=e}},_loadState:function(t){return 3===t.previousExecutionState?e.local.readText("_sessionState.json","{}").then(function(t){var i=JSON.parse(t);i&&Object.keys(i).length>0&&(e._sessionStateLoaded=!0),e.sessionState=i}).then(null,function(){e.sessionState={}}):s.as()},_oncheckpoint:function(i,n){if(!(t.MSApp&&t.MSApp.getViewOpener&&t.MSApp.getViewOpener())){var r=e.sessionState;if(r&&Object.keys(r).length>0||e._sessionStateLoaded){var s;try{s=JSON.stringify(r)}catch(o){s="",n.queueEvent({type:"error",detail:o})}i.setPromise(e.local.writeText("_sessionState.json",s).then(null,function(e){n.queueEvent({type:"error",detail:e})}))}}}})}),define("WinJS/Navigation",["exports","./Core/_Base","./Core/_Events","./Core/_WriteProfilerMark","./Promise"],function(e,t,i,n,r){"use strict";var s="navigated",o="navigating",a="beforenavigate",l=t.Class.mix(t.Class.define(null,{},{supportedForProcessing:!1}),i.eventMixin),c=new l,u={backStack:[],current:{location:"",initialPlaceholder:!0},forwardStack:[]},d=i._createEventProperty,h=function(e){return n("WinJS.Navigation:navigation,StartTM"),r.as().then(function(){var t=r.as(),i=c.dispatchEvent(a,{setPromise:function(e){t=t.then(function(){return e})},location:e.location,state:e.state});return t.then(function(e){return i||e})})},_=function(e){return r.as().then(function(){var t=r.as();return c.dispatchEvent(o,{setPromise:function(e){t=t.then(function(){return e})},location:u.current.location,state:u.current.state,delta:e}),t})},m=function(e,t){n("WinJS.Navigation:navigation,StopTM");var i=r.as(),o={value:e,location:u.current.location,state:u.current.state,setPromise:function(e){i=i.then(function(){return e})}};return!e&&t&&(o.error=t),c.dispatchEvent(s,o),i},p=function(e,t,i,n){return e=Math.min(e,t.length),e>0?h(t[t.length-e]).then(function(r){if(r)return!1;for(i.push(u.current);e-1>0;)e--,i.push(t.pop());return u.current=t.pop(),_(n).then(m,function(e){throw m(void 0,e||!0),e}).then(function(){return!0})}):r.wrap(!1)};t.Namespace._moduleDefine(e,"WinJS.Navigation",{canGoForward:{get:function(){return u.forwardStack.length>0}},canGoBack:{get:function(){return u.backStack.length>0}},location:{get:function(){return u.current.location}},state:{get:function(){return u.current.state},set:function(e){u.current.state=e}},history:{get:function(){return u},set:function(e){u=e,u.backStack=u.backStack||[],u.forwardStack=u.forwardStack||[],u.current=u.current||{location:"",initialPlaceholder:!0},u.current.location=u.current.location||""}},forward:function(e){return e=e||1,p(e,u.forwardStack,u.backStack,e)},back:function(e){return e=e||1,p(e,u.backStack,u.forwardStack,-e)},navigate:function(e,t){var i={location:e,state:t};return h(i).then(function(e){return e?!1:(u.current.initialPlaceholder||u.backStack.push(u.current),u.forwardStack=[],u.current=i,_().then(m,function(e){throw m(void 0,e||!0),e}).then(function(){return!0}))})},addEventListener:function(e,t,i){c.addEventListener(e,t,i)},removeEventListener:function(e,t,i){c.removeEventListener(e,t,i)},onnavigated:d(s),onnavigating:d(o),onbeforenavigate:d(a)})}),define("WinJS/Application",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_Events","./Core/_Log","./Core/_WriteProfilerMark","./Application/_State","./Navigation","./Promise","./_Signal","./Scheduler","./Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";function _(e){var i;try{var n=[];i=JSON.stringify(e,function(e,i){return i===t?"[window]":i instanceof t.HTMLElement?"[HTMLElement]":"function"==typeof i?"[function]":"object"==typeof i?null===i?i:-1===n.indexOf(i)?(n.push(i),i):"[circular]":i})}catch(r){i=JSON.stringify("[object]")}return i}function m(e){t.MSApp&&t.MSApp.terminateApp(e)}function p(e){var t="def"+$++;return{deferral:Q[t]=e.getDeferral(),id:t}}function f(e,t){t&&(e=Q[t],delete Q[t]),e&&e.complete()}function g(){Q&&(Object.keys(Q).forEach(function(e){Q[e].complete()}),Q={})}function v(e){function t(t){return o("WinJS.Application:Event_"+e.type+",StopTM"),e._deferral&&f(e._deferral,e._deferralID),t}o("WinJS.Application:Event_"+e.type+",StartTM");var i=c.as();e.setPromise=function(e){i=i.then(function(){return e})},e.detail=e.detail||{},"object"==typeof e.detail&&(e.detail.setPromise=e.setPromise);try{if(Z._listeners){var n=!1;r=Z._listeners[e.type],r&&r.forEach(function(t){n=t.listener(e)||n})}var r=tt[e.type];r&&r.forEach(function(t){t(e,n)})}catch(s){I({type:W,detail:s})}return i.then(t,function(e){return e=t(e),e&&"Canceled"===e.name?void 0:c.wrapError(e)})}function y(){return J||(J=new u,J.promise.done(function(){J=null},function(){J=null})),J}function b(e){function t(e){I({type:W,detail:e})}return 0===e.length?y().promise:v(e.shift()).then(null,t)}function C(e){function t(){return C}var i=e.job._queue;0===i.length&&q.length>0&&(i=e.job._queue=S()),e.setPromise(b(i).then(t,t))}function w(){function e(){n=!0}for(var t,i=[],n=!0;n;)0===i.length&&q.length>0&&(i=S()),n=!1,t=b(i),t.done(e,e);j=d.schedule(function(e){function i(){return C}e.setPromise(t.then(i,i))},d.Priority.high,null,"WinJS.Application._pumpEventQueue"),j._queue=i}function I(e){o("WinJS.Application:Event_"+e.type+" queued,Info"),q.push(e),K&&J&&J.complete(C)}function S(){var e=q;return q=[],e}function E(e){var t=p(e.activatedOperation);a._loadState(e).then(function(){I({type:N,detail:e,_deferral:t.deferral,_deferralID:t.id})})}function x(e){var t=p(e.suspendingOperation);I({type:R,_deferral:t.deferral,_deferralID:t.id})}function k(){if(I({type:z}),!t.document||!i.Windows.UI.WebUI.WebUIApplication){var e={arguments:"",kind:"Windows.Launch",previousExecutionState:0};a._loadState(e).then(function(){I({type:N,detail:e})})}}function P(){g(),I({type:F})}function T(t){var i={};for(var n in t)i[n]=t[n];var r,s=!0,o=e._terminateApp;try{e._terminateApp=function(e,t){s=!1,r=e,o!==m&&o(e,t)},v({type:W,detail:{error:i,errorLine:t.lineno,errorCharacter:t.colno,errorUrl:t.filename,errorMessage:t.message}})}finally{e._terminateApp=o}return s}function A(e){var t=e.detail,i=t.id;if(t.parent)return void(t.handler&&O&&delete O[i]);if(t.exception instanceof Error){var n={stack:t.exception.stack,message:t.exception.message};t.exception=n}var r=!O;O=O||[],O[i]=t,r&&d.schedule(function(){var e=O;O=null,e.forEach(function(e){I({type:W,detail:e})})},d.Priority.high,null,"WinJS.Application._queuePromiseErrors")}function M(e){var t={e:e,applicationcommands:void 0};Z.dispatchEvent(U,t)}function B(e){var t={type:V};Object.defineProperty(t,"_winRTBackPressedEvent",{value:e,enumerable:!1}),v(t)}function L(){if(!G){if(G=!0,t.addEventListener("beforeunload",P,!1),t.document){if(t.addEventListener("error",T,!1),i.Windows.UI.WebUI.WebUIApplication){var e=i.Windows.UI.WebUI.WebUIApplication;e.addEventListener("activated",E,!1),e.addEventListener("suspending",x,!1)}if(i.Windows.UI.ApplicationSettings.SettingsPane){var n=i.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView();n.addEventListener("commandsrequested",M)}i.Windows.Phone.UI.Input.HardwareButtons&&i.Windows.Phone.UI.Input.HardwareButtons.addEventListener("backpressed",B)}c.addEventListener("error",A)}}function D(){if(G){if(G=!1,t.removeEventListener("beforeunload",P,!1),t.document){if(i.Windows.UI.WebUI.WebUIApplication){t.removeEventListener("error",T,!1);var e=i.Windows.UI.WebUI.WebUIApplication;e.removeEventListener("activated",E,!1),e.removeEventListener("suspending",x,!1)}if(i.Windows.UI.ApplicationSettings.SettingsPane){var n=i.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView();n.removeEventListener("commandsrequested",M)}i.Windows.Phone.UI.Input.HardwareButtons&&i.Windows.Phone.UI.Input.HardwareButtons.removeEventListener("backpressed",B)}c.removeEventListener("error",A)}}t.Debug&&(t.Debug.setNonUserCodeExceptions=!0);var O,R="checkpoint",F="unload",N="activated",z="loaded",H="ready",W="error",U="settings",V="backclick",q=[],j=null,J=null,K=!1,G=!1,Y=n.Class.mix(n.Class.define(null,{},{supportedForProcessing:!1}),r.eventMixin),Z=new Y,X=r._createEventProperty,Q={},$=0,et=m,tt={activated:[function(){I({type:H})}],checkpoint:[function(t){a._oncheckpoint(t,e)}],error:[function(i,n){if(!n&&(s.log&&s.log(_(i),"winjs","error"),t.document&&e._terminateApp)){var r=i.detail,o=r&&(r.number||r.exception&&(r.exception.number||r.exception.code)||r.error&&r.error.number||r.errorCode||0),a={description:_(r),stack:r&&(r.stack||r.exception&&(r.exception.stack||r.exception.message)||r.error&&r.error.stack||null),errorNumber:o,number:o};e._terminateApp(a,i)}}],backclick:[function(e,t){t?e._winRTBackPressedEvent.handled=!0:l.canGoBack&&(l.back(),e._winRTBackPressedEvent.handled=!0)}]};t.document&&t.document.addEventListener("DOMContentLoaded",k,!1);var it=n.Namespace._moduleDefine(e,"WinJS.Application",{stop:function(){it.onactivated=null,it.oncheckpoint=null,it.onerror=null,it.onloaded=null,it.onready=null,it.onsettings=null,it.onunload=null,it.onbackclick=null,Z=new Y,a.sessionState={},K=!1,S(),j&&j.cancel(),j=null,J=null,D(),g()},addEventListener:function(e,t,i){Z.addEventListener(e,t,i)},removeEventListener:function(e,t,i){Z.removeEventListener(e,t,i)},checkpoint:function(){I({type:R})},start:function(){L(),K=!0,w()},queueEvent:I,_dispatchEvent:v,_terminateApp:{get:function(){return et},set:function(e){et=e}},_applicationListener:n.Namespace._lazy(function(){return new h._GenericListener("Application",it)}),oncheckpoint:X(R),onunload:X(F),onactivated:X(N),onloaded:X(z),onready:X(H),onsettings:X(U),onerror:X(W),onbackclick:X(V)})}),define("WinJS/Animations/_Constants",["exports","../Core/_Base"],function(e,t){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{PageNavigationAnimation:{turnstile:"turnstile",slide:"slide",enterPage:"enterPage",continuum:"continuum"}})}),define("WinJS/Animations/_TransitionAnimation",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise","../Scheduler","../Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a){"use strict";function l(e){return Array.isArray(e)||e instanceof t.NodeList||e instanceof t.HTMLCollection?e:e?[e]:[]}function c(){return++k,"WinJSUIAnimation"+k}function u(e){return"WinJSUIAnimation"===e.substring(0,16)}function d(e){t.getComputedStyle(e,null).opacity}function h(t,i){return function(n){var r={};for(var s in n){var o=n[s];"function"==typeof o&&(o=o(t,i)),r[s]=o}return r.exactTiming||(r.delay+=e._libraryDelay),r}}function _(e,t){var i=e+"|"+t,n=P[i];n&&n(T)}function m(e,t,i){P[e+"|"+t]=i}function p(e,t){delete P[e+"|"+t]}function f(e,t,i,n,r){var s=r.styleCaches[t]||new M(t,r,i);s.cref+=n.length,n.forEach(function(e){_(t,e.property)}),(r.isTransition||n.some(function(e){return s.removed[e[r.nameField]]}))&&(d(e),s.removed={});var o=n.map(function(e){return e[r.nameField]+" "+r.props.map(function(t){return(t[1]?e[t[1]]:"")+t[2]}).join(" ")}).join(", "),a=n.map(function(e){return e[r.nameField]}).join(", ");return""!==s.names&&(o=s.names+", "+o,a=s.names+", "+a),i[r.shorthandProp]=o,s.names=a,s}function g(e,t){t?e():o.schedule(function(){e()},o.Priority.normal,null,"WinJS.UI._Animation._completeAnimationPromise")}function v(e,i,n,o,l){if(n.length>0){var c=e.style,u=a._uniqueID(e);if(S||(S=t.document.createElement("DIV").style),n=n.map(h(i,e)),n.forEach(function(e){var t=r._getCamelCasedName(e.property);e.hasOwnProperty("from")&&(c[t]=e.from),S[t]=e.to,e.to=S[t],e.propertyScriptName=t}),l){var d=f(e,u,c,n,B),_=e.disabled?t.document:e;n.forEach(function(i){var n;o.push(new s(function(s){n=function(n){o&&(_.removeEventListener(r._browserEventEquivalents.transitionEnd,o,!1),p(u,i.property),d.removeName(c,i.propertyScriptName,n?e:null,i.skipStylesReset),t.clearTimeout(l),o=null),g(s,n===A)
};var o=function(t){t.target===e&&t.propertyName===i.property&&n()};m(u,i.property,n),_.addEventListener(r._browserEventEquivalents.transitionEnd,o,!1);var a=0;c[i.propertyScriptName]!==i.to&&(c[i.propertyScriptName]=i.to,a=50);var l=t.setTimeout(function(){l=t.setTimeout(n,i.delay+i.duration)},a)},function(){n(A)}))})}else n.forEach(function(e){c[e.propertyScriptName]=e.to})}}function y(e,i,n,o,l){if(l&&n.length>0){var u=e.style,d=a._uniqueID(e);n=n.map(h(i,e));var _,v=e.disabled?t.document:e;n.forEach(function(e){if(e.keyframe)e.keyframe=x.animationPrefix+e.keyframe;else{_||(_=t.document.createElement("STYLE"),t.document.documentElement.appendChild(_)),e.keyframe=c();var i="@"+x.keyframes+" "+e.keyframe+" { from {"+e.property+":"+e.from+";} to {"+e.property+":"+e.to+";}}";_.sheet.insertRule(i,0)}});var y=f(e,d,u,n,L),b=[],C=[];n.forEach(function(i){var n;C.push(new s(function(s){n=function(e){o&&(v.removeEventListener(r._browserEventEquivalents.animationEnd,o,!1),t.clearTimeout(a),o=null),g(s,e===A)};var o=function(t){t.target===e&&t.animationName===i.keyframe&&n()};m(d,i.property,n),b.push({id:d,property:i.property,style:u,keyframe:i.keyframe});var a=t.setTimeout(function(){a=t.setTimeout(n,i.delay+i.duration)},50);v.addEventListener(r._browserEventEquivalents.animationEnd,o,!1)},function(){n(A)}))}),_&&t.setTimeout(function(){var e=_.parentElement;e&&e.removeChild(_)},50);var w=function(){for(var e=0;e<b.length;e++){var t=b[e];p(t.id,t.property),y.removeName(t.style,t.keyframe)}};o.push(s.join(C).then(w,w))}}function b(){E||(E=i.Windows.UI.ViewManagement.UISettings?new i.Windows.UI.ViewManagement.UISettings:{animationsEnabled:!0})}function C(t,i,n){try{for(var r=e.isAnimationEnabled(),a=l(t),c=l(i),u=[],d=0;d<a.length;d++)if(Array.isArray(a[d]))for(var h=0;h<a[d].length;h++)n(a[d][h],d,c,u,r);else n(a[d],d,c,u,r);return u.length?s.join(u):o.schedulePromiseNormal(null,"WinJS.UI._Animation._completeActionPromise").then(null,function(){})}catch(_){return s.wrapError(_)}}function w(e){return Array.isArray(e)?e.map(function(e){return w(e)}):e?(e.delay=R(e.delay),e.duration=R(e.duration),e):void 0}function I(e){return F?w(e):e}if(t.document){var S,E,x=r._browserStyleEquivalents,k=0,P=[],T=1,A=2,M=n.Class.define(function(e,t,i){this.cref=0,this.id=e,this.desc=t,this.removed={},this.prevStyles=t.props.map(function(e){return i[e[0]]}),this.prevNames=this.names=i[t.nameProp],t.styleCaches[e]=this},{destroy:function(e,t){var i=this.desc;delete i.styleCaches[this.id],t||(""===this.prevNames&&this.prevStyles.every(function(e){return""===e})?e[i.shorthandProp]="":(i.props.forEach(function(t,i){e[t[0]]=this.prevStyles[i]},this),e[i.nameProp]=this.prevNames))},removeName:function(e,t,i,n){var r=this.names,s=r.split(", "),o=s.lastIndexOf(t);o>=0&&(s.splice(o,1),this.names=r=s.join(", "),""===r&&this.desc.isTransition&&(r="none")),--this.cref?(e[this.desc.nameProp]=r,u(t)||(this.removed[t]=!0)):(i&&"none"===r&&(e[this.desc.nameProp]=r,d(i)),this.destroy(e,n))}}),B={shorthandProp:x.transition.scriptName,nameProp:x["transition-property"].scriptName,nameField:"property",props:[[x["transition-duration"].scriptName,"duration","ms"],[x["transition-timing-function"].scriptName,"timing",""],[x["transition-delay"].scriptName,"delay","ms"]],isTransition:!0,styleCaches:[]},L={shorthandProp:x.animation.scriptName,nameProp:x["animation-name"].scriptName,nameField:"keyframe",props:[[x["animation-duration"].scriptName,"duration","ms"],[x["animation-timing-function"].scriptName,"timing",""],[x["animation-delay"].scriptName,"delay","ms"],[x["animation-iteration-count"].scriptName,"","1"],[x["animation-direction"].scriptName,"","normal"],[x["animation-fill-mode"].scriptName,"","both"]],isTransition:!1,styleCaches:[]},D=0,O=function(){return b(),D+E.animationsEnabled>0},R=function(e){return F?e/20:e},F=!1,N=0;n.Namespace._moduleDefine(e,"WinJS.UI",{disableAnimations:function(){D--},enableAnimations:function(){D++},isAnimationEnabled:{get:function(){return O},set:function(e){O=e}},_libraryDelay:{get:function(){return N},set:function(e){N=e}},executeAnimation:function(e,t){return C(e,I(t),y)},executeTransition:function(e,t){return C(e,I(t),v)},_animationTimeAdjustment:{get:function(){return R},set:function(e){R=e}}}),n.Namespace._moduleDefine(e,"WinJS.Utilities",{_fastAnimations:{get:function(){return F},set:function(e){F=e}}})}}),define("WinJS/Animations",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_WriteProfilerMark","./Animations/_Constants","./Animations/_TransitionAnimation","./Promise"],function(e,t,i,n,r,s,o,a){"use strict";function l(e,t,i){return e.keyframe?e.keyframe:!i||e.left!==t.left||e.top!==t.top||e.rtlflip&&!t.rtlflip?null:e.rtlflip?u(i):i}function c(e,t){return t&&e.rtlflip?u(t):t}function u(e){var i=e+"-rtl";return function(n,r){return"ltr"===t.getComputedStyle(r).direction?e:i}}function d(e){return Array.isArray(e)||e instanceof t.NodeList||e instanceof t.HTMLCollection?e:e?[e]:[]}function h(e){for(var i=[],n=0;n<e.length;n++){var r={top:e[n].offsetTop,left:e[n].offsetLeft},s=t.getComputedStyle(e[n],null)[E.scriptName].split(",");6===s.length&&(r.left+=parseFloat(s[4]),r.top+=parseFloat(s[5])),i.push(r)}return i}function _(e,t,i,n){return function(r){for(var s=e,o=0;r>o;o++)t*=i,s+=t;return n&&(s=Math.min(s,n)),s}}function m(e,t){for(var i=0;i<t.length;i++)t[i].top-=e[i].offsetTop,t[i].left-=e[i].offsetLeft}function p(e,t,i){m(e,t);for(var n=0;n<e.length;n++)(0!==t[n].top||0!==t[n].left)&&(e[n].style[E.scriptName]="translate("+t[n].left+"px, "+t[n].top+"px)");return o.executeTransition(e,i)}function f(e,t,i,n,r,s,a,l){function c(e,t,i){if(e){var n={left:t+"px",top:"0px"},r={left:i+"px",top:"0px"};if(+e.length===e.length)for(var s=0,o=e.length;o>s;s++)u.push(e[s]),d.push(n),h.push(r);else u.push(e),d.push(n),h.push(r)}}var u=[],d=[],h=[],_=200,m=0!==t?0>t?-_:_:0,p=0!==i?0>i?-_:_:0;return c(r,t,i),c(s,m,p),c(a,2*m,2*p),c(l,3*m,3*p),d=new k(d),h=new k(h),o.executeTransition(u,[{property:E.cssName,delay:0,duration:350,timing:e,from:y(d),to:y(h)},{property:"opacity",delay:0,duration:350,timing:n?"steps(1, start)":"steps(1, end)",from:n?0:1,to:n?1:0}])}function g(e,i,r){function s(){v(e)}e=d(e),i=d(i);for(var a=0,l=e.length;l>a;a++){var c="rtl"===t.getComputedStyle(e[a]).direction;e[a].style[n._browserStyleEquivalents["transform-origin"].scriptName]=i[Math.min(i.length-1,a)][c?"rtl":"ltr"]}return o.executeTransition(e,r).then(s,s)}function v(e){for(var t=0,i=e.length;i>t;t++)e[t].style[n._browserStyleEquivalents["transform-origin"].scriptName]="",e[t].style[E.scriptName]="",e[t].style.opacity=""}function y(e,i){return i=i||"",function(n,r){var s=e.getOffset(n),o=s.left;return s.rtlflip&&"rtl"===t.getComputedStyle(r).direction&&(o=o.toString(),o="-"===o.charAt(0)?o.substring(1):"-"+o),i+"translate("+o+", "+s.top+")"}}function b(e,t){return t=t||"",function(i){var n=e[i];return"translate("+n.left+"px, "+n.top+"px) "+t}}function C(e,t){return function(i){var n=e[i];return 0===n.left&&0===n.top?t:null}}function w(e,t,i,n){var r=d(t),s=d(i),o=h(s);return new e(r,s,o,n)}function I(e){for(var i=[],n=0,r=e.length;r>n;n++){var s=e[n].getBoundingClientRect(),o=-(40+s.left),a=40+(t.innerWidth-s.right),l=t.innerHeight/2-s.top;i.push({ltr:o+"px "+l+"px",rtl:a+"px "+l+"px"})}return i}function S(e){r("WinJS.UI.Animation:"+e)}var E=n._browserStyleEquivalents.transform,x=[{top:"0px",left:"11px",rtlflip:!0}],k=i.Class.define(function(e,t,i){i=i||x,Array.isArray(e)&&e.length>0?(this.offsetArray=e,1===e.length&&(this.keyframe=l(e[0],i[0],t))):e&&e.hasOwnProperty("top")&&e.hasOwnProperty("left")?(this.offsetArray=[e],this.keyframe=l(e,i[0],t)):(this.offsetArray=i,this.keyframe=c(i[0],t))},{getOffset:function(e){return e>=this.offsetArray.length&&(e=this.offsetArray.length-1),this.offsetArray[e]}},{supportedForProcessing:!1}),P=i.Class.define(function(e,t,i){this.revealedArray=e,this.affectedArray=t,this.offsetArray=i},{execute:function(){S("expandAnimation,StartTM");var e=o.executeAnimation(this.revealedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?200:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}),t=p(this.affectedArray,this.offsetArray,{property:E.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([e,t]).then(function(){S("expandAnimation,StopTM")})}},{supportedForProcessing:!1}),T=i.Class.define(function(e,t,i){this.hiddenArray=e,this.affectedArray=t,this.offsetArray=i},{execute:function(){S("collapseAnimation,StartTM");var e=o.executeAnimation(this.hiddenArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0}),t=p(this.affectedArray,this.offsetArray,{property:E.cssName,delay:this.hiddenArray.length>0?167:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([e,t]).then(function(){S("collapseAnimation,StopTM")})}},{supportedForProcessing:!1}),A=i.Class.define(function(e,t,i){this.elementArray=t,this.offsetArray=i},{execute:function(){return S("repositionAnimation,StartTM"),p(this.elementArray,this.offsetArray,{property:E.cssName,delay:_(0,33,1,250),duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){S("repositionAnimation,StopTM")})}},{supportedForProcessing:!1}),M=i.Class.define(function(e,t,i){this.addedArray=e,this.affectedArray=t,this.offsetArray=i},{execute:function(){S("addToListAnimation,StartTM");var e=this.affectedArray.length>0?240:0,t=o.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:E.cssName,delay:e,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:e,duration:120,timing:"linear",from:0,to:1}]),i=p(this.affectedArray,this.offsetArray,{property:E.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([t,i]).then(function(){S("addToListAnimation,StopTM")})}},{supportedForProcessing:!1}),B=i.Class.define(function(e,t,i){this.deletedArray=e,this.remainingArray=t,this.offsetArray=i},{execute:function(){S("deleteFromListAnimation,StartTM");var e=o.executeAnimation(this.deletedArray,[{keyframe:"WinJS-scale-down",property:E.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:"none",to:"scale(0.85)"},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]),t=p(this.remainingArray,this.offsetArray,{property:E.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([e,t]).then(function(){S("deleteFromListAnimation,StopTM")})}},{supportedForProcessing:!1}),L=i.Class.define(function(e,t,i,n){this.addedArray=e,this.affectedArray=t,this.offsetArray=i;var r=d(n);this.deletedArray=r,this.deletedOffsetArray=h(r)},{execute:function(){S("_updateListAnimation,StartTM"),m(this.deletedArray,this.deletedOffsetArray);var e=0,t=o.executeAnimation(this.deletedArray,[{keyframe:C(this.deletedOffsetArray,"WinJS-scale-down"),property:E.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:b(this.deletedOffsetArray),to:b(this.deletedOffsetArray,"scale(0.85)")},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]);this.deletedArray.length>0&&(e+=60);var i=p(this.affectedArray,this.offsetArray,{property:E.cssName,delay:e,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});this.affectedArray.length>0?e+=240:e&&(e+=60);var n=o.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:E.cssName,delay:e,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:e,duration:120,timing:"linear",from:0,to:1}]);return a.join([t,i,n]).then(function(){S("_updateListAnimation,StopTM")})}},{supportedForProcessing:!1}),D=i.Class.define(function(e,t,i){this.addedArray=e,this.affectedArray=t,this.offsetArray=i},{execute:function(){S("addToSearchListAnimation,StartTM");var e=o.executeAnimation(this.addedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?240:0,duration:117,timing:"linear",from:0,to:1}),t=p(this.affectedArray,this.offsetArray,{property:E.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([e,t]).then(function(){S("addToSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),O=i.Class.define(function(e,t,i){this.deletedArray=e,this.remainingArray=t,this.offsetArray=i},{execute:function(){S("deleteFromSearchListAnimation,StartTM");var e=o.executeAnimation(this.deletedArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:93,timing:"linear",from:1,to:0}),t=p(this.remainingArray,this.offsetArray,{property:E.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([e,t]).then(function(){S("deleteFromSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),R=i.Class.define(function(e,t,i){this.elementArray=t,this.offsetArray=i},{execute:function(){return S("peekAnimation,StartTM"),p(this.elementArray,this.offsetArray,{property:E.cssName,delay:0,duration:2e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){S("peekAnimation,StopTM")})}},{supportedForProcessing:!1});i.Namespace._moduleDefine(e,"WinJS.UI.Animation",{createExpandAnimation:function(e,t){return w(P,e,t)},createCollapseAnimation:function(e,t){return w(T,e,t)},createRepositionAnimation:function(e){return w(A,null,e)},fadeIn:function(e){return S("fadeIn,StartTM"),o.executeTransition(e,{property:"opacity",delay:0,duration:250,timing:"linear",from:0,to:1}).then(function(){S("fadeIn,StopTM")})},fadeOut:function(e){return S("fadeOut,StartTM"),o.executeTransition(e,{property:"opacity",delay:0,duration:167,timing:"linear",to:0}).then(function(){S("fadeOut,StopTM")})},createAddToListAnimation:function(e,t){return w(M,e,t)},createDeleteFromListAnimation:function(e,t){return w(B,e,t)},_createUpdateListAnimation:function(e,t,i){return w(L,e,i,t)},createAddToSearchListAnimation:function(e,t){return w(D,e,t)},createDeleteFromSearchListAnimation:function(e,t){return w(O,e,t)},showEdgeUI:function(e,t,i){S("showEdgeUI,StartTM");var n=new k(t,"WinJS-showEdgeUI",[{top:"-70px",left:"0px"}]);return o[i&&"transition"===i.mechanism?"executeTransition":"executeAnimation"](e,{keyframe:n.keyframe,property:E.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:n.keyframe||y(n),to:"none"}).then(function(){S("showEdgeUI,StopTM")})},showPanel:function(e,t){S("showPanel,StartTM");var i=new k(t,"WinJS-showPanel",[{top:"0px",left:"364px",rtlflip:!0}]);return o.executeAnimation(e,{keyframe:i.keyframe,property:E.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||y(i),to:"none"}).then(function(){S("showPanel,StopTM")})},hideEdgeUI:function(e,t,i){S("hideEdgeUI,StartTM");var n=new k(t,"WinJS-hideEdgeUI",[{top:"-70px",left:"0px"}]);return o[i&&"transition"===i.mechanism?"executeTransition":"executeAnimation"](e,{keyframe:n.keyframe,property:E.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:n.keyframe||y(n)}).then(function(){S("hideEdgeUI,StopTM")})},hidePanel:function(e,t){S("hidePanel,StartTM");var i=new k(t,"WinJS-hidePanel",[{top:"0px",left:"364px",rtlflip:!0}]);return o.executeAnimation(e,{keyframe:i.keyframe,property:E.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:i.keyframe||y(i)}).then(function(){S("hidePanel,StopTM")})},showPopup:function(e,t){S("showPopup,StartTM");var i=new k(t,"WinJS-showPopup",[{top:"50px",left:"0px"}]);return o.executeAnimation(e,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:83,duration:83,timing:"linear",from:0,to:1},{keyframe:i.keyframe,property:E.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||y(i),to:"none"}]).then(function(){S("showPopup,StopTM")})},hidePopup:function(e){return S("hidePopup,StartTM"),o.executeAnimation(e,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:83,timing:"linear",from:1,to:0}).then(function(){S("hidePopup,StopTM")})},pointerDown:function(e){return S("pointerDown,StartTM"),o.executeTransition(e,{property:E.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.975, 0.975)"}).then(function(){S("pointerDown,StopTM")})},pointerUp:function(e){return S("pointerUp,StartTM"),o.executeTransition(e,{property:E.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){S("pointerUp,StopTM")})},dragSourceStart:function(e,t){S("dragSourceStart,StartTM");var i=o.executeTransition(e,[{property:E.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(1.05)"},{property:"opacity",delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:.65}]),n=o.executeTransition(t,{property:E.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"});return a.join([i,n]).then(function(){S("dragSourceStart,StopTM")})},dragSourceEnd:function(e,t,i){S("dragSourceEnd,StartTM");var n=new k(t,"WinJS-dragSourceEnd"),r=o.executeTransition(e,[{property:E.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:1}]),s=o.executeAnimation(e,{keyframe:n.keyframe,property:E.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:n.keyframe||y(n,"scale(1.05) "),to:"none"}),l=o.executeTransition(i,{property:E.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.join([r,s,l]).then(function(){S("dragSourceEnd,StopTM")})},enterContent:function(e,t,i){S("enterContent,StartTM");var n,r=new k(t,"WinJS-enterContent",[{top:"0px",left:"40px",rtlflip:!0}]);if(i&&"transition"===i.mechanism)n=o.executeTransition(e,[{property:E.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:y(r),to:"none"},{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}]);else{var s=o.executeAnimation(e,{keyframe:r.keyframe,property:E.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:r.keyframe||y(r),to:"none"}),l=o.executeTransition(e,{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});n=a.join([s,l])}return n.then(function(){S("enterContent,StopTM")})},exitContent:function(e,t){S("exitContent,StartTM");var i=new k(t,"WinJS-exit",[{top:"0px",left:"0px"}]),n=o.executeAnimation(e,t&&{keyframe:i.keyframe,property:E.cssName,delay:0,duration:117,timing:"linear",from:"none",to:i.keyframe||y(i)}),r=o.executeTransition(e,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return a.join([n,r]).then(function(){S("exitContent,StopTM")})},dragBetweenEnter:function(e,t){S("dragBetweenEnter,StartTM");var i=new k(t,null,[{top:"-40px",left:"0px"},{top:"40px",left:"0px"}]);return o.executeTransition(e,{property:E.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:y(i,"scale(0.95) ")}).then(function(){S("dragBetweenEnter,StopTM")})},dragBetweenLeave:function(e){return S("dragBetweenLeave,StartTM"),o.executeTransition(e,{property:E.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"}).then(function(){S("dragBetweenLeave,StopTM")})},swipeSelect:function(e,t){S("swipeSelect,StartTM");var i=o.executeTransition(e,{property:E.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),n=o.executeAnimation(t,{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return a.join([i,n]).then(function(){S("swipeSelect,StopTM")})},swipeDeselect:function(e,t){S("swipeDeselect,StartTM");var i=o.executeTransition(e,{property:E.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),n=o.executeAnimation(t,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0});return a.join([i,n]).then(function(){S("swipeDeselect,StopTM")})},swipeReveal:function(e,t){S("swipeReveal,StartTM");var i=new k(t,null,[{top:"25px",left:"0px"}]);return o.executeTransition(e,{property:E.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:y(i)}).then(function(){S("swipeReveal,StopTM")})},enterPage:function(e,t){S("enterPage,StartTM");var i=new k(t,"WinJS-enterPage",[{top:"0px",left:"100px",rtlflip:!0}]),n=o.executeAnimation(e,{keyframe:i.keyframe,property:E.cssName,delay:_(0,83,1,333),duration:1e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||y(i),to:"none"}),r=o.executeTransition(e,{property:"opacity",delay:_(0,83,1,333),duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return a.join([n,r]).then(function(){S("enterPage,StopTM")})},exitPage:function(e,t){S("exitPage,StartTM");var i=new k(t,"WinJS-exit",[{top:"0px",left:"0px"}]),n=o.executeAnimation(e,t&&{keyframe:i.keyframe,property:E.cssName,delay:0,duration:117,timing:"linear",from:"none",to:i.keyframe||y(i)}),r=o.executeTransition(e,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return a.join([n,r]).then(function(){S("exitPage,StopTM")})},crossFade:function(e,t){S("crossFade,StartTM");var i=o.executeTransition(e,{property:"opacity",delay:0,duration:167,timing:"linear",to:1}),n=o.executeTransition(t,{property:"opacity",delay:0,duration:167,timing:"linear",to:0});return a.join([i,n]).then(function(){S("crossFade,StopTM")})},createPeekAnimation:function(e){return w(R,null,e)},updateBadge:function(e,t){S("updateBadge,StartTM");var i=new k(t,"WinJS-updateBadge",[{top:"24px",left:"0px"}]);return o.executeAnimation(e,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1},{keyframe:i.keyframe,property:E.cssName,delay:0,duration:1333,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:i.keyframe||y(i),to:"none"}]).then(function(){S("updateBadge,StopTM")})},turnstileForwardIn:function(e){S("turnstileForwardIn,StartTM"),e=d(e);var t=I(e);return g(e,t,[{property:E.cssName,delay:_(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(80deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:_(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){S("turnstileForwardIn,StopTM")})},turnstileForwardOut:function(e){S("turnstileForwardOut,StartTM"),e=d(e);var t=I(e);return g(e,t,[{property:E.cssName,delay:_(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(600px) rotateY(0deg)",to:"perspective(600px) rotateY(-50deg)"},{property:"opacity",delay:_(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){S("turnstileForwardOut,StopTM")})},turnstileBackwardIn:function(e){S("turnstileBackwardIn,StartTM"),e=d(e);var t=I(e);return g(e,t,[{property:E.cssName,delay:_(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(-50deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:_(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){S("turnstileBackwardIn,StopTM")})},turnstileBackwardOut:function(e){S("turnstileBackwardOut,StartTM"),e=d(e);var t=I(e);return g(e,t,[{property:E.cssName,delay:_(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(800px) rotateY(0deg)",to:"perspective(800px) rotateY(80deg)"},{property:"opacity",delay:_(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){S("turnstileBackwardOut,StopTM")})},slideDown:function(e){return S("slideDown,StartTM"),g(e,{ltr:"",rtl:""},[{property:E.cssName,delay:0,duration:250,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"translate(0px, 0px)",to:"translate(0px, 200px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){S("slideDown,StopTM")})},slideUp:function(e){return S("slideUp,StartTM"),g(e,{ltr:"",rtl:""},[{property:E.cssName,delay:0,duration:350,timing:"cubic-bezier(0.17,0.79,0.215,1.0025)",from:"translate(0px, 200px)",to:"translate(0px, 0px)"},{property:"opacity",delay:_(0,34,1,1e3),duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){S("slideUp,StopTM")})},slideRightIn:function(e,i,n,r){return S("slideRightIn,StartTM"),f("cubic-bezier(0.17,0.79,0.215,1.0025)",-t.innerWidth,0,!0,e,i,n,r).then(function(){S("slideRightIn,StopTM")})},slideRightOut:function(e,i,n,r){return S("slideRightOut,StartTM"),f("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,t.innerWidth,!1,e,i,n,r).then(function(){S("slideRightOut,StopTM")})},slideLeftIn:function(e,i,n,r){return S("slideLeftIn,StartTM"),f("cubic-bezier(0.17,0.79,0.215,1.0025)",t.innerWidth,0,!0,e,i,n,r).then(function(){S("slideLeftIn,StopTM")})},slideLeftOut:function(e,i,n,r){return S("slideLeftOut,StartTM"),f("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,-t.innerWidth,!1,e,i,n,r).then(function(){S("slideLeftOut,StopTM")})},continuumForwardIn:function(e,t,i){return S("continuumForwardIn,StartTM"),a.join([o.executeTransition(e,[{property:E.cssName,delay:0,duration:350,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(0.5, 0.5)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),o.executeTransition(t,[{property:E.cssName,delay:0,duration:350,timing:"cubic-bezier(0.24,1.15,0.11,1.1575)",from:"translate(0px, 225px)",to:"translate(0px, 0px)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),g(i,{ltr:"0px 50%",rtl:"100% 50%"},[{property:E.cssName,delay:0,duration:350,timing:"cubic-bezier(0,0.62,0.8225,0.9625)",from:"rotateX(80deg) scale(1.5, 1.5)",to:"rotateX(0deg) scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){S("continuumForwardIn,StopTM")})},continuumForwardOut:function(e,t){return S("continuumForwardOut,StartTM"),a.join([o.executeTransition(e,[{property:E.cssName,delay:0,duration:120,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(1.1, 1.1)"},{property:"opacity",delay:0,duration:120,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]),g(t,{ltr:"0px 100%",rtl:"100% 100%"},[{property:E.cssName,delay:0,duration:152,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"rotateX(0deg) scale(1.0, 1.0) translate(0px, 0px)",to:"rotateX(80deg) scale(1.5, 1.5) translate(0px, 150px)"},{property:"opacity",delay:0,duration:152,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}])]).then(function(){S("continuumForwardOut,StopTM")})},continuumBackwardIn:function(e,t){return S("continuumBackwardIn,StartTM"),a.join([o.executeTransition(e,[{property:E.cssName,delay:0,duration:200,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(1.25, 1.25)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:200,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),g(t,{ltr:"0px 50%",rtl:"100% 50%"},[{property:E.cssName,delay:0,duration:250,timing:"cubic-bezier(0.2975, 0.7325, 0.4725, 0.99)",from:"rotateX(80deg) translate(0px, -100px)",to:"rotateX(0deg) translate(0px, 0px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){S("continuumBackwardIn,StopTM")})},continuumBackwardOut:function(e){return S("continuumBackwardOut,StartTM"),o.executeTransition(e,[{property:E.cssName,delay:0,duration:167,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(0.5, 0.5)"},{property:"opacity",delay:0,duration:167,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){S("continuumBackwardOut,StopTM")})},createPageNavigationAnimations:function(){function t(){return a.wrap()}return{exit:t,entrance:e.enterPage}}})}),define("WinJS/Binding/_BindingParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../ControlProcessor/_OptionsLexer","../ControlProcessor/_OptionsParser"],function(e,t,i,n,r,s,o,a,l){"use strict";function c(e,t){o("WinJS.Binding:bindingParser,StartTM");var i=h.lexer(e),n=new m.BindingInterpreter(i,e,t||{}),r=n.run();return o("WinJS.Binding:bindingParser,StopTM"),r}function u(e){o("WinJS.Binding:bindingParser,StartTM");var t=h.lexer(e),i=new m.BindingParser(t,e),n=i.run();return o("WinJS.Binding:bindingParser,StopTM"),n}var d={get invalidBinding(){return"Invalid binding:'{0}'. Expected to be '<destProp>:<sourceProp>;'. {1}"},get bindingInitializerNotFound(){return"Initializer not found:'{0}'"}},h=t.Namespace.defineWithParent(null,null,{lexer:t.Namespace._lazy(function(){return a._optionsLexer}),tokenType:t.Namespace._lazy(function(){return a._optionsLexer.tokenType})}),_=i.requireSupportedForProcessing,m=t.Namespace.defineWithParent(null,null,{BindingInterpreter:t.Namespace._lazy(function(){return t.Class.derive(l.optionsParser._BaseInterpreter,function(e,t,i){this._initialize(e,t,i)},{_error:function(e){throw new n("WinJS.Binding.ParseError",s._formatString(d.invalidBinding,this._originalSource,e))},_evaluateInitializerName:function(){if(this._current.type===h.tokenType.identifier){var e=this._evaluateIdentifierExpression();return r.log&&!e&&r.log(s._formatString(d.bindingInitializerNotFound,this._originalSource),"winjs binding","error"),_(e)}},_evaluateValue:function(){switch(this._current.type){case h.tokenType.stringLiteral:case h.tokenType.numberLiteral:var e=this._current.value;return this._read(),e;default:return void this._unexpectedToken(h.tokenType.stringLiteral,h.tokenType.numberLiteral)}},_readBindDeclarations:function(){for(var e=[];;)switch(this._current.type){case h.tokenType.identifier:case h.tokenType.thisKeyword:e.push(this._readBindDeclaration());break;case h.tokenType.semicolon:this._read();break;case h.tokenType.eof:return e;default:return void this._unexpectedToken(h.tokenType.identifier,h.tokenType.semicolon,h.tokenType.eof)}},_readBindDeclaration:function(){var e=this._readDestinationPropertyName();this._read(h.tokenType.colon);var t=this._readSourcePropertyName(),i=this._evaluateInitializerName();return{destination:e,source:t,initializer:i}},_readDestinationPropertyName:function(){return this._readIdentifierExpression()},_readSourcePropertyName:function(){return this._readIdentifierExpression()},run:function(){return this._readBindDeclarations()}},{supportedForProcessing:!1})}),BindingParser:t.Namespace._lazy(function(){return t.Class.derive(m.BindingInterpreter,function(e,t){this._initialize(e,t,{})},{_readInitializerName:function(){return this._current.type===h.tokenType.identifier?this._readIdentifierExpression():void 0},_readBindDeclaration:function(){var e=this._readDestinationPropertyName();this._read(h.tokenType.colon);var t=this._readSourcePropertyName(),i=this._readInitializerName();return{destination:e,source:t,initializer:i}}},{supportedForProcessing:!1})})});t.Namespace._moduleDefine(e,"WinJS.Binding",{_bindingParser:c,_bindingParser2:u})}),define("WinJS/Binding/_DomWeakRefTable",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Scheduler"],function(e,t,i,n,r,s){"use strict";function o(){0===_&&(h=0);var e,t,i=Object.keys(p),n=Date.now()-m;for(e=0,t=i.length;t>e;e++){var r=i[e];p[r].time<n&&delete p[r]}l()}function a(){t.Debug&&t.Debug.debuggerEnabled&&f||h||(0===_?(s.schedule(o,s.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),h=1):h=t.setInterval(o,_))}function l(){t.Debug&&t.Debug.debuggerEnabled&&f||(0===_?h||0!==Object.keys(p).length&&(s.schedule(o,s.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),h=1):h&&0===Object.keys(p).length&&(t.clearInterval(h),h=0))
}function c(e,t){return p[t]={element:e,time:Date.now()},a(),t}function u(e){if(g){var i=p[e];return i?i.element:t.document.getElementById(e)}var n=t.document.getElementById(e);if(n)delete p[e],l();else{var i=p[e];i&&(i.time=Date.now(),n=i.element)}return n}if(i.Windows.Foundation.Uri&&i.msSetWeakWinRTProperty&&i.msGetWeakWinRTProperty){var d=new i.Windows.Foundation.Uri("about://blank");return void n.Namespace._moduleDefine(e,"WinJS.Utilities",{_createWeakRef:function(e,t){return i.msSetWeakWinRTProperty(d,t,e),t},_getWeakRefElement:function(e){return i.msGetWeakWinRTProperty(d,e)}})}var h,_=500,m=1e3,p={},f=!0,g=!1;n.Namespace._moduleDefine(e,"WinJS.Utilities",{_DOMWeakRefTable_noTimeoutUnderDebugger:{get:function(){return f},set:function(e){f=e}},_DOMWeakRefTable_sweepPeriod:{get:function(){return _},set:function(e){_=e}},_DOMWeakRefTable_timeout:{get:function(){return m},set:function(e){m=e}},_DOMWeakRefTable_tableSize:{get:function(){return Object.keys(p).length}},_DOMWeakRefTable_fastLoadPath:{get:function(){return g},set:function(e){g=e}},_createWeakRef:c,_getWeakRefElement:u})}),define("WinJS/Binding/_Data",["exports","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Promise","../Scheduler","./_DomWeakRefTable"],function(e,t,i,n,r,s,o,a,l,c){"use strict";var u={get exceptionFromBindingInitializer(){return"Exception thrown from binding initializer: {0}"},get propertyIsUndefined(){return"{0} is undefined"},get unsupportedDataTypeForBinding(){return"Unsupported data type"}},d={_listeners:null,_pendingNotifications:null,_notifyId:0,_getObservable:function(){return this},_cancel:function(e){var t=this._pendingNotifications,i=!1;if(t)for(var n=Object.keys(t),r=n.length-1;r>=0;r--){var s=t[n[r]];s.target===e&&(s.promise&&(s.promise.cancel(),s.promise=null),delete t[n[r]],i=!0)}return i},notify:function(e,t,i){var n=this._listeners&&this._listeners[e];if(n){var r=this;r._cancel(e),r._pendingNotifications=r._pendingNotifications||{};var c=r._notifyId++,d=r._pendingNotifications[c]={target:e},h=function(){delete r._pendingNotifications[c]};return d.promise=l.schedulePromiseNormal(null,"WinJS.Binding.observableMixin.notify").then(function(){for(var e=0,r=n.length;r>e&&d.promise;e++)try{n[e](t,i)}catch(a){s.log&&s.log(o._formatString(u.exceptionFromBindingInitializer,a.toString()),"winjs binding","error")}return h(),t}),d.promise}return a.as()},bind:function(e,t){this._listeners=this._listeners||{};for(var i=this._listeners[e]=this._listeners[e]||[],n=!1,r=0,s=i.length;s>r;r++)if(i[r]===t){n=!0;break}return n||(i.push(t),t(w(this[e]))),this},unbind:function(e,t){if(this._listeners=this._listeners||{},e&&t){var i=this._listeners[e];if(i){for(var n,r=0,s=i.length;s>r;r++)i[r]!==t&&(n=n||[]).push(i[r]);this._listeners[e]=n}}else if(e)this._cancel(e),delete this._listeners[e];else{var o=this;if(o._pendingNotifications){var a=o._pendingNotifications;o._pendingNotifications={},Object.keys(a).forEach(function(e){var t=a[e];t.promise&&t.promise.cancel()})}this._listeners={}}return this}},h={_backingData:null,_initObservable:function(e){this._backingData=e||{}},getProperty:function(e){var t=this._backingData[e];return s.log&&void 0===t&&s.log(o._formatString(u.propertyIsUndefined,e),"winjs binding","warn"),C(t)},setProperty:function(e,t){return this.updateProperty(e,t),this},addProperty:function(e,t){return this[e]||Object.defineProperty(this,e,{get:function(){return this.getProperty(e)},set:function(t){this.setProperty(e,t)},enumerable:!0,configurable:!0}),this.setProperty(e,t)},updateProperty:function(e,t){var i=this._backingData[e],n=w(t);return i!==n&&(this._backingData[e]=n,this._backingData[e]===n)?this.notify(e,n,i):a.as()},removeProperty:function(e){var t,i=this._backingData[e];try{delete this._backingData[e]}catch(n){}try{delete this[e]}catch(n){}return this.notify(e,t,i),this}};Object.keys(d).forEach(function(e){h[e]=d[e]});var _=function(e,t){return g(e,t)},m=0,p=function(){return"bindHandler"+m++},f=function(e,i){if(!t.msGetWeakWinRTProperty)return e;var n=p();return c._getWeakRefElement(i)[n]=e,function(e,t){var r=c._getWeakRefElement(i);r&&r[n](e,t)}},g=function(e,t,i){function n(){a&&a.forEach(function(e){e.source.unbind(e.prop,e.listener)}),a=null}function r(e){o[e]&&(o[e].complexBind.cancel(),delete o[e])}if(e=C(e),!e)return{cancel:function(){},empty:!0};var s;i||(i=p(),s={},c._createWeakRef(s,i));var o={},a=null;return Object.keys(t).forEach(function(n){var l=t[n];if(l instanceof Function)l=f(l,i),l.bindState=s,a=a||[],a.push({source:e,prop:n,listener:l}),e.bind(n,l);else{var c=function(e){r(n);var t=g(C(e),l,i);if(t.empty){var s=function(e){Object.keys(e).forEach(function(t){var i=e[t];i instanceof Function?i(void 0,void 0):s(i)})};s(l)}o[n]={source:e,complexBind:t}};c=f(c,i),c.bindState=s,a=a||[],a.push({source:e,prop:n,listener:c}),e.bind(n,c)}}),{cancel:function(){n(),Object.keys(o).forEach(function(e){r(e)})}}},v=i.Class.mix(function(e){this._initObservable(e),Object.defineProperties(this,y(e))},h),y=function(e){function t(e){i[e]={get:function(){return this.getProperty(e)},set:function(t){this.setProperty(e,t)},enumerable:!0,configurable:!0}}for(var i={};e&&e!==Object.prototype;)Object.keys(e).forEach(t),e=Object.getPrototypeOf(e);return i},b=function(e){if(!(!e||"object"!=typeof e||e instanceof Date||Array.isArray(e)))return i.Class.mix(function(t){this._initObservable(t||Object.create(e))},h,y(e));if(n.validation)throw new r("WinJS.Binding.UnsupportedDataType",o._formatString(u.unsupportedDataTypeForBinding))},C=function(e){if(!e)return e;var t=typeof e;if("object"!==t||e instanceof Date||Array.isArray(e))return e;if(e._getObservable)return e._getObservable();var i=new v(e);return i.backingData=e,Object.defineProperty(e,"_getObservable",{value:function(){return i},enumerable:!1,writable:!1}),i},w=function(e){return e&&e.backingData?e.backingData:e};i.Namespace._moduleDefine(e,"WinJS.Binding",{mixin:{value:h,enumerable:!1,writable:!0,configurable:!0},dynamicObservableMixin:{value:h,enumerable:!0,writable:!0,configurable:!0},observableMixin:{value:d,enumerable:!0,writable:!0,configurable:!0},expandProperties:y,define:b,as:C,unwrap:w,bind:_})}),define("WinJS/Binding/_Declarative",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","./_BindingParser","./_Data","./_DomWeakRefTable"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_){"use strict";function m(e,t){var i=e._autoDispose;i&&i.push(t)}function p(e){e._autoDispose=(e._autoDispose||[]).filter(function(e){return e()})}function f(e,t){return e?e.winBindingToken===t?e:void(o.log&&o.log(a._formatString(z.duplicateBindingDetected,e.id),"winjs binding","error")):e}function g(e){if(e.winBindingToken)return e.winBindingToken;var t="_win_bind"+F++;return Object.defineProperty(e,"winBindingToken",{configurable:!1,writable:!1,enumerable:!1,value:t}),t}function v(e,t,i,n,r,s,o){var a=e.initializer;if(a&&(a=a.winControl||a["data-win-control"]||a),a instanceof Function){var l=a(n,e.source,r,e.destination);return o&&(l&&l.cancel?o.bindings.push(function(){l.cancel()}):o.nocache=!0),l}a&&a.render&&(s.count++,o&&(o.nocache=!0),W(a.render).call(a,x(n,e.source),r).then(function(){s.checkComplete()}))}function y(e,t,i,n,r,s){var l,c=!0,u=!1;p(n);var d=function(){if(!u){var i=f(_._getWeakRefElement(e),t);return i||(o.log&&o.log(a._formatString(z.elementNotFound,e),"winjs binding","info"),l&&l.cancel()),i}},h=function(e){var t=d();t&&k(t,r.destination,e),c&&(i.checkComplete(),c=!1)};if(m(n,d),l=L(n,r.source,h)){var g=l.cancel;l.cancel=function(){return u=!0,g.call(l)},s&&s.bindings.push(function(){l.cancel()})}return l}function b(e,i,n,r,s,o,a){var l;return r!==t&&(r=h.as(r)),r._getObservable&&(l=r._getObservable()),l?(o.count++,y(i,n,o,l,e,a)):void k(s,e.destination,x(r,e.source))}function C(e,t){for(var i=e.length-1;i>=0;i--){var n=e[i],l=n.destination;if(1===l.length&&"id"===l[0]){if(r.validation)throw new s("WinJS.Binding.IdBindingNotSupported",a._formatString(z.idBindingNotSupported,t));o.log&&o.log(a._formatString(z.idBindingNotSupported,t),"winjs binding","error"),e.splice(i,1)}}return e}function w(e,i){if(i){var n,r=i.expressions[e];return r||(n=C(d._bindingParser(e,t),e),i.expressions[e]=n),n||(n=r),n}return C(d._bindingParser(e,t),e)}function I(e,i,n,r,s,o){l("WinJS.Binding:processAll,StartTM");var a,c={count:0,checkComplete:function(){this.count--,0===this.count&&(l("WinJS.Binding:processAll,StopTM"),o())}},d=e||t.document.body,h="[data-win-bind],[data-win-control]",m=d.querySelectorAll(h);n||!d.getAttribute("data-win-bind")&&!d.winControl||(a=d),c.count++;var p=i||t;_._DOMWeakRefTable_fastLoadPath=!0;try{var f=u.data(d);f.winBindings=f.winBindings||[];for(var y=a?-1:0,C=m.length;C>y;y++){var I=0>y?a:m[y];if(I.winControl&&I.winControl.constructor&&I.winControl.constructor.isDeclarativeControlContainer){y+=I.querySelectorAll(h).length;var E=I.winControl.constructor.isDeclarativeControlContainer;"function"==typeof E&&(E=W(E))(I.winControl,function(e){return S(e,i,!1,r,s)})}if(I.hasAttribute("data-win-bind")){var x=I.getAttribute("data-win-bind"),k=w(x,r);if(!k.implemented){for(var P=0,T=k.length;T>P;P++){var A=k[P];A.initializer=A.initializer||s,A.implementation=A.initializer?v:b}k.implemented=!0}c.count++;var M=g(I),B=N?M:I.id;B||(I.id=B=M),_._createWeakRef(I,B);var L=u.data(I);L.winBindings=null;var D;r&&r.elements&&(D=r.elements[B],D||(r.elements[B]=D={bindings:[]}));for(var O=0,R=k.length;R>O;O++){var F=k[O],z=F.implementation(F,B,M,p,I,c,D);z&&(L.winBindings=L.winBindings||[],L.winBindings.push(z),f.winBindings.push(z))}c.count--}}}finally{_._DOMWeakRefTable_fastLoadPath=!1}c.checkComplete()}function S(e,t,i,n,r){return new c(function(s,o,a){I(e,t,i,n,r,s,o,a)}).then(null,function(e){return o.log&&o.log(a._formatString(z.errorInitializingBindings,e&&e.message),"winjs binding","error"),c.wrapError(e)})}function E(e){var i=function(i,n,r,s,l){var c=g(r),u=N?c:r.id;u||(r.id=u=c),_._createWeakRef(r,u);var d;if(i!==t&&(i=h.as(i)),i._getObservable&&(d=i._getObservable()),d){var m=0,p=L(h.as(i),n,function(t){if(1!==++m||t!==l){var i=f(_._getWeakRefElement(u),c);i?k(i,s,e(W(t))):p&&(o.log&&o.log(a._formatString(z.elementNotFound,u),"winjs binding","info"),p.cancel())}});return p}var v=x(i,n);v!==l&&k(r,s,e(v))};return H(i)}function x(e,i){if(e!==t&&(e=W(e)),i)for(var n=0,r=i.length;r>n&&null!==e&&void 0!==e;n++)e=W(e[i[n]]);return e}function k(e,i,n){W(n),e=W(e);for(var r=0,s=i.length-1;s>r;r++){if(e=W(e[i[r]]),!e)return void(o.log&&o.log(a._formatString(z.propertyDoesNotExist,i[r],i.join(".")),"winjs binding","error"));if(e instanceof t.Node)return void(o.log&&o.log(a._formatString(z.nestedDOMElementBindingNotSupported,i[r],i.join(".")),"winjs binding","error"))}if(0===i.length)return void(o.log&&o.log(z.cannotBindToThis,"winjs binding","error"));var l=i[i.length-1];o.log&&void 0===e[l]&&o.log(a._formatString(z.creatingNewProperty,l,i.join(".")),"winjs binding","warn"),e[l]=n}function P(e,t,i){return e=W(e),t&&1===t.length&&t[0]?void e.setAttribute(t[0],i):void(o.log&&o.log(z.attributeBindingSingleProperty,"winjs binding","error"))}function T(e,i,n,r,s){var l=g(n),c=N?l:n.id;c||(n.id=c=l),_._createWeakRef(n,c);var u;if(e!==t&&(e=h.as(e)),e._getObservable&&(u=e._getObservable()),u){var d=0,m=L(u,i,function(e){if(1!==++d||e!==s){var t=f(_._getWeakRefElement(c),l);t?P(t,r,W(e)):m&&(o.log&&o.log(a._formatString(z.elementNotFound,c),"winjs binding","info"),m.cancel())}});return m}var p=x(e,i);p!==s&&P(n,r,p)}function A(e,t,i,n){return P(i,n,x(e,t))}function M(e,t,i){i=W(i);var n=x(e,t);Array.isArray(n)?n.forEach(function(e){u.addClass(i,e)}):n&&u.addClass(i,n)}function B(e,t,i,n,r){return U(e,t,i,n,r)}function L(e,t,i){if(t.length>1){for(var n={},r=n,s=0,o=t.length-1;o>s;s++)r=r[t[s]]={};return r[t[t.length-1]]=i,h.bind(e,n,!0)}return 1===t.length?(e.bind(t[0],i,!0),{cancel:function(){e.unbind(t[0],i),this.cancel=D}}):void i(e)}function D(){}function O(e,t,i,n){return k(i,n,x(e,t)),{cancel:D}}function R(e){return H(e)}var F=1e3*Math.random()>>0,N=i.msSetWeakWinRTProperty&&i.msGetWeakWinRTProperty,z={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get creatingNewProperty(){return"Creating new property {0}. Full path:{1}"},get duplicateBindingDetected(){return"Binding against element with id {0} failed because a duplicate id was detected."},get elementNotFound(){return"Element not found:{0}"},get errorInitializingBindings(){return"Error initializing bindings: {0}"},get propertyDoesNotExist(){return"{0} doesn't exist. Full path:{1}"},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"},get nestedDOMElementBindingNotSupported(){return"Binding through a property {0} of type HTMLElement is not supported, Full path:{1}."}},H=r.markSupportedForProcessing,W=r.requireSupportedForProcessing,U=E(function(e){return e});n.Namespace._moduleDefine(e,"WinJS.Binding",{processAll:S,oneTime:R(O),defaultBind:R(B),converter:E,initializer:R,getValue:x,setAttribute:R(T),setAttributeOneTime:R(A),addClassOneTime:R(M)})}),define("WinJS/Binding",["./Binding/_BindingParser","./Binding/_Data","./Binding/_Declarative","./Binding/_DomWeakRefTable"],function(){}),define("WinJS/BindingTemplate/_DataTemplateCompiler",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Binding/_BindingParser","../Binding/_Declarative","../ControlProcessor","../ControlProcessor/_OptionsParser","../Fragments","../Promise","../_Signal","../Utilities/_Dispose","../Utilities/_SafeHtml","../Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g){"use strict";if(t.document){var v={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"}};i.Namespace._moduleDefine(e,"WinJS.Binding",{_TemplateCompiler:i.Namespace._lazy(function(){function e(e,t,i){var n=g.data(e).bindTokens;n&&n.forEach(function(e){e&&e.cancel&&e.cancel()}),t&&t.cancel(),i&&i.cancel()}function y(e,t){return function(i){return c.processAll(i,e,!1,null,t)}}function b(e){return e=X(e),e instanceof t.Node?null:e}function C(e,t){var i=-1!==e.indexOf("\n"),n=arguments,s=e.replace(_t,function(s,o,a,l,c,u,d){if(c||u)throw new r("Format:MalformedInputString","Did you forget to escape a: "+(c||u)+" at: "+d);if(o)return"{";if(a)return"}";var h,_=+l;if(h=_===+_?n[_+1]:t[l],void 0===h)throw new r("Format:MissingPart","Missing part '"+l+"'");if(i){for(var m=d;m>0&&" "===e[--m];);m>=0&&"\n"===e[m]&&(h=w(d-m-1,h))}return h});return s}function w(e,t){for(var i="",n=0;e>n;n++)i+=" ";return t.split("\n").map(function(e,t){return t?i+e:e}).join("\n")}function I(e){return e.trim()}function S(e){return e.join(";\n")}function E(e){return e.join(", ")||"empty"}function x(e){return e.map(function(e){return e.match(ct)?"."+e:+e===e?C("[{0}]",e):C("[{0}]",P(e))}).join("")}function k(e,t,i,n){var t=t.map(function(e){return e.match(ct)?"."+e:(+e===e&&(e=+e),B(P(e)))}).map(function(e){return C("{filter}({temp} = {temp}{part})",{filter:n,temp:i,part:e})});return t.unshift(M(A(i,e))),t.push(i),M(t.join(" && "))}function P(e){return JSON.stringify(e)}function T(e){return e?"new Array("+ +e+")":"[]"}function A(e,t){return""+e+" = "+t}function M(e){return"("+e+")"}function B(e){return"["+e+"]"}function L(e){return e.match(ct)?e:+e===e?+e:P(e)}function D(e){return e=""+e,e.replace(dt,function(e){return ht[e]||" "})}function O(e,t,i){return new String(i?""+e+t+"_"+i:""+e+t)}function R(e){return e.replace(/\\n/g,"\\n\\\n")}function F(e){return Object.keys(e)}function N(e){return Object.keys(e).map(function(t){return e[t]})}function z(e,t){return H([e,t])}function H(e){for(var t={},i=0,n=e.length;n>i;i++)for(var r=e[i],s=Object.keys(r),o=0,a=s.length;a>o;o++){var l=s[o];t[l]=r[l]}return t}function W(e){return e.reduce(function(e,t){return e?X(e[t]):null},t)}function U(e,t,i,n){var r=e.children;if(r){var s=Object.keys(r);t&&i&&i(e,t,s.length);for(var o=0,a=s.length;a>o;o++){var l=s[o],c=r[l];U(c,l,i,n)}t&&n&&n(e,t,Object.keys(r).length)}else t&&i&&i(e,t,0),t&&n&&n(e,t,0)}function V(e){return e.replace(/^\s*$/gm,"").replace(/^(.*[^\s])( *)$/gm,function(e,t){return t})}var q=_._cancelBlocker,j=c.defaultBind,J=c.oneTime,K=c.setAttribute,G=c.setAttributeOneTime,Y=c.addClassOneTime,Z=_.as,X=n.requireSupportedForProcessing,Q=f.insertAdjacentHTMLUnsafe,$=g.data,et=p.markDisposable,tt=u.processAll,it=c.processAll,nt=d._optionsParser,rt=d._CallExpression,st=d._IdentifierExpression,ot=l._bindingParser2,at=u.scopedSelect,lt=a,ct=/^[A-Za-z]\w*$/,ut=/[^A-Za-z\w$]/g,dt=/[&<>'"]/g,ht={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},_t=/({{)|(}})|{(\w+)}|({)|(})/g,mt=/^\s*;\s*$/,pt=/[A-Z]/g,ft=i.Class.define(function(e,t,i,n,r){var s=this;this.compiler=e,this.kind=i,this.base=new String(t),this.tree={children:{},parent:this.base,reference:function(){return s.base}},this.accessExpression=n,this.filter=r||""},{createPathExpression:function(e,t){if(e.length){var i=this,n=e.reduce(function(e,t){return e.children=e.children||{},e.children[t]=e.children[t]||{parent:e},e.children[t]},this.tree);return n.name=n.name||i.compiler.defineInstance(i.kind,t||"",function(){return i.accessExpression(n.parent.name?n.parent.name:n.parent.reference(),e.slice(-1)[0],n.parent.parent===i.base,i.filter,!0)}),n.name}return this.base},lower:function(){var e=this,t=[],i=function(t,i,n){return e.accessExpression(t.parent.name?t.parent.name:t.parent.reference(),i,t.parent.parent===e.base,e.filter,n)};U(this.tree,"",function(n,r,s){t.push(r),s>1?(n.name=n.name||e.compiler.defineInstance(e.kind,t.join("_"),i.bind(null,n,r,!0)),n.reference=function(){return n.name}):1===s&&(n.reference=i.bind(null,n,r))},function(){t.pop()})},deadNodeElimination:function(){U(this.tree,"",null,function(e,t,i){(!e.name||e.name.dead)&&0===i&&e.parent&&e.parent.children&&delete e.parent.children[t]})},definitions:function(){var e=[];return U(this.tree,"",function(t){t.name&&e.push(t)}),e.map(function(e){return e.name.definition()})}}),gt={capture:"capture",temporary:"temporary",variable:"variable",data:"data",global:"global"},vt={capture:"c",temporary:"t",variable:"iv",data:"d",global:"g"},yt={imported:"import",variable:"variable"},bt={imported:"i",variable:"sv"},Ct={tree:"tree",text:"text",initializer:"initializer",template:"template",error:"error"},wt={attribute:"attribute",booleanAttribute:"booleanAttribute",inlineStyle:"inlineStyle",textContent:"textContent"},It="imports",St={initial:0,analyze:1,optimze:2,lower:3,compile:4,link:5,done:6},Et=i.Class.define(function(e,i){if(this._stage=St.initial,this._staticVariables={},this._staticVariablesCount=0,this._instanceVariables={},this._instanceVariablesCount={},this._debugBreak=i.debugBreakOnRender,this._defaultInitializer=X(i.defaultInitializer||j),this._optimizeTextBindings=!i.disableTextBindingOptimization,this._templateElement=e,this._templateContent=t.document.createElement(e.tagName),this._extractChild=i.extractChild||!1,this._controls=null,this._bindings=null,this._bindTokens=null,this._textBindingPrefix=null,this._textBindingId=0,this._suffix=[],this._htmlProcessors=[],this._profilerMarkIdentifier=i.profilerMarkIdentifier,this._captureCSE=new ft(this,"container",gt.capture,this.generateElementCaptureAccess.bind(this)),this._dataCSE=new ft(this,"data",gt.data,this.generateNormalAccess.bind(this),this.importFunctionSafe("dataSecurityCheck",X)),this._globalCSE=new ft(this,this.importFunctionSafe("global",t),gt.global,this.generateNormalAccess.bind(this),this.importFunctionSafe("globalSecurityCheck",X)),h.renderCopy(this._templateElement,this._templateContent),this._extractChild)for(;this._templateContent.childElementCount>1;)this._templateContent.removeChild(this._templateContent.lastElementChild)},{addClassOneTimeTextBinding:function(e){var t=this,i=this.createTextBindingHole(e.elementCapture.element.tagName,"class",++this._textBindingId);e.textBindingId=i,e.kind=Ct.text,e.elementCapture.element.classList.add(i),e.elementCapture.refCount--,e.definition=function(){return t.formatCode("{htmlEscape}({value})",{htmlEscape:t._staticVariables.htmlEscape,value:e.value()})}},addClassOneTimeTreeBinding:function(e){var t=this;e.pathExpression=this.bindingExpression(e),e.value=function(){return e.pathExpression},e.kind=Ct.tree,e.definition=function(){return t.formatCode("{element}.classList.add({value})",{element:e.elementCapture,value:e.value()})}},analyze:function(){if(this._stage>St.analyze)throw"Illegal: once we have moved past analyze we cannot revist it";this._stage=St.analyze,this._controls=this.gatherControls(),this._bindings=this.gatherBindings(),this._children=this.gatherChildren(),this.cleanControlAndBindingAttributes(),this.async&&this.createAsyncParts(),this.nullableIdentifierAccessTemporary=this.defineInstance(gt.temporary);var e=this._templateContent.innerHTML;this._html=function(){return R(P(e))},this._html.text=e},bindingExpression:function(e){return this._dataCSE.createPathExpression(e.source,e.source.join("_"))},capture:function(e){var t=e._capture;if(t)return t.refCount++,t;for(var i=[e],n=e.parentNode,r=e.tagName;n!==this._templateContent;)r=n.tagName+"_"+r,i.unshift(n),n=n.parentNode;for(var s=0,o=i.length;o>s;s++){var a=i[s];i[s]=Array.prototype.indexOf.call(n.children,a),n=a}return t=this._captureCSE.createPathExpression(i,r.toLowerCase()),t.element=e,t.element._capture=t,t.refCount=1,t},cleanControlAndBindingAttributes:function(){for(var e="[data-win-bind],[data-win-control]",t=this._templateContent.querySelectorAll(e),i=0,n=t.length;n>i;i++){var r=t[i];r.isDeclarativeControlContainer&&(i+=r.querySelectorAll("[data-win-bind],[data-win-control]").length),r.removeAttribute("data-win-bind"),r.removeAttribute("data-win-control"),r.removeAttribute("data-win-options")}},compile:function(e,t,i){if(this._stage>St.compile)throw"Illegal: once we have moved past compile we cannot revist it";this._stage=St.compile;var n=this;this._returnedElement=this._extractChild?"container.firstElementChild":"container";var r,s,o=this._controls.map(function(e){var t;t=e.async?"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options}, controlDone)":"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options})";var i=n.formatCode(t,{target:e.elementCapture,SafeConstructor:e.SafeConstructor,options:n.generateOptionsLiteral(e.optionsParsed,e.elementCapture)});if(e.isDeclarativeControlContainer&&"function"==typeof e.isDeclarativeControlContainer.imported){var r=[i];return r.push(n.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedControlProcessing})",{target:e.elementCapture,isDeclarativeControlContainer:e.isDeclarativeControlContainer,delayedControlProcessing:n._staticVariables.ui_processAll})),r.push(n.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedBindingProcessing}(data, {templateDefaultInitializer}))",{target:e.elementCapture,isDeclarativeControlContainer:e.isDeclarativeControlContainer,delayedBindingProcessing:n._staticVariables.delayedBindingProcessing,templateDefaultInitializer:n._staticVariables.templateDefaultInitializer||P(null)})),r.join(";\n")}return i}),a=this._bindings.map(function(e){switch(e.kind){case Ct.template:return n.formatCode("({nestedTemplates}[{nestedTemplate}] = {template}.render({path}, {dest}))",{nestedTemplates:n._nestedTemplates,nestedTemplate:P(e.nestedTemplate),template:e.template,path:e.pathExpression,dest:e.elementCapture});case Ct.initializer:var t;return t=e.initialValue?"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}, {initialValue}))":"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}))",n.formatCode(t,{bindTokens:n._bindTokens,bindToken:P(e.bindToken),initializer:e.initializer,sourceProperties:P(e.source),destProperties:P(e.destination),dest:e.elementCapture,initialValue:e.initialValue});case Ct.tree:return e.definition();case Ct.text:break;case Ct.error:break;default:throw"NYI"}});i?(r=a.filter(function(e,t){return!n._bindings[t].delayable}),s=a.filter(function(e,t){return n._bindings[t].delayable})):(r=a,s=[]);var l=N(this._instanceVariables),c=l.filter(function(e){return e.kind===gt.variable}).map(function(e){return e.definition()}),u=this._captureCSE.definitions(),d=this._globalCSE.definitions(),h=this._dataCSE.definitions(),_=this._children.map(function(e){return n.formatCodeN("{0}.msParentSelectorScope = true",e)}),m=this._suffix.map(function(e){return e()}),p="";i&&s.length&&(p=n.formatCode(Dt,{delayed_binding_processing:S(s)}));var f=n.formatCode(e,H([this._staticVariables,t||{},{profilerMarkIdentifierStart:P("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StartTM"),profilerMarkIdentifierStop:P("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StopTM"),html:this._html(),tagName:P(this._templateElement.tagName),instance_variable_declarations:E(l),global_definitions:S(d),data_definitions:S(h),instance_variable_definitions:S(c),capture_definitions:S(u),set_msParentSelectorScope:S(_),debug_break:this.generateDebugBreak(),control_processing:S(o),control_counter:this._controlCounter,binding_processing:S(r),renderComplete:p,suffix_statements:S(m),nestedTemplates:this._nestedTemplates,returnedElement:this._returnedElement}]));return this.prettify(f)},createAsyncParts:function(){this._nestedTemplates=this._nestedTemplates||this.defineInstance(gt.variable,"nestedTemplates",function(){return T(0)}),this._controlCounter=this._controlCounter||this.defineInstance(gt.variable,"controlCounter",function(){return P(1)})},createTextBindingHole:function(e,t,i){if(!this._textBindingPrefix){for(var n="";-1!==this._html.text.indexOf("textbinding"+n);)n=n||0,n++;this._textBindingPrefix="textbinding"+n,this._textBindingRegex=new RegExp("(#?"+this._textBindingPrefix+"_\\d+)")}var r=this._textBindingPrefix+"_"+i;return"IMG"===e&&"src"===t&&(r="#"+r),r},deadCodeElimination:function(){var e=this;Object.keys(this._instanceVariables).forEach(function(t){var i=e._instanceVariables[t];i.kind===gt.capture&&(e._templateContent.contains(i.element)||(i.dead=!0),0===i.refCount&&(i.dead=!0),i.dead&&(i.definition=function(){},i.name=null,delete e._instanceVariables[t]))}),this._controls=this._controls.filter(function(e){return!e.elementCapture.dead}),this._bindings=this._bindings.filter(function(e){return!e.elementCapture.dead}),this._captureCSE.deadNodeElimination()},defineInstance:function(e,t,i){if(this._stage>=St.compile)throw"Illegal: define instance variable after compilation stage has started";var n=this._instanceVariablesCount[e]||0,r=t?t.replace(ut,"_"):"",s=O(vt[e],n,r);return s.definition=function(){return A(s,i())},s.kind=e,this._instanceVariables[s]=s,this._instanceVariablesCount[e]=n+1,s},defineStatic:function(e,t,i){if(this._stage>=St.link)throw"Illegal: define static variable after link stage has started";if(t){var n=this._staticVariables[t];if(n)return n}var r=t?t.replace(ut,"_"):"",s=O(bt[e],this._staticVariablesCount,r);return s.definition=function(){return A(s,i())},s.kind=e,this._staticVariables[t||s]=s,this._staticVariablesCount++,s},done:function(){if(this._stage>St.done)throw"Illegal: once we have moved past done we cannot revist it";this._stage=St.done},emitScopedSelect:function(e,t){return this.formatCode("{scopedSelect}({selector}, {element})",{scopedSelect:this._staticVariables.scopedSelect,selector:P(e),element:t})},emitOptionsNode:function(e,t,i){var n=this;if(e)switch(typeof e){case"object":if(Array.isArray(e)){t.push("[");for(var r=0,s=e.length;s>r;r++)this.emitOptionsNode(e[r],t,i),t.push(",");t.push("]")}else if(e instanceof rt)t.push("select"===e.target?this.emitScopedSelect(e.arg0Value,i):P(null));else if(e instanceof st&&e.parts[0]instanceof rt){var o=e.parts[0];t.push(k("select"===o.target?this.emitScopedSelect(o.arg0Value,i):P(null),e.parts.slice(1),this.nullableIdentifierAccessTemporary,this.importFunctionSafe("requireSupportedForProcessing",X)))}else e instanceof st?t.push(e.pathExpression):(t.push("{"),Object.keys(e).forEach(function(r){t.push(L(r)),t.push(":"),n.emitOptionsNode(e[r],t,i),t.push(",")}),t.push("}"));break;default:t.push(P(e))}else t.push(P(null))},findGlobalIdentifierExpressions:function(e,t){t=t||[];var i=this;return Object.keys(e).forEach(function(n){var r=e[n];"object"==typeof r&&(r instanceof st?r.parts[0]instanceof rt||t.push(r):i.findGlobalIdentifierExpressions(r,t))}),t},formatCodeN:function(){if(this._stage<St.compile)throw"Illegal: format code at before compilation stage has started";return C.apply(null,arguments)},formatCode:function(e,t){if(this._stage<St.compile)throw"Illegal: format code at before compilation stage has started";return C(e,t)},gatherBindings:function(){for(var e=-1,i=this,n=-1,r=[],s="[data-win-bind],[data-win-control]",o=this._templateContent.querySelectorAll(s),a=0,l=o.length;l>a;a++){var c=o[a];if(c.isDeclarativeControlContainer&&(a+=c.querySelectorAll(s).length),c.hasAttribute("data-win-bind")){var u=c.getAttribute("data-win-bind"),d=ot(u,t);d.forEach(function(t){if(t.initializer){var r=t.initializer.join("."),s=W(t.initializer);s.render?(X(s.render),t.template=i.importFunctionSafe(r,s),t.pathExpression=i.bindingExpression(t),t.nestedTemplate=++n,t.kind=Ct.template):s.winControl&&s.winControl.render?(X(s.winControl.render),t.template=i.importFunctionSafe(r,s.winControl),t.pathExpression=i.bindingExpression(t),t.nestedTemplate=++n,t.kind=Ct.template):(t.initializer=i.importFunction(r,s),t.bindToken=++e,t.kind=Ct.initializer)}else t.initializer=i.importFunctionSafe("templateDefaultInitializer",i._defaultInitializer),t.bindToken=++e,t.kind=Ct.initializer;t.elementCapture=i.capture(c),t.bindingText=u}),r.push.apply(r,d)}}var h=n+1;h>0&&(this.async=!0,this._nestedTemplates=this.defineInstance(gt.variable,"nestedTemplates",function(){return T(h)}));var _=e+1;return _>0&&(this._bindTokens=this.defineInstance(gt.variable,"bindTokens",function(){return T(_)}),this._suffix.push(function(){return i.formatCode("{utilities_data}(returnedElement).bindTokens = {bindTokens}",{utilities_data:i._staticVariables.utilities_data,bindTokens:i._bindTokens})})),r},gatherChildren:function(){var e=this;return Array.prototype.map.call(this._templateContent.children,function(t){return e.capture(t)})},gatherControls:function(){for(var e=this,i=0,r=[],s="[data-win-control]",o=this._templateContent.querySelectorAll(s),a=0,l=o.length;l>a;a++){var c=o[a],u=c.getAttribute("data-win-control"),d=n._getMemberFiltered(u.trim(),t,X);if(d){var h=c.getAttribute("data-win-options")||P({}),_=d.length>2;_&&(i++,this.async=!0);var m=d.isDeclarativeControlContainer;m&&("function"==typeof m&&(m=this.importFunction(u+"_isDeclarativeControlContainer",m)),c.isDeclarativeControlContainer=m,a+=c.querySelectorAll(s).length);var p={elementCapture:this.capture(c),name:u,SafeConstructor:this.importFunctionSafe(u,d),async:_,optionsText:P(h),optionsParsed:nt(h),isDeclarativeControlContainer:m};r.push(p);var f=this.findGlobalIdentifierExpressions(p.optionsParsed);f.forEach(function(t){t.pathExpression=e.globalExpression(t.parts)})}}return i>0&&(this._controlCounter=this.defineInstance(gt.variable,"controlCounter",function(){return P(i+1)})),r},generateElementCaptureAccess:function(e,t,i){if(i){var n=""+t=="0"?"":" + "+t;
return this.formatCodeN("{0}.children[startIndex{1}]",e,n)}return this.formatCodeN("{0}.children[{1}]",e,t)},generateNormalAccess:function(e,t,i,n,r){if(e.indexOf(this.nullableIdentifierAccessTemporary)>=0){var s;return s=r?"{left} && {filter}({temp}{right})":"{left} && ({temp} = {filter}({temp}{right}))",this.formatCode(s,{temp:this.nullableIdentifierAccessTemporary,left:e,right:x([t]),filter:n})}var s;return s=r?"({temp} = {left}) && {filter}({temp}{right})":"({temp} = {left}) && ({temp} = {filter}({temp}{right}))",this.formatCode(s,{temp:this.nullableIdentifierAccessTemporary,left:e,right:x([t]),filter:n})},generateOptionsLiteral:function(e,t){var i=[];return this.emitOptionsNode(e,i,t),i.join(" ")},generateDebugBreak:function(){if(this._debugBreak){var e=this.defineStatic(yt.variable,"debugCounter",function(){return P(0)});return this.formatCodeN("if (++{0} === 1) {{ debugger; }}",e)}return""},globalExpression:function(e){return this._globalCSE.createPathExpression(e,e.join("_"))},importFunction:function(e,t){return this.importFunctionSafe(e,X(t))},importFunctionSafe:function(e,t){var i=this,n=this.defineStatic(yt.imported,e,function(){return i.formatCodeN("({0}{1})",It,x([e]))});if(n.imported&&n.imported!==t)throw"Duplicate import: '"+e+"'";return n.imported=t,n},importAll:function(e){return Object.keys(e).forEach(function(t){X(e[t])}),this.importAllSafe(e)},importAllSafe:function(e){var t=this,i=Object.keys(e).reduce(function(i,n){return i[n]=t.importFunctionSafe(n,e[n]),i},{});return i},link:function(e){if(this._stage>St.link)throw"Illegal: once we have moved past link we cannot revist it";this._stage=St.link;var t=this,i=F(this._staticVariables).filter(function(e){return t._staticVariables[e].kind===yt.imported}).reduce(function(e,i){return e[i]=t._staticVariables[i].imported,e},{}),n=N(this._staticVariables);return new Function(It,this.formatCode(Rt,{static_variable_declarations:E(n),static_variable_definitions:S(n.map(function(e){return e.definition()})),body:e.trim()}))(i)},lower:function(){if(this._stage>St.lower)throw"Illegal: once we have moved past lower we cannot revist it";this._stage=St.lower,this._captureCSE.lower(),this._dataCSE.lower(),this._globalCSE.lower()},markBindingAsError:function(e){e&&(e.kind=Ct.error,this.markBindingAsError(e.original))},oneTimeTextBinding:function(e){var t=this,i=this.oneTimeTextBindingAnalyze(e);if(i){var n;e.original&&(n=e.original.initialValue);var r=this.createTextBindingHole(e.elementCapture.element.tagName,i.attribute,++this._textBindingId);switch(e.textBindingId=r,e.kind=Ct.text,e.elementCapture.refCount--,e.definition=function(){var i;return i=n?"{htmlEscape}({initialValue})":"{htmlEscape}({getter})",t.formatCode(i,{htmlEscape:t._staticVariables.htmlEscape,getter:e.value(),initialValue:n})},i.kind){case wt.attribute:e.elementCapture.element.setAttribute(i.attribute,r);break;case wt.booleanAttribute:e.elementCapture.element.setAttribute(i.attribute,r),e.definition=function(){var r;return r=n?'({initialValue} ? {attribute} : "")':'({value} ? {attribute} : "")',t.formatCode(r,{value:e.value(),attribute:P(i.attribute),initialValue:n})},this._htmlProcessors.push(function(e){return e.replace(new RegExp(i.attribute+'="'+r+'"',"i"),r)});break;case wt.textContent:e.elementCapture.element.textContent=r;break;case wt.inlineStyle:var s=e.elementCapture.element;if(!s.msReplaceStyle){s.msReplaceStyle=s.getAttribute("style")||"",""!==s.msReplaceStyle&&";"!==s.msReplaceStyle[s.msReplaceStyle.length-1]&&(s.msReplaceStyle=s.msReplaceStyle+";"),s.setAttribute("style","msReplaceStyle:'"+r+"'");var o=s.getAttribute("style");this._htmlProcessors.push(function(e){return e.replace(o,s.msReplaceStyle)})}s.msReplaceStyle=s.msReplaceStyle+i.property+":"+r+";";break;default:throw"NYI"}}},oneTimeTextBindingAnalyze:function(e){var t=e.elementCapture.element,i=t.tagName,n=e.destination[0];switch(i){case"A":switch(n){case"href":return{kind:wt.attribute,attribute:n}}break;case"IMG":switch(n){case"alt":case"src":case"width":case"height":return{kind:wt.attribute,attribute:n}}break;case"SELECT":switch(n){case"disabled":case"multiple":case"required":return{kind:wt.booleanAttribute,attribute:n};case"size":return{kind:wt.attribute,attribute:n}}break;case"OPTION":switch(n){case"label":case"value":return{kind:wt.attribute,attribute:n};case"disabled":case"selected":return{kind:wt.booleanAttribute,attribute:n}}break;case"INPUT":switch(n){case"checked":switch(t.type){case"checkbox":case"radio":return{kind:wt.booleanAttribute,attribute:n}}break;case"disabled":return{kind:wt.booleanAttribute,attribute:n};case"max":case"maxLength":case"min":case"step":case"value":return{kind:wt.attribute,attribute:n};case"size":switch(t.type){case"text":case"search":case"tel":case"url":case"email":case"password":return{kind:wt.attribute,attribute:n}}break;case"readOnly":switch(t.type){case"hidden":case"range":case"color":case"checkbox":case"radio":case"file":case"button":break;default:return{kind:wt.booleanAttribute,attribute:n}}}break;case"BUTTON":switch(n){case"disabled":return{kind:wt.booleanAttribute,attribute:n};case"value":return{kind:wt.attribute,attribute:n}}break;case"TEXTAREA":switch(n){case"disabled":case"readOnly":case"required":return{kind:wt.booleanAttribute,attribute:n};case"cols":case"maxLength":case"placeholder":case"rows":case"wrap":return{kind:wt.attribute,attribute:n}}}switch(n){case"className":return{kind:wt.attribute,attribute:"class"};case"dir":case"lang":case"name":case"title":case"tabIndex":return{kind:wt.attribute,attribute:n};case"style":if(e.destination.length>1){var r=e.destination[1];if("cssText"===r)return;var s="string"==typeof t.style[r];if(s)return("m"===r[0]&&"s"===r[1]||"webkit"===r.substring(0,6))&&(r="-"+r),r=r.replace(pt,function(e){return"-"+e.toLowerCase()}),{kind:wt.inlineStyle,property:r,attribute:"style"}}break;case"innerText":case"textContent":return{kind:wt.textContent,attribute:"textContent"}}},oneTimeTreeBinding:function(e){if(1===e.destination.length&&"id"===e.destination[0]){if(n.validation)throw new r("WinJS.Binding.IdBindingNotSupported",o._formatString(v.idBindingNotSupported,e.bindingText));return s.log&&s.log(o._formatString(v.idBindingNotSupported,e.bindingText),"winjs binding","error"),void this.markBindingAsError(e)}if(0===e.destination.length)return s.log&&s.log(v.cannotBindToThis,"winjs binding","error"),void this.markBindingAsError(e);var t,i=this;e.pathExpression=this.bindingExpression(e),e.value=function(){return e.pathExpression},e.original&&(t=e.pathExpression,e.original.initialValue=t),e.kind=Ct.tree,e.definition=function(){var n;return n=t?"({targetPath} || {{}}){prop} = {initialValue}":"({targetPath} || {{}}){prop} = {sourcePath}",i.formatCode(n,{targetPath:k(e.elementCapture,e.destination.slice(0,-1),i.nullableIdentifierAccessTemporary,i.importFunctionSafe("targetSecurityCheck",b)),prop:x(e.destination.slice(-1)),sourcePath:e.value(),initialValue:t})}},optimize:function(){if(this._stage>St.optimze)throw"Illegal: once we have moved past link we cannot revist it";this._stage=St.optimze;for(var e=0;e<this._bindings.length;e++){var t=this._bindings[e];if(!t.template)switch(t.initializer.imported){case j:var i=z(t,{kind:Ct.tree,initializer:this.importFunctionSafe("init_oneTime",J),original:t});i.elementCapture.refCount++,this.oneTimeTreeBinding(i),this._bindings.splice(e,0,i),t.delayable=!0,e++;break;case K:var i=z(t,{kind:Ct.tree,initializer:this.importFunctionSafe("init_setAttributeOneTime",G),original:t});i.elementCapture.refCount++,this.setAttributeOneTimeTreeBinding(i),this._bindings.splice(e,0,i),t.delayable=!0,e++;break;case J:this.oneTimeTreeBinding(t);break;case G:this.setAttributeOneTimeTreeBinding(t);break;case Y:this.addClassOneTimeTreeBinding(t);break;default:t.initializer&&(t.delayable=!!t.initializer.imported.delayable)}}if(this._optimizeTextBindings){for(var n={},e=0;e<this._bindings.length;e++){var t=this._bindings[e];if(!t.template&&t.kind!==Ct.error){switch(t.initializer.imported){case J:this.oneTimeTextBinding(t);break;case G:this.setAttributeOneTimeTextBinding(t);break;case Y:this.addClassOneTimeTextBinding(t)}t.textBindingId&&(n[t.textBindingId]=t)}}if(Object.keys(n).length){var r=this._templateContent.innerHTML;r=this._htmlProcessors.reduce(function(e,t){return t(e)},r);for(var s=r.split(this._textBindingRegex),e=1;e<s.length;e+=2){var t=n[s[e]];s[e]=t.definition}this._html=function(){var e=s.map(function(e){return"string"==typeof e?P(e):e()}).join(" + ");return R(e)}}}},prettify:function(e){var t=e.split("\n");return t.filter(function(e){return!mt.test(e)}).join("\n")},setAttributeOneTimeTextBinding:function(e){var t,i=this,n=e.destination[0],r=this.createTextBindingHole(e.elementCapture.element.tagName,n,++this._textBindingId);e.original&&(t=e.original.initialValue),e.textBindingId=r,e.kind=Ct.text,e.elementCapture.element.setAttribute(n,r),e.elementCapture.refCount--,e.definition=function(){var n;return n=t?"{htmlEscape}({initialValue})":"{htmlEscape}({value})",i.formatCode(n,{htmlEscape:i._staticVariables.htmlEscape,initialValue:t,value:e.value()})}},setAttributeOneTimeTreeBinding:function(e){if(1===e.destination.length&&"id"===e.destination[0]){if(n.validation)throw new r("WinJS.Binding.IdBindingNotSupported",o._formatString(v.idBindingNotSupported,e.bindingText));return s.log&&s.log(o._formatString(v.idBindingNotSupported,e.bindingText),"winjs binding","error"),void this.markBindingAsError(e)}if(1!==e.destination.length||!e.destination[0])return s.log&&s.log(v.attributeBindingSingleProperty,"winjs binding","error"),void this.markBindingAsError(e);var t,i=this;e.pathExpression=this.bindingExpression(e),e.value=function(){return e.pathExpression},e.original&&(t=this.defineInstance(gt.variable,"",e.value),e.original.initialValue=t),e.kind=Ct.tree,e.definition=function(){var n;return n=t?'{element}.setAttribute({attribute}, "" + {initialValue})':'{element}.setAttribute({attribute}, "" + {value})',i.formatCode(n,{element:e.elementCapture,attribute:P(e.destination[0]),initialValue:t,value:e.value()})}}},{_TreeCSE:ft,compile:function(i,n,r){if(!(n instanceof t.HTMLElement))throw"Illegal";lt("WinJS.Binding.Template:compile"+r.profilerMarkIdentifier+",StartTM");var s=new Et(n,r);s.analyze();var o=s.importAllSafe({Signal:m,global:t,document:t.document,cancelBlocker:q,promise_as:Z,disposeInstance:e,markDisposable:et,ui_processAll:tt,binding_processAll:it,insertAdjacentHTMLUnsafe:Q,promise:_,utilities_data:$,requireSupportedForProcessing:X,htmlEscape:D,scopedSelect:at,delayedBindingProcessing:y,writeProfilerMark:lt});s.optimize(),s.deadCodeElimination(),s.lower();var a,l;switch(r.target){case"render":a=s.async?Mt:At,l=!1;break;case"renderItem":a=s.async?Ot:Lt,l=!0}var c=s.compile(a,o,l),u=s.link(c);return s.done(),lt("WinJS.Binding.Template:compile"+r.profilerMarkIdentifier+",StopTM"),u}}),xt=V('container.classList.add("win-template");                                                              \nvar html = {html};                                                                                      \n{insertAdjacentHTMLUnsafe}(container, "beforeend", html);                                             \nreturnedElement = {returnedElement};                                                                    \n                                                                                                        \n// Capture Definitions                                                                                  \n{capture_definitions};                                                                                  \n{set_msParentSelectorScope};                                                                            \n                                                                                                        \n'),kt=V("// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \n// Binding Processing                                                                                   \n{binding_processing};                                                                                   \n                                                                                                        \nvar result = {promise_as}(returnedElement);                                                             \n"),Pt=V('var controlSignal = new {Signal}();                                                                     \nvar controlDone = function () {{ if (--{control_counter} === 0) {{ controlSignal.complete(); }} }};     \ncontrolDone();                                                                                          \n                                                                                                        \n// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \nvar result = controlSignal.promise.then(function () {{                                                  \n    // Binding Processing                                                                               \n    {binding_processing};                                                                               \n    return {promise}.join({nestedTemplates});                                                           \n}}).then(function () {{                                                                                 \n    return returnedElement;                                                                             \n}}).then(null, function (e) {{                                                                          \n    if (typeof e === "object" && e.name === "Canceled") {{ returnedElement.dispose(); }}            \n    return {promise}.wrapError(e);                                                                      \n}});                                                                                                    \n'),Tt=V("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result); }});       \n{suffix_statements};                                                                                    \n"),At=V('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data); }});                   \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+I(w(4,xt))+"                                           \n                                                                                                        \n    "+I(w(4,kt))+"                                      \n    "+I(w(4,Tt))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),Mt=V('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data, container); }});        \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+I(w(4,xt))+"                                           \n                                                                                                        \n    "+I(w(4,Pt))+"                                 \n    "+I(w(4,Tt))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),Bt=V("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result, renderComplete); }});\n{suffix_statements};                                                                                    \n"),Lt=V('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+I(w(8,xt))+"                                       \n                                                                                                        \n        "+I(w(8,kt))+"                                  \n        "+I(w(8,Bt))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),Dt=V("renderComplete = element.then(function () {{                                                            \n    return itemPromise;                                                                                 \n}}).then(function (item) {{                                                                             \n    return item.ready || item;                                                                          \n}}).then(function (item) {{                                                                             \n    {delayed_binding_processing};                                                                       \n    return element;                                                                                     \n}});                                                                                                    \n"),Ot=V('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+I(w(8,xt))+"                                       \n                                                                                                        \n        "+I(w(8,Pt))+"                             \n        "+I(w(8,Bt))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),Rt=V('"use strict";                                                                                         \n                                                                                                        \n// statics                                                                                              \nvar {static_variable_declarations};                                                                     \n{static_variable_definitions};                                                                          \n                                                                                                        \n// generated template rendering function                                                                \nreturn {body};                                                                                          \n');
return Et})})}}),define("WinJS/BindingTemplate",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_WriteProfilerMark","./Binding/_Declarative","./BindingTemplate/_DataTemplateCompiler","./ControlProcessor","./Fragments","./Promise","./Utilities/_Dispose","./Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_){"use strict";if(t.document){var m=d._cancelBlocker;n.Namespace._moduleDefine(e,"WinJS.Binding",{Template:n.Namespace._lazy(function(){function e(e,i,n){function r(){return _.removeClass(l,"win-loading"),o("WinJS.Binding:templateRender"+e._profilerMarkIdentifier+",StopTM"),g||l}o("WinJS.Binding:templateRender"+e._profilerMarkIdentifier+",StartTM"),1===++e._counter&&(e.debugBreakOnRender||p._debugBreakOnRender);var s=d.wrap(),l=n||t.document.createElement(e.element.tagName);_.addClass(l,"win-template"),_.addClass(l,"win-loading");var f,g,v=e,y=l.children.length,b=function(){var e=_.data(l).winBindings;e&&e.forEach(function(e){e.cancel()}),s.cancel()};e.extractChild?f=u.renderCopy(v.href||v.element,t.document.createElement(v.element.tagName)).then(function(e){var t=e.firstElementChild;return g=t,h.markDisposable(t,b),l.appendChild(t),t}):(h.markDisposable(l,b),f=u.renderCopy(v.href||v.element,l));var C=f.then(function(){function e(){return t(c.processAll).then(function(){return m(i)}).then(function(e){return t(a.processAll,e,!g&&!y,v.bindingCache)}).then(null,function(e){return"object"==typeof e&&"Canceled"===e.name&&(g||l).dispose(),d.wrapError(e)})}var t;if(0===y)t=function(e,t,i,n){return e(g||l,t,i,n)};else{var n=l.children;if(n.length===y+1)t=function(e,t,i,r){return e(n[y],t,i,r)};else{for(var r=[],o=y,u=n.length;u>o;o++)r.push(n[o]);t=function(e,t,i,n){var s=[];return r.forEach(function(r){s.push(e(r,t,i,n))}),d.join(s)}}}for(var h=l.firstElementChild;h;)h.msParentSelectorScope=!0,h=h.nextElementSibling;var _=v.processTimeout;return _?(0>_&&(_=0),d.timeout(_).then(function(){return s=e()})):s=e()}).then(r,function(e){return r(),d.wrapError(e)});return{element:f,renderComplete:C}}var p=n.Class.define(function(e,i){this._element=e||t.document.createElement("div"),this._element.winControl=this,this._profilerMarkIdentifier=r._getProfilerMarkIdentifier(this._element),o("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StartTM");var n=this;this._element.renderItem=function(e,t){return n._renderItemImpl(e,t)},i=i||{},this.href=i.href,this.enableRecycling=!!i.enableRecycling,this.processTimeout=i.processTimeout||0,this.bindingInitializer=i.bindingInitializer,this.debugBreakOnRender=i.debugBreakOnRender,this.disableOptimizedProcessing=i.disableOptimizedProcessing,this.extractChild=i.extractChild,this._counter=0,this._compile=!!i._compile,this.href||(this.element.style.display="none"),this.bindingCache={expressions:{}},o("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StopTM")},{_shouldCompile:{get:function(){var e=!0;return e=e&&!p._interpretAll,e=e&&!this.disableOptimizedProcessing,e&&(e=e&&0===this.processTimeout,e=e&&(!this.href||this.href instanceof t.HTMLElement),e||s.log&&s.log("Cannot compile templates which use processTimeout or href properties","winjs binding","warn")),e}},bindingInitializer:{get:function(){return this._bindingInitializer},set:function(e){this._bindingInitializer=e,this._reset()}},debugBreakOnRender:{get:function(){return this._debugBreakOnRender},set:function(e){this._debugBreakOnRender=!!e,this._reset()}},disableOptimizedProcessing:{get:function(){return this._disableOptimizedProcessing},set:function(e){this._disableOptimizedProcessing=!!e,this._reset()}},element:{get:function(){return this._element}},extractChild:{get:function(){return this._extractChild},set:function(e){this._extractChild=!!e,this._reset()}},processTimeout:{get:function(){return this._processTimeout||0},set:function(e){this._processTimeout=e,this._reset()}},render:r.markSupportedForProcessing(function(e,t){return this._renderImpl(e,t)}),_renderImpl:function(t,i){if(this._shouldCompile)try{return this._renderImpl=this._compileTemplate({target:"render"}),this._renderImpl(t,i)}catch(n){return d.wrapError(n)}var r=e(this,t,i);return r.element.then(function(){return r.renderComplete})},_renderInterpreted:function(t,i){return e(this,t,i)},renderItem:function(e,t){return this._renderItemImpl(e,t)},_renderItemImpl:function(t,i){if(this._shouldCompile)try{return this._renderItemImpl=this._compileTemplate({target:"renderItem"}),this._renderItemImpl(t)}catch(n){return{element:d.wrapError(n),renderComplete:d.wrapError(n)}}var r=this;if(this.enableRecycling&&!this.bindingCache.elements&&(this.bindingCache.elements={}),this.enableRecycling&&i&&i.msOriginalTemplate===this){var s=this.bindingCache.elements[i.id],o=!0;if(s&&(s.bindings.forEach(function(e){e()}),s.bindings=[],o=!s.nocache),o)return{element:i,renderComplete:t.then(function(e){return a.processAll(i,e.data,!0,r.bindingCache)})}}var l=e(this,t.then(function(e){return e.data}));return l.element=l.element.then(function(e){return e.msOriginalTemplate=r,e}),l},_compileTemplate:function(e){var t=this,n=l._TemplateCompiler.compile(this,this.href||this.element,{debugBreakOnRender:this.debugBreakOnRender||p._debugBreakOnRender,defaultInitializer:this.bindingInitializer||e.defaultInitializer,disableTextBindingOptimization:e.disableTextBindingOptimization||!1,target:e.target,extractChild:this.extractChild,profilerMarkIdentifier:this._profilerMarkIdentifier}),r=e.resetOnFragmentChange||i.Windows.ApplicationModel.DesignMode.designModeEnabled;if(r){var s=new _._MutationObserver(function(){t._reset(),s.disconnect()});s.observe(_.data(this.element).docFragment,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}return n},_reset:function(){delete this._renderImpl,delete this._renderItemImpl}},{isDeclarativeControlContainer:{value:!0,writable:!1,configurable:!1},render:{value:function(e,t,i){return new p(null,{href:e}).render(t,i)}}});return p})})}}),define("WinJS/BindingList/_BindingListDataSource",["exports","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Binding/_DomWeakRefTable","../Promise","../Scheduler","../Utilities/_UI"],function(e,t,i,n,r,s,o,a){"use strict";i.Namespace._moduleDefine(e,"WinJS.Binding",{_BindingListDataSource:i.Namespace._lazy(function(){function e(e,t){for(var i=e.length;i-1>t;){var n=e.getItem(++t);if(n)return n.key}return null}function l(e,t){for(;t>0;){var i=e.getItem(--t);if(i)return i.key}return null}function c(e,t){Object.keys(t).forEach(function(i){e.addEventListener(i,t[i])})}function u(e,t){Object.keys(t).forEach(function(i){e.removeEventListener(i,t[i])})}function d(e,t){return t?new k(e,t):new x}function h(e,t,i){return t?new P(e,t,i):new x}function _(e,t,i){return t&&e._annotateWithIndex(t,i)}function m(e,t){return this._list.unshift(t),this.itemFromIndex(0)}function p(e,t,i){var n=this._list.indexOfKey(i);return-1===n?S.noLongerMeaningful:(this._list.splice(n,0,t),this.itemFromIndex(n))}function f(e,t,i){var n=this._list.indexOfKey(i);return-1===n?S.noLongerMeaningful:(n+=1,this._list.splice(n,0,t),this.itemFromIndex(n))}function g(e,t){return this._list.push(t),this.itemFromIndex(this._list.length-1)}function v(e,t){var i=this._list.indexOfKey(e);return-1===i?S.noLongerMeaningful:(this._list.setAt(i,t),this.itemFromIndex(i))}function y(e){var t=this._list.indexOfKey(e);if(-1===t)return S.noLongerMeaningful;var i=0;return this._list.move(t,i),this.itemFromIndex(i)}function b(e,t){var i=this._list.indexOfKey(e),n=this._list.indexOfKey(t);return-1===i||-1===n?S.noLongerMeaningful:(n=n>i?n-1:n,this._list.move(i,n),this.itemFromIndex(n))}function C(e,t){var i=this._list.indexOfKey(e),n=this._list.indexOfKey(t);return-1===i||-1===n?S.noLongerMeaningful:(n=n>=i?n:n+1,this._list.move(i,n),this.itemFromIndex(n))}function w(e){var t=this._list.indexOfKey(e);if(-1===t)return S.noLongerMeaningful;var i=this._list.length-1;return this._list.move(t,i),this.itemFromIndex(i)}function I(e){var t=this._list.indexOfKey(e);return-1===t?S.noLongerMeaningful:(this._list.splice(t,1),s.wrap())}var S={get noLongerMeaningful(){return s.wrapError(new n(a.EditError.noLongerMeaningful))}},E=s.wrap().constructor,x=i.Class.derive(E,function(){this._value=null},{release:function(){},retain:function(){return this}},{supportedForProcessing:!1}),k=i.Class.derive(E,function(e,t){this._value=t,this._listBinding=e},{handle:{get:function(){return this._value.key}},index:{get:function(){return this._value.index}},release:function(){this._listBinding._release(this._value,this._listBinding._list.indexOfKey(this._value.key))},retain:function(){return this._listBinding._addRef(this._value,this._listBinding._list.indexOfKey(this._value.key)),this}},{supportedForProcessing:!1}),P=i.Class.derive(s,function(e,t,i){var n=this;this._item=t,this._listBinding=e,s.call(this,function(r){o.schedule(function(){return e._released?void n.cancel():void r(t)},o.Priority.normal,null,"WinJS.Binding.List."+i)})},{handle:{get:function(){return this._item.key}},index:{get:function(){return this._item.index}},release:function(){this._listBinding._release(this._item,this._listBinding._list.indexOfKey(this._item.key))},retain:function(){return this._listBinding._addRef(this._item,this._listBinding._list.indexOfKey(this._item.key)),this}},{supportedForProcessing:!1}),T=i.Class.define(function(e,i,n,s){this._dataSource=e,this._list=i,this._editsCount=0,this._notificationHandler=n,this._pos=-1,this._retained=[],this._retained.length=i.length,this._retainedKeys={},this._affectedRange=null;var o=null;if(t.msSetWeakWinRTProperty&&t.msGetWeakWinRTProperty||(o=this),n){var a=function(e,t){var i=r._getWeakRefElement(s)||o;return i?(i["_"+e](t),!0):!1};this._handlers={itemchanged:function l(e){a("itemchanged",e)||i.removeEventListener("itemchanged",l)},iteminserted:function u(e){a("iteminserted",e)||i.removeEventListener("iteminserted",u)},itemmoved:function d(e){a("itemmoved",e)||i.removeEventListener("itemmoved",d)},itemremoved:function h(e){a("itemremoved",e)||i.removeEventListener("itemremoved",h)},reload:function _(){a("reload")||i.removeEventListener("reload",_)}},c(this._list,this._handlers)}},{_itemchanged:function(e){var t=e.detail.key,i=e.detail.index;this._updateAffectedRange(i,"changed");var n=e.detail.newItem,r=this._retained[i];if(r){var s=this._notificationHandler;if(r.index!==i){var o=r.index;r.index=i,s&&s.indexChanged&&s.indexChanged(n.key,i,o)}n=_(this._list,n,i),n._retainedCount=r._retainedCount,this._retained[i]=n,this._retainedKeys[t]=n,this._beginEdits(this._list.length),s&&s.changed&&s.changed(n,r),this._endEdits()}else this._beginEdits(this._list.length),this._endEdits()},_iteminserted:function(t){var i=t.detail.index;this._updateAffectedRange(i,"inserted"),this._beginEdits(this._list.length-1),i<=this._pos&&(this._pos=Math.min(this._pos+1,this._list.length));var n=this._retained;if(n.splice(i,0,0),delete n[i],this._shouldNotify(i)||1===this._list.length){var r=this._notificationHandler;r&&r.inserted&&r.inserted(d(this,_(this._list,this._list.getItem(i),i)),l(this._list,i),e(this._list,i))}this._endEdits()},_itemmoved:function(e){var t=e.detail.oldIndex,i=e.detail.newIndex;this._updateAffectedRange(t,"moved"),this._updateAffectedRange(i,"moved"),this._beginEdits(this._list.length),(t<this._pos||i<=this._pos)&&(i>this._pos?this._pos=Math.max(-1,this._pos-1):t>this._pos&&(this._pos=Math.min(this._pos+1,this._list.length)));var n=this._retained,r=n.splice(t,1)[0];n.splice(i,0,r),r||(delete n[i],r=_(this._list,this._list.getItem(i),i)),r._moved=!0,this._addRef(r,i),this._endEdits()},_itemremoved:function(e){var t=e.detail.key,i=e.detail.index;this._updateAffectedRange(i,"removed"),this._beginEdits(this._list.length+1),i<this._pos&&(this._pos=Math.max(-1,this._pos-1));var n=this._retained,r=this._retainedKeys,s=i in n;n.splice(i,1),delete r[t];var o=this._notificationHandler;s&&o&&o.removed&&o.removed(t,!1),this._endEdits()},_reload:function(){this._retained=[],this._retainedKeys={};var e=this._notificationHandler;e&&e.reload&&e.reload()},_addRef:function(e,t){t in this._retained?this._retained[t]._retainedCount++:(this._retained[t]=e,this._retainedKeys[e.key]=e,e._retainedCount=1)},_release:function(e,t){var i=this._retained[t];i&&(1===i._retainedCount?(delete this._retained[t],delete this._retainedKeys[i.key]):i._retainedCount--)},_shouldNotify:function(e){var t=this._retained;return e in t||e+1 in t||e-1 in t},_updateAffectedRange:function(e,t){if(this._notificationHandler.affectedRange){var i=e,n="removed"!==t?e+1:e;if(this._affectedRange){switch(t){case"inserted":e<=this._affectedRange.end&&++this._affectedRange.end;break;case"removed":e<this._affectedRange.end&&--this._affectedRange.end;break;case"moved":case"changed":}this._affectedRange.start=Math.min(this._affectedRange.start,i),this._affectedRange.end=Math.max(this._affectedRange.end,n)}else this._affectedRange={start:i,end:n}}},_notifyAffectedRange:function(){this._affectedRange&&(this._notificationHandler&&this._notificationHandler.affectedRange&&this._notificationHandler.affectedRange(this._affectedRange),this._affectedRange=null)},_notifyCountChanged:function(){var e=this._countAtBeginEdits,t=this._list.length;if(e!==t){var i=this._notificationHandler;i&&i.countChanged&&i.countChanged(t,e)}},_notifyIndicesChanged:function(){for(var e=this._retained,t=0,i=e.length;i>t;t++){var n=e[t];if(n&&n.index!==t){var r=t,s=n.index;n.index=r;var o=this._notificationHandler;o&&o.indexChanged&&o.indexChanged(n.key,r,s)}}},_notifyMoved:function(){for(var t=this._retained,i=0,n=t.length;n>i;i++){var r=t[i];if(r&&r._moved&&(r._moved=!1,this._release(r,i),this._shouldNotify(i))){var s=this._notificationHandler;s&&s.moved&&s.moved(d(this,r),l(this._list,i),e(this._list,i))}}},_beginEdits:function(e,t){this._editsCount++;var i=this._notificationHandler;if(1===this._editsCount&&i){if(!t){this._editsCount++;var n=this;o.schedule(function(){n._endEdits()},o.Priority.high,null,"WinJS.Binding.List._endEdits")}i.beginNotifications&&i.beginNotifications(),this._countAtBeginEdits=e}},_endEdits:function(){this._editsCount--;var e=this._notificationHandler;0===this._editsCount&&e&&(this._notifyIndicesChanged(),this._notifyMoved(),this._notifyCountChanged(),this._notifyAffectedRange(),e.endNotifications&&e.endNotifications())},jumpToItem:function(e){var t=this._list.indexOfKey(e.handle);return-1===t?s.wrap(null):(this._pos=t,this.current())},current:function(){return this.fromIndex(this._pos)},previous:function(){return this._pos=Math.max(-1,this._pos-1),this._fromIndex(this._pos,!0,"previous")},next:function(){return this._pos=Math.min(this._pos+1,this._list.length),this._fromIndex(this._pos,!0,"next")},releaseItem:function(e){e.release?e.release():this._release(e,this._list.indexOfKey(e.key))},release:function(){this._notificationHandler&&u(this._list,this._handlers),this._notificationHandler=null,this._dataSource._releaseBinding(this),this._released=!0},first:function(){return this.fromIndex(0)},last:function(){return this.fromIndex(this._list.length-1)},fromKey:function(e){var t,i=this._retainedKeys;return t=e in i?i[e]:_(this._list,this._list.getItemFromKey(e),this._list.indexOfKey(e)),d(this,t)},fromIndex:function(e){return this._fromIndex(e,!1,"fromIndex")},_fromIndex:function(e,t,i){var n,r=this._retained;return n=e in r?r[e]:_(this._list,this._list.getItem(e),e),t?h(this,n,i):d(this,n)}},{supportedForProcessing:!1}),A=0,M=i.Class.define(function(e){this._usingWeakRef=t.msSetWeakWinRTProperty&&t.msGetWeakWinRTProperty,this._bindings={},this._list=e,e.unshift&&(this.insertAtStart=m),e.push&&(this.insertAtEnd=g),e.setAt&&(this.change=v),e.splice&&(this.insertAfter=f,this.insertBefore=p,this.remove=I),e.move&&(this.moveAfter=C,this.moveBefore=b,this.moveToEnd=w,this.moveToStart=y)},{_releaseBinding:function(e){delete this._bindings[e._id]},addEventListener:function(){},removeEventListener:function(){},createListBinding:function(e){var t="ds_"+ ++A,i=new T(this,this._list,e,t);return i._id=t,this._usingWeakRef?(r._createWeakRef(i,t),this._bindings[t]=t):this._bindings[t]=i,i},getCount:function(){return s.wrap(this._list.length)},itemFromKey:function(e){var t=this._list,i=_(t,t.getItemFromKey(e),-1);return Object.defineProperty(i,"index",{get:function(){return t.indexOfKey(e)},enumerable:!1,configurable:!0}),s.wrap(i)},itemFromIndex:function(e){return s.wrap(_(this._list,this._list.getItem(e),e))},list:{get:function(){return this._list}},beginEdits:function(){var e=this._list.length;this._forEachBinding(function(t){t._beginEdits(e,!0)})},endEdits:function(){this._forEachBinding(function(e){e._endEdits()})},_forEachBinding:function(e){if(this._usingWeakRef){var t=[];Object.keys(this._bindings).forEach(function(i){var n=r._getWeakRefElement(i);n?e(n):t.push(i)});for(var i=0,n=t.length;n>i;i++)delete this._bindings[t[i]]}else{var s=this;Object.keys(this._bindings).forEach(function(t){e(s._bindings[t])})}},invalidateAll:function(){return s.wrap()},moveAfter:void 0,moveBefore:void 0,moveToEnd:void 0,moveToStart:void 0},{supportedForProcessing:!1});return M})})}),define("WinJS/BindingList",["exports","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Resources","./Binding/_Data","./BindingList/_BindingListDataSource"],function(e,t,i,n,r,s,o,a){"use strict";function l(e){return Array.prototype.slice.call(e,0)}function c(e){return{handle:e.handle,key:e.key,data:e.data,groupKey:e.groupKey,groupSize:e.groupSize,firstItemKey:e.firstItemKey,firstItemIndexHint:e.firstItemIndexHint}}function u(e){return void 0===e?void 0:+e}function d(e,t){function i(t,i){for(;i>t;t++)e[t]=s[t]}function n(e,t){if(!(2>t-e)){var s=Math.floor((t+e)/2);n(e,s),n(s,t),r(e,s,t),i(e,t)}}function r(i,n,r){for(var o=i,a=n,l=i;r>l;l++)n>o&&(a>=r||t(e[o],e[a])<=0)?(s[l]=e[o],o++):(s[l]=e[a],a++)}var s=new Array(e.length);return n(0,e.length),e}var h={get sparseArrayNotSupported(){return"Sparse arrays are not supported with proxy: true"},get illegalListLength(){return"List length must be assigned a finite positive number"}},_=r._createEventProperty,m={},p=t.Namespace.defineWithParent(null,null,{ListBase:t.Namespace._lazy(function(){var e=t.Class.define(null,{_annotateWithIndex:function(e,t){var i=c(e);return i.index=t,i},onitemchanged:_("itemchanged"),oniteminserted:_("iteminserted"),onitemmoved:_("itemmoved"),onitemmutated:_("itemmutated"),onitemremoved:_("itemremoved"),onreload:_("reload"),_notifyItemChanged:function(e,t,i,n,r,s){this._listeners&&this._listeners.itemchanged&&this.dispatchEvent("itemchanged",{key:e,index:t,oldValue:i,newValue:n,oldItem:r,newItem:s})},_notifyItemInserted:function(e,t,i){this._listeners&&this._listeners.iteminserted&&this.dispatchEvent("iteminserted",{key:e,index:t,value:i});var n=this.length;n!==this._lastNotifyLength&&(this.notify("length",n,this._lastNotifyLength),this._lastNotifyLength=n)},_notifyItemMoved:function(e,t,i,n){this._listeners&&this._listeners.itemmoved&&this.dispatchEvent("itemmoved",{key:e,oldIndex:t,newIndex:i,value:n})},_notifyItemMutated:function(e,t,i){this._listeners&&this._listeners.itemmutated&&this.dispatchEvent("itemmutated",{key:e,value:t,item:i})},_notifyItemRemoved:function(e,t,i,n){this._listeners&&this._listeners.itemremoved&&this.dispatchEvent("itemremoved",{key:e,index:t,value:i,item:n});var r=this.length;r!==this._lastNotifyLength&&(this.notify("length",r,this._lastNotifyLength),this._lastNotifyLength=r)},_notifyReload:function(){if(this._listeners&&this._listeners.reload&&this.dispatchEvent("reload"),e!==this._lastNotifyLength){var e=this.length;this.notify("length",e,this._lastNotifyLength),this._lastNotifyLength=e}},_normalizeIndex:function(e){return e=u(e),0>e?this.length+e:e},_notifyMutatedFromKey:function(e){var t=this.getItemFromKey(e);this._notifyItemMutated(e,t.data,t)},notifyReload:function(){this._notifyReload()},getAt:function(e){e=u(e);var t=this.getItem(e);return t&&t.data},_getArray:function(){for(var e=new Array(this.length),t=0,i=this.length;i>t;t++){var n=this.getItem(t);n&&(e[t]=n.data)}return e},_getFromKey:function(e){var t=this.getItemFromKey(e);return t&&t.data},_getKey:function(e){e=u(e);var t=this.getItem(e);return t&&t.key},concat:function(){var e=this._getArray();return e.concat.apply(e,arguments)},join:function(e){return this._getArray().join(e||",")},slice:function(e,t){return this._getArray().slice(e,t)},indexOf:function(e,t){t=u(t),t=Math.max(0,this._normalizeIndex(t)||0);for(var i=t,n=this.length;n>i;i++){var r=this.getItem(i);if(r&&r.data===e)return i}return-1},lastIndexOf:function(e,t){t=u(t);var i=this.length;t=Math.min(this._normalizeIndex(void 0!==t?t:i),i-1);var n;for(n=t;n>=0;n--){var r=this.getItem(n);if(r&&r.data===e)return n}return-1},every:function(e,t){return this._getArray().every(e,t)},filter:function(e,t){return this._getArray().filter(e,t)},forEach:function(e,t){this._getArray().forEach(e,t)},map:function(e,t){return this._getArray().map(e,t)},some:function(e,t){return this._getArray().some(e,t)},reduce:function(e,t){return arguments.length>1?this._getArray().reduce(e,t):this._getArray().reduce(e)},reduceRight:function(e,t){return arguments.length>1?this._getArray().reduceRight(e,t):this._getArray().reduceRight(e)},createFiltered:function(e){return new p.FilteredListProjection(this,e)},createGrouped:function(e,t,i){return new p.GroupedSortedListProjection(this,e,t,i)},createSorted:function(e){return new p.SortedListProjection(this,e)},dataSource:{get:function(){return this._dataSource=this._dataSource||new a._BindingListDataSource(this)}}},{supportedForProcessing:!1});return t.Class.mix(e,o.observableMixin),t.Class.mix(e,r.eventMixin),e}),ListBaseWithMutators:t.Namespace._lazy(function(){return t.Class.derive(p.ListBase,null,{pop:function(){return this.splice(-1,1)[0]},push:function(e){if(1===arguments.length)return this.splice(this.length,0,e),this.length;var t=l(arguments);return t.splice(0,0,this.length,0),this.splice.apply(this,t),this.length},shift:function(){return this.splice(0,1)[0]},unshift:function(e){if(1===arguments.length)this.splice(0,0,e);else{var t=l(arguments);t.splice(0,0,0,0),this.splice.apply(this,t)}return this.length}},{supportedForProcessing:!1})}),ListProjection:t.Namespace._lazy(function(){return t.Class.derive(p.ListBaseWithMutators,null,{_list:null,_myListeners:null,_addListListener:function(e,t){var i={name:e,handler:t.bind(this)};this._myListeners=this._myListeners||[],this._myListeners.push(i),this._list.addEventListener(e,i.handler)},dispose:function(){var t=this._list,i=this._myListeners;this._myListeners=[];for(var n=0,r=i.length;r>n;n++){var s=i[n];t.removeEventListener(s.name,s.handler)}this._list=new e.List,this._listReload()},getItemFromKey:function(e){return this._list.getItemFromKey(e)},move:function(e,t){e=u(e),t=u(t),e===t||0>e||0>t||e>=this.length||t>=this.length||(e=this._list.indexOfKey(this._getKey(e)),t=this._list.indexOfKey(this._getKey(t)),this._list.move(e,t))},_notifyMutatedFromKey:function(e){this._list._notifyMutatedFromKey(e)},splice:function(e){e=u(e),e=Math.max(0,this._normalizeIndex(e));var t=l(arguments);return e===this.length?(t[0]=this._list.length,this._list.splice.apply(this._list,t)):(t[0]=this._getKey(e),this._spliceFromKey.apply(this,t))},_setAtKey:function(e,t){this._list._setAtKey(e,t)}},{supportedForProcessing:!1})}),FilteredListProjection:t.Namespace._lazy(function(){return t.Class.derive(p.ListProjection,function(e,t){this._list=e,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmutated",this._listItemMutated),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._filter=t,this._initFilteredKeys()},{_filter:null,_filteredKeys:null,_initFilteredKeys:function(){for(var e=this._filter,t=this._list,i=[],n=0,r=t.length;r>n;n++){var s=t.getItem(n);s&&e(s.data)&&i.push(s.key)}this._filteredKeys=i},_findInsertionPosition:function(e,t){for(var i,n=this._filter;--t>=0;){var r=this._list.getItem(t);if(r&&n(r.data)){i=r.key;break}}var s=this._filteredKeys,o=i?s.indexOf(i)+1:0;return o},_listItemChanged:function(e){var t=e.detail.key,i=e.detail.index,n=e.detail.oldValue,r=e.detail.newValue,s=e.detail.oldItem,o=e.detail.newItem,a=this._filter,l=a(n),c=a(r);if(l&&c){var u=this._filteredKeys,d=u.indexOf(t);this._notifyItemChanged(t,d,n,r,s,o)}else l&&!c?this._listItemRemoved({detail:{key:t,index:i,value:n,item:s}}):!l&&c&&this._listItemInserted({detail:{key:t,index:i,value:r}})},_listItemInserted:function(e){var t=e.detail.key,i=e.detail.index,n=e.detail.value,r=this._filter;if(r(n)){var s=this._findInsertionPosition(t,i),o=this._filteredKeys;o.splice(s,0,t),this._notifyItemInserted(t,s,n)}},_listItemMoved:function(e){var t=e.detail.key,i=e.detail.newIndex,n=e.detail.value,r=this._filteredKeys,s=r.indexOf(t);if(-1!==s){r.splice(s,1);var o=this._findInsertionPosition(t,i);r.splice(o,0,t),this._notifyItemMoved(t,s,o,n)}},_listItemMutated:function(e){var t=e.detail.key,i=e.detail.value,n=e.detail.item,r=this._filter,s=this._filteredKeys,o=s.indexOf(t),a=-1!==o,l=r(i);a&&l?this._notifyItemMutated(t,i,n):a&&!l?(s.splice(o,1),this._notifyItemRemoved(t,o,i,n)):!a&&l&&this._listItemInserted({detail:{key:t,index:this._list.indexOfKey(t),value:i}})},_listItemRemoved:function(e){var t=e.detail.key,i=e.detail.value,n=e.detail.item,r=this._filteredKeys,s=r.indexOf(t);-1!==s&&(r.splice(s,1),this._notifyItemRemoved(t,s,i,n))},_listReload:function(){this._initFilteredKeys(),this._notifyReload()},length:{get:function(){return this._filteredKeys.length},set:function(e){if(!("number"==typeof e&&e>=0))throw new n("WinJS.Binding.List.IllegalLength",h.illegalListLength);var t=this.length;t>e&&this.splice(e,t-e)}},getItem:function(e){return e=u(e),this.getItemFromKey(this._filteredKeys[e])},indexOfKey:function(e){return this._filteredKeys.indexOf(e)},notifyMutated:function(e){return e=u(e),this._notifyMutatedFromKey(this._filteredKeys[e])},setAt:function(e,t){e=u(e),this._setAtKey(this._filteredKeys[e],t)},_spliceFromKey:function(e,t){if(arguments.length>2){var i=l(arguments);i[1]=0,this._list._spliceFromKey.apply(this._list,i)}var n=[];if(t){for(var r=[],s=this._filteredKeys,o=s.indexOf(e),a=o,c=s.length;c>a&&t>a-o;a++){var e=s[a];r.push(e)}var u=this;r.forEach(function(e){n.push(u._list._spliceFromKey(e,1)[0])})}return n}},{supportedForProcessing:!1})}),SortedListProjection:t.Namespace._lazy(function(){return t.Class.derive(p.ListProjection,function(e,t){this._list=e,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemmutated",this._listItemMutated),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._sortFunction=t,this._initSortedKeys()},{_sortFunction:null,_sortedKeys:null,_initSortedKeys:function(){for(var e=this._list,t=[],i=0,n=e.length;n>i;i++){var r=e.getItem(i);r&&(t[i]=r.key)}var s=this._sortFunction,o=d(t,function(t,i){return t=e.getItemFromKey(t).data,i=e.getItemFromKey(i).data,s(t,i)});this._sortedKeys=o},_findInsertionPos:function(e,t,i,n,r){for(var s=this._sortFunction,o=this._sortedKeys,a=Math.max(0,n||-1),l=Math.min(o.length,r||Number.MAX_VALUE),c=a;l>=a;){c=(a+l)/2>>>0;var u=o[c];if(!u)break;var d=this.getItemFromKey(u),h=s(d.data,i);if(0>h)a=c+1;else{if(0===h)return this._findStableInsertionPos(e,t,a,l,c,i);l=c-1}}return a},_findBeginningOfGroup:function(e,t,i,n,r){for(var s=0,o=e;o>=s;){e=(s+o)/2>>>0;var a=n[e],l=i.getItemFromKey(a),c=t(l.data,r);0>c?s=e+1:o=e-1}return s},_findEndOfGroup:function(e,t,i,n,r){for(var s=e,o=n.length;o>=s;){e=(s+o)/2>>>0;var a=n[e];if(!a)return n.length;var l=i.getItemFromKey(a),c=t(l.data,r);0>=c?s=e+1:o=e-1}return s},_findStableInsertionPos:function(e,t,i,n,r,s){var o=this._list,a=o.length,l=this._sortFunction,c=this._sortedKeys;if(a/2>t){for(var u=t-1;u>=0;u--){var d=o.getItem(u);if(0===l(d.data,s))return a-i>n?c.indexOf(d.key,i)+1:c.lastIndexOf(d.key,n)+1}return this._findBeginningOfGroup(r,l,o,c,s)}for(var u=t+1;a>u;u++){var d=o.getItem(u);if(0===l(d.data,s))return a-i>n?c.indexOf(d.key,i):c.lastIndexOf(d.key,n)}return this._findEndOfGroup(r,l,o,c,s)},_listItemChanged:function(e){var t=e.detail.key,i=e.detail.newValue,n=e.detail.oldValue,r=this._sortFunction;if(0===r(n,i)){var s=this.indexOfKey(t);this._notifyItemChanged(t,s,n,i,e.detail.oldItem,e.detail.newItem)}else this._listItemRemoved({detail:{key:t,index:e.detail.index,value:e.detail.oldValue,item:e.detail.oldItem}}),this._listItemInserted({detail:{key:t,index:e.detail.index,value:e.detail.newValue}})},_listItemInserted:function(e,t,i){var n=e.detail.key,r=e.detail.index,s=e.detail.value,o=this._findInsertionPos(n,r,s,t,i);this._sortedKeys.splice(o,0,n),this._notifyItemInserted(n,o,s)},_listItemMoved:function(e,t,i){var n=e.detail.key,r=e.detail.newIndex,s=e.detail.value,o=this._sortedKeys,a=o.indexOf(n,t);o.splice(a,1);var l=this._findInsertionPos(n,r,s,t,i);o.splice(l,0,n),l!==a&&this._notifyItemMoved(n,a,l,s)},_listItemMutated:function(e){var t=e.detail.key,i=e.detail.value,n=e.detail.item,r=this._list.indexOfKey(t),s=this._sortedKeys.indexOf(t);this._sortedKeys.splice(s,1);var o=this._findInsertionPos(t,r,i);return this._sortedKeys.splice(s,0,t),s===o?void this._notifyItemMutated(t,i,n):(this._listItemRemoved({detail:{key:t,index:r,value:i,item:n}}),void this._listItemInserted({detail:{key:t,index:r,value:i}}))},_listItemRemoved:function(e,t){var i=e.detail.key,n=e.detail.value,r=e.detail.item,s=this._sortedKeys,o=s.indexOf(i,t);s.splice(o,1),this._notifyItemRemoved(i,o,n,r)},_listReload:function(){this._initSortedKeys(),this._notifyReload()},length:{get:function(){return this._sortedKeys.length},set:function(e){if(!("number"==typeof e&&e>=0))throw new n("WinJS.Binding.List.IllegalLength",h.illegalListLength);var t=this.length;t>e&&this.splice(e,t-e)}},getItem:function(e){return e=u(e),this.getItemFromKey(this._sortedKeys[e])},indexOfKey:function(e){return this._sortedKeys.indexOf(e)},notifyMutated:function(e){e=u(e),this._notifyMutatedFromKey(this._sortedKeys[e])},setAt:function(e,t){e=u(e),this._setAtKey(this._sortedKeys[e],t)},_spliceFromKey:function(e,t){if(arguments.length>2){var i=l(arguments);i[1]=0,this._list._spliceFromKey.apply(this._list,i)}var n=[];if(t){for(var r=[],s=this._sortedKeys,o=s.indexOf(e),a=o,c=s.length;c>a&&t>a-o;a++)r.push(s[a]);var u=this;r.forEach(function(e){n.push(u._list._spliceFromKey(e,1)[0])})}return n}},{supportedForProcessing:!1})}),GroupedSortedListProjection:t.Namespace._lazy(function(){return t.Class.derive(p.SortedListProjection,function(e,t,i,n){this._list=e,this._addListListener("itemchanged",this._listGroupedItemChanged),this._addListListener("iteminserted",this._listGroupedItemInserted),this._addListListener("itemmoved",this._listGroupedItemMoved),this._addListListener("itemmutated",this._listGroupedItemMutated),this._addListListener("itemremoved",this._listGroupedItemRemoved),this._addListListener("reload",this._listReload),this._sortFunction=function(e,i){return e=t(e),i=t(i),n?n(e,i):i>e?-1:e===i?0:1},this._groupKeyOf=t,this._groupDataOf=i,this._initSortedKeys(),this._initGroupedItems()},{_groupKeyOf:null,_groupDataOf:null,_groupedItems:null,_initGroupedItems:function(){for(var e={},t=this._list,i=this._groupKeyOf,n=0,r=t.length;r>n;n++){var s=c(t.getItem(n));s.groupKey=i(s.data),e[s.key]=s}this._groupedItems=e},_groupsProjection:null,_listGroupedItemChanged:function(e){var t=e.detail.key,i=e.detail.oldValue,n=e.detail.newValue,r=this._groupedItems,s=r[t],o=c(s);o.data=n,o.groupKey=this._groupKeyOf(n),r[t]=o;var a;s.groupKey===o.groupKey?(a=this.indexOfKey(t),this._notifyItemChanged(t,a,i,n,s,o)):(a=e.detail.index,this._listItemChanged({detail:{key:t,index:a,oldValue:i,newValue:n,oldItem:s,newItem:o}}))
},_listGroupedItemInserted:function(e){var t=e.detail.key,i=e.detail.value,n=this._groupKeyOf(i);this._groupedItems[t]={handle:t,key:t,data:i,groupKey:n};var r,s;if(this._groupsProjection){var o=this._groupsProjection._groupItems[n];o&&(r=o.firstItemIndexHint,s=r+o.groupSize)}this._listItemInserted(e,r,s)},_listGroupedItemMoved:function(e){var t,i,n=this._groupedItems[e.detail.key].groupKey;if(this._groupsProjection){var r=this._groupsProjection._groupItems[n];t=r.firstItemIndexHint,i=t+r.groupSize}this._listItemMoved(e,t,i)},_listGroupedItemMutated:function(e){var t=e.detail.key,i=e.detail.value,n=this._groupedItems,r=n[t],s=this._groupKeyOf(i);if(r.groupKey===s)this._notifyItemMutated(t,i,r);else{var o=c(r);o.groupKey=s,n[t]=o;var a=this._list.indexOfKey(t);this._listItemRemoved({detail:{key:t,index:a,value:i,item:r}}),this._listItemInserted({detail:{key:t,index:a,value:i}})}},_listGroupedItemRemoved:function(e){var t=e.detail.key,i=e.detail.index,n=e.detail.value,r=this._groupedItems,s=r[t];delete r[t];var o,a;if(this._groupsProjection){var l=this._groupsProjection._groupItems[s.groupKey];o=l.firstItemIndexHint,a=o+l.groupSize}this._listItemRemoved({detail:{key:t,index:i,value:n,item:s}},o,a)},_listReload:function(){this._initGroupedItems(),p.SortedListProjection.prototype._listReload.call(this)},groups:{get:function(){return null===this._groupsProjection&&(this._groupsProjection=new p.GroupsListProjection(this,this._groupKeyOf,this._groupDataOf)),this._groupsProjection}},getItemFromKey:function(e){return this._groupedItems[e]}},{supportedForProcessing:!1})}),GroupsListProjection:t.Namespace._lazy(function(){return t.Class.derive(p.ListBase,function(e,t,i){this._list=e,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._groupKeyOf=t,this._groupDataOf=i,this._initGroupKeysAndItems()},{_list:null,_addListListener:function(e,t){this._list.addEventListener(e,t.bind(this))},_groupDataOf:null,_groupKeyOf:null,_groupOf:function(e){return this.getItemFromKey(this._groupKeyOf(e.data))},_groupKeys:null,_groupItems:null,_initGroupKeysAndItems:function(){for(var e,t=this._groupDataOf,i=this._list,n={},r=[],s=null,o=null,a=0,l=i.length;l>a;a++){var c=i.getItem(a),u=c.groupKey;u!==s?(o&&(o.groupSize=e),e=1,s=u,o={handle:u,key:u,data:t(c.data),firstItemKey:c.key,firstItemIndexHint:a},n[u]=o,r.push(u)):e++}o&&(o.groupSize=e),this._groupKeys=r,this._groupItems=n},_listItemChanged:function(e){var t=e.detail.key,i=e.detail.index,n=e.detail.newValue,r=this._list,s=r.getItemFromKey(t).groupKey,o=this._groupItems,a=o[s];if(a.firstItemIndexHint===i){var l=c(a);l.data=this._groupDataOf(n),l.firstItemKey=t,o[s]=l,this._notifyItemChanged(s,this._groupKeys.indexOf(s),a.data,l.data,a,l)}},_listItemInserted:function(e){var t,i,n,r,s,o=e.detail.key,a=e.detail.index,l=e.detail.value,u=this._list,d=u.getItemFromKey(o).groupKey,h=this._groupItems,_=this._groupKeys,m=h[d];if(m)i=m,n=c(i),n.groupSize++,i.firstItemIndexHint===a&&(n.groupData=this._groupDataOf(l),n.firstItemKey=o,n.firstItemIndexHint=a),h[d]=n,t=_.indexOf(d),this._notifyItemChanged(d,t,i.data,n.data,i,n);else{for(r=0,s=_.length;s>r&&(m=h[_[r]],!(m.firstItemIndexHint>=a));r++);t=r,m={handle:d,key:d,data:this._groupDataOf(l),groupSize:1,firstItemKey:o,firstItemIndexHint:a},_.splice(t,0,d),h[d]=m,this._notifyItemInserted(d,t,m.data)}for(r=t+1,s=_.length;s>r;r++)i=h[_[r]],n=c(i),n.firstItemIndexHint++,h[n.key]=n,this._notifyItemChanged(n.key,r,i.data,n.data,i,n)},_listItemMoved:function(e){var t=e.detail.key,i=e.detail.oldIndex,n=e.detail.newIndex,r=this._list,s=r.getItemFromKey(t).groupKey,o=this._groupItems,a=o[s];if(a.firstItemIndexHint===n||a.firstItemIndexHint===i){var l=r.getItem(a.firstItemIndexHint),u=c(a);u.data=this._groupDataOf(l.data),u.firstItemKey=l.key,o[s]=u,this._notifyItemChanged(s,this._groupKeys.indexOf(s),a.data,u.data,a,u)}},_listItemRemoved:function(e){var t,i,n=e.detail.index,r=e.detail.item,s=this._groupItems,o=this._groupKeys,a=r.groupKey,l=s[a],u=o.indexOf(a);if(1===l.groupSize)o.splice(u,1),delete s[a],this._notifyItemRemoved(a,u,l.data,l),u--;else{if(t=l,i=c(t),i.groupSize--,t.firstItemIndexHint===n){var d=this._list.getItem(n);i.data=this._groupDataOf(d.data),i.firstItemKey=d.key}s[a]=i,this._notifyItemChanged(a,u,t.data,i.data,t,i)}for(var h=u+1,_=o.length;_>h;h++)t=s[o[h]],i=c(t),i.firstItemIndexHint--,s[i.key]=i,this._notifyItemChanged(i.key,h,t.data,i.data,t,i)},_listReload:function(){this._initGroupKeysAndItems(),this._notifyReload()},length:{get:function(){return this._groupKeys.length}},getItem:function(e){return e=u(e),this._groupItems[this._groupKeys[e]]},getItemFromKey:function(e){return this._groupItems[e]},indexOfKey:function(e){return this._groupKeys.indexOf(e)}},{supportedForProcessing:!1})})});t.Namespace._moduleDefine(e,"WinJS.Binding",{List:t.Namespace._lazy(function(){return t.Class.derive(p.ListBaseWithMutators,function(e,t){if(this._currentKey=0,this._keys=null,this._keyMap={},t=t||m,this._proxy=t.proxy,this._binding=t.binding,this._proxy){if(Object.keys(e).length!==e.length)throw new n("WinJS.Binding.List.NotSupported",h.sparseArrayNotSupported);this._data=e,this._currentKey=e.length}else if(e){for(var i=this._keyMap,r=0,s=0,a=e.length;a>s;s++)if(s in e){var l=e[s];this._binding&&(l=o.as(l));var c=r.toString();r++,i[c]={handle:c,key:c,data:l}}r!==s&&this._initializeKeys(),this._currentKey=r}},{_currentKey:0,_keys:null,_keyMap:null,_modifyingData:0,_initializeKeys:function(){if(!this._keys){var e=[];if(this._data){for(var t=this._keyMap,i=this._data,n=0,r=i.length;r>n;n++)if(n in i){var s=n.toString();if(e[n]=s,!(s in t)){var a=i[n];this._binding&&(a=o.as(a)),t[s]={handle:s,key:s,data:a}}}}else Object.keys(this._keyMap).forEach(function(t){e[t>>>0]=t});this._keys=e}},_lazyPopulateEntry:function(e){if(this._data&&e in this._data){var t=this._data[e];this._binding&&(t=o.as(t));var i=e.toString(),n={handle:i,key:i,data:t};return this._keyMap[n.key]=n,n}},_assignKey:function(){return(++this._currentKey).toString()},length:{get:function(){return this._data?this._data.length:this._keys?this._keys.length:this._currentKey},set:function(e){if(!("number"==typeof e&&e>=0))throw new n("WinJS.Binding.List.IllegalLength",h.illegalListLength);this._initializeKeys();var t=this.length;if(t>e?this.splice(e,t-e):e=t,this._data){this._modifyingData++;try{this._data.length=e}finally{this._modifyingData--}}this._keys&&(this._keys.length=e)}},getItem:function(e){var t,i;return e=u(e),this._keys?(i=this._keys[e],t=i&&this._keyMap[i]):(i=e.toString(),t=this._keyMap[i]||this._lazyPopulateEntry(e)),t},getItemFromKey:function(e){var t;return t=this._keys||!this._data?this._keyMap[e]:this.getItem(e>>>0)},indexOfKey:function(e){var t=-1;if(this._keys)t=this._keys.indexOf(e);else{var i=e>>>0;i<this._currentKey&&(t=i)}return t},move:function(e,t){if(e=u(e),t=u(t),this._initializeKeys(),!(e===t||0>e||0>t||e>=this.length||t>=this.length)){if(this._data){this._modifyingData++;try{var i=this._data.splice(e,1)[0];this._data.splice(t,0,i)}finally{this._modifyingData--}}var n=this._keys.splice(e,1)[0];this._keys.splice(t,0,n),this._notifyItemMoved(n,e,t,this.getItemFromKey(n).data)}},notifyMutated:function(e){e=u(e);var t=this._keys?this._keys[e]:e.toString();this._notifyMutatedFromKey(t)},setAt:function(e,t){e=u(e),this._initializeKeys();var i=this.length;if(e===i)this.push(t);else if(i>e){if(this._data){this._modifyingData++;try{this._data[e]=t}finally{this._modifyingData--}}if(this._binding&&(t=o.as(t)),e in this._keys){var n=this._keys[e],r=this._keyMap[n],s=c(r);s.data=t,this._keyMap[n]=s,this._notifyItemChanged(n,e,r.data,t,r,s)}}},_setAtKey:function(e,t){this.setAt(this.indexOfKey(e),t)},reverse:function(){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.reverse()}finally{this._modifyingData--}}return this._keys.reverse(),this._notifyReload(),this},sort:function(e){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.sort(e)}finally{this._modifyingData--}}var t=this;return this._keys.sort(function(i,n){return i=t._keyMap[i],n=t._keyMap[n],e?e(i.data,n.data):(i=(i&&i.data||"").toString(),n=(i&&n.data||"").toString(),n>i?-1:i===n?0:1)}),this._notifyReload(),this},pop:function(){if(0!==this.length){this._initializeKeys();var e=this._keys.pop(),t=this._keyMap[e],i=t&&t.data;if(this._data){this._modifyingData++;try{this._data.pop()}finally{this._modifyingData--}}return delete this._keyMap[e],this._notifyItemRemoved(e,this._keys.length,i,t),i}},push:function(){this._initializeKeys();for(var e=arguments.length,t=0;e>t;t++){var i=arguments[t];this._binding&&(i=o.as(i));var n=this._assignKey();if(this._keys.push(n),this._data){this._modifyingData++;try{this._data.push(arguments[t])}finally{this._modifyingData--}}this._keyMap[n]={handle:n,key:n,data:i},this._notifyItemInserted(n,this._keys.length-1,i)}return this.length},shift:function(){if(0!==this.length){this._initializeKeys();var e=this._keys.shift(),t=this._keyMap[e],i=t&&t.data;if(this._data){this._modifyingData++;try{this._data.shift()}finally{this._modifyingData--}}return delete this._keyMap[e],this._notifyItemRemoved(e,0,i,t),i}},unshift:function(){this._initializeKeys();for(var e=arguments.length,t=e-1;t>=0;t--){var i=arguments[t];this._binding&&(i=o.as(i));var n=this._assignKey();if(this._keys.unshift(n),this._data){this._modifyingData++;try{this._data.unshift(arguments[t])}finally{this._modifyingData--}}this._keyMap[n]={handle:n,key:n,data:i},this._notifyItemInserted(n,0,i)}return this.length},splice:function(e,t){e=u(e),this._initializeKeys(),e=Math.max(0,this._normalizeIndex(e)),t=Math.max(0,Math.min(t||0,this.length-e));for(var i=[];t;){var n=this._keys[e],r=this._keyMap[n],s=r&&r.data;if(i.push(s),this._keys.splice(e,1),this._data){this._modifyingData++;try{this._data.splice(e,1)}finally{this._modifyingData--}}delete this._keyMap[n],this._notifyItemRemoved(n,e,s,r),--t}if(arguments.length>2)for(var a=2,l=arguments.length;l>a;a++){var c=arguments[a];this._binding&&(c=o.as(c));var d=Math.min(e+a-2,this.length),h=this._assignKey();if(this._keys.splice(d,0,h),this._data){this._modifyingData++;try{this._data.splice(d,0,arguments[a])}finally{this._modifyingData--}}this._keyMap[h]={handle:h,key:h,data:c},this._notifyItemInserted(h,d,c)}return i},_spliceFromKey:function(e){this._initializeKeys();var t=l(arguments);return t[0]=this._keys.indexOf(e),this.splice.apply(this,t)}},{supportedForProcessing:!1})})})}),define("WinJS/Res",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./ControlProcessor/_OptionsParser","./Promise"],function(e,t,i,n,r,s,o,a){"use strict";function l(e,i){e=e||t.document.body;var i=i||0;if(4>i){if(0===i&&e.getAttribute){var s=e.getAttribute("data-win-res");if(s){var l=o.optionsParser(s);d(e,e,l,i)}}var c="[data-win-res],[data-win-control]",u=e.querySelectorAll(c);if(0===u.length)return a.as(e);for(var _=0,p=u.length;p>_;_++){var f=u[_];if(f.winControl&&f.winControl.constructor&&f.winControl.constructor.isDeclarativeControlContainer){var g=f.winControl.constructor.isDeclarativeControlContainer;"function"==typeof g&&(g=m(g),g(f.winControl,h),_+=f.querySelectorAll(c).length)}if(f.hasAttribute("data-win-res")){var l=o.optionsParser(f.getAttribute("data-win-res"));d(f,f,l,i)}}}else if(n.validation)throw new r("WinJS.Res.NestingExceeded","NestingExceeded");return a.as(e)}function c(e,t){for(var i=Object.keys(t),r=0,o=i.length;o>r;r++){var a=i[r],l=t[a],c=s.getString(l);c&&c.empty?n.validation&&u(l):(e.setAttribute(a,c.value),void 0!==c.lang&&void 0!==e.lang&&e.lang!==c.lang&&(e.lang=c.lang))}}function u(e){throw new r("WinJS.Res.NotFound",s._formatString("NotFound: {0}",e))}function d(e,t,i,r){var o=Object.keys(i);t=m(t);for(var a=0,h=o.length;h>a;a++){var _=o[a],p=i[_];if("string"==typeof p){var f=s.getString(p);f&&f.empty?n.validation&&u(p):(t[_]=f.value,void 0!==f.lang&&void 0!==e.lang&&e.lang!==f.lang&&(e.lang=f.lang),"innerHTML"===_&&l(t,r+1))}else e===t&&"attributes"===_?c(e,p):d(e,t[_],p,r)}}function h(e){if(!_)return n.ready().then(function(){return _=!0,l(e)});try{return l(e)}catch(t){return a.wrapError(t)}}var _=!1,m=n.requireSupportedForProcessing;i.Namespace._moduleDefine(e,"WinJS.Resources",{processAll:h})}),define("WinJS/Pages/_BasePage",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WriteProfilerMark","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities"],function(e,t,i,n,r,s,o,a,l){"use strict";function c(e){var i=t.document.createElement("a");return i.href=e,i.href}function u(e){return t.document.location.href.toLowerCase()===e.toLowerCase()}function d(e,a){var d=h(e);return e=c(e),d||(d=i.Class.define(function(i,o,a,c){var d=this;this._disposed=!1,this.element=i=i||t.document.createElement("div"),l.addClass(i,"win-disposable"),i.msSourceLocation=e,this.uri=e,this.selfhost=u(e),i.winControl=this,l.addClass(i,"pagecontrol");var h=" uri='"+e+"'"+n._getProfilerMarkIdentifier(this.element);r("WinJS.UI.Pages:createPage"+h+",StartTM");var _=s.wrap().then(function(){return d.load(e)}),m=_.then(function(e){return s.join({loadResult:e,initResult:d.init(i,o)})}).then(function(e){return d.render(i,o,e.loadResult)});this.elementReady=m.then(function(){return i}),this.renderComplete=m.then(function(){return d.process(i,o)}).then(function(){return d.processed(i,o)}).then(function(){return d});var p=function(){a&&a(d),r("WinJS.UI.Pages:createPage"+h+",StopTM")};this.renderComplete.then(p,p),this.renderComplete.then(function(){return c}).then(function(){d.ready(i,o)}).then(null,function(e){return d.error(e)})},p),d=i.Class.mix(d,o.DOMEventMixin),m[e.toLowerCase()]=d),a&&(d=i.Class.mix(d,a)),d.selfhost=u(e),d}function h(e){return e=c(e),m[e.toLowerCase()]}function _(e){e=c(e),delete m[e.toLowerCase()]}if(t.document){var m={},p={dispose:function(){this._disposed||(this._disposed=!0,a.disposeSubTree(this.element),this.element=null)},load:function(){},init:function(){},process:function(){},processed:function(){},render:function(){},ready:function(){},error:function(e){return s.wrapError(e)}};i.Namespace._moduleDefine(e,null,{abs:c,define:d,get:h,remove:_})}}),define("WinJS/Pages",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./ControlProcessor","./Fragments","./Pages/_BasePage","./Promise"],function(e,t,i,n,r,s,o){"use strict";function a(e,r){var s=o.get(e);return s||(s=o.define(e,d)),r&&(s=i.Class.mix(s,r)),s.selfhost&&n.ready(function(){u(o.abs(e),t.document.body)},!0),s}function l(e){var t=o.get(e);return t||(t=a(e)),t}function c(e){s.clearCache(o.abs(e)),o.remove(e)}function u(e,t,i,n){var r=l(e),s=new r(t,i,null,n);return s.renderComplete}if(t.document){var d={load:function(e){return this.selfhost?void 0:s.renderCopy(o.abs(e))},process:function(e){return r.processAll(e)},render:function(e,t,i){return this.selfhost||e.appendChild(i),e}};i.Namespace._moduleDefine(e,"WinJS.UI.Pages",{define:a,get:l,_remove:c,render:u})}}),define("WinJS/Controls/HtmlControl",["exports","../Core/_Global","../Core/_Base","../Pages"],function(e,t,i,n){"use strict";t.document&&i.Namespace._moduleDefine(e,"WinJS.UI",{HtmlControl:i.Class.define(function(e,t,i){n.render(t.uri,e,t).then(i,function(){i()})})})}),define("WinJS/VirtualizedDataSource/_VirtualizedDataSourceImpl",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../_Signal","../Utilities/_UI"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{VirtualizedDataSource:i.Namespace._lazy(function(){function e(e,i){function s(e){var t="WinJS.UI.VirtualizedDataSource:"+fr+":"+e+",StartTM";l(t),o.log&&o.log(t,"winjs vds","perf")}function b(e){var t="WinJS.UI.VirtualizedDataSource:"+fr+":"+e+",StopTM";l(t),o.log&&o.log(t,"winjs vds","perf")}function C(e){return"number"==typeof e&&e>=0}function w(e){return C(e)&&e===Math.floor(e)}function I(e){if(null===e)e=void 0;else if(void 0!==e&&!w(e))throw new r("WinJS.UI.ListDataSource.InvalidIndexReturned",v.invalidIndexReturned);return e}function S(e){if(null===e)e=void 0;else if(void 0!==e&&!w(e)&&e!==p.unknown)throw new r("WinJS.UI.ListDataSource.InvalidCountReturned",v.invalidCountReturned);return e}function E(){var e=(mn++).toString(),t={handle:e,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return Hn[e]=t,t}function x(){return E()}function k(e,t){e.prev=t.prev,e.next=t,e.prev.next=e,t.prev=e}function P(e){e.lastInSequence&&(delete e.lastInSequence,e.prev.lastInSequence=!0),e.firstInSequence&&(delete e.firstInSequence,e.next.firstInSequence=!0),e.prev.next=e.next,e.next.prev=e.prev}function T(e){for(;!e.firstInSequence;)e=e.prev;return e}function A(e){for(;!e.lastInSequence;)e=e.next;return e}function M(e,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=e.prev,i.next=e,t.prev.next=t,e.prev=i,!0}function B(e,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=e,i.next=e.next,e.next=t,i.next.prev=i,!0}function L(e){delete e.lastInSequence,delete e.next.firstInSequence}function D(e){var t=e.next;e.lastInSequence=!0,t.firstInSequence=!0,t===Nn&&_t(Nn,void 0)}function O(e,t,i,n){k(e,t);var r=e.prev;r.lastInSequence&&(i?delete r.lastInSequence:e.firstInSequence=!0,n?delete t.firstInSequence:e.lastInSequence=!0)}function R(e,t){e.key=t,Wn[e.key]=e}function F(e,t,i){+t===t&&(e.index=t,i[t]=e,kn||(e.firstInSequence&&e.prev&&e.prev.index===t-1&&L(e.prev),e.lastInSequence&&e.next&&e.next.index===t+1&&L(e)))}function N(e,t){var i=t===Un?x():E();return k(i,e),i}function z(e,t,i){var n=N(e,i);return n.firstInSequence=!0,n.lastInSequence=!0,F(n,t,i),n}function H(e,t){return z(e,t,Un)}function W(e,t){var i=N(e,t);return delete e.firstInSequence,i.prev.index===i.index-1?delete i.prev.lastInSequence:i.firstInSequence=!0,F(i,e.index-1,t),i}function U(e,t){var i=N(e.next,t);return delete e.lastInSequence,i.next.index===i.index+1?delete i.next.firstInSequence:i.lastInSequence=!0,F(i,e.index+1,t),i}function V(e,t,i,n){O(e,t,i,n),Wn[e.key]=e,void 0!==e.index&&(Un[e.index]=e)}function q(e){P(e),e.key&&delete Wn[e.key],void 0!==e.index&&Un[e.index]===e&&delete Un[e.index];var t=e.bindingMap;for(var i in t){var n=t[i].handle;n&&Hn[n]===e&&delete Hn[n]}Hn[e.handle]===e&&delete Hn[e.handle]}function j(e){return!Hn[e.handle]}function J(e,t,i,n,r){var s=r?null:t[e-1];if(s&&(s.next!==n||n.firstInSequence))s=s.next;else if(s=t[e+1],!s){s=i.next;for(var o;;){if(s.firstInSequence&&(o=s),!(e>=s.index)||s===n)break;s=s.next}s!==n||n.firstInSequence||(s=o&&void 0===o.index?o:void 0)}return s}function K(e){return!e.item&&!e.itemNew&&e!==Nn}function G(e,t){Object.defineProperty(e,"handle",{value:t,writable:!1,enumerable:!1,configurable:!0})}function Y(e,t,i){G(e,i),Object.defineProperty(e,"index",{get:function(){for(;t.slotMergedWith;)t=t.slotMergedWith;return t.index},enumerable:!1,configurable:!0})}function Z(e){if(void 0===e)return e;var t=JSON.stringify(e);if(void 0===t)throw new r("WinJS.UI.ListDataSource.ObjectIsNotValidJson",v.objectIsNotValidJson);return t}function X(t){return e.itemSignature?e.itemSignature(t.data):Z(t.data)}function Q(t){var i=t.itemNew;t.itemNew=null,i&&(i=Object.create(i),Y(i,t,t.handle),e.compareByIdentity||(t.signature=X(i))),t.item=i,delete t.indexRequested,delete t.keyRequested}function $(e){return e.bindingMap||e.cursorCount>0}function et(e){return $(e)||e.fetchListeners||e.directFetchListeners}function tt(e){return et(e)||!e.firstInSequence&&$(e.prev)||!e.lastInSequence&&$(e.next)||!cr&&(!e.firstInSequence&&e.prev!==Fn&&!(e.prev.item||e.prev.itemNew))|(!e.lastInSequence&&e.next!==Nn&&!(e.next.item||e.next.itemNew))}function it(e){D(e),q(e)}function nt(){if(!wn){(!qn||j(qn))&&(qn=Nn.prev);for(var e=qn.prev,t=qn.next,i=0,n=function(e){e===Nn||tt(e)||(ln>=i?i++:it(e))};e||t;){if(e){var r=e;e=r.prev,r!==Fn&&n(r)}if(t){var s=t;t=s.next,s!==zn&&n(s)}}Vn=0}}function rt(e){et(e)||(Vn++,wn||Kn||(qn=e,Vn>ln&&!jn&&(jn=!0,u.schedule(function(){jn=!1,nt()},u.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested"))))}function st(e){for(var t in hn)e(hn[t])}function ot(e,t){for(var i in e.bindingMap)t(e.bindingMap[i].bindingRecord,i)}function at(e){return e.notificationsSent||(e.notificationsSent=!0,e.notificationHandler.beginNotifications&&e.notificationHandler.beginNotifications()),e.notificationHandler}function lt(){yn||En||st(function(e){e.notificationsSent&&(e.notificationsSent=!1,e.notificationHandler.endNotifications&&e.notificationHandler.endNotifications())})}function ct(e,t){var i=e.bindingMap;if(i){var n=i[t];if(n){var r=n.handle;if(r)return r}}return e.handle}function ut(e,t){return e&&e.handle!==t&&(e=Object.create(e),G(e,t)),e}function dt(e){var t=Rn;Rn=e,st(function(e){e.notificationHandler&&e.notificationHandler.countChanged&&at(e).countChanged(Rn,t)})}function ht(e,t){ot(e,function(i,n){i.notificationHandler.indexChanged&&at(i).indexChanged(ct(e,n),e.index,t)})}function _t(e,t){var i=e.index;if(void 0!==i&&Un[i]===e&&delete Un[i],+t===t)F(e,t,Un);else{if(+i!==i)return;delete e.index}ht(e,i)}function mt(e,t,i,n,r){var s={};if(!(!n&&t.lastInSequence||!r&&i.firstInSequence))if(t===Fn)if(i===Nn)for(var o in hn)s[o]=hn[o];else for(var o in i.bindingMap)s[o]=hn[o];else if(i===Nn||i.bindingMap)for(var o in t.bindingMap)(i===Nn||i.bindingMap[o])&&(s[o]=hn[o]);for(var o in e.bindingMap)s[o]=hn[o];return s}function pt(e){var t,i=e.prev,n=e.next,r=mt(e,i,n);for(t in r){var s=r[t];s.notificationHandler&&at(s).inserted(s.itemPromiseFromKnownSlot(e),i.lastInSequence||i===Fn?null:ct(i,t),n.firstInSequence||n===Nn?null:ct(n,t))}}function ft(e){var t=e.item;Q(e),ot(e,function(i,n){var r=ct(e,n);at(i).changed(ut(e.item,r),ut(t,r))})}function gt(e,t,i,n,r){var s,o=t.prev;if(t===e){if(!e.firstInSequence||!i)return;t=e.next}else if(o===e){if(!e.lastInSequence||!n)return;o=e.prev}if(!r){var a=mt(e,o,t,i,n);for(s in a){var l=a[s];at(l).moved(l.itemPromiseFromKnownSlot(e),(o.lastInSequence||o===e.prev)&&!i||o===Fn?null:ct(o,s),(t.firstInSequence||t===e.next)&&!n||t===Nn?null:ct(t,s))}st(function(t){t.adjustCurrentSlot(e)})}P(e),O(e,t,i,n)}function vt(e,t){kt(e,!0),ot(e,function(i,n){at(i).removed(ct(e,n),t)}),st(function(t){t.adjustCurrentSlot(e)}),q(e)}function yt(e){for(;!e.firstInSequence;)e=e.prev;var t;do{t=e.lastInSequence;var i=e.next;vt(e,!0),e=i}while(!t)}function bt(e){var t;if(!e)return t;for(var i=0;!e.firstInSequence;)i++,e=e.prev;return"number"==typeof e.indexNew?e.indexNew+i:"number"==typeof e.index?e.index+i:t}function Ct(e,t){for(e=e.next;e;e=e.next)if(e.firstInSequence){var i=void 0!==e.indexNew?e.indexNew:e.index;void 0!==i&&(e.indexNew=i+t)}xn+=t,kn=!0,Kn?wi():Tn++}function wt(e,t){if(e.firstInSequence){var i;if(0>t)i=e.indexNew,void 0!==i?delete e.indexNew:i=e.index,e.lastInSequence||(e=e.next,void 0!==i&&(e.indexNew=i));else if(!e.lastInSequence){var n=e.next;i=n.indexNew,void 0!==i?delete n.indexNew:i=n.index,void 0!==i&&(e.indexNew=i)}}Ct(e,t)}function It(e,t){for(var i=Fn;i!==Nn;i=i.next){var n=i.indexNew;if(void 0!==n&&n>=e){Ct(i,t);break}}}function St(){var e,t,i;for(e=Fn;;e=e.next){if(e.firstInSequence){if(t=e,void 0!==e.indexNew){if(i=e.indexNew,delete e.indexNew,isNaN(i))break}else i=e.index;e!==Fn&&e.prev.index===i-1&&L(e.prev)}if(e.lastInSequence)for(var n=i,r=t;r!==e.next;r=r.next)n!==r.index&&_t(r,n),+n===n&&n++;if(e===Nn)break}for(;e!==zn;e=e.next)void 0!==e.index&&e!==Nn&&_t(e,void 0);kn=!1,xn&&+Rn===Rn&&(fn?fn.reset():dt(Rn+xn),xn=0)}function Et(e,t,i,n,r){if(e.item)return new c(function(t){r?r(t,e.item):t(e.item)});var s={listBindingID:n,retained:!1};return e[t]||(e[t]={}),e[t][i]=s,s.promise=new c(function(e,t){s.complete=r?function(t){r(e,t)}:e,s.error=t},function(){for(;e.slotMergedWith;)e=e.slotMergedWith;var n=e[t];if(n){if(delete n[i],Object.keys(n).length>0)return;delete e[t]}rt(e)}),s.promise}function xt(e,t){for(var i in t)t[i].complete(e)}function kt(e,t){var i=e.fetchListeners,n=e.directFetchListeners;if(i||n){Q(e);var r=e.item,s=function(e){t?xt(r,e):Ln.push(function(){xt(r,e)})};n&&(e.directFetchListeners=null,s(n)),i&&(e.fetchListeners=null,s(i)),rt(e)}}function Pt(){var e=Ln;Ln=[];for(var t=0,i=e.length;i>t;t++)e[t]()}function Tt(e,t){var i=e.directFetchListeners;if(i){e.directFetchListeners=null;for(var n in i)i[n].error(t);rt(e)}}function At(e){return e.firstInSequence&&W(e,Un),e.lastInSequence&&U(e,Un),e.itemNew&&Q(e),ei(),e}function Mt(e){if(!e.firstInSequence){var t=e.prev;return t===Fn?null:At(t)}return At(W(e,Un))}function Bt(e){if(!e.lastInSequence){var t=e.next;return t===Nn?null:At(t)}return At(U(e,Un))}function Lt(e){return e?Et(e,"directFetchListeners",(pn++).toString()):c.wrap(null)}function Dt(e){if("string"!=typeof e||!e)throw new r("WinJS.UI.ListDataSource.KeyIsInvalid",v.keyIsInvalid)}function Ot(e){var t=H(zn);return R(t,e),t.keyRequested=!0,t}function Rt(e,t){Dt(e);var i=Wn[e];return i||(i=Ot(e),i.hints=t),At(i)}function Ft(e){if("number"!=typeof e||0>e)throw new r("WinJS.UI.ListDataSource.IndexIsInvalid",v.indexIsInvalid);if(Nn.index<=e)return null;var t=Un[e];if(!t){var i=J(e,Un,Fn,Nn);if(!i)return null;i===Nn&&e>=Nn&&_t(Nn,void 0),t=i.prev.index===e-1?U(i.prev,Un):i.index===e+1?W(i,Un):H(i,e)}return t.item||(t.indexRequested=!0),At(t)}function Nt(e){var t=H(zn);return t.description=e,At(t)}function zt(e){if(un=e,cn!==un){var i=function(){dn=!1,cn!==un&&(cn=un,gr.dispatchEvent(y,cn))};un===m.failure?i():dn||(dn=!0,t.setTimeout(i,40))}}function Ht(e){var t=e.fetchID;return t&&Bn[t]}function Wt(e,t){e.fetchID=t}function Ut(){var e=Mn;return Mn++,Bn[e]=!0,e}function Vt(e,t,i){var n=Ut();Wt(e,n);for(var r=e;!r.firstInSequence&&t>0;)r=r.prev,t--,Wt(r,n);for(var s=e;!s.lastInSequence&&i>0;)s=s.next,i--,Wt(s,n);return n}function qt(e){var t=e.items,i=e.offset,n=e.totalCount,r=e.absoluteIndex,s=e.atStart,o=e.atEnd;if(C(r)){if(C(n)){var a=t.length;r-i+a===n&&(o=!0)}i===r&&(s=!0)}s&&(t.unshift(Dn),e.offset++),o&&t.push(On)}function jt(e,t,i){return delete Bn[i],t!==Tn||j(e)?(ei(),!1):!0}function Jt(e,t,i,n){var o=Tn;i.then(function(i){if(!i.items||!i.items.length)return c.wrapError(new r(f.doesNotExist));var a="itemsFetched id="+t+" count="+i.items.length;s(a),jt(e,o,t)&&(+n===n&&(i.absoluteIndex=n),qt(i),fi(e,i.items,i.offset,i.totalCount,i.absoluteIndex)),b(a)}).then(null,function(i){jt(e,o,t)&&gi(e,i)})}function Kt(e,t,i,n){var o=Tn;n.then(function(n){if(!n.items||!n.items.length)return c.wrapError(new r(f.doesNotExist));var a="itemsFetched id="+i+" count="+n.items.length;s(a),jt(t,o,i)&&(n.absoluteIndex=e,qt(n),vi(e,t,n.items,n.offset,n.totalCount,n.absoluteIndex)),b(a)}).then(null,function(){jt(t,o,i)&&yi(e,t,o)})}function Gt(e,t){var i=Vt(e,0,t-1);ur?Jt(e,i,ur(i,t),0):Jt(e,i,cr(i,0,0,t-1),0)}function Yt(e,t){var i=Vt(e,t-1,0);Jt(e,i,dr(i,t))}function Zt(e,t,i){var n=Vt(e,t,i);Jt(e,n,lr(n,e.key,t,i,e.hints))}function Xt(e,t,i){var n=e.index;if(t>n&&(t=n),cr){var r=Vt(e,t,i);Jt(e,r,cr(r,n,t,i),n)}else if(e.key)Zt(e,t,i);else{var s,o,a=Fn,l=n+1;for(s=e.prev;s!==Fn;s=s.prev)if(void 0!==s.index&&s.key){o=n-s.index,l>o&&(l=o,a=s);break}for(s=e.next;s!==Nn;s=s.next)if(void 0!==s.index&&s.key){o=s.index-n,l>o&&(l=o,a=s);break}if(a===Fn){var r=Vt(e,0,n+1);Kt(0,e,r,ur(r,n+1))}else{var c=Math.max(a.index-n,0),u=Math.max(n-a.index,0),r=Vt(a,c,u);Kt(a.index,e,r,lr(r,a.key,c,u,e.hints))}}}function Qt(e,t,i){var n=Vt(e,t,i);Jt(e,n,hr(n,e.description,t,i))}function $t(){if(!Kn){for(var e,t,i,n,r,s,o,a,l=!1,c=!1,u=Fn.next;u!==zn;){var d=u.next;if(u!==Nn&&K(u)&&(c=!0,e?t++:(e=u,t=1),Ht(u)&&(l=!0),u.keyRequested&&!i&&(i=u,n=t-1),void 0===u.description||r||(r=u,s=t-1),u.indexRequested&&!o&&(o=u,a=t-1),u.lastInSequence||d===zn||!K(d))){if(l)l=!1;else{if(gn=!1,!e.firstInSequence&&e.prev.key&&lr?Zt(e.prev,0,t):!u.lastInSequence&&d.key&&lr?Zt(d,t,0):e.prev!==Fn||e.firstInSequence||!ur&&!cr?d===Nn&&!u.lastInSequence&&dr?Yt(u,t):i?Zt(i,n,t-1-n):r?Qt(r,s,t-1-s):o?Xt(o,a,t-1-a):"number"==typeof e.index?Xt(e,t-1,0):yt(e):Gt(e,t),gn)return void ei();if(Kn)return}e=o=i=null}u=d}zt(c?m.waiting:m.ready)}}function ei(){An||(An=!0,u.schedule(function(){An=!1,$t(),lt()},u.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function ti(t){var i=t.itemNew;if(!i)return!1;var n=t.item;for(var r in n)switch(r){case"data":break;default:if(n[r]!==i[r])return!0}return e.compareByIdentity?n.data!==i.data:t.signature!==X(i)}function ii(e){et(e)?ti(e)?ft(e):e.itemNew=null:e.item=null}function ni(e){e.item?ii(e):kt(e)}function ri(e,t){e.key||R(e,t.key),e.itemNew=t,ni(e)}function si(e,t,i){var n=t.bindingMap;if(n)for(var r in i)if(n[r]){var s=t.fetchListeners;for(var o in s){var a=s[o];a.listBindingID===r&&a.retained&&(delete s[o],a.complete(null))}var l=n[r].bindingRecord;at(l).removed(ct(t,r),!0,ct(e,r)),t.bindingMap&&delete t.bindingMap[r]}}function oi(e,t){if(e.index!==t.index){var i=t.index;t.index=e.index,ht(t,i)}t.slotMergedWith=e;var n=t.bindingMap;for(var r in n){e.bindingMap||(e.bindingMap={});var s=n[r];s.handle||(s.handle=t.handle),Hn[s.handle]=e,e.bindingMap[r]=s}st(function(i){i.adjustCurrentSlot(t,e)});var o=t.itemNew||t.item;if(o&&(o=Object.create(o),Y(o,e,e.handle),ri(e,o)),e.item)t.directFetchListeners&&Ln.push(function(){xt(e.item,t.directFetchListeners)}),t.fetchListeners&&Ln.push(function(){xt(e.item,t.fetchListeners)});else{var a;for(a in t.directFetchListeners)e.directFetchListeners||(e.directFetchListeners={}),e.directFetchListeners[a]=t.directFetchListeners[a];for(a in t.fetchListeners)e.fetchListeners||(e.fetchListeners={}),e.fetchListeners[a]=t.fetchListeners[a]}e.itemNew&&kt(e),t.handle=(mn++).toString(),D(t),q(t)}function ai(e,t,i){t&&t.key&&(i||(i=t.itemNew||t.item),delete t.key,delete Wn[i.key],t.itemNew=null,t.item=null),i&&ri(e,i),t&&oi(e,t)}function li(e){if("object"!=typeof e)throw new r("WinJS.UI.ListDataSource.InvalidItemReturned",v.invalidItemReturned);if(e===Dn)return Fn;if(e===On)return Nn;if(e.key)return n.validation&&Dt(e.key),Wn[e.key];throw new r("WinJS.UI.ListDataSource.InvalidKeyReturned",v.invalidKeyReturned)}function ci(e,t){var i=li(t);i===e&&(i=null),i&&si(e,i,e.bindingMap),ai(e,i,t)}function ui(e,t,i,n){if(t&&e.key&&e.key!==t.key)return wi(),!1;var r=Un[i];if(r)if(r===e)r=null;else{if(r.key&&(e.key||t&&r.key!==t.key))return wi(),!1;if(!e.key&&r.bindingMap)return!1}var s;if(t)if(s=Wn[t.key],s===e)s=null;else if(s&&s.bindingMap)return!1;return r?(si(e,r,e.bindingMap),delete Un[i],_t(e,i),e.prev.index===i-1&&L(e.prev),e.next.index===i+1&&L(e),n.slotNext=r.slotNext,t||(t=r.itemNew||r.item,t&&(s=Wn[t.key]))):_t(e,i),s&&r!==s&&si(e,s,e.bindingMap),ai(e,s,t),r&&r!==s&&oi(e,r),!0}function di(e,t,i){if(t.key&&e.key&&t.key!==e.key)return wi(),!1;for(var n in e.bindingMap)i[n]=!0;return si(e,t,i),ai(e,t),!0}function hi(e,t){for(var i={};e;){var n=e.firstInSequence?null:e.prev;if(t.firstInSequence||t.prev!==Fn){if(t=t.firstInSequence?W(t,Un):t.prev,!di(t,e,i))return}else vt(e,!0);e=n}}function _i(e,t){for(var i={};e;){var n=e.lastInSequence?null:e.next;if(t.lastInSequence||t.next!==Nn){if(t=t.lastInSequence?U(t,Un):t.next,!di(t,e,i))return}else vt(e,!0);e=n}}function mi(e){for(var t=0;t<e.length;t++){var i=e[t];hi(i.slotBeforeSequence,i.slotFirstInSequence),_i(i.slotAfterSequence,i.slotLastInSequence)}}function pi(e,t){function i(t){for(var i=Nn.prev;!(i.index<e)&&i!==t;){var r=i.prev;void 0!==i.index&&vt(i,!0),i=r}n=0}for(var n=0,r=Nn.prev;!(r.index<e)||n>0;){var s=r.prev;if(r===Fn){i(Fn);break}if(r.key){if(r.index>=e)return wi(),!1;if(!(r.index>=t))return lr?Zt(r,0,n):Xt(r,0,n),!1;i(r)}else r.indexRequested||r.firstInSequence?i(s):n++;r=s}return!0}function fi(e,t,i,n,r){var o="WinJS.UI.ListDataSource.processResults";
return s(o),r=I(r),n=S(n),wn?void b(o):(kn&&St(),!C(n)&&n!==p.unknown||n===Rn||Nn.firstInSequence?(gn=!0,function(){var s,o,a,l,c=t.length;if("number"!=typeof r)for(s=0;c>s;s++)if(a=li(t[s]),a&&void 0!==a.index){r=a.index+i-s;break}"number"==typeof r&&t[c-1]===On?n=r-i+c-1:!C(n)||void 0!==r&&null!==r||(r=n-(c-1)+i),C(n)&&!pi(n,r-i)&&(n=void 0);var u=new Array(c);for(s=0;c>s;s++){var d=null;if(a=li(t[s])){if(s>0&&!a.firstInSequence&&a.prev.key&&a.prev.key!==t[s-1].key||"number"==typeof r&&void 0!==a.index&&a.index!==r-i+s)return void wi();(a===Fn||a===Nn||a.bindingMap)&&(d=a)}if("number"==typeof r&&(a=Un[r-i+s])){if(a.key&&a.key!==t[s].key)return void wi();!d&&a.bindingMap&&(d=a)}if(s===i){if(e.key&&e.key!==t[s].key||"number"==typeof e.index&&"number"==typeof r&&e.index!==r)return void wi();d||(d=e)}u[s]=d}for(s=0;c>s;s++)a=u[s],a&&void 0!==a.index&&a!==Fn&&a!==Nn&&ci(a,t[s]);var h,_,m=[],p=!0;for(s=0;c>s;s++)if(a=u[s],a&&a!==Nn){var f=s;if(void 0===a.index){var g={};ui(a,t[s],r-i+s,g);var v,y=a,b=a;for(o=s-1;!y.firstInSequence&&(v=t[o],v!==Dn);o--){var w=r-i+o;if(0>w)break;if(!ui(y.prev,v,w,g))break;y=y.prev,o>=0&&(u[o]=y)}for(o=s+1;!b.lastInSequence&&(v=t[o],v!==On&&o!==n||b.next===Nn)&&(b.next===Nn||ui(b.next,v,r-i+o,g))&&(b=b.next,c>o&&(u[o]=b),f=o,b!==Nn);o++);if(h=y.firstInSequence?null:y.prev,_=b.lastInSequence?null:b.next,h&&D(h),_&&D(b),"number"==typeof r){if(b===Nn)h&&B(Nn,T(h),h);else{var I=g.slotNext;I||(I=J(b.index,Un,Fn,Nn,!0)),M(I,y,b)}y.prev.index===y.index-1&&L(y.prev),b.next.index===b.index+1&&L(b)}else p||(l=u[s-1],l&&(y.prev!==l&&(b===Nn?(h&&B(Nn,T(h),h),M(y,T(l),l)):B(l,y,b)),L(l)));if(p=!1,Jn)return;m.push({slotBeforeSequence:h,slotFirstInSequence:y,slotLastInSequence:b,slotAfterSequence:_})}s!==i||a===e||j(e)||(h=e.firstInSequence?null:e.prev,_=e.lastInSequence?null:e.next,si(a,e,a.bindingMap),oi(a,e),m.push({slotBeforeSequence:h,slotFirstInSequence:a,slotLastInSequence:a,slotAfterSequence:_})),s=f}for(C(n)&&Nn.index!==n&&_t(Nn,n),mi(m),s=0;c>s;s++)if(a=u[s]){for(o=s-1;o>=0;o--){var S=u[o+1];ci(u[o]=S.firstInSequence?W(u[o+1],Un):S.prev,t[o])}for(o=s+1;c>o;o++)l=u[o-1],a=u[o],a?a.firstInSequence&&(a.prev!==l&&B(l,a,A(a)),L(l)):ci(u[o]=l.lastInSequence?U(l,Un):l.next,t[o]);break}delete e.description}(),Jn||(void 0!==n&&n!==Rn&&dt(n),ei()),lt(),Pt(),void b(o)):(wi(),void b(o)))}function gi(e,t){switch(t.name){case f.noResponse:zt(m.failure),Tt(e,t);break;case f.doesNotExist:e.indexRequested?pi(e.index):(e.keyRequested||e.description)&&yt(e),lt(),wi()}}function vi(e,t,i,n,s,o){o=I(o),s=S(s);var a=e-n,l=i.length;if(t.index>=a&&t.index<a+l)fi(t,i,t.index-a,s,t.index);else if(n===l-1&&e<t.index||C(s)&&s<=t.index)gi(t,new r(f.doesNotExist));else if(t.index<a){var c=Vt(t,0,a-t.index);Kt(a,t,c,lr(c,i[0].key,a-t.index,0))}else{var u=a+l-1,c=Vt(t,t.index-u,0);Kt(u,t,c,lr(c,i[l-1].key,0,t.index-u))}}function yi(e,t,i){switch(i.name){case f.doesNotExist:e===Fn.index?(pi(0),gi(t,i)):wi();break;default:gi(t,i)}}function bi(){for(var e=0;e<mr.length&&"beginRefresh"!==mr[e].kind;e++);for(var t=e;t<mr.length&&"beginRefresh"!==mr[t].kind;t++);if(t>e&&t+(t-e)<mr.length){for(var i=!0,n=t-e,r=0;n>r;r++)if(mr[e+r].kind!==mr[t+r].kind){i=!1;break}if(i&&o.log){o.log(v.refreshCycleIdentified,"winjs vds","error");for(var r=e;t>r;r++)o.log(""+(r-e)+": "+JSON.stringify(mr[r]),"winjs vds","error")}return i}}function Ci(){return++_r>a&&bi()?void zt(m.failure):(mr[++pr%mr.length]={kind:"beginRefresh"},Qn={firstInSequence:!0,lastInSequence:!0,index:-1},$n={firstInSequence:!0,lastInSequence:!0},Qn.next=$n,$n.prev=Qn,Zn=!1,Xn=void 0,er={},tr={},ir={},ir[-1]=Qn,void(nr={}))}function wi(){if(!Jn){if(Jn=!0,zt(m.waiting),Sn)return Sn=!1,void Xi();if(!wn){var e=++Tn;Kn=!0,Yn=0,u.schedule(function(){if(Tn===e){Jn=!1,Ci();for(var t=Fn.next;t!==zn;){var i=t.next;tt(t)||t===Nn||it(t),t=i}Ai()}},u.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function Ii(){return Gn=Gn||new d,wi(),Gn.promise}function Si(e,t){return delete Bn[t],e!==Tn?!1:(Yn--,!0)}function Ei(e,t,i,n,o){var a=Tn;Yn++,n.then(function(t){if(!t.items||!t.items.length)return c.wrapError(new r(f.doesNotExist));var n="itemsFetched id="+i+" count="+t.items.length;s(n),Si(a,i)&&(qt(t),Ri(e,t.items,t.offset,t.totalCount,"number"==typeof o?o:t.absoluteIndex)),b(n)}).then(null,function(n){Si(a,i)&&Fi(e,t,n)})}function xi(e,t,i,n){if(lr)Ei(e.key,!1,t,lr(t,e.key,i,n,e.hints));else{var r=10,s=e.index;ir[s]&&ir[s].firstInSequence?Ei(e.key,!1,t,cr(t,s-1,Math.min(i+r,s)-1,n+1+r),s-1):ir[s]&&ir[s].lastInSequence?Ei(e.key,!1,t,cr(t,s+1,Math.min(i+r,s)+1,n-1+r),s+1):Ei(e.key,!1,t,cr(t,s,Math.min(i+r,s),n+r),s)}}function ki(e){ur?Ei(null,!0,e,ur(e,1),0):cr&&Ei(null,!0,e,cr(e,0,0,0),0)}function Pi(e){return Bn[er[e]]}function Ti(e,t){for(var i,n,r,s=3,o=Tn,a=0,l=e;l!==zn;l=l.next){if(!i&&l.key&&!nr[l.key]&&!Pi(l.key)){var c=tr[l.key];(!c||c.firstInSequence||c.lastInSequence)&&(i=l,n=c,r=Ut())}if(i){var u=Pi(l.key);if(nr[l.key]||tr[l.key]||u||(l.key&&(er[l.key]=r),a++),l.lastInSequence||l.next===Nn||u){if(xi(i,r,!n||n.firstInSequence?s:0,a-1+s),!t)break;i=null,a=0}}else l.key&&K(l)&&!nr[l.key]&&(tr[l.key]||(r=Ut(),Ei(l.key,!1,r,lr(r,l.key,1,1,l.hints))))}0!==Yn||Zn||Tn!==o||ki(Ut())}function Ai(){var e=Tn;do rr=!1,sr=!0,Ti(Fn.next,!0),sr=!1;while(0===Yn&&rr&&Tn===e&&Kn);0===Yn&&Tn===e&&Ji()}function Mi(e){var t=Tn;if(e){var i=Wn[e];i||(i=Fn.next);do or=!1,ar=!0,Ti(i,!1),ar=!1;while(or&&Tn===t&&Kn)}sr?rr=!0:0===Yn&&Tn===t&&Ai()}function Bi(e){if("object"==typeof e&&e){if(e===Dn)return Qn;if(e===On)return $n;if(e.key)return tr[e.key];throw new r("WinJS.UI.ListDataSource.InvalidKeyReturned",v.invalidKeyReturned)}throw new r("WinJS.UI.ListDataSource.InvalidItemReturned",v.invalidItemReturned)}function Li(e,t){for(;void 0===e.index;){if(F(e,t,ir),e.firstInSequence)return!0;e=e.prev,t--}return e.index!==t?(wi(),!1):!0}function Di(e,t){e.key=t.key,tr[e.key]=e,e.item=t}function Oi(){for(var e=$n;!e.firstInSequence;)if(e=e.prev,e===Qn)return null;return e}function Ri(e,t,i,n,r){r=I(r),n=S(n);var s=!1;Zn=!0;var o=r-i,a=t[0];a.key===e&&(s=!0);var l=Bi(a);if(l){if(+o===o&&!Li(l,o))return}else{if(ir[o])return void wi();var c;if(void 0!==r&&(c=ir[o-1])){if(!c.lastInSequence)return void wi();l=U(c,ir)}else{var u=+o===o?J(o,ir,Qn,$n):Oi(Qn,$n);if(!u)return void wi();l=z(u,o,ir)}Di(l,t[0])}for(var d=t.length,h=1;d>h;h++){a=t[h],a.key===e&&(s=!0);var _=Bi(a);if(_){if(void 0!==l.index&&!Li(_,l.index+1))return;if(_!==l.next){if(!l.lastInSequence||!_.firstInSequence)return void wi();var m=A(_);if(m!==$n)B(l,_,m);else{var f=T(l);if(f===Qn)return void wi();M(_,f,l)}L(l)}else l.lastInSequence&&L(l)}else{if(!l.lastInSequence)return void wi();_=U(l,ir),Di(_,a)}l=_}if(s||(nr[e]=!0),!C(n)&&!$n.firstInSequence){var g=$n.prev.index;void 0!==g&&(n=g+1)}if(C(n)||n===p.unknown){if(C(Xn)){if(n!==Xn)return void wi()}else Xn=n;C(Xn)&&!ir[Xn]&&F($n,Xn,ir)}ar?or=!0:Mi(e)}function Fi(e,t,i){switch(i.name){case f.noResponse:zt(m.failure);break;case f.doesNotExist:t?(F($n,0,ir),Xn=0,Ji()):(nr[e]=!0,ar?or=!0:Mi(e))}}function Ni(e){return e===Qn?Fn:e===$n?Nn:Wn[e.key]}function zi(e){return e===Fn?Qn:e===Nn?$n:tr[e.key]}function Hi(e){L(e),e.next.mergedForRefresh=!0}function Wi(e,t){R(t,e.key),t.itemNew=e.item}function Ui(e,t,i){var n=x();Wi(e,n),O(n,t,i,!i);var r=e.index;return+r!==r&&(r=i?n.prev.index+1:t.next.index-1),F(n,r,Un),n}function Vi(e,t,i){e?(si(e,t,e.bindingMap),ai(e,t,i.item)):(Wi(i,t),t.indexRequested&&ni(t))}function qi(e,t,i){return t.key?!1:(e?(i.mergeWithPrev=!t.firstInSequence,i.mergeWithNext=!t.lastInSequence):i.stationary=!0,Vi(e,t,i),!0)}function ji(e){var t;if(e.indexRequested)t=e.index;else{var i=zi(e);i&&(t=i.index)}return t}function Ji(){_r=0,mr=new Array(100),pr=-1,kn=!0,er={};var e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v=[],y=[];for(m=0,a=Qn;a;a=a.next)a.sequenceNumber=m,a.firstInSequence&&(c=a),a.lastInSequence&&(y[m]={first:c,last:a,matchingItems:0},m++);for(qn=null,Vn=0,i=Fn.next;i!==zn;)a=tr[i.key],r=i.next,i!==Nn&&(tt(i)?i.key&&!a?vt(i,!1):0===Xn||i.indexRequested&&i.index>=Xn?vt(i,!0):i.item||i.keyRequested?i.itemNew=a.item:i.key&&(i.keyRequested||(delete Wn[i.key],delete i.key),i.itemNew=null):it(i)),i=r;for(i=Fn.next;i!==Nn;)r=i.next,i.indexRequested&&(a=ir[i.index],a&&Vi(Ni(a),i,a)),i=r;var b,C,w,I,S,E=0,x=[];for(u=0,i=Fn;i!==zn;i=i.next){if(i.firstInSequence)for(c=i,w=null,e=0;m>e;e++)x[e]=0;if(i.indexRequested&&(w=i),a=zi(i),a&&x[a.sequenceNumber]++,i.lastInSequence){for(C=0,e=E;m>e;e++)C<x[e]&&(C=x[e],b=e);d={first:c,last:i,sequenceNew:C>0?y[b]:void 0,matchingItems:C},w&&(d.indexRequested=!0,d.stationarySlot=w),v[u]=d,i===Nn&&(I=u,S=d),u++,void 0!==y[b].first.index&&(E=b)}}v[0].sequenceNew!==y[0]&&(D(Fn),v[0].first=Fn.next,v.unshift({first:Fn,last:Fn,sequenceNew:y[0],matchingItems:1}),I++,u++);var k=!Nn.firstInSequence;for(S.sequenceNew!==y[m-1]&&(D(Nn.prev),S.last=Nn.prev,I++,v.splice(I,0,{first:Nn,last:Nn,sequenceNew:y[m-1],matchingItems:1}),u++,S=v[I]),e=0;u>e;e++)p=v[e].sequenceNew,p&&p.matchingItems<v[e].matchingItems&&(p.matchingItems=v[e].matchingItems,p.sequenceOld=v[e]);for(y[m-1].sequenceOld=S,S.stationarySlot=Nn,y[0].sequenceOld=v[0],v[0].stationarySlot=Fn,e=0;I>=e;e++)d=v[e],d.sequenceNew&&(_=d.sequenceNew.sequenceOld)===h&&h.last!==Nn?(Hi(_.last),_.last=d.last,delete v[e]):h=d;for(h=null,e=I;e>=0;e--)d=v[e],d&&(d.sequenceNew&&(_=d.sequenceNew.sequenceOld)===h&&d.last!==Nn?(Hi(d.last),_.first=d.first,delete v[e]):h=d);k&&delete Nn.mergedForRefresh;var P=[];for(e=I+1;u>e;e++)if(d=v[e],d&&(!d.sequenceNew||d.sequenceNew.sequenceOld!==d)){var T=!0,A=null,O=null,R=0;for(a=zi(d.first),a&&(A=O=a,R=1),i=d.first;i!==d.last;i=i.next){var F=zi(i.next);if(a&&F&&(a.lastInSequence||a.next!==F)){T=!1;break}a&&!A&&(A=O=a),F&&A&&(O=F,R++),a=F}if(T&&A&&void 0!==A.index){var N;A.firstInSequence||(s=Ni(A.prev),s&&(N=s.index));var z;if(O.lastInSequence||(o=Ni(O.next),o&&(z=o.index)),(!o||o.lastInSequence||o.mergedForRefresh)&&(void 0===N||void 0===z||z-N-1>=R)){for(d.locationJustDetermined=!0,a=A;a.locationJustDetermined=!0,a!==O;a=a.next);var c=Ni(A),H=Ni(O);P.push({slotBeforeSequence:c.firstInSequence?null:c.prev,slotFirstInSequence:c,slotLastInSequence:H,slotAfterSequence:H.lastInSequence?null:H.next})}}}for(e=0;u>e;e++)if(d=v[e],!(!d||d.indexRequested||d.locationJustDetermined||d.sequenceNew&&d.sequenceNew.sequenceOld===d)){d.sequenceNew=null,i=d.first;var W;do{if(W=i===d.last,r=i.next,i!==Fn&&i!==Nn&&i!==zn&&!i.item&&!i.keyRequested)if(vt(i,!0),d.first===i){if(d.last===i){delete v[e];break}d.first=i.next}else d.last===i&&(d.last=i.prev);i=r}while(!W)}for(e=0;m>e;e++){for(p=y[e],a=p.first;!Ni(a)&&!a.lastInSequence;a=a.next);if(a.lastInSequence&&!Ni(a))p.firstInner=p.lastInner=null;else{for(p.firstInner=a,a=p.last;!Ni(a);a=a.prev);p.lastInner=a}}for(e=0;m>e;e++)if(p=y[e],p&&p.firstInner&&(d=p.sequenceOld)){var U=0;for(i=d.first;!0&&(a=zi(i),a&&a.sequenceNumber===p.firstInner.sequenceNumber&&(a.ordinal=U),!i.lastInSequence);i=i.next,U++);var V=[];for(a=p.firstInner;!0;a=a.next){if(U=a.ordinal,void 0!==U){for(var q=0,j=V.length-1;j>=q;){var J=Math.floor(.5*(q+j));V[J].ordinal<U?q=J+1:j=J-1}V[q]=a,q>0&&(a.predecessor=V[q-1])}if(a===p.lastInner)break}var G=[],Y=V.length;for(a=V[Y-1],t=Y;t--;)a.stationary=!0,G[t]=a,a=a.predecessor;d.stationarySlot=Ni(G[0]),a=G[0],i=Ni(a),n=i.prev;for(var Z=i.firstInSequence;!a.firstInSequence;)if(a=a.prev,l=Ni(a),!l||a.locationJustDetermined)for(;!Z&&n!==Fn&&(i=n,n=i.prev,Z=i.firstInSequence,!qi(l,i,a)););for(t=0;Y-1>t;t++){a=G[t],i=Ni(a);var l,X=G[t+1],$=null,et=Ni(X);for(r=i.next,a=a.next;a!==X&&!$&&i!==et;a=a.next)if(l=Ni(a),!l||a.locationJustDetermined)for(;r!==et;){if(r.mergedForRefresh){$=a.prev;break}if(i=r,r=i.next,qi(l,i,a))break}if($)for(n=et.prev,a=X.prev;a!==$&&et!==i;a=a.prev)if(l=Ni(a),!l||a.locationJustDetermined)for(;n!==i&&(et=n,n=et.prev,!qi(l,et,a)););for(;r!==et;)i=r,r=i.next,i!==Fn&&K(i)&&!i.keyRequested&&vt(i)}for(a=G[Y-1],i=Ni(a),r=i.next,Z=i.lastInSequence;!a.lastInSequence;)if(a=a.next,l=Ni(a),!l||a.locationJustDetermined)for(;!Z&&r!==Nn&&(i=r,r=i.next,Z=i.lastInSequence,!qi(l,i,a)););}for(e=0;m>e;e++)if(p=y[e],p.firstInner)for(n=null,a=p.firstInner;!0;a=a.next){if(i=Ni(a)){if(!a.stationary){var nt,rt=!1,st=!1;if(n)nt=n.next,rt=!0;else{var ot;for(ot=p.firstInner;!ot.stationary&&ot!==p.lastInner;ot=ot.next);if(ot.stationary)nt=Ni(ot),st=!0;else if(f=a.index,0===f)nt=Fn.next,rt=!0;else if(void 0===f)nt=zn;else{nt=Fn.next;for(var at=null;;){if(nt.firstInSequence&&(at=nt),f<nt.index&&at||nt===Nn)break;nt=nt.next}!nt.firstInSequence&&at&&(nt=at)}}i.mergedForRefresh&&(delete i.mergedForRefresh,i.lastInSequence||(i.next.mergedForRefresh=!0)),rt=rt||a.mergeWithPrev,st=st||a.mergeWithNext;var ct=a.locationJustDetermined;gt(i,nt,rt,st,ct),ct&&st&&(nt.mergedForRefresh=!0)}n=i}if(a===p.lastInner)break}for(e=0;m>e;e++)if(p=y[e],p.firstInner)for(n=null,a=p.firstInner;!0;a=a.next){if(i=Ni(a),!i){var ut;if(n)ut=n.next;else{var ht;for(ht=p.firstInner;!Ni(ht);ht=ht.next);ut=Ni(ht)}i=Ui(a,ut,!!n);var F=zi(ut);ut.mergedForRefresh||F&&F.locationJustDetermined||(Q(i),pt(i))}if(n=i,a===p.lastInner)break}Un=[];var mt=-1;for(i=Fn,g=0;i!==zn;g++){var r=i.next;if(i.firstInSequence&&(c=i,g=0),void 0===mt){var ft=ji(i);void 0!==ft&&(mt=ft-g)}if(void 0!==mt&&!i.lastInSequence){var yt=ji(i.next);if(void 0!==yt&&yt!==mt+g+1){D(i);for(var bt=!0,Ct=i.next,wt=!1;!wt&&Ct!==Nn;){var It=Ct.next;wt=Ct.lastInSequence,gt(Ct,It,!bt,!1),bt=!1,Ct=It}}}if(i.lastInSequence){f=mt;for(var St=c;St!==r;){var Et=St.next;if(f>=Xn&&St!==Nn)vt(St,!0);else{var xt=Un[f];f!==St.index?(delete Un[f],_t(St,f)):+f===f&&Un[f]!==St&&(Un[f]=St),St.itemNew&&ni(St),xt&&(St.key?(si(St,xt,St.bindingMap),oi(St,xt),+f===f&&(Un[f]=St)):(si(xt,St,xt.bindingMap),oi(xt,St),+f===f&&(Un[f]=xt))),+f===f&&f++}St=Et}mt=void 0}i=r}var kt,Tt=-2;for(i=Fn,g=0;i!==zn;g++){var r=i.next;if(i.firstInSequence&&(c=i,g=0),delete i.mergedForRefresh,i.lastInSequence)if(void 0===c.index){s=c.prev;var At;s&&(At=zi(s))&&!At.lastInSequence&&(a=zi(i))&&a.prev===At?(B(s,c,i),L(s)):i===Nn||kt||M(zn,c,i)}else{if(Tt<i.index&&!kt)Tt=i.index;else{for(o=Fn.next;o.index<i.index;o=o.next);for(var Ct=c;Ct!==r;){var It=Ct.next;a=zi(Ct),gt(Ct,o,o.prev.index===Ct.index-1,o.index===Ct.index+1,a&&a.locationJustDetermined),Ct=It}}s=c.prev,s&&s.index===c.index-1&&L(s)}i===Nn&&(kt=!0),i=r}kn=!1,mi(P),void 0!==Xn&&Xn!==Rn&&dt(Xn),lt();var Mt=[];for(e=0;m>e;e++){p=y[e];var Bt=[];i=null,g=0;var Lt;for(a=p.first;!0&&(a===Qn?Bt.push(Dn):a===$n?Bt.push(On):(Bt.push(a.item),i||(i=Ni(a),Lt=g)),!a.lastInSequence);a=a.next,g++);i&&Mt.push({slot:i,results:Bt,offset:Lt})}for(Ci(),Kn=!1,Pt(),e=0;e<Mt.length;e++){var Dt=Mt[e];fi(Dt.slot,Dt.results,Dt.offset,Rn,Dt.slot.index)}if(Gn){var Ot=Gn;Gn=null,Ot.complete()}ei()}function Ki(e,t,i,n,r,s,o){var a=Cn.prev,l={prev:a,next:Cn,applyEdit:e,editType:t,complete:i,error:n,keyUpdate:r};a.next=l,Cn.prev=l,wn=!0,(Jn||Kn)&&(Tn++,Kn=!1,Jn=!0),Cn.next===l&&Xi(),l.failed||(s(),l.undo=o),yn||Qi()}function Gi(){bn=!1;var e=Cn.next.next;Cn.next=e,e.prev=Cn}function Yi(){for(;Cn.prev!==Cn;){var e=Cn.prev;e.error&&e.error(new r(g.canceled)),e.undo&&!Jn&&e.undo(),Cn.prev=e.prev}Cn.next=Cn,yn=!1,Qi()}function Zi(t){function i(){Sn||(s?In=!0:Xi())}function n(e){if(e){var n;if(o&&o.key!==e.key){var r=e.key;if(t.undo){if(n=o.slot){var a=n.key;a&&delete Wn[a],R(n,r),n.itemNew=e,n.item?(ft(n),lt()):kt(n)}}else o.key=r}else t.editType===vr.change&&(n.itemNew=e,s||ii(n))}Gi(),t.complete&&t.complete(e),i()}function r(e){switch(e.Name){case g.noResponse:return zt(m.failure),Sn=!0,void(bn=!1);case g.notPermitted:break;case g.noLongerMeaningful:wi()}t.failed=!0,Gi(),Yi(),t.error&&t.error(e),i()}if(!bn){var s=!0,o=t.keyUpdate;e.beginEdits&&!vn&&(vn=!0,e.beginEdits()),bn=!0,t.applyEdit().then(n,r),s=!1}}function Xi(){for(;Cn.next!==Cn;)if(In=!1,Zi(Cn.next),!In)return;$i()}function Qi(){St(),lt(),Pt(),Cn.next===Cn&&$i()}function $i(){wn=!1,e.endEdits&&vn&&!yn&&(vn=!1,e.endEdits()),Jn?(Jn=!1,wi()):ei()}function en(e){return Dt(e),Wn[e]||Ot(e)}function tn(e,t,i,n,r){var s=x();return O(s,i,n,r),e&&R(s,e),s.itemNew=t,wt(s,1),yn||En||(s.firstInSequence||"number"!=typeof s.prev.index?s.lastInSequence||"number"!=typeof s.next.index||F(s,s.next.index-1,Un):F(s,s.prev.index+1,Un)),Q(s),pt(s),s}function nn(e,t,i,n,r){var s={key:e};return new c(function(e,o){Ki(r,vr.insert,e,o,s,function(){if(i){var e={key:s.key,data:t};s.slot=tn(s.key,e,i,n,!n)}},function(){var e=s.slot;e&&(wt(e,-1),vt(e,!1))})})}function rn(e,t,i,n){return new c(function(r,s){var o,a,l,c;Ki(n,vr.move,r,s,null,function(){a=e.next,l=e.firstInSequence,c=e.lastInSequence;var n=e.prev;o=!("number"==typeof e.index||!l&&n.item||!c&&a.item),wt(e,-1),gt(e,t,i,!i),wt(e,1),o&&(D(n),l||hi(n,e),c||_i(a,e))},function(){o?wi():(wt(e,-1),gt(e,a,!l,!c),wt(e,1))})})}function sn(){function e(){En||(St(),lt(),Pt())}this.invalidateAll=function(){return 0===Rn?(this.reload(),c.wrap()):Ii()},this.reload=function(){fn&&fn.cancel(),Gn&&Gn.cancel();for(var e=Fn.next;e!==zn;e=e.next){var t=e.fetchListeners;for(var i in t)t[i].promise.cancel();var n=e.directFetchListeners;for(var i in n)n[i].promise.cancel()}on(),st(function(e){e.notificationHandler&&e.notificationHandler.reload()})},this.beginNotifications=function(){En=!0},this.inserted=function(t,i,n,r){if(wn)wi();else{var s=t.key,o=Wn[i],a=Wn[n],l="string"==typeof i,c="string"==typeof n;if(l?a&&!a.firstInSequence&&(o=a.prev):c&&o&&!o.lastInSequence&&(a=o.next),(l||c)&&!o&&!a&&Fn.next===Nn)return void wi();if(Wn[s])return void wi();if(o&&a&&(o.next!==a||o.lastInSequence||a.firstInSequence))return void wi();if(o&&(o.keyRequested||o.indexRequested)||a&&(a.keyRequested||a.indexRequested))return void wi();if(o||a)tn(s,t,a?a:o.next,!!o,!!a);else if(Fn.next===Nn)tn(s,t,Fn.next,!0,!0);else{if(void 0===r)return void wi();It(r,1)}e()}},this.changed=function(t){if(wn)wi();else{var i=t.key,n=Wn[i];n&&(n.keyRequested?wi():(n.itemNew=t,n.item&&(ft(n),e())))}},this.moved=function(t,i,n,r,s){if(wn)wi();else{var o=t.key,a=Wn[o],l=Wn[i],c=Wn[n];a&&a.keyRequested||l&&l.keyRequested||c&&c.keyRequested?wi():a?l&&c&&(l.next!==c||l.lastInSequence||c.firstInSequence)?wi():l||c?(wt(a,-1),gt(a,c?c:l.next,!!l,!!c),wt(a,1),e()):(wt(a,-1),vt(a,!1),void 0!==r&&(s>r&&s--,It(s,1)),e()):l||c?(void 0!==r&&(It(r,-1),s>r&&s--),this.inserted(t,i,n,s)):void 0!==r&&(It(r,-1),s>r&&s--,It(s,1),e())}},this.removed=function(t,i){if(wn)wi();else{var n;n="string"==typeof t?Wn[t]:Un[i],n?n.keyRequested?wi():(wt(n,-1),vt(n,!1),e()):void 0!==i&&(It(i,-1),e())}},this.endNotifications=function(){En=!1,e()}}function on(){zt(m.ready),fn=null,vn=!1,yn=!1,bn=!1,Cn={},Cn.next=Cn,Cn.prev=Cn,wn=!1,Sn=!1,xn=0,kn=!1,Pn=0,Bn={},Ln=[],Rn=p.unknown,Fn={firstInSequence:!0,lastInSequence:!0,index:-1},Nn={firstInSequence:!0,lastInSequence:!0},zn={firstInSequence:!0,lastInSequence:!0},Fn.next=Nn,Nn.prev=Fn,Nn.next=zn,zn.prev=Nn,Hn={},Wn={},Un={},Un[-1]=Fn,Vn=0,qn=null,jn=!1,Jn=!1,Kn=!1,Gn=null}var an,ln,cn,un,dn,hn,_n,mn,pn,fn,gn,vn,yn,bn,Cn,wn,In,Sn,En,xn,kn,Pn,Tn,An,Mn,Bn,Ln,Dn,On,Rn,Fn,Nn,zn,Hn,Wn,Un,Vn,qn,jn,Jn,Kn,Gn,Yn,Zn,Xn,Qn,$n,er,tr,ir,nr,rr,sr,or,ar,lr,cr,ur,dr,hr,_r=0,mr=new Array(100),pr=-1;e.itemsFromKey&&(lr=function(t,i,n,r,o){var a="fetchItemsFromKey id="+t+" key="+i+" countBefore="+n+" countAfter="+r;s(a),mr[++pr%mr.length]={kind:"itemsFromKey",key:i,countBefore:n,countAfter:r};var l=e.itemsFromKey(i,n,r,o);return b(a),l}),e.itemsFromIndex&&(cr=function(t,i,n,r){var o="fetchItemsFromIndex id="+t+" index="+i+" countBefore="+n+" countAfter="+r;s(o),mr[++pr%mr.length]={kind:"itemsFromIndex",index:i,countBefore:n,countAfter:r};var a=e.itemsFromIndex(i,n,r);return b(o),a}),e.itemsFromStart&&(ur=function(t,i){var n="fetchItemsFromStart id="+t+" count="+i;s(n),mr[++pr%mr.length]={kind:"itemsFromStart",count:i};var r=e.itemsFromStart(i);return b(n),r}),e.itemsFromEnd&&(dr=function(t,i){var n="fetchItemsFromEnd id="+t+" count="+i;s(n),mr[++pr%mr.length]={kind:"itemsFromEnd",count:i};var r=e.itemsFromEnd(i);return b(n),r}),e.itemsFromDescription&&(hr=function(t,i,n,r){var o="fetchItemsFromDescription id="+t+" desc="+i+" countBefore="+n+" countAfter="+r;s(o),mr[++pr%mr.length]={kind:"itemsFromDescription",description:i,countBefore:n,countAfter:r};var a=e.itemsFromDescription(i,n,r);return b(o),a});var fr=++_,gr=this,vr={insert:"insert",change:"change",move:"move",remove:"remove"};if(!e)throw new r("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",v.listDataAdapterIsInvalid);ln=e.compareByIdentity?0:200,i&&"number"==typeof i.cacheSize&&(ln=i.cacheSize),e.setNotificationHandler&&(an=new sn,e.setNotificationHandler(an)),cn=m.ready,dn=!1,hn={},_n=0,mn=1,pn=0,Tn=0,An=!1,Mn=1,Dn={},On={},on(),this.createListBinding=function(e){function t(e){e&&e.cursorCount++}function i(e){e&&0===--e.cursorCount&&rt(e)}function n(e){t(e),i(h),h=e}function r(e,t){e===h&&(t||(t=!h||h.lastInSequence||h.next===Nn?null:h.next),n(t))}function s(e){var t=e.bindingMap,i=t[d].handle;delete e.bindingMap[d];var n=!0,r=!0;for(var s in t)if(n=!1,i&&t[s].handle===i){r=!1;break}i&&r&&delete Hn[i],n&&(e.bindingMap=null,rt(e))}function o(e,t){e.bindingMap||(e.bindingMap={});var i=e.bindingMap[d];if(i?i.count++:e.bindingMap[d]={bindingRecord:hn[d],count:1},e.fetchListeners){var n=e.fetchListeners[t];n&&(n.retained=!0)}}function a(e){var t=Hn[e];if(t){var i=t.bindingMap[d];if(0===--i.count){var n=t.fetchListeners;for(var r in n){var o=n[r];o.listBindingID===d&&(o.retained=!1)}s(t)}}}function l(t){var i=ct(t,d),n=(pn++).toString(),r=Et(t,"fetchListeners",n,d,function(e,t){e(ut(t,i))});return Y(r,t,i),e&&(r.retain=function(){return m._retainItem(t,n),r},r.release=function(){m._releaseItem(i)}),r}function u(t){var i;return!_&&t?i=l(t):(_?(i=new c(function(){}),i.cancel()):i=c.wrap(null),G(i,null),e&&(i.retain=function(){return i},i.release=function(){})),n(t),i}var d=(_n++).toString(),h=null,_=!1;hn[d]={notificationHandler:e,notificationsSent:!1,adjustCurrentSlot:r,itemPromiseFromKnownSlot:l};var m={_retainItem:function(e,t){o(e,t)},_releaseItem:function(e){a(e)},jumpToItem:function(e){return u(e?Hn[e.handle]:null)},current:function(){return u(h)},previous:function(){return u(h?Mt(h):null)},next:function(){return u(h?Bt(h):null)},releaseItem:function(e){this._releaseItem(e.handle)},release:function(){_=!0,i(h),h=null;for(var e=Fn.next;e!==zn;){var t=e.next,n=e.fetchListeners;for(var r in n){var o=n[r];o.listBindingID===d&&(o.promise.cancel(),delete n[r])}e.bindingMap&&e.bindingMap[d]&&s(e),e=t}delete hn[d]}};return(ur||cr)&&(m.first=function(){return u(Bt(Fn))}),dr&&(m.last=function(){return u(Mt(Nn))}),lr&&(m.fromKey=function(e,t){return u(Rt(e,t))}),(cr||ur&&lr)&&(m.fromIndex=function(e){return u(Ft(e))}),hr&&(m.fromDescription=function(e){return u(Nt(e))}),m},this.invalidateAll=function(){return Ii()};var yr=function(e,t){var i=new d;e.then(function(e){i.complete(e)},function(e){i.error(e)});var n=i.promise.then(null,function(i){return"WinJS.UI.VirtualizedDataSource.resetCount"===i.name?(fn=null,e=t.getCount()):c.wrapError(i)}),s=0,o={get:function(){return s++,new c(function(e,t){n.then(e,t)},function(){0===--s&&(i.promise.cancel(),e.cancel(),o===fn&&(fn=null))})},reset:function(){i.error(new r("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){i.promise.cancel(),e.cancel(),o===fn&&(fn=null)}};return o};this.getCount=function(){if(e.getCount){var t=this;return c.wrap().then(function(){if(yn||wn)return Rn;var i;if(!fn){var n;i=e.getCount();var r;i.then(function(){fn===n&&(fn=null),r=!0},function(){fn===n&&(fn=null),r=!0}),xn=0,r||(n=fn=yr(i,t))}return fn?fn.get():i}).then(function(e){if(!w(e)&&void 0!==e)throw new r("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",v.invalidRequestedCountReturned);return e!==Rn&&(Rn===p.unknown?Rn=e:(dt(e),lt())),0===e&&(Fn.next!==Nn||Nn.next!==zn?wi():Fn.lastInSequence&&(L(Fn),Nn.index=0)),e}).then(null,function(e){return e.name===h.CountError.noResponse?(zt(m.failure),Rn):c.wrapError(e)})}return c.wrap(Rn)},lr&&(this.itemFromKey=function(e,t){return Lt(Rt(e,t))}),(cr||ur&&lr)&&(this.itemFromIndex=function(e){return Lt(Ft(e))}),hr&&(this.itemFromDescription=function(e){return Lt(Nt(e))}),this.beginEdits=function(){yn=!0},e.insertAtStart&&(this.insertAtStart=function(t,i){return nn(t,i,Fn.lastInSequence?null:Fn.next,!0,function(){return e.insertAtStart(t,i)})}),e.insertBefore&&(this.insertBefore=function(t,i,n){var r=en(n);return nn(t,i,r,!1,function(){return e.insertBefore(t,i,n,bt(r))})}),e.insertAfter&&(this.insertAfter=function(t,i,n){var r=en(n);return nn(t,i,r?r.next:null,!0,function(){return e.insertAfter(t,i,n,bt(r))})}),e.insertAtEnd&&(this.insertAtEnd=function(t,i){return nn(t,i,Nn.firstInSequence?null:Nn,!1,function(){return e.insertAtEnd(t,i)})}),e.change&&(this.change=function(t,i){var n=en(t);return new c(function(r,s){var o;Ki(function(){return e.change(t,i,bt(n))},vr.change,r,s,null,function(){o=n.item,n.itemNew={key:t,data:i},o?ft(n):kt(n)},function(){o?(n.itemNew=o,ft(n)):wi()})})}),e.moveToStart&&(this.moveToStart=function(t){var i=en(t);return rn(i,Fn.next,!0,function(){return e.moveToStart(t,bt(i))})}),e.moveBefore&&(this.moveBefore=function(t,i){var n=en(t),r=en(i);return rn(n,r,!1,function(){return e.moveBefore(t,i,bt(n),bt(r))})}),e.moveAfter&&(this.moveAfter=function(t,i){var n=en(t),r=en(i);return rn(n,r.next,!0,function(){return e.moveAfter(t,i,bt(n),bt(r))})}),e.moveToEnd&&(this.moveToEnd=function(t){var i=en(t);return rn(i,Nn,!1,function(){return e.moveToEnd(t,bt(i))})}),e.remove&&(this.remove=function(t){Dt(t);var i=Wn[t];return new c(function(n,r){var s,o,a;Ki(function(){return e.remove(t,bt(i))},vr.remove,n,r,null,function(){i&&(s=i.next,o=i.firstInSequence,a=i.lastInSequence,wt(i,-1),vt(i,!1))},function(){i&&(V(i,s,!o,!a),wt(i,1),pt(i))})})}),this.endEdits=function(){yn=!1,Qi()}}var a=100,_=1,m=h.DataSourceStatus,p=h.CountResult,f=h.FetchError,g=h.EditError,v={get listDataAdapterIsInvalid(){return"Invalid argument: listDataAdapter must be an object or an array."},get indexIsInvalid(){return"Invalid argument: index must be a non-negative integer."},get keyIsInvalid(){return"Invalid argument: key must be a string."},get invalidItemReturned(){return"Error: data adapter returned item that is not an object."},get invalidKeyReturned(){return"Error: data adapter returned item with undefined or null key."},get invalidIndexReturned(){return"Error: data adapter should return undefined, null or a non-negative integer for the index."},get invalidCountReturned(){return"Error: data adapter should return undefined, null, CountResult.unknown, or a non-negative integer for the count."},get invalidRequestedCountReturned(){return"Error: data adapter should return CountResult.unknown, CountResult.failure, or a non-negative integer for the count."},get refreshCycleIdentified(){return"refresh cycle found, likely data inconsistency"}},y="statuschanged",b=i.Class.define(function(){},{_baseDataSourceConstructor:e,_isVirtualizedDataSource:!0},{supportedForProcessing:!1});return i.Class.mix(b,s.eventMixin),b})})}),define("WinJS/VirtualizedDataSource/_GroupDataSource",["exports","../Core/_Base","../Core/_ErrorFromName","../Promise","../Scheduler","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(e,t,i,n,r,s,o){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupDataSource:t.Namespace._lazy(function(){function e(){return new i(s.FetchError.doesNotExist)}function a(e){return e&&e.firstReached&&e.lastReached}var l=101,c=t.Class.define(function(e){this._groupDataAdapter=e},{beginNotifications:function(){},inserted:function(e,t,i){this._groupDataAdapter._inserted(e,t,i)},changed:function(e,t){this._groupDataAdapter._changed(e,t)},moved:function(e,t,i){this._groupDataAdapter._moved(e,t,i)},removed:function(e,t){this._groupDataAdapter._removed(e,t)},countChanged:function(e,t){0===e&&0!==t&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(e,t,i){this._groupDataAdapter._indexChanged(e,t,i)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),u=t.Class.define(function(e,t,i,n){this._listBinding=e.createListBinding(new c(this)),this._groupKey=t,this._groupData=i,this._initializeState(),this._batchSize=l,this._count=null,n&&("number"==typeof n.groupCountEstimate&&(this._count=n.groupCountEstimate<0?null:Math.max(n.groupCountEstimate,1)),"number"==typeof n.batchSize&&(this._batchSize=n.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(e){var t=this;return this._fetchItems(function(){return t._lastGroup},function(e){if(e)return!1;var i=t._count;return+i!==i?!0:i>0?!0:void 0},function(){t._fetchBatch(t._listBinding.last(),t._batchSize-1,0)},e-1,0)})},{setNotificationHandler:function(e){this._listDataNotificationHandler=e},compareByIdentity:!0,itemsFromKey:function(e,t,i,n){var r=this;return this._fetchItems(function(){return r._keyMap[e]},function(){var e=r._lastGroup;return e?+e.index!==e.index?!0:void 0:!0},function(){n=n||{};var e="string"==typeof n.groupMemberKey&&r._listBinding.fromKey?r._listBinding.fromKey(n.groupMemberKey):"number"==typeof n.groupMemberIndex&&r._listBinding.fromIndex?r._listBinding.fromIndex(n.groupMemberIndex):void 0!==n.groupMemberDescription&&r._listBinding.fromDescription?r._listBinding.fromDescription(n.groupMemberDescription):r._listBinding.first(),t=Math.floor(.5*(r._batchSize-1));r._fetchBatch(e,t,r._batchSize-1-t)},t,i)},itemsFromIndex:function(e,t,i){var n=this;return this._fetchItems(function(){return n._indexMap[e]},function(){var t=n._lastGroup;return t?+t.index!==t.index?!0:e<=t.index?!0:void 0:!0},function(){n._fetchNextIndex()},t,i)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return n.wrap(this._count);var e=this,t=new n(function(t){var i={initialBatch:function(){e._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(i){i&&(e._count=0);var n=e._count;return"number"==typeof n?(t(n),!0):!1}};e._fetchQueue.push(i),e._itemBatch||e._continueFetch(i)});return"number"==typeof this._count?n.wrap(this._count):t},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(e){delete this._handleMap[e.handle],this._listBinding.releaseItem(e)},_processBatch:function(){for(var e=null,t=null,i=null,n=0,s=!0,o=0;o<this._batchSize;o++){var a=this._itemBatch[o],l=a?this._groupKey(a):null;if(a&&(s=!1),t&&null!==l&&l===t.key)n++,t.lastItem===e?(t.lastItem.handle!==t.firstItem.handle&&this._releaseItem(t.lastItem),t.lastItem=a,this._handleMap[a.handle]=t,t.size++):t.firstItem===a&&(t.firstItem.handle!==t.lastItem.handle&&this._releaseItem(t.firstItem),t.firstItem=i,this._handleMap[i.handle]=t,t.size+=n);else{var c=null;if(t&&(t.lastReached=!0,"number"==typeof t.index&&(c=t.index+1)),a){var u=this._keyMap[l];if(u||(u={key:l,data:this._groupData(a),firstItem:a,lastItem:a,size:1},this._keyMap[u.key]=u,this._handleMap[a.handle]=u),o>0&&(u.firstReached=!0,t||(c=0)),"number"!=typeof u.index&&"number"==typeof c){for(var d=u;d;d=this._nextGroup(d))d.index=c,this._indexMap[c]=d,c++;this._indexMax=c,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}i=a,n=0,t=u}else t&&(this._lastGroup=t,"number"==typeof t.index&&(this._count=t.index+1),this._listDataNotificationHandler.invalidateAll(),t=null)}e=a}var h;for(h=this._fetchQueue[0];h&&h.complete(s);h=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(h){var _=this;r.schedule(function(){_._continueFetch(h)},r.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(e,t){e.retain(),this._itemBatch[t]=e;var i=this;e.then(function(e){i._itemBatch[t]=e,0===--i._itemsToFetch&&i._processBatch()
})},_fetchBatch:function(e,t){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(e,t);var i;for(this._listBinding.jumpToItem(e),i=t-1;i>=0;i--)this._processPromise(this._listBinding.previous(),i);for(this._listBinding.jumpToItem(e),i=t+1;i<this._batchSize;i++)this._processPromise(this._listBinding.next(),i)},_fetchAdjacent:function(e,t){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(e.key):this._listBinding.fromIndex(e.index),t?0:this._batchSize-1,t?this._batchSize-1:0)},_fetchNextIndex:function(){var e=this._indexMap[this._indexMax-1];e?this._fetchAdjacent(e.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(e){if(e.initialBatch)e.initialBatch(),e.initialBatch=null;else{var t=e.getGroup();if(t){var i,n;t.firstReached?t.lastReached?e.countBefore>0&&0!==t.index&&!a(i=this._previousGroup(t))?this._fetchAdjacent(i&&i.lastReached?i.firstItem:t.firstItem,!1):(n=this._nextGroup(t),this._fetchAdjacent(n&&n.firstReached?n.lastItem:t.lastItem,!0)):this._fetchAdjacent(t.lastItem,!0):this._fetchAdjacent(t.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(e,t,i,n,r){if(a(e)){var o=this._previousGroup(e);if(n||a(o)||0===e.index||0===t){var l=this._nextGroup(e);if(n||a(l)||this._lastGroup===e||0===i){for(var c=0,u=e;t>c&&(o=this._previousGroup(u),a(o));)u=o,c++;for(var d=0,h=e;i>d&&(l=this._nextGroup(h),a(l));)h=l,d++;for(var _=c+1+d,m=new Array(_),p=0;_>p;p++){var f={key:u.key,data:u.data,firstItemKey:u.firstItem.key,groupSize:u.size},g=u.firstItem.index;"number"==typeof g&&(f.firstItemIndexHint=g),m[p]=f,u=this._nextGroup(u)}var v={items:m,offset:c};return v.totalCount="number"==typeof this._count?this._count:s.CountResult.unknown,"number"==typeof e.index&&(v.absoluteIndex=e.index),h===this._lastGroup&&(v.atEnd=!0),r(v),!0}}}return!1},_fetchItems:function(t,i,r,s,o){var a=this;return new n(function(n,l){function c(r){var c=t();return c?a._fetchComplete(c,s,o,d,n,l):d&&!i(r)?(l(e()),!0):h>2?(l(e()),!0):(r?h++:h=0,!1)}var u=t(),d=!u,h=0;if(!c()){var _={initialBatch:d?r:null,getGroup:t,countBefore:s,countAfter:o,complete:c};a._fetchQueue.push(_),a._itemBatch||a._continueFetch(_)}})},_previousGroup:function(e){return e&&e.firstReached?(this._listBinding.jumpToItem(e.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(e){return e&&e.lastReached?(this._listBinding.jumpToItem(e.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(e){this._count=null,this._lastGroup=null,"number"==typeof e.index&&(this._indexMax=e.index>0?e.index:null);for(var t=e;t&&"number"==typeof t.index;t=this._nextGroup(t))delete this._indexMap[t.index],t.index=null},_releaseGroup:function(e){this._invalidateIndices(e),delete this._keyMap[e.key],this._lastGroup===e&&(this._lastGroup=null),e.firstItem!==e.lastItem&&this._releaseItem(e.firstItem),this._releaseItem(e.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var e=0;e<this._batchSize;e++){var t=this._itemBatch[e];t&&(t.cancel&&t.cancel(),this._listBinding.releaseItem(t))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(e,t,i){var n=this._handleMap[t],r=this._handleMap[i],s=null;n&&(n.lastReached&&t===n.lastItem.handle&&(s=this._groupKey(e))!==n.key?this._lastGroup===n&&(this._lastGroup=null,this._count=null):this._releaseGroup(n),this._beginRefresh()),r&&r!==n&&(this._invalidateIndices(r),r.firstReached&&i===r.firstItem.handle&&(null!==s?s:this._groupKey(e))!==r.key||this._releaseGroup(r),this._beginRefresh())},_processRemoval:function(e){var t=this._handleMap[e];if(!t||e!==t.firstItem.handle&&e!==t.lastItem.handle){if(this._itemBatch)for(var i=0;i<this._batchSize;i++){var n=this._itemBatch[i];if(n&&n.handle===e){this._beginRefresh();break}}}else this._releaseGroup(t),this._beginRefresh()},_inserted:function(e,t,i){var n=this;e.then(function(e){n._processInsertion(e,t,i)})},_changed:function(e,t){var i=this._handleMap[e.handle];if(i&&e.handle===i.firstItem.handle&&(this._releaseGroup(i),this._beginRefresh()),this._groupKey(e)!==this._groupKey(t)){this._listBinding.jumpToItem(e);var n=this._listBinding.previous().handle;this._listBinding.jumpToItem(e);var r=this._listBinding.next().handle;this._processRemoval(e.handle),this._processInsertion(e,n,r)}},_moved:function(e,t,i){this._processRemoval(e.handle);var n=this;e.then(function(e){n._processInsertion(e,t,i)})},_removed:function(e,t){t||this._processRemoval(e)},_indexChanged:function(e,t,i){"number"==typeof i&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var e in this._keyMap){var t=this._keyMap[e];if(t.firstReached&&t.lastReached){var i=t.lastItem.index+1-t.firstItem.index;isNaN(i)||(t.size=i)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return t.Class.derive(o.VirtualizedDataSource,function(e,t,i,n){var r=new u(e,t,i,n);this._baseDataSourceConstructor(r),this.extensions={invalidateGroups:function(){r.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource/_GroupedItemDataSource",["../Core/_Base","./_GroupDataSource"],function(e,t){"use strict";e.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(e,i,n,r){function s(e){if(e){var t=Object.create(e);return t.groupKey=i(e),n&&(t.groupData=n(e)),t}return null}function o(e){var t=Object.create(e);return t.then=function(t,i,n){return e.then(function(e){return t(s(e))},i,n)},t}var a=Object.create(e);a.createListBinding=function(t){var i;t?(i=Object.create(t),i.inserted=function(e,i,n){return t.inserted(o(e),i,n)},i.changed=function(e,i){return t.changed(s(e),s(i))},i.moved=function(e,i,n){return t.moved(o(e),i,n)}):i=null;for(var n=e.createListBinding(i),r=Object.create(n),a=["first","last","fromDescription","jumpToItem","current"],l=0,c=a.length;c>l;l++)!function(e){n[e]&&(r[e]=function(){return o(n[e].apply(n,arguments))})}(a[l]);return n.fromKey&&(r.fromKey=function(e){return o(n.fromKey(e))}),n.fromIndex&&(r.fromIndex=function(e){return o(n.fromIndex(e))}),r.prev=function(){return o(n.prev())},r.next=function(){return o(n.next())},r};for(var l=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],c=0,u=l.length;u>c;c++)!function(t){e[t]&&(a[t]=function(){return o(e[t].apply(e,arguments))})}(l[c]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){e[t]&&(a[t]=function(){return e[t].apply(e,arguments)})});var d=null;return Object.defineProperty(a,"groups",{get:function(){return d||(d=new t._GroupDataSource(e,i,n,r)),d},enumerable:!0,configurable:!0}),a}})}),define("WinJS/VirtualizedDataSource/_StorageDataSource",["exports","../Core/_WinRT","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_WriteProfilerMark","../Animations","../Promise","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(e,t,i,n,r,s,o,a,l,c){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{StorageDataSource:n.Namespace._lazy(function(){var e=n.Class.define(function(e,i){s("WinJS.UI.StorageDataSource:constructor,StartTM");var n,r=t.Windows.Storage.FileProperties.ThumbnailMode.singleItem,o=256,a=t.Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,l=!0;if("Pictures"===e?(r=t.Windows.Storage.FileProperties.ThumbnailMode.picturesView,n=t.Windows.Storage.KnownFolders.picturesLibrary,o=190):"Music"===e?(r=t.Windows.Storage.FileProperties.ThumbnailMode.musicView,n=t.Windows.Storage.KnownFolders.musicLibrary,o=256):"Documents"===e?(r=t.Windows.Storage.FileProperties.ThumbnailMode.documentsView,n=t.Windows.Storage.KnownFolders.documentsLibrary,o=40):"Videos"===e&&(r=t.Windows.Storage.FileProperties.ThumbnailMode.videosView,n=t.Windows.Storage.KnownFolders.videosLibrary,o=190),n){var c=new t.Windows.Storage.Search.QueryOptions;c.folderDepth=t.Windows.Storage.Search.FolderDepth.deep,c.indexerOption=t.Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=n.createFileQueryWithOptions(c)}else this._query=e;if(i){if("number"==typeof i.mode&&(r=i.mode),"number"==typeof i.requestedThumbnailSize)o=Math.max(1,Math.min(i.requestedThumbnailSize,1024));else switch(r){case t.Windows.Storage.FileProperties.ThumbnailMode.picturesView:case t.Windows.Storage.FileProperties.ThumbnailMode.videosView:o=190;break;case t.Windows.Storage.FileProperties.ThumbnailMode.documentsView:case t.Windows.Storage.FileProperties.ThumbnailMode.listView:o=40;break;case t.Windows.Storage.FileProperties.ThumbnailMode.musicView:case t.Windows.Storage.FileProperties.ThumbnailMode.singleItem:o=256}"number"==typeof i.thumbnailOptions&&(a=i.thumbnailOptions),"boolean"==typeof i.waitForFileLoad&&(l=!i.waitForFileLoad)}this._loader=new t.Windows.Storage.BulkAccess.FileInformationFactory(this._query,r,o,a,l),this.compareByIdentity=!1,this.firstDataRequest=!0,s("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(e){this._notificationHandler=e,this._query.addEventListener("contentschanged",function(){e.invalidateAll()}),this._query.addEventListener("optionschanged",function(){e.invalidateAll()})},itemsFromEnd:function(e){var t=this;return s("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(i){return 0===i?a.wrapError(new r(l.FetchError.doesNotExist)):t.itemsFromIndex(i-1,Math.min(i-1,e-1),1)})},itemsFromIndex:function(e,t,i){function n(e){u._notificationHandler.changed(u._item(e.target))}t+i>64&&(t=Math.min(t,32),i=64-(t+1));var o=e-t,c=t+1+i,u=this;u.firstDataRequest&&(u.firstDataRequest=!1,c=Math.max(c,32));var d="WinJS.UI.StorageDataSource:itemsFromIndex("+o+"-"+(o+c-1)+")";return s(d+",StartTM"),this._loader.getItemsAsync(o,c).then(function(i){var h=i.size;if(t>=h)return a.wrapError(new r(l.FetchError.doesNotExist));var _=new Array(h),m=new Array(h);i.getMany(0,m);for(var p=0;h>p;p++)_[p]=u._item(m[p]),m[p].addEventListener("propertiesupdated",n);var f={items:_,offset:t,absoluteIndex:e};return c>h&&(f.totalCount=o+h),s(d+",StopTM"),f})},itemsFromDescription:function(e,t,i){var n=this;return s("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(e).then(function(e){return n.itemsFromIndex(e,t,i)})},getCount:function(){return s("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(e){return e.folderRelativeId},_item:function(e){return{key:e.path||e.folderRelativeId,data:e}}},{supportedForProcessing:!1});return n.Class.derive(c.VirtualizedDataSource,function(t,i){this._baseDataSourceConstructor(new e(t,i))},{},{loadThumbnail:function(e,n){var r,l,c=!1;return new a(function(u){var d=n?!0:!1,h=function(h){if(h){var _=i.URL.createObjectURL(h,{oneTimeOnly:!0});l=l?l.then(function(t){return e.loadImage(_,t)}):e.loadImage(_,n).then(function(t){return e.isOnScreen().then(function(e){var i;return e&&d?i=o.fadeIn(t).then(function(){return t}):(t.style.opacity=1,i=a.wrap(t)),i})}),h.type===t.Windows.Storage.FileProperties.ThumbnailType.icon||h.returnedSmallerCachedSize||(s("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),e.data.removeEventListener("thumbnailupdated",r),c=!1,l=l.then(function(e){r=null,l=null,u(e)}))}};r=function(e){c&&h(e.target.thumbnail)},e.data.addEventListener("thumbnailupdated",r),c=!0,h(e.data.thumbnail)},function(){e.data.removeEventListener("thumbnailupdated",r),c=!1,r=null,l&&(l.cancel(),l=null)})},supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_VirtualizedDataSourceImpl","./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource","./VirtualizedDataSource/_StorageDataSource"],function(){}),define("require-style",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("require-style!less/styles-intrinsic",[],function(){}),define("require-style!less/colors-intrinsic",[],function(){}),define("WinJS/Controls/IntrinsicControls",["../Utilities/_Hoverable","require-style!less/styles-intrinsic","require-style!less/colors-intrinsic"],function(){}),define("WinJS/Controls/ItemContainer/_Constants",["exports","../../Core/_Base"],function(e,t){"use strict";var i={};i._listViewClass="win-listview",i._listViewSupportsCrossSlideClass="win-listview-supports-cross-slide",i._viewportClass="win-viewport",i._rtlListViewClass="win-rtl",i._horizontalClass="win-horizontal",i._verticalClass="win-vertical",i._scrollableClass="win-surface",i._itemsContainerClass="win-itemscontainer",i._padderClass="win-itemscontainer-padder",i._proxyClass="_win-proxy",i._itemClass="win-item",i._itemBoxClass="win-itembox",i._itemsBlockClass="win-itemsblock",i._containerClass="win-container",i._containerEvenClass="win-container-even",i._containerOddClass="win-container-odd",i._backdropClass="win-backdrop",i._footprintClass="win-footprint",i._groupsClass="win-groups",i._selectedClass="win-selected",i._swipeableClass="win-swipeable",i._swipeClass="win-swipe",i._selectionBorderClass="win-selectionborder",i._selectionBackgroundClass="win-selectionbackground",i._selectionCheckmarkClass="win-selectioncheckmark",i._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",i._pressedClass="win-pressed",i._headerClass="win-groupheader",i._headerContainerClass="win-groupheadercontainer",i._groupLeaderClass="win-groupleader",i._progressClass="win-progress",i._selectionHintClass="win-selectionhint",i._revealedClass="win-revealed",i._itemFocusClass="win-focused",i._itemFocusOutlineClass="win-focusedoutline",i._zoomingXClass="win-zooming-x",i._zoomingYClass="win-zooming-y",i._listLayoutClass="win-listlayout",i._gridLayoutClass="win-gridlayout",i._headerPositionTopClass="win-headerpositiontop",i._headerPositionLeftClass="win-headerpositionleft",i._structuralNodesClass="win-structuralnodes",i._uniformGridLayoutClass="win-uniformgridlayout",i._uniformListLayoutClass="win-uniformlistlayout",i._cellSpanningGridLayoutClass="win-cellspanninggridlayout",i._laidOutClass="win-laidout",i._nonDraggableClass="win-nondraggable",i._nonSelectableClass="win-nonselectable",i._nonSwipeableClass="win-nonswipeable",i._dragOverClass="win-dragover",i._dragSourceClass="win-dragsource",i._clipClass="win-clip",i._selectionModeClass="win-selectionmode",i._noCSSGrid="win-nocssgrid",i._INVALID_INDEX=-1,i._UNINITIALIZED=-1,i._LEFT_MSPOINTER_BUTTON=0,i._RIGHT_MSPOINTER_BUTTON=2,i._TAP_END_THRESHOLD=10,i._DEFAULT_PAGES_TO_LOAD=5,i._DEFAULT_PAGE_LOAD_THRESHOLD=2,i._MIN_AUTOSCROLL_RATE=150,i._MAX_AUTOSCROLL_RATE=1500,i._AUTOSCROLL_THRESHOLD=100,i._AUTOSCROLL_DELAY=50,i._DEFERRED_ACTION=250,i._DEFERRED_SCROLL_END=250,i._VERTICAL_SWIPE_SELECTION_THRESHOLD=39,i._VERTICAL_SWIPE_SPEED_BUMP_START=0,i._VERTICAL_SWIPE_SPEED_BUMP_END=127,i._VERTICAL_SWIPE_SELF_REVEAL_GESTURE=15,i._HORIZONTAL_SWIPE_SELECTION_THRESHOLD=27,i._HORIZONTAL_SWIPE_SPEED_BUMP_START=0,i._HORIZONTAL_SWIPE_SPEED_BUMP_END=150,i._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE=23,i._SELECTION_CHECKMARK="",i._LISTVIEW_PROGRESS_DELAY=2e3;var n={uninitialized:0,low:1,medium:2,high:3},r={rebuild:0,remeasure:1,relayout:2,realize:3};i._ScrollToPriority=n,i._ViewChange=r,t.Namespace._moduleDefine(e,"WinJS.UI",i)}),define("WinJS/Controls/ItemContainer/_ItemEventsHandler",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(e,t,i,n,r,s,o,a,l,c,u,d){"use strict";function h(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return{x:e.x/t,y:e.y/t,z:e.z/t}}function _(e,t){var i=h(t),n=Math.cos(e),r=Math.sin(e),s=[n+i.x*i.x*(1-n),i.x*i.y*(1-n)-i.z*r,i.x*i.z*(1-n)+i.y*r,0,i.y*i.x*(1-n)+i.z*r,n+i.y*i.y*(1-n),i.y*i.z*(1-n)-i.x*r,0,i.z*i.x*(1-n)-i.y*r,i.z*i.y*(1-n)+i.x*r,n+i.z*i.z*(1-n),0,0,0,0,1];return s=s.map(function(e){return e.toFixed(8)}),"matrix3d("+s.join(",")+")"}function m(e,t,i){var n=c._clamp((e-i.left)/i.width,0,1),r=c._clamp((t-i.top)/i.height,0,1),s={x:r-.5,y:-(n-.5),z:1e-4},o=Math.abs(n-.5)+Math.abs(r-.5),a=o*f,l=1-(1-o)*g,u="perspective(800px) scale("+l+", "+l+") "+_(a,s);return u}var p=r._browserStyleEquivalents.transform,f=.15,g=.025,v=c._uniqueID,y=c._MSManipulationEvent;n.Namespace._moduleDefine(e,"WinJS.UI",{_rotationTransform3d:_,_tiltTransform:m,_ItemEventsHandler:n.Namespace._lazy(function(){function e(e,t){return e.querySelector("."+t)}function h(e,i){var n=t.document.createElement("div");return n.className=e,i||n.setAttribute("aria-hidden",!0),n}var _=c._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",f=n.Class.define(function(e){if(this._site=e,this._work=[],this._animations={},this._selectionHintTracker={},this._swipeClassTracker={},!r.isPhone&&this._selectionAllowed()){var i=this;t.setTimeout(function(){i._gestureRecognizer||e.isZombie()||(i._gestureRecognizer=i._createGestureRecognizer())},500)}},{dispose:function(){this._disposed||(this._disposed=!0,this._gestureRecognizer=null,c._removeEventListener(t,"pointerup",this._resetPointerDownStateBound),c._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound))},onMSManipulationStateChanged:function(e){var t=e.currentState;if(t===y.MS_MANIPULATION_STATE_PRESELECT&&!this._site.pressedItemBox){var i=this._site.indexForItemElement(e.target);if(this._site.pressedEntity={type:u.ObjectType.item,index:i},this._site.pressedEntity.index!==d._INVALID_INDEX){this._site.pressedItemBox=this._site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=this._site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=r.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null;var n=this._site.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=n.canSelect,this._canTapSelect=n.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._canSelect&&this._addSelectionHint()}}!this._canSelect||t!==y.MS_MANIPULATION_STATE_PRESELECT&&t!==y.MS_MANIPULATION_STATE_COMMITTED&&t!==y.MS_MANIPULATION_STATE_CANCELLED&&t!==y.MS_MANIPULATION_STATE_SELECTING&&t!==y.MS_MANIPULATION_STATE_DRAGGING||this._dispatchSwipeBehavior(t),(t===y.MS_MANIPULATION_STATE_COMMITTED||t===y.MS_MANIPULATION_STATE_CANCELLED||t===y.MS_MANIPULATION_STATE_STOPPED)&&this.resetPointerDownState()},onPointerDown:function(e){s("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var n,o,a=this._site,l=e.pointerType===_;if(a.pressedElement=e.target,i.Windows.UI.Input.PointerPoint){var h=this._getCurrentPoint(e),m=h.properties;l||m.isInverted||m.isEraser||m.isMiddleButtonPressed?n=o=!1:(o=m.isRightButtonPressed,n=!o&&m.isLeftButtonPressed)}else n=e.button===d._LEFT_MSPOINTER_BUTTON,o=e.button===d._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this),this._swipeBehaviorState=y.MS_MANIPULATION_STATE_STOPPED;var p=a.swipeBehavior===u.SwipeBehavior.select,f=this._isInteractive(e.target),g=a.indexForItemElement(e.target),v=a.indexForHeaderElement(e.target),b=!f&&g!==d._INVALID_INDEX;if((l||n||this._selectionAllowed()&&p&&o)&&this._site.pressedEntity.index===d._INVALID_INDEX&&!f&&(this._site.pressedEntity=v===d._INVALID_INDEX?{type:u.ObjectType.item,index:g}:{type:u.ObjectType.groupHeader,index:v},this._site.pressedEntity.index!==d._INVALID_INDEX)){this._site.pressedPosition=c._getCursorPos(e);var C=a.verifySelectionAllowed(this._site.pressedEntity);if(this._canSelect=C.canSelect,this._canTapSelect=C.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._site.pressedEntity.type!==u.ObjectType.groupHeader?(this._site.pressedItemBox=a.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=a.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=r.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,!1,e),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),l||(c._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),c._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(e.target),r.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,!1,e)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),l||(c._addEventListener(t,"pointerup",this._resetPointerDownStateBound,!1),c._addEventListener(t,"pointercancel",this._resetPointerDownStateBound,!1)),this._canSelect&&!r.isPhone&&(this._gestureRecognizer||(this._gestureRecognizer=this._createGestureRecognizer()),this._addSelectionHint()),this._pointerId=e.pointerId,this._pointerRightButton=o,this._pointerTriggeredSRG=!1,this._gestureRecognizer&&l)try{this._gestureRecognizer.addPointer(this._pointerId)}catch(w){this._gestureRecognizer.stop()}}if(b&&l)try{c._setPointerCapture(a.canvasProxy,e.pointerId)}catch(w){return void s("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type!==u.ObjectType.groupHeader&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==d._INVALID_INDEX&&a.selection._getFocused().index!==d._INVALID_INDEX&&a.selection._pivot===d._INVALID_INDEX&&(a.selection._pivot=a.selection._getFocused().index),s("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(e){this._site.pressedContainer&&this._pointerId===e.pointerId&&this._togglePressed(!0,!1,e)},onPointerLeave:function(e){this._site.pressedContainer&&this._pointerId===e.pointerId&&this._togglePressed(!1,!0,e)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),c._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),c._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(e){if(!this._skipClick){var t={type:u.ObjectType.item,index:this._site.indexForItemElement(e.target)};if(t.index===d._INVALID_INDEX&&(t.index=this._site.indexForHeaderElement(e.target),t.index!==d._INVALID_INDEX&&(t.type=u.ObjectType.groupHeader)),t.index!==d._INVALID_INDEX&&(c.hasClass(e.target,this._site.accessibleItemClass)||c.hasClass(e.target,d._headerClass))){var i=this._site.verifySelectionAllowed(t);i.canTapSelect&&this.handleTap(t),this._site.fireInvokeEvent(t,e.target)}}},onPointerUp:function(e){s("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var t=this._site;this._skipClick=!0;var i=this,n=this._site.swipeBehavior===u.SwipeBehavior.select;r._yieldForEvents(function(){i._skipClick=!1});try{c._releasePointerCapture(t.canvasProxy,e.pointerId)}catch(o){}var a=e.pointerType===_,l=this._releasedElement(e),h=t.indexForItemElement(l),m=t.indexForHeaderElement(l&&c.hasClass(l,d._headerContainerClass)?t.pressedHeader:l);if(this._pointerId===e.pointerId){var p;if(p=m===d._INVALID_INDEX?{type:u.ObjectType.item,index:h}:{type:u.ObjectType.groupHeader,index:m},this._resetPressedContainer(),this._site.pressedEntity.type!==u.ObjectType.groupHeader&&p.type!==u.ObjectType.groupHeader&&this._site.pressedContainer&&this._site.pressedEntity.index===p.index)if(e.shiftKey||(t.selection._pivot=d._INVALID_INDEX),e.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&t.selection._pivot!==d._INVALID_INDEX){var f=Math.min(this._site.pressedEntity.index,t.selection._pivot),g=Math.max(this._site.pressedEntity.index,t.selection._pivot),v=this._pointerRightButton||e.ctrlKey||t.tapBehavior===u.TapBehavior.toggleSelect;t.selectRange(f,g,v)}}else(e.ctrlKey||this._selectionAllowed()&&n&&this._pointerRightButton)&&this.handleSwipeBehavior(this._site.pressedEntity.index);if((this._site.pressedHeader||this._site.pressedContainer)&&this._swipeBehaviorState!==y.MS_MANIPULATION_STATE_COMMITTED){var b=c._getCursorPos(e),C=Math.abs(b.left-this._site.pressedPosition.left)<=d._TAP_END_THRESHOLD&&Math.abs(b.top-this._site.pressedPosition.top)<=d._TAP_END_THRESHOLD;this._endSelfRevealGesture(),this._clearItem(this._site.pressedEntity,this._isSelected(this._site.pressedEntity.index)),this._pointerRightButton||this._pointerTriggeredSRG||e.ctrlKey||e.shiftKey||!(a&&C||!a&&this._site.pressedEntity.index===p.index&&this._site.pressedEntity.type===p.type)||(p.type===u.ObjectType.groupHeader?(this._site.pressedHeader=t.headerAtIndex(p.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=t.itemBoxAtIndex(p.index),this._site.pressedContainer=t.containerAtIndex(p.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==d._INVALID_INDEX&&t.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}s("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(e){this._pointerId===e.pointerId&&this._swipeBehaviorState!==y.MS_MANIPULATION_STATE_PRESELECT&&(s("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(e){this._pointerId===e.pointerId&&this._swipeBehaviorState!==y.MS_MANIPULATION_STATE_PRESELECT&&(s("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(e){var t=this._site.containerFromElement(e.target);this._selectionAllowed()&&t&&!this._isInteractive(e.target)&&e.preventDefault()},onMSHoldVisual:function(e){this._isInteractive(e.target)||e.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},handleSwipeBehavior:function(e){this._selectionAllowed(e)&&this._toggleItemSelection(e)},handleTap:function(e){if(e.type!==u.ObjectType.groupHeader){var t=this._site,i=t.selection;this._selectionAllowed(e.index)&&this._selectOnTap()&&(t.tapBehavior===u.TapBehavior.toggleSelect?this._toggleItemSelection(e.index):t.selectionMode!==u.SelectionMode.multi&&i._isIncluded(e.index)||i.set(e.index))}},_toggleItemSelection:function(e){var t=this._site,i=t.selection,n=i._isIncluded(e);t.selectionMode===u.SelectionMode.single?n?i.clear():i.set(e):n?i.remove(e):i.add(e)},_getCurrentPoint:function(e){return i.Windows.UI.Input.PointerPoint.getCurrentPoint(e.pointerId)},_containedInElementWithClass:function(e,t){if(e.parentNode)for(var i=e.parentNode.querySelectorAll("."+t+", ."+t+" *"),n=0,r=i.length;r>n;n++)if(i[n]===e)return!0;return!1},_isSelected:function(e){return!this._swipeBehaviorSelectionChanged&&this._site.selection._isIncluded(e)||this._swipeBehaviorSelectionChanged&&this.swipeBehaviorSelected},_isInteractive:function(e){return this._containedInElementWithClass(e,"win-interactive")},_togglePressed:function(e,t,i){function n(e){""===h._site.animatedElement.style[p.scriptName]?(h._site.animatedElement.style[p.scriptName]=e,h._site.animatedElementScaleTransform=h._site.animatedElement.style[p.scriptName]):h._site.animatedElementScaleTransform=""}function o(e,t){s("WinJS.UI._ItemEventsHandler:removePressedUI,info"),c.removeClass(e,d._pressedClass),r.isPhone?h._containsTransform(e,t)&&a.executeTransition(e,{property:p.cssName,delay:0,duration:500,timing:"cubic-bezier(0.7025,0,0.9225,-0.115)",to:e.style[p.scriptName].replace(t,"")}):h._removeTransform(e,t)}var h=this,_=this._site.pressedEntity.type===u.ObjectType.groupHeader;if(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),!(r.isPhone&&!_&&c.hasClass(this._site.pressedItemBox,d._nonSelectableClass)||this._staticMode(_)))if(e){if(!c.hasClass(this._site.animatedElement,d._pressedClass))if(s("WinJS.UI._ItemEventsHandler:applyPressedUI,info"),c.addClass(this._site.animatedElement,d._pressedClass),i&&r.isPhone){var f=_?h._site.pressedHeader:h._site.pressedContainer,g=m(i.clientX,i.clientY,f.getBoundingClientRect());this._site.animatedDownPromise=l.timeout(50).then(function(){n(g)})}else{var v=.975,y=7;this._site.getItemPosition(this._site.pressedEntity).then(function(e){e.contentWidth>0&&(v=Math.max(v,1-y/e.contentWidth)),e.contentHeight>0&&(v=Math.max(v,1-y/e.contentHeight))},function(){}),n("scale("+v+","+v+")")}}else if(c.hasClass(this._site.animatedElement,d._pressedClass)){var b=this._site.animatedElement,C=this._site.animatedElementScaleTransform;t?o(b,C):r._setImmediate(function(){c.hasClass(b,d._pressedClass)&&o(b,C)})}},_containsTransform:function(e,t){return t&&-1!==e.style[p.scriptName].indexOf(t)},_removeTransform:function(e,t){this._containsTransform(e,t)&&(e.style[p.scriptName]=e.style[p.scriptName].replace(t,""))},_endSwipeBehavior:function(){if((this._swipeBehaviorState===y.MS_MANIPULATION_STATE_PRESELECT||this._swipeBehaviorState===y.MS_MANIPULATION_STATE_SELECTING||this._swipeBehaviorState===y.MS_MANIPULATION_STATE_DRAGGING||this._swipeBehaviorState===y.MS_MANIPULATION_STATE_COMMITTED||this._swipeBehaviorState===y.MS_MANIPULATION_STATE_CANCELLED)&&this._site.pressedEntity.type!==u.ObjectType.groupHeader){this._flushUIBatches();var e=this._selectionHint;if(this._selectionHint=null,this._site.pressedItemBox){var t=this._site.pressedEntity.index,i=this._site.selection._isIncluded(t);if(i)for(var n=c._getElementsByClasses(this._site.pressedItemBox,[d._selectionCheckmarkClass,d._selectionCheckmarkBackgroundClass]),r=0;r<n.length;r++)n[r].style.opacity=1;this._clearItem(this._site.pressedEntity,i),e&&this._removeSelectionHint(e),delete this._animations[t]}}},_createGestureRecognizer:function(){var e=this._site.eventHandlerRoot,t=c._createGestureRecognizer();t.target=e;var i=this;return e.addEventListener("MSGestureHold",function(e){-1!==i._site.pressedEntity.index&&e.detail===c._MSGestureEvent.MSGESTURE_FLAG_BEGIN&&i._startSelfRevealGesture()}),t},_dispatchSwipeBehavior:function(e){if(this._site.pressedEntity.type!==u.ObjectType.groupHeader&&this._site.swipeBehavior===u.SwipeBehavior.select){if(this._site.selection._pivot=d._INVALID_INDEX,this._site.pressedItemBox){var t=this._site.pressedEntity.index;if(this._swipeBehaviorState!==e)if(e===y.MS_MANIPULATION_STATE_DRAGGING&&this._canSelect)this._animateSelectionChange(this._site.selection._isIncluded(t)),this._removeSelectionHint(this._selectionHint);else if(e===y.MS_MANIPULATION_STATE_PRESELECT){s("WinJS.UI._ItemEventsHandler:crossSlidingStarted,info");var i=this._site,n=i.itemAtIndex(t),r=i.selection._isIncluded(t);this._selfRevealGesture?(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null):this._canSelect&&this._prepareItem(this._site.pressedEntity,n,r),this._swipeBehaviorState!==y.MS_MANIPULATION_STATE_SELECTING?(this._site.animatedElement&&c.hasClass(this._site.animatedElement,d._pressedClass)&&(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),c.removeClass(this._site.animatedElement,d._pressedClass),this._removeTransform(this._site.animatedElement,this._site.animatedElementScaleTransform)),this._showSelectionHintCheckmark()):this._animateSelectionChange(this._site.selection._isIncluded(t))}else if(e===y.MS_MANIPULATION_STATE_COMMITTED){s("WinJS.UI._ItemEventsHandler:crossSlidingCompleted,info");
var i=this._site,o=i.selection,a=this._swipeBehaviorSelectionChanged,l=this.swipeBehaviorSelected;this._swipeBehaviorState===y.MS_MANIPULATION_STATE_SELECTING&&a&&this._selectionAllowed()&&i.swipeBehavior===u.SwipeBehavior.select&&(i.selectionMode===u.SelectionMode.single?l?o.set(t):o._isIncluded(t)&&o.remove(t):l?o.add(t):o._isIncluded(t)&&o.remove(t)),this._endSwipeBehavior()}else e===y.MS_MANIPULATION_STATE_SELECTING&&this._canSelect?this._animateSelectionChange(!this._site.selection._isIncluded(t)):this._swipeBehaviorState===y.MS_MANIPULATION_STATE_SELECTING&&this._canSelect&&this._animateSelectionChange(this._site.selection._isIncluded(t),e===y.MS_MANIPULATION_STATE_CANCELLED)}this._swipeBehaviorState=e}},_resetPointerDownStateForPointerId:function(e){this._pointerId===e.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._gestureRecognizer&&(this._endSelfRevealGesture(),this._endSwipeBehavior()),this._site.pressedElement=null,c._removeEventListener(t,"pointerup",this._resetPointerDownStateBound),c._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._removeSelectionHint(this._selectionHint),this._selectionHint=null,this._site.pressedEntity={type:u.ObjectType.item,index:d._INVALID_INDEX},this._pointerId=null},_startSelfRevealGesture:function(){if(this._canSelect&&this._site.swipeBehavior===u.SwipeBehavior.select){s("WinJS.UI._ItemEventsHandler:playSelfRevealGesture,info");var e=this,t=this._site,i=this._site.pressedEntity.index,n=t.itemBoxAtIndex(i),r=t.selection._isIncluded(i),a=!1,c=function(){var e,i;return t.horizontal?(e=d._VERTICAL_SWIPE_SELF_REVEAL_GESTURE+"px",i="0px"):(e="0px",i=(t.rtl()?"":"-")+d._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE+"px"),o.swipeReveal(n,{top:e,left:i})},h=function(){return a?l.wrap():o.swipeReveal(n,{top:"0px",left:"0px"})},_=function(n){t.isZombie()||(n&&e._removeSelectionHint(n),e._clearItem(t.pressedEntity,t.selection._isIncluded(i)))},m=function(){e._selfRevealGesture._promise.cancel(),a=!0;var t=e._selectionHint;return e._selectionHint=null,h().then(function(){n.style[p.scriptName]="",_(t)})};this._prepareItem(this._site.pressedEntity,n,r),this._showSelectionHintCheckmark(),this._pointerTriggeredSRG=!0,this._selfRevealGesture={finishAnimation:m,_promise:c().then(h).then(function(){a||(e._hideSelectionHintCheckmark(),_(),e._selfRevealGesture=null)})}}},_endSelfRevealGesture:function(){this._selfRevealGesture&&(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null)},_prepareItem:function(e,t,i){function n(e){r._swipeClassTracker[v(e)]?r._swipeClassTracker[v(e)]++:(c.addClass(e,d._swipeClass),r._swipeClassTracker[v(e)]=1)}if(e.type!==u.ObjectType.groupHeader){var r=this,s=this._site,o=e.index;if(i){var a=s.containerAtIndex(o);n(a)}else(this._animations[o]||l.wrap()).then(function(){if(!s.isZombie()&&e.type!==u.ObjectType.groupHeader&&-1!==s.pressedEntity.index){o=s.pressedEntity.index;var t=s.itemAtIndex(o),i=s.itemBoxAtIndex(o),r=s.containerAtIndex(o);if(n(r),!c._isSelectionRendered(i)){f.renderSelection(i,t,!0,r),c.removeClass(i,d._selectedClass),c.removeClass(r,d._selectedClass);for(var a=i.querySelectorAll(c._selectionPartsSelector),l=0,h=a.length;h>l;l++)a[l].style.opacity=0}}})}},_clearItem:function(e,t){function i(e){var t=--r._swipeClassTracker[v(e)];return t?!1:(delete r._swipeClassTracker[v(e)],c.removeClass(e,d._swipeClass),!0)}function n(e){var t=e.parentNode;t&&c.hasClass(t,d._itemsBlockClass)&&i(t)}if(e.type===u.ObjectType.item){var r=this,s=this._site,o=s.containerAtIndex(e.index),a=s.itemBoxAtIndex(e.index),l=s.itemAtIndex(e.index);if(o&&a&&l){var h=i(o);n(o),h&&f.renderSelection(a,l,t,!0,o)}}},_animateSelectionChange:function(t,i){function n(){var i=t?"addClass":"removeClass";if(c[i](a,d._selectedClass),c[i](o,d._selectedClass),r._selectionHint){var n=e(r._selectionHint,d._selectionHintClass);n&&c[i](n,d._revealedClass)}}var r=this,o=this._site.pressedContainer,a=this._site.pressedItemBox;this._swipeBehaviorSelectionChanged=!0,this.swipeBehaviorSelected=t;var l=c._getElementsByClasses(this._site.pressedItemBox,[d._selectionBorderClass,d._selectionBackgroundClass]);(!t||i)&&(l=l.concat(c._getElementsByClasses(this._site.pressedItemBox,[d._selectionCheckmarkBackgroundClass,d._selectionCheckmarkClass]))),s("WinJS.UI._ItemEventsHandler:"+(t?"hitSelectThreshold":"hitUnselectThreshold")+",info"),this._applyUIInBatches(function(){s("WinJS.UI._ItemEventsHandler:"+(t?"apply":"remove")+"SelectionVisual,info");for(var e=t?1:0,i=0;i<l.length;i++)l[i].style.opacity=e;n()})},_showSelectionHintCheckmark:function(){if(this._selectionHint){var t=e(this._selectionHint,d._selectionHintClass);t&&(t.style.display="block")}},_hideSelectionHintCheckmark:function(){if(this._selectionHint){var t=e(this._selectionHint,d._selectionHintClass);t&&(t.style.display="none")}},_addSelectionHint:function(){if(this._site.pressedEntity.type!==u.ObjectType.groupHeader){var e,i=this._site;if(i.customFootprintParent){e=this._selectionHint=t.document.createElement("div"),e.className=d._containerClass;var n=this;i.getItemPosition(this._site.pressedEntity).then(function(t){if(!i.isZombie()&&n._selectionHint&&n._selectionHint===e){var r=e.style,s=";position:absolute;"+(i.rtl()?"right:":"left:")+t.left+"px;top:"+t.top+"px;width:"+t.contentWidth+"px;height:"+t.contentHeight+"px";r.cssText+=s,i.customFootprintParent.insertBefore(n._selectionHint,n._site.pressedItemBox)}},function(){})}else e=this._selectionHint=this._site.pressedContainer;if(this._selectionHintTracker[v(e)])this._selectionHintTracker[v(e)]++;else{if(c.addClass(e,d._footprintClass),!i.selection._isIncluded(this._site.pressedEntity.index)){var r=t.document.createElement("div");r.className=d._selectionHintClass,r.textContent=d._SELECTION_CHECKMARK,r.style.display="none",this._selectionHint.insertBefore(r,this._selectionHint.firstElementChild)}this._selectionHintTracker[v(e)]=1}}},_removeSelectionHint:function(t){if(t){var i=--this._selectionHintTracker[v(t)];if(!i)if(delete this._selectionHintTracker[v(t)],this._site.customFootprintParent)t.parentNode&&t.parentNode.removeChild(t);else{c.removeClass(t,d._footprintClass);var n=e(t,d._selectionHintClass);n&&n.parentNode.removeChild(n)}}},_releasedElement:function(e){return t.document.elementFromPoint(e.clientX,e.clientY)},_applyUIInBatches:function(e){function t(){i._work.length>0?(i._flushUIBatches(),i._paintedThisFrame=r._requestAnimationFrame(t.bind(i))):i._paintedThisFrame=null}var i=this;this._work.push(e),this._paintedThisFrame||t()},_flushUIBatches:function(){if(this._work.length>0){var e=this._work;this._work=[];for(var t=0;t<e.length;t++)e[t]()}},_selectionAllowed:function(e){var t=void 0!==e?this._site.itemAtIndex(e):null,i=!(t&&c.hasClass(t,d._nonSelectableClass));return i&&this._site.selectionMode!==u.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===u.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===u.TapBehavior.toggleSelect||this._site.tapBehavior===u.TapBehavior.directSelect},_staticMode:function(e){return e?this._site.headerTapBehavior===u.GroupHeaderTapBehavior.none:this._site.tapBehavior===u.TapBehavior.none&&this._site.selectionMode===u.SelectionMode.none}},{setAriaSelected:function(e,t){var i="true"===e.getAttribute("aria-selected");t!==i&&e.setAttribute("aria-selected",t)},renderSelection:function(e,t,i,n,r){if(!f._selectionTemplate){f._selectionTemplate=[],f._selectionTemplate.push(h(d._selectionBackgroundClass)),f._selectionTemplate.push(h(d._selectionBorderClass)),f._selectionTemplate.push(h(d._selectionCheckmarkBackgroundClass));var s=h(d._selectionCheckmarkClass);s.textContent=d._SELECTION_CHECKMARK,f._selectionTemplate.push(s)}if(i!==c._isSelectionRendered(e)){if(i){e.insertBefore(f._selectionTemplate[0].cloneNode(!0),e.firstElementChild);for(var o=1,a=f._selectionTemplate.length;a>o;o++)e.appendChild(f._selectionTemplate[o].cloneNode(!0))}else for(var l=e.querySelectorAll(c._selectionPartsSelector),o=0,a=l.length;a>o;o++)e.removeChild(l[o]);c[i?"addClass":"removeClass"](e,d._selectedClass),r&&c[i?"addClass":"removeClass"](r,d._selectedClass)}n&&f.setAriaSelected(t,i)}});return f})})}),define("WinJS/Controls/ListView/_SelectionManager",["exports","../../Core/_Global","../../Core/_Base","../../Promise","../../_Signal","../../Utilities/_UI","../ItemContainer/_Constants"],function(e,t,i,n,r,s,o){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_ItemSet:i.Namespace._lazy(function(){var t=i.Class.define(function(e,t,i){this._listView=e,this._ranges=t,this._itemsCount=i});return t.prototype={getRanges:function(){for(var e=[],t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];e.push({firstIndex:n.firstIndex,lastIndex:n.lastIndex,firstKey:n.firstKey,lastKey:n.lastKey})}return e},getItems:function(){return e.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var e=0,t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];e+=n.lastIndex-n.firstIndex+1}return e},getIndices:function(){for(var e=[],t=0,i=this._ranges.length;i>t;t++)for(var n=this._ranges[t],r=n.firstIndex;r<=n.lastIndex;r++)e.push(r);return e}},t}),getItemsFromRanges:function(e,t){function i(){for(var e=[],i=0,r=t.length;r>i;i++)for(var s=t[i],o=s.firstIndex;o<=s.lastIndex;o++)e.push(o);return n.wrap(e)}var r=e.createListBinding(),s=[];return i().then(function(e){for(var t=0;t<e.length;t++)s.push(r.fromIndex(e[t]));return n.join(s).then(function(e){return r.release(),e})})},_Selection:i.Namespace._lazy(function(){function t(e){return e&&0===e.firstIndex&&e.lastIndex===Number.MAX_VALUE}return i.Class.derive(e._ItemSet,function(e,t){this._listView=e,this._itemsCount=-1,this._ranges=[],t&&this.set(t)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],n.wrap()},set:function(e){if(t(e))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var i=this;return this._execute("_set",e).then(function(){return i._ranges.sort(function(e,t){return e.firstIndex-t.firstIndex}),i._ensureKeys()}).then(function(){return i._ensureCount()})},add:function(e){if(t(e))return this.selectAll();var i=this;return this._execute("_add",e).then(function(){return i._ensureKeys()}).then(function(){return i._ensureCount()})},remove:function(e){var t=this;return this._execute("_remove",e).then(function(){return t._ensureKeys()})},selectAll:function(){var e=this;return e._ensureCount().then(function(){if(e._itemsCount){var t={firstIndex:0,lastIndex:e._itemsCount-1};return e._retainRange(t),e._releaseRanges(e._ranges),e._ranges=[t],e._ensureKeys()}})},_execute:function(e,t){function i(e,t,i){var n={};return n["first"+e]=t,n["last"+e]=i,n}function r(t){var i=s._getListBinding(),r=n.join([i.fromKey(t.firstKey),i.fromKey(t.lastKey)]).then(function(i){return i[0]&&i[1]&&(t.firstIndex=i[0].index,t.lastIndex=i[1].index,s[e](t)),t});l.push(r)}for(var s=this,o=!!s._getListBinding().fromKey,a=Array.isArray(t)?t:[t],l=[n.wrap()],c=0,u=a.length;u>c;c++){var d=a[c];"number"==typeof d?this[e](i("Index",d,d)):d&&(o&&void 0!==d.key?r(i("Key",d.key,d.key)):o&&void 0!==d.firstKey&&void 0!==d.lastKey?r(i("Key",d.firstKey,d.lastKey)):void 0!==d.index&&"number"==typeof d.index?this[e](i("Index",d.index,d.index)):void 0!==d.firstIndex&&void 0!==d.lastIndex&&"number"==typeof d.firstIndex&&"number"==typeof d.lastIndex&&this[e](i("Index",d.firstIndex,d.lastIndex)))}return n.join(l)},_set:function(e){this._retainRange(e),this._ranges.push(e)},_add:function(e){for(var t,i,n,r=this,s=null,o=function(e,t){t.lastIndex>e.lastIndex&&(e.lastIndex=t.lastIndex,e.lastKey=t.lastKey,e.lastPromise&&e.lastPromise.release(),e.lastPromise=r._getListBinding().fromIndex(e.lastIndex).retain())},a=0,l=this._ranges.length;l>a;a++){if(t=this._ranges[a],e.firstIndex<t.firstIndex){n=s&&e.firstIndex<s.lastIndex+1,n?(i=a-1,o(s,e)):(this._insertRange(a,e),i=a);break}if(e.firstIndex===t.firstIndex){o(t,e),i=a;break}s=t}if(void 0===i){var c=this._ranges.length?this._ranges[this._ranges.length-1]:null,u=c&&e.firstIndex<c.lastIndex+1;u?o(c,e):(this._retainRange(e),this._ranges.push(e))}else{for(s=null,a=i+1,l=this._ranges.length;l>a;a++){if(t=this._ranges[a],e.lastIndex<t.firstIndex){n=s&&s.lastIndex>e.lastIndex,n&&o(this._ranges[i],s),this._removeRanges(i+1,a-i-1);break}if(e.lastIndex===t.firstIndex){o(this._ranges[i],t),this._removeRanges(i+1,a-i);break}s=t}a>=l&&(o(this._ranges[i],this._ranges[l-1]),this._removeRanges(i+1,l-i-1))}},_remove:function(e){function t(e){return i._getListBinding().fromIndex(e).retain()}for(var i=this,n=[],r=0,s=this._ranges.length;s>r;r++){var o=this._ranges[r];o.lastIndex<e.firstIndex||o.firstIndex>e.lastIndex?n.push(o):o.firstIndex<e.firstIndex&&o.lastIndex>=e.firstIndex&&o.lastIndex<=e.lastIndex?(n.push({firstIndex:o.firstIndex,firstKey:o.firstKey,firstPromise:o.firstPromise,lastIndex:e.firstIndex-1,lastPromise:t(e.firstIndex-1)}),o.lastPromise.release()):o.lastIndex>e.lastIndex&&o.firstIndex>=e.firstIndex&&o.firstIndex<=e.lastIndex?(n.push({firstIndex:e.lastIndex+1,firstPromise:t(e.lastIndex+1),lastIndex:o.lastIndex,lastKey:o.lastKey,lastPromise:o.lastPromise}),o.firstPromise.release()):o.firstIndex<e.firstIndex&&o.lastIndex>e.lastIndex?(n.push({firstIndex:o.firstIndex,firstKey:o.firstKey,firstPromise:o.firstPromise,lastIndex:e.firstIndex-1,lastPromise:t(e.firstIndex-1)}),n.push({firstIndex:e.lastIndex+1,firstPromise:t(e.lastIndex+1),lastIndex:o.lastIndex,lastKey:o.lastKey,lastPromise:o.lastPromise})):(o.firstPromise.release(),o.lastPromise.release())}this._ranges=n},_ensureKeys:function(){for(var e=[n.wrap()],t=this,i=function(e,t){var i=e+"Key";if(t[i])return n.wrap();var r=t[e+"Promise"];return r.then(function(e){e&&(t[i]=e.key)}),r},r=0,s=this._ranges.length;s>r;r++){var o=this._ranges[r];e.push(i("first",o)),e.push(i("last",o))}return n.join(e).then(function(){t._ranges=t._ranges.filter(function(e){return e.firstKey&&e.lastKey})}),n.join(e)},_mergeRanges:function(e,t){e.lastIndex=t.lastIndex,e.lastKey=t.lastKey},_isIncluded:function(e){if(this.isEverything())return!0;for(var t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];if(n.firstIndex<=e&&e<=n.lastIndex)return!0}return!1},_ensureCount:function(){var e=this;return this._listView._itemsCount().then(function(t){e._itemsCount=t})},_insertRange:function(e,t){this._retainRange(t),this._ranges.splice(e,0,t)},_removeRanges:function(e,t){for(var i=0;t>i;i++)this._releaseRange(this._ranges[e+i]);this._ranges.splice(e,t)},_retainRange:function(e){e.firstPromise||(e.firstPromise=this._getListBinding().fromIndex(e.firstIndex).retain()),e.lastPromise||(e.lastPromise=this._getListBinding().fromIndex(e.lastIndex).retain())},_retainRanges:function(){for(var e=0,t=this._ranges.length;t>e;e++)this._retainRange(this._ranges[e])},_releaseRange:function(e){e.firstPromise.release(),e.lastPromise.release()},_releaseRanges:function(e){for(var t=0,i=e.length;i>t;++t)this._releaseRange(e[t])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:i.Namespace._lazy(function(){var i=function(t){this._listView=t,this._selected=new e._Selection(this._listView),this._pivot=o._INVALID_INDEX,this._focused={type:s.ObjectType.item,index:0},this._pendingChange=n.wrap()};return i.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(t){var i=this,s=new r;return this._synchronize(s).then(function(){var r=new e._Selection(i._listView);return r.set(t).then(function(){i._set(r),s.complete()},function(e){return r.clear(),s.complete(),n.wrapError(e)})})},clear:function(){var t=this,i=new r;return this._synchronize(i).then(function(){var r=new e._Selection(t._listView);return r.clear().then(function(){t._set(r),i.complete()},function(e){return r.clear(),i.complete(),n.wrapError(e)})})},add:function(e){var t=this,i=new r;return this._synchronize(i).then(function(){var r=t._cloneSelection();return r.add(e).then(function(){t._set(r),i.complete()},function(e){return r.clear(),i.complete(),n.wrapError(e)})})},remove:function(e){var t=this,i=new r;return this._synchronize(i).then(function(){var r=t._cloneSelection();return r.remove(e).then(function(){t._set(r),i.complete()},function(e){return r.clear(),i.complete(),n.wrapError(e)})})},selectAll:function(){var t=this,i=new r;return this._synchronize(i).then(function(){var r=new e._Selection(t._listView);return r.selectAll().then(function(){t._set(r),i.complete()},function(e){return r.clear(),i.complete(),n.wrapError(e)})})},_synchronize:function(e){var t=this;return this._listView._versionManager.unlocked.then(function(){var i=t._pendingChange;return t._pendingChange=n.join([i,e.promise]).then(function(){}),i})},_reset:function(){this._pivot=o._INVALID_INDEX,this._setFocused({type:s.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=n.wrap(),this._selected.clear(),this._selected=new e._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(e){var t=this;return this._fireSelectionChanging(e).then(function(i){return i?(t._selected.clear(),t._selected=e,t._listView._updateSelection(),t._fireSelectionChanged()):e.clear(),i})},_fireSelectionChanging:function(e){var i=t.document.createEvent("CustomEvent"),r=n.wrap();i.initCustomEvent("selectionchanging",!0,!0,{newSelection:e,preventTapBehavior:function(){},setPromise:function(e){r=e}});var s=this._listView._element.dispatchEvent(i);return r.then(function(){return s})},_fireSelectionChanged:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(e)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(e,t){this._focused={type:e.type,index:e.index},this._focusedByKeyboard=t},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(e){this._selected._itemsCount=e},_isIncluded:function(e){return this._selected._isIncluded(e)},_cloneSelection:function(){var t=new e._Selection(this._listView);return t._ranges=this._selected.getRanges(),t._itemsCount=this._selected._itemsCount,t._retainRanges(),t}},i.supportedForProcessing=!1,i})})}),define("WinJS/Controls/ListView/_BrowseMode",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Animations","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_SelectionManager"],function(e,t,i,n,r,s,o,a,l,c,u){"use strict";var d=n._browserStyleEquivalents.transform.scriptName;i.Namespace._moduleDefine(e,"WinJS.UI",{_SelectionMode:i.Namespace._lazy(function(){function e(e,t,i){return Math.max(e,Math.min(t,i))}function r(e,i,n){var r=t.document.createEvent("CustomEvent");return r.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:i.index,oldFocusType:i.type,newFocus:n.index,newFocusType:n.type}),e.dispatchEvent(r)}var h=i.Class.define(function(e){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:a.ObjectType.item,index:l._INVALID_INDEX},this._pressedPosition=null,this.initialize(e)},{_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(e){function t(t,i){var n=function(i){return e._view.getAdjacent(i,t)};return n.clampToBounds=i,n}this.site=e,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var i=this.site,n=this;this._itemEventsHandler=new c._ItemEventsHandler(Object.create({containerFromElement:function(e){return i._view.items.containerFrom(e)},indexForItemElement:function(e){return i._view.items.index(e)},indexForHeaderElement:function(e){return i._groups.index(e)},itemBoxAtIndex:function(e){return i._view.items.itemBoxAt(e)},itemAtIndex:function(e){return i._view.items.itemAt(e)},headerAtIndex:function(e){return i._groups.group(e).header},headerFromElement:function(e){return i._groups.headerFrom(e)},containerAtIndex:function(e){return i._view.items.containerAt(e)},isZombie:function(){return i._isZombie()},getItemPosition:function(e){return i._getItemPosition(e)},rtl:function(){return i._rtl()},fireInvokeEvent:function(e,t){return n._fireInvokeEvent(e,t)},verifySelectionAllowed:function(e){return n._verifySelectionAllowed(e)},changeFocus:function(e,t,n,r,s){return i._changeFocus(e,t,n,r,s)},selectRange:function(e,t,i){return n._selectRange(e,t,i)}},{pressedEntity:{enumerable:!0,get:function(){return n._pressedEntity},set:function(e){n._pressedEntity=e}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return n._pressedContainerScaleTransform},set:function(e){n._pressedContainerScaleTransform=e}},pressedContainer:{enumerable:!0,get:function(){return n._pressedContainer},set:function(e){n._pressedContainer=e}},pressedItemBox:{enumerable:!0,get:function(){return n._pressedItemBox},set:function(e){n._pressedItemBox=e}},pressedHeader:{enumerable:!0,get:function(){return n._pressedHeader},set:function(e){return n._pressedHeader=e}},pressedPosition:{enumerable:!0,get:function(){return n._pressedPosition},set:function(e){n._pressedPosition=e}},pressedElement:{enumerable:!0,set:function(e){n._pressedElement=e}},swipeBehavior:{enumerable:!0,get:function(){return i._swipeBehavior}},eventHandlerRoot:{enumerable:!0,get:function(){return i._viewport}},selectionMode:{enumerable:!0,get:function(){return i._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return l._itemClass}},canvasProxy:{enumerable:!0,get:function(){return i._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return i._tap}},headerTapBehavior:{enumerable:!0,get:function(){return i._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return i.itemsDraggable||i.itemsReorderable}},selection:{enumerable:!0,get:function(){return i._selection}},horizontal:{enumerable:!0,get:function(){return i._horizontal()}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var r=o.Key;this._keyboardNavigationHandlers[r.upArrow]=t(r.upArrow),this._keyboardNavigationHandlers[r.downArrow]=t(r.downArrow),this._keyboardNavigationHandlers[r.leftArrow]=t(r.leftArrow),this._keyboardNavigationHandlers[r.rightArrow]=t(r.rightArrow),this._keyboardNavigationHandlers[r.pageUp]=t(r.pageUp,!0),this._keyboardNavigationHandlers[r.pageDown]=t(r.pageDown,!0),this._keyboardNavigationHandlers[r.home]=function(e){return s.wrap({type:e.type,index:0})},this._keyboardNavigationHandlers[r.end]=function(e){return e.type===a.ObjectType.groupHeader?s.wrap({type:e.type,index:i._groups.length()-1}):n.site._view.finalItem().then(function(t){return{type:e.type,index:t}},function(e){return s.wrapError(e)})},this._keyboardAcceleratorHandlers[r.a]=function(){n.site._multiSelection()&&n._selectAll()}},staticMode:function(){return this.site._tap===a.TapBehavior.none&&this.site._selectionMode===a.SelectionMode.none},itemUnrealized:function(e,t){if(this._pressedEntity.type!==a.ObjectType.groupHeader&&(this._pressedEntity.index===e&&this._resetPointerDownState(),this._itemBeingDragged(e)))for(var i=this._draggedItemBoxes.length-1;i>=0;i--)this._draggedItemBoxes[i]===t&&(o.removeClass(t,l._dragSourceClass),this._draggedItemBoxes.splice(i,1))},_fireInvokeEvent:function(e,i){function n(n,s){var o=n.createListBinding(),a=o.fromIndex(e.index),l=s?"groupheaderinvoked":"iteminvoked";a.done(function(){o.release()});var c=t.document.createEvent("CustomEvent");c.initCustomEvent(l,!0,!0,s?{groupHeaderPromise:a,groupHeaderIndex:e.index}:{itemPromise:a,itemIndex:e.index}),i.dispatchEvent(c)&&r.site._defaultInvoke(e)}if(i){var r=this;e.type===a.ObjectType.groupHeader?this.site._groupHeaderTap===a.GroupHeaderTapBehavior.invoke&&e.index!==l._INVALID_INDEX&&n(this.site.groupDataSource,!0):this.site._tap!==a.TapBehavior.none&&e.index!==l._INVALID_INDEX&&n(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(e){if(e.type===a.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var i=e.index,n=this.site,r=this.site._view.items.itemAt(i);if(!n._selectionAllowed()||!n._selectOnTap()&&n._swipeBehavior!==a.SwipeBehavior.select||r&&o.hasClass(r,l._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var c=n._selection._isIncluded(i),u=!n._multiSelection(),d=n._selection._cloneSelection();c?u?d.clear():d.remove(i):u?d.set(i):d.add(i);var h,_=t.document.createEvent("CustomEvent"),m=s.wrap(),p=!1,f=!1;_.initCustomEvent("selectionchanging",!0,!0,{newSelection:d,preventTapBehavior:function(){f=!0},setPromise:function(e){m=e}});var g=n._element.dispatchEvent(_);m.then(function(){p=!0,h=d._isIncluded(i),d.clear()});var v=g&&p&&(c||h);return{canSelect:v,canTapSelect:v&&!f}},_containedInElementWithClass:function(e,t){if(e.parentNode)for(var i=e.parentNode.querySelectorAll("."+t+", ."+t+" *"),n=0,r=i.length;r>n;n++)if(i[n]===e)return!0;return!1},_isDraggable:function(e){return!this._containedInElementWithClass(e,l._nonDraggableClass)},_isInteractive:function(e){return this._containedInElementWithClass(e,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onMSManipulationStateChanged:function(e){this._itemEventsHandler.onMSManipulationStateChanged(e)},onPointerDown:function(e){this._itemEventsHandler.onPointerDown(e)},onclick:function(e){this._itemEventsHandler.onClick(e)},onPointerUp:function(e){this._itemEventsHandler.onPointerUp(e)},onPointerCancel:function(e){this._itemEventsHandler.onPointerCancel(e)},onLostPointerCapture:function(e){this._itemEventsHandler.onLostPointerCapture(e)},onContextMenu:function(e){this._itemEventsHandler.onContextMenu(e)},onMSHoldVisual:function(e){this._itemEventsHandler.onMSHoldVisual(e)},onDataChanged:function(e){this._itemEventsHandler.onDataChanged(e)},_removeTransform:function(e,t){t&&-1!==e.style[d].indexOf(t)&&(e.style[d]=e.style[d].replace(t,""))},_selectAll:function(){var e=[];this.site._view.items.each(function(t,i){i&&o.hasClass(i,l._nonSelectableClass)&&e.push(t)}),this.site._selection.selectAll(),e.length>0&&this.site._selection.remove(e)},_selectRange:function(e,t,i){for(var n=[],r=-1,s=e;t>=s;s++){var a=this.site._view.items.itemAt(s);a&&o.hasClass(a,l._nonSelectableClass)?-1!==r&&(n.push({firstIndex:r,lastIndex:s-1}),r=-1):-1===r&&(r=s)}-1!==r&&n.push({firstIndex:r,lastIndex:t}),n.length>0&&this.site._selection[i?"add":"set"](n)},onDragStart:function(e){if(this._pressedEntity={type:a.ObjectType.item,index:this.site._view.items.index(e.target)},this.site._selection._pivot=l._INVALID_INDEX,this._pressedEntity.index===l._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(e.target)||this._pressedElement&&this._isInteractive(this._pressedElement))e.preventDefault();else{this._dragging=!0,this._dragDataTransfer=e.dataTransfer,this._pressedPosition=o._getCursorPos(e),this._dragInfo=null,this._lastEnteredElement=e.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new u._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var i=this.site.itemsReorderable,r=t.document.createEvent("CustomEvent");if(r.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:e.dataTransfer,dragInfo:this._dragInfo}),e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage){var s=this.site._view.items.itemDataAt(this._pressedEntity.index);if(s&&s.container){var c=s.container.getBoundingClientRect();e.dataTransfer.setDragImage(s.container,e.clientX-c.left,e.clientY-c.top)}}this.site.element.dispatchEvent(r),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(e.dataTransfer)&&(i=!0,this._dragUnderstood=!0)),i&&(this._addedDragOverClass=!0,o.addClass(this.site._element,l._dragOverClass)),this._draggedItemBoxes=[];var d=this,h=e.target;h.addEventListener("dragend",function _(e){h.removeEventListener("dragend",_),d.onDragEnd(e)}),n._yieldForDomModification(function(){if(d._dragging)for(var e=d._dragInfo.getIndices(),t=0,i=e.length;i>t;t++){var n=d.site._view.items.itemDataAt(e[t]);n&&n.itemBox&&d._addDragSourceClass(n.itemBox)}})}},onDragEnter:function(e){var i=this._dragUnderstood;this._lastEnteredElement=e.target,this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(e.dataTransfer)&&(i=!0),(i||this._dragging&&this.site.itemsReorderable)&&(e.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,o.addClass(this.site._element,l._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(e){e.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(e)},_fireDragEnterEvent:function(e){var i=t.document.createEvent("CustomEvent");i.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:e});var n=!this.site.element.dispatchEvent(i);return this._firedDragEnter=!0,n},_fireDragBetweenEvent:function(e,i,n){var r=t.document.createEvent("CustomEvent");return r.initCustomEvent("itemdragbetween",!0,!0,{index:e,insertAfterIndex:i,dataTransfer:n}),this.site.element.dispatchEvent(r)},_fireDropEvent:function(e,i,n){var r=t.document.createEvent("CustomEvent");return r.initCustomEvent("itemdragdrop",!0,!0,{index:e,insertAfterIndex:i,dataTransfer:n}),this.site.element.dispatchEvent(r)},_handleExitEvent:function(){this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var e=this;this._exitEventTimer=t.setTimeout(function(){if(!e.site._disposed&&e._pointerLeftRegion){if(e.site._layout.dragLeave&&e.site._layout.dragLeave(),e._pointerLeftRegion=!1,e._dragUnderstood=!1,e._lastEnteredElement=null,e._lastInsertPoint=null,e._dragBetweenDisabled=!1,e._firedDragEnter){var i=t.document.createEvent("CustomEvent");i.initCustomEvent("itemdragleave",!0,!1,{}),e.site.element.dispatchEvent(i),e._firedDragEnter=!1}e._addedDragOverClass&&(e._addedDragOverClass=!1,o.removeClass(e.site._element,l._dragOverClass)),e._exitEventTimer=0,e._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(e,i){var n={left:0,top:0};try{n=e.getBoundingClientRect()}catch(r){}var s=t.getComputedStyle(e,null),o=parseInt(s.paddingLeft),a=parseInt(s.paddingTop),l=parseInt(s.borderLeftWidth),c=parseInt(s.borderTopWidth),u=i.clientX,d=i.clientY,h={x:+u===u?u-n.left-o-l:0,y:+d===d?d-n.top-a-c:0};return this.site._rtl()&&(h.x=n.right-n.left-h.x),h},_getPositionInCanvasSpace:function(e){var t=this.site._horizontal()?this.site.scrollPosition:0,i=this.site._horizontal()?0:this.site.scrollPosition,n=this._getEventPositionInElementSpace(this.site.element,e);return{x:n.x+t,y:n.y+i}},_itemBeingDragged:function(e){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(e)||!this._draggingUnselectedItem&&this.site._isSelected(e):!1},_addDragSourceClass:function(e){this._draggedItemBoxes.push(e),o.addClass(e,l._dragSourceClass),e.parentNode&&o.addClass(e.parentNode,l._footprintClass)},renderDragSourceOnRealizedItem:function(e,t){this._itemBeingDragged(e)&&this._addDragSourceClass(t)
},onDragOver:function(t){if(this._dragUnderstood){this._pointerLeftRegion=!1,t.preventDefault();var i=this._getPositionInCanvasSpace(t),n=this._getEventPositionInElementSpace(this.site.element,t);if(this._checkAutoScroll(n.x,n.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var r=this.site._view.hitTest(i.x,i.y);r.insertAfterIndex=e(-1,this.site._cachedCount-1,r.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===r.insertAfterIndex&&this._lastInsertPoint.index===r.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(r.index,r.insertAfterIndex,t.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(i.x,i.y,this._dragInfo)),this._lastInsertPoint=r}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,o.removeClass(this.site._element,l._dragOverClass)),this._draggedItemBoxes){for(var e=0,t=this._draggedItemBoxes.length;t>e;e++)o.removeClass(this._draggedItemBoxes[e],l._dragSourceClass),this._draggedItemBoxes[e].parentNode&&o.removeClass(this._draggedItemBoxes[e].parentNode,l._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(e),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(e,t,i){for(var n=e.getIndices(),r=-1,s=this.site._cachedCount,o=n.length,a=-1,l=t,c=0;o>c;c++)if(n[c]===l){r=c,a=c;break}for(;r>=0&&l>=0;)i?(l++,o>r&&n[r+1]===l&&s>l?r++:l>=s?(i=!1,l=t,r=a):r=-1):(l--,r>0&&n[r-1]===l?r--:r=-1);return l},_reorderItems:function(e,t,i,n,r){var s=this.site,o=function(e){i?s._selection.remove({key:e[0].key}):s._selection.set({firstKey:e[0].key,lastKey:e[e.length-1].key}),r&&s.ensureVisible(s._selection._getFocused())};t.getItems().then(function(t){var i=s.itemDataSource;if(-1===e){i.beginEdits();for(var r=t.length-1;r>=0;r--)i.moveToStart(t[r].key);i.endEdits(),o(t)}else{var a=i.createListBinding();a.fromIndex(e).then(function(e){if(a.release(),i.beginEdits(),n)for(var r=0,s=t.length;s>r;r++)i.moveBefore(t[r].key,e.key);else for(var r=t.length-1;r>=0;r--)i.moveAfter(t[r].key,e.key);i.endEdits(),o(t)})}})},onDrop:function(t){if(this._draggedItemBoxes)for(var i=0,n=this._draggedItemBoxes.length;n>i;i++)this._draggedItemBoxes[i].parentNode&&o.removeClass(this._draggedItemBoxes[i].parentNode,l._footprintClass);if(!this._dragBetweenDisabled){var r=this._getPositionInCanvasSpace(t),s=this.site._view.hitTest(r.x,r.y),a=e(-1,this.site._cachedCount-1,s.insertAfterIndex),c=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===a&&this._lastInsertPoint.index===s.index||(c=this._fireDragBetweenEvent(s.index,a,t.dataTransfer)),c&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(s.index,a,t.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;a=this._findFirstAvailableInsertPoint(this._dragInfo,a,!1),this._reorderItems(a,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),t.preventDefault()},_checkAutoScroll:function(e,i){var r=this.site._getViewportLength(),s=this.site._horizontal(),a=s?e:i,c=this.site._viewport[s?"scrollWidth":"scrollHeight"],u=Math.floor(this.site.scrollPosition),d=0;if(a<l._AUTOSCROLL_THRESHOLD?d=a-l._AUTOSCROLL_THRESHOLD:a>r-l._AUTOSCROLL_THRESHOLD&&(d=a-(r-l._AUTOSCROLL_THRESHOLD)),d=Math.round(d/l._AUTOSCROLL_THRESHOLD*(l._MAX_AUTOSCROLL_RATE-l._MIN_AUTOSCROLL_RATE)),(0===u&&0>d||u>=c-r&&d>0)&&(d=0),0===d)this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var h=this;this._autoScrollDelay=t.setTimeout(function(){if(h._autoScrollRate){h._lastDragTimeout=n._now();var e=function(){if(!h._autoScrollRate&&h._autoScrollFrame||h.site._disposed)h._stopAutoScroll();else{var t=n._now(),i=h._autoScrollRate*((t-h._lastDragTimeout)/1e3);i=0>i?Math.min(-1,i):Math.max(1,i);var r={};r[h.site._scrollProperty]=h.site._viewportScrollPosition+i,o.setScrollPosition(h.site._viewport,r),h._lastDragTimeout=t,h._autoScrollFrame=n._requestAnimationFrame(e)}};h._autoScrollFrame=n._requestAnimationFrame(e)}},l._AUTOSCROLL_DELAY)}this._autoScrollRate=d},_stopAutoScroll:function(){this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(e){function t(e,t,o){function c(c){var u=!0,d=!1;if(o?e.index=Math.max(0,Math.min(c,e.index)):(e.index<0||e.index>c)&&(d=!0),!d&&(h.index!==e.index||h.type!==e.type)){var _=r(n._element,h,e);_&&(u=!1,i._setNewFocusItemOffsetPromise&&i._setNewFocusItemOffsetPromise.cancel(),n._batchViewUpdates(l._ViewChange.realize,l._ScrollToPriority.high,function(){return i._setNewFocusItemOffsetPromise=n._getItemOffset(h,!0).then(function(r){r=n._convertFromCanvasCoordinates(r);var o=r.end<=n.scrollPosition||r.begin>=n.scrollPosition+n._getViewportLength()-1;return i._setNewFocusItemOffsetPromise=n._getItemOffset(e).then(function(r){i._setNewFocusItemOffsetPromise=null;var a={position:n.scrollPosition,direction:"right"};return o&&(n._selection._setFocused(e,!0),r=n._convertFromCanvasCoordinates(r),e.index>h.index?(a.direction="right",a.position=r.end-n._getViewportLength()):(a.direction="left",a.position=r.begin)),n._changeFocus(e,t,m,o,!0),o?a:s.cancel},function(i){return n._changeFocus(e,t,m,!0,!0),s.wrapError(i)}),i._setNewFocusItemOffsetPromise},function(i){return n._changeFocus(e,t,m,!0,!0),s.wrapError(i)}),i._setNewFocusItemOffsetPromise},!0))}return u&&(n._selection._setFocused(h,!0),n.ensureVisible(h)),d?{type:a.ObjectType.item,index:l._INVALID_INDEX}:e}return e.type!==a.ObjectType.groupHeader?d.finalItem().then(c):s.wrap(n._groups.length()-1).then(c)}var i=this,n=this.site,c=n._swipeBehavior===a.SwipeBehavior.select,d=n._view,h=n._selection._getFocused(),_=!0,m=e.ctrlKey,p=o.Key,f=e.keyCode,g=n._rtl();if(!this._isInteractive(e.target)){if(e.ctrlKey&&!e.altKey&&!e.shiftKey&&this._keyboardAcceleratorHandlers[f]&&this._keyboardAcceleratorHandlers[f](),n.itemsReorderable&&!e.ctrlKey&&e.altKey&&e.shiftKey&&h.type===a.ObjectType.item&&(f===p.leftArrow||f===p.rightArrow||f===p.upArrow||f===p.downArrow)){var v=n._selection,y=h.index,b=!1,C=!0;if(!v.isEverything()){if(!v._isIncluded(y)){var w=n._view.items.itemAt(y);w&&o.hasClass(w,l._nonDraggableClass)?C=!1:(b=!0,v=new u._Selection(this.site,[{firstIndex:y,lastIndex:y}]))}if(C){var I=y;f===p.rightArrow?I+=g?-1:1:f===p.leftArrow?I+=g?1:-1:f===p.upArrow?I--:I++;var S=I>y,E=S;S&&I>=this.site._cachedCount&&(E=!1,I=this.site._cachedCount-1),I=this._findFirstAvailableInsertPoint(v,I,E),I=Math.min(Math.max(-1,I),this.site._cachedCount-1);var x=I-(S||-1===I?0:1),k=I,P=this.site._groupsEnabled();if(P){var T=this.site._groups,A=I>-1?T.groupFromItem(I):0;S?T.group(A).startIndex===I&&x--:A<T.length()-1&&I===T.group(A+1).startIndex-1&&x++}if(this._fireDragBetweenEvent(k,x,null)&&this._fireDropEvent(k,x,null)){if(P)return;this._reorderItems(I,v,b,!S,!0)}}}}else if(e.altKey)_=!1;else if(this._keyboardNavigationHandlers[f])this._keyboardNavigationHandlers[f](h).then(function(r){var s=i._keyboardNavigationHandlers[f].clampToBounds;r.type!==a.ObjectType.groupHeader&&e.shiftKey&&n._selectionAllowed()&&n._multiSelection()?(n._selection._pivot===l._INVALID_INDEX&&(n._selection._pivot=h.index),t(r,!0,s).then(function(t){if(t.index!==l._INVALID_INDEX){var r=Math.min(t.index,n._selection._pivot),s=Math.max(t.index,n._selection._pivot),o=e.ctrlKey||n._tap===a.TapBehavior.toggleSelect;i._selectRange(r,s,o)}})):(n._selection._pivot=l._INVALID_INDEX,t(r,!1,s))});else if(e.ctrlKey||f!==p.enter)h.type!==a.ObjectType.groupHeader&&(e.ctrlKey&&f===p.enter||c&&e.shiftKey&&f===p.F10||c&&f===p.menu||f===p.space)?(this._itemEventsHandler.handleSwipeBehavior(h.index),n._changeFocus(h,!0,m,!1,!0)):f===p.escape&&n._selection.count()>0?(n._selection._pivot=l._INVALID_INDEX,n._selection.clear()):_=!1;else{var M=h.type===a.ObjectType.groupHeader?n._groups.group(h.index).header:n._view.items.itemBoxAt(h.index);if(M){h.type===a.ObjectType.groupHeader?(this._pressedHeader=M,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=M,this._pressedContainer=n._view.items.containerAt(h.index),this._pressedHeader=null);var B=this._verifySelectionAllowed(h);B.canTapSelect&&this._itemEventsHandler.handleTap(h),this._fireInvokeEvent(h,M)}}this._keyDownHandled=_,_&&(e.stopPropagation(),e.preventDefault())}f===p.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(e){this._keyDownHandled&&(e.stopPropagation(),e.preventDefault())},onTabEntered:function(e){if(0!==this.site._groups.length()){var t=this.site,i=t._selection._getFocused(),n=e.detail,s=!t._hasKeyboardFocus||e.target===t._viewport;if(s)if(this.inboundFocusHandled=!0,i.index=i.index===l._INVALID_INDEX?0:i.index,n||!this.site._supportsGroupHeaderKeyboarding){var o={type:a.ObjectType.item};i.type===a.ObjectType.groupHeader?(o.index=t._groupFocusCache.getIndexForGroup(i.index),r(t._element,i,o)?t._changeFocus(o,!0,!1,!1,!0):t._changeFocus(i,!0,!1,!1,!0)):(o.index=i.index,t._changeFocus(o,!0,!1,!1,!0)),e.preventDefault()}else{var o={type:a.ObjectType.groupHeader};i.type!==a.ObjectType.groupHeader?(o.index=t._groups.groupFromItem(i.index),r(t._element,i,o)?t._changeFocus(o,!0,!1,!1,!0):t._changeFocus(i,!0,!1,!1,!0)):(o.index=i.index,t._changeFocus(o,!0,!1,!1,!0)),e.preventDefault()}}},onTabExiting:function(e){if(this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var t=this.site,i=t._selection._getFocused(),n=e.detail;if(n&&i.type!==a.ObjectType.groupHeader){var s={type:a.ObjectType.groupHeader,index:t._groups.groupFromItem(i.index)};r(t._element,i,s)&&(t._changeFocus(s,!0,!1,!1,!0),e.preventDefault())}else if(!n&&i.type===a.ObjectType.groupHeader){var s={type:a.ObjectType.item,index:t._groupFocusCache.getIndexForGroup(i.index)};r(t._element,i,s)&&(t._changeFocus(s,!0,!1,!1,!0),e.preventDefault())}}}});return h})})}),define("WinJS/Controls/ListView/_ErrorMessages",["exports","../../Core/_Base","../../Core/_Resources"],function(e,t){"use strict";t.Namespace._moduleDefine(e,null,{modeIsInvalid:{get:function(){return"Invalid argument: mode must be one of following values: 'none', 'single' or 'multi'."}},loadingBehaviorIsDeprecated:{get:function(){return"Invalid configuration: loadingBehavior is deprecated. The control will default this property to 'randomAccess'. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoad is deprecated. The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadThresholdIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoadThreshold is deprecated.  The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},automaticallyLoadPagesIsDeprecated:{get:function(){return"Invalid configuration: automaticallyLoadPages is deprecated. The control will default this property to false. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},invalidTemplate:{get:function(){return"Invalid template: Templates must be created before being passed to the ListView, and must contain a valid tree of elements."}},loadMorePagesIsDeprecated:{get:function(){return"loadMorePages is deprecated. Invoking this function will not have any effect. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},disableBackdropIsDeprecated:{get:function(){return"Invalid configuration: disableBackdrop is deprecated. Style: .win-listview .win-container.win-backdrop { background-color:transparent; } instead."}},backdropColorIsDeprecated:{get:function(){return"Invalid configuration: backdropColor is deprecated. Style: .win-listview .win-container.win-backdrop { rgba(155,155,155,0.23); } instead."}},itemInfoIsDeprecated:{get:function(){return"GridLayout.itemInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},groupInfoIsDeprecated:{get:function(){return"GridLayout.groupInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},resetItemIsDeprecated:{get:function(){return"resetItem may be altered or unavailable in future versions. Instead, mark the element as disposable using WinJS.Utilities.markDisposable."}},resetGroupHeaderIsDeprecated:{get:function(){return"resetGroupHeader may be altered or unavailable in future versions. Instead, mark the header element as disposable using WinJS.Utilities.markDisposable."}},maxRowsIsDeprecated:{get:function(){return"GridLayout.maxRows may be altered or unavailable in future versions. Instead, use the maximumRowsOrColumns property."}}})}),define("WinJS/Controls/ListView/_GroupFocusCache",["exports","../../Core/_Base"],function(e,t){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(function(e){this._listView=e,this.clear()},{updateCache:function(e,t,i){i=""+i,this._itemToIndex[t]=i,this._groupToItem[e]=t},deleteItem:function(e){if(this._itemToIndex[e])for(var t=this,i=Object.keys(this._groupToItem),n=0,r=i.length;r>n;n++){var s=i[n];if(t._groupToItem[s]===e){t.deleteGroup(s);break}}},deleteGroup:function(e){var t=this._groupToItem[e];t&&delete this._itemToIndex[t],delete this._groupToItem[e]},updateItemIndex:function(e,t){this._itemToIndex[e]&&(this._itemToIndex[e]=""+t)},getIndexForGroup:function(e){var t=this._listView._groups.group(e).key,i=this._groupToItem[t];return i&&this._itemToIndex[i]?+this._itemToIndex[i]:this._listView._groups.fromKey(t).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={}}})}),_UnsupportedGroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(null,{updateCache:function(){},deleteItem:function(){},deleteGroup:function(){},updateItemIndex:function(){},getIndexForGroup:function(){return 0},clear:function(){}})})})}),define("WinJS/Controls/ListView/_GroupsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_ItemsManager","../../Utilities/_UI","../ItemContainer/_Constants"],function(e,t,i,n,r,s,o,a){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupsContainerBase:t.Namespace._lazy(function(){return t.Class.define(function(){},{index:function(e){var t=this.headerFrom(e);if(t)for(var i=0,n=this.groups.length;n>i;i++)if(t===this.groups[i].header)return i;return a._INVALID_INDEX},headerFrom:function(e){for(;e&&!r.hasClass(e,a._headerClass);)e=e.parentNode;return e},requestHeader:function(e){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[e]||(this._waitingHeaderRequests[e]=[]);var t=this;return new i(function(i){var n=t.groups[e];n&&n.header?i(n.header):t._waitingHeaderRequests[e].push(i)})},notify:function(e,t){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[e]){for(var i=this._waitingHeaderRequests[e],n=0,r=i.length;r>n;n++)i[n](t);this._waitingHeaderRequests[e]=[]}},groupFromImpl:function(e,t,i){if(e>t)return null;var n=e+Math.floor((t-e)/2),r=this.groups[n];return i(r,n)?this.groupFromImpl(e,n-1,i):t>n&&!i(this.groups[n+1],n+1)?this.groupFromImpl(n+1,t,i):n},groupFrom:function(e){if(this.groups.length>0){var t=this.groups.length-1,i=this.groups[t];return e(i,t)?this.groupFromImpl(0,this.groups.length-1,e):t}return null},groupFromItem:function(e){return this.groupFrom(function(t){return e<t.startIndex})},groupFromOffset:function(e){return this.groupFrom(function(t){return e<t.offset})},group:function(e){return this.groups[e]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var e=0,t=this.groups.length;t>e;e++){var i=this.groups[e];i.userData&&this.listBinding.releaseItem(i.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var e=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return i.join(e.pendingChanges)}).then(function(){return e._listView._ifZombieDispose()?i.cancel:void 0}).then(function(){e.ignoreChanges=!1},function(t){return e.ignoreChanges=!1,i.wrapError(t)})},fromKey:function(e){for(var t=0,i=this.groups.length;i>t;t++){var n=this.groups[t];if(n.key===e)return{group:n,index:t}}return null},fromHandle:function(e){for(var t=0,i=this.groups.length;i>t;t++){var n=this.groups[t];if(n.handle===e)return{group:n,index:t}}return null}})}),_UnvirtualizedGroupsContainer:t.Namespace._lazy(function(){return t.Class.derive(e._GroupsContainerBase,function(e,t){this._listView=e,this.groupDataSource=t,this.groups=[],this.pendingChanges=[],this.dirty=!0;var i=this,s={beginNotifications:function(){i._listView._versionManager.beginNotifications()},endNotifications:function(){i._listView._versionManager.endNotifications(),i._listView._ifZombieDispose()||!i.ignoreChanges&&i._listView._groupsChanged&&i._listView._scheduleUpdate()},indexChanged:function(){i._listView._versionManager.receivedNotification(),i._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(e){i._listView._versionManager.receivedNotification(),i._listView._writeProfilerMark("groupCountChanged("+e+"),info"),i._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(e){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){var t=i.fromKey(e.key);t&&(i._listView._writeProfilerMark("groupChanged("+t.index+"),info"),t.group.userData=e,t.group.startIndex=e.firstItemIndexHint,this.markToRemove(t.group)),this.scheduleUpdate()}},removed:function(e){if(i._listView._versionManager.receivedNotification(),i._listView._groupRemoved(e),!i._listView._ifZombieDispose()){var t=i.fromHandle(e);if(t){i._listView._writeProfilerMark("groupRemoved("+t.index+"),info"),i.groups.splice(t.index,1);var n=i.groups.indexOf(t.group,t.index);n>-1&&i.groups.splice(n,1),this.markToRemove(t.group)}this.scheduleUpdate()}},inserted:function(e,t,n){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupInserted,info");var r=this;e.retain().then(function(s){var o;if(o=t||n||i.groups.length?r.findIndex(t,n):0,-1!==o){var a={key:s.key,startIndex:s.firstItemIndexHint,userData:s,handle:e.handle};i.groups.splice(o,0,a)}r.scheduleUpdate()}),i.pendingChanges.push(e)}},moved:function(e,t,n){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupMoved,info");var r=this;e.then(function(s){var o=r.findIndex(t,n),a=i.fromKey(s.key);if(a)i.groups.splice(a.index,1),-1!==o&&(a.index<o&&o--,a.group.key=s.key,a.group.userData=s,a.group.startIndex=s.firstItemIndexHint,i.groups.splice(o,0,a.group));else if(-1!==o){var l={key:s.key,startIndex:s.firstItemIndexHint,userData:s,handle:e.handle};i.groups.splice(o,0,l),e.retain()}r.scheduleUpdate()}),i.pendingChanges.push(e)}},reload:function(){i._listView._versionManager.receivedNotification(),i._listView._ifZombieDispose()||i._listView._processReload()},markToRemove:function(e){if(e.header){var t=e.header;e.header=null,e.left=-1,e.width=-1,e.decorator=null,e.tabIndex=-1,t.tabIndex=-1,i._listView._groupsToRemove[r._uniqueID(t)]={group:e,header:t}}},scheduleUpdate:function(){i.dirty=!0,i.ignoreChanges||(i._listView._groupsChanged=!0)},findIndex:function(e,t){var n,r=-1;return e&&(n=i.fromHandle(e),n&&(r=n.index+1)),-1===r&&t&&(n=i.fromHandle(t),n&&(r=n.index)),r},removeElements:function(e){if(e.header){var t=e.header.parentNode;t&&(n.disposeSubTree(e.header),t.removeChild(e.header)),e.header=null,e.left=-1,e.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(s)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var e=this;return this.initializePromise=this.groupDataSource.getCount().then(function(t){for(var n=[],r=0;t>r;r++)n.push(e.listBinding.fromIndex(r).retain());return i.join(n)}).then(function(t){e.groups=[];for(var i=0,n=t.length;n>i;i++){var r=t[i];e.groups.push({key:r.key,startIndex:r.firstItemIndexHint,handle:r.handle,userData:r})}e._listView._writeProfilerMark("GroupsContainer_initialize groups("+t.length+"),info"),e._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(t){return e._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),i.wrapError(t)}),this.initializePromise},renderGroup:function(e){if(this._listView.groupHeaderTemplate){var t=this.groups[e];return i.wrap(this._listView._groupHeaderRenderer(i.wrap(t.userData))).then(s._normalizeRendererReturn)}return i.wrap(null)},setDomElement:function(e,t){this.groups[e].header=t,this.notify(e,t)},removeElements:function(){for(var e=this._listView._groupsToRemove||{},t=Object.keys(e),i=!1,r=this._listView._selection._getFocused(),s=0,a=t.length;a>s;s++){var l=e[t[s]],c=l.header,u=l.group;if(i||r.type!==o.ObjectType.groupHeader||u.userData.index!==r.index||(this._listView._unsetFocusOnItem(),i=!0),c){var d=c.parentNode;d&&(n._disposeElement(c),d.removeChild(c))}}i&&this._listView._setFocusOnItem(r),this._listView._groupsToRemove={}},resetGroups:function(){for(var e=this.groups.slice(0),t=0,i=e.length;i>t;t++){var n=e[t];this.listBinding&&n.userData&&this.listBinding.releaseItem(n.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:t.Namespace._lazy(function(){return t.Class.derive(e._GroupsContainerBase,function(e){this._listView=e,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return i.wrap()},addItem:function(){return i.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return i.wrap(null)},ensureFirstGroup:function(){return i.wrap(this.groups[0])},groupOf:function(){return i.wrap(this.groups[0])},removeElements:function(){}})})})}),define("WinJS/Controls/ListView/_Helpers",["exports","../../Core/_Base","../ItemContainer/_Constants","../../Animations"],function(e,t,i,n){"use strict";function r(e){return Array.prototype.slice.call(e)}function s(e,t){if("string"==typeof e)return s([e],t);var i=new Array(Math.floor(t/e.length)+1).join(e.join(""));return i+=e.slice(0,t%e.length).join("")}function o(e,t){var n,r=i._containerEvenClass,o=i._containerOddClass,a=t%2===0?[r,o]:[o,r],l=["<div class='win-container "+a[0]+" win-backdrop'></div>","<div class='win-container "+a[1]+" win-backdrop'></div>"];return n=s(l,e)}t.Namespace._moduleDefine(e,"WinJS.UI",{_nodeListToArray:r,_repeat:s,_stripedContainers:o,_ListViewAnimationHelper:{fadeInElement:function(e){return n.fadeIn(e)},fadeOutElement:function(e){return n.fadeOut(e)},animateEntrance:function(e,t){return n.enterContent(e,[{left:t?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"})}}})}),define("WinJS/Controls/ListView/_ItemsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_ElementUtilities","../ItemContainer/_Constants"],function(e,t,i,n,r){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_ItemsContainer:t.Namespace._lazy(function(){var e=function(e){this.site=e,this._itemData={},this.waitingItemRequests={}};return e.prototype={requestItem:function(e){this.waitingItemRequests[e]||(this.waitingItemRequests[e]=[]);var t=this,n=new i(function(i){var n=t._itemData[e];n&&!n.detached&&n.element?i(n.element):t.waitingItemRequests[e].push(i)});return n},removeItem:function(e){delete this._itemData[e]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(e,t){this._itemData[e]=t,t.detached||this.notify(e,t)},notify:function(e,t){if(this.waitingItemRequests[e]){for(var i=this.waitingItemRequests[e],n=0;n<i.length;n++)i[n](t.element);this.waitingItemRequests[e]=[]}},elementAvailable:function(e){var t=this._itemData[e];t.detached=!1,this.notify(e,t)},itemAt:function(e){var t=this._itemData[e];return t?t.element:null},itemDataAt:function(e){return this._itemData[e]},containerAt:function(e){var t=this._itemData[e];return t?t.container:null},itemBoxAt:function(e){var t=this._itemData[e];return t?t.itemBox:null},itemBoxFrom:function(e){for(;e&&!n.hasClass(e,r._itemBoxClass);)e=e.parentNode;return e},containerFrom:function(e){for(;e&&!n.hasClass(e,r._containerClass);)e=e.parentNode;return e},index:function(e){var t=this.containerFrom(e);if(t)for(var i in this._itemData)if(this._itemData[i].container===t)return parseInt(i,10);return r._INVALID_INDEX},each:function(e){for(var t in this._itemData)if(this._itemData.hasOwnProperty(t)){var i=this._itemData[t];e(parseInt(t,10),i.element,i)}},eachIndex:function(e){for(var t in this._itemData)if(e(parseInt(t,10)))break},count:function(){return Object.keys(this._itemData).length}},e})})}),define("WinJS/Controls/ListView/_Layouts",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations/_TransitionAnimation","../../Promise","../../Scheduler","../../_Signal","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","./_ErrorMessages"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f){"use strict";function g(e){return"_win-dynamic-"+e+"-"+F++}function v(){var e,t,i,n=R.sheet.cssRules,r=N.length;for(e=0;r>e;e++)for(i="."+N[e]+" ",t=n.length-1;t>=0;t--)-1!==n[t].selectorText.indexOf(i)&&R.sheet.deleteRule(t);N=[]}function y(e,t,i,n){v();var r="."+p._listViewClass+" ."+e+" "+i+" { "+n+"}",s="_addDynamicCssRule:"+e+",info";t?t._writeProfilerMark(s):o("WinJS.UI.ListView:Layout"+s),R.sheet.insertRule(r,0)}function b(e){N.push(e)}function C(e,t,i){return Math.max(e,Math.min(t,i))}function w(e,i){return h.convertToPixels(e,t.getComputedStyle(e,null)[i])}function I(e,t){return w(t,"margin"+e)+w(t,"border"+e+"Width")+w(t,"padding"+e)}function S(e){return I("Top",e)+I("Bottom",e)}function E(e){return I("Left",e)+I("Right",e)}function x(e,t){if(e.items)for(var i=0,n=e.items.length;n>i;i++)t(e.items[i],i);else for(var r=0,s=0;r<e.itemsBlocks.length;r++)for(var o=e.itemsBlocks[r],i=0,n=o.items.length;n>i;i++)t(o.items[i],s++)}function k(e,t){if(0>t)return null;if(e.items)return t<e.items.length?e.items[t]:null;var i=e.itemsBlocks[0].items.length,n=Math.floor(t/i),r=t%i;return n<e.itemsBlocks.length&&r<e.itemsBlocks[n].items.length?e.itemsBlocks[n].items[r]:null}function P(e,t){for(var i,n=0,r=t.length;r>n;n++)if(t[n].itemsContainer.element===e){i=t[n].itemsContainer;break}return i}function T(e){var t,i;return e.itemsBlocks?(t=e.itemsBlocks.length,i=t>0?e.itemsBlocks[0].items.length*(t-1)+e.itemsBlocks[t-1].items.length:0):i=e.items.length,i}function A(e){if(!q){var i=t.document.createElement("div");i.style.width="500px",i.style.visibility="hidden";var n=t.document.createElement("div");n.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",_.setInnerHTMLUnsafe(n,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>"),i.appendChild(n),e.viewport.insertBefore(i,e.viewport.firstChild);var r=i.offsetWidth>0,s=200;r&&(q={supportsCSSGrid:!!("-ms-grid-row"in t.document.documentElement.style),nestedFlexTooLarge:n.firstElementChild.offsetWidth>s,nestedFlexTooSmall:n.firstElementChild.offsetWidth<s}),e.viewport.removeChild(i)}return q}function M(e){return l.is(e)?{realizedRangeComplete:e,layoutComplete:e}:"object"==typeof e&&e&&e.layoutComplete?e:{realizedRangeComplete:l.wrap(),layoutComplete:l.wrap()}}function B(e){return{left:w(e,"marginLeft"),right:w(e,"marginRight"),top:w(e,"marginTop"),bottom:w(e,"marginBottom")}}var L=h.Key,D=h._uniqueID,O={get itemInfoIsInvalid(){return"Invalid argument: An itemInfo function must be provided which returns an object with numeric width and height properties."},get groupInfoResultIsInvalid(){return"Invalid result: groupInfo result for cell spanning groups must include the following numeric properties: cellWidth and cellHeight."}},R=t.document.createElement("style");t.document.head.appendChild(R);var F=0,N=[],z=n._browserStyleEquivalents,H=z.transform,W=n._browserStyleEquivalents.transition.scriptName,U=H.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",V=12,q=null;i.Namespace._moduleDefine(e,"WinJS.UI",{Layout:i.Class.define(function(){}),_LayoutCommon:i.Namespace._lazy(function(){return i.Class.derive(e.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(e){this._groupHeaderPosition=e,this._invalidateLayout()}},initialize:function(e,t){e._writeProfilerMark("Layout:initialize,info"),this._inListMode||h.addClass(e.surface,p._gridLayoutClass),this._backdropColorClassName&&h.addClass(e.surface,this._backdropColorClassName),this._disableBackdropClassName&&h.addClass(e.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=e,this._groupsEnabled=t,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(e){this._orientation=e,this._horizontal="horizontal"===e,this._invalidateLayout()}},uninitialize:function(){function e(e){var t,i=e.length;for(t=0;i>t;t++)e[t].cleanUp(!0)}var t="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(t),h.removeClass(this._site.surface,p._gridLayoutClass),h.removeClass(this._site.surface,p._headerPositionTopClass),h.removeClass(this._site.surface,p._headerPositionLeftClass),h.removeClass(this._site.surface,p._structuralNodesClass),this._site.surface.style.cssText="",this._groups&&(e(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=null,this._backdropColorClassName&&(h.removeClass(this._site.surface,this._backdropColorClassName),b(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(h.removeClass(this._site.surface,this._disableBackdropClassName),b(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):o("WinJS.UI.ListView:"+t)},numberOfItemsPerItemsBlock:{get:function(){function t(){var e,t=i._site.groupCount;for(e=0;t>e;e++)if(i._isCellSpanning(e))return!1;return!0}var i=this;return i._measureItem(0).then(function(){return i._sizes.viewportContentSize!==i._getViewportCrossSize()&&i._viewportSizeChanged(i._getViewportCrossSize()),i._envInfo.nestedFlexTooLarge||i._envInfo.nestedFlexTooSmall||!t()?(i._usingStructuralNodes=!1,null):(i._usingStructuralNodes=e._LayoutCommon._barsPerItemsBlock>0,e._LayoutCommon._barsPerItemsBlock*i._itemsPerBar)
})}},layout:function(e,t,i,n){function r(e){function t(e){if(d._usingStructuralNodes){var t=[];return e.itemsBlocks.forEach(function(e){t=t.concat(e.items.slice(0))}),t}return e.items.slice(0)}return{element:e.element,items:t(e)}}function s(){function i(e,t){var i=e.enableCellSpanning?j.CellSpanningGroup:j.UniformGroup;return new i(d,t)}var n,s=d._groups.length>0?d._getRealizationRange():null,o=[],a=[],c={},u={},h=0,_=e.length;for(n=0;_>n;n++){var m=null,p=d._getGroupInfo(n),f=d._site.groupFromIndex(n).key,g=d._groupMap[f],v=g instanceof j.CellSpanningGroup,y=p.enableCellSpanning;if(g)if(v!==y)c[f]=!0;else{var b=Math.max(0,t.firstIndex-g.startIndex),C=d._rangeForGroup(g,s);C&&b<=C.lastIndex&&(m={firstIndex:Math.max(b,C.firstIndex),lastIndex:C.lastIndex})}var w,I=i(p,e[n].itemsContainer.element);w=I.prepareLayoutWithCopyOfTree?I.prepareLayoutWithCopyOfTree(r(e[n].itemsContainer),m,g,{groupInfo:p,startIndex:h}):I.prepareLayout(T(e[n].itemsContainer),m,g,{groupInfo:p,startIndex:h}),a.push(w),h+=I.count,o.push(I),u[f]=I}return l.join(a).then(function(){for(var e=0,t=0,i=o.length;i>t;t++){var n=o[t];n.offset=e,e+=d._getGroupSize(n)}Object.keys(d._groupMap).forEach(function(e){var t=!c[e];d._groupMap[e].cleanUp(t)}),d._groups=o,d._groupMap=u})}function o(e,i,n){var r,s=d._groups[e],o=Math.max(0,t.firstIndex-s.startIndex),a=d._rangeForGroup(s,i);return n?void s.layoutRealizedRange(o,a):(a||(r=s.startIndex+s.count-1<i.firstIndex),s.layoutUnrealizedRange(o,a,r))}function a(){if(0!==d._groups.length){var i,n=d._getRealizationRange(),r=e.length,s=_.groupIndexFromItemIndex(t.firstIndex);for(i=s;r>i;i++)o(i,n,!0),d._layoutGroup(i)}}function c(){if(0===d._groups.length)return l.wrap();var e=d._getRealizationRange(),i=_.groupIndexFromItemIndex(e.firstIndex-1),n=_.groupIndexFromItemIndex(e.lastIndex+1),r=_.groupIndexFromItemIndex(t.firstIndex),s=[],a=d._groups.length,c=!1,u=i,h=Math.max(r,n);for(h=Math.max(u+1,h);!c;)c=!0,u>=r&&(s.push(o(u,e,!1)),c=!1,u--),a>h&&(s.push(o(h,e,!1)),c=!1,h++);return l.join(s)}var u,d=this,_=d._site,m="Layout.layout",f=m+":realizedRange";return d._site._writeProfilerMark(m+",StartTM"),d._site._writeProfilerMark(f+",StartTM"),u=d._measureItem(0).then(function(){return h[d._usingStructuralNodes?"addClass":"removeClass"](d._site.surface,p._structuralNodesClass),d._sizes.viewportContentSize!==d._getViewportCrossSize()&&d._viewportSizeChanged(d._getViewportCrossSize()),d._cacheRemovedElements(i,d._cachedItemRecords,d._cachedInsertedItemRecords,d._cachedRemovedItems,!1),d._cacheRemovedElements(n,d._cachedHeaderRecords,d._cachedInsertedHeaderRecords,d._cachedRemovedHeaders,!0),s()}).then(function(){d._syncDomWithGroupHeaderPosition(e);var t=0;if(d._groups.length>0){var r=d._groups[d._groups.length-1];t=r.offset+d._getGroupSize(r)}d._horizontal?(d._groupsEnabled&&d._groupHeaderPosition===J.left?_.surface.style.cssText+=";height:"+d._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+d._sizes.headerContainerWidth+"px auto)["+e.length+"]":_.surface.style.height=d._sizes.surfaceContentSize+"px",(d._envInfo.nestedFlexTooLarge||d._envInfo.nestedFlexTooSmall)&&(_.surface.style.width=t+"px")):(d._groupsEnabled&&d._groupHeaderPosition===J.top?_.surface.style.cssText+=";width:"+d._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+d._sizes.headerContainerHeight+"px auto)["+e.length+"]":_.surface.style.width=d._sizes.surfaceContentSize+"px",(d._envInfo.nestedFlexTooLarge||d._envInfo.nestedFlexTooSmall)&&(_.surface.style.height=t+"px")),a(),d._layoutAnimations(i,n),d._site._writeProfilerMark(f+":complete,info"),d._site._writeProfilerMark(f+",StopTM")},function(e){return d._site._writeProfilerMark(f+":canceled,info"),d._site._writeProfilerMark(f+",StopTM"),l.wrapError(e)}),d._layoutPromise=u.then(function(){return c().then(function(){d._site._writeProfilerMark(m+":complete,info"),d._site._writeProfilerMark(m+",StopTM")},function(e){return d._site._writeProfilerMark(m+":canceled,info"),d._site._writeProfilerMark(m+",StopTM"),l.wrapError(e)})}),{realizedRangeComplete:u,layoutComplete:d._layoutPromise}},itemsFromRange:function(e,t){return this._rangeContainsItems(e,t)?{firstIndex:this._firstItemFromRange(e),lastIndex:this._lastItemFromRange(t)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(t,i){function n(){var e={type:t.type,index:t.index-o.startIndex},i=o.getAdjacent(e,a);if("boundary"===i){var n=r._groups[s-1],l=r._groups[s+1],c=r._groups.length-1;if(a===L.leftArrow){if(0===s)return t;if(n instanceof j.UniformGroup&&o instanceof j.UniformGroup){var u=r._indexToCoordinate(e.index),d=r._horizontal?u.row:u.column,h=Math.floor((n.count-1)/r._itemsPerBar),_=h*r._itemsPerBar;return{type:m.ObjectType.item,index:n.startIndex+Math.min(n.count-1,_+d)}}return{type:m.ObjectType.item,index:o.startIndex-1}}if(a===L.rightArrow){if(s===c)return t;if(o instanceof j.UniformGroup&&l instanceof j.UniformGroup){var u=r._indexToCoordinate(e.index),d=r._horizontal?u.row:u.column;return{type:m.ObjectType.item,index:l.startIndex+Math.min(l.count-1,d)}}return{type:m.ObjectType.item,index:l.startIndex}}return t}return i.index+=o.startIndex,i}var r=this,s=r._site.groupIndexFromItemIndex(t.index),o=r._groups[s],a=r._adjustedKeyForOrientationAndBars(r._adjustedKeyForRTL(i),o instanceof j.CellSpanningGroup);if(t.type===m.ObjectType.groupHeader){if(i!==L.pageUp&&i!==L.pageDown){switch(a){case L.leftArrow:return{type:m.ObjectType.groupHeader,index:Math.max(0,t.index-1)};case L.rightArrow:return{type:m.ObjectType.groupHeader,index:Math.min(r._groups.length-1,t.index+1)}}return t}t={type:m.ObjectType.item,index:this._groups[t.index].startIndex}}switch(r._adjustedKeyForRTL(i)){case L.upArrow:case L.leftArrow:case L.downArrow:case L.rightArrow:return n();default:return e._LayoutCommon.prototype._getAdjacentForPageKeys.call(r,t,i)}},hitTest:function(e,t){var i,n=this._sizes;e-=n.layoutOriginX,t-=n.layoutOriginY;var r=this._groupFromOffset(this._horizontal?e:t),s=this._groups[r];return this._horizontal?e-=s.offset:t-=s.offset,this._groupsEnabled&&(this._groupHeaderPosition===J.left?e-=n.headerContainerWidth:t-=n.headerContainerHeight),i=s.hitTest(e,t),i.index+=s.startIndex,i.insertAfterIndex+=s.startIndex,i},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var e=this._getRealizationRange(),t=this._site.tree,i=0,n="horizontal"===this.orientation,r=0,s=t.length;s>r;r++){var o=t[r],a=!1,l=this._groups[r],c=l instanceof j.CellSpanningGroup,u=l?l.offset:0;if(x(o.itemsContainer,function(t,n){if(e.firstIndex<=i&&e.lastIndex>=i&&(a=!0,!this._cachedItemRecords[i])){var s=this._getItemPositionForAnimations(i,r,n),o=s.row,l=s.column,u=s.left,d=s.top;this._cachedItemRecords[i]={oldRow:o,oldColumn:l,oldLeft:u,oldTop:d,width:s.width,height:s.height,element:t,inCellSpanningGroup:c}}i++}.bind(this)),a){var d=r;if(!this._cachedHeaderRecords[d]){var h=this._getHeaderPositionForAnimations(d);this._cachedHeaderRecords[d]={oldLeft:h.left,oldTop:h.top,width:h.width,height:h.height,element:o.header}}this._cachedGroupRecords[D(o.itemsContainer.element)]||(this._cachedGroupRecords[D(o.itemsContainer.element)]={oldLeft:n?u:0,left:n?u:0,oldTop:n?0:u,top:n?0:u,element:o.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(e,t){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(e,t);for(var i=this._getRealizationRange(),n=this._site.tree,r=0,s="horizontal"===this.orientation,o=0,a=n.length;a>o;o++){var l=n[o],c=this._groups[o],u=c instanceof j.CellSpanningGroup,d=c?c.offset:0,_=0,m=0,f=this._cachedGroupRecords[D(l.itemsContainer.element)];f&&(s?_=f.oldLeft-d:m=f.oldTop-d),x(l.itemsContainer,function(e,t){if(i.firstIndex<=r&&i.lastIndex>=r){var n=this._cachedItemRecords[r];if(n){var s=this._getItemPositionForAnimations(r,o,t),a=s.row,l=s.column,c=s.left,d=s.top;if(n.inCellSpanningGroup=n.inCellSpanningGroup||u,n.oldRow!==a||n.oldColumn!==l||n.oldTop!==d||n.oldLeft!==c){n.row=a,n.column=l,n.left=c,n.top=d;var f=n.oldLeft-n.left-_,g=n.oldTop-n.top-m;if(f=(this._site.rtl?-1:1)*f,n.xOffset=f,n.yOffset=g,0!==f||0!==g){var v=n.element;n.needsToResetTransform=!0,v.style[W]="",v.style[H.scriptName]="translate("+f+"px,"+g+"px)"}var y=e.parentNode;h.hasClass(y,p._itemsBlockClass)&&(this._animatingItemsBlocks[D(y)]=y)}}else this._cachedInsertedItemRecords[r]=e,e.style[W]="",e.style.opacity=0}r++}.bind(this));var g=o,v=this._cachedHeaderRecords[g];if(v){var y=this._getHeaderPositionForAnimations(g);if(v.height=y.height,v.width=y.width,v.oldLeft!==y.left||v.oldTop!==y.top){v.left=y.left,v.top=y.top;var b=v.oldLeft-v.left,C=v.oldTop-v.top;if(b=(this._site.rtl?-1:1)*b,0!==b||0!==C){v.needsToResetTransform=!0;var w=v.element;w.style[W]="",w.style[H.scriptName]="translate("+b+"px,"+C+"px)"}}}if(f&&(s&&f.left!==d||!s&&f.top!==d)){var I=f.element;if(0===_&&0===m)f.needsToResetTransform&&(f.needsToResetTransform=!1,I.style[H.scriptName]="");else{var S=(this._site.rtl?-1:1)*_,E=m;f.needsToResetTransform=!0,I.style[W]="",I.style[H.scriptName]="translate("+S+"px, "+E+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var k=Object.keys(this._animatingItemsBlocks),P=0,T=k.length;T>P;P++)this._animatingItemsBlocks[k[P]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function t(){if(r(),L)s();else{if(tt._itemsPerBar>1)for(var e=tt._itemsPerBar*tt._sizes.containerCrossSize+tt._getHeaderSizeContentAdjustment()+tt._sizes.containerMargins[J?"top":C.rtl?"right":"left"]+(J?tt._sizes.layoutOriginY:tt._sizes.layoutOriginX),t=0,i=S.length;i>t;t++){var n=S[t];n[K]>n[G]?(z=Math.max(z,n[Y]+n[J?"height":"width"]),V=Math.max(V,e-n[Z]),O=!0,j.push(n)):n[K]<n[G]&&(U=Math.max(U,e-n[Y]),q=Math.max(q,n[Z]+n[J?"height":"width"]),j.push(n),O=!0)}C.rtl&&!J&&(z*=-1,V*=-1,U*=-1,q*=-1),O?c(tt._itemsPerBar):f()}}function i(t){M=l.join(B),M.done(function(){B=[],y&&(e.Layout._debugAnimations?n._requestAnimationFrame(function(){t()}):t())})}function r(){if(I.length){C._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),k+=60,A+=60;var e=120;b&&(e*=10),B.push(a.executeTransition(I,[{property:"opacity",delay:x,duration:e,timing:"linear",to:0,skipStylesReset:!0}])),C._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function s(){C._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var e=[],t=0,n=S.length;n>t;t++){var r=S[t],s=r.element;e.push(s)}for(var t=0,n=E.length;n>t;t++){var r=E[t],s=r.element;e.push(s)}var l=120;b&&(l*=10),B.push(a.executeTransition(e,{property:"opacity",delay:x,duration:l,timing:"linear",to:0})),i(o),C._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function o(){C._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),A=0;for(var e=[],t=0,i=S.length;i>t;t++){var n=S[t],r=n.element;r.style[H.scriptName]="",e.push(r)}for(var t=0,i=E.length;i>t;t++){var n=E[t],r=n.element;r.style[H.scriptName]="",e.push(r)}var s=120;b&&(s*=10),B.push(a.executeTransition(e,{property:"opacity",delay:A,duration:s,timing:"linear",to:1})),C._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),g()}function c(e){C._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var t={},n=0,r=j.length;r>n;n++){var s=j[n],o=s.xOffset,l=s.yOffset;s[K]>s[G]?J?l-=z:o-=z:s[K]<s[G]&&(J?l+=U:o+=U);var c=s.element;R=Math.min(R,J?o:l),F=Math.max(F,J?o:l);var u=c.parentNode;h.hasClass(u,"win-itemscontainer")||(u=u.parentNode);var d=t[D(u)];if(!d){var _=T(P(u,C.tree));t[D(u)]=d=Math.ceil(_/e)-1}j[n][J?"column":"row"]===d&&(N[D(u)]=u);var f=80;b&&(f*=10),B.push(a.executeTransition(c,{property:H.cssName,delay:k,duration:f,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+o+"px,"+l+"px)"}))}for(var g=Object.keys(N),n=0,r=g.length;r>n;n++){var v=N[g[n]];C.rtl&&J?(v.style.paddingLeft=-1*R+"px",v.style.marginLeft=R+"px"):(v.style[J?"paddingRight":"paddingBottom"]=F+"px",v.style[J?"marginRight":"marginBottom"]="-"+F+"px")}for(var y=Object.keys(X),n=0,r=y.length;r>n;n++)X[y[n]].classList.add(p._clipClass);i(m),C._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function _(){for(var e=Object.keys(N),t=0,i=e.length;i>t;t++){var n=N[e[t]];C.rtl&&J?(n.style.paddingLeft="",n.style.marginLeft=""):(n.style[J?"paddingRight":"paddingBottom"]="",n.style[J?"marginRight":"marginBottom"]="")}N={};for(var r=Object.keys(X),t=0,i=r.length;i>t;t++){var s=X[r[t]];s.style.overflow="",s.classList.remove(p._clipClass)}}function m(){C._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var t=0,i=j.length;i>t;t++){var r=j[t],s=0,o=0;r[K]>r[G]?J?o=V:s=V:r[K]<r[G]&&(J?o=-1*q:s=-1*q),r.element.style[W]="",r.element.style[H.scriptName]="translate("+s+"px,"+o+"px)"}C._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),e.Layout._debugAnimations?n._requestAnimationFrame(function(){f(!0)}):f(!0)}function f(e){var t=200;if(e&&(t=150,k=0,A=0),b&&(t*=10),S.length>0||E.length>0){C._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var i=[],n=0,r=E.length;r>n;n++){var s=E[n].element;i.push(s)}for(var n=0,r=S.length;r>n;n++){var s=S[n].element;i.push(s)}B.push(a.executeTransition(i,{property:H.cssName,delay:k,duration:t,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),A+=80,C._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}g()}function g(){if(w.length>0){C._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var e=120;b&&(e*=10),B.push(a.executeTransition(w,[{property:"opacity",delay:A,duration:e,timing:"linear",to:1}])),C._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}i(v)}function v(){C._writeProfilerMark("Animation:cleanupAnimations,StartTM"),_();for(var e=0,t=I.length;t>e;e++){var i=I[e];i.parentNode&&(d._disposeElement(i),i.parentNode.removeChild(i))}C._writeProfilerMark("Animation:cleanupAnimations,StopTM"),tt._animationsRunning=null,y.complete()}var y=new u;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),y.complete(),y.promise;this._animationsRunning=y.promise;for(var b=e.Layout._debugAnimations||e.Layout._slowAnimations,C=this._site,w=this._insertedElements,I=this._removedElements,S=this._itemMoveRecords,E=this._moveRecords,x=0,k=0,A=0,M=null,B=[],L=!1,O=!1,R=0,F=0,N={},z=0,U=0,V=0,q=0,j=[],J="horizontal"===this.orientation,K=J?"oldColumn":"oldRow",G=J?"column":"row",Y=J?"oldTop":"oldLeft",Z=J?"top":"left",X=this._animatingItemsBlocks,Q=0,$=S.length;$>Q;Q++){var et=S[Q];if(et.inCellSpanningGroup){L=!0;break}}var tt=this;return e.Layout._debugAnimations?n._requestAnimationFrame(function(){t()}):t(),this._resetAnimationCaches(!0),y.promise.then(null,function(){_();for(var e=0,t=E.length;t>e;e++){var i=E[e].element;i.style[H.scriptName]="",i.style.opacity=1}for(var e=0,t=S.length;t>e;e++){var i=S[e].element;i.style[H.scriptName]="",i.style.opacity=1}for(var e=0,t=w.length;t>e;e++)w[e].style.opacity=1;for(var e=0,t=I.length;t>e;e++){var i=I[e];i.parentNode&&(d._disposeElement(i),i.parentNode.removeChild(i))}this._animationsRunning=null,y=null,M&&M.cancel()}.bind(this)),y.promise},dragOver:function(e,t,i){var n=this.hitTest(e,t),r=this._groups?this._site.groupIndexFromItemIndex(n.index):0,s=this._site.tree[r].itemsContainer,o=T(s),a=this._groups?this._groups[r].startIndex:0,l=this._getVisibleRange();n.index-=a,n.insertAfterIndex-=a,l.firstIndex=Math.max(l.firstIndex-a-1,0),l.lastIndex=Math.min(l.lastIndex-a+1,o);var c=Math.max(Math.min(o-1,n.insertAfterIndex),-1),u=Math.min(c+1,o);if(i){for(var d=c;d>=l.firstIndex;d--){if(!i._isIncluded(d+a)){c=d;break}d===l.firstIndex&&(c=-1)}for(var d=u;d<l.lastIndex;d++){if(!i._isIncluded(d+a)){u=d;break}d===l.lastIndex-1&&(u=o)}}var h=k(s,u),_=k(s,c);if(this._animatedDragItems)for(var d=0,m=this._animatedDragItems.length;m>d;d++){var p=this._animatedDragItems[d];p&&(p.style[W]=this._site.animationsDisabled?"":U,p.style[H.scriptName]="")}this._animatedDragItems=[];var f="horizontal"===this.orientation,g=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[r]instanceof j.CellSpanningGroup&&(g=1===this._groups[r]._slotsPerColumn);var v=0,y=0;!f&&!g||f&&g?v=this._site.rtl?-V:V:y=V,h&&(h.style[W]=this._site.animationsDisabled?"":U,h.style[H.scriptName]="translate("+v+"px, "+y+"px)",this._animatedDragItems.push(h)),_&&(_.style[W]=this._site.animationsDisabled?"":U,_.style[H.scriptName]="translate("+-v+"px, -"+y+"px)",this._animatedDragItems.push(_))},dragLeave:function(){if(this._animatedDragItems)for(var e=0,t=this._animatedDragItems.length;t>e;e++)this._animatedDragItems[e].style[W]=this._site.animationsDisabled?"":U,this._animatedDragItems[e].style[H.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(e){e===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),e&&(this._itemsPerBar=Math.min(this._itemsPerBar,e)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=e,this._invalidateLayout())},_getItemPosition:function(e){if(this._groupsEnabled){var t=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(e)),i=this._groups[t],n=e-i.startIndex;return this._getItemPositionForAnimations(e,t,n)}return this._getItemPositionForAnimations(e,0,e)},_getRealizationRange:function(){var e=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(e.firstPixel),lastIndex:this._lastItemFromRange(e.lastPixel)}},_getVisibleRange:function(){var e=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(e.firstPixel),lastIndex:this._lastItemFromRange(e.lastPixel)}},_resetAnimationCaches:function(e){if(!e){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var t=Object.keys(this._animatingItemsBlocks),i=0,n=t.length;n>i;i++){var r=this._animatingItemsBlocks[t[i]];r.style.overflow="",r.classList.remove(p._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(e,t,i,n,r){var s="left";this._site.rtl&&(s="right");var o,a;r?(o=this._sizes.headerContainerOuterX,a=this._sizes.headerContainerOuterY):(o=this._sizes.containerMargins[s],a=this._sizes.containerMargins.top);for(var l=0,c=e.length;c>l;l++){var u=e[l];if(-1===u.newIndex){var d=u.element,h=t[u.oldIndex];h&&(h.element=d,delete t[u.oldIndex],d.style.position="absolute",d.style[W]="",d.style.top=h.oldTop-a+"px",d.style[s]=h.oldLeft-o+"px",d.style.width=h.width+"px",d.style.height=h.height+"px",d.style[H.scriptName]="",this._site.surface.appendChild(d),n.push(h)),i[u.oldIndex]&&delete i[u.oldIndex]}}},_cacheInsertedElements:function(e,t,i){for(var n={},r=0,s=e.length;s>r;r++){var o=e[r],a=t[o.oldIndex];if(a&&delete t[o.oldIndex],a||-1===o.oldIndex||o.moved){var l=i[o.newIndex];l&&delete i[o.newIndex];var c=o.element;n[o.newIndex]=c,c.style[W]="",c.style[H.scriptName]="",c.style.opacity=0}}for(var u=Object.keys(t),r=0,s=u.length;s>r;r++)n[u[r]]=t[u[r]];return n},_resetStylesForRecords:function(e){for(var t=Object.keys(e),i=0,n=t.length;n>i;i++){var r=e[t[i]];r.needsToResetTransform&&(r.element.style[H.scriptName]="",r.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(e){for(var t=Object.keys(e),i=0,n=t.length;n>i;i++){var r=e[t[i]];r.style.opacity=1}},_resetStylesForRemovedRecords:function(e){for(var t=0,i=e.length;i>t;t++){var n=e[t].element;n.parentNode&&(d._disposeElement(n),n.parentNode.removeChild(n))}},_updateAnimationCache:function(e,t){function i(e,t){for(var i={},r=0,s=e.length;s>r;r++){var o=e[r],a=t[o.oldIndex];a&&(i[o.newIndex]=a,a.element=o.element,delete t[o.oldIndex])}for(var l=Object.keys(t),r=0,s=l.length;s>r;r++){var c=l[r],u=t[c];(!u.element||n[D(u.element)])&&(i[c]=u)}return i}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var n={},r=this._getRealizationRange(),s=this._site.tree,o=0,a=0,l=s.length;l>o;o++)x(s[o].itemsContainer,function(e){r.firstIndex<=a&&r.lastIndex>=a&&(n[D(e)]=!0),a++});this._cachedItemRecords=i(e,this._cachedItemRecords),this._cachedHeaderRecords=i(t,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(e,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(t,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function e(e,o){for(var a=0,l=e.length;l>a;a++){var c=e[a],u=c.element;c[i]+c[n]-1<r||c[i]>s||!t._site.viewport.contains(u)?u.parentNode&&(d._disposeElement(u),u.parentNode.removeChild(u)):o.push(u)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var t=this,i="horizontal"===this.orientation?"oldLeft":"oldTop",n="horizontal"===this.orientation?"width":"height",r=this._site.scrollbarPos,s=r+this._site.viewportSize[n]-1;e(this._cachedRemovedItems,this._removedElements),e(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function e(e,n){for(var r=Object.keys(e),s=0,o=r.length;o>s;s++){var a=r[s],l=e[a];a<i.firstIndex||a>i.lastIndex||t._site.viewport.contains(l.element)?l.style.opacity=1:n.push(l)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var t=this,i=this._getVisibleRange();e(this._cachedInsertedItemRecords,this._insertedElements),e(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var e=this,t="horizontal"===this.orientation?"oldLeft":"oldTop",i="horizontal"===this.orientation?"left":"top",n="horizontal"===this.orientation?"width":"height",r=this._getRealizationRange(),s=this._site.scrollbarPos,o=s+this._site.viewportSize[n]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var a=this._site.tree,l=0,c=0,u=a.length;u>c;c++){var d=a[c],h=!1;x(d.itemsContainer,function(){if(r.firstIndex<=l&&r.lastIndex>=l){var a=this._cachedItemRecords[l];if(a){var c=(a[t]+a[n]-1>=s&&a[t]<=o||a[i]+a[n]-1>=s&&a[i]<=o)&&e._site.viewport.contains(a.element);c&&(h=!0,a.needsToResetTransform&&(this._itemMoveRecords.push(a),delete this._cachedItemRecords[l]))}}l++}.bind(this));var _=c,m=this._cachedHeaderRecords[_];m&&h&&m.needsToResetTransform&&(this._moveRecords.push(m),delete this._cachedHeaderRecords[_]);var p=this._cachedGroupRecords[D(d.itemsContainer.element)];p&&h&&p.needsToResetTransform&&(this._moveRecords.push(p),delete this._cachedGroupRecords[D(d.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(e,t,i){var n=this._groups[t],r=n.getItemPositionForAnimations(i),s=this._groups[t]?this._groups[t].offset:0,o=this._groupsEnabled&&this._groupHeaderPosition===J.left?this._sizes.headerContainerWidth:0,a=this._groupsEnabled&&this._groupHeaderPosition===J.top?this._sizes.headerContainerHeight:0;return r.left+=this._sizes.layoutOriginX+o+this._sizes.itemsContainerOuterX,r.top+=this._sizes.layoutOriginY+a+this._sizes.itemsContainerOuterY,r[this._horizontal?"left":"top"]+=s,r},_getHeaderPositionForAnimations:function(e){var t;if(this._groupsEnabled){var i=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,n=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==J.left||this._horizontal?this._groupHeaderPosition===J.top&&this._horizontal&&(i=this._groups[e].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):n=this._groups[e].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var r=this._horizontal?this._groups[e].offset:0,s=this._horizontal?0:this._groups[e].offset;t={top:this._sizes.layoutOriginY+s+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+r+this._sizes.headerContainerOuterX,height:n,width:i}}else t={top:0,left:0,height:0,width:0};return t},_rangeContainsItems:function(e,t){if(0===this._groups.length)return!1;var i=this._groups[this._groups.length-1],n=this._sizes.layoutOrigin+i.offset+this._getGroupSize(i)-1;return t>=0&&n>=e},_itemFromOffset:function(e,t){function i(e){if(!t.wholeItem){var i=r._horizontal?r._site.rtl?"right":"left":"top",n=r._horizontal?r._site.rtl?"left":"right":"bottom";return t.last?e-r._sizes.containerMargins[i]:e+r._sizes.containerMargins[n]}return e}function n(e){return t.last?e-r._getHeaderSizeGroupAdjustment()-r._sizes.itemsContainerOuterStart:e}var r=this;if(0===this._groups.length)return 0;t=t||{},e-=this._sizes.layoutOrigin,e=i(e);var s=this._groupFromOffset(n(e)),o=this._groups[s];return e-=o.offset,e-=this._getHeaderSizeGroupAdjustment(),o.startIndex+o.itemFromOffset(e,t)},_firstItemFromRange:function(e,t){return t=t||{},t.last=0,this._itemFromOffset(e,t)},_lastItemFromRange:function(e,t){return t=t||{},t.last=1,this._itemFromOffset(e,t)},_adjustedKeyForRTL:function(e){return this._site.rtl&&(e===L.leftArrow?e=L.rightArrow:e===L.rightArrow&&(e=L.leftArrow)),e},_adjustedKeyForOrientationAndBars:function(e,t){var i=e;if(t)return e;if(!this._horizontal)switch(i){case L.leftArrow:i=L.upArrow;break;case L.rightArrow:i=L.downArrow;break;case L.upArrow:i=L.leftArrow;break;case L.downArrow:i=L.rightArrow}return 1===this._itemsPerBar&&(i===L.upArrow?i=L.leftArrow:i===L.downArrow&&(i=L.rightArrow)),i},_getAdjacentForPageKeys:function(e,t){var i,n=this._sizes.containerMargins,r="horizontal"===this.orientation?n.left+n.right:n.top+n.bottom,s=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],o=this._site.scrollbarPos,a=o+s-1-n["horizontal"===this.orientation?"right":"bottom"],l=this._firstItemFromRange(o,{wholeItem:!0}),c=this._lastItemFromRange(a,{wholeItem:!1}),u=this._getItemPosition(e.index),d=!1;if((e.index<l||e.index>c)&&(d=!0,o="horizontal"===this.orientation?u.left-r:u.top-r,a=o+s-1,l=this._firstItemFromRange(o,{wholeItem:!0}),c=this._lastItemFromRange(a,{wholeItem:!1})),t===L.pageUp){if(!d&&l!==e.index)return{type:m.ObjectType.item,index:l};var h;h="horizontal"===this.orientation?u.left+u.width+r+n.left:u.top+u.height+r+n.bottom;var _=this._firstItemFromRange(h-s,{wholeItem:!0});i=e.index===_?Math.max(0,e.index-this._itemsPerBar):_}else{if(!d&&c!==e.index)return{type:m.ObjectType.item,index:c};var p;p="horizontal"===this.orientation?u.left-r-n.right:u.top-r-n.bottom;var f=Math.max(0,this._lastItemFromRange(p+s-1,{wholeItem:!0}));i=e.index===f?e.index+this._itemsPerBar:f}return{type:m.ObjectType.item,index:i}},_isCellSpanning:function(e){var t=this._site.groupFromIndex(e),i=this._groupInfo;return i?!!("function"==typeof i?i(t):i).enableCellSpanning:!1},_getGroupInfo:function(e){var t=this._site.groupFromIndex(e),i=this._groupInfo,n=this._sizes.containerMargins,s={enableCellSpanning:!1};if(i="function"==typeof i?i(t):i){if(i.enableCellSpanning&&(+i.cellWidth!==i.cellWidth||+i.cellHeight!==i.cellHeight))throw new r("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",O.groupInfoResultIsInvalid);s={enableCellSpanning:!!i.enableCellSpanning,cellWidth:i.cellWidth+n.left+n.right,cellHeight:i.cellHeight+n.top+n.bottom}}return s},_getItemInfo:function(e){var t;if(this._itemInfo&&"function"==typeof this._itemInfo)t=this._itemInfo(e);else{if(!this._useDefaultItemInfo)throw new r("WinJS.UI.GridLayout.ItemInfoIsInvalid",O.itemInfoIsInvalid);t=this._defaultItemInfo(e)}return l.as(t).then(function(e){if(!e||+e.width!==e.width||+e.height!==e.height)throw new r("WinJS.UI.GridLayout.ItemInfoIsInvalid",O.itemInfoIsInvalid);return e})},_defaultItemInfo:function(e){var t=this;return this._site.renderItem(this._site.itemFromIndex(e)).then(function(i){return t._elementsToMeasure[e]={element:i},t._measureElements()}).then(function(){var i=t._elementsToMeasure[e],n={width:i.width,height:i.height};return delete t._elementsToMeasure[e],n},function(i){return delete t._elementsToMeasure[e],l.wrapError(i)})},_getGroupSize:function(e){var t=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===J.top?t=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==J.left||(t=this._sizes.headerContainerMinHeight)),Math.max(t,e.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(e){return e<this._groups[0].offset?0:this._groupFrom(function(t){return e<t.offset})},_groupFromImpl:function(e,t,i){if(e>t)return null;var n=e+Math.floor((t-e)/2),r=this._groups[n];return i(r,n)?this._groupFromImpl(e,n-1,i):t>n&&!i(this._groups[n+1],n+1)?this._groupFromImpl(n+1,t,i):n},_groupFrom:function(e){if(this._groups.length>0){var t=this._groups.length-1,i=this._groups[t];return e(i,t)?this._groupFromImpl(0,this._groups.length-1,e):t}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(h.removeClass(this._site.surface,this._containerSizeClassName),b(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var e=this;e._measuringElements=c.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){e._site._writeProfilerMark("_measureElements,StartTM");var i=e._createMeasuringSurface(),n=t.document.createElement("div"),r=e._site,s=e._measuringElements,o=e._elementsToMeasure,a=!1;n.className=p._itemsContainerClass+" "+p._laidOutClass,n.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var l,c,u=Object.keys(o);for(c=0,l=u.length;l>c;c++){var d=o[u[c]].element;d.style["-ms-grid-column"]=c+1,d.style["-ms-grid-row"]=c+1,n.appendChild(d)}for(i.appendChild(n),r.viewport.insertBefore(i,r.viewport.firstChild),s.then(null,function(){a=!0}),c=0,l=u.length;l>c&&!a;c++){var _=o[u[c]],m=_.element.querySelector("."+p._itemClass);_.width=h.getTotalWidth(m),_.height=h.getTotalHeight(m)}i.parentNode&&i.parentNode.removeChild(i),s===e._measuringElements&&(e._measuringElements=null),r._writeProfilerMark("_measureElements,StopTM")},function(t){return e._measuringElements=null,l.wrapError(t)})}return this._measuringElements},_ensureEnvInfo:function(){return this._envInfo||(this._envInfo=A(this._site),this._envInfo&&!this._envInfo.supportsCSSGrid&&h.addClass(this._site.surface,p._noCSSGrid)),!!this._envInfo},_createMeasuringSurface:function(){var e=t.document.createElement("div");return e.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto;-ms-flex-align: start;-webkit-align-items: flex-start;align-items: flex-start",e.className=p._scrollableClass+" "+(this._inListMode?p._listLayoutClass:p._gridLayoutClass),this._envInfo.supportsCSSGrid||h.addClass(e,p._noCSSGrid),this._groupsEnabled&&(this._groupHeaderPosition===J.top?h.addClass(e,p._headerPositionTopClass):h.addClass(e,p._headerPositionLeftClass)),e
},_measureItem:function(e){function i(e,r){var r,a=!!r,c={},u=s.rtl?"right":"left";return s.itemCount.then(function(t){return!t||n._groupsEnabled&&!s.groupCount?l.cancel:(r=r||s.itemFromIndex(e),c.container=s.renderItem(r),n._groupsEnabled&&(c.headerContainer=s.renderHeader(n._site.groupFromIndex(s.groupIndexFromItemIndex(e)))),l.join(c))}).then(function(c){function d(){var e=n._horizontal,t=n._groupsEnabled,i=!1;o.then(null,function(){i=!0});var r=B(P),a=s.rtl?s.viewport.offsetWidth-(P.offsetLeft+P.offsetWidth):P.offsetLeft,l=P.offsetTop,d={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:S(m),surfaceOuterWidth:E(m),layoutOriginX:a-r[u],layoutOriginY:l-r.top,itemsContainerOuterHeight:S(f),itemsContainerOuterWidth:E(f),itemsContainerOuterX:I(s.rtl?"Right":"Left",f),itemsContainerOuterY:I("Top",f),itemsContainerMargins:B(f),itemBoxOuterHeight:S(v),itemBoxOuterWidth:E(v),containerOuterHeight:S(c.container),containerOuterWidth:E(c.container),emptyContainerContentHeight:h.getContentHeight(g),emptyContainerContentWidth:h.getContentWidth(g),containerMargins:B(c.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};t&&(d.headerContainerOuterX=I(s.rtl?"Right":"Left",c.headerContainer),d.headerContainerOuterY=I("Top",c.headerContainer),d.headerContainerOuterWidth=E(c.headerContainer),d.headerContainerOuterHeight=S(c.headerContainer),d.headerContainerWidth=h.getTotalWidth(c.headerContainer),d.headerContainerHeight=h.getTotalHeight(c.headerContainer),d.headerContainerMinWidth=w(c.headerContainer,"minWidth")+d.headerContainerOuterWidth,d.headerContainerMinHeight=w(c.headerContainer,"minHeight")+d.headerContainerOuterHeight);var _={sizes:d,viewportContentWidth:h.getContentWidth(s.viewport),viewportContentHeight:h.getContentHeight(s.viewport),containerContentWidth:h.getContentWidth(c.container),containerContentHeight:h.getContentHeight(c.container),containerWidth:h.getTotalWidth(c.container),containerHeight:h.getTotalHeight(c.container)};return _.viewportCrossSize=_[e?"viewportContentHeight":"viewportContentWidth"],s.readyToMeasure(),i?null:_}function _(){m.parentNode&&m.parentNode.removeChild(m)}var m=n._createMeasuringSurface(),f=t.document.createElement("div"),g=t.document.createElement("div"),v=c.container.querySelector("."+p._itemBoxClass),y=s.groupIndexFromItemIndex(e);g.className=p._containerClass,f.className=p._itemsContainerClass+" "+p._laidOutClass;var b=1,C=1,x=2,k=2,P=f,T=!1;n._inListMode&&n._groupsEnabled&&(n._horizontal&&n._groupHeaderPosition===J.top?(b=2,k=1,x=1,P=c.headerContainer,T=!0):n._horizontal||n._groupHeaderPosition!==J.left||(C=2,k=1,x=1,P=c.headerContainer,T=!0)),f.style.cssText+=";display: "+(n._inListMode?(n._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+C+";-ms-grid-row: "+b,n._inListMode||(c.container.style.display="inline-block"),n._groupsEnabled&&(c.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+k+";-ms-grid-row: "+x,h.addClass(c.headerContainer,p._laidOutClass+" "+p._groupLeaderClass),(n._groupHeaderPosition===J.top&&n._horizontal||n._groupHeaderPosition===J.left&&!n._horizontal)&&h.addClass(f,p._groupLeaderClass)),T&&m.appendChild(c.headerContainer),f.appendChild(c.container),f.appendChild(g),m.appendChild(f),!T&&n._groupsEnabled&&m.appendChild(c.headerContainer),s.viewport.insertBefore(m,s.viewport.firstChild);var A=d();if(!A)return _(),l.cancel;if(n._horizontal&&0===A.viewportContentHeight||!n._horizontal&&0===A.viewportContentWidth)return _(),l.cancel;if(!(a||n._isCellSpanning(y)||0!==A.containerContentWidth&&0!==A.containerContentHeight))return _(),r.then(function(){return i(e,r)});var M=n._sizes=A.sizes;if(Object.defineProperties(M,{surfaceOuterCrossSize:{get:function(){return n._horizontal?M.surfaceOuterHeight:M.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return n._horizontal?M.layoutOriginX:M.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return n._horizontal?M.itemsContainerOuterWidth:M.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return n._horizontal?M.itemsContainerOuterHeight:M.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return n._horizontal?M.itemsContainerOuterX:M.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return n._horizontal?M.itemsContainerOuterY:M.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return n._horizontal?M.containerHeight:M.containerWidth},enumerable:!0},containerSize:{get:function(){return n._horizontal?M.containerWidth:M.containerHeight},enumerable:!0}}),!n._isCellSpanning(y)){if(n._inListMode){var L=A.viewportCrossSize-M.surfaceOuterCrossSize-n._getHeaderSizeContentAdjustment()-M.itemsContainerOuterCrossSize;n._horizontal?(M.containerHeight=L,M.containerWidth=A.containerWidth):(M.containerHeight=A.containerHeight,M.containerWidth=L)}else M.containerWidth=A.containerWidth,M.containerHeight=A.containerHeight;M.containerSizeLoaded=!0}n._createContainerStyleRule(),n._viewportSizeChanged(A.viewportCrossSize),_()})}var n=this,r="Layout:measureItem",s=n._site,o=n._measuringPromise;if(!o){s._writeProfilerMark(r+",StartTM");var a=new u;n._measuringPromise=o=a.promise.then(function(){return n._ensureEnvInfo()?i(e):l.cancel}).then(function(){s._writeProfilerMark(r+":complete,info"),s._writeProfilerMark(r+",StopTM")},function(e){return n._measuringPromise=null,s._writeProfilerMark(r+":canceled,info"),s._writeProfilerMark(r+",StopTM"),l.wrapError(e)}),a.complete()}return o},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===J.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===J.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===J.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===J.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(e){var t=this._sizes;t.viewportContentSize=e,t.surfaceContentSize=e-t.surfaceOuterCrossSize,t.maxItemsContainerContentSize=t.surfaceContentSize-t.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),t.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(t.maxItemsContainerContentSize/t.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(t[this._horizontal?"containerHeight":"containerWidth"]=t.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var e=this._sizes;if(!this._containerSizeClassName&&e.containerSizeLoaded&&(0===e.emptyContainerContentHeight||0===e.emptyContainerContentWidth)){var t=e.containerWidth-e.containerOuterWidth+"px",i=e.containerHeight-e.containerOuterHeight+"px";this._inListMode&&(this._horizontal?i="calc(100% - "+(e.containerMargins.top+e.containerMargins.bottom)+"px)":t="auto"),this._containerSizeClassName||(this._containerSizeClassName=g("containersize"),h.addClass(this._site.surface,this._containerSizeClassName));var n="."+p._containerClass,r="width:"+t+";height:"+i+";";y(this._containerSizeClassName,this._site,n,r)}},_ensureContainerSize:function(e){var t=this._sizes;if(t.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:l.wrap();var i;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)i=this._getItemInfo();else{var n=t.containerMargins;i=l.wrap({width:e.groupInfo.cellWidth-n.left-n.right,height:e.groupInfo.cellHeight-n.top-n.bottom})}var r=this;return this._ensuringContainerSize=i.then(function(e){t.containerSizeLoaded=!0,t.containerWidth=e.width+t.itemBoxOuterWidth+t.containerOuterWidth,t.containerHeight=e.height+t.itemBoxOuterHeight+t.containerOuterHeight,r._inListMode?r._itemsPerBar=1:(r._itemsPerBar=Math.floor(t.maxItemsContainerContentSize/t.containerCrossSize),r.maximumRowsOrColumns&&(r._itemsPerBar=Math.min(r._itemsPerBar,r.maximumRowsOrColumns)),r._itemsPerBar=Math.max(1,r._itemsPerBar)),r._createContainerStyleRule()}),i.done(function(){r._ensuringContainerSize=null},function(){r._ensuringContainerSize=null}),i},_indexToCoordinate:function(e,t){t=t||this._itemsPerBar;var i=Math.floor(e/t);return this._horizontal?{column:i,row:e-i*t}:{row:i,column:e-i*t}},_rangeForGroup:function(e,t){var i=e.startIndex,n=i+e.count-1;return!t||t.firstIndex>n||t.lastIndex<i?null:{firstIndex:Math.max(0,t.firstIndex-i),lastIndex:Math.min(e.count-1,t.lastIndex-i)}},_syncDomWithGroupHeaderPosition:function(e){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var t,i=e.length;if(this._oldGroupHeaderPosition===J.top)if(h.removeClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)e[t].header.style.maxWidth="",h.removeClass(e[t].itemsContainer.element,p._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===J.left){if(h.removeClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)e[t].header.style.maxHeight="",h.removeClass(e[t].itemsContainer.element,p._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===J.top){if(h.addClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)h.addClass(e[t].itemsContainer.element,p._groupLeaderClass)}else if(h.addClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)h.addClass(e[t].itemsContainer.element,p._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(e){var t=this._groups[e],i=this._site.tree[e],n=i.header,r=i.itemsContainer.element,s=this._sizes,o=t.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===J.top){var a=s.headerContainerMinWidth-s.headerContainerOuterWidth,l=t.getItemsContainerSize()-s.headerContainerOuterWidth;n.style.maxWidth=Math.max(a,l)+"px",this._envInfo.supportsCSSGrid?(n.style.msGridColumn=e+1,r.style.msGridColumn=e+1):(n.style.height=s.headerContainerHeight-s.headerContainerOuterHeight+"px",r.style.height=o-s.itemsContainerOuterHeight+"px",r.style.marginBottom=s.itemsContainerMargins.bottom+(s.maxItemsContainerContentSize-o+s.itemsContainerOuterHeight)+"px"),h.addClass(r,p._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(n.style.msGridColumn=2*e+1,r.style.msGridColumn=2*e+2):(n.style.width=s.headerContainerWidth-s.headerContainerOuterWidth+"px",n.style.height=o-s.headerContainerOuterHeight+"px",r.style.height=o-s.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===J.left){var c=s.headerContainerMinHeight-s.headerContainerOuterHeight,u=t.getItemsContainerSize()-s.headerContainerOuterHeight;n.style.maxHeight=Math.max(c,u)+"px",this._envInfo.supportsCSSGrid?(n.style.msGridRow=e+1,r.style.msGridRow=e+1):(n.style.width=s.headerContainerWidth-s.headerContainerOuterWidth+"px",r.style.width=o-s.itemsContainerOuterWidth+"px",r.style["margin"+(this._site.rtl?"Left":"Right")]=s.itemsContainerMargins[this._site.rtl?"left":"right"]+(s.maxItemsContainerContentSize-o+s.itemsContainerOuterWidth)+"px"),h.addClass(r,p._groupLeaderClass)}else n.style.msGridRow=2*e+1,this._inListMode?n.style.height=s.headerContainerHeight-s.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?r.style.msGridRow=2*e+2:(n.style.height=s.headerContainerHeight-s.headerContainerOuterHeight+"px",n.style.width=o-s.headerContainerOuterWidth+"px",r.style.width=o-s.itemsContainerOuterWidth+"px");h.addClass(n,p._laidOutClass+" "+p._groupLeaderClass)}h.addClass(r,p._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(e){if(h._deprecated(f.disableBackdropIsDeprecated),e=!!e,this._backdropDisabled!==e&&(this._backdropDisabled=e,this._disableBackdropClassName&&(b(this._disableBackdropClassName),this._site&&h.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=g("disablebackdrop"),this._site&&h.addClass(this._site.surface,this._disableBackdropClassName),e)){var t=".win-container.win-backdrop",i="background-color:transparent;";y(this._disableBackdropClassName,this._site,t,i)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(e){if(h._deprecated(f.backdropColorIsDeprecated),e&&this._backdropColor!==e){this._backdropColor=e,this._backdropColorClassName&&(b(this._backdropColorClassName),this._site&&h.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=g("backdropcolor"),this._site&&h.addClass(this._site.surface,this._backdropColorClassName);var t=".win-container.win-backdrop",i="background-color:"+e+";";y(this._backdropColorClassName,this._site,t,i)}}}})}),GridLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LegacyLayout,function(e){e=e||{},this.itemInfo=e.itemInfo,this.groupInfo=e.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=e.groupHeaderPosition||J.top,this.orientation=e.orientation||"horizontal",e.maxRows&&(this.maxRows=+e.maxRows),e.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+e.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(e){this._setMaxRowsOrColumns(e)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(e){h._deprecated(f.maxRowsIsDeprecated),this.maximumRowsOrColumns=e}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(e){e&&h._deprecated(f.itemInfoIsDeprecated),this._itemInfo=e,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(e){e&&h._deprecated(f.groupInfoIsDeprecated),this._groupInfo=e,this._invalidateLayout()}}})})});var j=i.Namespace.defineWithParent(null,null,{UniformGroupBase:i.Namespace._lazy(function(){return i.Class.define(null,{cleanUp:function(){},itemFromOffset:function(e,t){t=t||{};var i=this._layout._sizes;e-=i.itemsContainerOuterStart,t.wholeItem&&(e+=(t.last?-1:1)*(i.containerSize-1));var n=this.count-1,r=Math.floor(n/this._layout._itemsPerBar),s=C(0,r,Math.floor(e/i.containerSize)),o=(s+t.last)*this._layout._itemsPerBar-t.last;return C(0,this.count-1,o)},hitTest:function(e,t){var i=this._layout._horizontal,n=this._layout._itemsPerBar,r=this._layout._inListMode||1===n,s=i?e:t,o=i?t:e,a=this._layout._sizes;s-=a.itemsContainerOuterStart,o-=a.itemsContainerOuterCrossStart;var l,c=Math.floor(s/a.containerSize),u=C(0,n-1,Math.floor(o/a.containerCrossSize)),d=Math.max(-1,c*n+u);if(l=!i&&r||i&&!r?(t-a.containerHeight/2)/a.containerHeight:(e-a.containerWidth/2)/a.containerWidth,r)return l=Math.floor(l),{index:d,insertAfterIndex:l>=0&&d>=0?l:-1};l=C(-1,n-1,l);var h;return h=0>l?c*n-1:c*n+Math.floor(l),{index:C(-1,this.count-1,d),insertAfterIndex:C(-1,this.count-1,h)}},getAdjacent:function(e,t){var i,n=e.index,r=Math.floor(n/this._layout._itemsPerBar),s=n%this._layout._itemsPerBar;switch(t){case L.upArrow:i=0===s?"boundary":n-1;break;case L.downArrow:var o=n===this.count-1,a=this._layout._itemsPerBar>1&&s===this._layout._itemsPerBar-1;i=o||a?"boundary":n+1;break;case L.leftArrow:i=0===r&&this._layout._itemsPerBar>1?"boundary":n-this._layout._itemsPerBar;break;case L.rightArrow:var l=this.count-1,c=Math.floor(l/this._layout._itemsPerBar);i=r===c?"boundary":Math.min(n+this._layout._itemsPerBar,this.count-1)}return"boundary"===i?i:{type:m.ObjectType.item,index:i}},getItemsContainerSize:function(){var e=this._layout._sizes,t=Math.ceil(this.count/this._layout._itemsPerBar);return t*e.containerSize+e.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var e=this._layout._sizes;return this._layout._itemsPerBar*e.containerCrossSize+e.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(e){var t=this._layout._sizes,i=this._layout._site.rtl?"right":"left",n=this._layout._sizes.containerMargins,r=this._layout._indexToCoordinate(e),s={row:r.row,column:r.column,top:n.top+r.row*t.containerHeight,left:n[i]+r.column*t.containerWidth,height:t.containerHeight-t.containerMargins.top-t.containerMargins.bottom,width:t.containerWidth-t.containerMargins.left-t.containerMargins.right};return s}})}),UniformGroup:i.Namespace._lazy(function(){return i.Class.derive(j.UniformGroupBase,function(e,t){this._layout=e,this._itemsContainer=t,h.addClass(this._itemsContainer,e._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(e){e||(h.removeClass(this._itemsContainer,p._uniformGridLayoutClass),h.removeClass(this._itemsContainer,p._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(e,t,i,n){return this.groupInfo=n.groupInfo,this.startIndex=n.startIndex,this.count=e,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var e=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-e.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?e.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*e.containerCrossSize+"px"},layoutUnrealizedRange:function(){return l.wrap()}})}),UniformFlowGroup:i.Namespace._lazy(function(){return i.Class.derive(j.UniformGroupBase,function(e,t){this._layout=e,this._itemsContainer=t.element,h.addClass(this._itemsContainer,e._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(e){e||(h.removeClass(this._itemsContainer,p._uniformListLayoutClass),h.removeClass(this._itemsContainer,p._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:i.Namespace._lazy(function(){return i.Class.define(function(e,t){this._layout=e,this._itemsContainer=t,h.addClass(this._itemsContainer,p._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(e){e||(this._cleanContainers(),h.removeClass(this._itemsContainer,p._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(e,t,i,n){var r,s=this;if(this._containersToHide={},t)for(r=t.firstIndex;r<=t.lastIndex;r++)this._containersToHide[D(i._items[r])]=i._items[r];this.groupInfo=n.groupInfo,this.startIndex=n.startIndex,this.count=e.items.length,this._items=e.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var o=new Array(this.count);for(r=0;r<this.count;r++)o[r]=this._layout._getItemInfo(this.startIndex+r);return l.join(o).then(function(e){e.forEach(function(e,t){s.addItemToMap(t,e)})})},layoutRealizedRange:function(e,t){if(t){var i,n=Math.max(e,t.firstIndex);for(i=n;i<=t.lastIndex;i++)this._layoutItem(i),delete this._containersToHide[D(this._items[i])]}Object.keys(this._containersToHide).forEach(function(e){h.removeClass(this._containersToHide[e],p._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(e,t,i){var n,r=this;return r._layoutPromise=new l(function(s){function o(){n=null,s()}function a(e){return c.schedule(e,c.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(t){var l=!1,u=t.firstIndex-1,d=Math.max(e,t.lastIndex+1);d=Math.max(u+1,d),n=a(function _(t){for(;!l;){if(t.shouldYield)return void t.setWork(_);l=!0,u>=e&&(r._layoutItem(u),u--,l=!1),d<r.count&&(r._layoutItem(d),d++,l=!1)}o()})}else if(i){var h=r.count-1;n=a(function m(t){for(;h>=e;h--){if(t.shouldYield)return void t.setWork(m);r._layoutItem(h)}o()})}else{var h=e;n=a(function p(e){for(;h<r.count;h++){if(e.shouldYield)return void e.setWork(p);r._layoutItem(h)}o()})}},function(){n&&n.cancel(),n=null}),r._layoutPromise},itemFromOffset:function(e,t){t=t||{};var i=this._layout._sizes,n=i.containerMargins;e-=i.itemsContainerOuterX,e-=(t.last?1:-1)*n[t.last?"left":"right"];var r=this.indexFromOffset(e,t.wholeItem,t.last).item;return C(0,this.count-1,r)},getAdjacent:function(e,t){var i,n;i=n=e.index;var r,s,o;o=this.lastAdjacent===i?this.lastInMapIndex:this.findItem(i);do{var a=Math.floor(o/this._slotsPerColumn),l=o-a*this._slotsPerColumn,c=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(t){case L.upArrow:if(!(l>0))return{type:m.ObjectType.item,index:n};o--;break;case L.downArrow:if(!(l+1<this._slotsPerColumn))return{type:m.ObjectType.item,index:n};o++;break;case L.leftArrow:o=a>0?o-this._slotsPerColumn:-1;break;case L.rightArrow:o=c>a?o+this._slotsPerColumn:this.occupancyMap.length}s=o>=0&&o<this.occupancyMap.length,s&&(r=this.occupancyMap[o]?this.occupancyMap[o].index:void 0)}while(s&&(i===r||void 0===r));return this.lastAdjacent=r,this.lastInMapIndex=o,s?{type:m.ObjectType.item,index:r}:"boundary"},hitTest:function(e,t){var i=this._layout._sizes,n=0;if(e-=i.itemsContainerOuterX,t-=i.itemsContainerOuterY,this.occupancyMap.length>0){for(var r=this.indexFromOffset(e,!1,0),s=Math.min(this._slotsPerColumn-1,Math.floor(t/this.groupInfo.cellHeight)),o=r.index,a=o;s-->0;)o++,this.occupancyMap[o]&&(a=o);this.occupancyMap[a]||a--,n=this.occupancyMap[a].index}var l=this.getItemSize(n),c=l.column*this.groupInfo.cellWidth,u=l.row*this.groupInfo.cellHeight,d=1===this._slotsPerColumn,h=n;return(d&&e<c+l.contentWidth/2||!d&&t<u+l.contentHeight/2)&&h--,{type:m.ObjectType.item,index:C(0,this.count-1,n),insertAfterIndex:C(-1,this.count-1,h)}},getItemsContainerSize:function(){var e=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+e.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var e=this._layout._sizes;return e.maxItemsContainerContentSize+e.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(e){var t=this._layout._site.rtl?"right":"left",i=this._layout._sizes.containerMargins,n=this.getItemSize(e),r=this.groupInfo,s={row:n.row,column:n.column,top:i.top+n.row*r.cellHeight,left:i[t]+n.column*r.cellWidth,height:n.contentHeight,width:n.contentWidth};return s},_layoutItem:function(e){var t=this.getItemSize(e);return this._items[e].style.cssText+=";-ms-grid-row:"+(t.row+1)+";-ms-grid-column:"+(t.column+1)+";-ms-grid-row-span:"+t.rows+";-ms-grid-column-span:"+t.columns+";height:"+t.contentHeight+"px;width:"+t.contentWidth+"px",h.addClass(this._items[e],p._laidOutClass),this._items[e]},_cleanContainers:function(){var e,t=this._items,i=t.length;for(e=0;i>e;e++)t[e].style.cssText="",h.removeClass(t[e],p._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var e=-1;return this.occupancyMap.forEach(function(t){t.index>e&&(e=t.index)}),e+1},coordinateToIndex:function(e,t){return e*this._slotsPerColumn+t},markSlotAsFull:function(e,t){for(var i=this._layout._indexToCoordinate(e,this._slotsPerColumn),n=i.row+t.rows,r=i.row;n>r&&r<this._slotsPerColumn;r++)for(var s=i.column,o=i.column+t.columns;o>s;s++)this.occupancyMap[this.coordinateToIndex(s,r)]=t;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,n-this._slotsPerColumn)},isSlotEmpty:function(e,t,i){for(var n=t,r=t+e.rows;r>n;n++)for(var s=i,o=i+e.columns;o>s;s++)if(n>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(s,n)])return!1;return!0},findEmptySlot:function(e,t,i){var n=this._layout._indexToCoordinate(e,this._slotsPerColumn),r=n.row,s=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(i){for(var o=n.column+1;s>=o;o++)if(this.isSlotEmpty(t,0,o))return this.coordinateToIndex(o,0)}else for(var o=n.column;s>=o;o++){for(var a=r;a<this._slotsPerColumn;a++)if(this.isSlotEmpty(t,a,o))return this.coordinateToIndex(o,a);r=0}return(s+1)*this._slotsPerColumn},findItem:function(e){for(var t=e,i=this.occupancyMap.length;i>t;t++){var n=this.occupancyMap[t];if(n&&n.index===e)return t}return t},getItemSize:function(e){var t=this.findItem(e),i=this.occupancyMap[t],n=this._layout._indexToCoordinate(t,this._slotsPerColumn);return e===i.index?{row:n.row,column:n.column,contentWidth:i.contentWidth,contentHeight:i.contentHeight,columns:i.columns,rows:i.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(e,t){function i(e,t){var i=n.findEmptySlot(n.lastAdded,e,t);n.lastAdded=i,n.markSlotAsFull(i,e)}var n=this,r=n.groupInfo,s=n._layout._sizes.containerMargins,o={index:e,contentWidth:t.width,contentHeight:t.height,columns:Math.max(1,Math.ceil((t.width+s.left+s.right)/r.cellWidth)),rows:Math.max(1,Math.ceil((t.height+s.top+s.bottom)/r.cellHeight))};i(o,t.newColumn)},indexFromOffset:function(e,t,i){var n=0,r=0,s=this.groupInfo,o=0;if(this.occupancyMap.length>0){if(r=this.getOccupancyMapItemCount()-1,n=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*s.cellWidth,n>e){for(var a=this._slotsPerColumn,o=(Math.max(0,Math.floor(e/s.cellWidth))+i)*this._slotsPerColumn-i;!this.occupancyMap[o]&&a-->0;)o+=i>0?-1:1;return{index:o,item:this.occupancyMap[o].index}}o=this.occupancyMap.length-1}return{index:o,item:r+(Math.max(0,Math.floor((e-n)/s.cellWidth))+i)*this._slotsPerColumn-i}}})})});i.Namespace._moduleDefine(e,"WinJS.UI",{ListLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LegacyLayout,function(e){e=e||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=e.groupHeaderPosition||J.top,this._inListMode=!0,this.orientation=e.orientation||"vertical"},{initialize:function(t,i){h.addClass(t.surface,p._listLayoutClass),e._LegacyLayout.prototype.initialize.call(this,t,i)},uninitialize:function(){this._site&&h.removeClass(this._site.surface,p._listLayoutClass),e._LegacyLayout.prototype.uninitialize.call(this)},layout:function(t,i,n,r){return this._groupsEnabled||this._horizontal?e._LegacyLayout.prototype.layout.call(this,t,i,n,r):this._layoutNonGroupedVerticalList(t,i,n,r)},_layoutNonGroupedVerticalList:function(e,t,i,n){var r=this,s="Layout:_layoutNonGroupedVerticalList";return r._site._writeProfilerMark(s+",StartTM"),this._layoutPromise=r._measureItem(0).then(function(){h[r._usingStructuralNodes?"addClass":"removeClass"](r._site.surface,p._structuralNodesClass),r._sizes.viewportContentSize!==r._getViewportCrossSize()&&r._viewportSizeChanged(r._getViewportCrossSize()),r._cacheRemovedElements(i,r._cachedItemRecords,r._cachedInsertedItemRecords,r._cachedRemovedItems,!1),r._cacheRemovedElements(n,r._cachedHeaderRecords,r._cachedInsertedHeaderRecords,r._cachedRemovedHeaders,!0);var t=e[0].itemsContainer,o=new j.UniformFlowGroup(r,t);r._groups=[o],o.groupInfo={enableCellSpanning:!1},o.startIndex=0,o.count=T(t),o.offset=0,o.layout(),r._site._writeProfilerMark(s+":setSurfaceWidth,info"),r._site.surface.style.width=r._sizes.surfaceContentSize+"px",r._layoutAnimations(i,n),r._site._writeProfilerMark(s+":complete,info"),r._site._writeProfilerMark(s+",StopTM")},function(e){return r._site._writeProfilerMark(s+":canceled,info"),r._site._writeProfilerMark(s+",StopTM"),l.wrapError(e)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){var t=this;return this._measureItem(0).then(function(){return t._usingStructuralNodes=t._envInfo.nestedFlexTooLarge||t._envInfo.nestedFlexTooSmall?!1:e.ListLayout._numberOfItemsPerItemsBlock>0,t._usingStructuralNodes?e.ListLayout._numberOfItemsPerItemsBlock:null})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LayoutCommon,function(e){e=e||{},this._itemInfo=e.itemInfo,this._groupInfo=e.groupInfo,this._groupHeaderPosition=e.groupHeaderPosition||J.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(e){this._setMaxRowsOrColumns(e)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(e){this._itemInfo=e,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(e){this._groupInfo=e,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:i.Namespace._lazy(function(){return i.Class.define(function(e){this.defaultAnimations=!0,this.initialize=function(t,i){e.initialize(t,i)},this.hitTest=function(t,i){return e.hitTest(t,i)},e.uninitialize&&(this.uninitialize=function(){e.uninitialize()}),"numberOfItemsPerItemsBlock"in e&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return e.numberOfItemsPerItemsBlock}}),e._getItemPosition&&(this._getItemPosition=function(t){return e._getItemPosition(t)}),e.itemsFromRange&&(this.itemsFromRange=function(t,i){return e.itemsFromRange(t,i)}),e.getAdjacent&&(this.getAdjacent=function(t,i){return e.getAdjacent(t,i)}),e.dragOver&&(this.dragOver=function(t,i,n){return e.dragOver(t,i,n)}),e.dragLeave&&(this.dragLeave=function(){return e.dragLeave()});var t={enumerable:!0,get:function(){return"vertical"}};if(void 0!==e.orientation&&(t.get=function(){return e.orientation},t.set=function(t){e.orientation=t}),Object.defineProperty(this,"orientation",t),(e.setupAnimations||e.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return e.setupAnimations()},this.executeAnimations=function(){return e.executeAnimations()}),e.layout)if(this.defaultAnimations){var i=this;this.layout=function(t,n,r,s){var o,a=M(e.layout(t,n,[],[]));return a.realizedRangeComplete.then(function(){o=!0}),o&&i._layoutAnimations(r,s),a}}else this.layout=function(t,i,n,r){return M(e.layout(t,i,n,r))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(e,t,i,n){return this.defaultAnimations&&this._layoutAnimations(i,n),M()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(e,t){switch(t){case L.pageUp:case L.upArrow:case L.leftArrow:return{type:e.type,index:e.index-1};case L.downArrow:case L.rightArrow:case L.pageDown:return{type:e.type,index:e.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})});var J={left:"left",top:"top"};
i.Namespace._moduleDefine(e,"WinJS.UI",{HeaderPosition:J,_getMargins:B})}),define("WinJS/Controls/ListView/_VirtualizeContentsView",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_Helpers","./_ItemsContainer"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m){"use strict";function p(e,t){l._setAttribute(e,"aria-flowto",t.id),l._setAttribute(t,"x-ms-aria-flowfrom",e.id)}i.Namespace._moduleDefine(e,"WinJS.UI",{_VirtualizeContentsView:i.Namespace._lazy(function(){function e(t){for(var i,n=t.job._workItems;n.length&&!t.shouldYield;)(i=n.shift())();t.setWork(e),n.length||t.job.pause()}function f(t,i){var n=o.schedule(e,t,null,i);return n._workItems=[],n.addWork=function(e,t){t?this._workItems.unshift(e):this._workItems.push(e),this.resume()},n.clearWork=function(){this._workItems.length=0},n.dispose=function(){this.cancel(),this._workItems.length=0},n}function g(e){return e._zooming||e._pinching}function v(e,t){return e._isZombie()?r.wrap():g(e)?(+t!==t&&(t=C._waitForSeZoTimeoutDuration),r.timeout(C._waitForSeZoIntervalDuration).then(function(){return t-=C._waitForSeZoIntervalDuration,0>=t?!0:v(e,t)})):r.wrap()}function y(e){if("number"==typeof e){var t=e;e=function(){return{position:t,direction:"right"}}}return e}function b(){}var C=i.Class.define(function(e){this._listView=e,this._forceRelayout=!1,this.items=new m._ItemsContainer(e),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=r.wrap(),this._state=new w(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=f(o.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=f(o.Priority.normal,"front off-screen items"),this._backOffscreenJob=f(o.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=y(0)},{_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(e,t,i,n){this._listView._writeProfilerMark("createItem("+e+") "+this._getBoundingRectString(e)+",info");var s=this;s._listView._itemsManager._itemFromItemPromiseThrottled(t).done(function(t){t?i(e,t,s._listView._itemsManager._recordFromElement(t)):n(e)},function(t){return n(e),r.wrapError(t)})},_addItem:function(e,t,i,n){if(this._realizePass===n){var r=this._listView._itemsManager._recordFromElement(i);delete this._pendingItemPromises[r.itemPromise.handle],this.items.setItemAt(t,{itemBox:null,container:null,element:i,detached:!0,itemsManagerRecord:r})}},finalItem:function(){return this.containers?r.wrap(this.containers.length-1):r.cancel},_setSkipRealizationForChange:function(e){e?this._realizationLevel!==C._realizationLevel.realize&&(this._realizationLevel=C._realizationLevel.skip):this._realizationLevel=C._realizationLevel.realize},_realizeItems:function(e,t,i,n,a,c,_,m,p,f){function g(e,t){T.push(r._cancelBlocker(t.renderComplete)),C(e)}function v(e,t){function i(e,t){!e.updatedSwipeableAttribute&&(L._listView.itemsDraggable||L._listView.itemsReorderable||L._listView._swipeable)&&e.itemsManagerRecord.renderComplete.done(function(){if(L._realizePass===a){var i=l.hasClass(t,d._nonDraggableClass),n=l.hasClass(t,d._nonSelectableClass),r=L._listView.itemsDraggable||L._listView.itemsReorderable,s=L._listView._selectionAllowed()&&L._listView._swipeBehavior===u.SwipeBehavior.select;r&&!i&&(e.itemBox.draggable=!0),L._listView._swipeable&&(r&&!s&&i||s&&!r&&n||i&&n)&&l.addClass(e.itemBox,d._nonSwipeableClass),e.updatedSwipeableAttribute=!0}})}if(L._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!L._listView._isZombie()){var n,r=0,s=-1,o=-1;for(n=e;t>=n;n++){var c=L.items.itemDataAt(n);if(c){var m=c.element,p=c.itemBox;p||(p=L._listView._itemBoxTemplate.cloneNode(!0),c.itemBox=p,p.appendChild(m),l.addClass(m,d._itemClass),L._listView._setupAriaSelectionObserver(m),L._listView._isSelected(n)&&h._ItemEventsHandler.renderSelection(p,m,!0,!0),L._listView._currentMode().renderDragSourceOnRealizedItem(n,p)),i(c,m,p);var f=L.getContainer(n);p.parentNode!==f&&(L._appendAndRestoreFocus(f,p),r++,0>s&&(s=n),o=n,c.container=f,L._listView._isSelected(n)&&l.addClass(f,d._selectedClass),l.removeClass(f,d._backdropClass),L.items.elementAvailable(n))}}L._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),r>0&&(L._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+r+" ("+s+"-"+o+"),info"),L._reportElementsLevel(_))}}function y(e,t,i,n){function r(e,t){var i=L.items.itemDataAt(e);if(i){var n=i.itemBox;return n&&n.parentNode?t?(l.addClass(n.parentNode,d._backdropClass),n.parentNode.removeChild(n),!0):!1:!0}return!0}if(!f){for(var s=!1;e>=i;)s=r(e,s),e--;for(s=!1;n>=t;)s=r(t,s),t++}}function b(e,t,i,n,s){function o(e){var t=L.items.itemDataAt(e);if(t){var n=t.itemsManagerRecord;n.readyComplete||L._realizePass!==a||i.addWork(function(){L._listView._isZombie()||n.pendingReady&&L._realizePass===a&&(L._listView._writeProfilerMark("pendingReady("+e+"),info"),n.pendingReady())},s)}}for(var l=[],c=e;t>=c;c++){var u=L.items.itemDataAt(c);u&&l.push(u.itemsManagerRecord.itemPromise)}r.join(l).then(function(){if("right"===n)for(var i=e;t>=i;i++)o(i);else for(var i=t;i>=e;i--)o(i)})}function C(e){if(L._realizePass===a){if(e>=m&&p>=e){if(0===--x){if(v(m,p),y(m,p,t,i),L._firstLayoutPass){b(m,p,L._frontOffscreenJob,"right"===_?"left":"right",!0);var n=o.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!L._listView._isZombie()){L._listView._writeProfilerMark("entranceAnimation,StartTM");var e=L._listView._animateListEntrance(!L._firstEntranceAnimated);return L._firstEntranceAnimated=!0,e}});L._runningAnimations=r.join([L._runningAnimations,n]),L._runningAnimations.done(function(){L._listView._writeProfilerMark("entranceAnimation,StopTM"),L._realizePass===a&&(L._runningAnimations=null,A.complete())}),L._firstLayoutPass=!1,L._listView._isCurrentZoomView&&o.requestDrain(L._onscreenJob.priority)}else b(m,p,L._frontOffscreenJob,_),A.complete();L._updateHeaders(L._listView._canvas,m,p+1).done(function(){M.complete()})}}else m>e?(--P,P%E===0&&v(t,m-1),P||(L._updateHeaders(L._listView._canvas,t,m).done(function(){"right"!==_&&B.complete()}),b(t,m-1,"right"!==_?L._frontOffscreenJob:L._backOffscreenJob,"left"))):e>p&&(--k,k%E===0&&v(p+1,i-1),k||(L._updateHeaders(L._listView._canvas,p+1,i).then(function(){"right"===_&&B.complete()}),b(p+1,i-1,"right"===_?L._frontOffscreenJob:L._backOffscreenJob,"right")));S--,0===S&&(L._renderCompletePromise=r.join(T).then(null,function(e){var t=Array.isArray(e)&&e.some(function(e){return e&&!(e instanceof Error&&"Canceled"===e.name)});return t?r.wrapError(e):void 0}),(L._headerRenderPromises||r.wrap()).done(function(){o.schedule(function(){L._listView._isZombie()?N.cancel():N.complete()},Math.min(L._onscreenJob.priority,L._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function w(t,i,n){if(L._realizePass===a){var i=n.element;L._addItem(e,t,i,a),g(t,n)}}var I="_realizeItems("+t+"-"+(i-1)+") visible("+m+"-"+p+")";this._listView._writeProfilerMark(I+",StartTM"),_=_||"right";var S=i-t,E=p-m+1,x=E,k=i-p-1,P=m-t,T=[],A=new s,M=new s,B=new s,L=this;if(S>0){var D=0,O=0,R=0;L.firstIndexDisplayed=m,L.lastIndexDisplayed=p;var F=L._listView._isCurrentZoomView;L._highPriorityRealize&&(L._firstLayoutPass||L._hasAnimationInViewportPending)?(L._highPriorityRealize=!1,L._onscreenJob.priority=o.Priority.high,L._frontOffscreenJob.priority=o.Priority.normal,L._backOffscreenJob.priority=o.Priority.belowNormal):L._highPriorityRealize?(L._highPriorityRealize=!1,L._onscreenJob.priority=o.Priority.high,L._frontOffscreenJob.priority=o.Priority.high-1,L._backOffscreenJob.priority=o.Priority.high-1):F?(L._onscreenJob.priority=o.Priority.aboveNormal,L._frontOffscreenJob.priority=o.Priority.normal,L._backOffscreenJob.priority=o.Priority.belowNormal):(L._onscreenJob.priority=o.Priority.belowNormal,L._frontOffscreenJob.priority=o.Priority.idle,L._backOffscreenJob.priority=o.Priority.idle);var N=new s,z=L._listView._versionManager.cancelOnNotification(N.promise),H=function(e,t){t.startStage1&&t.stage0.then(function(){L._realizePass===a&&t.startStage1&&e.addWork(t.startStage1)})},W=function(e,t){var i=L.items.itemDataAt(t);if(!i){var n=L._listView._itemsManager._itemPromiseAtIndex(t);L._pendingItemPromises[n.handle]=n,delete L._previousRealizationPendingItemPromises[n.handle],e.addWork(function(){if(!L._listView._isZombie()&&(D++,L._createItem(t,n,w,C),!L._listView._isZombie()&&L._realizePass===a&&n.handle)){var i=L._listView._itemsManager._recordFromHandle(n.handle);H(e,i)}})}},U=function(e,t,i){for(var n=t;i>=n;n++)W(e,n)},V=function(e,t,i){for(var n=i;n>=t;n--)W(e,n)},q=function(e,t,i){for(var n=t;i>=n;n++){var r=L.items.itemDataAt(n);if(r){var s=r.itemsManagerRecord;g(n,s),O++,H(e,s)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var j;"left"===_?(V(L._onscreenJob,m,p),V(L._frontOffscreenJob,t,m-1),j=t>m-1):(U(L._onscreenJob,m,p),U(L._frontOffscreenJob,p+1,i-1),j=p+1>i-1);for(var J=0,K=Object.keys(this._previousRealizationPendingItemPromises),G=K.length;G>J;J++){var Y=K[J];L._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[Y])}this._previousRealizationPendingItemPromises={},q(L._onscreenJob,m,p),"left"===_?q(L._frontOffscreenJob,t,m-1):q(L._frontOffscreenJob,p+1,i-1);var Z=x===p-m+1;return L._firstLayoutPass?L._listView._canvas.style.opacity=0:Z?L._listView._showProgressBar(L._listView._element,"50%","50%"):L._listView._hideProgressBar(),L._frontOffscreenJob.pause(),L._backOffscreenJob.pause(),M.promise.done(function(){L._frontOffscreenJob.resume(),j&&B.complete()},function(){N.cancel()}),B.promise.done(function(){L._listView._writeProfilerMark("frontItemsRealized,info"),"left"===_?(U(L._backOffscreenJob,p+1,i-1),q(L._backOffscreenJob,p+1,i-1)):(V(L._backOffscreenJob,t,m-1),q(L._backOffscreenJob,t,m-1)),L._backOffscreenJob.resume()}),N.promise.done(function(){L._listView._versionManager.clearCancelOnNotification(z),L._listView._writeProfilerMark(I+" complete(created:"+D+" updated:"+O+"),info")},function(e){return L._listView._versionManager.clearCancelOnNotification(z),L._onscreenJob.clearWork(),L._frontOffscreenJob.clearWork(),L._backOffscreenJob.clearWork(),A.cancel(),M.cancel(),L._listView._writeProfilerMark(I+" canceled(created:"+D+" updated:"+O+" clean:"+R+"),info"),r.wrapError(e)}),L._listView._writeProfilerMark(I+",StopTM"),{viewportItemsRealized:M.promise,allItemsRealized:N.promise,loadingCompleted:r.join([N.promise,A.promise]).then(function(){for(var e=[],n=t;i>n;n++){var s=L.items.itemDataAt(n);s&&e.push(s.itemsManagerRecord.itemReadyPromise)}return r._cancelBlocker(r.join(e))})}}return L._listView._writeProfilerMark(I+",StopTM"),{viewportItemsRealized:r.wrap(),allItemsRealized:r.wrap(),loadingCompleted:r.wrap()}},_setAnimationInViewportState:function(e){if(this._hasAnimationInViewportPending=!1,e&&e.length>0)for(var t=this._listView._getViewportLength(),i=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+t-1),n=0,r=e.length;r>n;n++){var s=e[n];if(s.newIndex>=i.firstIndex&&s.newIndex<=i.lastIndex&&s.newIndex!==s.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(e,t){var i=this;return this._listView._groups.renderGroup(t).then(function(e){if(e){e.element.tabIndex=0;var n=i._getHeaderContainer(t);e.element.parentNode!==n&&(n.appendChild(e.element),l.addClass(e.element,d._headerClass)),i._listView._groups.setDomElement(t,e.element)}})},_updateHeaders:function(e,t,i){function n(t){var i=o._listView._groups.group(t);if(i&&!i.header){var n=i.headerPromise;return n||(n=i.headerPromise=o._addHeader(e,t),n.done(function(){i.headerPromise=null},function(){i.headerPromise=null})),n}return r.wrap()}function s(){o._headerRenderPromises=null}var o=this;this._listView._groups.removeElements();var a=this._listView._groups.groupFromItem(t),l=a,c=this._listView._groups.groupFromItem(i-1),u=[];if(null!==l)for(;c>=l;l++)u.push(n(l));return this._headerRenderPromises=r.join(u,this._headerRenderPromises).then(s,s),this._headerRenderPromises||r.wrap()},_unrealizeItem:function(e){var t,i=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+e+"),info");var n=i._selection._getFocused();n.type!==u.ObjectType.groupHeader&&n.index===e&&(i._unsetFocusOnItem(),t=!0);var r=this.items.itemDataAt(e),s=r.element,o=r.itemBox;o&&o.parentNode&&(l.removeClass(o.parentNode,d._selectedClass),l.removeClass(o.parentNode,d._footprintClass),l.addClass(o.parentNode,d._backdropClass),o.parentNode.removeChild(o)),r.container=null,i._currentMode().itemUnrealized&&i._currentMode().itemUnrealized(e,o),this.items.removeItem(e),r.removed||i._itemsManager.releaseItem(s),a._disposeElement(s),t&&i._setFocusOnItem(i._selection._getFocused())},_unrealizeGroup:function(e){var t,i=e.header,n=this._listView._selection._getFocused();n.type===u.ObjectType.groupHeader&&this._listView._groups.group(n.index)===e&&(this._listView._unsetFocusOnItem(),t=!0),i.parentNode&&i.parentNode.removeChild(i),a._disposeElement(i),e.header=null,e.left=-1,e.top=-1,t&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(e){var t=this,i=0;this.items.eachIndex(function(n){return n<t.begin||n>=t.end?(t._unrealizeItem(n),e&&++i>=e):void 0});var n=this._listView._groups,r=n.groupFromItem(this.begin);if(null!==r)for(var s=n.groupFromItem(this.end-1),o=0,a=n.length();a>o;o++){var l=n.group(o);(r>o||o>s)&&l.header&&this._unrealizeGroup(l)}},_unrealizeExcessiveItems:function(){var e=this.items.count(),t=this.end-this.begin,i=t+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+e+") approved("+i+"),info"),e>i&&this._unrealizeItems(e-i)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var e=this;return v(this._listView).then(function(){function t(){e._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(e._listView._isZombie())return void t();var i=[];e.items.eachIndex(function(t){(t<e.begin||t>=e.end)&&i.push(t)}),e._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+i.length+"),info");var n=[],s=e._listView._groups,a=s.groupFromItem(e.begin);if(null!==a)for(var l=s.groupFromItem(e.end-1),c=0,u=s.length();u>c;c++){var d=s.group(c);(a>c||c>l)&&d.header&&n.push(d)}if(i.length||n.length){var h,_=new r(function(t){function r(s){if(!e._listView._isZombie()){for(var o=-1,a=-1,l=0,c=g(e._listView);i.length&&!c&&!s.shouldYield;){var u=i.shift();e._unrealizeItem(u),l++,0>o&&(o=u),a=u}for(e._listView._writeProfilerMark("unrealizeWorker removeItems:"+l+" ("+o+"-"+a+"),info");n.length&&!c&&!s.shouldYield;)e._unrealizeGroup(n.shift());i.length||n.length?c?s.setPromise(v(e._listView).then(function(){return r})):s.setWork(r):t()}}h=o.schedule(r,o.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return _.then(t,function(t){return h.cancel(),e._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),e._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),r.wrapError(t)})}return t(),r.wrap()})},_getBoundingRectString:function(e){var t;if(e>=0&&e<this.containers.length){var i=this._listView._layout._getItemPosition(e);i&&(t="["+i.left+"; "+i.top+"; "+i.width+"; "+i.height+" ]")}return t||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(e){function t(){n._listView._writeProfilerMark("aria work,StopTM")}function i(e){var t=n._listView._groups,i=t.group(e+1);return i?Math.min(i.startIndex-1,n.end-1):n.end-1}if(!this._listView._isZombie()){var n=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(s){if(!(s>0&&-1!==n.firstIndexDisplayed&&-1!==n.lastIndexDisplayed))return r.wrap();n._listView._writeProfilerMark("aria work,StartTM");var a,c,u,d,h,_,m=n._listView._ariaStartMarker,f=n._listView._ariaEndMarker,y=n.begin,b=n.items.itemAt(n.begin);return b?(l._ensureId(b),n._listView._groupsEnabled()?(c=n._listView._groups,u=d=c.groupFromItem(n.begin),h=c.group(d),_=i(d),l._ensureId(h.header),l._setAttribute(h.header,"role",n._listView._headerRole),l._setAttribute(h.header,"x-ms-aria-flowfrom",m.id),p(h.header,b),l._setAttribute(h.header,"tabindex",n._listView._tabIndex)):l._setAttribute(b,"x-ms-aria-flowfrom",m.id),new r(function(r){var m=e;a=o.schedule(function C(e){if(n._listView._isZombie())return void t();for(;y<n.end;y++){if(!m&&g(n._listView))return void e.setPromise(v(n._listView).then(function(e){return m=e,C}));if(e.shouldYield)return void e.setWork(C);b=n.items.itemAt(y);var o=n.items.itemAt(y+1);if(o&&l._ensureId(o),l._setAttribute(b,"role",n._listView._itemRole),l._setAttribute(b,"aria-setsize",s),l._setAttribute(b,"aria-posinset",y+1),l._setAttribute(b,"tabindex",n._listView._tabIndex),n._listView._groupsEnabled())if(y!==_&&o)p(b,o);else{var a=c.group(d+1);a&&a.header&&o?(l._setAttribute(a.header,"tabindex",n._listView._tabIndex),l._setAttribute(a.header,"role",n._listView._headerRole),l._ensureId(a.header),p(b,a.header),p(a.header,o)):l._setAttribute(b,"aria-flowto",f.id),d++,h=a,_=i(d)}else o?p(b,o):l._setAttribute(b,"aria-flowto",f.id);if(!o)break}n._listView._fireAccessibilityAnnotationCompleteEvent(n.begin,y,u,d-1),t(),r()},o.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){a.cancel(),t()})):void t()})}},_setupDeferredActions:function(){function e(){t._listView._isZombie()||(t.deferTimeout=null,t._listView._versionManager.clearCancelOnNotification(t.deferredActionCancelToken),t.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var t=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return r.timeout(d._DEFERRED_ACTION)}).then(function(){return v(t._listView)}).then(function(e){return t._setupAria(e)}).then(e,function(t){return e(),r.wrapError(t)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(e,t,i){function n(){return s.items.itemAt(t)}function r(){for(var e=i;e>=t;e--)if(s.items.itemAt(e))return s.items.itemAt(e);return null}var s=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var o,a,c=this._listView._ariaStartMarker,u=this._listView._ariaEndMarker;if(-1!==t&&-1!==i&&i>=t&&(o=n(),a=r()),!e&&o&&a){if(l._ensureId(o),l._ensureId(a),this._listView._groupsEnabled()){var d=this._listView._groups,h=d.group(d.groupFromItem(t));h.header&&(l._ensureId(h.header),t===h.startIndex?l._setAttribute(c,"aria-flowto",h.header.id):l._setAttribute(c,"aria-flowto",o.id))}else l._setAttribute(c,"aria-flowto",o.id);l._setAttribute(u,"x-ms-aria-flowfrom",a.id)}else p(c,u),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(e,t){var i=-1,n=u.ObjectType.item;l.hasClass(e,d._headerClass)?(i=this._listView._groups.index(e),n=u.ObjectType.groupHeader,l._setAttribute(e,"role",this._listView._headerRole),l._setAttribute(e,"tabindex",this._listView._tabIndex)):(i=this.items.index(e),l._setAttribute(e,"aria-setsize",t),l._setAttribute(e,"aria-posinset",i+1),l._setAttribute(e,"role",this._listView._itemRole),l._setAttribute(e,"tabindex",this._listView._tabIndex)),n===u.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,i,i):this._listView._fireAccessibilityAnnotationCompleteEvent(i,i,-1,-1)},_reportElementsLevel:function(e){function t(e,t){for(var i=0,r=e;t>=r;r++){var s=n.itemDataAt(r);s&&s.container&&i++}return i}var i,n=this.items;i=Math.floor("right"===e?100*t(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed):100*t(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+i+"),info")},_createHeaderContainer:function(e){return this._createSurfaceChild(d._headerContainerClass,e)},_createItemsContainer:function(e){var i=this._createSurfaceChild(d._itemsContainerClass,e),n=t.document.createElement("div");return n.className=d._padderClass,i.appendChild(n),i},_ensureContainerInDOM:function(e){var t=this.containers[e];return t&&!this._listView._canvas.contains(t)?(this._forceItemsBlocksInDOM(e,e+1),!0):!1},_ensureItemsBlocksInDOM:function(e,t){if(this._expandedRange){var i=this._expandedRange.first.index,n=this._expandedRange.last.index+1;i>=e&&t>i?t=Math.max(t,n):n>e&&t>=n&&(e=Math.min(e,i))}this._forceItemsBlocksInDOM(e,t)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var e=this;return v(this._listView).then(function(){function t(){e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(e._listView._isZombie())return void t();if(e._expandedRange&&-1!==e.begin&&-1!==e.end&&(e._expandedRange.first.index<e.begin||e._expandedRange.last.index+1>e.end)){var i,n=new r(function(t){function n(i){if(!e._listView._isZombie()){for(var r=g(e._listView);e._expandedRange.first.index<e.begin&&!r&&!i.shouldYield;){var s=Math.min(e.begin,e._expandedRange.first.index+e._blockSize*C._blocksToRelease);e._forceItemsBlocksInDOM(s,e.end)}for(;e._expandedRange.last.index+1>e.end&&!r&&!i.shouldYield;){var o=Math.max(e.end,e._expandedRange.last.index-e._blockSize*C._blocksToRelease);e._forceItemsBlocksInDOM(e.begin,o)}e._expandedRange.first.index<e.begin||e._expandedRange.last.index+1>e.end?r?i.setPromise(v(e._listView).then(function(){return n})):i.setWork(n):t()}}i=o.schedule(n,o.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return n.then(t,function(t){return i.cancel(),e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),r.wrapError(t)})}return t(),r.wrap()})},_forceItemsBlocksInDOM:function(e,t){function i(e,t){var i=e.element.firstElementChild;i.style[f]=t}function n(e){for(var t=0;t<_.tree.length;t++)for(var i=_.tree[t].itemsContainer,n=0,r=i.itemsBlocks.length;r>n;n++)if(e(i,i.itemsBlocks[n]))return}function r(e){_._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),_._listView._itemsBlockExtent=l[_._listView._horizontal()?"getTotalWidth":"getTotalHeight"](e.element),_._listView._writeProfilerMark("_itemsBlockExtent("+_._listView._itemsBlockExtent+"),info"),_._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function s(){return-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize&&t.element.parentNode===e.element?(r(t),!0):!1}),-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize?(e.element.appendChild(t.element),r(t),e.element.removeChild(t.element),!0):!1}),_._listView._itemsBlockExtent}function o(e,t,i){function n(t){var i=e.itemsBlocks[t];i&&i.element.parentNode===e.element&&(e.element.removeChild(i.element),p++)}if(Array.isArray(t))t.forEach(n);else for(var r=t;i>r;r++)n(r)}function a(e,t,i){for(var n=e.element.firstElementChild,r=n,s=t;i>s;s++){var o=e.itemsBlocks[s];o&&(o.element.parentNode!==e.element&&(e.element.insertBefore(o.element,r.nextElementSibling),m++),r=o.element)}}function c(e){if(e<_.tree.length){_._listView._writeProfilerMark("collapseGroup("+e+"),info");var t=_.tree[e].itemsContainer;o(t,0,t.itemsBlocks.length),i(t,"")}}function u(e){if(e<_.tree.length){_._listView._writeProfilerMark("expandGroup("+e+"),info");var t=_.tree[e].itemsContainer;a(t,0,t.itemsBlocks.length),i(t,"")}}function d(e,t){function i(e,t){for(var i=[],n=e;t>=n;n++)i.push(n);return i}var n=t[0],r=t[1],s=e[0],o=e[1];return s>r||n>o?i(s,o):n>s&&o>r?i(s,n-1).concat(i(r+1,o)):n>s?i(s,n-1):o>r?i(r+1,o):null}if(this._blockSize){var h="_forceItemsBlocksInDOM begin("+e+") end("+t+"),";this._listView._writeProfilerMark(h+"StartTM");var _=this,m=0,p=0,f="padding"+(this._listView._horizontal()?"Left":"Top"),g=this._listView._groups.groupFromItem(e),v=this._listView._groups.groupFromItem(t-1),y=this._listView._groups.group(g),b=_.tree[g].itemsContainer,C=Math.floor((e-y.startIndex)/this._blockSize),w=this._listView._groups.group(v),I=_.tree[v].itemsContainer,S=Math.floor((t-1-w.startIndex)/this._blockSize);C&&-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize&&t.element.parentNode===e.element?(r(t),!0):!1});var E=this._expandedRange?d([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[g,v]):null;if(E&&E.forEach(c),this._expandedRange&&this._expandedRange.first.groupKey===y.key){var x=d([this._expandedRange.first.block,Number.MAX_VALUE],[C,Number.MAX_VALUE]);x&&o(b,x)}else this._expandedRange&&g>=this._expandedRange.first.groupIndex&&g<=this._expandedRange.last.groupIndex&&o(b,0,C);if(g!==v?(a(b,C,b.itemsBlocks.length),a(I,0,S+1)):a(b,C,S+1),this._expandedRange&&this._expandedRange.last.groupKey===w.key){var x=d([0,this._expandedRange.last.block],[0,S]);x&&o(I,x)}else this._expandedRange&&v>=this._expandedRange.first.groupIndex&&v<=this._expandedRange.last.groupIndex&&o(I,S+1,I.itemsBlocks.length);i(b,C?C*s()+"px":""),g!==v&&i(I,"");for(var k=g+1;v>k;k++)u(k);this._expandedRange={first:{index:e,groupIndex:g,groupKey:y.key,block:C},last:{index:t-1,groupIndex:v,groupKey:w.key,block:S}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+g+"-"+v+") blocks("+C+"-"+S+") added("+m+") removed("+p+"),info"),this._listView._writeProfilerMark(h+"StopTM")}},_realizePageImpl:function(){var e=this,t="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(t+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){e._listView._isZombie()||e._listView._batchViewUpdates(d._ViewChange.realize,d._ScrollToPriority.low,e._listView.scrollPosition)}),this._listView._writeProfilerMark(t+",StopTM"),r.cancel):new r(function(i){function o(){i(),d.complete()}function a(){e._listView._hideProgressBar(),e._state.setLoadingState(e._listView._LoadingState.viewPortLoaded),e._executeAnimations&&e._setState(M,d.promise)}function c(t){e._updateAriaMarkers(0===t,e.firstIndexDisplayed,e.lastIndexDisplayed),e._state.setLoadingState&&e._state.setLoadingState(e._listView._LoadingState.itemsLoaded)}function u(t){e._listView._clearInsertedItems(),e._listView._groups.removeElements(),a(),c(t),o()}var d=new s;e._state.setLoadingState(e._listView._LoadingState.itemsLoading),e._firstLayoutPass&&e._listView._showProgressBar(e._listView._element,"50%","50%");var h=e.containers.length;if(h){var _=C._pagesToPrefetch,m=C._customPagesToPrefetchMax,p=C._customPagesToPrefetchMin;e._listView._zooming&&(_=0,m=0,p=0);var f,g,v=e._listView._getViewportLength();if(n._isiOS&&!C._disableCustomPagesPrefetch){f="left"===e._direction?m:p;var y=Math.max(0,f-e._scrollbarPos/v);g=Math.min(m,y+("right"===e._direction?m:p))}else f=_,g=_;var b=Math.max(0,e._scrollbarPos-f*v),w=e._scrollbarPos+(1+g)*v,I=e._listView._layout.itemsFromRange(b,w-1);if((I.firstIndex<0||I.firstIndex>=h)&&(I.lastIndex<0||I.lastIndex>=h))e.begin=-1,e.end=-1,e.firstIndexDisplayed=-1,e.lastIndexDisplayed=-1,u(h);else{var S=l._clamp(I.firstIndex,0,h-1),E=l._clamp(I.lastIndex+1,0,h),x=e._listView._layout.itemsFromRange(e._scrollbarPos,e._scrollbarPos+v-1),k=l._clamp(x.firstIndex,0,h-1),P=l._clamp(x.lastIndex,0,h-1);if(e._realizationLevel!==C._realizationLevel.skip||e.lastRealizePass||k!==e.firstIndexDisplayed||P!==e.lastIndexDisplayed)if((e._forceRelayout||S!==e.begin||E!==e.end||k!==e.firstIndexDisplayed||P!==e.lastIndexDisplayed)&&E>S&&w>b){e._listView._writeProfilerMark("realizePage currentInView("+k+"-"+P+") previousInView("+e.firstIndexDisplayed+"-"+e.lastIndexDisplayed+") change("+(k-e.firstIndexDisplayed)+"),info"),e._cancelRealize();var T=e._realizePass;e.begin=S,e.end=E,e.firstIndexDisplayed=k,e.lastIndexDisplayed=P,e.deletesWithoutRealize=0,e._ensureItemsBlocksInDOM(e.begin,e.end);var A=e._realizeItems(e._listView._itemCanvas,e.begin,e.end,h,T,e._scrollbarPos,e._direction,k,P,e._forceRelayout);e._forceRelayout=!1;var B=A.viewportItemsRealized.then(function(){return a(),A.allItemsRealized}).then(function(){return e._realizePass===T?e._updateHeaders(e._listView._canvas,e.begin,e.end).then(function(){c(h)}):void 0}).then(function(){return A.loadingCompleted}).then(function(){e._unrealizeExcessiveItems(),e.lastRealizePass=null,o()},function(t){return e._realizePass===T&&(e.lastRealizePass=null,e.begin=-1,e.end=-1),r.wrapError(t)});e.lastRealizePass=r.join([A.viewportItemsRealized,A.allItemsRealized,A.loadingCompleted,B]),e._unrealizeExcessiveItems()}else e.lastRealizePass?e.lastRealizePass.then(o):u(h);else e.begin=S,e.end=S+Object.keys(e.items._itemData).length,e._updateHeaders(e._listView._canvas,e.begin,e.end).done(function(){e.lastRealizePass=null,u(h)})}}else e.begin=-1,e.end=-1,e.firstIndexDisplayed=-1,e.lastIndexDisplayed=-1,u(h);e._reportElementsLevel(e._direction),e._listView._writeProfilerMark(t+",StopTM")})},realizePage:function(e,t,i,n){this._scrollToFunctor=y(e),this._forceRelayout=this._forceRelayout||t,this._scrollEndPromise=i,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(n||x)},onScroll:function(e,t){this.realizePage(e,!1,t,P)},reload:function(e,t){this._listView._isZombie()||(this._scrollToFunctor=y(e),this._forceRelayout=!0,this._highPriorityRealize=!!t,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(e){this._listView._isZombie()||(this._scrollToFunctor=y(e),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(e){var t=this,i=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return e>i?t._listView._itemsCount().then(function(i){return t.containers.length<i?r._cancelBlocker(t._creatingContainersWork&&t._creatingContainersWork.promise).then(function(){return t._getLayoutCompleted()}).then(function(){return e}):e}):r.wrap(e)},waitForEntityPosition:function(e){var t=this;return this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+e.type+": "+e.index+"),info"),r._cancelBlocker(this._state.waitForEntityPosition(e).then(function(){return e.type!==u.ObjectType.groupHeader&&e.index>=t.containers.length||e.type===u.ObjectType.groupHeader&&t._listView._groups.group(e.index).startIndex>=t.containers.length?t._creatingContainersWork&&t._creatingContainersWork.promise:void 0}).then(function(){return t._getLayoutCompleted()}))},stopWork:function(e){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(e),this._layoutWork&&this._layoutWork.cancel(),e&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),e&&(this._state=new w(this))
},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var e=this.lastRealizePass;e&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,e.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(e){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var t=this._listView;this._firstLayoutPass=!0,t._unsetFocusOnItem(),t._currentMode().onDataChanged&&t._currentMode().onDataChanged(),this.items.each(function(i,n){e&&n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.removeChild(n.parentNode),t._itemsManager.releaseItem(n),a._disposeElement(n)}),this.items.removeItems(),this._deferredReparenting=[],e&&t._groups.removeElements(),t._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new w(this),this.resetItems(),!this._listView._isZombie()){var e=this._listView;e._groups.resetGroups(),e._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var e=this._listView._itemsManager;this.items.each(function(t,i){e.releaseItem(i),a._disposeElement(i)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(e){return this.containers[e]},_getHeaderContainer:function(e){return this.tree[e].header},_getGroups:function(e){if(this._listView._groupDataSource){var t=this._listView._groups.groups,i=[];if(e)for(var n=0,r=t.length;r>n;n++){var s=t[n],o=r>n+1?t[n+1].startIndex:e;i.push({key:s.key,size:o-s.startIndex})}return i}return[{key:"-1",size:e}]},_createChunk:function(e,t,i){function n(e,t){var n=e.element.children,r=n.length,o=Math.min(t-e.items.length,i),a=_._stripedContainers(o,e.items.length);c.insertAdjacentHTMLUnsafe(e.element,"beforeend",a);for(var l=0;o>l;l++){var u=n[r+l];e.items.push(u),s.containers.push(u)}}function r(e){var t={header:s._listView._groupDataSource?s._createHeaderContainer():null,itemsContainer:{element:s._createItemsContainer(),items:[]}};s.tree.push(t),s.keyToGroupIndex[e.key]=s.tree.length-1,n(t.itemsContainer,e.size)}var s=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=e.length){var o=this.tree[this.tree.length-1],a=e[this.tree.length-1].size;if(o.itemsContainer.items.length<a)return n(o.itemsContainer,a),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<e.length&&r(e[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(e,i,n,r){function s(e,i){var s,o=e.itemsBlocks.length?e.itemsBlocks[e.itemsBlocks.length-1]:null;if(o&&o.items.length<n){var l=Math.min(i,n-o.items.length),u=o.items.length,s=(e.itemsBlocks.length-1)*n+u,d=_._stripedContainers(l,s);c.insertAdjacentHTMLUnsafe(o.element,"beforeend",d),w=o.element.children;for(var h=0;l>h;h++){var m=w[u+h];o.items.push(m),a.containers.push(m)}i-=l}s=e.itemsBlocks.length*n,i>r&&(i=Math.min(i,Math.max(1,Math.floor(r/n))*n));var p=Math.floor(i/n),f="",g=s,v=s+n,y=["<div class='win-itemsblock'>"+_._stripedContainers(n,g)+"</div>","<div class='win-itemsblock'>"+_._stripedContainers(n,v)+"</div>"];f=_._repeat(y,p),s+=p*n;var b=i%n;b&&(f+="<div class='win-itemsblock'>"+_._stripedContainers(b,s)+"</div>",s+=b,p++);var C=t.document.createElement("div");c.setInnerHTMLUnsafe(C,f);for(var w=C.children,I=0;p>I;I++){var S=w[I],E={element:S,items:_._nodeListToArray(S.children)};e.itemsBlocks.push(E);for(var x=0;x<E.items.length;x++)a.containers.push(E.items[x])}}function o(e){var t={header:a._listView._groupDataSource?a._createHeaderContainer():null,itemsContainer:{element:a._createItemsContainer(),itemsBlocks:[]}};a.tree.push(t),a.keyToGroupIndex[e.key]=a.tree.length-1,s(t.itemsContainer,e.size)}var a=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=e.length){var l=this.tree[this.tree.length-1].itemsContainer,u=e[this.tree.length-1].size,d=0;if(l.itemsBlocks.length&&(d=(l.itemsBlocks.length-1)*n+l.itemsBlocks[l.itemsBlocks.length-1].items.length),u>d)return s(l,u-d),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<e.length&&o(e[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var e=this,t=0,i=!1;return function r(s){e._listView._versionManager.locked?s.setPromise(e._listView._versionManager.unlocked.then(function(){return r})):e._listView._itemsCount().then(function(o){var a=!i&&g(e._listView);if(a)s.setPromise(v(e._listView).then(function(e){return i=e,r}));else{if(e._listView._isZombie())return;i=!1;var l=n._now()+C._createContainersJobTimeslice,c=e._getGroups(o),u=e.containers.length,d=e.end===e.containers.length,h=C._chunkSize;do e._blockSize?e._createChunkWithBlocks(c,o,e._blockSize,h):e._createChunk(c,o,h),t++;while(e.containers.length<o&&n._now()<l);e._listView._writeProfilerMark("createContainers yields containers("+e.containers.length+"),info"),e._listView._affectedRange.add({start:u,end:e.containers.length},o),d?(e.stopWork(),e._listView._writeProfilerMark(e._state.name+"_relayout,info"),e._state.relayout()):(e._listView._writeProfilerMark(e._state.name+"_layoutNewContainers,info"),e._state.layoutNewContainers()),e.containers.length<o?s.setWork(r):(e._listView._writeProfilerMark("createContainers completed steps("+t+"),info"),e._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return o.schedule(this._generateCreateContainersWorker(),o.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var e,t=this;return this._listView._itemsCount().then(function(i){return 0===i&&t._listView._hideProgressBar(),e=i,t._listView._writeProfilerMark("createContainers("+e+"),StartTM"),t._listView._groupDataSource?t._listView._groups.initialize():void 0}).then(function(){return t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),e&&t._listView._groups.length()?t._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(i){t._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+i+"),info"),t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),t._listView._resetCanvas(),t.tree=[],t.keyToGroupIndex={},t.containers=[],t._blockSize=i;var r,s=t._getGroups(e),o=n._now()+C._maxTimePerCreateContainers,a=Math.min(C._startupChunkSize,C._chunkSize);do r=i?t._createChunkWithBlocks(s,e,i,a):t._createChunk(s,e,a);while(n._now()<o&&t.containers.length<e&&!r);if(t._listView._writeProfilerMark("createContainers created("+t.containers.length+"),info"),t._listView._affectedRange.add({start:0,end:t.containers.length},e),t.containers.length<e){var l=t._scheduleLazyTreeCreation();t._creatingContainersWork.promise.done(null,function(){l.cancel()})}else t._listView._writeProfilerMark("createContainers completed synchronously,info"),t._creatingContainersWork.complete();t._listView._writeProfilerMark("createContainers("+e+"),StopTM")})},_updateItemsBlocks:function(e){function i(){var e=t.document.createElement("div");return e.className=d._itemsBlockClass,e}function n(t,n){function o(){t.itemsBlocks=null,t.items=[];for(var e=0;u>e;e++){var i=r.containers[n+e];t.element.appendChild(i),t.items.push(i)}}function a(){t.itemsBlocks=[{element:c.length?c.shift():i(),items:[]}];for(var s=t.itemsBlocks[0],o=0;u>o;o++){if(s.items.length===e){var a=c.length?c.shift():i();t.itemsBlocks.push({element:a,items:[]}),s=t.itemsBlocks[t.itemsBlocks.length-1]}var l=r.containers[n+o];s.element.appendChild(l),s.items.push(l)}t.items=null}var l,c=[],u=0,d=t.itemsBlocks;if(d)for(l=0;l<d.length;l++)u+=d[l].items.length,c.push(d[l].element);else u=t.items.length;for(s?a():o(),l=0;l<c.length;l++){var h=c[l];h.parentNode===t.element&&t.element.removeChild(h)}return u}for(var r=this,s=!!e,o=0,a=0;o<this.tree.length;o++)a+=n(this.tree[o].itemsContainer,a);r._blockSize=e},_layoutItems:function(){var e=this;return this._listView._itemsCount().then(function(){return r.as(e._listView._layout.numberOfItemsPerItemsBlock).then(function(t){e._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+t+"),info"),t!==e._blockSize&&(e._updateItemsBlocks(t),e._listView._itemsBlockExtent=-1);var i,n=e._listView._affectedRange.get();return n&&(i={firstIndex:Math.max(n.start-1,0),lastIndex:Math.min(e.containers.length-1,n.end)},i.firstIndex<e.containers.length||0===e.containers.length)?e._listView._layout.layout(e.tree,i,e._modifiedElements||[],e._modifiedGroups||[]):(e._listView._affectedRange.clear(),{realizedRangeComplete:r.wrap(),layoutComplete:r.wrap()})})})},updateTree:function(e,t,i){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(e,t,i)},_updateTreeImpl:function(e,i,n,r){function s(e){for(var t=0,i=e.length;i>t;t++){var n=e[t];n.parentNode.removeChild(n)}}if(this._executeAnimations=!0,this._modifiedElements=n,!n.handled){n.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var o,a=this;r||this._unrealizeItems();for(var o=0,c=n.length;c>o;o++)n[o]._itemBox&&n[o]._itemBox.parentNode&&l.removeClass(n[o]._itemBox.parentNode,d._selectedClass);this.items.each(function(e,t,i){i.container&&l.removeClass(i.container,d._selectedClass),i.container&&l.addClass(i.container,d._backdropClass)});var u=this._listView._updateContainers(this._getGroups(e),e,i,n);s(u.removedHeaders),s(u.removedItemsContainers);for(var o=0,c=n.length;c>o;o++){var _=n[o];if(-1!==_.newIndex){if(_.element=this.getContainer(_.newIndex),!_.element)throw"Container missing after updateContainers."}else l.removeClass(_.element,d._backdropClass)}var m=t.document.activeElement;this._listView._canvas.contains(m)&&(this._requireFocusRestore=m),this._deferredReparenting=[],this.items.each(function(e,t,i){var n=a.getContainer(e),r=i.itemBox;r&&n&&(r.parentNode!==n&&(e>=a.firstIndexDisplayed&&e<=a.lastIndexDisplayed?a._appendAndRestoreFocus(n,r):a._deferredReparenting.push({itemBox:r,container:n})),l.removeClass(n,d._backdropClass),i.container=n,l[a._listView.selection._isIncluded(e)?"addClass":"removeClass"](n,d._selectedClass),!a._listView.selection._isIncluded(e)&&l.hasClass(r,d._selectedClass)&&h._ItemEventsHandler.renderSelection(r,i.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var e=this._deferredReparenting.length;if(e>0){var t="_completeReparenting("+e+")";this._listView._writeProfilerMark(t+",StartTM");for(var i,n=0;e>n;n++)i=this._deferredReparenting[n],this._appendAndRestoreFocus(i.container,i.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(t+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(e,i){if(i.parentNode!==e){var n;if(this._requireFocusRestore&&(n=t.document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===n&&(e.contains(n)||i.contains(n))&&(this._listView._unsetFocusOnItem(),n=t.document.activeElement),l.empty(e),e.appendChild(i),this._requireFocusRestore&&n===this._listView._keyboardEventsHelper){var r=this._listView._selection._getFocused();r.type===u.ObjectType.item&&this.items.itemBoxAt(r.index)===i&&(l._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var e=this;this._hasAnimationInViewportPending=!1;var t=r.as(this._listView._layout.executeAnimations()).then(function(){e._listView._writeProfilerMark("startAnimations,StopTM")});return t},_setState:function(e,t){if(!this._listView._isZombie()){var i=this._state.name;this._state=new e(this,t),this._listView._writeProfilerMark(this._state.name+"_enter from("+i+"),info"),this._state.enter()}},getAdjacent:function(e,t){var i=this;return this.waitForEntityPosition(e).then(function(){return i._listView._layout.getAdjacent(e,t)})},hitTest:function(e,t){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var i=this._listView._layout.hitTest(e,t);return i.index=l._clamp(i.index,-1,this._listView._cachedCount-1,0),i.insertAfterIndex=l._clamp(i.insertAfterIndex,-1,this._listView._cachedCount-1,0),i},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new s;var e=this;this._creatingContainersWork.promise.done(function(){e._creatingContainersWork=null},function(){e._creatingContainersWork=null})}},_createLayoutSignal:function(){var e=this;this._layoutCompleted||(this._layoutCompleted=new s,this._layoutCompleted.promise.done(function(){e._layoutCompleted=null},function(){e._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new s,this._realizedRangeLaidOut.promise.done(function(){e._realizedRangeLaidOut=null},function(){e._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?r._cancelBlocker(this._layoutCompleted.promise):r.wrap()},_createSurfaceChild:function(e,i){var n=t.document.createElement("div");return n.className=e,this._listView._canvas.insertBefore(n,i?i.nextElementSibling:null),n},_executeScrollToFunctor:function(){var e=this;return r.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(t){e._scrollToFunctor=null,t=t||{},+t.position===t.position&&(e._scrollbarPos=t.position),e._direction=t.direction||"right"})}},{_pagesToPrefetch:2,_customPagesToPrefetchMax:6,_customPagesToPrefetchMin:2,_disableCustomPagesPrefetch:!1,_waitForSeZoIntervalDuration:100,_waitForSeZoTimeoutDuration:500,_chunkSize:500,_startupChunkSize:100,_maxTimePerCreateContainers:5,_createContainersJobTimeslice:15,_blocksToRelease:10,_realizationLevel:{skip:"skip",realize:"realize",normal:"normal"}}),w=i.Class.define(function(e){this.view=e,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:b,realizePage:b,rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(I)},layoutNewContainers:b,waitForEntityPosition:function(){return this.view._setState(I),this.view._getLayoutCompleted()},updateTree:b}),I=i.Class.define(function(e){this.view=e},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var e=this,t=new s;this.promise=t.promise.then(function(){return e.view._createContainers()}).then(function(){e.view._setState(S)},function(t){return e.canceling||(e.view._setState(w),e.view._listView._raiseViewComplete()),r.wrapError(t)}),t.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(w)},realizePage:b,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:b,layoutNewContainers:b,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:b}),S=i.Class.define(function(e,t){this.view=e,this.nextStateType=t||x},{name:"LayingoutState",enter:function(){var e=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var t=new s;this.promise=t.promise.then(function(){return e.view._layoutItems()}).then(function(t){return e.view._layoutWork=t.layoutComplete,t.realizedRangeComplete}).then(function(){e.view._listView._writeProfilerMark(e.name+"_enter_layoutItems,StopTM"),e.view._listView._clearInsertedItems(),e.view._setAnimationInViewportState(e.view._modifiedElements),e.view._modifiedElements=[],e.view._modifiedGroups=[],e.view._realizedRangeLaidOut.complete(),e.view._layoutWork.then(function(){e.view._listView._writeProfilerMark(e.name+"_enter_layoutCompleted,info"),e.view._listView._affectedRange.clear(),e.view._layoutCompleted.complete()}),e.canceling||e.view._setState(e.nextStateType)},function(t){return e.view._listView._writeProfilerMark(e.name+"_enter_layoutCanceled,info"),e.canceling||(e.view.firstIndexDisplayed=e.view.lastIndexDisplayed=-1,e.view._updateAriaMarkers(!0,e.view.firstIndexDisplayed,e.view.lastIndexDisplayed),e.view._setState(B)),r.wrapError(t)}),t.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(e){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),e&&this.view._setState(E)},stop:function(){this.cancelLayout(!0)},realizePage:b,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(I)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),E=i.Class.define(function(e){this.view=e},{name:"LayoutCanceledState",enter:b,stop:b,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(S)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),x=i.Class.define(function(e){this.view=e,this.nextState=A,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var e=this,t=new s;this.promise=t.promise.then(function(){return e.view._executeScrollToFunctor()}).then(function(){return e.relayoutNewContainers=!1,r._cancelBlocker(e.view._realizePageImpl())}).then(function(){e.view._state===e&&(e.view._completeUpdateTree(),e.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),e.view._setState(e.nextState))},function(t){return e.view._state!==e||e.canceling||(e.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),e.view._setState(k)),r.wrapError(t)}),t.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(k)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(I)},relayout:function(){this.stop(),this.view._setState(S)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)},setLoadingState:function(e){this.view._listView._setViewState(e)}}),k=i.Class.define(function(e){this.view=e},{name:"CanceledState",enter:b,stop:function(){this.view._cancelRealize()},realizePage:function(e){this.stop(),this.view._setState(e)},rebuildTree:function(){this.stop(),this.view._setState(I)},relayout:function(e){this.stop(),this.view._setState(S,e)},layoutNewContainers:function(){this.relayout(k)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),P=i.Class.derive(x,function(e){this.view=e,this.nextState=T,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),T=i.Class.derive(k,function(e){this.view=e},{name:"ScrollingPausedState",enter:function(){var e=this;this.promise=r._cancelBlocker(this.view._scrollEndPromise).then(function(){e.view._setState(A)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),A=i.Class.define(function(e){this.view=e},{name:"UnrealizingState",enter:function(){var e=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return e.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),e.view._renderCompletePromise}).then(function(){e.view._setState(B)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(k)},realizePage:function(e){this.promise.cancel(),this.view._setState(e)},rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(S)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),M=i.Class.define(function(e,t){this.view=e,this.realizePromise=t,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var e=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new s,this.view._executeAnimations=!1,this.animatePromise.done(function(){e.animating=!1,e.modifiedElements?(e.view._updateTreeImpl(e.count,e.delta,e.modifiedElements),e.modifiedElements=null,e.view._setState(k)):e.animateSignal.complete()},function(t){return e.animating=!1,r.wrapError(t)}),this._waitForRealize()},_waitForRealize:function(){var e=this;this.realizing=!0,this.realizePromise.done(function(){e.realizing=!1});var t=++this.realizeId;r.join([this.realizePromise,this.animateSignal.promise]).done(function(){t===e.realizeId&&(e.view._completeUpdateTree(),e.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),e.view._setState(A))})},stop:function(e){this.realizePromise.cancel(),this.view._cancelRealize(),e&&(this.animatePromise.cancel(),this.view._setState(k))},realizePage:function(){if(!this.modifiedElements){var e=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return r._cancelBlocker(e.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(I)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(S)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){if(this.animating){var n=this.modifiedElements;return this.count=e,this.delta=t,this.modifiedElements=i,n?r.cancel:this.animatePromise}return this.view._updateTreeImpl(e,t,i)},setLoadingState:function(e){this.view._listView._setViewState(e)}}),B=i.Class.derive(k,function(e){this.view=e},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=C._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(L)},stop:function(){this._stopped=!0,k.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(L)},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i,!0)}}),L=i.Class.derive(k,function(e){this.view=e},{name:"LayingoutNewContainersState",enter:function(){var e=this;this.promise=r.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){e.view._relayoutInComplete=!1,e.relayout(k)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(e){this.stop(),this.view._setState(S,e)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return C})})}),define("require-style!less/controls",[],function(){}),define("WinJS/Controls/ListView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_SafeHtml","../Utilities/_TabContainer","../Utilities/_UI","../Utilities/_VersionManager","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler","./ListView/_BrowseMode","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_Helpers","./ListView/_ItemsContainer","./ListView/_Layouts","./ListView/_SelectionManager","./ListView/_VirtualizeContentsView","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y,b,C,w,I,S,E,x,k,P,T,A,M,B){"use strict";function L(){var e=z;z=[],e=e.filter(function(e){return e._isZombie()?(e._dispose(),!1):!0}),z=z.concat(e)}function D(e){z.push(e),R&&R.cancel(),R=u.timeout(N).then(L)}function O(e){return e.offsetParent?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:0}var R,F=i._browserStyleEquivalents.transform,N=1e3,z=[],H=p._uniqueID,W=P._ListViewAnimationHelper,U={get notCompatibleWithSemanticZoom(){return"ListView can only be used with SemanticZoom if randomAccess loading behavior is specified."},get listViewInvalidItem(){return"Item must provide index, key or description of corresponding item."},get listViewViewportAriaLabel(){return o._getWinJSString("ui/listViewViewportAriaLabel").value}},V=i.requireSupportedForProcessing,q={entrance:"entrance",contentTransition:"contentTransition"};t.Namespace.define("WinJS.UI",{ListViewAnimationType:q,ListView:t.Namespace._lazy(function(){var o=t.Class.define(function(){this.clear()},{add:function(e,t){if(e._lastKnownSizeOfData=t,this._range){this._range.start=Math.min(this._range.start,e.start);var i=this._range._lastKnownSizeOfData-this._range.end,n=e._lastKnownSizeOfData-e.end,r=Math.min(i,n);this._range._lastKnownSizeOfData=e._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-r}else this._range=e},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),f=t.Class.define(function(e){this._listView=e},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(e,t,i,n){this._listView._configureForZoom(e,t,i,n)},setCurrentItem:function(e,t){this._listView._setCurrentItem(e,t)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(e,t){return this._listView._positionItem(e,t)},endZoom:function(e){this._listView._endZoom(e)},pinching:{get:function(){return this._listView._pinching},set:function(e){this._listView._pinching=e}}}),T=t.Class.define(function(t,i){if(t=t||e.document.createElement("div"),p._supportsTouchActionCrossSlide&&t.classList.add(w._listViewSupportsCrossSlideClass),this._id=t.id||"",this._writeProfilerMark("constructor,StartTM"),i=i||{},t.winControl=this,p.addClass(t,"win-disposable"),this._affectedRange=new o,this._mutationObserver=new p._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=t,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=w._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._viewportWidth=w._UNINITIALIZED,this._viewportHeight=w._UNINITIALIZED,this._manipulationState=p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new x._UnsupportedGroupFocusCache,this._viewChange=w._ViewChange.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new B._VirtualizeContentsView(this),this._selection=new M._SelectionManager(this),this._createTemplates(),this._groupHeaderRenderer=g._trivialHtmlRenderer,this._itemRenderer=g._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,i.itemDataSource)this._dataSource=i.itemDataSource;else{var n=new c.List;this._dataSource=n.dataSource}this._selectionMode=b.SelectionMode.multi,this._tap=b.TapBehavior.invokeOnly,this._groupHeaderTap=b.GroupHeaderTapBehavior.invoke,this._swipeBehavior=b.SwipeBehavior.select,this._mode=new S._SelectionMode(this),this._setSwipeClass(),this._groups=new k._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),i.layout||this._updateLayout(new A.GridLayout),this._attachEvents(),this._runningInit=!0,_.setOptions(this,i),this._runningInit=!1,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(e){this._updateLayout(e),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0,!0))}},pagesToLoad:{get:function(){return 2*B._VirtualizeContentsView._pagesToPrefetch+1},set:function(){p._deprecated(E.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){p._deprecated(E.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(e){function t(e){e.detail===b.DataSourceStatus.failure&&(i.itemDataSource=null,i.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var i=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",t,!1),this._groupDataSource=e,this._groupFocusCache=e&&this._supportsGroupHeaderKeyboarding?new x._GroupFocusCache(this):new x._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",t,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?p.addClass(this._element,w._groupsClass):p.removeClass(this._element,w._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){p._deprecated(E.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){p._deprecated(E.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(e){if("string"==typeof e&&e.match(/^(none|single|multi)$/)){if(i.isPhone&&e===b.SelectionMode.single)return;return this._selectionMode=e,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),this._setSwipeClass(),void this._configureSelectionMode()}throw new n("WinJS.UI.ListView.ModeIsInvalid",E.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(e){i.isPhone&&e===b.TapBehavior.directSelect||(this._tap=e,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(e){this._groupHeaderTap=e,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(e){this._swipeBehavior=e,this._setSwipeClass()
}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(e){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=e||(new c.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(e){this._setRenderer(e,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(e){p._deprecated(E.resetItemIsDeprecated),this._itemRelease=e}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(e){this._setRenderer(e,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(e){p._deprecated(E.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=e}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(e){if(!(0>e)){this._writeProfilerMark("set_indexOfFirstVisible("+e+"),info"),this._raiseViewLoading(!0);var t=this;this._batchViewUpdates(w._ViewChange.realize,w._ScrollToPriority.high,function(){var i;return t._entityInRange({type:b.ObjectType.item,index:e}).then(function(e){return e.inRange?t._getItemOffset({type:b.ObjectType.item,index:e.index}).then(function(e){return i=e,t._ensureFirstColumnRange(b.ObjectType.item)}).then(function(){return i=t._correctRangeInFirstColumn(i,b.ObjectType.item),i=t._convertFromCanvasCoordinates(i),t._view.waitForValidScrollPosition(i.begin)}).then(function(e){var i=e<t._lastScrollPosition?"left":"right",n=t._viewport[t._scrollLength]-t._getViewportLength();return e=p._clamp(e,0,n),{position:e,direction:i}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var e=this._selection._getFocused(),t={index:e.index,type:e.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(e.type===b.ObjectType.groupHeader){var i=this._groups.group(e.index);i&&(t.key=i.key,t.showFocus=!(!i.header||!p.hasClass(i.header,w._itemFocusClass)))}else{var n=this._view.items.itemAt(e.index);if(n){var r=this._itemsManager._recordFromElement(n);t.key=r.item&&r.item.key,t.showFocus=!!n.parentNode.querySelector("."+w._itemFocusOutlineClass)}}return t},set:function(e){function t(t,n,r){var s=!!e.showFocus&&i._hasKeyboardFocus;i._unsetFocusOnItem(n),i._selection._setFocused(r,s),i._hasKeyboardFocus?(i._keyboardFocusInbound=s,i._setFocusOnItem(r)):i._tabManager.childFocus=n?t:null,r.type!==b.ObjectType.groupHeader&&(i._updateFocusCache(r.index),i._updater&&(i._updater.newSelectionPivot=r.index,i._updater.oldSelectionPivot=-1),i._selection._pivot=r.index)}this._hasKeyboardFocus=e.hasFocus||this._hasKeyboardFocus;var i=this;if(e.key&&(e.type!==b.ObjectType.groupHeader&&this._dataSource.itemFromKey||e.type===b.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var n=e.type===b.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=n.itemFromKey(e.key).then(function(n){if(i.oldCurrentItemKeyFetch=null,n){var r=e.type===b.ObjectType.groupHeader?i._groups.group(n.index).header:i._view.items.itemAt(n.index);t(r,!!r,{type:e.type||b.ObjectType.item,index:n.index})}})}else if(void 0!==e.index){var r;if(e.type===b.ObjectType.groupHeader){var s=i._groups.group(e.index);r=s&&s.header}else r=i._view.items.itemAt(e.index);t(r,!!r,{type:e.type||b.ObjectType.item,index:e.index})}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new f(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(e){i.isPhone||this._dragSource!==e&&(this._dragSource=e,this._setSwipeClass())}},itemsReorderable:{get:function(){return this._reorderable},set:function(e){i.isPhone||this._reorderable!==e&&(this._reorderable=e,this._setSwipeClass())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(e){this._maxDeferredItemCleanup=Math.max(0,+e||0)}},dispose:function(){this._dispose()},elementFromIndex:function(e){return this._view.items.itemAt(e)},indexOfElement:function(e){return this._view.items.index(e)},ensureVisible:function(e){var t=b.ObjectType.item,i=e;if(+e!==e&&(t=e.type,i=e.index),this._writeProfilerMark("ensureVisible("+t+": "+i+"),info"),!(0>i)){this._raiseViewLoading(!0);var n=this;this._batchViewUpdates(w._ViewChange.realize,w._ScrollToPriority.high,function(){var e;return n._entityInRange({type:t,index:i}).then(function(i){return i.inRange?n._getItemOffset({type:t,index:i.index}).then(function(i){return e=i,n._ensureFirstColumnRange(t)}).then(function(){e=n._correctRangeInFirstColumn(e,t);var r=n._getViewportLength(),s=n._viewportScrollPosition,o=s+r,a=n._viewportScrollPosition,l=e.end-e.begin;e=n._convertFromCanvasCoordinates(e);var c=!1;if(t===b.ObjectType.groupHeader&&s<=e.begin){var u=n._groups.group(i.index).header;if(u){var d,h=A._getMargins(u);if(n._horizontalLayout){var _=n._rtl(),m=_?O(u)-h.right:u.offsetLeft-h.left;d=m+u.offsetWidth+(_?h.left:h.right)}else d=u.offsetTop+u.offsetHeight+h.top;c=o>=d}}c||(l>=o-s?a=e.begin:e.begin<s?a=e.begin:e.end>o&&(a=e.end-r));var f=a<n._lastScrollPosition?"left":"right",g=n._viewport[n._scrollLength]-r;return a=p._clamp(a,0,g),{position:a,direction:f}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){p._deprecated(E.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(w._ViewChange.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(w._ViewChange.remeasure)},_entityInRange:function(e){if(e.type===b.ObjectType.item)return this._itemsCount().then(function(t){var i=p._clamp(e.index,0,t-1);return{inRange:i>=0&&t>i,index:i}});var t=p._clamp(e.index,0,this._groups.length()-1);return u.wrap({inRange:t>=0&&t<this._groups.length(),index:t})},_forceLayoutImpl:function(e){var t=this;this._versionManager.unlocked.then(function(){t._writeProfilerMark("_forceLayoutImpl viewChange("+e+"),info"),t._cancelAsyncViewWork(),t._pendingLayoutReset=!0,t._resizeViewport(),t._batchViewUpdates(e,w._ScrollToPriority.low,function(){return{position:t._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){i.isPhone&&(this.tapBehavior===b.TapBehavior.toggleSelect&&this.selectionMode===b.SelectionMode.multi?p.addClass(this._canvas,w._selectionModeClass):p.removeClass(this._canvas,w._selectionModeClass))},_lastScrollPosition:{get:function(){return this._lastScrollPositionValue},set:function(e){if(0===e)this._lastDirection="right",this._direction="right",this._lastScrollPositionValue=0;else{var t=e<this._lastScrollPositionValue?"left":"right";this._direction=this._scrollDirection(e),this._lastDirection=t,this._lastScrollPositionValue=e}}},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=p.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(e){var t={};t[this._scrollProperty]=e,p.setScrollPosition(this._viewport,t),this._currentScrollPosition=e}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(e){var t=this._horizontal()?this._rtl()?-e:e:0,i=this._horizontal()?0:e;this._canvas.style[F.scriptName]=0!==e?"translate( "+t+"px, "+i+"px)":"",this._canvasStartValue=e}},scrollPosition:{get:function(){return this._viewportScrollPosition},set:function(e){var t=this;this._batchViewUpdates(w._ViewChange.realize,w._ScrollToPriority.high,function(){return t._view.waitForValidScrollPosition(e).then(function(){var i=t._viewport[t._scrollLength]-t._getViewportLength();e=p._clamp(e,0,i);var n=e<t._lastScrollPosition?"left":"right";return{position:e,direction:n}})},!0)}},_setRenderer:function(e,t){var r;if(e){if("function"==typeof e)r=e;else if("object"==typeof e){if(i.validation&&!e.renderItem)throw new n("WinJS.UI.ListView.invalidTemplate",E.invalidTemplate);r=e.renderItem}}else{if(i.validation)throw new n("WinJS.UI.ListView.invalidTemplate",E.invalidTemplate);r=g.trivialHtmlRenderer}r&&(t?this._groupHeaderRenderer=r:this._itemRenderer=r)},_renderWithoutReuse:function(e,t){t&&m._disposeElement(t);var i=this._itemRenderer(e);if(i.then)return i.then(function(e){return e.tabIndex=0,e});var n=i.element||i;return n.tabIndex=0,i},_isInsertedItem:function(e){return!!this._insertedItems[e.handle]},_clearInsertedItems:function(){for(var e=Object.keys(this._insertedItems),t=0,i=e.length;i>t;t++)this._insertedItems[e[t]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(e){this._view.stopWork(e)},_updateView:function(){function e(){i._itemsBlockExtent=-1,i._firstItemRange=null,i._firstHeaderRange=null,i._itemMargins=null,i._headerMargins=null,i._canvasMargins=null,i._cachedRTL=null,i._rtl()}function t(){i._scrollToPriority=w._ScrollToPriority.uninitialized;var e=i._setScrollbarPosition;i._setScrollbarPosition=!1;var t="number"==typeof i._scrollToFunctor?{position:i._scrollToFunctor}:i._scrollToFunctor();return u.as(t).then(function(t){return t=t||{},e&&+t.position===t.position&&(i._lastScrollPosition=t.position,i._viewportScrollPosition=t.position),t},function(t){return i._setScrollbarPosition|=e,u.wrapError(t)})}if(!this._isZombie()){var i=this,n=this._viewChange;this._viewChange=w._ViewChange.realize,n===w._ViewChange.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),e(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(t,!0),this._setFocusOnItem(this._selection._getFocused())):n===w._ViewChange.remeasure?(this._view.resetItems(!0),this._resetLayout(),e(),this._view.refresh(t),this._setFocusOnItem(this._selection._getFocused())):n===w._ViewChange.relayout?(this._pendingLayoutReset&&(this._resetLayout(),e()),this._view.refresh(t)):this._view.onScroll(t)}},_batchViewUpdates:function(e,t,i,n,r){if(this._viewChange=Math.min(this._viewChange,e),(null===this._scrollToFunctor||t>=this._scrollToPriority)&&(this._scrollToPriority=t,this._scrollToFunctor=i),this._setScrollbarPosition|=!!n,!this._batchingViewUpdates){this._raiseViewLoading();var s=this;this._batchingViewUpdatesSignal=new h,this._batchingViewUpdates=u.any([this._batchingViewUpdatesSignal.promise,d.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){return s._isZombie()?void 0:s._viewChange!==w._ViewChange.rebuild||s._firstTimeDisplayed||0===Object.keys(s._view.items._itemData).length||r?void 0:s._fadeOutViewport()}).then(function(){s._batchingViewUpdates=null,s._batchingViewUpdatesSignal=null,s._updateView(),s._firstTimeDisplayed=!1},function(){s._batchingViewUpdates=null,s._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var t=e.document.createElement("div");t.className=this._canvas.className,this._viewport.replaceChild(t,this._canvas),this._canvas=t,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){p.addClass(this._element,w._listViewClass),p[this._rtl()?"addClass":"removeClass"](this._element,w._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+w._viewportClass+" "+w._horizontalClass+'"><div class="'+w._scrollableClass+'"><div class="'+w._proxyClass+'"></div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"></div>',this._viewport=this._element.firstElementChild,this._canvas=this._viewport.firstElementChild,this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling,this._tabIndex=p.getTabIndex(this._element),this._tabIndex<0&&(this._tabIndex=0),this._tabManager=new y.TabContainer(this._viewport),this._tabManager.tabIndex=this._tabIndex,this._progressBar=e.document.createElement("progress"),p.addClass(this._progressBar,w._progressClass),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(t){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(t||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,e.document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,p._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(e){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var t=this,i=function(i){t._isZombie()||(t._tabManager.childFocus!==i&&(t._tabManager.childFocus=i),t._focusRequest=null,t._hasKeyboardFocus&&!t._itemFocused&&(t._selection._keyboardFocused()&&t._drawFocusRectangle(i),t._view.updateAriaForAnnouncement(i,e.type===b.ObjectType.groupHeader?t._groups.length():t._cachedCount),t._itemFocused=!0,p._setActive(i)))};this._focusRequest=e.type!==b.ObjectType.groupHeader?this._view.items.requestItem(e.index):this._groups.requestHeader(e.index),this._focusRequest.then(i)}},_attachEvents:function(){function t(e,t,i){return{name:t?e:e.toLowerCase(),handler:function(t){r["_on"+e](t)},capture:i}}function i(e,t,i){return{capture:i,name:t?e:e.toLowerCase(),handler:function(t){var i=r._mode,n="on"+e;!r._disposed&&i[n]&&i[n](t)}}}function n(e,t){return{handler:function(t){r["_on"+e](t)},filter:t}}var r=this,s=[n("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,s.forEach(function(e){new p._MutationObserver(e.handler).observe(r._element,{attributes:!0,attributeFilter:e.filter})});var o=[i("PointerDown"),i("click",!1),i("PointerUp"),i("LostPointerCapture"),i("MSHoldVisual",!0),i("PointerCancel",!0),i("DragStart"),i("DragOver"),i("DragEnter"),i("DragLeave"),i("Drop"),i("ContextMenu"),i("MSManipulationStateChanged",!0,!0)];o.forEach(function(e){p._addEventListener(r._viewport,e.name,e.handler,!!e.capture)});var a=[t("FocusIn",!1,!1),t("FocusOut",!1,!1),i("KeyDown"),i("KeyUp"),t("MSElementResize",!1,!1)];a.forEach(function(e){p._addEventListener(r._element,e.name,e.handler,!!e.capture)}),this._onMSElementResizeBound=this._onMSElementResize.bind(this),p._resizeNotifier.subscribe(this._element,this._onMSElementResizeBound);var l=e.document.body.contains(this._element);p._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(e){return l?void(l=!1):void r._onMSElementResizeBound(e)},!1);var c=[t("MSManipulationStateChanged",!0),t("Scroll")];c.forEach(function(e){r._viewport.addEventListener(e.name,e.handler,!1)}),this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this)),this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this)),this._viewport.addEventListener("onTabEntered",function(e){r._mode.onTabEntered(e)}),this._viewport.addEventListener("onTabExiting",function(e){r._mode.onTabExiting(e)})},_updateItemsManager:function(){function e(e){e.detail===b.DataSourceStatus.failure&&(t.itemDataSource=null,t.groupDataSource=null)}var t=this,i={beginNotifications:function(){},changed:function(e,i){if(!t._ifZombieDispose()){t._createUpdater();var n=t._updater.elements[H(i)];if(n){var r=t.selection._isIncluded(n.index);if(r&&(t._updater.updateDrag=!0),i!==e){if((t._tabManager.childFocus===i||t._updater.newFocusedItem===i)&&(t._updater.newFocusedItem=e,t._tabManager.childFocus=null),n.itemBox){p.addClass(e,w._itemClass),t._setupAriaSelectionObserver(e);var s=i.nextElementSibling;n.itemBox.removeChild(i),n.itemBox.insertBefore(e,s)}t._setAriaSelected(e,r),t._view.items.setItemAt(n.newIndex,{element:e,itemBox:n.itemBox,container:n.container,itemsManagerRecord:n.itemsManagerRecord}),delete t._updater.elements[H(i)],m._disposeElement(i),t._updater.elements[H(e)]={item:e,container:n.container,itemBox:n.itemBox,index:n.index,newIndex:n.newIndex,itemsManagerRecord:n.itemsManagerRecord}}else n.itemBox&&n.container&&(I._ItemEventsHandler.renderSelection(n.itemBox,e,r,!0),p[r?"addClass":"removeClass"](n.container,w._selectedClass));t._updater.changed=!0}for(var o=0,a=t._notificationHandlers.length;a>o;o++)t._notificationHandlers[o].changed(e,i);t._writeProfilerMark("changed,info")}},removed:function(e,i,n){function r(e){t._updater.updateDrag=!0,t._currentMode()._dragging&&t._currentMode()._draggingUnselectedItem&&t._currentMode()._dragInfo._isIncluded(e)&&(t._updater.newDragInfo=new M._Selection(t,[]));var i=t._updater.selectionFirst[e],n=t._updater.selectionLast[e],r=i||n;r&&(delete t._updater.selectionFirst[r.oldFirstIndex],delete t._updater.selectionLast[r.oldLastIndex],t._updater.selectionChanged=!0)}if(!t._ifZombieDispose()){t._createUpdater();var s=t._insertedItems[n];s&&delete t._insertedItems[n];var o;if(e){var a=t._updater.elements[H(e)],l=t._itemsManager.itemObject(e);if(l&&t._groupFocusCache.deleteItem(l.key),a){if(o=a.index,a.itemBox){var c=a.itemBox,u=w._containerOddClass,d=w._containerEvenClass,h=p.hasClass(c.parentElement,d)?d:u;t._updater.removed.push({index:o,itemBox:c,containerStripe:h})}t._updater.deletesCount++;var _=t._view.items.itemDataAt(o);_.removed=!0,delete t._updater.elements[H(e)]}else o=l&&l.index;t._updater.oldFocus.type!==b.ObjectType.groupHeader&&t._updater.oldFocus.index===o&&(t._updater.newFocus.index=o,t._updater.focusedItemRemoved=!0),r(o)}else o=t._updater.selectionHandles[n],o===+o&&r(o);t._writeProfilerMark("removed("+o+"),info"),t._updater.changed=!0}},updateAffectedRange:function(e){t._itemsCount().then(function(i){var n=t._view.containers?t._view.containers.length:0;e.start=Math.min(e.start,n),t._affectedRange.add(e,i)}),t._createUpdater(),t._updater.changed=!0},indexChanged:function(e,i,n){if(!t._ifZombieDispose()){if(t._createUpdater(),e){var r=t._itemsManager.itemObject(e);r&&t._groupFocusCache.updateItemIndex(r.key,i);var s=t._updater.elements[H(e)];s&&(s.newIndex=i,t._updater.changed=!0),t._updater.itemsMoved=!0}t._currentMode()._dragging&&t._currentMode()._draggingUnselectedItem&&t._currentMode()._dragInfo._isIncluded(n)&&(t._updater.newDragInfo=new M._Selection(t,[{firstIndex:i,lastIndex:i}]),t._updater.updateDrag=!0),t._updater.oldFocus.type!==b.ObjectType.groupHeader&&t._updater.oldFocus.index===n&&(t._updater.newFocus.index=i,t._updater.changed=!0),t._updater.oldSelectionPivot===n&&(t._updater.newSelectionPivot=i,t._updater.changed=!0);var o=t._updater.selectionFirst[n];o&&(o.newFirstIndex=i,t._updater.changed=!0,t._updater.updateDrag=!0),o=t._updater.selectionLast[n],o&&(o.newLastIndex=i,t._updater.changed=!0,t._updater.updateDrag=!0)}},endNotifications:function(){t._update()},inserted:function(e){t._ifZombieDispose()||(t._writeProfilerMark("inserted,info"),t._createUpdater(),t._updater.changed=!0,e.retain(),t._updater.insertsCount++,t._insertedItems[e.handle]=e)},moved:function(e,i,n,r){if(!t._ifZombieDispose()){if(t._createUpdater(),t._updater.movesCount++,e){t._updater.itemsMoved=!0;var s=t._updater.elements[H(e)];s&&(s.moved=!0)}var o=t._updater.selectionHandles[r.handle];if(o===+o){t._updater.updateDrag=!0;var a=t._updater.selectionFirst[o],l=t._updater.selectionLast[o],c=a||l;c&&c.oldFirstIndex!==c.oldLastIndex&&(delete t._updater.selectionFirst[c.oldFirstIndex],delete t._updater.selectionLast[c.oldLastIndex],t._updater.selectionChanged=!0,t._updater.changed=!0)}t._writeProfilerMark("moved("+o+"),info")}},countChanged:function(e,i){t._ifZombieDispose()||(t._writeProfilerMark("countChanged("+e+"),info"),t._cachedCount=e,t._createUpdater(),t._view.lastIndexDisplayed+1===i&&(t._updater.changed=!0),t._updater.countDifference+=e-i)},reload:function(){t._ifZombieDispose()||(t._writeProfilerMark("reload,info"),t._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new C._VersionManager,this._updater=null;var n=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",e,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=w._UNINITIALIZED,this._itemsManager=g._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),i,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(e){return e>=t.indexOfFirstVisible&&e<=t.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",e,!1),this._selection._selected.set(n)},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource._isVirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var e={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:b.ObjectType.item,index:w._INVALID_INDEX},newSelectionPivot:{type:b.ObjectType.item,index:w._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:b.ObjectType.item,index:w._INVALID_INDEX},newFocus:{type:b.ObjectType.item,index:w._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(t,i,n){e.elements[H(i)]={item:i,container:n.container,itemBox:n.itemBox,index:t,newIndex:t,itemsManagerRecord:n.itemsManagerRecord,detached:n.detached}});for(var t=this._selection._selected._ranges,i=0,n=t.length;n>i;i++){var r=t[i],s={newFirstIndex:t[i].firstIndex,oldFirstIndex:t[i].firstIndex,newLastIndex:t[i].lastIndex,oldLastIndex:t[i].lastIndex};e.selectionFirst[s.oldFirstIndex]=s,e.selectionLast[s.oldLastIndex]=s,e.selectionHandles[r.firstPromise.handle]=s.oldFirstIndex,e.selectionHandles[r.lastPromise.handle]=s.oldLastIndex}e.oldSelectionPivot=this._selection._pivot,e.newSelectionPivot=e.oldSelectionPivot,e.oldFocus=this._selection._getFocused(),e.newFocus=this._selection._getFocused(),this._updater=e}},_synchronize:function(){var e=this._updater;if(this._updater=null,this._groupsChanged=!1,this._countDifference=this._countDifference||0,e&&e.changed){e.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),e.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(e.removed.map(function(e){return e.itemBox})),(e.itemsMoved||e.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var t=[];for(var i in e.selectionFirst)if(e.selectionFirst.hasOwnProperty(i)){var n=e.selectionFirst[i];e.selectionChanged=e.selectionChanged||n.newLastIndex-n.newFirstIndex!==n.oldLastIndex-n.oldFirstIndex,n.newFirstIndex<=n.newLastIndex&&t.push({firstIndex:n.newFirstIndex,lastIndex:n.newLastIndex})}if(e.selectionChanged){var r=new M._Selection(this,t);this._selection._fireSelectionChanging(r),this._selection._selected.set(t),this._selection._fireSelectionChanged(),r.clear()}else this._selection._selected.set(t);this._selection._updateCount(this._cachedCount),e.newSelectionPivot=Math.min(this._cachedCount-1,e.newSelectionPivot),this._selection._pivot=e.newSelectionPivot>=0?e.newSelectionPivot:w._INVALID_INDEX,e.newFocus.type!==b.ObjectType.groupHeader&&(e.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,e.newFocus.index))),this._selection._setFocused(e.newFocus,this._selection._keyboardFocused());var s=this._modifiedElements||[],o={};for(this._modifiedElements=[],this._countDifference+=e.countDifference,i=0;i<s.length;i++){var a=s[i];-1===a.newIndex?this._modifiedElements.push(a):o[a.newIndex]=a}for(i=0;i<e.removed.length;i++){var l=e.removed[i],a=o[l.index];a?delete o[l.index]:a={oldIndex:l.index},a.newIndex=-1,a._removalHandled||(a._itemBox=l.itemBox,a._containerStripe=l.containerStripe),this._modifiedElements.push(a)}var c=Object.keys(this._insertedItems);for(i=0;i<c.length;i++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[c[i]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var u={};for(i in e.elements)if(e.elements.hasOwnProperty(i)){var d=e.elements[i];u[d.newIndex]={element:d.item,container:d.container,itemBox:d.itemBox,itemsManagerRecord:d.itemsManagerRecord,detached:d.detached};var a=o[d.index];a?(delete o[d.index],a.newIndex=d.newIndex):a={oldIndex:d.index,newIndex:d.newIndex},a.moved=d.moved,this._modifiedElements.push(a)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var h=Object.keys(o);for(i=0;i<h.length;i++){var _=h[i],a=o[_];-1!==a.oldIndex&&this._modifiedElements.push(a)}this._view.items._itemData=u,e.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?e.newDragInfo&&(this._currentMode()._dragInfo=e.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),e.focusedItemRemoved||this._focusRequest&&e.oldFocus.index!==e.newFocus.index||e.oldFocus.type!==e.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):e.newFocusedItem&&(this._hasKeyboardFocus=e.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var m=this;return this._groups.synchronizeGroups().then(function(){return e.newFocus.type===b.ObjectType.groupHeader&&(e.newFocus.index=Math.min(m._groups.length()-1,e.newFocus.index),e.newFocus.index<0&&(e.newFocus={type:b.ObjectType.item,index:0}),m._selection._setFocused(e.newFocus,m._selection._keyboardFocused())),m._versionManager.endUpdating(),e.deletesCount>0&&m._updateDeleteWrapperSize(),m._view.updateTree(m._cachedCount,m._countDifference,m._modifiedElements)}).then(function(){return m._lastScrollPosition})}this._countDifference+=e?e.countDifference:0;var m=this;return this._groups.synchronizeGroups().then(function(){return e&&m._versionManager.endUpdating(),m._view.updateTree(m._cachedCount,m._countDifference,m._modifiedElements)}).then(function(){return m.scrollPosition})},_updateDeleteWrapperSize:function(e){var t=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+t]=(e?0:this.scrollPosition+this._getViewportSize()[t])+"px"},_verifyRealizationNeededForChange:function(){var e=!1,t=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),i=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(i&&this._updater.elements)for(var n=Object.keys(this._updater.elements),r=0,s=n.length;s>r;r++){var o=this._updater.elements[n[r]],a=o.index-o.newIndex;if(0>a||a>this._updater.deletesCount){i=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,i&&this._view.lastIndexDisplayed<this._view.end-t&&this._updater.deletesCount+this._view.deletesWithoutRealize<t?(e=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(e)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var e=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(t){e._writeProfilerMark("update,StopTM"),e._batchViewUpdates(w._ViewChange.relayout,w._ScrollToPriority.low,t).complete()})):this._batchViewUpdates(w._ViewChange.relayout,w._ScrollToPriority.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var e=this;this._updateJob=d.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){e._updateJob&&e._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groups=this._groupDataSource?new k._UnvirtualizedGroupsContainer(this,this._groupDataSource):new k._NoGroups(this)},_createLayoutSite:function(){var t=this;return Object.create({invalidateLayout:function(){t._pendingLayoutReset=!0;var e="horizontal"===t._layout.orientation!==t._horizontalLayout;t._affectedRange.addAll(),t._batchViewUpdates(w._ViewChange.rebuild,w._ScrollToPriority.low,e?0:t.scrollPosition,!1,!0)},itemFromIndex:function(e){return t._itemsManager._itemPromiseAtIndex(e)},groupFromIndex:function(e){return t._groupsEnabled()?e<t._groups.length()?t._groups.group(e).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(e){return e=Math.max(0,e),t._groups.groupFromItem(e)},renderItem:function(i){return u._cancelBlocker(t._itemsManager._itemFromItemPromise(i)).then(function(i){if(i){var n=t._itemsManager._recordFromElement(i);n.pendingReady&&n.pendingReady(),i=i.cloneNode(!0),p.addClass(i,w._itemClass);var r=e.document.createElement("div");p.addClass(r,w._itemBoxClass),r.appendChild(i);var s=e.document.createElement("div");return p.addClass(s,w._containerClass),s.appendChild(r),s}return u.cancel})},renderHeader:function(i){var n=g._normalizeRendererReturn(t.groupHeaderTemplate(u.wrap(i)));return n.then(function(t){p.addClass(t.element,w._headerClass);var i=e.document.createElement("div");return p.addClass(i,w._headerContainerClass),i.appendChild(t.element),i})},readyToMeasure:function(){t._getViewportLength(),t._getCanvasMargins()},_isZombie:function(){return t._isZombie()},_writeProfilerMark:function(e){t._writeProfilerMark(e)}},{_itemsManager:{enumerable:!0,get:function(){return t._itemsManager}},rtl:{enumerable:!0,get:function(){return t._rtl()}},surface:{enumerable:!0,get:function(){return t._canvas}},viewport:{enumerable:!0,get:function(){return t._viewport}},scrollbarPos:{enumerable:!0,get:function(){return t.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return t._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return t.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return t._animationsDisabled()}},tree:{enumerable:!0,get:function(){return t._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,t.scrollPosition-2*t._getViewportLength()),lastPixel:t.scrollPosition+3*t._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:t.scrollPosition,lastPixel:t.scrollPosition+t._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return t._itemsCount()}},groupCount:{enumerable:!0,get:function(){return t._groups.length()}}})},_initializeLayout:function(){this._affectedRange.addAll();var e=this._createLayoutSite();return this._layout.initialize(e,this._groupsEnabled()),"horizontal"===this._layout.orientation
},_resetLayoutOrientation:function(e){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",p.addClass(this._viewport,w._horizontalClass),p.removeClass(this._viewport,w._verticalClass),e&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",p.addClass(this._viewport,w._verticalClass),p.removeClass(this._viewport,w._horizontalClass),e&&p.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(e){var t=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),t=!0);var i;if(e&&"function"==typeof e.type){var n=V(e.type);i=new n(e)}else i=e&&e.initialize?e:new A.GridLayout(e);t&&this._resetCanvas(),this._layoutImpl=i,this._layout=new A._LayoutWrapper(i),t&&this._unsetFocusOnItem(),this._setFocusOnItem({type:b.ObjectType.item,index:0}),this._selection._setFocused({type:b.ObjectType.item,index:0}),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(t),t&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setSwipeClass:function(){!i.isPhone&&(this._currentMode()instanceof S._SelectionMode&&this._selectionAllowed()&&this._swipeBehavior===b.SwipeBehavior.select||this._dragSource||this._reorderable)?(this._swipeable=!0,p.addClass(this._element,w._swipeableClass)):(this._swipeable=!1,p.removeClass(this._element,w._swipeableClass));var e=this.itemsDraggable||this.itemsReorderable,t=this._selectionAllowed()&&this._swipeBehavior===b.SwipeBehavior.select,n=this._swipeable;this._view.items.each(function(r,s,o){if(o.itemBox){var a=p.hasClass(s,w._nonDraggableClass),l=p.hasClass(s,w._nonSelectableClass),c=p.hasClass(o.itemBox,w._nonSwipeableClass);if(o.itemBox.draggable=e&&!a,!n&&c)p.removeClass(o.itemBox,w._nonSwipeableClass);else if(n){var u=e&&!t&&a||t&&!e&&l||a&&l;u&&!c?p.addClass(o.itemBox,w._nonSwipeableClass):!u&&c&&p.removeClass(o.itemBox,w._nonSwipeableClass)}var d=i.isPhone&&l;p[d?"addClass":"removeClass"](o.itemBox,w._nonSelectableClass)}})},_resizeViewport:function(){this._viewportWidth=w._UNINITIALIZED,this._viewportHeight=w._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info"),d.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==w._UNINITIALIZED&&this._viewportHeight!==w._UNINITIALIZED){var e=this._element.offsetWidth,t=this._element.offsetHeight;if(this._previousWidth!==e||this._previousHeight!==t){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+e+"x"+t+"),info"),this._previousWidth=e,this._previousHeight=t,this._resizeViewport();var i=this;this._affectedRange.addAll(),this._batchViewUpdates(w._ViewChange.relayout,w._ScrollToPriority.low,function(){return{position:i.scrollPosition,direction:"right"}})}}},d.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(e){function t(e){i._changeFocus(i._selection._getFocused(),!0,!1,!1,e)}this._hasKeyboardFocus=!0;var i=this;if(e.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?t(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(e.target===this._element)t();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var n=this._view.items,r={},s=this._groups.headerFrom(e.target),o=null;if(s?(r.type=b.ObjectType.groupHeader,r.index=this._groups.index(s)):(r.index=n.index(e.target),r.type=b.ObjectType.item,s=n.itemBoxAt(r.index),o=n.itemAt(r.index)),r.index!==w._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(r.type===b.ObjectType.groupHeader&&e.target===s||r.type===b.ObjectType.item&&e.target.parentNode===s)&&this._drawFocusRectangle(s),this._tabManager.childFocus!==s&&this._tabManager.childFocus!==o&&(this._selection._setFocused(r,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,s=r.type===b.ObjectType.groupHeader?s:n.itemAt(r.index),this._tabManager.childFocus=s,i._updater))){var a=i._updater.elements[H(s)],l=r.index;a&&a.newIndex&&(l=a.newIndex),i._updater.oldFocus={type:r.type,index:l},i._updater.newFocus={type:r.type,index:l}}}},_onFocusOut:function(e){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var t=this._view.items.itemBoxFrom(e.target)||this._groups.headerFrom(e.target);t&&this._clearFocusRectangle(t)}},_onMSManipulationStateChanged:function(e){function t(){i._manipulationEndSignal=null}var i=this;this._manipulationState=e.currentState,i._writeProfilerMark("_onMSManipulationStateChanged state("+e.currentState+"),info"),this._manipulationState===p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new h,this._manipulationEndSignal.promise.done(t,t)),this._manipulationState===p._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var e=this._viewportScrollPosition;if(e!==this._lastScrollPosition){this._pendingScroll=i._requestAnimationFrame(this._checkScroller.bind(this)),e=Math.max(0,e);var t=this._scrollDirection(e);this._lastScrollPosition=e,this._raiseViewLoading(!0);var n=this;this._view.onScroll(function(){return{position:n._lastScrollPosition,direction:t}},this._manipulationEndSignal?this._manipulationEndSignal.promise:u.timeout(w._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_scrollDirection:function(e){var t=e<this._lastScrollPosition?"left":"right";return t===this._lastDirection?t:this._direction},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(e){var t=this;e.forEach(function(e){var i=!1;if("dir"===e.attributeName?i=!0:"style"===e.attributeName&&(i=t._cachedStyleDir!==e.target.style.direction),i&&(t._cachedStyleDir=e.target.style.direction,t._cachedRTL=null,p[t._rtl()?"addClass":"removeClass"](t._element,w._rtlListViewClass),t._lastScrollPosition=0,t._viewportScrollPosition=0,t.forceLayout()),"tabIndex"===e.attributeName){var n=t._element.tabIndex;n>=0&&(t._view.items.each(function(e,t){t.tabIndex=n}),t._tabIndex=n,t._tabManager.tabIndex=n,t._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=A._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(e,t){function i(i,n){void 0!==e[i]&&(e[i]=t(e[i],n))}var n;return this._horizontal()?(n=this._getCanvasMargins()[this._rtl()?"right":"left"],i("left",n)):(n=this._getCanvasMargins().top,i("top",n)),i("begin",n),i("end",n),e},_convertFromCanvasCoordinates:function(e){return this._convertCoordinatesByCanvasMargins(e,function(e,t){return e+t})},_convertToCanvasCoordinates:function(e){return this._convertCoordinatesByCanvasMargins(e,function(e,t){return e-t})},_getViewportSize:function(){return(this._viewportWidth===w._UNINITIALIZED||this._viewportHeight===w._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,p.getContentWidth(this._element)),this._viewportHeight=Math.max(0,p.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function e(){t._itemsCountPromise=null}var t=this;if(this._cachedCount!==w._UNINITIALIZED)return u.wrap(this._cachedCount);var i;return this._itemsCountPromise?i=this._itemsCountPromise:(i=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(e){return e===b.CountResult.unknown&&(e=0),t._cachedCount=e,t._selection._updateCount(t._cachedCount),e},function(){return u.cancel}),this._itemsCountPromise.then(e,e)),i},_isSelected:function(e){return this._selection._isIncluded(e)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(e){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!e),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_setViewState:function(t){if(t!==this._loadingState){var i=null;switch(t){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(D(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:i={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+t+",info"),this._loadingState=t;var n=e.document.createEvent("CustomEvent");n.initCustomEvent("loadingstatechanged",!0,!1,i),this._element.dispatchEvent(n)}},_createTemplates:function(){function t(t,i){var n=e.document.createElement("div");return n.className=t,i||n.setAttribute("aria-hidden",!0),n}this._itemBoxTemplate=t(w._itemBoxClass,!0)},_updateSelection:function(){var e=this._selection.getIndices(),t=this._selection.isEverything(),i={};if(!t)for(var n=0,r=e.length;r>n;n++){var s=e[n];i[s]=!0}this._view.items.each(function(e,n,r){if(r.itemBox&&!p.hasClass(r.itemBox,w._swipeClass)){var s=t||!!i[e];I._ItemEventsHandler.renderSelection(r.itemBox,n,s,!0),r.container&&p[s?"addClass":"removeClass"](r.container,w._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===e.getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(e,t,i){var n=this._progressBar,r=n.style;if(!n.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var s=this;this._progressIndicatorDelayTimer=u.timeout(w._LISTVIEW_PROGRESS_DELAY).then(function(){s._isZombie()||(e.appendChild(n),W.fadeInElement(n),s._progressIndicatorDelayTimer=null)})}r[this._rtl()?"right":"left"]=t,r.top=i},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var e=this._progressBar;if(e.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var t=this;W.fadeOutElement(e).then(function(){e.parentNode&&e.parentNode.removeChild(e),t._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(e,t,r){if(i.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new n("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",U.notCompatibleWithSemanticZoom);this._isZoomedOut=e,this._disableEntranceAnimation=!t,this._isCurrentZoomView=t,this._triggerZoom=r},_setCurrentItem:function(e,t){this._rtl()&&(e=this._viewportWidth-e),this._horizontal()?e+=this.scrollPosition:t+=this.scrollPosition;var i=this._view.hitTest(e,t),n={type:i.type?i.type:b.ObjectType.item,index:i.index};n.index>=0&&(this._hasKeyboardFocus?this._changeFocus(n,!0,!1,!0):this._changeFocusPassively(n))},_getCurrentItem:function(){var e=this._selection._getFocused();e.type===b.ObjectType.groupHeader&&(e={type:b.ObjectType.item,index:this._groups.group(e.index).startIndex}),"number"!=typeof e.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),e=this._selection._getFocused());var t=this,i=this._getItemOffsetPosition(e.index).then(function(e){var i=t._canvasStart;return e[t._startProperty]+=i,e});return u.join({item:this._dataSource.itemFromIndex(e.index),position:i})},_animateItemsForPhoneZoom:function(){function e(e,t,i){return function(n){return(t[n]-e)*i}}function t(){for(var e=0,t=i.length;t>e;e++)i[e].style[F.scriptName]=""}for(var i=[],n=[],r=[],s=Number.MAX_VALUE,o=this,a=this._view.firstIndexDisplayed,c=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);c>a;a++)r.push(this._view.waitForEntityPosition({type:b.ObjectType.item,index:a}).then(function(){i.push(o._view.items.containerAt(a));var e=0;if(o.layout._getItemPosition){var t=o.layout._getItemPosition(a);t.row&&(e=t.row)}n.push(e),s=Math.min(e,s)}));return u.join(r).then(function(){return(0===i.length?u.wrap():l.executeTransition(i,{property:F.cssName,delay:e(s,n,30),duration:100,timing:"ease-in-out",from:o._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:o._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(t,t)}).then(t,t)},_beginZoom:function(){this._zooming=!0;var e=null;if(i.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var t=this,n=function(){t._zoomAnimationPromise=null};this._zoomAnimationPromise=e=this._animateItemsForPhoneZoom().then(n,n)}else this._zoomAnimationPromise=new h,e=this._zoomAnimationPromise.promise}else{var r=this._horizontal(),s=-this.scrollPosition;p.addClass(this._viewport,r?w._zoomingXClass:w._zoomingYClass),this._canvasStart=s,p.addClass(this._viewport,r?w._zoomingYClass:w._zoomingXClass)}return e},_positionItem:function(e,t){function r(e){return s._getItemOffsetPosition(e).then(function(n){var r,o=s._horizontal(),a=s._viewport[o?"scrollWidth":"scrollHeight"],l=o?s._viewportWidth:s._viewportHeight,c=o?"headerContainerWidth":"headerContainerHeight",u=s.layout._sizes,d=0;u&&u[c]&&(d=u[c]);var h=i.isPhone?d:t[s._startProperty],_=l-(o?n.width:n.height);h=Math.max(0,Math.min(_,h)),r=n[s._startProperty]-h;var m=Math.max(0,Math.min(a-l,r)),p=m-r;r=m;var f={type:b.ObjectType.item,index:e};if(s._hasKeyboardFocus?s._changeFocus(f,!0):s._changeFocusPassively(f),s._raiseViewLoading(!0),i.isPhone)s._viewportScrollPosition=r;else{var g=-r;s._canvasStart=g}if(s._view.realizePage(r,!0),i.isPhone&&s._isZoomedOut){var v=function(){s._zoomAnimationPromise&&s._zoomAnimationPromise.complete&&s._zoomAnimationPromise.complete(),s._zoomAnimationPromise=null};s._animateItemsForPhoneZoom().then(v,v)}return o?{x:p,y:0}:{x:0,y:p}})}var s=this,o=0;if(e&&(o=this._isZoomedOut?e.groupIndexHint:e.firstItemIndexHint),"number"==typeof o)return r(o);var a,l=this._isZoomedOut?e.groupKey:e.firstItemKey;if("string"==typeof l&&this._dataSource.itemFromKey)a=this._dataSource.itemFromKey(l,this._isZoomedOut?{groupMemberKey:e.key,groupMemberIndex:e.index}:null);else{var c=this._isZoomedOut?e.groupDescription:e.firstItemDescription;if(i.validation&&void 0===c)throw new n("WinJS.UI.ListView.InvalidItem",U.listViewInvalidItem);a=this._dataSource.itemFromDescription(c)}return a.then(function(e){return r(e.index)})},_endZoom:function(e){if(!this._isZombie()){if(!i.isPhone){var t=this._canvasStart;p.removeClass(this._viewport,w._zoomingYClass),p.removeClass(this._viewport,w._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-t}this._disableEntranceAnimation=!e,this._isCurrentZoomView=e,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(e){var t=this;return this._getItemOffset({type:b.ObjectType.item,index:e}).then(function(e){return t._ensureFirstColumnRange(b.ObjectType.item).then(function(){return e=t._correctRangeInFirstColumn(e,b.ObjectType.item),e=t._convertFromCanvasCoordinates(e),t._horizontal()?(e.left=e.begin,e.width=e.end-e.begin,e.height=e.totalHeight):(e.top=e.begin,e.height=e.end-e.begin,e.width=e.totalWidth),e})})},_groupRemoved:function(e){this._groupFocusCache.deleteGroup(e)},_updateFocusCache:function(e){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var t=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(e).then(function(){t._updateFocusCacheItemRequest=null;var i=t._view.items.itemDataAt(e),n=t._groups.groupFromItem(e),r=t._groups.group(n).key;i.itemsManagerRecord.item&&t._groupFocusCache.updateCache(r,i.itemsManagerRecord.item.key,e)})},_changeFocus:function(e,t,i,n,r){if(!this._isZombie()){var s;if(e.type!==b.ObjectType.groupHeader)s=this._view.items.itemAt(e.index),!t&&s&&p.hasClass(s,w._nonSelectableClass)&&(t=!0),this._updateFocusCache(e.index);else{var o=this._groups.group(e.index);s=o&&o.header}this._unsetFocusOnItem(!!s),this._hasKeyboardFocus=!0,this._selection._setFocused(e,r),n||this.ensureVisible(e),!t&&this._selectFocused(i)&&this._selection.set(e.index),this._setFocusOnItem(e)}},_changeFocusPassively:function(e){var t;if(e.type!==b.ObjectType.groupHeader)t=this._view.items.itemAt(e.index),this._updateFocusCache(e.index);else{var i=this._groups.group(e.index);t=i&&i.header}this._unsetFocusOnItem(!!t),this._selection._setFocused(e),this._setFocusOnItem(e)},_drawFocusRectangle:function(t){if(p.hasClass(t,w._headerClass))p.addClass(t,w._itemFocusClass);else{var i=this._view.items.itemBoxFrom(t);if(i.querySelector("."+w._itemFocusOutlineClass))return;p.addClass(i,w._itemFocusClass);var n=e.document.createElement("div");n.className=w._itemFocusOutlineClass,i.appendChild(n)}},_clearFocusRectangle:function(e){if(e&&!this._isZombie()){var t=this._view.items.itemBoxFrom(e);if(t){p.removeClass(t,w._itemFocusClass);var i=t.querySelector("."+w._itemFocusOutlineClass);i&&i.parentNode.removeChild(i)}else{var n=this._groups.headerFrom(e);n&&p.removeClass(n,w._itemFocusClass)}}},_defaultInvoke:function(e){(this._isZoomedOut||i.isPhone&&this._triggerZoom&&e.type===b.ObjectType.groupHeader)&&(this._changeFocusPassively(e),this._triggerZoom())},_selectionAllowed:function(e){var t=void 0!==e?this.elementFromIndex(e):null,i=!(t&&p.hasClass(t,w._nonSelectableClass));return i&&this._selectionMode!==b.SelectionMode.none},_multiSelection:function(){return this._selectionMode===b.SelectionMode.multi},_selectOnTap:function(){return this._tap===b.TapBehavior.toggleSelect||this._tap===b.TapBehavior.directSelect},_selectFocused:function(e){return this._tap===b.TapBehavior.directSelect&&this._selectionMode===b.SelectionMode.multi&&!e},_dispose:function(){if(!this._disposed){this._disposed=!0;var e=function(e){e&&(e.textContent="")};p._resizeNotifier.unsubscribe(this._element,this._onMSElementResizeBound),this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),e(this._viewport),e(this._canvas),e(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var t=z.indexOf(this);t>=0&&z.splice(t,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&e.document.body.contains(this.element))},_ifZombieDispose:function(){var e=this._isZombie();return e&&!this._disposed&&D(this),e},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!l.isAnimationEnabled()},_fadeOutViewport:function(){var e=this;return new u(function(t){if(e._animationsDisabled())return void t();if(!e._fadingViewportOut){e._waitingEntranceAnimationPromise&&(e._waitingEntranceAnimationPromise.cancel(),e._waitingEntranceAnimationPromise=null);var n=e._fireAnimationEvent(q.contentTransition);e._firedAnimationEvent=!0;var r=i._browserStyleEquivalents["overflow-style"],s=r?e._viewport:e._canvas;n.prevented?(e._disableEntranceAnimation=!0,s.style.opacity=1,t()):(e._fadingViewportOut=!0,r&&(s.style[r.scriptName]="none"),W.fadeOutElement(s).then(function(){e._isZombie()||(e._fadingViewportOut=!1,s.style.opacity=1,t())}))}})},_animateListEntrance:function(e){function t(){r._canvas.style.opacity=1,s&&(o.style[s.scriptName]="")}var n={prevented:!1,animationPromise:u.wrap()},r=this,s=i._browserStyleEquivalents["overflow-style"],o=s?this._viewport:this._canvas;return this._disableEntranceAnimation||this._animationsDisabled()?(t(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),u.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:n=this._fireAnimationEvent(q.entrance),n.prevented||i.isPhone?(t(),u.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,s&&(o.style[s.scriptName]="none"),this._waitingEntranceAnimationPromise=n.animationPromise.then(function(){return r._isZombie()?void 0:(r._canvas.style.opacity=1,W.animateEntrance(o,e).then(function(){r._isZombie()||(s&&(o.style[s.scriptName]=""),r._waitingEntranceAnimationPromise=null)}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(t){var i=e.document.createEvent("CustomEvent"),n=u.wrap();i.initCustomEvent("contentanimating",!0,!0,{type:t}),t===q.entrance&&(i.detail.setPromise=function(e){n=e});var r=!this._element.dispatchEvent(i);return{prevented:r,animationPromise:n}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",U.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=e.document.createElement("div"),this._ariaStartMarker.id=H(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=e.document.createElement("div"),this._ariaEndMarker.id=H(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var e,t,i=this,n=this._element.getAttribute("role");this._currentMode().staticMode()?(e="list",t="listitem"):(e="listbox",t="option"),(n!==e||this._itemRole!==t)&&(this._element.setAttribute("role",e),this._itemRole=t,this._view.items.each(function(e,t){t.setAttribute("role",i._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var e=this.groupHeaderTapBehavior===b.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==e){this._headerRole=e;for(var t=0,i=this._groups.length();i>t;t++){var n=this._groups.group(t).header;n&&n.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(e,t){var i="true"===e.getAttribute("aria-selected");t!==i&&e.setAttribute("aria-selected",t)},_setupAriaSelectionObserver:function(e){e._mutationObserver||(this._mutationObserver.observe(e,{attributes:!0,attributeFilter:["aria-selected"]}),e._mutationObserver=!0)},_itemPropertyChange:function(e){function t(e){e.forEach(function(e){e.item.setAttribute("aria-selected",!e.selected)})}if(!this._isZombie()){for(var i=this,n=i._selectionMode===b.SelectionMode.single,r=[],s=[],o=0,a=e.length;a>o;o++){var l=e[o].target,c=i._view.items.itemBoxFrom(l),u="true"===l.getAttribute("aria-selected");if(c&&u!==p._isSelectionRendered(c)){var d=i._view.items.index(c),_={index:d,item:l,selected:u};(i._selectionAllowed(d)?r:s).push(_)}}if(r.length>0){var m=new h;i.selection._synchronize(m).then(function(){var e=i.selection._cloneSelection();return r.forEach(function(t){t.selected?e[n?"set":"add"](t.index):e.remove(t.index)}),i.selection._set(e)}).then(function(e){i._isZombie()||e||t(r),m.complete()})}t(s)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(e,t){var i=this;return this._view.waitForEntityPosition(e).then(function(){var n=e.type===b.ObjectType.groupHeader?i._view._getHeaderContainer(e.index):i._view.getContainer(e.index);if(n){i._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info");var r,s;i._view._expandedRange?(r=i._view._expandedRange.first.index,s=i._view._expandedRange.last.index):t=!1,e.type===b.ObjectType.item?(t=!!t,t&=i._view._ensureContainerInDOM(e.index)):t=!1;var o=i._getItemMargins(e.type),a={left:i._rtl()?O(n)-o.right:n.offsetLeft-o.left,top:n.offsetTop-o.top,totalWidth:p.getTotalWidth(n),totalHeight:p.getTotalHeight(n),contentWidth:p.getContentWidth(n),contentHeight:p.getContentHeight(n)};return t&&i._view._forceItemsBlocksInDOM(r,s+1),i._zooming&&0!==i._canvasStart?a:i._convertToCanvasCoordinates(a)}return u.cancel})},_getItemOffset:function(e,t){var i=this;return this._getItemPosition(e,t).then(function(t){var n=i._getItemMargins(e.type);if(i._horizontal()){var r=i._rtl();t.begin=t.left-n[r?"left":"right"],t.end=t.left+t.totalWidth+n[r?"right":"left"]}else t.begin=t.top-n.bottom,t.end=t.top+t.totalHeight+n.top;return t})},_getItemMargins:function(t){t=t||b.ObjectType.item;var i=this,n=function(t){var n,r=i._canvas.querySelector("."+t);r||(r=e.document.createElement("div"),p.addClass(r,t),i._viewport.appendChild(r),n=!0);var s=A._getMargins(r);return n&&i._viewport.removeChild(r),s};return t!==b.ObjectType.groupHeader?this._itemMargins?this._itemMargins:this._itemMargins=n(w._containerClass):this._headerMargins?this._headerMargins:this._headerMargins=n(w._headerContainerClass)},_fireAccessibilityAnnotationCompleteEvent:function(t,i,n,r){var s={firstIndex:t,lastIndex:i,firstHeaderIndex:+n||-1,lastHeaderIndex:+r||-1},o=e.document.createEvent("CustomEvent");o.initCustomEvent("accessibilityannotationcomplete",!0,!1,s),this._element.dispatchEvent(o)},_ensureFirstColumnRange:function(e){var t=e===b.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[t])return u.wrap();var i=this;return this._getItemOffset({type:e,index:0},!0).then(function(e){i[t]=e})},_correctRangeInFirstColumn:function(e,t){var i=t===b.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return i.begin===e.begin&&(e.begin=this._horizontal()?-this._getCanvasMargins()[this._rtl()?"right":"left"]:-this._getCanvasMargins().top),e},_updateContainers:function(t,i,n,r){function s(){var t=e.document.createElement("div");return t.className=w._containerClass,t}function o(t,i,n){i+n>_&&(n=_-i);var r,s=t.itemsContainer,o=s.itemsBlocks,a=h._view._blockSize,l=o.length?o[o.length-1]:null,c=o.length?(o.length-1)*a+l.items.length:0,u=n-c;if(u>0){var d,m=u;if(l&&l.items.length<a){var p=Math.min(m,a-l.items.length);d=l.items.length;var f=P._stripedContainers(p,c);v.insertAdjacentHTMLUnsafe(l.element,"beforeend",f),r=l.element.children;for(var b=0;p>b;b++)l.items.push(r[d+b]);m-=p}c=o.length*a;var C=Math.floor(m/a),w="",I=c,S=c+a,E=["<div class='win-itemsblock'>"+P._stripedContainers(a,I)+"</div>","<div class='win-itemsblock'>"+P._stripedContainers(a,S)+"</div>"];w=P._repeat(E,C),c+=C*a;var x=m%a;x&&(w+="<div class='win-itemsblock'>"+P._stripedContainers(x,c)+"</div>",c+=x,C++);var k=e.document.createElement("div");v.setInnerHTMLUnsafe(k,w);for(var r=k.children,b=0;C>b;b++){var T=r[b],A={element:T,items:P._nodeListToArray(T.children)};o.push(A)}}else if(0>u)for(var M=u;0>M;M++){var B=l.items.pop();!h._view._requireFocusRestore&&B.contains(e.document.activeElement)&&(h._view._requireFocusRestore=e.document.activeElement,h._unsetFocusOnItem()),l.element.removeChild(B),y.push(B),l.items.length||(s.element===l.element.parentNode&&s.element.removeChild(l.element),o.pop(),l=o[o.length-1])}for(var b=0,L=o.length;L>b;b++)for(var T=o[b],M=0;M<T.items.length;M++)g.push(T.items[M])}function a(e,t,i){for(var n=r.filter(function(e){return-1===e.oldIndex&&e.newIndex>=t&&e.newIndex<t+i}).sort(function(e,t){return e.newIndex-t.newIndex}),o=e.itemsContainer,a=0,l=n.length;l>a;a++){var c=n[a],u=c.newIndex-t,d=s(),h=u<o.items.length?o.items[u]:null;o.items.splice(u,0,d),o.element.insertBefore(d,h)}}function l(e,t,i){t+i>_&&(i=_-t);var n=e.itemsContainer,r=i-n.items.length;if(r>0){var s=n.element.children,o=s.length;v.insertAdjacentHTMLUnsafe(n.element,"beforeend",P._repeat("<div class='win-container win-backdrop'></div>",r));for(var a=0;r>a;a++){var l=s[o+a];n.items.push(l)}}for(var a=r;0>a;a++){var l=n.items.pop();n.element.removeChild(l),y.push(l)}for(var a=0,c=n.items.length;c>a;a++)g.push(n.items[a])}function c(e,t){var i=h._view._createHeaderContainer(B),n={header:i,itemsContainer:{element:h._view._createItemsContainer(i)}};return n.itemsContainer[h._view._blockSize?"itemsBlocks":"items"]=[],h._view._blockSize?o(n,t,e.size):l(n,t,e.size),n}function u(e,t,n,s){for(var o,a,l=n+s-1,c=0,u=r.length;u>c;c++){var d=r[c];d.newIndex>=n&&d.newIndex<=l&&-1!==d.oldIndex&&(o!==+o||d.newIndex<o)&&(o=d.newIndex,a=d.newIndex-d.oldIndex)}if(o===+o){var _=0;for(c=0,u=r.length;u>c;c++){var d=r[c];d.newIndex>=n&&d.newIndex<o&&-1===d.oldIndex&&_++}var m=0,p=o-a;for(c=0,u=r.length;u>c;c++){var d=r[c];d.oldIndex>=t&&d.oldIndex<p&&-1===d.newIndex&&m++}a+=m,a-=_,a-=n-t;var f=e.itemsContainer;if(a>0){var g=f.element.children;v.insertAdjacentHTMLUnsafe(f.element,"afterBegin",P._repeat("<div class='win-container win-backdrop'></div>",a));for(var y=0;a>y;y++){var b=g[y];f.items.splice(y,0,b)}}for(var y=a;0>y;y++){var b=f.items.shift();f.element.removeChild(b)}a&&h._affectedRange.add({start:n,end:n+s},i)}}function d(e){for(var t=0,i=0,n=h._view.tree.length;n>i;i++){var r=h._view.tree[i],s=r.itemsContainer.items.length,o=t+s-1;if(e>=t&&o>=e)return{group:i,item:e-t};t+=s}}var h=this,_=this._view.containers.length+(n>0?n:0),m=[],f={},g=[],y=[],b=[],C=0;if(!h._view._blockSize)for(var I=0,S=this._view.tree.length;S>I;I++)b.push(C),C+=this._view.tree[I].itemsContainer.items.length;if(!h._view._blockSize)for(var E=r.filter(function(e){return-1===e.newIndex&&!e._removalHandled}).sort(function(e,t){return t.oldIndex-e.oldIndex}),I=0,S=E.length;S>I;I++){var x=E[I];x._removalHandled=!0;var k=x._itemBox;x._itemBox=null;var T=d(x.oldIndex),A=this._view.tree[T.group],M=A.itemsContainer.items[T.item];M.parentNode.removeChild(M),p.hasClass(k,w._selectedClass)&&p.addClass(M,w._selectedClass),A.itemsContainer.items.splice(T.item,1),x.element=M}this._view._modifiedGroups=[];var B=this._canvasProxy;C=0;for(var I=0,S=t.length;S>I&&(!this._groupsEnabled()||_>C);I++){var L=t[I],D=this._view.keyToGroupIndex[L.key],O=this._view.tree[D];if(O)h._view._blockSize?o(O,C,L.size):(u(O,b[D],C,L.size),a(O,C,L.size),l(O,C,L.size)),m.push(O),f[L.key]=m.length-1,delete this._view.keyToGroupIndex[L.key],B=O.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:D,newIndex:m.length-1,element:O.header});else{var R=c(L,C);m.push(R),f[L.key]=m.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:m.length-1,element:R.header}),B=R.itemsContainer.element}C+=L.size}for(var F=[],N=[],z=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],I=0,S=z.length;S>I;I++){var T=this._view.keyToGroupIndex[z[I]],H=this._view.tree[T];if(N.push(H.header),F.push(H.itemsContainer.element),this._view._blockSize)for(var W=0;W<H.itemsContainer.itemsBlocks.length;W++)for(var U=H.itemsContainer.itemsBlocks[W],V=0;V<U.items.length;V++)y.push(U.items[V]);else for(var V=0;V<H.itemsContainer.items.length;V++)y.push(H.itemsContainer.items[V]);this._view._modifiedGroups.push({oldIndex:T,newIndex:-1,element:H.header})}for(var I=0,S=r.length;S>I;I++)if(-1===r[I].newIndex&&!r[I]._removalHandled){r[I]._removalHandled=!0;var k=r[I]._itemBox;r[I]._itemBox=null;var M;y.length?(M=y.pop(),p.empty(M)):M=s(),p.hasClass(k,w._selectedClass)&&p.addClass(M,w._selectedClass),r._containerStripe===w._containerEvenClass?(p.addClass(M,w._containerEvenClass),p.removeClass(M,w._containerOddClass)):(p.addClass(M,w._containerOddClass),p.removeClass(M,w._containerEvenClass)),M.appendChild(k),r[I].element=M
}return this._view.tree=m,this._view.keyToGroupIndex=f,this._view.containers=g,{removedHeaders:N,removedItemsContainers:F}},_writeProfilerMark:function(e){var t="WinJS.UI.ListView:"+this._id+":"+e;a(t),s.log&&s.log(t,null,"listviewprofiler")}},{triggerDispose:function(){L()}});return t.Class.mix(T,r.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","accessibilityannotationcomplete")),t.Class.mix(T,_.DOMEventMixin),T})})}),define("WinJS/Controls/FlipView/_Constants",[],function(){"use strict";var e={};return e.datasourceCountChangedEvent="datasourcecountchanged",e.pageVisibilityChangedEvent="pagevisibilitychanged",e.pageSelectedEvent="pageselected",e.pageCompletedEvent="pagecompleted",e}),define("WinJS/Controls/FlipView/_PageManager",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_TabContainer","./_Constants"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_FlipPageManager:i.Namespace._lazy(function(){function e(e){var t=e.winControl;return t&&t._isFlipView?!0:!1}function o(e){e.forEach(function(e){var i=e.target;i.winControl&&i.tabIndex>=0&&(i.winControl._pageManager._updateTabIndex(i.tabIndex),i.tabIndex=-1);var n=i.winControl;if(n&&n._isFlipView){var r=!1;"dir"===e.attributeName?r=!0:"style"===e.attributeName&&(r=n._cachedStyleDir!==i.style.direction),r&&(n._cachedStyleDir=i.style.direction,n._pageManager._rtl="rtl"===t.getComputedStyle(n._pageManager._flipperDiv,null).direction,n._pageManager.resized())}})}var f=_._uniqueID,g=n._browserStyleEquivalents,v=50,y=250,b={get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"}},C=i.Class.define(function(e,i,r,s,a,l,c){this._visibleElements=[],this._flipperDiv=e,this._panningDiv=i,this._panningDivContainer=r,this._buttonVisibilityHandler=c,this._currentPage=null,this._rtl="rtl"===t.getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=s,this._itemSpacing=a,this._tabIndex=_.getTabIndex(e),this._tabIndex<0&&(this._tabIndex=0),i.tabIndex=-1,e.tabIndex=-1,this._tabManager=new m.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=C.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=l;var u=this;this._panningDiv.addEventListener("keydown",function(e){u._blockTabs&&e.keyCode===_.Key.tab&&(e.stopImmediatePropagation(),e.preventDefault())},!0),_._addEventListener(this._flipperDiv,"focusin",function(e){e.target===u._flipperDiv&&u._currentPage.element&&_._setActive(u._currentPage.element)},!1),new _._MutationObserver(o).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._handleManipulationStateChangedBound=this._handleManipulationStateChanged.bind(this),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(n._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0)},{initialize:function(e,i){var n=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._isHorizontal=i,!this._currentPage){this._bufferAriaStartMarker=t.document.createElement("div"),this._bufferAriaStartMarker.id=f(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),n=this._currentPage,this._panningDiv.appendChild(n.pageRoot);for(var r=2*this._bufferSize,s=0;r>s;s++)n=this._createFlipPage(n,this),this._panningDiv.appendChild(n.pageRoot);this._bufferAriaEndMarker=t.document.createElement("div"),this._bufferAriaEndMarker.id=f(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,e)},dispose:function(){var e=this._currentPage,t=e;do h._disposeElement(t.element),t=t.next;while(t!==e)},setOrientation:function(e){if(this._notificationsEndedSignal){var t=this;return void this._notificationsEndedSignal.promise.done(function(){t._notificationsEndedSignal=null,t.setOrientation(e)})}if(e!==this._isHorizontal){this._isOrientationChanging=!0,this._isHorizontal?_.setScrollPosition(this._panningDivContainer,{scrollLeft:this._getItemStart(this._currentPage),scrollTop:0}):_.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:this._getItemStart(this._currentPage)}),this._isHorizontal=e;var i=this._panningDivContainer.style;i.overflowX="hidden",i.overflowY="hidden";var t=this;n._requestAnimationFrame(function(){t._isOrientationChanging=!1,t._forEachPage(function(e){var t=e.pageRoot.style;t.left="0px",t.top="0px"}),i.overflowX=t._isHorizontal&&t._environmentSupportsTouch?"scroll":"hidden",i.overflowY=t._isHorizontal||!t._environmentSupportsTouch?"hidden":"scroll",t._ensureCentered()})}},resetState:function(e){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==e){var t=this.jumpToIndex(e,!0);if(!t&&n.validation)throw new r("WinJS.UI.FlipView.BadCurrentPage",b.badCurrentPage);return t}h.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var i=this,s=c.wrap(!0);return this._itemsManager&&(s=i._itemsManager._firstItem().then(function(e){return i._currentPage.setElement(e),i._fetchPreviousItems(!0).then(function(){return i._fetchNextItems()}).then(function(){i._setButtonStates()})})),s.then(function(){i._tabManager.childFocus=i._currentPage.element,i._ensureCentered(),i._itemSettledOn()})},setNewItemsManager:function(e,t){this._itemsManager=e;var i=this;return this.resetState(t).then(function(){0!==t&&(i._tabManager.childFocus=i._currentPage.element,i._ensureCentered(),i._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var e=0,t=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return t&&(e=this._getElementIndex(t)),e},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._hasFocus&&(this._hadFocus=!0),this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var e=this._getViewportStart(),t=this._lastScrollPos>e?this._getTailOfBuffer():this._getHeadOfBuffer();if(e!==this._lastScrollPos){for(;this._currentPage.element&&this._getItemStart(this._currentPage)>e&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(t.prev),t=t.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=e&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(t.next),t=t.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=e,this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element),this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(e,t){var i=this;if(this._forEachPage(function(n){return n.element===t?(n===i._currentPage||n===i._currentPage.next?i._changeFlipPage(n,t,e):n.setElement(e,!0),!0):void 0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var n=this._navigationAnimationRecord.elementContainers,r=0,s=n.length;s>r;r++)n[r].element===t&&(i._changeFlipPage(n[r],t,e),n[r].element=e);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var e=this;this._forEachPage(function(t){t.pageRoot.style.width=e._panningDivContainerOffsetWidth+"px",t.pageRoot.style.height=e._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(e,t){if(!t){if(!this._itemsManager||!this._currentPage.element||0>e)return c.wrap(!1);var i=this._getElementIndex(this._currentPage.element),n=Math.abs(e-i);if(0===n)return c.wrap(!1)}var r=c.wrap(!0),s=this;return r=r.then(function(){var i=s._itemsManager._itemPromiseAtIndex(e);return c.join({element:s._itemsManager._itemFromItemPromise(i),item:i}).then(function(e){var i=e.element;return s._resetBuffer(i,t),i?(s._currentPage.setElement(i),s._fetchNextItems().then(function(){return s._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),r=r.then(function(e){return s._setButtonStates(),e})},startAnimatedNavigation:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var n=this._currentPage,r=e?this._currentPage.next:this._currentPage.prev;if(r.element){this._hasFocus&&_._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=e,this._navigationAnimationRecord.cancelAnimationCallback=t,this._navigationAnimationRecord.completionCallback=i,this._navigationAnimationRecord.oldCurrentPage=n,this._navigationAnimationRecord.newCurrentPage=r;var s=n.element,o=r.element;this._navigationAnimationRecord.newCurrentElement=o,n.setElement(null,!0),n.elementUniqueID=f(s),r.setElement(null,!0),r.elementUniqueID=f(o);var a=this._createDiscardablePage(s),l=this._createDiscardablePage(o);return a.pageRoot.itemIndex=this._getElementIndex(s),l.pageRoot.itemIndex=a.pageRoot.itemIndex+(e?1:-1),a.pageRoot.style.position="absolute",l.pageRoot.style.position="absolute",a.pageRoot.style.zIndex=1,l.pageRoot.style.zIndex=2,this._setItemStart(a,0),this._setItemStart(l,0),this._blockTabs=!0,this._visibleElements.push(o),this._announceElementVisible(o),this._navigationAnimationRecord.elementContainers=[a,l],{outgoing:a,incoming:l}}}return null},endAnimatedNavigation:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var n=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,t);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,i),n||this._setViewportStart(this._getItemStart(e?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._hasFocus&&(this._hadFocus=!0),this._currentPage.element){var n=this._currentPage.element,r=this._getElementIndex(n),s=this;return s.jumpToIndex(e).then(function(o){if(!o)return null;if(s._navigationAnimationRecord={},s._navigationAnimationRecord.cancelAnimationCallback=t,s._navigationAnimationRecord.completionCallback=i,s._navigationAnimationRecord.oldCurrentPage=null,s._forEachPage(function(e){return e.element===n?(s._navigationAnimationRecord.oldCurrentPage=e,!0):void 0}),s._navigationAnimationRecord.newCurrentPage=s._currentPage,s._navigationAnimationRecord.newCurrentPage===s._navigationAnimationRecord.oldCurrentPage)return null;var a=s._currentPage.element;s._navigationAnimationRecord.newCurrentElement=a,s._currentPage.setElement(null,!0),s._currentPage.elementUniqueID=f(a),s._navigationAnimationRecord.oldCurrentPage&&s._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var l=s._createDiscardablePage(n),c=s._createDiscardablePage(a);return l.pageRoot.itemIndex=r,c.pageRoot.itemIndex=e,l.pageRoot.style.position="absolute",c.pageRoot.style.position="absolute",l.pageRoot.style.zIndex=1,c.pageRoot.style.zIndex=2,s._setItemStart(l,0),s._setItemStart(c,s._itemSize(s._currentPage)),s._visibleElements.push(a),s._announceElementVisible(a),s._navigationAnimationRecord.elementContainers=[l,c],s._blockTabs=!0,{oldPage:l,newPage:c}})}return c.wrap(null)},simulateMouseWheelScroll:function(e){if(!this._environmentSupportsTouch&&!this._waitingForMouseScroll){var i;i="number"==typeof e.deltaY?(e.deltaX||e.deltaY)>0:e.wheelDelta<0;var n=i?this._currentPage.next:this._currentPage.prev;if(n.element){var r={contentX:0,contentY:0,viewportX:0,viewportY:0};r[this._isHorizontal?"contentX":"contentY"]=this._getItemStart(n),_._zoomTo(this._panningDivContainer,r),this._waitingForMouseScroll=!0,t.setTimeout(function(){this._waitingForMouseScroll=!1}.bind(this),_._zoomToDuration+100)}}},endAnimatedJump:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(e.element,!0):e.element.parentNode&&e.element.parentNode.removeChild(e.element),this._navigationAnimationRecord.newCurrentPage.setElement(t.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(e,t,i,n){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var r=this._prevMarker,s=!1,o=!1;if(n&&(this._createAnimationRecord(f(e),null),this._getAnimationRecord(e).inserted=!0),t){do{if(r===this._currentPage&&(s=!0),r.elementUniqueID===f(t)){o=!0;var a,l=r,c=e,u=f(e);if(s)for(;l.next!==this._prevMarker;)a=l.next.element,u=l.next.elementUniqueID,l.next.setElement(c,!0),!c&&u&&(l.next.elementUniqueID=u),c=a,l=l.next;else for(r.elementUniqueID===r.next.elementUniqueID&&r.elementUniqueID&&(l=r.next);l.next!==this._prevMarker;)a=l.element,u=l.elementUniqueID,l.setElement(c,!0),!c&&u&&(l.elementUniqueID=u),c=a,l=l.prev;if(c){var d=!1;this._forEachPage(function(e){return f(c)===e.elementUniqueID?(d=!0,!0):void 0}),d||this._releaseElementIfNotAnimated(c)}break}r=r.next}while(r!==this._prevMarker)}else if(i){for(;r.next!==this._prevMarker&&r.elementUniqueID!==f(i);)r===this._currentPage&&(s=!0),r=r.next;r.elementUniqueID===f(i)&&r!==this._prevMarker?(r.prev.setElement(e),o=!0):this._releaseElementIfNotAnimated(e)}else this._currentPage.setElement(e);this._getAnimationRecord(e).successfullyMoved=o,this._setButtonStates()},changed:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var i=this;if(this._forEachPage(function(n){if(n.elementUniqueID===f(t)){var r=i._animationRecords[n.elementUniqueID];return r.changed=!0,r.oldElement=t,r.newElement=e,n.element=e,n.elementUniqueID=f(e),i._animationRecords[f(e)]=r,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var n=0,r=this._navigationAnimationRecord.elementContainers.length;r>n;n++){var s=this._navigationAnimationRecord.elementContainers[n];s&&s.elementUniqueID===f(t)&&(s.element=e,s.elementUniqueID=f(e))}var o=this._navigationAnimationRecord.newCurrentElement;o&&f(o)===f(t)&&(this._navigationAnimationRecord.newCurrentElement=e)}},moved:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var n=this._getAnimationRecord(e);n||(n=this._createAnimationRecord(f(e))),n.moved=!0,this.removed(e,!1,!1),t||i?this.inserted(e,t,i,!1):n.successfullyMoved=!1},removed:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var n=this,r=this._prevMarker,s=c.wrap();if(t){var o=!1;return this._forEachPage(function(t){(t.elementUniqueID===f(e)||o)&&(t.setElement(null,!0),o=!0)}),void this._setButtonStates()}if(i){var a=this._getAnimationRecord(e);a&&(a.removed=!0)}if(this._currentPage.elementUniqueID===f(e))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(r.elementUniqueID===f(e))r.next.element?s=this._itemsManager._previousItem(r.next.element).then(function(t){return t===e&&(t=n._itemsManager._previousItem(t)),t}).then(function(e){r.setElement(e,!0)}):r.setElement(null,!0);else if(r.prev.elementUniqueID===f(e))r.prev.prev&&r.prev.prev.element?s=this._itemsManager._nextItem(r.prev.prev.element).then(function(t){return t===e&&(t=n._itemsManager._nextItem(t)),t}).then(function(e){r.prev.setElement(e,!0)}):r.prev.setElement(null,!0);else{for(var l=this._currentPage.prev,u=!1;l!==r&&!u;)l.elementUniqueID===f(e)&&(this._shiftRight(l),u=!0),l=l.prev;for(l=this._currentPage.next;l!==r&&!u;)l.elementUniqueID===f(e)&&(this._shiftLeft(l),u=!0),l=l.next}return s.then(function(){n._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(e){this._itemSpacing=e,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new u,this._temporaryKeys=[],this._animationRecords={};var e=this;this._forEachPage(function(t){e._createAnimationRecord(t.elementUniqueID,t)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var e=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function t(t){var i=null;return e._forEachPage(function(e){return e.element===t?(i=e,!0):void 0}),i}function i(t,i){e._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var n=e._createDiscardablePage(i);e._setItemStart(n,t.originalLocation),s.push(e._deleteFlipPage(n))}function n(i,n){e._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var r,o=i.originalLocation;if(i.successfullyMoved)r=t(n),o=i.newLocation;else{r=e._createDiscardablePage(n);var a=e._getElementIndex(n),l=e._currentPage.element?e._getElementIndex(e._currentPage.element):0;o+=l>a?-100*e._bufferSize:100*e._bufferSize}r&&(e._setItemStart(r,i.originalLocation),s.push(e._moveFlipPage(r,function(){e._setItemStart(r,o)})))}function r(){return 0===s.length&&s.push(c.wrap()),c.join(s)}var s=[];e._forEachPage(function(t){var i=e._getAnimationRecord(t.element);i&&(i.changed&&(i.oldElement.removedFromChange=!0,s.push(e._changeFlipPage(t,i.oldElement,i.newElement))),i.newLocation=t.location,e._setItemStart(t,i.originalLocation),i.inserted&&(t.elementRoot.style.opacity=0))});var o=e._animationRecords.currentPage,a=e._getAnimationRecord(o),l=e._animationRecords.nextPage,u=e._getAnimationRecord(l);a&&a.changed&&(o=a.newElement),u&&u.changed&&(l=u.newElement),(o!==e._currentPage.element||l!==e._currentPage.next.element)&&(a&&a.removed&&i(a,o),u&&u.removed&&i(u,l)),e._blockTabs=!0,r().then(function(){s=[],a&&a.moved&&n(a,o),u&&u.moved&&n(u,l);var t=e._getAnimationRecord(e._currentPage.element),i=e._getAnimationRecord(e._currentPage.next.element);e._forEachPage(function(n){var r=e._getAnimationRecord(n.element);r&&(r.inserted?r!==t&&r!==i&&(n.elementRoot.style.opacity=1):r.originalLocation!==r.newLocation&&(r!==a&&r!==u||r===a&&!a.moved||r===u&&!u.moved)&&s.push(e._moveFlipPage(n,function(){e._setItemStart(n,r.newLocation)})))}),r().then(function(){s=[],t&&t.inserted&&s.push(e._insertFlipPage(e._currentPage)),i&&i.inserted&&s.push(e._insertFlipPage(e._currentPage.next)),r().then(function(){e._checkElementVisibility(!1),e._itemSettledOn(),e._setListEnds(),e._notificationsStarted--,0===e._notificationsStarted&&e._notificationsEndedSignal.complete(),e._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),e._logBuffer(),e._endNotificationsWork=null})})})})},disableTouchFeatures:function(){this._environmentSupportsTouch=!1;var e=this._panningDivContainer.style;this._panningDivContainer.removeEventListener(n._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0),e.overflowX="hidden",e.overflowY="hidden";var t=["scroll-snap-type","scroll-snap-points-x","scroll-snap-points-y","scroll-limit-x-min","scroll-limit-x-max","scroll-limit-y-min","scroll-limit-y-max"];t.forEach(function(t){var i=g[t];i&&(e[i.scriptName]="")})},_hasFocus:{get:function(){return this._flipperDiv.contains(t.document.activeElement)}},_timeoutPageSelection:function(){var e=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=c.timeout(y).then(function(){e._itemSettledOn()})},_updateTabIndex:function(e){this._forEachPage(function(t){t.element&&(t.element.tabIndex=e)}),this._tabIndex=e,this._tabManager.tabIndex=e},_releaseElementIfNotAnimated:function(e){var t=this._getAnimationRecord(e);t&&(t.changed||t.inserted||t.moved||t.removed)||this._itemsManager.releaseItem(e)},_getAnimationRecord:function(e){return e?this._animationRecords[f(e)]:null},_createAnimationRecord:function(e,t){if(e){var i=this._animationRecords[e]={removed:!1,changed:!1,inserted:!1};return t&&(i.originalLocation=t.location),i}},_writeProfilerMark:function(e){a(e),this._flipperDiv.winControl.constructor._enabledDebug&&s.log&&s.log(e,null,"flipviewdebug")},_getElementIndex:function(e){var t=0;try{t=this._itemsManager.itemObject(e).index}catch(i){}return t},_resetBuffer:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var i=this._currentPage,n=i;do n.element&&n.element===e||t?n.setElement(null,!0):n.setElement(null),n=n.next;while(n!==i)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var t=this._createFlipPage(e,this);return this._panningDiv.appendChild(t.pageRoot),t},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var e=c.wrap(this._currentPage),t=this,i=0;i<this._bufferSize;i++)e=e.then(function(e){return e.next===t._prevMarker&&t._insertNewFlipPage(e),e.element?t._itemsManager._nextItem(e.element).then(function(t){return e.next.setElement(t),e.next}):(e.next.setElement(null),e.next)});return e},_fetchOneNext:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var t=e.prev.element;if(this._prevMarker===e&&(this._prevMarker=this._prevMarker.next),!t)return void e.setElement(null);var i=this;return this._itemsManager._nextItem(t).then(function(t){e.setElement(t),i._movePageAhead(e.prev,e)})},_fetchPreviousItems:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var t=this,i=c.wrap(this._currentPage),n=0;n<this._bufferSize;n++)i=i.then(function(e){return e.element?t._itemsManager._previousItem(e.element).then(function(t){return e.prev.setElement(t),e.prev}):(e.prev.setElement(null),e.prev)});return i.then(function(i){e&&(t._prevMarker=i)})},_fetchOnePrevious:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var t=e.next.element;if(this._prevMarker===e.next&&(this._prevMarker=this._prevMarker.prev),!t)return e.setElement(null),c.wrap();var i=this;return this._itemsManager._previousItem(t).then(function(t){e.setElement(t),i._movePageBehind(e.next,e)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._setItemStart(this._currentPage,v*this._viewportSize());for(var t=this._currentPage;t!==this._prevMarker;)this._movePageBehind(t,t.prev),t=t.prev;for(t=this._currentPage;t.next!==this._prevMarker;)this._movePageAhead(t,t.next),t=t.next;var i=!1;this._lastScrollPos&&!e&&(this._setListEnds(),i=!0),this._lastScrollPos=this._getItemStart(this._currentPage),this._setViewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),i||this._setListEnds()},_ensureBufferConsistency:function(){var e=this,t=this._currentPage.element;if(!t)return c.wrap();var i=!1,n={},r={};this._forEachPage(function(e){if(e&&e.elementUniqueID){if(n[e.elementUniqueID])return i=!0,!0;if(n[e.elementUniqueID]=!0,e.location>0){if(r[e.location])return i=!0,!0;r[e.location]=!0}}});var s=Object.keys(this._animationRecords);return s.forEach(function(t){var n=e._animationRecords[t];n&&(n.changed||n.inserted||n.moved||n.removed)&&(i=!0)}),i?(this._resetBuffer(null,!0),this._currentPage.setElement(t),this._fetchNextItems().then(function(){return e._fetchPreviousItems(!0)}).then(function(){e._ensureCentered()})):c.wrap()},_shiftLeft:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var t=e,i=null;t!==this._prevMarker&&t.next!==this._prevMarker;)i=t.next.element,!i&&t.next.elementUniqueID&&(t.elementUniqueID=t.next.elementUniqueID),t.next.setElement(null,!0),t.setElement(i,!0),t=t.next;if(t!==this._prevMarker&&t.prev.element){var n=this;return this._itemsManager._nextItem(t.prev.element).then(function(e){t.setElement(e),n._createAnimationRecord(t.elementUniqueID,t)})}},_logBuffer:function(){if(this._flipperDiv.winControl.constructor._enabledDebug){s.log&&s.log(this._currentPage.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"	"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),s.log&&s.log(this._currentPage.next.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"	"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),s.log&&s.log("> "+this._currentPage.elementUniqueID+"	@:"+this._currentPage.location+(this._currentPage.element?"	"+this._currentPage.element.textContent:""),null,"flipviewdebug"),s.log&&s.log(this._currentPage.next.elementUniqueID+"	@:"+this._currentPage.next.location+(this._currentPage.next.element?"	"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),s.log&&s.log(this._currentPage.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"	"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var e=Object.keys(this._itemsManager._elementMap),t=[];this._forEachPage(function(e){e&&e.elementUniqueID&&t.push(e.elementUniqueID)}),s.log&&s.log("itemsmanager  = ["+e.join(" ")+"] flipview ["+t.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var t=e,i=null;t!==this._prevMarker;)i=t.prev.element,!i&&t.prev.elementUniqueID&&(t.elementUniqueID=t.prev.elementUniqueID),t.prev.setElement(null,!0),t.setElement(i,!0),t=t.prev;if(t.next.element){var n=this;return this._itemsManager._previousItem(t.next.element).then(function(e){t.setElement(e),n._createAnimationRecord(t.elementUniqueID,t)})}},_checkElementVisibility:function(e){var t,i;if(e){var n=this._currentPage.element;for(t=0,i=this._visibleElements.length;i>t;t++)this._visibleElements[t]!==n&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[],n&&(this._visibleElements.push(n),this._announceElementVisible(n))}else{for(t=0,i=this._visibleElements.length;i>t;t++)(!this._visibleElements[t].parentNode||this._visibleElements[t].removedFromChange)&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[];var r=this;this._forEachPage(function(e){var t=e.element;t&&(r._itemInView(e)?(r._visibleElements.push(t),r._announceElementVisible(t)):r._announceElementInvisible(t))})}},_announceElementVisible:function(e){if(e&&!e.visible){e.visible=!0;var i=t.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),i.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),e.dispatchEvent(i)}},_announceElementInvisible:function(e){if(e&&e.visible){e.visible=!1;var i=!1;e.parentNode||(i=!0,this._panningDivContainer.appendChild(e));var n=t.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),n.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),e.dispatchEvent(n),i&&this._panningDivContainer.removeChild(e)}},_createDiscardablePage:function(e){var t=this._createPageContainer(),i={pageRoot:t.root,elementRoot:t.elementContainer,discardable:!0,element:e,elementUniqueID:f(e),discard:function(){i.pageRoot.parentNode&&i.pageRoot.parentNode.removeChild(i.pageRoot),i.element.parentNode&&i.element.parentNode.removeChild(i.element)}};return i.pageRoot.style.top="0px",i.elementRoot.appendChild(e),this._panningDiv.appendChild(i.pageRoot),i},_createPageContainer:function(){var e=this._panningDivContainerOffsetWidth,i=this._panningDivContainerOffsetHeight,n=t.document.createElement("div"),r=n.style,s=t.document.createElement("div");return s.className="win-item",r.position="absolute",r.overflow="hidden",r.width=e+"px",r.height=i+"px",n.appendChild(s),{root:n,elementContainer:s}},_createFlipPage:function(t,i){var n={};n.element=null,n.elementUniqueID=null,t?(n.prev=t,n.next=t.next,n.next.prev=n,t.next=n):(n.next=n,n.prev=n);var r=this._createPageContainer();return n.elementRoot=r.elementContainer,n.elementRoot.style.msOverflowStyle="auto",n.pageRoot=r.root,n.setElement=function(t,r){if(void 0===t&&(t=null),t===n.element)return void(t||(n.elementUniqueID=null));if(n.element&&(r||(i._itemsManager.releaseItem(n.element),h._disposeElement(n.element))),n.element=t,n.elementUniqueID=t?f(t):null,_.empty(n.elementRoot),n.element){if(n===i._currentPage&&(i._tabManager.childFocus=t),!e(n.element)){n.element.tabIndex=i._tabIndex,n.element.setAttribute("role","option"),n.element.setAttribute("aria-selected",!1),n.element.id||(n.element.id=f(n.element));var s=function(e,t,i){e.setAttribute(i,t.id)},o=!n.next.element||n===i._prevMarker.prev;o&&(s(n.element,i._bufferAriaEndMarker,"aria-flowto"),s(i._bufferAriaEndMarker,n.element,"x-ms-aria-flowfrom")),n!==i._prevMarker&&n.prev.element&&(s(n.prev.element,n.element,"aria-flowto"),s(n.element,n.prev.element,"x-ms-aria-flowfrom")),n.next!==i._prevMarker&&n.next.element&&(s(n.element,n.next.element,"aria-flowto"),s(n.next.element,n.element,"x-ms-aria-flowfrom")),n.prev.element||s(n.element,i._bufferAriaStartMarker,"x-ms-aria-flowfrom")}n.elementRoot.appendChild(n.element)}},n},_itemInView:function(e){return this._itemEnd(e)>this._getViewportStart()&&this._getItemStart(e)<this._viewportEnd()},_getViewportStart:function(){return this._panningDivContainer.parentNode?this._isHorizontal?_.getScrollPosition(this._panningDivContainer).scrollLeft:_.getScrollPosition(this._panningDivContainer).scrollTop:void 0},_setViewportStart:function(e){this._panningDivContainer.parentNode&&(this._isHorizontal?_.setScrollPosition(this._panningDivContainer,{scrollLeft:e}):_.setScrollPosition(this._panningDivContainer,{scrollTop:e}))},_viewportEnd:function(){var e=this._panningDivContainer;return this._isHorizontal?this._rtl?this._getViewportStart()+this._panningDivContainerOffsetWidth:_.getScrollPosition(e).scrollLeft+this._panningDivContainerOffsetWidth:e.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight
},_getItemStart:function(e){return e.location},_setItemStart:function(e,t){this._isHorizontal?e.pageRoot.style.left=(this._rtl?-t:t)+"px":e.pageRoot.style.top=t+"px",e.location=t},_itemEnd:function(e){return(this._isHorizontal?e.location+this._panningDivContainerOffsetWidth:e.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(e,t){var i=this._itemSize(e)+this._itemSpacing;this._setItemStart(t,this._getItemStart(e)+i)},_movePageBehind:function(e,t){var i=this._itemSize(e)+this._itemSpacing;this._setItemStart(t,this._getItemStart(e)-i)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var e=this._panningDivContainer.style;e[g["scroll-snap-type"].scriptName]="mandatory";var t=this._viewportSize(),i=t+this._itemSpacing,n="scroll-snap-points",r=0,s=this._getItemStart(this._currentPage);r=s%(t+this._itemSpacing),e[g[this._isHorizontal?n+"-x":n+"-y"].scriptName]="snapInterval("+r+"px, "+i+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var e=this._panningDivContainer.style,t=0,i=0,n=this._getTailOfBuffer(),r=this._getHeadOfBuffer(),s=g["scroll-limit-"+(this._isHorizontal?"x-min":"y-min")].scriptName,o=g["scroll-limit-"+(this._isHorizontal?"x-max":"y-max")].scriptName;!r.element&&(r=r.prev,r!==this._prevMarker.prev););for(;!n.element&&(n=n.next,n!==this._prevMarker););i=this._getItemStart(r),t=this._getItemStart(n),e[s]=t+"px",e[o]=i+"px"}},_viewportOnItemStart:function(){return this._getItemStart(this._currentPage)===this._getViewportStart()},_restoreAnimatedElement:function(e,t){var i=!0;return e.elementUniqueID!==f(t.element)||e.element?this._forEachPage(function(e){e.elementUniqueID!==t.elementUniqueID||e.element||(e.setElement(t.element,!0),i=!1)}):(e.setElement(t.element,!0),i=!1),i},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var i=this;n._setImmediate(function(){i._viewportOnItemStart()&&(i._blockTabs=!1,i._currentPage.element&&i._lastSelectedElement!==i._currentPage.element&&(i._lastSelectedPage&&i._lastSelectedPage.element&&!e(i._lastSelectedPage.element)&&i._lastSelectedPage.element.setAttribute("aria-selected",!1),i._lastSelectedPage=i._currentPage,i._lastSelectedElement=i._currentPage.element,e(i._currentPage.element)||i._currentPage.element.setAttribute("aria-selected",!0),d.schedule(function(){if(i._currentPage.element){(i._hasFocus||i._hadFocus)&&(i._hadFocus=!1,_._setActive(i._currentPage.element),i._tabManager.childFocus=i._currentPage.element);var e=t.document.createEvent("CustomEvent");e.initCustomEvent(p.pageSelectedEvent,!0,!1,{source:i._flipperDiv}),i._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),i._currentPage.element.dispatchEvent(e);var n=i._currentPage.element;if(n){var r=i._itemsManager._recordFromElement(n,!0);r&&r.renderComplete.then(function(){n===i._currentPage.element&&(i._currentPage.element.setAttribute("aria-setsize",i._cachedSize),i._currentPage.element.setAttribute("aria-posinset",i.currentIndex()+1),i._bufferAriaStartMarker.setAttribute("aria-flowto",i._currentPage.element.id),e=t.document.createEvent("CustomEvent"),e.initCustomEvent(p.pageCompletedEvent,!0,!1,{source:i._flipperDiv}),i._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),i._currentPage.element.dispatchEvent(e))})}}},d.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent")))})},_forEachPage:function(e){var t=this._prevMarker;do{if(e(t))break;t=t.next}while(t!==this._prevMarker)},_changeFlipPage:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),e.element=null,e.setElement?e.setElement(i,!0):(t.parentNode.removeChild(t),e.elementRoot.appendChild(i));var n=t.style;return n.position="absolute",n.left="0px",n.top="0px",n.opacity=1,e.pageRoot.appendChild(t),t.style.left=Math.max(0,(e.pageRoot.offsetWidth-t.offsetWidth)/2)+"px",t.style.top=Math.max(0,(e.pageRoot.offsetHeight-t.offsetHeight)/2)+"px",l.fadeOut(t).then(function(){t.parentNode&&t.parentNode.removeChild(t)})},_deleteFlipPage:function(e){a("WinJS.UI.FlipView:_deleteFlipPage,info"),e.elementRoot.style.opacity=0;var t=l.createDeleteFromListAnimation([e.elementRoot]),i=this;return t.execute().then(function(){e.discardable&&(e.discard(),i._itemsManager.releaseItem(e.element))})},_insertFlipPage:function(e){a("WinJS.UI.FlipView:_insertFlipPage,info"),e.elementRoot.style.opacity=1;var t=l.createAddToListAnimation([e.elementRoot]);return t.execute().then(function(){e.discardable&&e.discard()})},_moveFlipPage:function(e,t){a("WinJS.UI.FlipView:_moveFlipPage,info");var i=l.createRepositionAnimation(e.pageRoot);t();var n=this;return i.execute().then(function(){if(e.discardable){e.discard();var t=n._getAnimationRecord(e.element);t&&!t.successfullyMoved&&n._itemsManager.releaseItem(e.element)}})},_handleManipulationStateChanged:function(e){this._manipulationState=e.currentState,0===e.currentState&&e.target===this._panningDivContainer&&(this._itemSettledOn(),this._ensureCentered())}},{supportedForProcessing:!1});return C.flipPageBufferCount=2,C})})}),define("WinJS/Controls/FlipView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_UI","./FlipView/_Constants","./FlipView/_PageManager","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y){"use strict";t.Namespace.define("WinJS.UI",{FlipView:t.Namespace._lazy(function(){function p(t){var i=t[0].target.winControl;i&&i instanceof F&&t.some(function(e){return"dir"===e.attributeName?!0:"style"===e.attributeName?i._cachedStyleDir!==e.target.style.direction:!1})&&(i._cachedStyleDir=i._flipviewDiv.style.direction,i._rtl="rtl"===e.getComputedStyle(i._flipviewDiv,null).direction,i._setupOrientation())}function b(e){var t=e.target&&e.target.winControl;t&&t instanceof F&&(o("WinJS.UI.FlipView:resize,StartTM"),t._resize())}var C="win-navbutton",w="win-flipview",I="win-navleft",S="win-navright",E="win-navtop",x="win-navbottom",k="Previous",P="Next",T=3e3,A=500,M="&#57570;",B="&#57571;",L="&#57572;",D="&#57573;",O=40,R={get badAxis(){return"Invalid argument: orientation must be a string, either 'horizontal' or 'vertical'"},get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"},get noitemsManagerForCount(){return"Invalid operation: can't get count if no dataSource has been set"},get badItemSpacingAmount(){return"Invalid argument: itemSpacing must be a number greater than or equal to zero"},get navigationDuringStateChange(){return"Error: After changing itemDataSource or itemTemplate, any navigation in the FlipView control should be delayed until the pageselected event is fired."},get panningContainerAriaLabel(){return s._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},F=t.Class.define(function(t,i){o("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,t=t||e.document.createElement("div");var n=!0,r=null,s=f._trivialHtmlRenderer,a=0,l=0;if(i){if(i.orientation&&"string"==typeof i.orientation)switch(i.orientation.toLowerCase()){case"horizontal":n=!0;break;case"vertical":n=!1}i.currentPage&&(a=i.currentPage>>0,a=0>a?0:a),i.itemDataSource&&(r=i.itemDataSource),i.itemTemplate&&(s=this._getItemRenderer(i.itemTemplate)),i.itemSpacing&&(l=i.itemSpacing>>0,l=0>l?0:l)}if(!r){var u=new c.List;r=u.dataSource}m.empty(t),this._flipviewDiv=t,t.winControl=this,h._setOptions(this,i,!0),this._initializeFlipView(t,n,r,s,a,l),m.addClass(t,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),m._globalListener.addEventListener(t,"wheel",this._windowWheelHandlerBound),m._globalListener.addEventListener(t,"mousewheel",this._windowWheelHandlerBound),o("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){o("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(m._globalListener.removeEventListener(this._flipviewDiv,"wheel",this._windowWheelHandlerBound),m._globalListener.removeEventListener(this._flipviewDiv,"mousewheel",this._windowWheelHandlerBound),m._resizeNotifier.unsubscribe(this._flipviewDiv,b),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){o("WinJS.UI.FlipView:next,info");var e=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,e)},previous:function(){o("WinJS.UI.FlipView:prev,info");var e=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,e)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(e){if(o("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var t=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){t._pageManager._notificationsEndedSignal=null,t.currentPage=e})}if(!this._animating||this._cancelAnimation())if(e>>=0,e=0>e?0:e,this._refreshTimer)this._indexAfterRefresh=e;else{this._pageManager._cachedSize>0?e=Math.min(this._pageManager._cachedSize-1,e):0===this._pageManager._cachedSize&&(e=0);var t=this;if(this._jumpingToIndex===e)return;var i=function(){t._jumpingToIndex=null};this._jumpingToIndex=e;var n=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),r=this._jumpAnimation?null:this._cancelDefaultAnimation,s=function(){t._completeJump()};this._pageManager.startAnimatedJump(e,r,s).then(function(e){if(e){t._animationsStarted();var r=e.oldPage.pageRoot,a=e.newPage.pageRoot;t._contentDiv.appendChild(r),t._contentDiv.appendChild(a),t._completeJumpPending=!0,n(r,a).then(function(){t._completeJumpPending&&(s(),o("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(i,i)}else i()},i)}}},orientation:{get:function(){return this._axisAsString()},set:function(e){o("WinJS.UI.FlipView:set_orientation,info");var t="horizontal"===e;t!==this._isHorizontal&&(this._isHorizontal=t,this._setupOrientation(),this._pageManager.setOrientation(this._isHorizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(e){o("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=e||(new c.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(e){o("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(e),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(e){o("WinJS.UI.FlipView:set_itemSpacing,info"),e>>=0,e=0>e?0:e,this._pageManager.setItemSpacing(e)}},count:function(){o("WinJS.UI.FlipView:count,info");var e=this;return new u(function(t,i){e._itemsManager?e._pageManager._cachedSize===g.CountResult.unknown||e._pageManager._cachedSize>=0?t(e._pageManager._cachedSize):e._dataSource.getCount().then(function(i){e._pageManager._cachedSize=i,t(i)}):i(F.noitemsManagerForCount)})},setCustomAnimations:function(e){o("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==e.next&&(this._nextAnimation=e.next),void 0!==e.previous&&(this._prevAnimation=e.previous),void 0!==e.jump&&(this._jumpAnimation=e.jump)},forceLayout:function(){o("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(t,n,r,s,o,a){function l(e){e.setAttribute("aria-hidden",!0),e.style.visibility="hidden",e.style.opacity=0,e.tabIndex=-1,e.style.zIndex=1e3}function c(e){if(e.pointerType!==T){if(h._touchInteraction=!1,e.screenX===h._lastMouseX&&e.screenY===h._lastMouseY)return;h._lastMouseX=e.screenX,h._lastMouseY=e.screenY,h._mouseInViewport=!0,h._fadeInButton("prev"),h._fadeInButton("next"),h._fadeOutButtons()}}function u(e){e.pointerType===T?(h._mouseInViewport=!1,h._touchInteraction=!0,h._fadeOutButtons(!0)):(h._touchInteraction=!1,h._isInteractive(e.target)||0!==(4&e.buttons)&&(e.stopPropagation(),e.preventDefault()))}function d(e){e.pointerType!==T&&(h._touchInteraction=!1)}var h=this,_=!1;this._flipviewDiv=t,m.addClass(this._flipviewDiv,w),this._contentDiv=e.document.createElement("div"),this._panningDivContainer=e.document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=e.document.createElement("div"),this._prevButton=e.document.createElement("button"),this._nextButton=e.document.createElement("button"),this._isHorizontal=n,this._dataSource=r,this._itemRenderer=s,this._itemsManager=null,this._pageManager=null;for(var v=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],C=!0,I=i._browserStyleEquivalents,S=0,E=v.length;E>S;S++)C=C&&!!I[v[S]];C=C&&!!i._browserEventEquivalents.manipulationStateChanged,this._environmentSupportsTouch=C,C&&m._detectSnapPointsSupport().then(function(e){e||(h._environmentSupportsTouch=!1,_&&(h._fadeInButton("prev"),h._fadeInButton("next"),m._removeEventListener(h._contentDiv,"pointerdown",u,!1),m._removeEventListener(h._contentDiv,"pointermove",c,!1),m._removeEventListener(h._contentDiv,"pointerup",d,!1),h._panningDivContainer.style[h._isHorizontal?"overflowX":"overflowY"]="hidden",h._pageManager.disableTouchFeatures()))});var x=this._flipviewDiv.getAttribute("aria-label");x||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",R.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),l(this._prevButton),l(this._nextButton),this._prevButton.setAttribute("aria-label",k),this._nextButton.setAttribute("aria-label",P),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton),this._itemsManagerCallback={inserted:function(e,t,i){h._itemsManager._itemFromPromise(e).then(function(e){var n=h._itemsManager._elementFromHandle(t),r=h._itemsManager._elementFromHandle(i);h._pageManager.inserted(e,n,r,!0)})},countChanged:function(e,t){h._pageManager._cachedSize=e,t!==g.CountResult.unknown&&h._fireDatasourceCountChangedEvent()},changed:function(e,t){h._pageManager.changed(e,t)},moved:function(e,t,i,n){var r=function(e){h._pageManager.moved(e,t,i)};e?r(e):h._itemsManager._itemFromPromise(n).then(r)},removed:function(e,t){e&&h._pageManager.removed(e,t,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){h._cancelAnimation(),h._pageManager.notificationsStarted()},endNotifications:function(){h._pageManager.notificationsEnded()},itemAvailable:function(e,t){h._pageManager.itemRetrieved(e,t)},reload:function(){h._pageManager.reload()}},this._dataSource&&(this._itemsManager=f._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new y._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,a,this._environmentSupportsTouch,{hidePreviousButton:function(){h._hasPrevContent=!1,h._fadeOutButton("prev"),h._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){h._hasPrevContent=!0,h._fadeInButton("prev"),h._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){h._hasNextContent=!1,h._fadeOutButton("next"),h._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){h._hasNextContent=!0,h._fadeInButton("next"),h._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(o,this._isHorizontal),this._dataSource.getCount().then(function(e){h._pageManager._cachedSize=e}),this._prevButton.addEventListener("click",function(){h.previous()},!1),this._nextButton.addEventListener("click",function(){h.next()},!1),new m._MutationObserver(p).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._flipviewDiv.addEventListener("mselementresize",b),m._resizeNotifier.subscribe(this._flipviewDiv,b),this._contentDiv.addEventListener("mouseleave",function(){h._mouseInViewport=!1},!1);var T=m._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._environmentSupportsTouch&&(m._addEventListener(this._contentDiv,"pointerdown",u,!1),m._addEventListener(this._contentDiv,"pointermove",c,!1),m._addEventListener(this._contentDiv,"pointerup",d,!1)),this._panningDivContainer.addEventListener("scroll",function(){h._scrollPosChanged()},!1),this._panningDiv.addEventListener("blur",function(){h._touchInteraction||h._fadeOutButtons()},!0);var A=e.document.body.contains(this._flipviewDiv);m._addInsertedNotifier(this._flipviewDiv),this._flipviewDiv.addEventListener("WinJSNodeInserted",function(){return A?void(A=!1):void h._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(e){var t=!0;if(!h._isInteractive(e.target)){var i=m.Key,n=!1;if(h._isHorizontal)switch(e.keyCode){case i.leftArrow:h._rtl?h.next():h.previous(),n=!0;break;case i.pageUp:h.previous(),n=!0;break;case i.rightArrow:h._rtl?h.previous():h.next(),n=!0;break;case i.pageDown:h.next(),n=!0;break;case i.upArrow:case i.downArrow:n=!0,t=!1}else switch(e.keyCode){case i.upArrow:case i.pageUp:h.previous(),n=!0;break;case i.downArrow:case i.pageDown:h.next(),n=!0;break;case i.space:n=!0}switch(e.keyCode){case i.home:h.currentPage=0,n=!0;break;case i.end:h._pageManager._cachedSize>0&&(h.currentPage=h._pageManager._cachedSize-1),n=!0}if(n)return e.preventDefault(),t&&e.stopPropagation(),!0}},!1),_=!0},_windowWheelHandler:function(e){e=e.detail.originalEvent;var t=e.target&&(this._flipviewDiv.contains(e.target)||this._flipviewDiv===e.target),n=this,r=i._now(),s=this._avoidTrappingTime>r;(!t||s)&&(this._avoidTrappingTime=r+A),t&&s?(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",i._yieldForDomModification(function(){n._pageManager._ensureCentered(),n._isHorizontal?(n._panningDivContainer.style.overflowX=n._environmentSupportsTouch?"scroll":"hidden",n._panningDivContainer.style.overflowY="hidden"):(n._panningDivContainer.style.overflowY=n._environmentSupportsTouch?"scroll":"hidden",n._panningDivContainer.style.overflowX="hidden")})):t&&this._pageManager.simulateMouseWheelScroll(e)},_isInteractive:function(e){if(e.parentNode)for(var t=e.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),i=0,n=t.length;n>i;i++)if(t[i]===e)return!0;return!1},_refreshHandler:function(){var e=this._dataSourceAfterRefresh||this._dataSource,t=this._itemRendererAfterRefresh||this._itemRenderer,i=this._indexAfterRefresh||0;this._setDatasource(e,t,i),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var e=this;this._refreshTimer=!0,d.schedule(function(){e._refreshTimer&&!e._disposed&&e._refreshHandler()},d.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(t){var i=null;if("function"==typeof t){var n=new u(function(){}),r=t(n);i=r.element?"object"==typeof r.element&&"function"==typeof r.element.then?function(i){var n=e.document.createElement("div");return n.className="win-template",_.markDisposable(n),{element:n,renderComplete:t(i).element.then(function(e){n.appendChild(e)})}}:t:function(i){var n=e.document.createElement("div");return n.className="win-template",_.markDisposable(n),{element:n,renderComplete:i.then(function(){return u.as(t(i)).then(function(e){n.appendChild(e)})})}}}else"object"==typeof t&&(i=t.renderItem);return i},_navigate:function(e,t){if(i.validation&&this._refreshTimer)throw new n("WinJS.UI.FlipView.NavigationDuringStateChange",R.navigationDuringStateChange);if(this._animating||(this._animatingForward=e),this._goForward=e,this._animating&&!this._cancelAnimation())return!1;var r=this,s=e?this._nextAnimation:this._prevAnimation,o=s?s:this._defaultAnimation.bind(this),a=function(e){r._completeNavigation(e)},l=this._pageManager.startAnimatedNavigation(e,t,a);if(l){this._animationsStarted();var c=l.outgoing.pageRoot,u=l.incoming.pageRoot;return this._contentDiv.appendChild(c),this._contentDiv.appendChild(u),this._completeNavigationPending=!0,o(c,u).then(function(){r._completeNavigationPending&&a(r._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(e,t){e.style.opacity=0,t.style.animationName="",t.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var e=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(e&&(e=e.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var t=this._pageManager._navigationAnimationRecord.elementContainers[0],i=this._pageManager._navigationAnimationRecord.elementContainers[1],n=t.pageRoot,r=i.pageRoot;return e&&e(n,r),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(e){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var t=this._pageManager._navigationAnimationRecord.elementContainers[0],i=this._pageManager._navigationAnimationRecord.elementContainers[1],n=t.pageRoot,r=i.pageRoot;n.parentNode&&n.parentNode.removeChild(n),r.parentNode&&r.parentNode.removeChild(r),this._pageManager.endAnimatedNavigation(e,t,i),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var e=this._pageManager._navigationAnimationRecord.elementContainers[0],t=this._pageManager._navigationAnimationRecord.elementContainers[1],i=e.pageRoot,n=t.pageRoot;i.parentNode&&i.parentNode.removeChild(i),n.parentNode&&n.parentNode.removeChild(n),this._pageManager.endAnimatedJump(e,t),this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(e){return this._pageManager.jumpToIndex(e)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(e,t,i){this._animating&&this._cancelAnimation();var n=0;void 0!==i&&(n=i),this._dataSource=e,this._itemRenderer=t;var r=this._itemsManager;this._itemsManager=f._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var s=this;this._dataSource.getCount().then(function(e){s._pageManager._cachedSize=e}),this._pageManager.setNewItemsManager(this._itemsManager,n),r&&r.release()},_fireDatasourceCountChangedEvent:function(){var t=this;d.schedule(function(){var i=e.document.createEvent("Event");i.initEvent(F.datasourceCountChangedEvent,!0,!0),o("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),t._flipviewDiv.dispatchEvent(i)},d.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._isHorizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._isHorizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var t="rtl"===e.getComputedStyle(this._flipviewDiv,null).direction;this._rtl=t,t?(this._prevButton.className=C+" "+S,this._nextButton.className=C+" "+I):(this._prevButton.className=C+" "+I,this._nextButton.className=C+" "+S),this._prevButton.innerHTML=t?B:M,this._nextButton.innerHTML=t?M:B}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=C+" "+E,this._nextButton.className=C+" "+x,this._prevButton.innerHTML=L,this._nextButton.innerHTML=D;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(e,t){(this._mouseInViewport||t||!this._environmentSupportsTouch)&&("next"===e&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===e&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(e){var t=this;return"next"===e?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=a.fadeOut(this._nextButton).then(function(){t._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=a.fadeOut(this._prevButton).then(function(){t._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(e){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var t=this;this._buttonFadePromise=(e?u.wrap():u.timeout(l._animationTimeAdjustment(T))).then(function(){t._fadeOutButton("prev"),t._fadeOutButton("next"),t._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(e,t){var i={};t.style.left="0px",t.style.top="0px",t.style.opacity=0;var n=e.itemIndex>t.itemIndex?-O:O;i.left=(this._isHorizontal?this._rtl?-n:n:0)+"px",i.top=(this._isHorizontal?0:n)+"px";var r=a.fadeOut(e),s=a.enterContent(t,[i],{mechanism:"transition"});return u.join([r,s])},_fadeInFromCurrentValue:function(e){return l.executeTransition(e,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}},v);return t.Class.mix(F,r.createEventProperties(F.datasourceCountChangedEvent,F.pageVisibilityChangedEvent,F.pageSelectedEvent,F.pageCompletedEvent)),t.Class.mix(F,h.DOMEventMixin),F})})}),define("WinJS/Controls/ItemContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v){"use strict";var y=s._createEventProperty,b={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};i.Namespace._moduleDefine(e,"WinJS.UI",{ItemContainer:i.Namespace._lazy(function(){var s={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},a=i.Class.define(function(i,n){function o(e,t,i){return{name:t?e:e.toLowerCase(),handler:function(t){l["_on"+e](t)},capture:i}}if(i=i||t.document.createElement("DIV"),this._id=i.id||_._uniqueID(i),this._writeProfilerMark("constructor,StartTM"),n=n||{},i.winControl)throw new r("WinJS.UI.ItemContainer.DuplicateConstruction",s.duplicateConstruction);i.winControl=this,this._element=i,_.addClass(i,"win-disposable"),this._selectionMode=f.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:f.ObjectType.item,index:g._INVALID_INDEX},this.tapBehavior=f.TapBehavior.invokeOnly,this.swipeOrientation=f.Orientation.vertical,this.swipeBehavior=f.SwipeBehavior.select,_.addClass(this.element,a._ClassName.itemContainer+" "+g._containerClass),this._setupInternalTree(),this._selection=new e._SingleItemSelectionManager(i,this._itemBox),this._setTabIndex(),d.setOptions(this,n),this._mutationObserver=new _._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(i,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var l=this;this.selectionDisabled||u.schedule(function(){l._setDirectionClass()},u.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new v._ItemEventsHandler(Object.create({containerFromElement:function(){return l.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return g._INVALID_INDEX},itemBoxAtIndex:function(){return l._itemBox},itemAtIndex:function(){return l.element},headerAtIndex:function(){return null},containerAtIndex:function(){return l.element},isZombie:function(){return this._disposed},getItemPosition:function(){return l._getItemPosition()},rtl:function(){return l._rtl()},fireInvokeEvent:function(){l._fireInvokeEvent()},verifySelectionAllowed:function(){return l._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(e,t){return l._selection.set({firstIndex:e,lastIndex:t})}},{pressedEntity:{get:function(){return l._pressedEntity},set:function(e){l._pressedEntity=e}},pressedElement:{enumerable:!0,set:function(e){l._pressedElement=e}},eventHandlerRoot:{enumerable:!0,get:function(){return l.element}},swipeBehavior:{enumerable:!0,get:function(){return l._swipeBehavior}},selectionMode:{enumerable:!0,get:function(){return l._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return g._containerClass}},canvasProxy:{enumerable:!0,get:function(){return l._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return l._tapBehavior}},draggable:{enumerable:!0,get:function(){return l._draggable}},selection:{enumerable:!0,get:function(){return l._selection}},horizontal:{enumerable:!0,get:function(){return l._swipeOrientation===f.Orientation.vertical}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var c=[o("MSManipulationStateChanged",!0,!0),o("PointerDown"),o("Click"),o("PointerUp"),o("PointerCancel"),o("LostPointerCapture"),o("ContextMenu"),o("MSHoldVisual",!0),o("FocusIn"),o("FocusOut"),o("DragStart"),o("DragEnd"),o("KeyDown")];c.forEach(function(e){_._addEventListener(l.element,e.name,e.handler,!!e.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(e){n.isPhone||this._draggable!==e&&(this._draggable=e,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(e){this._selection.selected!==e&&(this._selection.selected=e)}},swipeOrientation:{get:function(){return this._swipeOrientation
},set:function(e){e===f.Orientation.vertical?(_.removeClass(this.element,a._ClassName.horizontal),_.addClass(this.element,a._ClassName.vertical)):(e=f.Orientation.horizontal,_.removeClass(this.element,a._ClassName.vertical),_.addClass(this.element,a._ClassName.horizontal)),this._swipeOrientation=e}},tapBehavior:{get:function(){return this._tapBehavior},set:function(e){n.isPhone&&e===f.TapBehavior.directSelect||(this._tapBehavior=e,this._setAriaRole())}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(e){this._swipeBehavior=e,this._setSwipeClass()}},selectionDisabled:{get:function(){return this._selectionMode===f.SelectionMode.none},set:function(e){e?this._selectionMode=f.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=f.SelectionMode.single),this._setSwipeClass(),this._setAriaRole()}},oninvoked:y(b.invoked),onselectionchanging:y(b.selectionchanging),onselectionchanged:y(b.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),h.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(e){this._itemEventsHandler.onMSManipulationStateChanged(e)},_onPointerDown:function(e){this._itemEventsHandler.onPointerDown(e)},_onClick:function(e){this._itemEventsHandler.onClick(e)},_onPointerUp:function(e){_.hasClass(this._itemBox,g._itemFocusClass)&&this._onFocusOut(e),this._itemEventsHandler.onPointerUp(e)},_onPointerCancel:function(e){this._itemEventsHandler.onPointerCancel(e)},_onLostPointerCapture:function(e){this._itemEventsHandler.onLostPointerCapture(e)},_onContextMenu:function(e){this._itemEventsHandler.onContextMenu(e)},_onMSHoldVisual:function(e){this._itemEventsHandler.onMSHoldVisual(e)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+g._itemFocusOutlineClass)&&p._keyboardSeenLast){_.addClass(this._itemBox,g._itemFocusClass);var e=t.document.createElement("div");e.className=g._itemFocusOutlineClass,this._itemBox.appendChild(e)}},_onFocusOut:function(){_.removeClass(this._itemBox,g._itemFocusClass);var e=this._itemBox.querySelector("."+g._itemFocusOutlineClass);e&&e.parentNode.removeChild(e)},_onDragStart:function(e){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))e.preventDefault();else{this._dragging=!0;var t=this;if(e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage){var i=this.element.getBoundingClientRect();e.dataTransfer.setDragImage(this.element,e.clientX-i.left,e.clientY-i.top)}n._yieldForDomModification(function(){t._dragging&&_.addClass(t._itemBox,g._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,_.removeClass(this._itemBox,g._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(e){if(!this._itemEventsHandler._isInteractive(e.target)){var t=_.Key,i=e.keyCode,n=this._swipeBehavior===f.SwipeBehavior.select,r=!1;if(e.ctrlKey||i!==t.enter)e.ctrlKey&&i===t.enter||n&&e.shiftKey&&i===t.F10||n&&i===t.menu||i===t.space?this.selectionDisabled||(this.selected=!this.selected,r=_._setActive(this.element)):i===t.escape&&this.selected&&(this.selected=!1,r=!0);else{var s=this._verifySelectionAllowed();s.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),r=!0}r&&(e.stopPropagation(),e.preventDefault())}},_setTabIndex:function(){var e=this.element.getAttribute("tabindex");e||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){_[this._rtl()?"addClass":"removeClass"](this.element,g._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var e=this.element;return e?c.wrap({left:this._rtl()?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:e.offsetLeft,top:e.offsetTop,totalWidth:_.getTotalWidth(e),totalHeight:_.getTotalHeight(e),contentWidth:_.getContentWidth(e),contentHeight:_.getContentHeight(e)}):c.cancel},_itemPropertyChange:function(e){if(!this._disposed){var t=e[0].target,i="true"===t.getAttribute("aria-selected");i!==_._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?_._setAttribute(t,"aria-selected",!i):(this.selected=i,i!==this.selected&&_._setAttribute(t,"aria-selected",!i)))}},_setSwipeClass:function(){n.isPhone||(this._swipeBehavior===f.SwipeBehavior.select&&this._selectionMode!==f.SelectionMode.none||this._draggable?_.addClass(this._element,g._swipeableClass):_.removeClass(this._element,g._swipeableClass))},_updateDraggableAttribute:function(){this._setSwipeClass(),this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode===f.SelectionMode.none||this._tapBehavior!==f.TapBehavior.toggleSelect&&this._swipeBehavior!==f.SwipeBehavior.select)return{canSelect:!1,canTapSelect:!1};var e=this._selection.fireSelectionChanging();return{canSelect:e,canTapSelect:e&&this._tapBehavior===f.TapBehavior.toggleSelect}},_setupInternalTree:function(){var e=t.document.createElement("div");e.className=g._itemClass,this._captureProxy=t.document.createElement("div"),this._itemBox=t.document.createElement("div"),this._itemBox.className=g._itemBoxClass;for(var i=this.element.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}this.element.appendChild(this._itemBox),this._itemBox.appendChild(e),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==f.TapBehavior.none){var e=t.document.createEvent("CustomEvent");e.initCustomEvent(b.invoked,!0,!1,{}),this.element.dispatchEvent(e)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var e;e=this.tapBehavior===f.TapBehavior.none&&this.selectionDisabled?"listitem":"option",_._setAttribute(this.element,"role",e)}},_writeProfilerMark:function(e){var t="WinJS.UI.ItemContainer:"+this._id+":"+e;l(t),o.log&&o.log(t,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return i.Class.mix(a,d.DOMEventMixin),a}),_SingleItemSelectionManager:i.Namespace._lazy(function(){return i.Class.define(function(e,t){this._selected=!1,this._element=e,this._itemBox=t},{selected:{get:function(){return this._selected},set:function(e){e=!!e,this._selected!==e&&this.fireSelectionChanging()&&(this._selected=e,v._ItemEventsHandler.renderSelection(this._itemBox,this._element,e,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var e=t.document.createEvent("CustomEvent");return e.initCustomEvent(b.selectionchanging,!0,!0,{}),this._element.dispatchEvent(e)},fireSelectionChanged:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent(b.selectionchanged,!0,!1,{}),this._element.dispatchEvent(e)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:f.ObjectType.item,index:g._INVALID_INDEX}}})})})}),define("WinJS/Controls/Repeater",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Repeater:i.Namespace._lazy(function(){function e(e){var i=t.document.createElement("div");return i.textContent=JSON.stringify(e),i}var s="itemsloaded",_="itemchanging",m="itemchanged",p="iteminserting",f="iteminserted",g="itemmoving",v="itemmoved",y="itemremoving",b="itemremoved",C="itemsreloading",w="itemsreloaded",I=r._createEventProperty,S={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get asynchronousRender(){return"Top level items must render synchronously"},get repeaterReentrancy(){return"Cannot modify Repeater data until Repeater has commited previous modification."}},E=i.Class.define(function(e,i){if(e&&e.winControl)throw new n("WinJS.UI.Repeater.DuplicateConstruction",S.duplicateConstruction);this._element=e||t.document.createElement("div"),this._id=this._element.id||h._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),i=i||{},h.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var r=this._extractInlineTemplate();this._initializing=!0,this.template=i.template||r,this.data=i.data,this._initializing=!1,u._setOptions(this,i,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(s,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(e){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=e||new a.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(s,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(t){this._writeProfilerMark("template.set,StartTM"),this._template=t||e,this._render=h._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(s,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(e){return this._repeatedDOM[e]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var e=0,t=this._repeatedDOM.length;t>e;e++)d._disposeElement(this._repeatedDOM[e])}},onitemsloaded:I(s),onitemchanging:I(_),onitemchanged:I(m),oniteminserting:I(p),oniteminserted:I(f),onitemmoving:I(g),onitemmoved:I(v),onitemremoving:I(y),onitemremoved:I(b),onitemsreloading:I(C),onitemsreloaded:I(w),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var e=t.document.createElement(this._element.tagName);this._element.firstElementChild;)e.appendChild(this._element.firstElementChild);return new l.Template(e,{extractChild:!0})}},_renderAllItems:function(){for(var e=t.document.createDocumentFragment(),i=0,r=this._data.length;r>i;i++){var s=this._render(this._data.getAt(i));if(!s)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);e.appendChild(s),this._repeatedDOM.push(s)}this._element.appendChild(e)},_reloadRepeater:function(e){this._unloadRepeatedDOM(e),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(e){for(var t=0,i=this._repeatedDOM.length;i>t;t++){var n=this._repeatedDOM[t];e&&d._disposeElement(n),n.parentElement===this._element&&this._element.removeChild(n)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(e){this._data.addEventListener(e,this._dataListeners[e],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new n("WinJS.UI.Repeater.RepeaterModificationReentrancy",S.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(e){this._data.removeEventListener(e,this._dataListeners[e],!1)}.bind(this))},_dataItemChangedHandler:function(e){this._beginModification();var t,i=this._element,r=e.detail.index,s=this._render(e.detail.newValue);if(!s)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);this._repeatedDOM[r]&&(e.detail.oldElement=this._repeatedDOM[r]),e.detail.newElement=s,e.detail.setPromise=function(e){t=e},this._writeProfilerMark(_+",info"),this.dispatchEvent(_,e.detail);var o=null;r<this._repeatedDOM.length?(o=this._repeatedDOM[r],i.replaceChild(s,o),this._repeatedDOM[r]=s):(i.appendChild(s),this._repeatedDOM.push(s)),this._endModification(),this._writeProfilerMark(m+",info"),this.dispatchEvent(m,e.detail),o&&c.as(t).done(function(){d._disposeElement(o)}.bind(this))},_dataItemInsertedHandler:function(e){this._beginModification();var t=e.detail.index,i=this._render(e.detail.value);if(!i)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);var r=this._element;if(e.detail.affectedElement=i,this._writeProfilerMark(p+",info"),this.dispatchEvent(p,e.detail),t<this._repeatedDOM.length){var s=this._repeatedDOM[t];r.insertBefore(i,s)}else r.appendChild(i);this._repeatedDOM.splice(t,0,i),this._endModification(),this._writeProfilerMark(f+",info"),this.dispatchEvent(f,e.detail)},_dataItemMovedHandler:function(e){this._beginModification();var t=this._repeatedDOM[e.detail.oldIndex];if(e.detail.affectedElement=t,this._writeProfilerMark(g+",info"),this.dispatchEvent(g,e.detail),this._repeatedDOM.splice(e.detail.oldIndex,1)[0],t.parentNode.removeChild(t),e.detail.newIndex<this._data.length-1){var i=this._repeatedDOM[e.detail.newIndex];this._element.insertBefore(t,i),this._repeatedDOM.splice(e.detail.newIndex,0,t)}else this._repeatedDOM.push(t),this._element.appendChild(t);this._endModification(),this._writeProfilerMark(v+",info"),this.dispatchEvent(v,e.detail)},_dataItemRemovedHandler:function(e){this._beginModification();var t,i=this._repeatedDOM[e.detail.index],n={affectedElement:i,index:e.detail.index,item:e.detail.item};n.setPromise=function(e){t=e},this._writeProfilerMark(y+",info"),this.dispatchEvent(y,n),i.parentNode.removeChild(i),this._repeatedDOM.splice(e.detail.index,1),this._endModification(),this._writeProfilerMark(b+",info"),this.dispatchEvent(b,n),c.as(t).done(function(){d._disposeElement(i)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var e,t=this._repeatedDOM.slice(0),i={affectedElements:t};i.setPromise=function(t){e=t},this._writeProfilerMark(C+",info"),this.dispatchEvent(C,i),this._reloadRepeater(!1);var n=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(w+",info"),this.dispatchEvent(w,{affectedElements:n}),c.as(e).done(function(){for(var e=0,i=t.length;i>e;e++)d._disposeElement(t[e])}.bind(this))},_writeProfilerMark:function(e){o("WinJS.UI.Repeater:"+this._id+":"+e)}},{isDeclarativeControlContainer:!0});return i.Class.mix(E,u.DOMEventMixin),E})})}),define("WinJS/Controls/DatePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c){"use strict";i.Namespace.define("WinJS.UI",{DatePicker:i.Namespace._lazy(function(){function n(e,i,n){var r=t.Windows.Globalization.DateTimeFormatting;e=e?e:n;var s=new r.DateTimeFormatter(e);return i?new r.DateTimeFormatter(e,s.languages,s.geographicRegion,i,s.clock):s}function l(e,t,i){var r=y[e];r||(r=y[e]={});var s=r[t];s||(s=r[t]={});var o=s[i];return o||(o=s[i]={},o.formatter=n(e,t,i),o.years={}),o}function u(e,t,i,n,r,s){var o=l(e,t,i),a=o.years[s.year+"-"+s.era];return a||(a=o.formatter.format(s.getDateTime()),o.years[s.year+"-"+s.era]=a),a}function d(e,t,i,n){var r=l(e,t,i);return r.formatter.format(n.getDateTime())}function h(e,t,i,n){var r=l(e,t,i);return r.formatter.format(n.getDateTime())}function _(e){var i=t.Windows.Globalization,n=new i.Calendar;return e?new i.Calendar(n.languages,e,n.getClock()):n}function m(e,t){var i=0;if(e.era===t.era)i=t.year-e.year;else for(;e.era!==t.era||e.year!==t.year;)i++,e.addYears(1);return i}var p="day",f="{month.full}",g="year.full",v={get ariaLabel(){return s._getWinJSString("ui/datePicker").value},get selectDay(){return s._getWinJSString("ui/selectDay").value},get selectMonth(){return s._getWinJSString("ui/selectMonth").value},get selectYear(){return s._getWinJSString("ui/selectYear").value}},y={},b=i.Class.define(function(t,i){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},t=t||e.document.createElement("div"),a.addClass(t,"win-disposable"),t.winControl=this;var n=t.getAttribute("aria-label");n||t.setAttribute("aria-label",v.ariaLabel),this._init(t),o.setOptions(this,i)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",v.selectDay),this._monthElement.setAttribute("aria-label",v.selectMonth),this._yearElement.setAttribute("aria-label",v.selectYear)},_addControlsInOrder:function(){var e=this._domElement,t=this,i=0;t._information.order.forEach(function(n){switch(n){case"month":e.appendChild(t._monthElement),a.addClass(t._monthElement,"win-order"+i++);break;case"date":e.appendChild(t._dateElement),a.addClass(t._dateElement,"win-order"+i++);break;case"year":e.appendChild(t._yearElement),a.addClass(t._yearElement,"win-order"+i++)}})},_createControlElements:function(){this._monthElement=e.document.createElement("select"),this._monthElement.className="win-datepicker-month",this._dateElement=e.document.createElement("select"),this._dateElement.className="win-datepicker-date",this._yearElement=e.document.createElement("select"),this._yearElement.className="win-datepicker-year"},_createControls:function(){var e=this._information,t=e.getIndex(this.current);e.forceLanguage&&(this._domElement.setAttribute("lang",e.forceLanguage),this._domElement.setAttribute("dir",e.isRTL?"rtl":"ltr")),this._yearControl=new c._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:t.year}),this._monthControl=new c._Select(this._monthElement,{dataSource:this._information.months(t.year),disabled:this.disabled,index:t.month}),this._dateControl=new c._Select(this._dateElement,{dataSource:this._information.dates(t.year,t.month),disabled:this.disabled,index:t.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(e){this._calendar=e,this._setElement(this._domElement)}},current:{get:function(){var e=this._currentDate,t=e.getFullYear();return new Date(Math.max(Math.min(this.maxYear,t),this.minYear),e.getMonth(),e.getDate(),12,0,0,0)},set:function(e){var t;"string"==typeof e?(t=new Date(Date.parse(e)),t.setHours(12,0,0,0)):t=e;var i=this._currentDate;i!==t&&(this._currentDate=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled!==e&&(this._disabled=e,this._yearControl&&(this._monthControl.setDisabled(e),this._dateControl.setDisabled(e),this._yearControl.setDisabled(e)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(e){this._datePatterns.date!==e&&(this._datePatterns.date=e,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(e){this._domElement=this._domElement||e,this._domElement&&(a.empty(this._domElement),a.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(e){this._minYear!==e&&(this._minYear=e,e>this._maxYear&&(this._maxYear=e),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var e={year:this._information.years.getLength()-1};return e.month=this._information.months(e.year).getLength()-1,e.date=this._information.dates(e.year,e.month).getLength()-1,this._information.getDate(e).getFullYear()},set:function(e){this._maxYear!==e&&(this._maxYear=e,e<this._minYear&&(this._minYear=e),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(e){this._datePatterns.month!==e&&(this._datePatterns.month=e,this._init())}},_updateInformation:function(){var e=new Date(this._minYear,0,1,12,0,0),t=new Date(this._maxYear,11,31,12,0,0);e.setFullYear(this._minYear),t.setFullYear(this._maxYear),this._information=b.getInformation(e,t,this._calendar,this._datePatterns)},_init:function(e){this._setElement(e)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var e=this._information.getIndex(this.current);this._yearControl.index=e.year,this._monthControl.dataSource=this._information.months(e.year),this._monthControl.index=e.month,this._dateControl.dataSource=this._information.dates(e.year,e.month),this._dateControl.index=e.date}},_wireupEvents:function(){function e(){t._currentDate=t._information.getDate({year:t._yearControl.index,month:t._monthControl.index,date:t._dateControl.index},t._currentDate);var e=t._information.getIndex(t._currentDate);t._monthControl.dataSource=t._information.months(e.year),t._monthControl.index=e.month,t._dateControl.dataSource=t._information.dates(e.year,e.month),t._dateControl.index=e.date}var t=this;this._dateElement.addEventListener("change",e,!1),this._monthElement.addEventListener("change",e,!1),this._yearElement.addEventListener("change",e,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(e){this._datePatterns.year!==e&&(this._datePatterns.year=e,this._init())}}},{_getInformationWinRT:function(e,t,i,n){function r(e){return new Date(Math.min(new Date(Math.max(c,e)),v))}n=n||{date:p,month:f,year:g};var s=_(i),o=_(i),a=_(i);s.setToMin();var c=s.getDateTime();s.setToMax();var v=s.getDateTime();s.hour=12,e=r(e),t=r(t),s.setDateTime(t);var y={year:s.year,era:s.era};s.setDateTime(e);var b=0;b=m(s,y)+1;var C=l("day month.full year",i).formatter,w=C.patterns[0],I=8207===w.charCodeAt(0),S=["date","month","year"],E={month:w.indexOf("{month"),date:w.indexOf("{day"),year:w.indexOf("{year")};S.sort(function(e,t){return E[e]<E[t]?-1:E[e]>E[t]?1:0});var x=function(){return{getLength:function(){return b},getValue:function(t){return s.setDateTime(e),s.addYears(t),u(n.year,i,g,n,S,s)}}}(),k=function(t){return o.setDateTime(e),o.addYears(t),{getLength:function(){return o.numberOfMonthsInThisYear},getValue:function(e){return o.month=o.firstMonthInThisYear,o.addMonths(e),d(n.month,i,f,o)}}},P=function(t,r){return a.setDateTime(e),a.addYears(t),a.month=a.firstMonthInThisYear,a.addMonths(r),a.day=a.firstDayInThisMonth,{getLength:function(){return a.numberOfDaysInThisMonth},getValue:function(e){return a.day=a.firstDayInThisMonth,a.addDays(e),h(n.date,i,p,a)}}};return{isRTL:I,forceLanguage:C.resolvedLanguage,order:S,getDate:function(t,i){var n;i&&(s.setDateTime(i),n={year:s.year,month:s.month,day:s.day});var r=s;r.setDateTime(e),r.addYears(t.year);var o;r.firstMonthInThisYear>r.lastMonthInThisYear?(o=t.month+r.firstMonthInThisYear>r.numberOfMonthsInThisYear?t.month+r.firstMonthInThisYear-r.numberOfMonthsInThisYear:t.month+r.firstMonthInThisYear,n&&n.year!==r.year&&(o=Math.max(Math.min(n.month,r.numberOfMonthsInThisYear),1))):o=n&&n.year!==r.year?Math.max(Math.min(n.month,r.firstMonthInThisYear+r.numberOfMonthsInThisYear-1),r.firstMonthInThisYear):Math.max(Math.min(t.month+r.firstMonthInThisYear,r.firstMonthInThisYear+r.numberOfMonthsInThisYear-1),r.firstMonthInThisYear),r.month=o;var a=Math.max(Math.min(t.date+r.firstDayInThisMonth,r.firstDayInThisMonth+r.numberOfDaysInThisMonth-1),r.firstDayInThisMonth);return!n||n.year===r.year&&n.month===r.month||(a=Math.max(Math.min(n.day,r.firstDayInThisMonth+r.numberOfDaysInThisMonth-1),r.firstDayInThisMonth)),r.day=r.firstDayInThisMonth,r.addDays(a-r.firstDayInThisMonth),r.getDateTime()},getIndex:function(t){var i=r(t);s.setDateTime(i);var n={year:s.year,era:s.era},o=0;s.setDateTime(e),s.month=1,o=m(s,n),s.setDateTime(i);var a=s.month-s.firstMonthInThisYear;0>a&&(a=s.month-s.firstMonthInThisYear+s.numberOfMonthsInThisYear);var l=s.day-s.firstDayInThisMonth,c={year:o,month:a,date:l};return c},years:x,months:k,dates:P}},_getInformationJS:function(e,t){var i=e.getFullYear(),n=t.getFullYear(),r={getLength:function(){return Math.max(0,n-i+1)},getValue:function(e){return i+e}},s=["January","February","March","April","May","June","July","August","September","October","November","December"],o=function(){return{getLength:function(){return s.length},getValue:function(e){return s[e]},getMonthNumber:function(e){return Math.min(e,s.length-1)}}},a=function(e,t){var i=new Date,n=r.getValue(e),s=t+1;i.setFullYear(n,s,0);var o=i.getDate();return{getLength:function(){return o},getValue:function(e){return""+(e+1)},getDateNumber:function(e){return Math.min(e+1,o)}}};return{order:["month","date","year"],getDate:function(e){return new Date(r.getValue(e.year),o(e.year).getMonthNumber(e.month),a(e.year,e.month).getDateNumber(e.date),12,0)},getIndex:function(e){var t=0,n=e.getFullYear();t=i>n?0:n>this.maxYear?r.getLength()-1:e.getFullYear()-i;var s=Math.min(e.getMonth(),o(t).getLength()),l=Math.min(e.getDate()-1,a(t,s).getLength());return{year:t,month:s,date:l}},years:r,months:o,dates:a}}});return b.getInformation=t.Windows.Globalization.Calendar&&t.Windows.Globalization.DateTimeFormatting?b._getInformationWinRT:b._getInformationJS,i.Class.mix(b,r.createEventProperties("change")),i.Class.mix(b,o.DOMEventMixin),b})})}),define("WinJS/Controls/TimePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c){"use strict";i.Namespace.define("WinJS.UI",{TimePicker:i.Namespace._lazy(function(){var n="{minute.integer(2)}",l="{hour.integer(1)}",u="{period.abbreviated(2)}",d={get ariaLabel(){return s._getWinJSString("ui/timePicker").value},get selectHour(){return s._getWinJSString("ui/selectHour").value},get selectMinute(){return s._getWinJSString("ui/selectMinute").value},get selectAMPM(){return s._getWinJSString("ui/selectAMPM").value}},h=function(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()},_=i.Class.define(function(t,i){this._currentTime=_._sentinelDate(),t=t||e.document.createElement("div"),a.addClass(t,"win-disposable"),t.winControl=this;var n=t.getAttribute("aria-label");n||t.setAttribute("aria-label",d.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(t),o.setOptions(this,i)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",d.selectHour),this._minuteElement.setAttribute("aria-label",d.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",d.selectAMPM)},_addControlsInOrder:function(e){var t=this;e.order.forEach(function(e,i){switch(e){case"hour":t._domElement.appendChild(t._hourElement),a.addClass(t._hourElement,"win-order"+i);break;case"minute":t._domElement.appendChild(t._minuteElement),a.addClass(t._minuteElement,"win-order"+i);break;case"period":t._ampmElement&&(t._domElement.appendChild(t._ampmElement),a.addClass(t._ampmElement,"win-order"+i))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(e){this._clock!==e&&(this._clock=e,this._init())}},current:{get:function(){var e=this._currentTime;if(e){var t=_._sentinelDate();return t.setHours(e.getHours()),t.setMinutes(this._getMinutesIndex(e)*this.minuteIncrement),t.setSeconds(0),t.setMilliseconds(0),t}return e},set:function(e){var t;"string"==typeof e?(t=_._sentinelDate(),t.setTime(Date.parse(t.toDateString()+" "+e))):(t=_._sentinelDate(),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()));var i=this._currentTime;h(i,t)||(this._currentTime=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled!==e&&(this._disabled=e,this._hourControl&&(this._hourControl.setDisabled(e),this._minuteControl.setDisabled(e)),this._ampmControl&&this._ampmControl.setDisabled(e))}},element:{get:function(){return this._domElement}},_init:function(e){this._setElement(e),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(e){this._timePatterns.hour!==e&&(this._timePatterns.hour=e,this._init())}},_getHoursAmpm:function(e){var t=e.getHours();return this._ampmElement?0===t?{hours:12,ampm:0}:12>t?{hours:t,ampm:0}:{hours:t-12,ampm:1}:{hours:t}},_getHoursIndex:function(e){return this._ampmElement&&12===e?0:e},_getMinutesIndex:function(e){return parseInt(e.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(e){this._minuteIncrement!==e&&(this._minuteIncrement=e,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(e){this._timePatterns.minute!==e&&(this._timePatterns.minute=e,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(e){this._timePatterns.period!==e&&(this._timePatterns.period=e,this._init())}},_setElement:function(t){if(this._domElement=this._domElement||t,this._domElement){var i=_.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=i,i.forceLanguage&&(this._domElement.setAttribute("lang",i.forceLanguage),this._domElement.setAttribute("dir",i.isRTL?"rtl":"ltr")),a.empty(this._domElement),a.addClass(this._domElement,"win-timepicker"),this._hourElement=e.document.createElement("select"),a.addClass(this._hourElement,"win-timepicker-hour"),this._minuteElement=e.document.createElement("select"),a.addClass(this._minuteElement,"win-timepicker-minute"),this._ampmElement=null,"12HourClock"===i.clock&&(this._ampmElement=e.document.createElement("select"),a.addClass(this._ampmElement,"win-timepicker-period")),this._addControlsInOrder(i);var n=this._getHoursAmpm(this.current);this._hourControl=new c._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(n.hours)}),this._minuteControl=new c._Select(this._minuteElement,{dataSource:i.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new c._Select(this._ampmElement,{dataSource:i.periods,disabled:this.disabled,index:n.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var e=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=e.ampm),this._hourControl.index=this._getHoursIndex(e.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var e=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=e.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(e.hours),this._minuteControl.index=this._getMinutesIndex(this.current))
},_wireupEvents:function(){var e=this,t=function(){var t=e._hourControl.index;return e._ampmElement&&1===e._ampmControl.index&&12!==t&&(t+=12),t},i=function(){var i=t();e._currentTime.setHours(i),e._currentTime.setMinutes(e._minuteControl.index*e.minuteIncrement)};this._hourElement.addEventListener("change",i,!1),this._minuteElement.addEventListener("change",i,!1),this._ampmElement&&this._ampmElement.addEventListener("change",i,!1)}},{_sentinelDate:function(){var e=new Date;return new Date(2011,6,15,e.getHours(),e.getMinutes())},_getInformationWinRT:function(e,i,r){var s=function(i,n){var r=t.Windows.Globalization.DateTimeFormatting;i=i?i:n;var s=new r.DateTimeFormatter(i);return e&&(s=r.DateTimeFormatter(i,s.languages,s.geographicRegion,s.calendar,e)),s},o=t.Windows.Globalization,a=new o.Calendar;e&&(a=new o.Calendar(a.languages,a.getCalendarSystem(),e)),a.setDateTime(_._sentinelDate());var c=a.getClock(),d=24;d=a.numberOfHoursInThisPeriod;var h=function(){var e=s(r.period,u);return{getLength:function(){return 2},getValue:function(t){var i=_._sentinelDate();if(0===t){i.setHours(1);var n=e.format(i);return n}if(1===t){i.setHours(13);var r=e.format(i);return r}return null}}}(),m=function(){var e=s(r.minute,n),t=_._sentinelDate();return{getLength:function(){return 60/i},getValue:function(n){var r=n*i;return t.setMinutes(r),e.format(t)}}}(),p=function(){var e=s(r.hour,l),t=_._sentinelDate();return{getLength:function(){return d},getValue:function(i){return t.setHours(i),e.format(t)}}}(),f=s("hour minute"),g=f.patterns[0],v=["hour","minute"],y={period:g.indexOf("{period"),hour:g.indexOf("{hour"),minute:g.indexOf("{minute")};y.period>-1&&v.push("period");var b=t.Windows.Globalization.DateTimeFormatting.DateTimeFormatter,C=new b("month.full",t.Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),w=C.patterns[0],I=8207===w.charCodeAt(0);if(I){var S=y.hour;y.hour=y.minute,y.minute=S}return v.sort(function(e,t){return y[e]<y[t]?-1:y[e]>y[t]?1:0}),{minutes:m,hours:p,clock:c,periods:h,order:v,forceLanguage:f.resolvedLanguage,isRTL:I}},_getInformationJS:function(e,t){var i=[12,1,2,3,4,5,6,7,8,9,10,11],n={};n.getLength=function(){return 60/t},n.getValue=function(e){var i=e*t;return 10>i?"0"+i.toString():i.toString()};var r=["hour","minute","period"];return"24HourClock"===e&&(i=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],r=["hour","minute"]),{minutes:n,hours:i,clock:e||"12HourClock",periods:["AM","PM"],order:r}}});return _.getInformation=t.Windows.Globalization.DateTimeFormatting&&t.Windows.Globalization.Calendar&&t.Windows.Globalization.ApplicationLanguages?_._getInformationWinRT:_._getInformationJS,i.Class.mix(_,r.createEventProperties("change")),i.Class.mix(_,o.DOMEventMixin),_})})}),define("WinJS/Controls/BackButton",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(e,t,i,n,r,s,o){"use strict";var a=o.Key,l="win-navigation-backbutton",c="win-back",u=3,d=function(){function t(){e.addEventListener("keyup",n,!1),o._addEventListener(e,"pointerup",s,!1)}function i(){e.removeEventListener("keyup",n,!1),o._removeEventListener(e,"pointerup",s,!1)}function n(e){(e.keyCode===a.leftArrow&&e.altKey&&!e.shiftKey&&!e.ctrlKey||e.keyCode===a.browserBack)&&r.back()}function s(e){e.button===u&&r.back()}var l=0;return{addRef:function(){0===l&&t(),l++},release:function(){l>0&&(l--,0===l&&i())},getCount:function(){return l}}}();t.Namespace.define("WinJS.UI",{BackButton:t.Namespace._lazy(function(){var a={get ariaLabel(){return n._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},u=t.Class.define(function(t,n){if(t&&t.winControl)throw new i("WinJS.UI.BackButton.DuplicateConstruction",a.duplicateConstruction);this._element=t||e.document.createElement("button"),n=n||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,s.setOptions(this,n),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),r.addEventListener("navigated",this._navigatedHandler,!1),d.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,r.removeEventListener("navigated",this._navigatedHandler,!1),d.release())},refresh:function(){this._element.disabled=r.canGoBack?!1:!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new i("WinJS.UI.BackButton.BadButtonElement",a.badButtonElement);o.addClass(this._element,l),o.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+c+'"></span>',this.refresh(),this._element.setAttribute("aria-label",a.ariaLabel),this._element.setAttribute("title",a.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){r.back()}});return u._getReferenceCount=function(){return d.getCount()},t.Class.mix(u,s.DOMEventMixin),u})})}),define("WinJS/Controls/Tooltip",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Animations/_TransitionAnimation","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{Tooltip:n.Namespace._lazy(function(){function e(e,t){return"pointerdown"===e?t===B:e in L}function d(e,t){return"pointerdown"===e?t!==B:e in O}var h=0,_=u.Key,m="top",p=a._animationTimeAdjustment(400),f=a._animationTimeAdjustment(1200),g=a._animationTimeAdjustment(400),v=a._animationTimeAdjustment(5e3),y=a._animationTimeAdjustment(0),b=a._animationTimeAdjustment(600),C=a._animationTimeAdjustment(400),w=a._animationTimeAdjustment(600),I=a._animationTimeAdjustment(200),S=a._animationTimeAdjustment(3e5),E=12,x=20,k=45,P=20,T=12,A=1,M=u._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",B=u._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",L={keyup:"",pointerover:"",pointerdown:""},D={pointermove:""},O={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},R={pointerover:"",pointerout:""},F="win-tooltip",N="win-tooltip-phantom",z=g,H=2*z,W=2.5*z,U=v,V=!1,q=!1,j=s._createEventProperty;return n.Class.define(function(e,n){e=e||t.document.createElement("div");var r=u.data(e).tooltip;if(r)return r;if(!q&&i.Windows.UI.ViewManagement.UISettings){var s=new i.Windows.UI.ViewManagement.UISettings;z=a._animationTimeAdjustment(s.mouseHoverTime),H=2*z,W=2.5*z,U=a._animationTimeAdjustment(1e3*s.messageDuration);var o=s.handPreference;V=o===i.Windows.UI.ViewManagement.HandPreference.leftHanded}q=!0,this._disposed=!1,this._placement=m,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=e,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,e.winControl=this,u.addClass(e,"win-disposable"),e.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),l.setOptions(this,n),this._events(),u.data(e).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(e){if(this._innerHTML=e,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=e,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(e){if(this._contentElement=e,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(e){"top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e&&(e=m),this._placement=e,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(e){this._infotip=!!e}},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass=e}},onbeforeopen:j("beforeopen"),onopened:j("opened"),onbeforeclose:j("beforeclose"),onclosed:j("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,c.disposeSubTree(this.element);for(var e=0,t=this._eventListenerRemoveStack.length;t>e;e++)this._eventListenerRemoveStack[e]();this._onDismiss();var i=u.data(this._anchorElement);i&&delete i.tooltip}},addEventListener:function(e,t,i){if(this._anchorElement){this._anchorElement.addEventListener(e,t,i);var n=this;this._eventListenerRemoveStack.push(function(){n._anchorElement.removeEventListener(e,t,i)})}},removeEventListener:function(e,t,i){this._anchorElement&&this._anchorElement.removeEventListener(e,t,i)},open:function(e){switch(this._triggerByOpen=!0,"touch"!==e&&"mouseover"!==e&&"mousedown"!==e&&"keyboard"!==e&&(e="default"),e){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(c.disposeSubTree(this._domElement),t.document.body.removeChild(this._domElement),this._domElement=null,t.document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=t.document.createElement("div");var e=u._uniqueID(this._domElement);this._domElement.setAttribute("id",e);var i=t.document.defaultView.getComputedStyle(this._anchorElement,null),n=this._domElement.style;n.direction=i.direction,n.writingMode=i["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",e),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,t.document.body.appendChild(this._domElement),u.addClass(this._domElement,F),this._extraClass&&u.addClass(this._domElement,this._extraClass),this._phantomDiv=t.document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),t.document.body.appendChild(this._phantomDiv),u.addClass(this._phantomDiv,N);var r=t.document.defaultView.getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=r},_raiseEvent:function(e,i){if(this._anchorElement){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!1,!1,i),this._anchorElement.dispatchEvent(n)}},_captureLastKeyBlurOrPointerOverEvent:function(e){switch(this._lastKeyOrBlurEvent=this._currentKeyOrBlurEvent,e.type){case"keyup":this._currentKeyOrBlurEvent=e.keyCode===_.shift?null:"keyboard";break;case"focusout":this._currentKeyOrBlurEvent=null}},_registerEventToListener:function(e,t){var i=this,n=function(e){i._captureLastKeyBlurOrPointerOverEvent(e),i._handleEvent(e)};u._addEventListener(e,t,n,!1),this._eventListenerRemoveStack.push(function(){u._removeEventListener(e,t,n,!1)})},_events:function(){for(var e in L)this._registerEventToListener(this._anchorElement,e);for(var e in D)this._registerEventToListener(this._anchorElement,e);for(e in O)this._registerEventToListener(this._anchorElement,e);this._registerEventToListener(this._anchorElement,"contextmenu"),this._registerEventToListener(this._anchorElement,"MSHoldVisual")},_handleEvent:function(t){var i=t._normalizedType||t.type;if(!this._triggerByOpen){if(i in R&&u.eventWithinElement(this._anchorElement,t))return;if(e(i,t.pointerType))if(t.pointerType===B)this._isShown||(this._showTrigger="touch"),this._onInvoke("touch","never",t);else{if(this._skipMouseOver&&t.pointerType===M&&"pointerover"===i)return void(this._skipMouseOver=!1);var n="key"===i.substring(0,3)?"keyboard":"mouse";this._isShown||(this._showTrigger=n),this._onInvoke(n,"auto",t)}else if(i in D)this._contactPoint={x:t.clientX,y:t.clientY};else if(d(i,t.pointerType)){var s;if(t.pointerType===B){if("pointerup"===i){this._skipMouseOver=!0;var o=this;r._yieldForEvents(function(){o._skipMouseOver=!1})}s="touch"}else s="key"===i.substring(0,3)?"keyboard":"mouse";if("focusout"!==i&&s!==this._showTrigger)return;this._onDismiss()}else("contextmenu"===i||"MSHoldVisual"===i)&&t.preventDefault()}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var e=this,t=this._infotip?Math.min(3*U,S):U;this._hideDelayTimer=this._setTimeout(function(){e._onDismiss()},t)}},_onHideAnimationEnd:function(){t.document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),h=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(e){var t;if(this._useAnimation=!0,"nodelay"===e)t=0,this._useAnimation=!1;else{var i=(new Date).getTime();I>=i-h?(t="touch"===e?this._infotip?C:y:this._infotip?w:b,this._useAnimation=!1):t="touch"===e?this._infotip?f:p:this._infotip?W:H}return t},_getAnchorPositionFromElementWindowCoord:function(){var e=this._anchorElement.getBoundingClientRect();return{x:e.left,y:e.top,width:e.width,height:e.height}},_getAnchorPositionFromPointerWindowCoord:function(e){return{x:e.x,y:e.y,width:1,height:1}},_canPositionOnSide:function(e,t,i,n){var r=0,s=0;switch(e){case"top":r=n.width+this._offset,s=i.y;break;case"bottom":r=n.width+this._offset,s=t.height-i.y-i.height;break;case"left":r=i.x,s=n.height+this._offset;break;case"right":r=t.width-i.x-i.width,s=n.height+this._offset}return r>=n.width+this._offset&&s>=n.height+this._offset},_positionOnSide:function(e,t,i,n){var r=0,s=0;switch(e){case"top":case"bottom":r=i.x+i.width/2-n.width/2,r=Math.min(Math.max(r,0),t.width-n.width-A),s="top"===e?i.y-n.height-this._offset:i.y+i.height+this._offset;break;case"left":case"right":s=i.y+i.height/2-n.height/2,s=Math.min(Math.max(s,0),t.height-n.height-A),r="left"===e?i.x-n.width-this._offset:i.x+i.width+this._offset}this._domElement.style.left=r+"px",this._domElement.style.top=s+"px",this._phantomDiv.style.left=r+"px",this._phantomDiv.style.top=s+"px",this._phantomDiv.style.width=n.width+"px",this._phantomDiv.style.height=n.height+"px"},_position:function(e){var i={width:0,height:0},n={x:0,y:0,width:0,height:0},r={width:0,height:0};i.width=t.document.documentElement.clientWidth,i.height=t.document.documentElement.clientHeight,"tb-rl"===t.document.defaultView.getComputedStyle(t.document.body,null)["writing-mode"]&&(i.width=t.document.documentElement.clientHeight,i.height=t.document.documentElement.clientWidth),n=!this._contactPoint||"touch"!==e&&"mouse"!==e?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),r.width=this._domElement.offsetWidth,r.height=this._domElement.offsetHeight;var s={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};V&&(s.top[2]="right",s.top[3]="left",s.bottom[2]="right",s.bottom[3]="left");for(var o=s[this._placement],a=o.length,l=0;a>l;l++)if(l===a-1||this._canPositionOnSide(o[l],i,n,r)){this._positionOnSide(o[l],i,n,r);break}return o[l]},_showTooltip:function(e){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),t.document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var i=this;this._removeTooltip=function(e){for(var n=i._anchorElement;n;){if(e.target===n){t.document.body.removeEventListener("DOMNodeRemoved",i._removeTooltip,!1),i._cleanUpDOM();break}n=n.parentNode}},t.document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM(),this._position(e),this._useAnimation?o.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(e,t,i){if(this._shouldDismiss=!1,!this._isShown&&(!i||"keyup"!==i.type||"keyboard"!==this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||i.keyCode===_.tab))){this._hideDelay=t,this._contactPoint=null,i?(this._contactPoint={x:i.clientX,y:i.clientY},this._offset="touch"===e?k:"keyboard"===e?E:x):this._offset="touch"===e?P:T,this._clearTimeout(this._delayTimer),this._clearTimeout(this._hideDelayTimer);var n=this._decideOnDelay(e);if(n>0){var r=this;this._delayTimer=this._setTimeout(function(){r._showTooltip(e)},n)}else this._showTooltip(e)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?o.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))},_setTimeout:function(e,i){return t.setTimeout(e,i)},_clearTimeout:function(e){t.clearTimeout(e)}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return p}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return f}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return g}},_DEFAULT_MESSAGE_DURATION:{get:function(){return v}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return y}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return b}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return C}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return w}},_RESHOW_THRESHOLD:{get:function(){return I}},_HIDE_DELAY_MAX:{get:function(){return S}}})})})}),define("WinJS/Controls/Rating",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_SafeHtml","./Tooltip","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c){"use strict";t.Namespace.define("WinJS.UI",{Rating:t.Namespace._lazy(function(){var a=n._createEventProperty,u={get averageRating(){return r._getWinJSString("ui/averageRating").value},get clearYourRating(){return r._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return r._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return"Invalid argument: tooltipStrings must be null or an array of strings."},get unrated(){return r._getWinJSString("ui/unrated").value},get userRating(){return r._getWinJSString("ui/userRating").value}},d=5,h=!1,_="cancel",m="change",p="previewchange",f=0,g=o._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",v=o._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",y=o._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",b="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",C="win-rating",w="win-star win-empty",I="win-star win-average win-empty",S="win-star win-average win-full",E="win-star win-user win-empty",x="win-star win-user win-full",k="win-star win-tentative win-empty",P="win-star win-tentative win-full",T="win-disabled",A="win-average",M="win-user";return t.Class.define(function(t,i){this._disposed=!1,t=t||e.document.createElement("div"),i=i||{},this._element=t,o.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=h,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(i.maxRating),i.tooltipStrings||this._updateTooltips(null),s.setOptions(this,i),this._controlUpdateNeeded=!0,this._forceLayout(),o._addInsertedNotifier(this._element),t.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(e){this._setControlSize(e),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(e){this._userRating=Math.max(0,Math.min(Number(e)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(e){this._averageRating=Number(e)<1?0:Math.min(Number(e)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled=!!e,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(e){this._enableClear=!!e,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(e){if("object"!=typeof e)throw new i("WinJS.UI.Rating.TooltipStringsIsInvalid",u.tooltipStringsIsInvalid);this._updateTooltips(e),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:a(_),onchange:a(m),onpreviewchange:a(p),dispose:function(){if(!this._disposed){this._disposed=!0;for(var e=0;e<this._toolTips.length;e++)this._toolTips[e].dispose();this._toolTips=null}},addEventListener:function(e,t,i){this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_forceLayout:function(){if(this._controlUpdateNeeded){var e=!1;this._updateControl=function(){e=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,e&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=b)},_createControl:function(){o.addClass(this._element,C);var e="";this._averageRatingHidden=!0;for(var t=0;t<=this._maxRating;t++)e=t===this._maxRating?e+"<div class='"+S+"' style='"+b+"'></div>":e+"<div class='"+E+"'></div>";l.setInnerHTMLUnsafe(this._element,e);for(var i=this._element.firstElementChild,t=0;i;)this._elements[t]=i,t<this._maxRating&&(o.data(i).msStarRating=t+1),i=i.nextElementSibling,t++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()},_getText:function(t){var i=this._tooltipStrings[t];if(i){var n=e.document.createElement("div");return n.innerHTML=i,n.textContent}return t===this._maxRating?u.clearYourRating:t+1},_updateAccessibilityRestState:function(){var e=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),e.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(e.setAttribute("aria-valuenow",this._userRating),e.setAttribute("aria-label",u.userRating),e.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(e.setAttribute("aria-valuenow",this._averageRating),e.setAttribute("aria-label",u.averageRating),e.setAttribute("aria-valuetext",this._averageRating)):(e.setAttribute("aria-valuenow",u.unrated),e.setAttribute("aria-label",u.userRating),e.setAttribute("aria-valuetext",u.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var e=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),e.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(e.setAttribute("aria-label",u.tentativeRating),e.setAttribute("aria-valuenow",this._tentativeRating),e.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(e.setAttribute("aria-valuenow",u.unrated),e.setAttribute("aria-label",u.tentativeRating),e.setAttribute("aria-valuetext",this._getText(this._maxRating))):(e.setAttribute("aria-valuenow",u.unrated),e.setAttribute("aria-label",u.tentativeRating),e.setAttribute("aria-valuetext",u.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var e=0;e<this._maxRating;e++)this._toolTips[e]=new c.Tooltip(this._elements[e])},_decrementRating:function(){this._closeTooltip();var e=!0;0===this._tentativeRating||-1===this._tentativeRating&&0===this._userRating?e=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(this._tentativeRating=0!==this._userRating&&this._userRating>0?this._userRating-1:0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,e=!1)),this._showTentativeRating(e,"keyboard")},_events:function(){function e(e){return{name:e,lowerCaseName:e.toLowerCase(),handler:function(t){var n=i["_on"+e];n&&n.apply(i,[t])}}}var t,i=this,n=[e("KeyDown"),e("FocusOut"),e("FocusIn"),e("PointerCancel"),e("PointerDown"),e("PointerMove"),e("PointerOver"),e("PointerUp"),e("PointerOut")],r=[e("WinJSNodeInserted")];for(t=0;t<n.length;++t)o._addEventListener(this._element,n[t].lowerCaseName,n[t].handler,!1);for(t=0;t<r.length;++t)this._element.addEventListener(r[t].name,r[t].handler,!1);this._ariaValueNowMutationObserver=new o._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onWinJSNodeInserted:function(){this._recalculateStarProperties(),this._updateControl()},_recalculateStarProperties:function(){var t=0;1===this._averageRating&&(t=1);var i=e.getComputedStyle(this._elements[t]);this._elementWidth=i.width,"rtl"===e.getComputedStyle(this._element).direction?(this._elementPadding=i.paddingRight,this._elementBorder=i.borderRight):(this._elementPadding=i.paddingLeft,this._elementBorder=i.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var e=!0;(this._tentativeRating===this._maxRating||-1===this._tentativeRating&&this._userRating===this._maxRating)&&(e=!1),-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:this._tentativeRating=0!==this._userRating?this._userRating<this._maxRating?this._userRating+1:this._maxRating:1,this._showTentativeRating(e,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var e=this._element.getAttributeNode("aria-valuenow");if(null!==e){var t=Number(e.nodeValue);this.userRating!==t&&(this.userRating=t,this._tentativeRating=this._userRating,this._raiseEvent(m,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null),this._captured=!1},_onPointerDown:function(e){(e.pointerType!==y||e.button===f)&&(this._captured||(this._pointerDownAt={x:e.clientX,y:e.clientY},this._pointerDownFocus=!0,this._disabled||(o._setPointerCapture(this._element,e.pointerId),this._captured=!0,e.pointerType===g?(this._tentativeRating=o.data(e.target).msStarRating||0,this._setStarClasses(P,this._tentativeRating,k),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(p,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(t,i){var n,r=this._pointerDownAt||{x:t.clientX,y:t.clientY},s=o._elementsFromPoint(t.clientX,r.y);if(s)for(var a=0,l=s.length;l>a;a++){var c=s[a];if("tooltip"===c.getAttribute("role"))return;if(o.hasClass(c,"win-star")){n=c;break}}var u;if(n&&n.parentElement===this._element)u=o.data(n).msStarRating||0;else{var d=0,h=this.maxRating;"rtl"===e.getComputedStyle(this._element).direction&&(d=h,h=0),u=t.clientX<r.x?d:h}var _=!1,m=Math.min(Math.ceil(u),this._maxRating);0!==m||this._enableClear||(m=1),m!==this._tentativeRating&&(this._closeTooltip(),_=!0),this._tentativeRating=m,this._showTentativeRating(_,i),t.preventDefault()},_onPointerMove:function(e){this._captured&&(e.pointerType===g?this._onCapturedPointerMove(e,"touch"):this._onCapturedPointerMove(e,"mousedown"))},_onPointerOver:function(e){this._disabled||e.pointerType!==v&&e.pointerType!==y||this._onCapturedPointerMove(e,"mouseover")},_onPointerUp:function(e){this._captured&&(o._releasePointerCapture(this._element,e.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(_,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var e=0;e<this._maxRating;e++)this._elements[e].className=k;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(p,this._userRating):this._raiseEvent(p,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(t){var i=o.Key,n=t.keyCode,r=e.getComputedStyle(this._element).direction,s=!0;switch(n){case i.enter:this._onUserRatingChanged();break;case i.tab:this._onUserRatingChanged(),s=!1;break;case i.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null);break;case i.leftArrow:"rtl"===r?this._incrementRating():this._decrementRating();break;case i.upArrow:this._incrementRating();break;case i.rightArrow:"rtl"===r?this._decrementRating():this._incrementRating();break;case i.downArrow:this._decrementRating();break;default:var a=0;if(n>=i.num0&&n<=i.num9?a=i.num0:n>=i.numPad0&&n<=i.numPad9&&(a=i.numPad0),a>0){var l=!1,c=Math.min(n-a,this._maxRating);0!==c||this._enableClear||(c=1),c!==this._tentativeRating&&(this._closeTooltip(),l=!0),this._tentativeRating=c,this._showTentativeRating(l,"keyboard")}else s=!1}s&&(t.stopPropagation(),t.preventDefault())},_onPointerOut:function(e){this._captured||o.eventWithinElement(this._element,e)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(m,this._userRating)))},_raiseEvent:function(t,i){if(!this._disabled&&(this._lastEventWasChange=t===m,this._lastEventWasCancel=t===_,e.document.createEvent)){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(t,!1,!1,{tentativeRating:i}),this._element.dispatchEvent(n)}},_resetNextElement:function(t){if(null!==this._averageRatingElement.nextSibling){o._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var i=this._averageRatingElement.nextSibling.style,n=e.getComputedStyle(this._element).direction;t&&(n="rtl"===n?"ltr":"rtl"),"rtl"===n?(i.paddingRight=this._elementPadding,i.borderRight=this._elementBorder,i.direction="rtl"):(i.paddingLeft=this._elementPadding,i.borderLeft=this._elementBorder,i.direction="ltr"),i.backgroundPosition="left",i.backgroundSize="100% 100%",i.width=this._resizeStringValue(this._elementWidth,1,i.width)}},_resetAverageStar:function(e){this._resetNextElement(e),this._hideAverageRating()
},_resizeStringValue:function(e,t,i){var n=parseFloat(e);if(isNaN(n))return null!==i?i:e;var r=e.substring(n.toString(10).length);return n*=t,n+r},_setControlSize:function(e){var t=(Number(e)||d)>>0;this._maxRating=t>0?t:d},_updateTooltips:function(e){var t,i=0;if(null!==e)for(i=e.length<=this._maxRating+1?e.length:this._maxRating+1,t=0;i>t;t++)this._tooltipStrings[t]=e[t];else{for(t=0;t<this._maxRating;t++)this._tooltipStrings[t]=t+1;this._tooltipStrings[this._maxRating]=u.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(e,t,i){for(var n=0;n<this._maxRating;n++)this._elements[n].className=t>n?e:i},_updateAverageStar:function(){var t=this._averageRatingElement.style,i=this._averageRatingElement.nextSibling.style;"rtl"===e.getComputedStyle(this._element).direction?(t.backgroundPosition="right",t.paddingRight=this._elementPadding,t.borderRight=this._elementBorder,i.paddingRight="0px",i.borderRight="0px",i.direction="ltr"):(t.backgroundPosition="left",i.backgroundPosition="right",t.paddingLeft=this._elementPadding,t.borderLeft=this._elementBorder,i.paddingLeft="0px",i.borderLeft="0px",i.direction="rtl"),o._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue}),t.width=this._resizeStringValue(this._elementWidth,this._floatingValue,t.width),t.backgroundSize=100/this._floatingValue+"% 100%",t.display=e.getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,o._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue}),i.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,i.width),i.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(e,t){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(P,this._tentativeRating,k),this._hideAverageStar()),this._updateAccessibilityHoverState(),e&&(this._openTooltip(t),this._raiseEvent(p,this._tentativeRating))},_openTooltip:function(t){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(t);else if(0===this._tentativeRating){this._clearElement=e.document.createElement("div");var i=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===e.getComputedStyle(this._element).direction&&(i*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+i+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new c.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(t)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var e=0;e<this._maxRating;e++)this._toolTips[e].innerHTML=null},_appendClass:function(e){for(var t=0;t<=this._maxRating;t++)o.addClass(this._elements[t],e)},_setClasses:function(e,t,i){for(var n=0;n<this._maxRating;n++)this._elements[n].className=t>n?e:i},_ensureAverageMSStarRating:function(){o.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(S,this._averageRating-1,I),this._averageRatingElement.className=S;for(var t=0;t<this._maxRating;t++)if(t<this._averageRating&&t+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[t]),this._floatingValue=this._averageRating-t;var i=e.getComputedStyle(this._elements[t]);this._elementWidth=i.width,"rtl"===e.getComputedStyle(this._element).direction?(this._elementPadding=i.paddingRight,this._elementBorder=i.borderRight):(this._elementPadding=i.paddingLeft,this._elementBorder=i.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(x,this._userRating,E),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(w,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(T),this._appendClass(0!==this._averageRating&&0===this._userRating?A:M),this._updateAccessibilityRestState()}}})})})}),define("WinJS/Controls/ToggleSwitch",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/controls"],function(e,t,i,n,r,s,o){"use strict";t.Namespace.define("WinJS.UI",{ToggleSwitch:t.Namespace._lazy(function(){var i="win-toggleswitch",a="win-toggleswitch-header",l="win-toggleswitch-clickregion",c="win-toggleswitch-track",u="win-toggleswitch-fill",d="win-toggleswitch-fill-lower",h="win-toggleswitch-fill-upper",_="win-toggleswitch-thumb",m="win-toggleswitch-values",p="win-toggleswitch-value",f="win-toggleswitch-value-on",g="win-toggleswitch-value-off",v="win-toggleswitch-description",y="win-toggleswitch-on",b="win-toggleswitch-off",C="win-toggleswitch-disabled",w="win-toggleswitch-enabled",I="win-toggleswitch-dragging",S="win-toggleswitch-pressed",E={get on(){return r._getWinJSString("ui/on").value},get off(){return r._getWinJSString("ui/off").value}},x=t.Class.define(function(t,n){t=t||e.document.createElement("div"),this._domElement=t,o.addClass(this._domElement,i),this._domElement.innerHTML=['<div class="'+a+'"></div>','<div class="'+m+'">','   <div class="'+p+" "+f+'"></div>','   <div class="'+p+" "+g+'"></div>',"</div>",'<div class="'+l+'">','   <div class="'+c+'">','       <div class="'+u+" "+d+'"></div>','       <div class="'+_+'"></div>','       <div class="'+u+" "+h+'"></div>',"   </div>","</div>",'<div class="'+v+'"></div>'].join("\n"),this._headerElement=this._domElement.firstElementChild,this._labelsElement=this._headerElement.nextElementSibling,this._labelOnElement=this._labelsElement.firstElementChild,this._labelOffElement=this._labelOnElement.nextElementSibling,this._clickElement=this._labelsElement.nextElementSibling,this._trackElement=this._clickElement.firstElementChild,this._fillLowerElement=this._trackElement.firstElementChild,this._thumbElement=this._fillLowerElement.nextElementSibling,this._fillUpperElement=this._thumbElement.nextElementSibling,this._descriptionElement=this._clickElement.nextElementSibling,this._headerElement.setAttribute("aria-hidden",!0),this._labelsElement.setAttribute("aria-hidden",!0),this._headerElement.setAttribute("id",o._uniqueID(this._headerElement)),this._domElement.setAttribute("aria-labelledby",this._headerElement.id),this._domElement.setAttribute("role","checkbox"),this._domElement.winControl=this,o.addClass(this._domElement,"win-disposable"),this._domElement.addEventListener("keydown",this._keyDownHandler.bind(this)),o._addEventListener(this._clickElement,"pointerdown",this._pointerDownHandler.bind(this)),o._globalListener.addEventListener(this._domElement,"pointermove",this._pointerMoveHandler.bind(this)),o._globalListener.addEventListener(this._domElement,"pointerup",this._pointerUpHandler.bind(this)),this._mutationObserver=new o._MutationObserver(this._ariaChangedHandler.bind(this)),this._mutationObserver.observe(this._domElement,{attributes:!0,attributeFilter:["aria-checked"]}),this._dragX=0,this._dragging=!1,this.checked=!1,this.disabled=!1,this.labelOn=E.on,this.labelOff=E.off,s.setOptions(this,n)},{element:{get:function(){return this._domElement}},checked:{get:function(){return this._checked},set:function(e){e=!!e,e!==this.checked&&(this._checked=e,this._domElement.setAttribute("aria-checked",e),e?(o.addClass(this._domElement,y),o.removeClass(this._domElement,b)):(o.addClass(this._domElement,b),o.removeClass(this._domElement,y)),this.dispatchEvent("change"))}},disabled:{get:function(){return this._disabled},set:function(e){e=!!e,e!==this._disabled&&(e?(o.addClass(this._domElement,C),o.removeClass(this._domElement,w)):(o.removeClass(this._domElement,C),o.addClass(this._domElement,w)),this._disabled=e,this._domElement.setAttribute("aria-disabled",e),this._domElement.setAttribute("tabIndex",e?-1:0))}},labelOn:{get:function(){return this._labelOnElement.innerHTML},set:function(e){this._labelOnElement.innerHTML=e}},labelOff:{get:function(){return this._labelOffElement.innerHTML},set:function(e){this._labelOffElement.innerHTML=e}},title:{get:function(){return this._headerElement.innerHTML},set:function(e){this._headerElement.innerHTML=e}},onchange:n._createEventProperty("change"),dispose:function(){this._disposed||(this._disposed=!0)},_ariaChangedHandler:function(){var e=this._domElement.getAttribute("aria-checked");e="true"===e?!0:!1,this.checked=e},_keyDownHandler:function(e){this.disabled||(e.keyCode===o.Key.space&&(this.checked=!this.checked),(e.keyCode===o.Key.rightArrow||e.keyCode===o.Key.upArrow)&&(this.checked=!0),(e.keyCode===o.Key.leftArrow||e.keyCode===o.Key.downArrow)&&(this.checked=!1))},_pointerDownHandler:function(e){this.disabled||(e.preventDefault(),this._mousedown=!0,this._dragXStart=e.pageX-this._trackElement.offsetLeft-this._thumbElement.offsetWidth/2,this._dragX=this._dragXStart,this._dragging=!1,o.addClass(this._domElement,S))},_pointerUpHandler:function(t){if(!this.disabled&&this._mousedown){t=t.detail.originalEvent,t.preventDefault();var i="rtl"===e.getComputedStyle(this._domElement).direction;if(this._dragging){var n=this._trackElement.offsetWidth-this._thumbElement.offsetWidth;this.checked=i?this._dragX<n/2:this._dragX>=n/2,this._dragging=!1,o.removeClass(this._domElement,I)}else this.checked=!this.checked;this._mousedown=!1,this._thumbElement.style.left="",this._fillLowerElement.style.width="",this._fillUpperElement.style.width="",o.removeClass(this._domElement,S)}},_pointerMoveHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var t=e.pageX-this._trackElement.offsetLeft-this._thumbElement.offsetWidth/2,i=this._trackElement.offsetWidth-this._thumbElement.offsetWidth,n=this._fillLowerElement.offsetLeft+this._trackElement.clientLeft;this._dragX=Math.min(i,t),this._dragX=Math.max(0,this._dragX),!this._dragging&&Math.abs(this._dragX-this._dragXStart)>3&&(this._dragging=!0,o.addClass(this._domElement,I)),this._thumbElement.style.left=this._dragX+"px",this._fillLowerElement.style.width=this._dragX-n+"px",this._fillUpperElement.style.width=i-this._dragX-n+"px"}}});return t.Class.mix(x,s.DOMEventMixin),x})})}),define("WinJS/Controls/SemanticZoom",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p){"use strict";t.Namespace.define("WinJS.UI",{SemanticZoom:t.Namespace._lazy(function(){function s(e){return e}function f(e,t,i){return e+" "+l._animationTimeAdjustment(t)+"s "+i+" "+l._libraryDelay+"ms"}function g(){return f(Y.cssName,U,"ease-in-out")+", "+f("opacity",H,"ease-in-out")}function v(){return f(Y.cssName,V,"ease-in-out")+", "+f("opacity",W,"ease-in-out")}function y(){return f(Y.cssName,J,G)}function b(){return f(Y.cssName,K,G)}function C(e,t){return _.convertToPixels(e,t)}function w(e,t){l.isAnimationEnabled()&&(e.style[Y.scriptName]="scale("+t+")")}function I(e){var t=e.target&&e.target.winControl;t&&!t._resizing&&t._onResize()}function S(e){var t=e[0].target&&e[0].target.winControl;t&&t instanceof at&&t._onPropertyChanged()}var E=i._browserStyleEquivalents,x={get invalidZoomFactor(){return"Invalid zoomFactor"}},k="win-semanticzoom-button",P="win-semanticzoom-button-location",T=3e3,A=8,M="win-semanticzoom",B="win-semanticzoom-zoomedinview",L="win-semanticzoom-zoomedoutview",D="zoomchanged",O=1.05,R=.65,F=.8,N=.2,z=4096,H=.333,W=.333,U=.333,V=.333,q=1e3*H,j=50,J=.333,K=.333,G="cubic-bezier(0.1,0.9,0.2,1)",Y=E.transform,Z=E.transition.scriptName,X=2,Q=.2,$=.45,et=1e3,tt=50,it={none:0,zoomedIn:1,zoomedOut:2},nt=_._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",rt=_._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",st=_._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",ot={x:0,y:0},at=t.Class.define(function(t,r){this._disposed=!1;var s=this,o=i.isPhone;this._element=t,this._element.winControl=this,_.addClass(this._element,"win-disposable"),_.addClass(this._element,M),this._element.setAttribute("role","ms-semanticzoomcontainer");var a=this._element.getAttribute("aria-label");if(a||this._element.setAttribute("aria-label",""),r=r||{},this._zoomedOut=!!r.zoomedOut||!!r.initiallyZoomedOut||!1,this._enableButton=!o,o||void 0===r.enableButton||(this._enableButton=!!r.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=_._clamp(r.zoomFactor,N,F,R),this.zoomedInItem=r.zoomedInItem,this.zoomedOutItem=r.zoomedOutItem,i.validation&&r._zoomFactor&&r._zoomFactor!==this._zoomFactor)throw new n("WinJS.UI.SemanticZoom.InvalidZoomFactor",x.invalidZoomFactor);this._locked=!!r.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in e,this._initialize(),this._configure();var l=e.document.body.contains(this._element);_._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(e){return l?void(l=!1):void I(e)},!1),this._element.addEventListener("mselementresize",I),_._resizeNotifier.subscribe(this._element,I),new _._MutationObserver(S).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),o||(this._element.addEventListener("wheel",this._onWheel.bind(this),!0),this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),_._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),_._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),_._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),_._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),_._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),d._setOptions(this,r,!0),s._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(e){var t=!!e;this._enableButton===t||i.isPhone||(this._enableButton=t,t?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(e){this._zoom(!!e,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&i.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(e){var t=this._zoomFactor,i=_._clamp(e,N,F,R);t!==i&&(this._zoomFactor=i,this._onResize())}},locked:{get:function(){return this._locked},set:function(e){this._locked=!!e,e?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(e){this._zoomedInItem=e||s}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(e){this._zoomedOutItem=e||s}},dispose:function(){this._disposed||(this._disposed=!0,_._resizeNotifier.unsubscribe(this._element,I),h._disposeElement(this._elementIn),h._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var t=m.children(this._element);this._elementIn=t[0],this._elementOut=t[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",c.processAll(this._elementIn),c.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=e.document.createElement("div"),this._element.appendChild(this._cropViewport),this._viewportIn=e.document.createElement("div"),this._opticalViewportIn=e.document.createElement("div"),this._viewportOut=e.document.createElement("div"),this._opticalViewportOut=e.document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=e.document.createElement("div"),this._canvasOut=e.document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=e.document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),_.addClass(this._elementIn,B),_.addClass(this._elementOut,L),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=e.document.createElement("button"),this._sezoButton.className=k+" "+P,this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),_._addEventListener(this._element,"pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var e=this._viewIn.getPanAxis(),t=this._viewOut.getPanAxis(),n=i.isPhone;if(this._pansHorizontallyIn="horizontal"===e||"both"===e,this._pansVerticallyIn="vertical"===e||"both"===e,this._pansHorizontallyOut="horizontal"===t||"both"===t,this._pansVerticallyOut="vertical"===t||"both"===t,!this._zoomInProgress){var r=1/this._zoomFactor-1,s=O-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),r),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),s),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,n||(this._zoomedOut?w(this._canvasIn,this._zoomFactor):w(this._canvasOut,1/this._zoomFactor));var o=this._opticalViewportIn.style,a=this._opticalViewportOut.style,c=this._canvasIn.style,u=this._canvasOut.style;c.opacity=this._zoomedOut&&!n?0:1,u.opacity=this._zoomedOut?1:0,n&&(c.zIndex=1,u.zIndex=2),l.isAnimationEnabled()&&!n&&(o[E["transition-property"].scriptName]=Y.cssName,o[E["transition-duration"].scriptName]="0s",o[E["transition-timing-function"].scriptName]="linear",a[E["transition-property"].scriptName]=Y.cssName,a[E["transition-duration"].scriptName]="0s",a[E["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var e=this._element.getAttribute("aria-checked"),t="true"===e;this._zoomedOut!==t&&(this.zoomedOut=t)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var t=function(e,t,i,n,r){var s=e.style;s.left=t+"px",s.top=i+"px",s.width=n+"px",s.height=r+"px"},i=e.getComputedStyle(this._element,null),n=parseFloat(i.width),r=parseFloat(i.height),s=C(this._element,i.paddingLeft),o=C(this._element,i.paddingRight),a=C(this._element,i.paddingTop),l=C(this._element,i.paddingBottom),c=n-s-o,u=r-a-l,d=1/this._zoomFactor;if(this._viewportWidth===c&&this._viewportHeight===u)return;this._sezoClientHeight=r,this._sezoClientWidth=n,this._viewportWidth=c,this._viewportHeight=u,this._configure();var h=2*d-1,_=Math.min(z,(this._pansHorizontallyIn?h:1)*c),m=Math.min(z,(this._pansVerticallyIn?h:1)*u);this._canvasLeftIn=.5*(_-c),this._canvasTopIn=.5*(m-u),t(this._cropViewport,s,a,c,u),t(this._viewportIn,0,0,c,u),t(this._opticalViewportIn,0,0,c,u),t(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,_,m),t(this._elementIn,this._canvasLeftIn,this._canvasTopIn,c,u);var p=2*O-1,f=(this._pansHorizontallyOut?p:1)*c,g=(this._pansVerticallyOut?p:1)*u;this._canvasLeftOut=.5*(f-c),this._canvasTopOut=.5*(g-u),t(this._viewportOut,0,0,c,u),t(this._opticalViewportOut,0,0,c,u),t(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,f,g),t(this._elementOut,this._canvasLeftOut,this._canvasTopOut,c,u)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(e){return this._zooming||!this._lastMouseX&&!this._lastMouseY||e.screenX===this._lastMouseX&&e.screenY===this._lastMouseY?(this._lastMouseX=e.screenX,void(this._lastMouseY=e.screenY)):void(Math.abs(e.screenX-this._lastMouseX)<=A&&Math.abs(e.screenY-this._lastMouseY)<=A||(this._lastMouseX=e.screenX,this._lastMouseY=e.screenY,this._displayButton()))},_displayButton:function(){if(p.isHoverable){e.clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var t=this;this._dismissButtonTimer=e.setTimeout(function(){t._hideSemanticZoomButton()},l._animationTimeAdjustment(T))}},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(a.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(e){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(e)this._sezoButton.style.visibility="hidden";else{var t=this;a.fadeOut(this._sezoButton).then(function(){t._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(e){e.target!==this.element&&this._hideSemanticZoomButton(!0)},_onWheel:function(e){e.ctrlKey&&(this._zoom(e.deltaY>0,this._getPointerLocation(e)),e.stopPropagation(),e.preventDefault())},_onMouseWheel:function(e){e.ctrlKey&&(this._zoom(e.wheelDelta<0,this._getPointerLocation(e)),e.stopPropagation(),e.preventDefault())},_onPenHover:function(e){e.pointerType===rt&&0===e.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(e){var t=!1;if(e.ctrlKey){var i=_.Key;switch(e.keyCode){case i.add:case i.equal:case 61:this._zoom(!1),t=!0;break;case i.subtract:case i.dash:case 173:this._zoom(!0),t=!0}}t&&(e.stopPropagation(),e.preventDefault())},_createPointerRecord:function(e,t){var i=this._getPointerLocation(e),n={};return n.startX=n.currentX=i.x,n.startY=n.currentY=i.y,n.fireCancelOnPinch=t,this._pointerRecords[e.pointerId]=n,this._pointerCount=Object.keys(this._pointerRecords).length,n},_deletePointerRecord:function(e){var t=this._pointerRecords[e];return delete this._pointerRecords[e],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),t},_fakeCancelOnPointer:function(t){var i=e.document.createEvent("UIEvent");i.initUIEvent("touchcancel",!0,!0,e,0),i.touches=t.touches,i.targetTouches=t.targetTouches,i.changedTouches=[t._currentTouch],i._fakedBySemanticZoom=!0,t.target.dispatchEvent(i)},_handlePointerDown:function(e){this._createPointerRecord(e,!1);for(var t=Object.keys(this._pointerRecords),i=0,n=t.length;n>i;i++)try{_._setPointerCapture(this._hiddenElement,t[i]||0)}catch(r){return void this._resetPointerRecords()}e.stopImmediatePropagation(),e.preventDefault()},_handleFirstPointerDown:function(e){this._resetPointerRecords(),this._createPointerRecord(e,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(e){e.target!==this._element&&this._isBouncing&&e.stopImmediatePropagation()},_onPointerDown:function(e){e.pointerType===nt&&(0===this._pointerCount?this._handleFirstPointerDown(e):this._handlePointerDown(e))},_onPointerMove:function(e){function t(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function i(e,t){return{x:.5*(e.currentX+t.currentX)|0,y:.5*(e.currentY+t.currentY)|0}}if(e.pointerType===st||e.pointerType===rt)return void this._onMouseMove(e);if(e.pointerType===nt){var n=this._pointerRecords[e.pointerId],r=this._getPointerLocation(e);if(n){if(n.currentX=r.x,n.currentY=r.y,2===this._pointerCount){this._pinching=!0;var s=Object.keys(this._pointerRecords),a=this._pointerRecords[s[0]],l=this._pointerRecords[s[1]];this._currentMidPoint=i(a,l);var c=t(a.currentX,a.currentY,l.currentX,l.currentY),u=this,d=function(e){var t=e?it.zoomedOut:it.zoomedIn,n=e?u._pinchedDirection===it.zoomedIn&&!u._zoomingOut:u._pinchedDirection===it.zoomedOut&&u._zoomingOut,r=e?!u._zoomedOut:u._zoomedOut;if(u._pinchedDirection===it.none)r?(u._isBouncingIn=!1,u._zoom(e,i(a,l),!0),u._pinchedDirection=t):u._isBouncingIn||u._playBounce(!0,i(a,l));else if(n){var s=u._lastPinchDistance/u._lastPinchStartDistance,o=u._lastLastPinchDistance/u._lastPinchDistance;(e&&s>Q||!e&&o>$)&&(u._zoom(e,i(a,l),!0),u._pinchedDirection=t)}};this._updatePinchDistanceRecords(c),this._pinchDistanceCount>=X&&(this._zooming||this._isBouncing||(o("WinJS.UI.SemanticZoom:EndPinchDetection,info"),d(this._lastPinchDirection===it.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(n.fireCancelOnPinch&&(this._fakeCancelOnPointer(e,n),n.fireCancelOnPinch=!1),e.stopImmediatePropagation(),e.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(e){e.pointerType===nt&&e.target===this._element&&this._completePointerUp(e,!1)},_onPointerUp:function(e){this._releasePointerCapture(e),this._completePointerUp(e,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(e){e._fakedBySemanticZoom||(this._releasePointerCapture(e),this._completePointerUp(e,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(e){var t=this._pointerRecords[e.pointerId];t&&(t.dirty=!1)},_onLostPointerCapture:function(e){var t=this._pointerRecords[e.pointerId];if(t){t.dirty=!0;var i=this;u.timeout(tt).then(function(){t.dirty&&i._completePointerUp(e,!1)})}},_onMSContentZoom:function(e){var t=e.target;if(t===this._opticalViewportIn||t===this._opticalViewportOut){var i=t.msContentZoomFactor<.995,n=t.msContentZoomFactor>1.005;!i||this._zoomedOut||this._zoomingOut?n&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(e){function t(t){i._lastPinchDirection===t?i._pinchDistanceCount++:(i._pinchGesture++,i._pinchDistanceCount=0,i._lastPinchStartDistance=e),i._lastPinchDirection=t,i._lastPinchDistance=e,i._lastLastPinchDistance=i._lastPinchDistance}var i=this;-1===this._lastPinchDistance?(o("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=e):this._lastPinchDistance!==e&&t(this._lastPinchDistance>e?it.zoomedOut:it.zoomedIn)},_zoomFromCurrent:function(e){this._zoom(e,null,!1,!0)},_zoom:function(e,t,n,r,s){if(o("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+e+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!n)return;e!==this._zoomingOut&&this._startAnimations(e)}else if(e!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!n,t&&(e?this._viewIn:this._viewOut).setCurrentItem(t.x,t.y),this._zoomInProgress=!0,(e?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",e&&i.isPhone&&(this._canvasOut.style.opacity=1);var a=this._viewIn.beginZoom(),l=this._viewOut.beginZoom(),c=null;if((a||l)&&i.isPhone&&(c=u.join([a,l])),r&&!s){var d=this;(e?this._viewIn:this._viewOut).getCurrentItem().then(function(t){var i=t.position;d._prepareForZoom(e,{x:d._rtl()?d._sezoClientWidth-i.left-.5*i.width:i.left+.5*i.width,y:i.top+.5*i.height},u.wrap(t),c)})}else this._prepareForZoom(e,t||{},null,c,s)}},_prepareForZoom:function(t,i,n,r,s){function a(e,t){l._canvasIn.style[E["transform-origin"].scriptName]=l._canvasLeftIn+c-e.x+"px "+(l._canvasTopIn+u-e.y)+"px",l._canvasOut.style[E["transform-origin"].scriptName]=l._canvasLeftOut+c-t.x+"px "+(l._canvasTopOut+u-t.y)+"px"}o("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var l=this,c=i.x,u=i.y;"number"==typeof c&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(c=.5*this._sezoClientWidth),"number"==typeof u&&this._pansVerticallyIn&&this._pansVerticallyOut||(u=.5*this._sezoClientHeight),a(ot,ot),s?this._aligning=!1:this._alignViewsPromise=this._alignViews(t,c,u,n).then(function(){l._aligning=!1,l._gestureEnding=!1,l._alignViewsPromise=null,l._zooming||l._gesturing||l._completeZoom()}),this._zoomingOut=t,e.getComputedStyle(this._canvasIn).opacity,e.getComputedStyle(this._canvasOut).opacity,o("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(t,r)},_alignViews:function(e,t,i,n){var r=1-this._zoomFactor,s=this._rtl(),o=r*(s?this._viewportWidth-t:t),a=r*i,l=this;if(e){var c=n||this._viewIn.getCurrentItem();if(c)return c.then(function(e){var t=e.position,i={left:t.left*l._zoomFactor+o,top:t.top*l._zoomFactor+a,width:t.width*l._zoomFactor,height:t.height*l._zoomFactor};return l._viewOut.positionItem(l._zoomedOutItem(e.item),i)})}else{var d=n||this._viewOut.getCurrentItem();if(d)return d.then(function(e){var t=e.position,i={left:(t.left-o)/l._zoomFactor,top:(t.top-a)/l._zoomFactor,width:t.width/l._zoomFactor,height:t.height/l._zoomFactor};return l._viewIn.positionItem(l._zoomedInItem(e.item),i)})}return new u(function(e){e({x:0,y:0})})},_startAnimations:function(e,t){this._zoomingOut=e;var n=i.isPhone;
if(l.isAnimationEnabled()&&!n&&(o("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[Z]=e?g():v(),this._canvasOut.style[Z]=e?v():g()),n||(w(this._canvasIn,e?this._zoomFactor:1),w(this._canvasOut,e?1:1/this._zoomFactor)),this._canvasIn.style.opacity=e&&!n?0:1,(!n||e)&&(this._canvasOut.style.opacity=e?1:0),l.isAnimationEnabled())if(t){var r=this,s=function(){r._canvasIn.style[Y.scriptName]="",r._canvasOut.style[Y.scriptName]="",r._onZoomAnimationComplete()};t.then(s,s)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),l._animationTimeAdjustment(q));else this._zooming=!1,this._canvasIn.style[Y.scriptName]="",this._canvasOut.style[Y.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){o("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(e){return this._disposed?void 0:e.target!==this._canvasOut&&e.target!==this._canvasIn||!this._isBouncing?void(e.target===this._canvasIn&&e.propertyName===Y.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(t){t&&e.clearTimeout(t)},_completePointerUp:function(e,t){if(!this._disposed){var i=e.pointerId,n=this._pointerRecords[i];if(n&&(this._deletePointerRecord(i),this._isBouncingIn&&this._playBounce(!1),t&&this._pinchedDirection!==it.none&&e.stopImmediatePropagation(),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==it.none&&this._pinchDistanceCount<X)return this._zoom(this._lastPinchDirection===it.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==it.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(t,i){var n=this;n._TTFFTimer=e.setTimeout(function(){this._disposed||(n._TTFFTimer=e.setTimeout(t,i))},j)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var t=this;(this._zoomInProgress||this._isBouncing)&&(t._completeZoomTimer=e.setTimeout(function(){t._completeZoom()},l._animationTimeAdjustment(et)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){o("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!i.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var t=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),t=!0),this._setVisibility(),t){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(D,!0,!0,this._zoomedOut),this._element.dispatchEvent(n),this._isActive&&_._setActive(this._zoomedOut?this._elementOut:this._elementIn)}o("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var t=e.document.activeElement;return this._element===t||this._element.contains(t)},_setLayout:function(e,t,i){var n=e.style;n.position=t,n.overflow=i},_setupOpticalViewport:function(e){e.style["-ms-overflow-style"]="none",i.isPhone||(e.style["-ms-content-zooming"]="zoom",e.style["-ms-content-zoom-limit-min"]="99%",e.style["-ms-content-zoom-limit-max"]="101%",e.style["-ms-content-zoom-snap-points"]="snapList(100%)",e.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function e(e,t){e.style.visibility=t?"visible":"hidden",e.style.zIndex=t?"1":"0"}e(this._opticalViewportIn,!this._zoomedOut||i.isPhone),e(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=it.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(e){var t=e.pointerId;try{_._releasePointerCapture(this._hiddenElement,t)}catch(i){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var e=this;this._recordResetPromise=u.timeout(tt).then(function(){0===e._pointerCount&&(e._resetPointerRecords(),e._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=it.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(t){var i={left:0,top:0};try{i=this._element.getBoundingClientRect()}catch(n){}var r=e.getComputedStyle(this._element,null),s=C(this._element,r.paddingLeft),o=C(this._element,r.paddingTop),a=C(this._element,r.borderLeftWidth);return{x:+t.clientX===t.clientX?t.clientX-i.left-s-a:0,y:+t.clientY===t.clientY?t.clientY-i.top-o-o:0}},_playBounce:function(e,t){if(l.isAnimationEnabled()&&this._isBouncingIn!==e){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=e,e?this._bounceCenter=t:this._aligned=!0;var i=this._zoomedOut?this._canvasOut:this._canvasIn,n=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,r=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;i.style[E["transform-origin"].scriptName]=n+this._bounceCenter.x+"px "+(r+this._bounceCenter.y)+"px",i.style[Z]=e?y():b(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var s=e?this._zoomedOut?2-O:O:1;w(i,s),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),l._animationTimeAdjustment(q))}},_rtl:function(){return"rtl"===e.getComputedStyle(this._element,null).direction},_pinching:{set:function(e){this._viewIn.pinching=e,this._viewOut.pinching=e}}});return t.Class.mix(at,r.createEventProperties("zoomchanged")),t.Class.mix(at,d.DOMEventMixin),at})})}),define("WinJS/Controls/Pivot/_Constants",[],function(){"use strict";var e={_ClassName:{pivot:"win-pivot",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch",pivotDisableContentSwipeNavigation:"win-pivot-disablecontentswipenavigation"}};return e}),define("WinJS/Controls/Pivot/_Item",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{PivotItem:i.Namespace._lazy(function(){var e={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},s=i.Class.define(function(i,n){if(i=i||t.document.createElement("DIV"),n=n||{},i.winControl)throw new r("WinJS.UI.PivotItem.DuplicateConstruction",e.duplicateConstruction);i.winControl=this,this._element=i,d.addClass(this.element,s._ClassName.pivotItem),d.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=s._ClassName.pivotItemContent,i.appendChild(this._contentElement);for(var a=this.element.firstChild;a!==this._contentElement;){var l=a.nextSibling;this._contentElement.appendChild(a),a=l}this._processors=[o.processAll],c.setOptions(this,n)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(e){this._header=e,this._parentPivot&&this._parentPivot._headersState.handleHeaderChanged(this)}},_parentPivot:{get:function(){for(var e=this._element;e&&!d.hasClass(e,h._ClassName.pivot);)e=e.parentNode;return e&&e.winControl}},_process:function(){var e=this;return this._processors&&this._processors.push(function(){return l.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(t,i){return t.then(function(){return i(e.contentElement)})},this._processed||a.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,u.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){t!==o.processAll&&(e._processors=e._processors||[],e._processors.push(t),e._processed&&e._process())})});return s})})}),define("WinJS/Controls/Pivot",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_TabContainer","../Utilities/_KeyboardBehavior","./Pivot/_Constants","./Pivot/_Item","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y,b,C){"use strict";t.Namespace.define("WinJS.UI",{Pivot:t.Namespace._lazy(function(){function v(t){var i=e.document.createTextNode("object"==typeof t.header?JSON.stringify(t.header):""+t.header);return i}function w(){}var I=g._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",S=g._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",E=g.Key,x=r._createEventProperty,k={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},P=g._MSManipulationEvent,T=!1,A=null,M={nop:{exit:w,render:w,activateHeader:w,handleNavigation:w,handleResize:w,handleHeaderChanged:w},common:{headersContainerLeadingMargin:9,getCumulativeHeaderWidth:function(e,t){if(0===t)return 0;for(var i=e._headersContainerElement.children.length,n=0;t>n;n++){var r=M.common.renderHeader(e,n,!1);e._headersContainerElement.appendChild(r)}var s=0,o=e._rtl?e._headersContainerElement.lastElementChild:e._headersContainerElement.children[i],a=e._rtl?e._headersContainerElement.children[i]:e._headersContainerElement.lastElementChild;s=a.offsetLeft+a.offsetWidth-o.offsetLeft;for(var n=0;t>n;n++)e._headersContainerElement.removeChild(e._headersContainerElement.lastElementChild);return s},refreshHeadersState:function(e,t){t&&(this._cachedWidth=0);var i=this._cachedWidth||this.getCumulativeHeaderWidth(e,e.items.length);this._cachedWidth=i,i>e._viewportWidth&&!(e._headersState instanceof M.overflowState)?(e._headersState.exit(),e._headersState=new M.overflowState(e)):i<=e._viewportWidth&&!(e._headersState instanceof M.staticState)&&(e._headersState.exit(),e._headersState=new M.staticState(e))},renderHeader:function(t,i,n){function r(){t._disposed||t._headersContainerElement.contains(a)&&i!==t.selectedIndex&&"true"===a.getAttribute("aria-selected")&&(t.selectedIndex=i)}var s=g._syncRenderer(v),o=t._items.getAt(i),a=e.document.createElement("BUTTON");return g.addClass(a,B._ClassName.pivotHeader),a._item=o,a._pivotItemIndex=i,s(o,a),n&&(a.setAttribute("aria-selected",i===t.selectedIndex),a.setAttribute("role","tab"),new g._MutationObserver(r).observe(a,{attributes:!0,attributeFilter:["aria-selected"]})),a},updateHeader:function(e,t){var i=e.items.indexOf(t),n=e._headersContainerElement.children[i];n.innerHTML="";var r=g._syncRenderer(v);r(t,n)},setActiveHeader:function(t,i){var n=!1;i&&(i.classList.remove(B._ClassName.pivotHeaderSelected),i.setAttribute("aria-selected",!1),n=e.document.activeElement===i),t.classList.add(B._ClassName.pivotHeaderSelected),t.setAttribute("aria-selected",!0),n&&t.focus()}},staticState:t.Class.define(function(e){if(this.pivot=e,this._firstRender=!0,this._transitionAnimation=h.wrap(),e._headersContainerElement.children.length&&c.isAnimationEnabled()){var t=e._headersContainerElement.querySelector("."+B._ClassName.pivotHeaderSelected),n=0,r=0;e._rtl?(n=t.offsetLeft,n+=t.offsetWidth,r=e._viewportWidth-M.common.getCumulativeHeaderWidth(e,e.selectedIndex)-M.common.headersContainerLeadingMargin,r+=parseFloat(e._headersContainerElement.style.marginLeft)):(n=t.offsetLeft,n+=parseFloat(e._headersContainerElement.style.marginLeft),r=M.common.getCumulativeHeaderWidth(e,e.selectedIndex)+M.common.headersContainerLeadingMargin);var s=n-r;this.render();for(var o=i._browserStyleEquivalents.transform.cssName,a="translateX("+s+"px)",l=0,u=e._headersContainerElement.children.length;u>l;l++)e._headersContainerElement.children[l].style[o]=a;this._transitionAnimation=c.executeTransition(e._headersContainerElement.querySelectorAll("."+B._ClassName.pivotHeader),{property:o,delay:0,duration:B._headerSlideAnimationDuration,timing:"ease-out",to:""})}},{exit:function(){this._transitionAnimation.cancel()},render:function(){var e=this.pivot;if(!e._pendingRefresh&&e._items){if(f._disposeElement(e._headersContainerElement),g.empty(e._headersContainerElement),e._rtl?(e._headersContainerElement.style.marginLeft="0px",e._headersContainerElement.style.marginRight=M.common.headersContainerLeadingMargin+"px"):(e._headersContainerElement.style.marginLeft=M.common.headersContainerLeadingMargin+"px",e._headersContainerElement.style.marginRight="0px"),e._viewportElement.style.overflow=1===e.items.length?"hidden":"",e.items.length){for(var t=0;t<e.items.length;t++){var i=M.common.renderHeader(e,t,!0);e._headersContainerElement.appendChild(i),t===e.selectedIndex&&i.classList.add(B._ClassName.pivotHeaderSelected)}e._tabContainer.childFocus=e._headersContainerElement.children[e.selectedIndex]}this._firstRender=!1}},activateHeader:function(e){var t=this.pivot._headersContainerElement.children[this.pivot.selectedIndex];M.common.setActiveHeader(e,t),this.pivot._animateToPrevious=e._pivotItemIndex<this.pivot.selectedIndex,this.pivot.selectedIndex=e._pivotItemIndex},handleNavigation:function(e,t,i){this._firstRender&&this.render(),M.common.setActiveHeader(this.pivot._headersContainerElement.children[t],this.pivot._headersContainerElement.children[i]),this.pivot._tabContainer.childFocus=this.pivot._headersContainerElement.children[t]},handleResize:function(){M.common.refreshHeadersState(this.pivot)},handleHeaderChanged:function(e){M.common.updateHeader(this.pivot,e),M.common.refreshHeadersState(this.pivot,!0)}}),overflowState:t.Class.define(function(e){if(this.pivot=e,this._blocked=!1,this._firstRender=!0,this._transitionAnimation=h.wrap(),e._slideHeadersAnimation=h.wrap(),e._headersContainerElement.children.length&&c.isAnimationEnabled()){var t=this,n=function(){t._blocked=!1,t.render()};this._blocked=!0;var r=e._headersContainerElement.querySelector("."+B._ClassName.pivotHeaderSelected),s=0,o=0;e._rtl?(s=e._viewportWidth-M.common.headersContainerLeadingMargin,o=r.offsetLeft,o+=r.offsetWidth,o+=parseFloat(e._headersContainerElement.style.marginLeft)):(s=M.common.headersContainerLeadingMargin,o=r.offsetLeft,o+=parseFloat(e._headersContainerElement.style.marginLeft));for(var a=s-o,l=0;l<e.selectedIndex;l++)e._headersContainerElement.appendChild(e._headersContainerElement.children[l].cloneNode(!0));var u=i._browserStyleEquivalents.transform.cssName;this._transitionAnimation=c.executeTransition(e._headersContainerElement.querySelectorAll("."+B._ClassName.pivotHeader),{property:u,delay:0,duration:B._headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+a+"px)"}).then(n,n)}},{exit:function(){this._transitionAnimation.cancel(),this.pivot._slideHeadersAnimation.cancel()},render:function(t){var n=this.pivot;if(!this._blocked&&!n._pendingRefresh&&n._items){var r=n._headersContainerElement.contains(e.document.activeElement);f._disposeElement(n._headersContainerElement),g.empty(n._headersContainerElement);var s=.8*n._viewportWidth+"px";if(1===n._items.length){var o=M.common.renderHeader(n,0,!0);o.classList.add(B._ClassName.pivotHeaderSelected),n._headersContainerElement.appendChild(o),n._viewportElement.style.overflow="hidden",n._headersContainerElement.style.marginLeft="0px",n._headersContainerElement.style.marginRight="0px"}else if(n._items.length>1){var a=n._items.length+(t?2:1),l=n.selectedIndex-1;n._viewportElement.style.overflow&&(n._viewportElement.style.overflow="");for(var u=0;a>u;u++){-1===l?l=n._items.length-1:l===n._items.length&&(l=0);var o=M.common.renderHeader(n,l,!0);o.style.maxWidth=s,n._headersContainerElement.appendChild(o),l===n.selectedIndex&&o.classList.add(B._ClassName.pivotHeaderSelected),l++}if(!n._firstLoad&&!this._firstRender){var d,h;t?(d="",h="0"):(d="0",h="");var _=n._headersContainerElement.children[a-1];_.style.opacity=d;var m=.167;_.style[i._browserStyleEquivalents.transition.scriptName]="opacity "+c._animationTimeAdjustment(m)+"s",e.getComputedStyle(_).opacity,_.style.opacity=h}n._headersContainerElement.children[0].setAttribute("aria-hidden","true"),n._headersContainerElement.style.marginLeft="0px",n._headersContainerElement.style.marginRight="0px";var p=n._rtl?"marginRight":"marginLeft",v=n._rtl?"paddingLeft":"paddingRight",y=n._headersContainerElement.children[0],b=y.offsetWidth+parseFloat(e.getComputedStyle(y)[p])-parseFloat(e.getComputedStyle(y)[v]);if(y!==n._headersContainerElement.children[0])return;n._headersContainerElement.style[p]=-1*b+"px",n._prevButton=e.document.createElement("button"),g.addClass(n._prevButton,B._ClassName.pivotNavButton),g.addClass(n._prevButton,B._ClassName.pivotNavButtonPrev),n._prevButton.addEventListener("click",function(){n.locked||(n._rtl?n._goNext():n._goPrevious())}),n._headersContainerElement.appendChild(n._prevButton),n._prevButton.style.left=n._rtl?"0px":b+"px",n._nextButton=e.document.createElement("button"),g.addClass(n._nextButton,B._ClassName.pivotNavButton),g.addClass(n._nextButton,B._ClassName.pivotNavButtonNext),n._nextButton.addEventListener("click",function(){n.locked||(n._rtl?n._goPrevious():n._goNext())}),n._headersContainerElement.appendChild(n._nextButton),n._nextButton.style.right=n._rtl?b+"px":"0px"}var C=n._headersContainerElement.children.length>1?1:0;n._tabContainer.childFocus=n._headersContainerElement.children[C],r&&n._headersContainerElement.children[C].focus(),this._firstRender=!1}},activateHeader:function(e){e.previousSibling&&(this.pivot.selectedIndex=e._pivotItemIndex)},handleNavigation:function(e,t,n){function r(e){return l?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:e.offsetLeft}function s(){o._disposed||(o._headersState.render(e),o._slideHeadersAnimation=h.wrap())}var o=this.pivot;if(this._blocked||0>t||o._firstLoad)return void this.render(e);var a;if(e?a=o._headersContainerElement.children[0]:(n>t&&(t+=o._items.length),a=o._headersContainerElement.children[1+t-n]),!a)return void this.render(e);g.removeClass(o._headersContainerElement.children[1],B._ClassName.pivotHeaderSelected),g.addClass(a,B._ClassName.pivotHeaderSelected);var l=o._rtl,u=r(o._headersContainerElement.children[1])-r(a);l&&(u*=-1);var d;d=c.isAnimationEnabled()?c.executeTransition(o._headersContainerElement.querySelectorAll("."+B._ClassName.pivotHeader),{property:i._browserStyleEquivalents.transform.cssName,delay:0,duration:B._headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+u+"px)"}):h.wrap(),o._slideHeadersAnimation=d.then(s,s)},handleResize:function(){M.common.refreshHeadersState(this.pivot)},handleHeaderChanged:function(){this.render(),M.common.refreshHeadersState(this.pivot,!0)}})},B=t.Class.define(function(t,r){if(A||(A=g._detectSnapPointsSupport().then(function(e){T=e})),t=t||e.document.createElement("DIV"),r=r||{},t.winControl)throw new n("WinJS.UI.Pivot.DuplicateConstruction",L.duplicateConstruction);this._handleItemChangedBound=this._handleItemChanged.bind(this),this._handleItemInsertedBound=this._handleItemInserted.bind(this),this._handleItemMovedBound=this._handleItemMoved.bind(this),this._handleItemRemovedBound=this._handleItemRemoved.bind(this),this._handleItemReloadBound=this._handleItemReload.bind(this),this._id=t.id||g._uniqueID(t),this._writeProfilerMark("constructor,StartTM"),t.winControl=this,this._element=t,this._element.setAttribute("role","tablist"),this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",L.pivotAriaLabel),g.addClass(this.element,B._ClassName.pivot),g.addClass(this.element,"win-disposable"),g._addEventListener(this.element,"pointerenter",this._updatePointerType.bind(this)),g._addEventListener(this.element,"pointerout",this._updatePointerType.bind(this)),this._pointerType=I,this._titleElement=e.document.createElement("DIV"),this._titleElement.style.display="none",g.addClass(this._titleElement,B._ClassName.pivotTitle),this._element.appendChild(this._titleElement),this._headersContainerElement=e.document.createElement("DIV"),g.addClass(this._headersContainerElement,B._ClassName.pivotHeaders),this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this)),this._element.appendChild(this._headersContainerElement),this._element.addEventListener("click",this._elementClickedHandler.bind(this)),g._addEventListener(this._element,"pointerdown",this._elementPointerDownHandler.bind(this)),g._addEventListener(this._element,"pointerup",this._elementPointerUpHandler.bind(this)),g._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this)),g._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this)),this._winKeyboard=new b._WinKeyboard(this._headersContainerElement),this._tabContainer=new y.TabContainer(this._headersContainerElement),this._viewportElement=e.document.createElement("DIV"),this._viewportElement.className=B._ClassName.pivotViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",L.pivotViewportAriaLabel),this._resizeHandlerBound=this._resizeHandler.bind(this),this.element.addEventListener("mselementresize",this._resizeHandlerBound),g._resizeNotifier.subscribe(this.element,this._resizeHandlerBound),this._viewportWidth=null,this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),g._addEventListener(this._viewportElement,"pointerdown",this._pointerDownHandler.bind(this)),this._surfaceElement=e.document.createElement("DIV"),this._surfaceElement.className=B._ClassName.pivotSurface,this._viewportElement.appendChild(this._surfaceElement),this._offsetFromCenter=0,this._currentIndexOnScreen=0,this._loadId=0,this._navMode=B._NavigationModes.none,this._currentManipulationState=P.MS_MANIPULATION_STATE_STOPPED,this._headersState=M.nop,this._parse(),r=i._shallowCopy(r),r.items&&(this.items=r.items,delete r.items),p.setOptions(this,r),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},locked:{get:function(){return g.hasClass(this.element,B._ClassName.pivotLocked)},set:function(e){g[e?"addClass":"removeClass"](this.element,B._ClassName.pivotLocked),e&&this._hideNavButtons()}},items:{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(e){var t=!this._pendingItems;this._pendingItems=e,this._refresh(),t&&(this._pendingIndexOnScreen=0)}},title:{get:function(){return this._titleElement.textContent},set:function(e){e?(this._titleElement.style.display="block",this._titleElement.textContent=e):(this._titleElement.style.display="none",this._titleElement.textContent="")}},selectedIndex:{get:function(){return 0===this.items.length?-1:+this._pendingIndexOnScreen===this._pendingIndexOnScreen?this._pendingIndexOnScreen:this._currentIndexOnScreen},set:function(e){e>=0&&e<this.items.length&&(this._pendingRefresh?this._pendingIndexOnScreen=e:(this._navMode=this._navMode||B._NavigationModes.api,this._loadItem(e)))}},selectedItem:{get:function(){return this.items.getAt(this.selectedIndex)},set:function(e){var t=this.items.indexOf(e);-1!==t&&(this.selectedIndex=t)}},dispose:function(){if(!this._disposed){this._disposed=!0,this._updateEvents(this._items),g._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound),this._headersState.exit(),f._disposeElement(this._headersContainerElement);for(var e=0,t=this.items.length;t>e;e++)this.items.getAt(e).dispose()}},forceLayout:function(){this._disposed||this._resizeHandler()},onselectionchanged:x(k.selectionChanged),onitemanimationstart:x(k.itemAnimationStart),onitemanimationend:x(k.itemAnimationEnd),_currentScrollTargetLocation:{get:function(){return this._viewportWidth===B._invalidViewportWidth?0:(50+this._offsetFromCenter)*Math.ceil(this._viewportWidth)}},_pointerType:{get:function(){return this._pointerTypeValue},set:function(e){this._pointerTypeValue!==e&&(this._pointerTypeValue=e,e===S?(g.removeClass(this.element,B._ClassName.pivotInputTypeMouse),g.addClass(this.element,B._ClassName.pivotInputTypeTouch),this._hideNavButtons()):(g.removeClass(this.element,B._ClassName.pivotInputTypeTouch),g.addClass(this.element,B._ClassName.pivotInputTypeMouse)))}},_rtl:{get:function(){return this._cachedRTL}},_viewportWidth:{get:function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(e.getComputedStyle(this._viewportElement).width),T&&(this._viewportElement.style[i._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||B._invalidViewportWidth},set:function(e){this._viewportElWidth=e}},_applyProperties:function(){if(!this._disposed){if(this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;){var t=this.element.firstElementChild;t.parentNode.removeChild(t)}g.empty(this._surfaceElement)}this._attachItems();var i=this._pendingIndexOnScreen;this._pendingIndexOnScreen=null,this._currentIndexOnScreen=0,this._firstLoad=!0,this._cachedRTL="rtl"===e.getComputedStyle(this._element,null).direction;var n=this;A.done(function(){M.common.refreshHeadersState(n,!0),T||g.addClass(n.element,B._ClassName.pivotNoSnap),n._pendingRefresh=!1,n.selectedIndex=Math.min(i,n.items.length-1),n._firstLoad=!1,n._recenterUI()})}},_attachItems:function(){this._measured=!1;for(var e=0,t=this.items.length;t>e;e++){var i=this._items.getAt(e);if(i.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Pivot.DuplicateItem",L.duplicateItem);i.element.style.visibility="hidden",i.element.style.opacity=0,this._surfaceElement.appendChild(i.element)}},_parse:function(){for(var e=[],t=this.element.firstElementChild;t!==this._titleElement;){d.processAll(t);var i=t.winControl;if(!i)throw new n("WinJS.UI.Pivot.InvalidContent",L.invalidContent);e.push(i);var r=t.nextElementSibling;t=r}this.items=new u.List(e)},_refresh:function(){this._pendingRefresh||(this._pendingRefresh=!0,_.schedule(this._applyProperties.bind(this),_.Priority.high))},_resizeHandler:function(){if(!this._disposed&&!this._pendingRefresh){var e=this._viewportWidth;this._viewportWidth=null,e!==this._viewportWidth?(s.log&&s.log("_resizeHandler from:"+e+" to: "+this._viewportWidth),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterUI(),this._headersState.handleResize()):s.log&&s.log("_resizeHandler worthless resize")}},_activateHeader:function(e){if(!this.locked){var t=this._items.indexOf(e._item);t!==this.selectedIndex?this._headersState.activateHeader(e):g._setActiveFirstFocusableElement(this.selectedItem.element)}},_goNext:function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},_goPrevious:function(){this._animateToPrevious=!0,this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1,this._animateToPrevious=!1},_loadItem:function(t){var i=this._animateToPrevious;this._cachedRTL="rtl"===e.getComputedStyle(this._element,null).direction,this._loadId++;var n=this._loadId;this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._currentItem&&this._hidePivotItem(this._currentItem.element,i);var r=this._currentIndexOnScreen;if(this._currentIndexOnScreen=t,this._headersState.handleNavigation(i,t,r),!(0>t)){var o=this._items.getAt(t);this._currentItem=o,i?this._offsetFromCenter--:t!==r&&this._offsetFromCenter++;var a=!1;T&&g._supportsZoomTo&&this._currentManipulationState!==P.MS_MANIPULATION_STATE_INERTIA&&(this._firstLoad?(s.log&&s.log("_firstLoad index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),g.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation})):(s.log&&s.log("zoomTo index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation,"winjs pivot","log"),this._viewportElement.msZoomTo({contentX:this._currentScrollTargetLocation,contentY:0,viewportX:0,viewportY:0}),a=0!==this._offsetFromCenter&&this.items.length>1));var l=this,c={index:t,direction:i?"backwards":"forward",item:o};this._writeProfilerMark("selectionChanged,info"),this._fireEvent(B._EventName.selectionChanged,!0,!1,c),o._process().then(function(){if(!l._disposed&&n===l._loadId){T?(o.element.style[l._getDirectionAccessor()]=l._currentScrollTargetLocation+"px",l._showPivotItem(o.element,i)):l._hidePivotItemAnimation?l._showPivotItemAnimation=l._hidePivotItemAnimation.then(function(){return l._disposed||n!==l._loadId?void 0:l._showPivotItem(o.element,i)}):l._showPivotItem(o.element,i);var e;a?(l._stoppedAndRecenteredSignal||(l._stoppedAndRecenteredSignal=new m),e=l._stoppedAndRecenteredSignal.promise):e=h.wrap(),h.join([l._slideHeadersAnimation,l._showPivotItemAnimation,l._hidePivotItemAnimation]).then(function(){e.then(function(){h.timeout(50).then(function(){l._disposed||n!==l._loadId||(l._navMode=B._NavigationModes.none,l._writeProfilerMark("itemAnimationStop,info"),l._fireEvent(B._EventName.itemAnimationEnd,!0))})})})}})}},_MSManipulationStateChangedHandler:function(e){if(this._currentManipulationState=e.currentState,T&&e.target===this._viewportElement)if(this._currentManipulationState===P.MS_MANIPULATION_STATE_STOPPED?s.log&&s.log("MSManipulation: Stopped","winjs pivot","log"):this._currentManipulationState===P.MS_MANIPULATION_STATE_INERTIA?s.log&&s.log("MSManipulation: Inertia","winjs pivot","log"):s.log&&s.log("MSManipulation: Active","winjs pivot","log"),this._stoppedAndRecenteredSignal||(this._stoppedAndRecenteredSignal=new m),this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel(),this._currentManipulationState===P.MS_MANIPULATION_STATE_STOPPED){this._navMode===B._NavigationModes.scroll&&this._scrollHandler(),this._navMode=B._NavigationModes.none;var t=this;this._manipulationRecenterPromise=h._cancelBlocker(h.join([_.schedulePromiseNormal(null,"WinJS.UI.Pivot._MSManipulationStateChangedHandler_animationPlaceholder"),this._hidePivotItemAnimation,this._showPivotItemAnimation,this._slideHeadersAnimation])).then(function(){t._disposed||(t._currentManipulationState===P.MS_MANIPULATION_STATE_STOPPED?(s.log&&s.log("Still in Stopped state: calling _recenterUI","winjs pivot","log"),t._recenterUI()):(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null))
})}else if(this._currentManipulationState===P.MS_MANIPULATION_STATE_INERTIA){var i=e.inertiaDestinationX;if(+i===i){s.log&&s.log("MSManipulation: inertiaDestinationX: "+i);var n=i-this._currentScrollTargetLocation;n>0?(s.log&&s.log("MSManipulation: Inertia diff > 1","winjs pivot","log"),this._navMode=B._NavigationModes.inertia,this._goNext()):0>n&&(s.log&&s.log("MSManipulation: Stopped diff < -1","winjs pivot","log"),this._navMode=B._NavigationModes.inertia,this._goPrevious())}}},_scrollHandler:function(){if(T&&!this._disposed){if(this._recentering&&this._stoppedAndRecenteredSignal)return this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null,void(this._recentering=!1);if((this._navMode===B._NavigationModes.none||this._navMode===B._NavigationModes.scroll)&&(this._navMode=B._NavigationModes.scroll,this._currentManipulationState===P.MS_MANIPULATION_STATE_STOPPED)){s.log&&s.log("_scrollHandler ScrollPosition: "+g.getScrollPosition(this._viewportElement).scrollLeft,"winjs pivot","log");var t=g.getScrollPosition(this._viewportElement).scrollLeft-this._currentScrollTargetLocation;this._cachedRTL="rtl"===e.getComputedStyle(this._element,null).direction,t>0?(s.log&&s.log("_scrollHandler diff > 1: "+t,"winjs pivot","log"),this._goNext()):0>t&&(s.log&&s.log("_scrollHandler diff < -1: "+t,"winjs pivot","log"),this._goPrevious())}}},_recenterUI:function(){T&&(this._offsetFromCenter=0,g.getScrollPosition(this._viewportElement).scrollLeft!==this._currentScrollTargetLocation?(this._recentering=!0,this._stoppedAndRecenteredSignal=this._stoppedAndRecenteredSignal||new m):this._stoppedAndRecenteredSignal&&(this._stoppedAndRecenteredSignal.complete(),this._stoppedAndRecenteredSignal=null),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._currentScrollTargetLocation+"px"),s.log&&s.log("_recenterUI index:"+this.selectedIndex+" offset: "+this._offsetFromCenter+" scrollLeft: "+this._currentScrollTargetLocation),g.setScrollPosition(this._viewportElement,{scrollLeft:this._currentScrollTargetLocation}))},_hidePivotItem:function(e,t){function i(){n._disposed||(n._hidePivotItemAnimation=null,e.style.visibility="hidden",e.style.opacity=0)}var n=this,r=this._rtl&&!t||t&&!this._rtl;this._hidePivotItemAnimation=c.isAnimationEnabled()?l[r?"slideRightOut":"slideLeftOut"](e):_.schedulePromiseNormal(null,"WinJS.UI.Pivot._hidePivotItem_animationPlaceholder"),this._hidePivotItemAnimation.then(i,i)},_showPivotItem:function(e,t){function i(e){var t=e.getBoundingClientRect();return t.top<a.bottom&&t.bottom>a.top}function n(){d._disposed||(d._showPivotItemAnimation=null)}if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(B._EventName.itemAnimationStart,!0),!c.isAnimationEnabled())return e.style.visibility="",e.style.opacity="",void(this._showPivotItemAnimation=null);var r=e.querySelectorAll(".win-pivot-slide1"),s=e.querySelectorAll(".win-pivot-slide2"),o=e.querySelectorAll(".win-pivot-slide3"),a=this._viewportElement.getBoundingClientRect();r=Array.prototype.filter.call(r,i),s=Array.prototype.filter.call(s,i),o=Array.prototype.filter.call(o,i);var u=this._rtl&&!t||t&&!this._rtl;e.style.visibility="",this._showPivotItemAnimation=l[u?"slideRightIn":"slideLeftIn"](e,r,s,o);var d=this;return this._showPivotItemAnimation.then(n,n),this._showPivotItemAnimation},_elementClickedHandler:function(e){if(this.locked||this._navigationHandled)return void(this._navigationHandled=!1);var t,i=e.target;if(g.hasClass(i,B._ClassName.pivotHeader))t=i;else{var n=!1,r=g._elementsFromPoint(e.clientX,e.clientY);if(r&&r[0]===this._viewportElement)for(var s=0,o=r.length;o>s;s++)r[s]===i&&(n=!0),g.hasClass(r[s],B._ClassName.pivotHeader)&&(t=r[s]);n||(t=null)}t&&this._activateHeader(t)},_headersKeyDown:function(e){this.locked||(e.keyCode===E.leftArrow||e.keyCode===E.pageUp?this._rtl?this._goNext():this._goPrevious():(e.keyCode===E.rightArrow||e.keyCode===E.pageDown)&&(this._rtl?this._goPrevious():this._goNext()))},_elementPointerDownHandler:function(e){T||(e.preventDefault(),this._elementPointerDownPoint={x:e.clientX,y:e.clientY,type:e.pointerType||"mouse",time:Date.now(),inHeaders:this._headersContainerElement.contains(e.target)})},_elementPointerUpHandler:function(e){if(!this._elementPointerDownPoint||this.locked)return void(this._elementPointerDownPoint=null);var t=32,i=.4,n=Math.abs(e.clientY-this._elementPointerDownPoint.y),r=e.clientX-this._elementPointerDownPoint.x,s=Math.abs(r*i),o=s>n&&Math.abs(r)>t&&(!g._supportsTouchDetection||this._elementPointerDownPoint.type===e.pointerType&&e.pointerType===S)&&(!this.element.classList.contains(C._ClassName.pivotDisableContentSwipeNavigation)||this._elementPointerDownPoint.inHeaders&&this._headersContainerElement.contains(e.target));if(this._navigationHandled=!1,o){var a=Date.now()-this._elementPointerDownPoint.time;r*=Math.max(1,Math.pow(350/a,2)),r=this._rtl?-r:r;var l=this._viewportWidth/4;-l>r?(this._goNext(),this._navigationHandled=!0):r>l&&(this._goPrevious(),this._navigationHandled=!0)}if(!this._navigationHandled){for(var c=e.target;null!==c&&!g.hasClass(c,B._ClassName.pivotHeader);)c=c.parentElement;null!==c&&(this._activateHeader(c),this._navigationHandled=!0)}this._elementPointerDownPoint=null},_hideNavButtons:function(e){e&&this._headersContainerElement.contains(e.relatedTarget)||g.removeClass(this._headersContainerElement,B._ClassName.pivotShowNavButtons)},_pointerDownHandler:function(){s.log&&s.log("_pointerDown","winjs pivot","log"),this._manipulationRecenterPromise&&this._manipulationRecenterPromise.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel()},_showNavButtons:function(e){this.locked||e&&e.pointerType===S||g.addClass(this._headersContainerElement,B._ClassName.pivotShowNavButtons)},_handleItemChanged:function(e){if(!this._pendingItems){var t=e.detail.index,i=e.detail.newValue,r=e.detail.oldValue;if(i.element!==r.element){if(i.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Pivot.DuplicateItem",L.duplicateItem);i.element.style.visibility="hidden",i.element.style.opacity=0,this._surfaceElement.insertBefore(i.element,r.element),this._surfaceElement.removeChild(r.element),t===this._currentIndexOnScreen&&(this.selectedIndex=this._currentIndexOnScreen)}this._headersState.render(),M.common.refreshHeadersState(this,!0)}},_handleItemInserted:function(e){if(!this._pendingItems){var t=e.detail.index,i=e.detail.value;if(i.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Pivot.DuplicateItem",L.duplicateItem);i.element.style.visibility="hidden",i.element.style.opacity=0,t<this.items.length-1?this._surfaceElement.insertBefore(i.element,this.items.getAt(t+1).element):this._surfaceElement.appendChild(i.element),t<=this._currentIndexOnScreen&&this._currentIndexOnScreen++,1===this._items.length&&(this.selectedIndex=0),this._headersState.render(),M.common.refreshHeadersState(this,!0)}},_handleItemMoved:function(e){if(!this._pendingItems){var t=e.detail.oldIndex,i=e.detail.newIndex,n=e.detail.value;i<this.items.length-1?this._surfaceElement.insertBefore(n.element,this.items.getAt(i+1).element):this._surfaceElement.appendChild(n.element),t<this._currentIndexOnScreen&&i>=this._currentIndexOnScreen?this._currentIndexOnScreen--:i>this._currentIndexOnScreen&&t<=this._currentIndexOnScreen?this._currentIndexOnScreen++:t===this._currentIndexOnScreen&&(this.selectedIndex=i),this._headersState.render(),M.common.refreshHeadersState(this,!0)}},_handleItemReload:function(){this.items=this.items},_handleItemRemoved:function(e){if(!this._pendingItems){var t=e.detail.value,i=e.detail.index;this._surfaceElement.removeChild(t.element),i<this._currentIndexOnScreen?this._currentIndexOnScreen--:i===this._currentIndexOnScreen&&(this.selectedIndex=Math.min(this.items.length-1,this._currentIndexOnScreen)),this._headersState.render(),M.common.refreshHeadersState(this,!0)}},_fireEvent:function(t,i,n,r){var s=e.document.createEvent("CustomEvent");return s.initCustomEvent(t,!!i,!!n,r),this.element.dispatchEvent(s)},_getDirectionAccessor:function(){return this._rtl?"right":"left"},_updateEvents:function(e,t){e&&(e.removeEventListener("itemchanged",this._handleItemChangedBound),e.removeEventListener("iteminserted",this._handleItemInsertedBound),e.removeEventListener("itemmoved",this._handleItemMovedBound),e.removeEventListener("itemremoved",this._handleItemRemovedBound),e.removeEventListener("reload",this._handleItemReloadBound)),t&&(t.addEventListener("itemchanged",this._handleItemChangedBound),t.addEventListener("iteminserted",this._handleItemInsertedBound),t.addEventListener("itemmoved",this._handleItemMovedBound),t.addEventListener("itemremoved",this._handleItemRemovedBound),t.addEventListener("reload",this._handleItemReloadBound))},_updatePointerType:function(e){this._pointerType=e.pointerType||I},_writeProfilerMark:function(e){var t="WinJS.UI.Pivot:"+this._id+":"+e;a(t),s.log&&s.log(t,null,"pivotprofiler")}},{_invalidViewportWidth:-1,_headerSlideAnimationDuration:250,_ClassName:C._ClassName,_EventName:{selectionChanged:k.selectionChanged,itemAnimationStart:k.itemAnimationStart,itemAnimationEnd:k.itemAnimationEnd},_NavigationModes:{api:"api",inertia:"inertia",none:"",scroll:"scroll"}});t.Class.mix(B,p.DOMEventMixin);var L={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateItem(){return o._getWinJSString("ui/duplicateItem").value},get invalidContent(){return"Invalid content: Pivot content must be made up of PivotItems."},get pivotAriaLabel(){return o._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return o._getWinJSString("ui/pivotViewportAriaLabel").value}};return B})})}),define("WinJS/Controls/Hub/_Section",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior"],function(e,t,i,n,r,s,o,a,l,c,u,d){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{HubSection:i.Namespace._lazy(function(){var e={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},s=i.Class.define(function(i,n){if(i=i||t.document.createElement("DIV"),n=n||{},i.winControl)throw new r("WinJS.UI.HubSection.DuplicateConstruction",e.duplicateConstruction);i.winControl=this,this._element=i,u.addClass(this.element,s._ClassName.hubSection),u.addClass(this.element,"win-disposable"),this._headerElement=t.document.createElement("DIV"),this._headerElement.className=s._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+s._ClassName.hubSectionInteractive+" "+s._ClassName.hubSectionHeaderTabStop+'"><div class="'+s._ClassName.hubSectionHeaderWrapper+'" tabindex="-1"><h2 class="'+s._ClassName.hubSectionHeaderContent+" "+s._Constants.ellipsisTypeClassName+" "+s._Constants.xLargeTypeClassName+'"></h2><span class="'+s._ClassName.hubSectionHeaderChevron+" "+s._Constants.ellipsisTypeClassName+" "+s._Constants.xLargeTypeClassName+'"></span></div></button>',this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,i.appendChild(this._headerElement),this._winKeyboard=new d._WinKeyboard(this._headerElement),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=s._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",i.appendChild(this._contentElement);for(var a=this.element.firstChild;a!==this._headerElement;){var c=a.nextSibling;this._contentElement.appendChild(a),a=c}this._processors=[o.processAll],l.setOptions(this,n)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(e){this._isHeaderStatic=e,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),u.removeClass(this._headerTabStopElement,s._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),u.addClass(this._headerTabStopElement,s._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(e){this._header=e,this._renderHeader()}},_setHeaderTemplate:function(e){this._template=u._syncRenderer(e),this._renderHeader()},_renderHeader:function(){this._template&&(c._disposeElement(this._headerContentElement),u.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var e=this;return this._processed=(this._processors||[]).reduce(function(t,i){return t.then(function(){return i(e.contentElement)})},this._processed||a.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,c._disposeElement(this._headerContentElement),c.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},_Constants:{ellipsisTypeClassName:"win-type-ellipsis",xLargeTypeClassName:"win-type-x-large"},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){t!==o.processAll&&(e._processors=e._processors||[],e._processors.push(t),e._processed&&e._process())})});return s})})}),define("WinJS/Controls/Hub",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_UI","./Hub/_Section","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y){"use strict";t.Namespace.define("WinJS.UI",{Hub:t.Namespace._lazy(function(){function g(t){var i=e.document.createTextNode("object"==typeof t.header?JSON.stringify(t.header):""+t.header);return i}var b=f.Key,C=r._createEventProperty,w={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},I=500,S={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},E={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},x={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},k=t.Class.define(function(t,i){if(t=t||e.document.createElement("DIV"),i=i||{},t.winControl)throw new n("WinJS.UI.Hub.DuplicateConstruction",T.duplicateConstruction);this._id=t.id||f._uniqueID(t),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),e.addEventListener("keydown",this._windowKeyDownHandlerBound),t.winControl=this,this._element=t,f.addClass(this.element,k._ClassName.hub),f.addClass(this.element,"win-disposable"),this._viewportElement=e.document.createElement("DIV"),this._viewportElement.className=k._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",T.hubViewportAriaLabel),this._surfaceElement=e.document.createElement("DIV"),this._surfaceElement.className=k._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,i.orientation||(this._orientation=v.Orientation.horizontal,f.addClass(this.element,k._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new h.wrap,this._currentIndexForSezo=0,this._parse(),p.setOptions(this,i),f._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this._resizeHandlerBound=this._resizeHandler.bind(this),this.element.addEventListener("mselementresize",this._resizeHandlerBound),f._resizeNotifier.subscribe(this.element,this._resizeHandlerBound),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this)),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(e){if(e!==this._orientation){if(this._measured=!1,this._names){var t={};t[this._names.scrollPos]=0,f.setScrollPosition(this._viewportElement,t)}e===v.Orientation.vertical?(f.removeClass(this.element,k._ClassName.hubHorizontal),f.addClass(this.element,k._ClassName.hubVertical)):(e=v.Orientation.horizontal,f.removeClass(this.element,k._ClassName.hubVertical),f.addClass(this.element,k._ClassName.hubHorizontal)),this._orientation=e,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)}}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(e){var t=!this._pendingSections;this._pendingSections=e,this._refresh(),t&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=g),this._headerTemplate)},set:function(e){this._pendingHeaderTemplate=e||g,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(e){if(e=Math.max(0,e),this._pendingRefresh)this._pendingScrollLocation=e,this._pendingSectionOnScreen=null;else{this._measure();var t=Math.max(0,Math.min(this._scrollLength-this._viewportSize,e));this._scrollPosition=t;var i={};i[this._names.scrollPos]=t,f.setScrollPosition(this._viewportElement,i)}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var e=0;e<this._sectionSizes.length;e++){var t=this._sectionSizes[e];if(t.offset+t.size-t.borderEnd-t.paddingEnd>this._scrollPosition+this._startSpacer+t.borderStart+t.paddingStart)return e}return-1},set:function(e){e=Math.max(0,e),this._pendingRefresh?(this._pendingSectionOnScreen=e,this._pendingScrollLocation=null):(this._measure(),e>=0&&e<this._sectionSizes.length&&this._scrollToSection(e))}},indexOfFirstVisible:{get:function(){this._measure();for(var e=0;e<this._sectionSizes.length;e++){var t=this._sectionSizes[e];if(t.offset+t.size-t.borderEnd-t.paddingEnd>this._scrollPosition)return e}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var e=this._sectionSizes.length-1;e>=0;e--){var t=this._sectionSizes[e];if(t.offset+t.paddingStart+t.borderStart<this._scrollPosition+this._viewportSize)return e}return-1}},onheaderinvoked:C(w.headerInvoked),onloadingstatechanged:C(w.loadingStateChanged),oncontentanimating:C(w.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(k.LoadingState.loading),this._pendingRefresh=!0,m.schedule(this._refreshImpl.bind(this),m.Priority.high))},_refreshImpl:function(){if(!this._disposed){var e=h.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,c.isAnimationEnabled()))){var t=this._fireEvent(k._EventName.contentAnimating,{type:k.AnimationType.contentTransition});t&&(this._viewportElement.style["-ms-overflow-style"]="none",e=l.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=t}e.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var e=!1;if(this._pendingSections){for(e=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;){var t=this.element.firstElementChild;t.parentNode.removeChild(t)}f.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),e&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:this.scrollPosition=+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(k.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(e){if(!this._pendingSections){var t=e.detail.newValue,i=e.detail.oldValue;if(t._setHeaderTemplate(this.headerTemplate),t.element!==i.element){if(t.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);this._surfaceElement.insertBefore(t.element,i.element),this._surfaceElement.removeChild(i.element),this._measured=!1,this._setState(k.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(e){if(!this._pendingSections){var t=e.detail.index,i=e.detail.value;i._animation&&i._animation.cancel();var r,s=this._fireEvent(k._EventName.contentAnimating,{type:k.AnimationType.insert,index:t,section:i});if(s){for(var o=[],a=t+1;a<this.sections.length;a++)o.push(this.sections.getAt(a).element);r=new l._createUpdateListAnimation([i.element],[],o)}if(i.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);if(i._setHeaderTemplate(this.headerTemplate),t<this.sections.length-1?this._surfaceElement.insertBefore(i.element,this.sections.getAt(t+1).element):this._surfaceElement.appendChild(i.element),this._measured=!1,r){var c=r.execute();this.runningAnimations=h.join([this.runningAnimations,c])}this._setState(k.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(e){if(!this._pendingSections){var t=e.detail.newIndex,i=e.detail.value;t<this.sections.length-1?this._surfaceElement.insertBefore(i.element,this.sections.getAt(t+1).element):this._surfaceElement.appendChild(i.element),this._measured=!1,this._setState(k.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(e){if(!this._pendingSections){var t=e.detail.value,i=e.detail.index,n=h.wrap(),r=this._fireEvent(k._EventName.contentAnimating,{type:k.AnimationType.remove,index:i,section:t});if(r){for(var s=[],o=i;o<this.sections.length;o++)s.push(this.sections.getAt(o).element);var a=new l._createUpdateListAnimation([],[t.element],s);this._measure();var c=t.element.offsetTop,u=t.element.offsetLeft;t.element.style.position="absolute",t.element.style.top=c,t.element.style.left=u,t.element.style.opacity=0,this._measured=!1,n=a.execute().then(function(){t.element.style.position="",t.element.style.top="",t.element.style.left="",t.element.style.opacity=1}.bind(this))}n.done(function(){this._disposed||(this._surfaceElement.removeChild(t.element),this._measured=!1)}.bind(this)),t._animation=n,this.runningAnimations=h.join([this.runningAnimations,n]),this._setState(k.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(e,t){e&&(e.removeEventListener("itemchanged",this._handleSectionChangedBind),e.removeEventListener("iteminserted",this._handleSectionInsertedBind),e.removeEventListener("itemmoved",this._handleSectionMovedBind),e.removeEventListener("itemremoved",this._handleSectionRemovedBind),e.removeEventListener("reload",this._handleSectionReloadBind)),t&&(t.addEventListener("itemchanged",this._handleSectionChangedBind),t.addEventListener("iteminserted",this._handleSectionInsertedBind),t.addEventListener("itemmoved",this._handleSectionMovedBind),t.addEventListener("itemremoved",this._handleSectionRemovedBind),t.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var e=0;e<this.sections.length;e++){var t=this._sections.getAt(e);if(t._animation&&t._animation.cancel(),t.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);this._surfaceElement.appendChild(t.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var e=0;e<this.sections.length;e++){var t=this._sections.getAt(e);t._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(e){var t=this._sections.getAt(e);return t._process().then(function(){var e=t.contentElement.style;""!==e.visibility&&(e.visibility="")})},_loadSections:function(){function t(e){e.then(function(){m.schedule(i,m.Priority.idle)})}function i(){if(n===r._loadId&&!r._disposed)if(o.length){var e=o.shift(),i=r._loadSection(e);t(i)}else u.complete()}this._loadId++;var n=this._loadId,r=this,s=h.wrap(),o=[],a=h.wrap();if(this._showProgressPromise||(this._showProgressPromise=h.timeout(I).then(function(){this._disposed||(this._progressBar||(this._progressBar=e.document.createElement("progress"),f.addClass(this._progressBar,k._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var u=new _;a=u.promise;for(var d=[],p=Math.max(0,this.indexOfFirstVisible),g=Math.max(0,this.indexOfLastVisible),v=p;g>=v;v++)d.push(this._loadSection(v));for(p--,g++;p>=0||g<this.sections.length;)g<this.sections.length&&(o.push(g),g++),p>=0&&(o.push(p),p--);var y=h.join(d);y.done(function(){n!==this._loadId||r._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),m.schedule(function(){if(n===this._loadId&&!r._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&c.isAnimationEnabled()){var t={type:k.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(k._EventName.contentAnimating,t))&&(this._viewportElement.style["-ms-overflow-style"]="none",s=l.enterContent(this._viewportElement,[{left:this._fireEntrance?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"}).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this)))}this._element===e.document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},m.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),t(y)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);h.join([this.runningAnimations,s,a]).done(function(){n!==this._loadId||r._disposed||(this.runningAnimations=h.wrap(),this._setState(k.LoadingState.complete),m.schedule(this._updateSnapList.bind(this),m.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(t){if(t!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+t+",info"),this._loadingState=t;var i=e.document.createEvent("CustomEvent");i.initCustomEvent(k._EventName.loadingStateChanged,!0,!1,{loadingState:t}),this._element.dispatchEvent(i)}},_parse:function(){for(var e=[],t=this.element.firstElementChild;t!==this._viewportElement;){d.processAll(t);var i=t.winControl;if(!i)throw new n("WinJS.UI.Hub.InvalidContent",T.invalidContent);e.push(i);var r=t.nextElementSibling;t=r}this.sections=new u.List(e)},_fireEvent:function(t,i){var n=e.document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!0,i),this.element.dispatchEvent(n)},_findHeaderTabStop:function(e){if(e.parentNode&&f._matchesSelector(e,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!f.hasClass(e,"win-hub-section-header-tabstop");)e=e.parentElement;return e}return null},_isHeaderInteractive:function(e){return e.parentNode?f._matchesSelector(e,".win-interactive, .win-interactive *"):!1},_clickHandler:function(e){var t=this._findHeaderTabStop(e.target);if(t&&!this._isHeaderInteractive(e.target)){var i=t.parentElement.parentElement.winControl;if(!i.isHeaderStatic){var n=this.sections.indexOf(i);this._fireEvent(k._EventName.headerInvoked,{index:n,section:i})}}},_resizeHandler:function(){this._measured=!1,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)},_contentResizeHandler:function(){this._measured=!1,m.schedule(this._updateSnapList.bind(this),m.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=i._requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==k.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===e.getComputedStyle(this._element,null).direction,this._names=this.orientation===v.Orientation.vertical?S:this._rtl?E:x,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=f.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var t=e.getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(t[this._names.marginStart])+parseFloat(t[this._names.borderStart])+parseFloat(t[this._names.paddingStart]),this._endSpacer=parseFloat(t[this._names.marginEnd])+parseFloat(t[this._names.borderEnd])+parseFloat(t[this._names.paddingEnd]),this._sectionSizes=[];for(var i=0;i<this.sections.length;i++){var n=this.sections.getAt(i),r=e.getComputedStyle(n.element);this._sectionSizes[i]={offset:n.element[this._names.offsetPos],size:n.element[this._names.offsetSize],marginStart:parseFloat(r[this._names.marginStart]),marginEnd:parseFloat(r[this._names.marginEnd]),borderStart:parseFloat(r[this._names.borderStart]),borderEnd:parseFloat(r[this._names.borderEnd]),paddingStart:parseFloat(r[this._names.paddingStart]),paddingEnd:parseFloat(r[this._names.paddingEnd])},this._rtl&&this.orientation===v.Orientation.horizontal&&(this._sectionSizes[i].offset=this._viewportSize-(this._sectionSizes[i].offset+this._sectionSizes[i].size))
}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var e="snapList(",t=0;t<this._sectionSizes.length;t++){t>0&&(e+=",");var i=this._sectionSizes[t];e+=i.offset-i.marginStart-this._startSpacer+"px"}e+=")";var n="",r="";this.orientation===v.Orientation.vertical?n=e:r=e,this._lastSnapPointY!==n&&(this._lastSnapPointY=n,this._viewportElement.style["-ms-scroll-snap-points-y"]=n),this._lastSnapPointX!==r&&(this._lastSnapPointX=r,this._viewportElement.style["-ms-scroll-snap-points-x"]=r),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(e,t){this._measure();var i=this._sectionSizes[e],n=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer);this._scrollTo(n,t)},_ensureVisible:function(e,t){this._measure();var i=this._ensureVisibleMath(e,this._scrollPosition);this._scrollTo(i,t)},_ensureVisibleMath:function(e,t){this._measure();var i=this._sectionSizes[e],n=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer),r=Math.max(0,i.offset+i.size+i.marginEnd+this._endSpacer-this._viewportSize+1);return t>n?t=n:r>t&&(t=Math.min(n,r)),t},_scrollTo:function(e,t){if(this._scrollPosition=e,t)this.orientation===v.Orientation.vertical?f._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):f._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var i={};i[this._names.scrollPos]=this._scrollPosition,f.setScrollPosition(this._viewportElement,i)}},_windowKeyDownHandler:function(e){if(e.keyCode===b.tab){this._tabSeenLast=!0;var t=this;i._yieldForEvents(function(){t._tabSeenLast=!1})}},_focusin:function(e){if(this._tabSeenLast){var t=this._findHeaderTabStop(e.target);if(t&&!this._isHeaderInteractive(e.target)){var i=this.sections.indexOf(t.parentElement.parentElement.winControl);i>-1&&this._ensureVisible(i,!0)}}for(var n=e.target;n&&!f.hasClass(n,y.HubSection._ClassName.hubSection);)n=n.parentElement;if(n){var i=this.sections.indexOf(n.winControl);i>-1&&(this._currentIndexForSezo=i)}if(e.target===this.element){var r;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(r=this._sectionToFocus,this._sectionToFocus=null):r=this.sectionOnScreen,this._moveFocusIn(r)}},_moveFocusIn:function(e){if(e>=0){for(var t=e;t<this.sections.length;t++){var i=this.sections.getAt(t),n=f._trySetActive(i._headerTabStopElement,this._viewportElement);if(n)return;if(f._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return}for(var t=e-1;t>=0;t--){var i=this.sections.getAt(t);if(f._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return;var n=f._trySetActive(i._headerTabStopElement,this._viewportElement);if(n)return}}},_keyDownHandler:function(e){var t=this._rtl?b.rightArrow:b.leftArrow,i=this._rtl?b.leftArrow:b.rightArrow;if(e.keyCode===b.upArrow||e.keyCode===b.downArrow||e.keyCode===b.leftArrow||e.keyCode===b.rightArrow||e.keyCode===b.pageUp||e.keyCode===b.pageDown){var n=this._findHeaderTabStop(e.target);if(n&&!this._isHeaderInteractive(e.target)){var r,s=this.sections.indexOf(n.parentElement.parentElement.winControl),o=!1;if(e.keyCode===b.pageDown||this.orientation===v.Orientation.horizontal&&e.keyCode===i||this.orientation===v.Orientation.vertical&&e.keyCode===b.downArrow){for(var a=s+1;a<this.sections.length;a++)if(this._tryFocus(a)){r=a;break}}else if(e.keyCode===b.pageUp||this.orientation===v.Orientation.horizontal&&e.keyCode===t||this.orientation===v.Orientation.vertical&&e.keyCode===b.upArrow)for(var a=s-1;a>=0;a--)if(this._tryFocus(a)){r=a;break}(e.keyCode===b.upArrow||e.keyCode===b.downArrow||e.keyCode===b.leftArrow||e.keyCode===b.rightArrow)&&(o=!0),+r===r&&(o?this._ensureVisible(r,!0):this._scrollToSection(r,!0)),e.preventDefault()}}else if(e.keyCode===b.home||e.keyCode===b.end){this._measure();var l=Math.max(0,this._scrollLength-this._viewportSize);this._scrollTo(e.keyCode===b.home?0:l,!0),e.preventDefault()}},_tryFocus:function(t){var i=this.sections.getAt(t);return f._setActive(i._headerTabStopElement,this._viewportElement),e.document.activeElement===i._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new P(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===v.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(e,t){var i;i=this.orientation===v.Orientation.horizontal?e:t,this._measure(),i+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var n=1;n<this._sectionSizes.length;n++){var r=this._sectionSizes[n];if(r.offset-r.marginStart>i){this._currentIndexForSezo=n-1;break}}},_getCurrentItem:function(){var e;if(this._sectionSizes.length>0){this._measure();var t=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),i=this._sectionSizes[t];e=this.orientation===v.Orientation.horizontal?{left:Math.max(0,i.offset-i.marginStart-this._scrollPosition),top:0,width:i.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,i.offset-i.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:i.size};var n=this.sections.getAt(t);return h.wrap({item:{data:n,index:t,groupIndexHint:t},position:e})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(e,t){if(e.index>=0&&e.index<this._sectionSizes.length){this._measure();var i,n=this._sectionSizes[e.index];i=this.orientation===v.Orientation.horizontal?t.left:t.top,this._sectionToFocus=e.index;var r=n.offset-i,r=this._ensureVisibleMath(e.index,r);this._scrollPosition=r;var s={};s[this._names.scrollPos]=this._scrollPosition,f.setScrollPosition(this._viewportElement,s)}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(e){var t="WinJS.UI.Hub:"+this._id+":"+e;a(t),s.log&&s.log(t,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,e.removeEventListener("keydown",this._windowKeyDownHandlerBound),f._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound),this._updateEvents(this._sections);for(var t=0;t<this.sections.length;t++)this.sections.getAt(t).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:w.contentAnimating,headerInvoked:w.headerInvoked,loadingStateChanged:w.loadingStateChanged}});t.Class.mix(k,p.DOMEventMixin);var P=t.Class.define(function(e){this._hub=e},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(e,t,i,n){this._hub._configureForZoom(e,t,i,n)},setCurrentItem:function(e,t){this._hub._setCurrentItem(e,t)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(e,t){return this._hub._positionItem(e,t)},endZoom:function(e){this._hub._endZoom(e)}}),T={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateSection(){return"Hub duplicate sections: Each HubSection must be unique"},get invalidContent(){return"Invalid content: Hub content must be made up of HubSections."},get hubViewportAriaLabel(){return o._getWinJSString("ui/hubViewportAriaLabel").value}};return k})})}),define("WinJS/Controls/AppBar/_Constants",["exports","../../Core/_Base"],function(e,t){"use strict";t.Namespace._moduleDefine(e,null,{appBarClass:"win-appbar",firstDivClass:"win-firstdiv",finalDivClass:"win-finaldiv",invokeButtonClass:"win-appbar-invokebutton",ellipsisClass:"win-appbar-ellipsis",primaryCommandsClass:"win-primarygroup",secondaryCommandsClass:"win-secondarygroup",commandLayoutClass:"win-commandlayout",menuLayoutClass:"win-menulayout",topClass:"win-top",bottomClass:"win-bottom",showingClass:"win-appbar-showing",shownClass:"win-appbar-shown",hidingClass:"win-appbar-hiding",hiddenClass:"win-appbar-hidden",minimalClass:"win-appbar-minimal",menuContainerClass:"win-appbar-menu",toolbarContainerClass:"win-appbar-toolbarcontainer",appBarPlacementTop:"top",appBarPlacementBottom:"bottom",appBarLayoutCustom:"custom",appBarLayoutCommands:"commands",appBarLayoutMenu:"menu",appBarInvokeButtonWidth:60,typeSeparator:"separator",typeContent:"content",typeButton:"button",typeToggle:"toggle",typeFlyout:"flyout",menuCommandClass:"win-command",appBarCommandClass:"win-command",appBarCommandGlobalClass:"win-global",appBarCommandSelectionClass:"win-selection",sectionSelection:"selection",sectionGlobal:"global",sectionPrimary:"primary",sectionSecondary:"secondary",hideFocusClass:"win-hidefocus",overlayClass:"win-overlay",flyoutClass:"win-flyout",flyoutLightClass:"win-ui-light",menuClass:"win-menu",menuToggleClass:"win-menu-toggle",settingsFlyoutClass:"win-settingsflyout",scrollsClass:"win-scrolls",separatorWidth:60,buttonWidth:100,narrowClass:"win-narrow",wideClass:"win-wide",_clickEatingAppBarClass:"win-appbarclickeater",_clickEatingFlyoutClass:"win-flyoutmenuclickeater",_visualViewportClass:"win-visualviewport-space",commandVisibilityChanged:"commandvisibilitychanged"})}),define("WinJS/Controls/Flyout/_Overlay",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Application","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Constants"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{_Overlay:n.Namespace._lazy(function(){function e(e,i,n){var r=t.document.querySelectorAll("."+f.overlayClass);if(r)for(var s=r.length,o=0;s>o;o++){var a=r[o],l=a.winControl;if(!l._disposed&&l){var c=l[i](e);if(n&&c)return c}}}function g(e){if(!e)return[];"string"!=typeof e&&e&&e.length||(e=[e]);var i,n=[];for(i=0;i<e.length;i++)if(e[i])if("string"==typeof e[i]){var r=t.document.getElementById(e[i]);r&&n.push(r)}else n.push(e[i].element?e[i].element:e[i]);return n}var v=n.Class.define(function(){this._currentState=v.states.off,this._windowBlur=this._windowBlur.bind(this),this._inputPaneShowing=this._inputPaneShowing.bind(this),this._inputPaneHiding=this._inputPaneHiding.bind(this),this._documentScroll=this._documentScroll.bind(this),this._edgyStarting=this._edgyStarting.bind(this),this._edgyCompleted=this._edgyCompleted.bind(this),this._backClicked=this._backClicked.bind(this),this._windowResized=this._windowResized.bind(this)},{initialize:function(){this._toggleListeners(v.states.on)},reset:function(){this._toggleListeners(v.states.off),this._toggleListeners(v.states.on)},_windowBlur:function(){if(t.document.hasFocus()){if(E._clickEatingFlyoutDiv&&"block"===E._clickEatingFlyoutDiv.style.display||E._clickEatingAppBarDiv&&"block"===E._clickEatingAppBarDiv.style.display){var e=t.document.activeElement;e&&"IFRAME"===e.tagName&&!e.msLightDismissBlur&&(e.addEventListener("blur",this._windowBlur,!1),e.msLightDismissBlur=!0)}}else E._lightDismissOverlays(!1)},_inputPaneShowing:function(t){l(v.profilerString+"_showingKeyboard,StartTM"),e(t,"_showingKeyboard"),l(v.profilerString+"_showingKeyboard,StopTM")},_inputPaneHiding:function(t){l(v.profilerString+"_hidingKeyboard,StartTM"),e(t,"_hidingKeyboard"),l(v.profilerString+"_hidingKeyboard,StopTM")},_documentScroll:function(t){l(v.profilerString+"_checkScrollPosition,StartTM"),e(t,"_checkScrollPosition"),l(v.profilerString+"_checkScrollPosition,StopTM")},_edgyStarting:function(){E._lightDismissAllFlyouts()},_edgyCompleted:function(){E._containsRightMouseClick||E._lightDismissAllFlyouts()},_backClicked:function(t){l(v.profilerString+"_backClick,StartTM");var i=e(t,"_backClick",!0);return l(v.profilerString+"_backClick,StopTM"),i},_windowResized:function(t){l(v.profilerString+"_baseResize,StartTM"),e(t,"_baseResize"),l(v.profilerString+"_baseResize,StopTM")},_toggleListeners:function(e){var n;if(this._currentState!==e){if(e===v.states.on?n="addEventListener":e===v.states.off&&(n="removeEventListener"),t[n]("blur",this._windowBlur,!1),i.Windows.UI.Input.EdgeGesture){var r=i.Windows.UI.Input.EdgeGesture.getForCurrentView();r[n]("starting",this._edgyStarting),r[n]("completed",this._edgyCompleted)}if(i.Windows.UI.ViewManagement.InputPane){var s=i.Windows.UI.ViewManagement.InputPane.getForCurrentView();s[n]("showing",this._inputPaneShowing,!1),s[n]("hiding",this._inputPaneHiding,!1),t.document[n]("scroll",this._documentScroll,!1)}u[n]("backclick",this._backClicked,!1),t.addEventListener("resize",this._windowResized,!1),this._currentState=e}}},{profilerString:{get:function(){return"WinJS.UI._Overlay Global Listener:"}},states:{get:function(){return{off:0,on:1}}}}),y=o._createEventProperty,b="beforeshow",C="aftershow",w="beforehide",I="afterhide",S={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get mustContainCommands(){return"Invalid HTML: AppBars/Menus must contain only AppBarCommands/MenuCommands"},get closeOverlay(){return a._getWinJSString("ui/closeOverlay").value}},E=n.Class.define(function(e,t){this._baseOverlayConstructor(e,t)},{_baseOverlayConstructor:function(e,i){E._addMixin(),this._disposed=!1,e||(e=t.document.createElement("div"));var n=e.winControl;if(n)throw new s("WinJS.UI._Overlay.DuplicateConstruction",S.duplicateConstruction);this._element||(this._element=e),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,e.winControl=this,p.addClass(this._element,f.overlayClass),p.addClass(this._element,"win-disposable");var r=this._element.getAttribute("unselectable");(null===r||void 0===r)&&this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=h.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,i&&m.setOptions(this,i),E._globalEventListeners.initialize()},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(e){e=!!e;var t=!!this._element.disabled;t!==e&&(this._element.disabled=e,!this.hidden&&this._element.disabled&&this._hideOrDismiss())}},onbeforeshow:y(b),onaftershow:y(C),onbeforehide:y(w),onafterhide:y(I),dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},show:function(){this._show()},_show:function(){this._baseShow()},hide:function(){this._hide()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext}},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_baseShow:function(){if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)return this._doNext="show",!1;if(this._cachedDocumentSize=this._cachedDocumentSize||E._sizeOfDocument(),"visible"!==this._element.style.visibility){this._element.winAnimating="showing",this._element.style.display="",this._element.style.visibility="hidden",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._sendEvent(E.beforeShow),this._findPosition();var e=this;return this._animationPromise=this._currentAnimateIn().then(function(){e._baseEndShow()},function(){e._baseEndShow()}),!0}return!1},_findPosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="",this._endShow(),"show"===this._doNext&&(this._doNext=""),this._sendEvent(E.afterShow),this._writeProfilerMark("show,StopTM"),_.schedule(this._checkDoNext,_.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_endShow:function(){},_baseHide:function(){if(this._animating||this._needToHandleShowingKeyboard)return this._doNext="hide",!1;if(this._needToHandleHidingKeyboard&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(E.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var e=this;this._animationPromise=this._currentAnimateOut().then(function(){e._baseEndHide()},function(){e._baseEndHide()})}return!0}return!1},_baseEndHide:function(){this._disposed||(this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._sendEvent(E.afterHide),this._writeProfilerMark("hide,StopTM"),_.schedule(this._checkDoNext,_.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",t.getComputedStyle(this._element,null).opacity,c.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,t.getComputedStyle(this._element,null).opacity,c.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(e,i){if(!this._disposed){var n=t.document.createEvent("CustomEvent");n.initEvent(e,!0,!0,i||{}),this._element.dispatchEvent(n)}},_showCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands(i.commands,[],t)},_hideCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands([],i.commands,t)},_showOnlyCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands(i.commands,i.others,t)},_showAndHideCommands:function(e,t,i){i||this.hidden&&!this._animating?(this._showAndHideFast(e,t),this._removeFromQueue(e,this._queuedToShow),this._removeFromQueue(t,this._queuedToHide)):(this._updateAnimateQueue(e,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(t,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(e,t){var i;for(i=0;i<e.length;i++){var n;for(n=0;n<t.length;n++)if(t[n]===e[i]){t.splice(n,1);break}}},_updateAnimateQueue:function(e,t,i){if(!this._disposed){var n;for(n=0;n<e.length;n++){var r;for(r=0;r<t.length&&t[r]!==e[n];r++);for(r===t.length&&(t[r]=e[n]),r=0;r<i.length;r++)if(i[r]===e[n]){i.splice(r,1);break}}this._queuedCommandAnimation||(this._animating||_.schedule(this._checkDoNext,_.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(e,t){var i,n;for(i=0;i<e.length;i++)n=e[i],n&&n.style&&(n.style.visibility="",n.style.display="");for(i=0;i<t.length;i++)n=t[i],n&&n.style&&(n.style.visibility="hidden",n.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),_.schedule(this._checkDoNext,_.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var e,i=this._queuedToShow,n=this._queuedToHide,r=this._findSiblings(i.concat(n));for(e=0;e<i.length;e++)i[e]&&i[e].style&&t.document.body.contains(i[e])?"hidden"!==i[e].style.visibility&&"0"!==i[e].style.opacity&&(r.push(i[e]),i.splice(e,1),e--):(i.splice(e,1),e--);for(e=0;e<n.length;e++)n[e]&&n[e].style&&t.document.body.contains(n[e])&&"hidden"!==n[e].style.visibility&&"0"!==n[e].style.opacity||(n.splice(e,1),e--);var s=this._baseBeginAnimateCommands(i,n,r),o=this;s?s.done(function(){o._baseEndAnimateCommands(n)},function(){o._baseEndAnimateCommands(n)}):_.schedule(function(){o._baseEndAnimateCommands([])},_.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(e,i,n){this._beginAnimateCommands(e,i,this._getVisibleCommands(n));var r=null,s=null;i.length>0&&(s=c.createDeleteFromListAnimation(i,0===e.length?n:void 0)),e.length>0&&(r=c.createAddToListAnimation(e,n));for(var o=0,a=i.length;a>o;o++){var l=i[o].getBoundingClientRect(),u=t.getComputedStyle(i[o]);i[o].style.top=l.top-parseFloat(u.marginTop)+"px",i[o].style.left=l.left-parseFloat(u.marginLeft)+"px",i[o].style.opacity=0,i[o].style.position="fixed"}this._element.winAnimating="rearranging";var d=null;for(s&&(d=s.execute()),o=0;o<e.length;o++)e[o].style.visibility="",e[o].style.display="",e[o].style.opacity=1;if(r){var _=r.execute();d=d?h.join([d,_]):_}return d},_beginAnimateCommands:function(){},_getVisibleCommands:function(e){var t,i=e,n=[];i||(i=this.element.querySelectorAll(".win-command"));for(var r=0,s=i.length;s>r;r++)t=i[r].winControl||i[r],t.hidden||n.push(t);return n},_baseEndAnimateCommands:function(e){if(!this._disposed){var t;for(t=0;t<e.length;t++)e[t].style.position="",e[t].getBoundingClientRect(),e[t].style.visibility="hidden",e[t].style.display="none",e[t].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(e){e=g(e);var t={};t.commands=[],t.others=[];var i,n,r=this.element.querySelectorAll(".win-command");for(i=0;i<r.length;i++){var s=!1;for(n=0;n<e.length;n++)if(e[n]===r[i]){t.commands.push(r[i]),e.splice(n,1),s=!0;break}s||t.others.push(r[i])}return t},_findSiblings:function(e){var t,i,n=[],r=this.element.querySelectorAll(".win-command");for(t=0;t<r.length;t++){var s=!1;for(i=0;i<e.length;i++)if(e[i]===r[t]){e.splice(i,1),s=!0;break}s||n.push(r[t])}return n},_baseResize:function(e){if(this._cachedDocumentSize)if(this.hidden)this._cachedDocumentSize=null;else{var t=E._sizeOfDocument();(this._cachedDocumentSize.width!==t.width||this._cachedDocumentSize.height!==t.height)&&(this._cachedDocumentSize=t,this._sticky||this._hideOrDismiss())}this._resize(e)},_isLightDismissible:function(){return!this._sticky&&!this.hidden},_lightDismiss:function(e){this._isLightDismissible()&&E._lightDismissOverlays(e)},_backClick:function(){return this._element.contains(t.document.activeElement)&&this._isLightDismissible()?(this._lightDismiss(!1),!0):void 0},_hideOrDismiss:function(){var e=this._element;e&&p.hasClass(e,f.settingsFlyoutClass)?this._dismiss():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(e,t){for(var i=e.children,n=new Array(i.length),r=0;r<i.length;r++){if(!p.hasClass(i[r],"win-command")&&i[r].getAttribute("data-win-control")!==t)throw new s("WinJS.UI._Overlay.MustContainCommands",S.mustContainCommands);d.processAll(i[r]),n[r]=i[r].winControl}return n},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||E._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var e=this._element.firstElementChild.tabIndex,i=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var n=p._focusLastFocusableElement(this._element);return n&&E._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=e,this._element.lastElementChild.tabIndex=i,n}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||E._trySetActive(this._element)},_focusOnFirstFocusableElement:function(){if(this._element.firstElementChild){var e=this._element.firstElementChild.tabIndex,i=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var n=p._focusFirstFocusableElement(this._element);return n&&E._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=e,this._element.lastElementChild.tabIndex=i,n}return!1},_handleOverlayEventsForFlyoutOrSettingsFlyout:function(){var e=this;p._addEventListener(this._element,"focusout",function(t){E._hideIfLostFocus(e,t)},!1),p._addEventListener(this._element,"pointerdown",E._checkRightClickDown,!0),p._addEventListener(this._element,"pointerup",E._checkRightClickUp,!0)},_writeProfilerMark:function(e){l("WinJS.UI._Overlay:"+this._id+":"+e)}},{_clickEatingAppBarDiv:!1,_clickEatingFlyoutDiv:!1,_lightDismissFlyouts:function(){E._hideClickEatingDivFlyout();for(var e=t.document.body.querySelectorAll("."+f.flyoutClass),i=e.length,n=0;i>n;n++){var r=e[n];if("hidden"!==r.style.visibility){var s=r.winControl;s&&!s._sticky&&s._hideOrDismiss()}}},_lightDismissSettingsFlyouts:function(){for(var e=t.document.body.querySelectorAll("."+f.settingsFlyoutClass),i=e.length,n=0;i>n;n++){var r=e[n];if("hidden"!==r.style.visibility){var s=r.winControl;s&&!s._sticky&&s._hideOrDismiss()}}},_lightDismissAllFlyouts:function(){E._lightDismissFlyouts(),E._lightDismissSettingsFlyouts()},_lightDismissOverlays:function(e){E._lightDismissAppBars(e),E._lightDismissAllFlyouts()},_lightDismissAppBars:function(e){for(var i=t.document.querySelectorAll("."+f.appBarClass),n=i.length,r=[],s=0;n>s;s++){var o=i[s].winControl;!o||o.sticky||o.hidden||r.push(o)}E._hideAppBars(r,e),E._hideClickEatingDivAppBar()},_createClickEatingDivTemplate:function(e,i){var n=t.document.createElement("section");return n._winHideClickEater=i,p.addClass(n,e),p._addEventListener(n,"pointerup",function(e){E._checkSameClickEatingPointerUp(e,!0)},!0),p._addEventListener(n,"pointerdown",function(e){E._checkClickEatingPointerDown(e,!0)},!0),n.addEventListener("click",function(e){n._winHideClickEater(e)},!0),n.setAttribute("role","menuitem"),n.setAttribute("aria-label",S.closeOverlay),n.setAttribute("unselectable","on"),t.document.body.appendChild(n),n},_createClickEatingDivAppBar:function(){E._clickEatingAppBarDiv||(E._clickEatingAppBarDiv=E._createClickEatingDivTemplate(f._clickEatingAppBarClass,E._handleAppBarClickEatingClick))},_createClickEatingDivFlyout:function(){E._clickEatingFlyoutDiv||(E._clickEatingFlyoutDiv=E._createClickEatingDivTemplate(f._clickEatingFlyoutClass,E._handleFlyoutClickEatingClick))},_checkClickEatingPointerDown:function(e,t){var i=e.currentTarget;if(i)try{i._winPointerId=e.pointerId,i._winRightMouse=2===e.button}catch(n){}t&&!i._winRightMouse&&(e.stopPropagation(),e.preventDefault())},_checkSameClickEatingPointerUp:function(e,t){var i=!1,n=!1,r=e.currentTarget;try{r&&r._winPointerId===e.pointerId&&(i=!0,n=r._winRightMouse,n&&t&&(i=!1))}catch(s){}return t&&!n&&(e.stopPropagation(),e.preventDefault(),r._winHideClickEater(e)),i},_handleAppBarClickEatingClick:function(e){e.stopPropagation(),e.preventDefault(),E._lightDismissOverlays(!1)},_handleFlyoutClickEatingClick:function(e){e.stopPropagation(),e.preventDefault(),E._lightDismissFlyouts()},_checkRightClickDown:function(e){E._checkClickEatingPointerDown(e,!1)},_checkRightClickUp:function(e){E._checkSameClickEatingPointerUp(e,!1)&&(E._containsRightMouseClick=!0,r._yieldForEvents(function(){E._containsRightMouseClick=!1}))},_showClickEatingDivAppBar:function(){_.schedule(function(){E._clickEatingAppBarDiv&&(E._clickEatingAppBarDiv.style.display="block")},_.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivAppBar")},_hideClickEatingDivAppBar:function(){_.schedule(function(){E._clickEatingAppBarDiv&&(E._clickEatingAppBarDiv.style.display="none")},_.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivAppBar")},_showClickEatingDivFlyout:function(){_.schedule(function(){E._clickEatingFlyoutDiv&&(E._clickEatingFlyoutDiv.style.display="block")},_.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivFlyout")},_hideClickEatingDivFlyout:function(){_.schedule(function(){E._clickEatingFlyoutDiv&&(E._clickEatingFlyoutDiv.style.display="none")},_.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivFlyout")},_isFlyoutVisible:function(){return E._clickEatingFlyoutDiv?"block"===E._clickEatingFlyoutDiv.style.display:!1},_hideIfLostFocus:function(e){if(!e.hidden&&"showing"!==e.element.winAnimating&&!e._sticky){var i=t.document.activeElement;if(!e._element||!e._element.contains(i)){if(p.hasClass(e._element,f.settingsFlyoutClass)){var n=e,r=E._getParentControlUsingClassName(i,"win-flyout");if(r&&r._previousFocus&&n.element.contains(r._previousFocus))return void p._addEventListener(r.element,"focusout",function s(e){E._hideIfLostFocus(n,e),p._removeEventListener(r.element,"focusout",s,!1)},!1)}i&&(p.hasClass(i,f._clickEatingFlyoutClass)||p.hasClass(i,f._clickEatingAppBarClass))||e._hideOrDismiss()}}},_trySetActive:function(e){return e&&t.document.body&&t.document.body.contains(e)&&p._setActive(e)?e===t.document.activeElement:!1},_trySelect:function(e){try{e&&e.select&&e.select()}catch(t){}},_addHideFocusClass:function(e){e&&(p.addClass(e,f.hideFocusClass),p._addEventListener(e,"focusout",E._removeHideFocusClass,!1))},_removeHideFocusClass:function(e){var i=e.target;i&&i!==t.document.activeElement&&(p.removeClass(i,f.hideFocusClass),p._removeEventListener(e.target,"focusout",E._removeHideFocusClass,!1))},_sizeOfDocument:function(){return{width:t.document.documentElement.offsetWidth,height:t.document.documentElement.offsetHeight}},_getParentControlUsingClassName:function(e,i){for(;e&&e!==t.document.body;){if(p.hasClass(e,i))return e.winControl;e=e.parentNode}return null},_globalEventListeners:new v,_hideIfAllAppBarsLostFocus:function(){E._isAppBarOrChild(t.document.activeElement)||(E._lightDismissAppBars(!1),E._ElementWithFocusPreviousToAppBar=null)},_hideAppBars:function(e,t){var i=e.map(function(e){return e._keyboardInvoked=t,e.hide(),e._animationPromise});return h.join(i)},_showAppBars:function(e,t){var i=e.map(function(e){return e._keyboardInvoked=t,e._doNotFocus=!1,e._show(),e._animationPromise});return h.join(i)},_isAppBarOrChild:function(e){if(!e)return null;if(p.hasClass(e,f._clickEatingAppBarClass)||p.hasClass(e,f._clickEatingFlyoutClass)||p.hasClass(e,f.firstDivClass)||p.hasClass(e,f.finalDivClass)||p.hasClass(e,f.invokeButtonClass))return e;for(;e&&e!==t.document;){if(p.hasClass(e,f.appBarClass))return e;if(p.hasClass(e,"win-flyout")&&e!==e.winControl._previousFocus){var i=e.winControl,n=E._isAppBarOrChild(i._previousFocus);return n&&p._addEventListener(i.element,"focusout",function r(){E._hideIfAllAppBarsLostFocus(),p._removeEventListener(i.element,"focusout",r,!1)},!1),n}e=e.parentNode}return null},_keyboardInfo:{get _visible(){try{return i.Windows.UI.ViewManagement.InputPane&&i.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(e){return!1}},get _extraOccluded(){var e;if(i.Windows.UI.ViewManagement.InputPane)try{e=i.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height}catch(t){}return e&&!E._keyboardInfo._isResized?e:0},get _isResized(){var e=t.document.documentElement.clientHeight/t.innerHeight,i=t.document.documentElement.clientWidth/t.innerWidth;return.99>i/e},get _visibleDocBottom(){return E._keyboardInfo._visibleDocTop+E._keyboardInfo._visibleDocHeight},get _visibleDocHeight(){return E._keyboardInfo._visualViewportHeight-E._keyboardInfo._extraOccluded},get _animationShowLength(){if(i.Windows.UI.Core.AnimationMetrics){for(var e=i.Windows.UI.Core.AnimationMetrics,t=new e.AnimationDescription(e.AnimationEffect.showPanel,e.AnimationEffectTarget.primary),n=t.animations,r=0,s=0;s<n.size;s++){var o=n[s];
r=Math.max(r,o.delay+o.duration)}return r}return 0}},_ElementWithFocusPreviousToAppBar:null,_clickEatingAppBarClass:f._clickEatingAppBarClass,_clickEatingFlyoutClass:f._clickEatingFlyoutClass,_scrollTimeout:150,beforeShow:b,beforeHide:w,afterShow:C,afterHide:I,commonstrings:{get cannotChangeCommandsWhenVisible(){return"Invalid argument: You must call hide() before changing {0} commands"},get cannotChangeHiddenProperty(){return"Unable to set hidden property while parent {0} is visible."}},_addMixin:function(){if(void 0===E._keyboardInfo._visibleDocTop){var e={_visibleDocTop:function(){return 0},_visibleDocBottomOffset:function(){return E._keyboardInfo._isResized?0:E._keyboardInfo._extraOccluded},_visualViewportHeight:function(){var e=E._keyboardInfo._visualViewportSpace;return e.bottom-e.top},_visualViewportWidth:function(){var e=E._keyboardInfo._visualViewportSpace;return e.right-e.left},_visualViewportSpace:function(){var e=t.document.body.querySelector("."+f._visualViewportClass);return e||(e=t.document.createElement("DIV"),e.className=f._visualViewportClass,t.document.body.appendChild(e)),e.getBoundingClientRect()}},n={_visibleDocTop:function(){return t.window.pageYOffset-t.document.documentElement.scrollTop},_visibleDocBottomOffset:function(){return t.document.documentElement.clientHeight-E._keyboardInfo._visibleDocBottom},_visualViewportHeight:function(){return t.window.innerHeight},_visualViewportWidth:function(){return t.window.innerWidth}},r=t.document.createElement("DIV");r.className=f._visualViewportClass,t.document.body.appendChild(r);var s,o="-ms-device-fixed"===t.getComputedStyle(r).position;!o&&i.Windows.UI.ViewManagement.InputPane?(s=n,t.document.body.removeChild(r)):s=e;for(var a in s)Object.defineProperty(E._keyboardInfo,a,{get:s[a]})}}});return n.Class.mix(E,m.DOMEventMixin),E})})}),define("WinJS/Controls/Flyout",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout/_Overlay","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Flyout:i.Namespace._lazy(function(){function e(e,i){return parseFloat(e,t.getComputedStyle(e,null)[i])}var u=c.Key,_={get ariaLabel(){return s._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return"Invalid argument: Showing flyout requires a DOM element as its parameter."},get badPlacement(){return"Invalid argument: Flyout placement should be 'top' (default), 'bottom', 'left', 'right', 'auto', 'autohorizontal', or 'autovertical'."},get badAlignment(){return"Invalid argument: Flyout alignment should be 'center' (default), 'left', or 'right'."}},m=i.Class.derive(h._Overlay,function(e,i){i=i||{},this._element=e||t.document.createElement("div"),this._id=this._element.id||c._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,i);var n=this._element.getElementsByTagName("*"),r=this._addFirstDiv();r.tabIndex=c._getLowestTabIndexInList(n);var s=this._addFinalDiv();return s.tabIndex=c._getHighestTabIndexInList(n),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(e,t){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(e,t),h._Overlay._createClickEatingDivFlyout(),this._element.style.visibilty="hidden",this._element.style.display="none",c.addClass(this._element,d.flyoutClass),c.addClass(this._element,d.flyoutLightClass);var i=this._element.getAttribute("role");(null===i||""===i||void 0===i)&&(c.hasClass(this._element,d.menuClass)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var n=this._element.getAttribute("aria-label");(null===n||""===n||void 0===n)&&this._element.setAttribute("aria-label",_.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,this._handleOverlayEventsForFlyoutOrSettingsFlyout()},anchor:{get:function(){return this._anchor},set:function(e){this._anchor=e}},placement:{get:function(){return this._placement},set:function(e){if("top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e&&"auto"!==e&&"autohorizontal"!==e&&"autovertical"!==e)throw new r("WinJS.UI.Flyout.BadPlacement",_.badPlacement);this._placement=e}},alignment:{get:function(){return this._alignment},set:function(e){if("right"!==e&&"left"!==e&&"center"!==e)throw new r("WinJS.UI.Flyout.BadAlignment",_.badAlignment);this._alignment=e}},_dispose:function(){l.disposeSubTree(this.element),this._hide(),this.anchor=null},show:function(e,t,i){this._writeProfilerMark("show,StartTM"),this._show(e,t,i)},_show:function(e,t,i){this._baseFlyoutShow(e,t,i)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._keyboardInvoked=!1,this._hide()},_hide:function(){if(this._baseHide()){var e=t.document.activeElement;if(this._previousFocus&&e&&(this._element.contains(e)||c.hasClass(e,h._Overlay._clickEatingFlyoutClass))&&void 0!==this._previousFocus.focus){var i=h._Overlay._isAppBarOrChild(this._previousFocus);if(!i||i.winControl&&!i.winControl.hidden&&!i.winAnimating){var r=this._previousFocus.getAttribute("role"),s=h._Overlay._keyboardInfo._visible&&!this._keyboardWasUp;if(s&&this._previousFocus.setAttribute("role",""),this._keyboardInvoked?this._previousFocus.focus():h._Overlay._trySetActive(this._previousFocus),e=t.document.activeElement,s){var o=this._previousFocus;o&&n._yieldForDomModification(function(){o.setAttribute("role",r)})}}!this._keyboardInvoked&&this._previousFocus===e&&i&&e&&h._Overlay._addHideFocusClass(e)}this._previousFocus=null,this._isThereVisibleFlyout()||h._Overlay._hideClickEatingDivFlyout()}},_baseFlyoutShow:function(e,i,n){if(!this.disabled){if(e||(e=this._anchor),i||(i=this._placement),n||(n=this._alignment),"string"==typeof e?e=t.document.getElementById(e):e&&e.element&&(e=e.element),e)this._currentAnchor=e,this._currentPlacement=i,this._currentAlignment=n;else{if(!this._retryLast)throw new r("WinJS.UI.Flyout.NoAnchor",_.noAnchor);this._retryLast=null}if(this._sticky||h._Overlay._showClickEatingDivFlyout(),this._element.winAnimating)return this._doNext="show",void(this._retryLast=!0);if(this._baseShow()){if(!c.hasClass(this.element,"win-menu")){var s=this._element.getElementsByTagName("*"),o=this.element.querySelectorAll(".win-first");this.element.children.length&&!c.hasClass(this.element.children[0],d.firstDivClass)&&(o&&o.length>0&&o.item(0).parentNode.removeChild(o.item(0)),o=this._addFirstDiv()),o.tabIndex=c._getLowestTabIndexInList(s);var a=this.element.querySelectorAll(".win-final");c.hasClass(this.element.children[this.element.children.length-1],d.finalDivClass)||(a&&a.length>0&&a.item(0).parentNode.removeChild(a.item(0)),a=this._addFinalDiv()),a.tabIndex=c._getHighestTabIndexInList(s)}this._hideAllOtherFlyouts(this),this._previousFocus=t.document.activeElement}}},_endShow:function(){this._keyboardWasUp=h._Overlay._keyboardInfo._visible,c.hasClass(this.element,d.menuClass)?h._Overlay._trySetActive(this._element):(this._focusOnFirstFocusableElementOrThis(),h._Overlay._addHideFocusClass(t.document.activeElement))},_lightDismiss:function(){this._isLightDismissible()&&h._Overlay._lightDismissFlyouts()},_findPosition:function(){this._nextHeight=null,this._keyboardMovedUs=!1,this._hasScrolls=!1,this._keyboardSquishedUs=0,this._checkToggle&&this._checkToggle(),this._updateAdjustments(this._currentAlignment),this._getTopLeft(),this._scrollTop=this._nextTop-h._Overlay._keyboardInfo._visibleDocTop,this._nextTop<0?(this._element.style.bottom="0px",this._element.style.top="auto"):(this._element.style.top=this._nextTop+"px",this._element.style.bottom="auto"),this._nextLeft<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._nextLeft+"px",this._element.style.right="auto"),null!==this._nextHeight&&(c.addClass(this._element,d.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._nextHeight+"px",this._nextBottom=this._nextTop+this._nextHeight,this._hasScrolls=!0),h._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_getTopLeft:function(){var t=this._currentAnchor.getBoundingClientRect(),i={},n={};switch(n.top=t.top,n.bottom=t.bottom,n.left=t.left,n.right=t.right,n.height=n.bottom-n.top,n.width=n.right-n.left,i.marginTop=e(this._element,"marginTop"),i.marginBottom=e(this._element,"marginBottom"),i.marginLeft=e(this._element,"marginLeft"),i.marginRight=e(this._element,"marginRight"),i.width=c.getTotalWidth(this._element),i.height=c.getTotalHeight(this._element),i.innerWidth=c.getContentWidth(this._element),i.innerHeight=c.getContentHeight(this._element),this._nextMarginPadding=i.height-i.innerHeight,this._currentPlacement){case"top":this._fitTop(n,i)||(this._nextTop=h._Overlay._keyboardInfo._visibleDocTop,this._nextHeight=n.top-h._Overlay._keyboardInfo._visibleDocTop-this._nextMarginPadding),this._centerHorizontally(n,i,this._currentAlignment);break;case"bottom":this._fitBottom(n,i)||(this._nextTop=-1,this._nextHeight=h._Overlay._keyboardInfo._visibleDocHeight-(n.bottom-h._Overlay._keyboardInfo._visibleDocTop)-this._nextMarginPadding),this._centerHorizontally(n,i,this._currentAlignment);break;case"left":this._fitLeft(n,i)||(this._nextLeft=0),this._centerVertically(n,i);break;case"right":this._fitRight(n,i)||(this._nextLeft=-1),this._centerVertically(n,i);break;case"autovertical":this._fitTop(n,i)||this._fitBottom(n,i)||this._configureVerticalWithScroll(n),this._centerHorizontally(n,i,this._currentAlignment);break;case"autohorizontal":this._fitLeft(n,i)||this._fitRight(n,i)||(this._nextLeft=-1),this._centerVertically(n,i);break;case"auto":this._sometimesFitsAbove(n,i)?(this._fitTop(n,i)||this._fitBottom(n,i),this._centerHorizontally(n,i,this._currentAlignment)):this._fitLeft(n,i)||this._fitRight(n,i)?this._centerVertically(n,i):(this._configureVerticalWithScroll(n),this._centerHorizontally(n,i,this._currentAlignment));break;default:throw new r("WinJS.UI.Flyout.BadPlacement",_.badPlacement)}this._nextBottom=this._nextTop+i.height},_configureVerticalWithScroll:function(e){this._topHasMoreRoom(e)?(this._nextTop=h._Overlay._keyboardInfo._visibleDocTop,this._nextHeight=e.top-h._Overlay._keyboardInfo._visibleDocTop-this._nextMarginPadding):(this._nextTop=-1,this._nextHeight=h._Overlay._keyboardInfo._visibleDocHeight-(e.bottom-h._Overlay._keyboardInfo._visibleDocTop)-this._nextMarginPadding)},_sometimesFitsAbove:function(e,t){return(h._Overlay._keyboardInfo._visibleDocHeight-e.height)/2>=t.height},_topHasMoreRoom:function(e){return e.top>h._Overlay._keyboardInfo._visibleDocHeight-e.bottom},_fitTop:function(e,t){return this._nextTop=e.top-t.height,this._nextAnimOffset={top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},this._nextTop>=h._Overlay._keyboardInfo._visibleDocTop&&this._nextTop+t.height<=h._Overlay._keyboardInfo._visibleDocBottom},_fitBottom:function(e,t){return this._nextTop=e.bottom,this._nextAnimOffset={top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},this._nextTop>=h._Overlay._keyboardInfo._visibleDocTop&&this._nextTop+t.height<=h._Overlay._keyboardInfo._visibleDocBottom},_fitLeft:function(e,t){return this._nextLeft=e.left-t.width,this._nextAnimOffset={top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},this._nextLeft>=0&&this._nextLeft+t.width<=h._Overlay._keyboardInfo._visualViewportWidth},_fitRight:function(e,t){return this._nextLeft=e.right,this._nextAnimOffset={top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"},this._nextLeft>=0&&this._nextLeft+t.width<=h._Overlay._keyboardInfo._visualViewportWidth},_centerVertically:function(e,t){this._nextTop=e.top+e.height/2-t.height/2,this._nextTop<h._Overlay._keyboardInfo._visibleDocTop?this._nextTop=h._Overlay._keyboardInfo._visibleDocTop:this._nextTop+t.height>=h._Overlay._keyboardInfo._visibleDocBottom&&(this._nextTop=-1)},_centerHorizontally:function(e,i,n){if("center"===n)this._nextLeft=e.left+e.width/2-i.width/2;else if("left"===n)this._nextLeft=e.left;else{if("right"!==n)throw new r("WinJS.UI.Flyout.BadAlignment",_.badAlignment);this._nextLeft=e.right-i.width}this._nextLeft<0?this._nextLeft=0:this._nextLeft+i.width>=t.document.documentElement.clientWidth&&(this._nextLeft=-1)},_updateAdjustments:function(e){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",c.removeClass(this._element,d.scrollsClass),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),"center"===e?(c.removeClass(this._element,"win-leftalign"),c.removeClass(this._element,"win-rightalign")):"left"===e?(c.addClass(this._element,"win-leftalign"),c.removeClass(this._element,"win-rightalign")):"right"===e&&(c.addClass(this._element,"win-rightalign"),c.removeClass(this._element,"win-leftalign"))},_showingKeyboard:function(e){if(!this.hidden&&(e.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var i=this;t.setTimeout(function(){i._adjustForKeyboard(),i._baseAnimateIn()},h._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._needToHandleHidingKeyboard){var e=this;n._setImmediate(function(){e._findPosition()}),this._needToHandleHidingKeyboard=!1}},_checkKeyboardFit:function(){var e=c.getTotalHeight(this._element),t=h._Overlay._keyboardInfo._visibleDocHeight-this._nextMarginPadding;e>t?(this._keyboardMovedUs=!0,this._scrollTop=0,this._keyboardSquishedUs=t):-1===this._nextTop?this._keyboardMovedUs=!0:this._nextTop<h._Overlay._keyboardInfo._visibleDocTop?(this._scrollTop=0,this._keyboardMovedUs=!0):this._nextBottom>h._Overlay._keyboardInfo._visibleDocBottom&&(this._scrollTop=-1,this._keyboardMovedUs=!0)},_adjustForKeyboard:function(){this._keyboardSquishedUs&&(this._hasScrolls||(c.addClass(this._element,d.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._keyboardSquishedUs+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(h._Overlay._keyboardInfo._isResized)this._needToHandleHidingKeyboard=!0;else{var e=this;n._setImmediate(function(){e._findPosition()})}},_checkScrollPosition:function(e){(!this.hidden||e)&&(this._scrollTop<0?(this._element.style.bottom=h._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=h._Overlay._keyboardInfo._visibleDocTop+"px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",a.showPopup(this._element,this._nextAnimOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,a.hidePopup(this._element,this._nextAnimOffset))},_hideAllOtherFlyouts:function(e){for(var i=t.document.querySelectorAll("."+d.flyoutClass),n=0;n<i.length;n++){var r=i[n].winControl;r&&!r.hidden&&r!==e&&r.hide()}},_isThereVisibleFlyout:function(){for(var e=t.document.querySelectorAll("."+d.flyoutClass),i=0;i<e.length;i++){var n=e[i].winControl;if(n&&!n.hidden)return!0}return!1},_handleKeyDown:function(e){e.keyCode===u.escape&&e.keyCode!==u.IME?(e.preventDefault(),e.stopPropagation(),this.winControl._keyboardInvoked=!0,this.winControl._hide()):e.keyCode!==u.space&&e.keyCode!==u.enter||this!==t.document.activeElement?!e.shiftKey||e.keyCode!==u.tab||this!==t.document.activeElement||e.altKey||e.ctrlKey||e.metaKey||(e.preventDefault(),e.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(e.preventDefault(),e.stopPropagation(),this.winControl.hide())},_addFirstDiv:function(){var e=t.document.createElement("div");e.className=d.firstDivClass,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(e,this._element.children[0]):this._element.appendChild(e);var i=this;return c._addEventListener(e,"focusin",function(){i._focusOnLastFocusableElementOrThis()},!1),e},_addFinalDiv:function(){var e=t.document.createElement("div");e.className=d.finalDivClass,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),this._element.appendChild(e);var i=this;return c._addEventListener(e,"focusin",function(){i._focusOnFirstFocusableElementOrThis()},!1),e},_writeProfilerMark:function(e){o("WinJS.UI.Flyout:"+this._id+":"+e)}});return m})})}),define("WinJS/Controls/Toolbar/_Constants",["require","exports"],function(e,t){t.controlCssClass="win-toolbar",t.actionAreaCssClass="win-toolbar-actionarea",t.overflowButtonCssClass="win-toolbar-overflowbutton",t.ellipsisCssClass="win-toolbar-ellipsis",t.overflowAreaCssClass="win-toolbar-overflowarea",t.overflowContentFlyoutCssClass="win-toolbar-contentflyout",t.flyoutMenuCssClass="win-toolbar-flyoutmenu",t.inlineMenuCssClass="win-toolbar-inlinemenu",t.emptyToolbarCssClass="win-toolbar-empty",t.menuCssClass="win-menu",t.menuToggleClass="win-menu-toggle",t.contentMenuCommandDefaultLabel="Custom content",t.typeSeparator="separator",t.typeContent="content",t.typeButton="button",t.typeToggle="toggle",t.typeFlyout="flyout"}),define("WinJS/Controls/AppBar/_Icon",["exports","../../Core/_Base","../../Core/_Resources"],function(e,t,i){"use strict";var n=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview"],r=n.reduce(function(e,t){return e[t]={get:function(){return i._getWinJSString("ui/appBarIcons/"+t).value}},e},{});t.Namespace._moduleDefine(e,"WinJS.UI.AppBarIcon",r)}),define("WinJS/Controls/AppBar/_Command",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../Flyout/_Overlay","../Tooltip","./_Constants","./_Icon"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{AppBarCommand:n.Namespace._lazy(function(){function e(e){var i=this.winControl;if(i){if(i._type===d.typeToggle)i.selected=!i.selected;else if(i._type===d.typeFlyout&&i._flyout){var n=i._flyout;"string"==typeof n&&(n=t.document.getElementById(n)),n.show||(n=n.winControl),n&&n.show&&n.show(this,"autovertical")}i.onclick&&i.onclick(e)}}var _={get ariaLabel(){return s._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badDivElement(){return"Invalid argument: For a content command, the element must be null or a div element"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"},get badPriority(){return"Invalid argument: the priority of an {0} must be a non-negative integer"}};return n.Class.define(function(t,i){if(t&&t.winControl)throw new r("WinJS.UI.AppBarCommand.DuplicateConstruction",_.duplicateConstruction);if(this._disposed=!1,i||(i={}),i.type||(this._type=d.typeButton),i.section=i.section||d.sectionPrimary,this._element=t,i.type===d.typeContent?this._createContent():i.type===d.typeSeparator?this._createSeparator():this._createButton(),l.addClass(this._element,"win-disposable"),this._element.winControl=this,l.addClass(this._element,d.appBarCommandClass),i.onclick&&(this.onclick=i.onclick),i.onclick=e,o.setOptions(this,i),this._type!==d.typeToggle||i.selected||(this.selected=!1),this._type!==d.typeSeparator){var n=this;l._addEventListener(this._element,"pointerdown",function(){c._Overlay._addHideFocusClass(n._element)},!1);var s=this._element.getAttribute("role");(null===s||""===s||void 0===s)&&(s=this._type===d.typeToggle?"menuitemcheckbox":this._type===d.typeContent?"group":"menuitem",this._element.setAttribute("role",s),this._type===d.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var a=this._element.getAttribute("aria-label");(null===a||""===a||void 0===a)&&this._element.setAttribute("aria-label",_.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(e){e&&!this._element.id&&(this._element.id=e)}},type:{get:function(){return this._type},set:function(e){this._type||(this._type=e!==d.typeContent&&e!==d.typeFlyout&&e!==d.typeToggle&&e!==d.typeSeparator?d.typeButton:e)}},label:{get:function(){return this._label},set:function(e){this._label=e,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(e){this._icon=h[e]||e,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none"))}},onclick:{get:function(){return this._onclick},set:function(e){if(e&&"function"!=typeof e)throw new r("WinJS.UI.AppBarCommand.BadClick",s._formatString(_.badClick,"AppBarCommand"));this._onclick=e}},priority:{get:function(){return this._priority},set:function(e){if(!(void 0===e||"number"==typeof e&&e>=0))throw new r("WinJS.UI.AppBarCommand.BadPriority",s._formatString(_.badPriority,"AppBarCommand"));this._priority=e}},flyout:{get:function(){var e=this._flyout;return"string"==typeof e&&(e=t.document.getElementById(e)),e&&!e.element&&e.winControl&&(e=e.winControl),e},set:function(e){var t=e;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=l._uniqueID(t),t=t.id))),"string"==typeof t&&this._element.setAttribute("aria-owns",t),this._flyout=e}},section:{get:function(){return this._section},set:function(e){(!this._section||i.Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(e)}},tooltip:{get:function(){return this._tooltip},set:function(e){this._tooltip=e,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(e){this._element.setAttribute("aria-checked",e)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(e){this._element.disabled=e}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(e){if(e!==this.hidden){var t=this._element.style,i=t.visibility,n=t.display;if(e?(t.visibility="hidden",t.display="none"):(t.visibility="",t.display="inline-block"),!this._sendEvent(d.commandVisibilityChanged))throw t.visibility=i,t.display=n,new r("WinJS.UI.AppBarCommand.CannotChangeHiddenProperty",s._formatString(c._Overlay.commonstrings.cannotChangeHiddenProperty,""))}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(e){this._firstElementFocus=e===this.element?null:e,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(e){this._lastElementFocus=e===this.element?null:e,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===d.typeContent&&a.disposeSubTree(this.element))},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass&&l.removeClass(this._element,this._extraClass),this._extraClass=e,l.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new r("WinJS.UI.AppBarCommand.BadDivElement",_.badDivElement)}else this._element=t.document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new r("WinJS.UI.AppBarCommand.BadHrElement",_.badHrElement)}else this._element=t.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new r("WinJS.UI.AppBarCommand.BadButtonElement",_.badButtonElement);var e=this._element.getAttribute("type");(null===e||""===e||void 0===e)&&this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=t.document.createElement("button");this._element.type="button",this._iconSpan=t.document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon win-commandring",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=t.document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=t.document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new u.Tooltip(this._element);var i=this;this._tooltipControl.addEventListener("beforeopen",function(){i._hideIfFullSize&&!c._Overlay._getParentControlUsingClassName(i._element.parentElement,d.reducedClass)&&i._tooltipControl.close()},!1)},_setSection:function(e){e||(e=d.sectionPrimary),this._section&&(this._section===d.sectionGlobal?l.removeClass(this._element,d.appBarCommandGlobalClass):this.section===d.sectionSelection&&l.removeClass(this._element,d.appBarCommandSelectionClass)),this._section=e,e===d.sectionGlobal?l.addClass(this._element,d.appBarCommandGlobalClass):e===d.sectionSelection&&l.addClass(this._element,d.appBarCommandSelectionClass)},_updateTabStop:function(){this.element.tabIndex=this._firstElementFocus||this._lastElementFocus?-1:0},_isFocusable:function(){return!this.hidden&&this._type!==d.typeSeparator&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)},_sendEvent:function(e,i){if(!this._disposed){var n=t.document.createEvent("CustomEvent");return n.initEvent(e,!0,!0,i||{}),this._element.dispatchEvent(n)}}})})}),n.Namespace._moduleDefine(e,"WinJS.UI",{Command:n.Namespace._lazy(function(){return e.AppBarCommand})})}),define("WinJS/Controls/Menu/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Constants","../Flyout/_Overlay"],function(e,t,i,n,r,s,o,a,l){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{MenuCommand:i.Namespace._lazy(function(){var e={get ariaLabel(){return r._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}};return i.Class.define(function(t,i){if(t&&t.winControl)throw new n("WinJS.UI.MenuCommand.DuplicateConstruction",e.duplicateConstruction);if(this._disposed=!1,i||(i={}),i.type||(this._type=a.typeButton),this._element=t,i.type===a.typeSeparator?this._createSeparator():this._createButton(),o.addClass(this._element,"win-disposable"),this._element.winControl=this,o.addClass(this._element,a.menuCommandClass),i.selected||i.type!==a.typeToggle||(this.selected=!1),i.onclick&&(this.onclick=i.onclick),i.onclick=this._handleMenuClick.bind(this),s.setOptions(this,i),this._type!==a.typeSeparator){var r=this._element.getAttribute("role");(null===r||""===r||void 0===r)&&(r="menuitem",this._type===a.typeToggle&&(r="menuitemcheckbox"),this._element.setAttribute("role",r),this._type===a.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var l=this._element.getAttribute("aria-label");(null===l||""===l||void 0===l)&&this._element.setAttribute("aria-label",e.ariaLabel)}this._handleMouseMoveBound=this._handleMouseMove.bind(this),this._element.addEventListener("mouseover",this._handleMouseOver.bind(this),!1),this._element.addEventListener("mouseout",this._handleMouseOut.bind(this),!1)},{id:{get:function(){return this._element.id},set:function(e){this._element.id||(this._element.id=e)}},type:{get:function(){return this._type},set:function(e){this._type||(this._type=e!==a.typeButton&&e!==a.typeFlyout&&e!==a.typeToggle&&e!==a.typeSeparator?a.typeButton:e)}},label:{get:function(){return this._label},set:function(e){this._label=e||"",this._element.textContent=this.label,this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(t){if(t&&"function"!=typeof t)throw new n("WinJS.UI.MenuCommand.BadClick",r._formatString(e.badClick,"MenuCommand"));this._onclick=t}},flyout:{get:function(){var e=this._flyout;return"string"==typeof e&&(e=t.document.getElementById(e)),e&&!e.element&&(e=e.winControl),e
},set:function(e){var t=e;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=o._uniqueID(t),t=t.id))),"string"==typeof t&&this._element.setAttribute("aria-owns",t),this._flyout=e}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(e){this._element.setAttribute("aria-checked",!!e)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(e){this._element.disabled=!!e}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(e){var t=l._Overlay._getParentControlUsingClassName(this._element,a.menuClass);if(t&&!t.hidden)throw new n("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",r._formatString(l._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var i=this._element.style;e?(i.visibility="hidden",i.display="none"):(i.visibility="",i.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass&&o.removeClass(this._element,this._extraClass),this._extraClass=e,o.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0,this._flyout&&this._flyout.dispose())},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new n("WinJS.UI.MenuCommand.BadHrElement",e.badHrElement)}else this._element=t.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new n("WinJS.UI.MenuCommand.BadButtonElement",e.badButtonElement);this._element.innerHTML=""}else this._element=t.document.createElement("button");this._element.type="button"},_handleMenuClick:function(e){var i=this;if(i){var n=!0;if(i._type===a.typeToggle)i.selected=!i.selected;else if(i._type===a.typeFlyout&&i._flyout){var r=i._flyout;"string"==typeof r&&(r=t.document.getElementById(r)),r.show||(r=r.winControl),r&&r.show&&(i._parentFlyout?(n=!1,r.show(i._parentFlyout._currentAnchor,i._parentFlyout._currentPlacement,i._parentFlyout._currentAlignment)):r.show(this.element))}i.onclick&&i.onclick(e),n&&i._parentFlyout&&i._parentFlyout.hide()}},_handleMouseOver:function(){this&&this.element&&this.element.focus&&(this.element.focus(),this.element.addEventListener("mousemove",this._handleMouseMoveBound,!1))},_handleMouseMove:function(){this&&this.element&&this.element.focus&&this.element!==t.document.activeElement&&this.element.focus()},_handleMouseOut:function(){var e=this._getParentFlyout(this.element);e&&this.element===t.document.activeElement&&o.hasClass(e,a.menuClass)&&e.focus?e.focus():e&&this.element===t.document.activeElement&&e.children&&e.children.length>0&&e.children[0]&&o.hasClass(e.children[0],a.firstDivClass)&&e.children[0].focus&&e.children[0].focus(),this.element.removeEventListener("mousemove",this._handleMouseMoveBound,!1)},_getParentFlyout:function(e){for(;e&&!o.hasClass(e,a.flyoutClass);)e=e.parentElement;return e}})})})}),define("WinJS/Controls/Menu",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout","./Flyout/_Overlay","./Menu/_Command","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Menu:i.Namespace._lazy(function(){var e=a.Key,l={get ariaLabel(){return s._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get nullCommand(){return"Invalid argument: command must not be null"}},_=i.Class.derive(u.Flyout,function(e,i){i=i||{},this._element=e||t.document.createElement("div"),this._id=this._element.id||a._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!i.commands&&this._element&&(i=n._shallowCopy(i),i.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var r=this._element?this._element.getAttribute("role"):null,s=this._element?this._element.getAttribute("aria-label"):null;this._baseFlyoutConstructor(this._element,i),(null===r||""===r||void 0===r)&&this._element.setAttribute("role","menu"),(null===s||""===s||void 0===s)&&this._element.setAttribute("aria-label",l.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown,!0),a.addClass(this._element,c.menuClass),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(e){if(!this.hidden)throw new r("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",s._formatString(d._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));a.empty(this._element),Array.isArray(e)||(e=[e]);for(var t=e.length,i=0;t>i;i++)this._addCommand(e[i])}},getCommandById:function(e){for(var t=this.element.querySelectorAll("#"+e),i=[],n=0,r=t.length;r>n;n++)t[n].winControl&&i.push(t[n].winControl);return 1===i.length?i[0]:0===i.length?null:i},showCommands:function(e){if(!e)throw new r("WinJS.UI.Menu.RequiresCommands",l.requiresCommands);this._showCommands(e,!0)},hideCommands:function(e){if(!e)throw new r("WinJS.UI.Menu.RequiresCommands",l.requiresCommands);this._hideCommands(e,!0)},showOnlyCommands:function(e){if(!e)throw new r("WinJS.UI.Menu.RequiresCommands",l.requiresCommands);this._showOnlyCommands(e,!0)},show:function(e,t,i){this._writeProfilerMark("show,StartTM"),this._show(e,t,i)},_show:function(e,t,i){this._checkForFlyoutCommands(),this._baseFlyoutShow(e,t,i)},_addCommand:function(e){if(!e)throw new r("WinJS.UI.Menu.NullCommand",l.nullCommand);e._element||(e=new h.MenuCommand(null,e)),e._element.parentElement&&e._element.parentElement.removeChild(e._element),this._element.appendChild(e._element)},_checkToggle:function(){var e=this._element.querySelectorAll(".win-command[aria-checked]"),t=!1;if(e)for(var i=0;i<e.length;i++)if(e[i]&&e[i].winControl&&!e[i].winControl.hidden){t=!0;break}t?a.addClass(this._element,c.menuToggleClass):a.removeClass(this._element,c.menuToggleClass)},_checkForFlyoutCommands:function(){for(var e=this._element.querySelectorAll(".win-command"),t=0;t<e.length;t++)e[t].winControl&&(e[t].winControl._parentFlyout=this)},_handleKeyDown:function(i){var n=this;i.keyCode===e.escape?(this.winControl._keyboardInvoked=!0,this.winControl._hide()):i.keyCode!==e.space&&i.keyCode!==e.enter||this!==t.document.activeElement?i.keyCode===e.upArrow?(_._focusOnPreviousElement(n),i.preventDefault()):i.keyCode===e.downArrow?(_._focusOnNextElement(n),i.preventDefault()):i.keyCode===e.tab&&i.preventDefault():(i.preventDefault(),this.winControl.hide())},_writeProfilerMark:function(e){o("WinJS.UI.Menu:"+this._id+":"+e)}});return _._focusOnNextElement=function(e){var i=t.document.activeElement;do i=i===e?i.firstElementChild:i.nextElementSibling,i?i.focus():i=e;while(i!==t.document.activeElement)},_._focusOnPreviousElement=function(e){var i=t.document.activeElement;do i=i===e?i.lastElementChild:i.previousElementSibling,i?i.focus():i=e;while(i!==t.document.activeElement)},_})})});var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};define("WinJS/Controls/Toolbar/_MenuCommand",["require","exports","../Menu/_Command"],function(e,t,i){var n=function(e){function t(t,i,n){n&&n.beforeOnClick&&(this._beforeOnClick=n.beforeOnClick),this._isAttachedMode=t,e.call(this,i,n)}return __extends(t,e),t.prototype._handleMenuClick=function(t){this._beforeOnClick&&this._beforeOnClick(t),e.prototype._handleMenuClick.call(this,t)},t.prototype._handleMouseOver=function(){this._isAttachedMode||e.prototype._handleMouseOver.call(this)},t.prototype._handleMouseOut=function(){this._isAttachedMode||e.prototype._handleMouseOut.call(this)},t}(i.MenuCommand);t._MenuCommand=n}),define("WinJS/Controls/Toolbar",["require","exports","../Animations","../Core/_Base","../Core/_BaseUtils","../BindingList","../ControlProcessor","./Toolbar/_Constants","./AppBar/_Command","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Core/_ErrorFromName","../Controls/Flyout","../Core/_Global","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Controls/Menu","./Menu/_Command","../Core/_Resources","../Scheduler","./Toolbar/_MenuCommand","../Core/_WriteProfilerMark"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y,b,C,w){"use strict";var I={get ariaLabel(){return y._getWinJSString("ui/toolbarAriaLabel").value},get overflowButtonAriaLabel(){return y._getWinJSString("ui/toolbarOverflowButtonAriaLabel").value},get badData(){return"Invalid argument: The data property must an instance of a WinJS.Binding.List"},get mustContainCommands(){return"The toolbar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"}},S=function(){function e(e,t){"undefined"==typeof t&&(t={});var i=this;this._measured=!1,this._initializing=!0,this._hoverable=p.isHoverable,this._dataChangedEvents=["itemchanged","iteminserted","itemmoved","itemremoved","reload"],this._element=e||m.document.createElement("div"),this._element.winControl=this,this._id=this._element.id||d._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),d.addClass(this._element,a.controlCssClass),this._disposed=!1,d.addClass(this._element,"win-disposable");var n=this._element.getAttribute("role");n||this._element.setAttribute("role","menubar");var s=this._element.getAttribute("aria-label");s||this._element.setAttribute("aria-label",I.ariaLabel),this._refreshBound=this._refresh.bind(this),this._setupTree(),t.data||(t=r._shallowCopy(t),t.data=this._getDataFromDOMElements()),c.setOptions(this,t),this._resizeHandlerBound=this._resizeHandler.bind(this),d._resizeNotifier.subscribe(this._element,this._resizeHandlerBound);var o=m.document.body.contains(this._element);if(d._addInsertedNotifier(this._element),o)this._measureCommands(),this._positionCommands();else{var l=function(){i._writeProfilerMark("_setupTree_WinJSNodeInserted:initiallyParented:"+o+",info"),i._element.removeEventListener("WinJSNodeInserted",l,!1),i._measureCommands(),i._positionCommands()};this._element.addEventListener("WinJSNodeInserted",l,!1)}return this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this._winKeyboard=new f._WinKeyboard(this.element),this._initializing=!1,this._writeProfilerMark("constructor,StopTM"),this}return Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inlineMenu",{get:function(){return!!this._inlineMenu},set:function(e){this._writeProfilerMark("set_inlineMenu,info"),e=!!e,e!==this._inlineMenu&&(this._inlineMenu=e,e?(d.addClass(this.element,a.inlineMenuCssClass),d.removeClass(this.element,a.flyoutMenuCssClass),this._inlineOverflowArea||(this._inlineOverflowArea=m.document.createElement("div"),d.addClass(this._inlineOverflowArea,a.overflowAreaCssClass),d.addClass(this._inlineOverflowArea,a.menuCssClass),this.element.appendChild(this._inlineOverflowArea))):(d.addClass(this.element,a.flyoutMenuCssClass),d.removeClass(this.element,a.inlineMenuCssClass)),this._initializing||this._positionCommands())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extraClass",{get:function(){return this._extraClass},set:function(e){this._writeProfilerMark("set_extraClass,info"),this._extraClass&&(d.removeClass(this._element,this._extraClass),this._menu&&d.removeClass(this._menu.element,this._extraClass)),this._extraClass=e,d.addClass(this._element,this._extraClass),this._menu&&d.addClass(this._menu.element,this.extraClass)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){if(this._writeProfilerMark("set_data,info"),e!==this.data){if(!(e instanceof s.List))throw new h("WinJS.UI.Toolbar.BadData",I.badData);this._data&&this._removeDataListeners(),this._data=e,this._addDataListeners(),this._dataUpdated()}},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._disposed||(d._resizeNotifier.unsubscribe(this._element,this._resizeHandlerBound),this._customContentFlyout&&(this._customContentFlyout.dispose(),this._customContentFlyout.element.parentNode.removeChild(this._customContentFlyout.element)),this._menu&&(this._menu.dispose(),this._menu.element.parentNode.removeChild(this._menu.element)),u.disposeSubTree(this.element),this._disposed=!0)},e.prototype.forceLayout=function(){this._positionCommands()},e.prototype._writeProfilerMark=function(e){w("WinJS.UI.Toolbar:"+this._id+":"+e)},e.prototype._setupTree=function(){var e=this;this._writeProfilerMark("_setupTree,info"),this._primaryCommands=[],this._secondaryCommands=[],this._mainActionArea=m.document.createElement("div"),d.addClass(this._mainActionArea,a.actionAreaCssClass),d._reparentChildren(this.element,this._mainActionArea),this.element.appendChild(this._mainActionArea),this._overflowButton=m.document.createElement("button"),this._overflowButton.tabIndex=0,this._overflowButton.innerHTML="<span class='"+a.ellipsisCssClass+"'></span>",d.addClass(this._overflowButton,a.overflowButtonCssClass),this._mainActionArea.appendChild(this._overflowButton),this._overflowButton.addEventListener("click",function(){var t="rtl"===m.getComputedStyle(e._element).direction;e._menu.show(e._overflowButton,"autovertical",t?"left":"right")}),this._overflowButtonWidth=d.getTotalWidth(this._overflowButton),d.addClass(this.element,a.flyoutMenuCssClass)},e.prototype._getFocusableElementsInfo=function(){var e=this,t={elements:[],focusedIndex:-1},i=Array.prototype.slice.call(this._mainActionArea.children);return this.inlineMenu&&(i=i.concat(Array.prototype.slice.call(this._inlineOverflowArea.children))),i.forEach(function(i){e._isElementFocusable(i)&&(t.elements.push(i),i.contains(m.document.activeElement)&&(t.focusedIndex=t.elements.length-1))}),t},e.prototype._dataUpdated=function(){var e=this;this._writeProfilerMark("_dataUpdated,info");var t=this._getDataChangeInfo(),n=i._createUpdateListAnimation(t.addedElements,t.deletedElements,t.currentElements);t.deletedElements.forEach(function(e){e.parentElement&&e.parentElement.removeChild(e)}),t.dataElements.forEach(function(t){e._mainActionArea.appendChild(t)}),this._overflowButton&&this._mainActionArea.appendChild(this._overflowButton),this._primaryCommands=[],this._secondaryCommands=[],this.data.length>0?(d.removeClass(this.element,a.emptyToolbarCssClass),this.data.forEach(function(t){"secondary"===t.section?e._secondaryCommands.push(t):e._primaryCommands.push(t)}),this._initializing||(this._measureCommands(),this._positionCommands())):d.addClass(this.element,a.emptyToolbarCssClass),n.execute()},e.prototype._getDataChangeInfo=function(){var e,t=0,i=0,n=[],r=[],s=[],o=[];for(t=0,i=this.data.length;i>t;t++)n.push(this.data.getAt(t).element);for(t=0,i=this._mainActionArea.children.length;i>t;t++)e=this._mainActionArea.children[t],"none"!==e.style.display&&(o.push(e),-1===n.indexOf(e)&&e!==this._overflowButton&&r.push(e));return n.forEach(function(e){-1===r.indexOf(e)&&-1===o.indexOf(e)&&s.push(e)}),{dataElements:n,deletedElements:r,addedElements:s,currentElements:o}},e.prototype._refresh=function(){var e=this;this._refreshPending||(this._refreshPending=!0,b.schedule(function(){e._refreshPending&&!e._disposed&&(e._dataUpdated(),e._refreshPending=!1)},b.Priority.high,null,"WinJS.UI.Toolbar._refresh"))},e.prototype._addDataListeners=function(){var e=this;this._dataChangedEvents.forEach(function(t){e._data.addEventListener(t,e._refreshBound,!1)})},e.prototype._removeDataListeners=function(){var e=this;this._dataChangedEvents.forEach(function(t){e._data.removeEventListener(t,e._refreshBound,!1)})},e.prototype._isElementFocusable=function(e){var t=!1;if(e){var i=e.winControl;t=i?"none"!==i.element.style.display&&i.type!==a.typeSeparator&&!i.hidden&&!i.disabled&&(!i.firstElementFocus||i.firstElementFocus.tabIndex>=0||i.lastElementFocus.tabIndex>=0):"none"!==e.style.display&&"hidden"!==getComputedStyle(e).visibility&&e.tabIndex>=0}return t},e.prototype._isMainActionCommand=function(e){return e&&e.winControl&&e.parentElement===this._mainActionArea},e.prototype._getLastElementFocus=function(e){return this._isMainActionCommand(e)?e.winControl.lastElementFocus:e},e.prototype._getFirstElementFocus=function(e){return this._isMainActionCommand(e)?e.winControl.firstElementFocus:e},e.prototype._keyDownHandler=function(e){if(!e.altKey){if(d._matchesSelector(e.target,".win-interactive, .win-interactive *"))return;var t,i=d.Key,n="rtl"===m.getComputedStyle(this._element).direction,r=this._getFocusableElementsInfo();if(r.elements.length)switch(e.keyCode){case n?i.rightArrow:i.leftArrow:case i.upArrow:var s=Math.max(0,r.focusedIndex-1);t=this._getLastElementFocus(r.elements[s%r.elements.length]);break;case n?i.leftArrow:i.rightArrow:case i.downArrow:var s=Math.min(r.focusedIndex+1,r.elements.length-1);t=this._getFirstElementFocus(r.elements[s]);break;case i.home:var s=0;t=this._getFirstElementFocus(r.elements[s]);break;case i.end:var s=r.elements.length-1;!this.inlineMenu&&this._isElementFocusable(this._overflowButton)&&(s=Math.max(0,s-1)),t=this._getLastElementFocus(r.elements[s])}t&&(t.focus(),e.preventDefault())}},e.prototype._getDataFromDOMElements=function(){this._writeProfilerMark("_getDataFromDOMElements,info"),o.processAll(this._mainActionArea,!0);for(var e,t=[],i=this._mainActionArea.children.length,n=0;i>n;n++)if(e=this._mainActionArea.children[n],e.winControl&&e.winControl instanceof l.AppBarCommand)t.push(e.winControl);else if(!this._overflowButton)throw new h("WinJS.UI.Toolbar.MustContainCommands",I.mustContainCommands);return new s.List(t)},e.prototype._resizeHandler=function(){this.element.offsetWidth>0&&this._positionCommands()},e.prototype._commandUniqueId=function(e){return d._uniqueID(e.element)},e.prototype._getCommandsInfo=function(){for(var e=0,t=[],i=0,n=0,r=this._primaryCommands.length-1;r>=0;r--){var s=this._primaryCommands[r];i=void 0===s.priority?n--:s.priority,e="none"===s.element.style.display?0:this._getCommandWidth(s),t.unshift({command:s,width:e,priority:i})}return t},e.prototype._getPrimaryCommandsLocation=function(e){this._writeProfilerMark("_getCommandsLocation,info");for(var t=[],i=[],n=0,r=this._secondaryCommands.length>0,s=this._getCommandsInfo(),o=s.slice(0).sort(function(e,t){return e.priority-t.priority}),a=Number.MAX_VALUE,l=e,c=0,u=o.length;u>c;c++)if(l-=o[c].width,n=this.inlineMenu||r||u-1>c?this._overflowButtonWidth:0,0>l-n){a=o[c].priority-1;break}return s.forEach(function(e){e.priority<=a?t.push(e.command):i.push(e.command)}),{mainArea:t,overflowArea:i}},e.prototype._getCommandWidth=function(e){return e.type===a.typeContent?this._customContentCommandsWidth[this._commandUniqueId(e)]:e.type===a.typeSeparator?this._separatorWidth:this._standardCommandWidth},e.prototype._measureCommands=function(){var e=this;this._writeProfilerMark("_measureCommands,info"),!this._disposed&&m.document.body.contains(this._element)&&(this._customContentCommandsWidth={},this._separatorWidth=0,this._standardCommandWidth=0,this._primaryCommands.forEach(function(t){t.element.parentElement||e._mainActionArea.appendChild(t.element),t.type===a.typeContent?e._customContentCommandsWidth[e._commandUniqueId(t)]=d.getTotalWidth(t.element):t.type===a.typeSeparator?e._separatorWidth||(e._separatorWidth=d.getTotalWidth(t.element)):e._standardCommandWidth||(e._standardCommandWidth=d.getTotalWidth(t.element))}),this._overflowButton&&!this._overflowButtonWidth&&(this._overflowButtonWidth=d.getTotalWidth(this._overflowButton)),this._measured=!0)},e.prototype._positionCommands=function(){if(this._writeProfilerMark("_positionCommands,StartTM"),this._disposed||!this._measured)return void this._writeProfilerMark("_positionCommands,StopTM");this._overflowButton&&this._mainActionArea.appendChild(this._overflowButton),this._primaryCommands.forEach(function(e){e.element.style.display=e.hidden?"none":""});var e=d.getTotalWidth(this.element),t=this._getPrimaryCommandsLocation(e);this._hideSeparatorsIfNeeded(t.mainArea),t.overflowArea.forEach(function(e){e.element.style.display="none"}),this._secondaryCommands.forEach(function(e){e.element.style.display="none"}),this._setupOverflowArea(t.overflowArea),this._writeProfilerMark("_positionCommands,StopTM")},e.prototype._getMenuCommand=function(e){var t=this,i=new C._MenuCommand(this.inlineMenu,null,{label:e.label,type:(e.type===a.typeContent?a.typeFlyout:e.type)||a.typeButton,disabled:e.disabled,flyout:e.flyout,beforeOnClick:function(){t._chosenCommand=i._originalToolbarCommand,t._chosenCommand.type===a.typeToggle&&(t._chosenCommand.selected=!t._chosenCommand.selected)}});return e.selected&&(i.selected=!0),e.extraClass&&(i.extraClass=e.extraClass),e.type===a.typeContent?(i.label||(i.label=a.contentMenuCommandDefaultLabel),i.flyout=this._customContentFlyout):i.onclick=e.onclick,i._originalToolbarCommand=e,i},e.prototype._setupOverflowArea=function(e){if(this.inlineMenu)this._overflowButton.style.display="",this._overflowButton.style.visibility="hidden",this._setupOverflowAreaInline(e);else{var t=e.length>0||this._secondaryCommands.length>0;this._overflowButton.style.display=t?"":"none",this._overflowButton.style.visibility="",this._setupOverflowAreaDetached(e)}},e.prototype._setupOverflowAreaInline=function(e){var t=this;this._writeProfilerMark("_setupOverflowAreaInline,info");var i=!1;d.empty(this._inlineOverflowArea),this._hideSeparatorsIfNeeded(e),e.forEach(function(e){e.type===a.typeToggle&&(i=!0),t._inlineOverflowArea.appendChild(t._getMenuCommand(e).element)});var n=this._secondaryCommands.length;if(e.length>0&&n>0){var r=new C._MenuCommand(this.inlineMenu,null,{type:a.typeSeparator});this._inlineOverflowArea.appendChild(r.element)}this._hideSeparatorsIfNeeded(this._secondaryCommands),this._secondaryCommands.forEach(function(e){e.hidden||(e.type===a.typeToggle&&(i=!0),t._inlineOverflowArea.appendChild(t._getMenuCommand(e).element))}),d[i?"addClass":"removeClass"](this._inlineOverflowArea,a.menuToggleClass)},e.prototype._setupOverflowAreaDetached=function(e){var t=this;this._writeProfilerMark("_setupOverflowAreaDetached,info");var i=function(e){return e.type===a.typeContent},n=e.filter(i);if(0===n.length&&(n=this._secondaryCommands.filter(i)),n.length>0&&!this._customContentFlyout){var r=m.document.createElement("div");this._customContentContainer=m.document.createElement("div"),d.addClass(this._customContentContainer,a.overflowContentFlyoutCssClass),r.appendChild(this._customContentContainer),this._customContentFlyout=new _.Flyout(r),m.document.body.appendChild(this._customContentFlyout.element),this._customContentFlyout.onbeforeshow=function(){d.empty(t._customContentContainer),d._reparentChildren(t._chosenCommand.element,t._customContentContainer)},this._customContentFlyout.onafterhide=function(){d._reparentChildren(t._customContentContainer,t._chosenCommand.element)}}this._menu||(this._menu=new g.Menu,d.addClass(this._menu.element,a.overflowAreaCssClass),this.extraClass&&d.addClass(this._menu.element,this.extraClass),m.document.body.appendChild(this._menu.element));var s=[];e.forEach(function(e){s.push(t._getMenuCommand(e))}),e.length>0&&this._secondaryCommands.length>0&&s.push(new v.MenuCommand(null,{type:a.typeSeparator})),this._secondaryCommands.forEach(function(e){e.hidden||s.push(t._getMenuCommand(e))}),this._hideSeparatorsIfNeeded(s),this._menu.commands=s},e.prototype._hideSeparatorsIfNeeded=function(e){var t,i=a.typeSeparator,n=e.length;e.forEach(function(e){e.type===a.typeSeparator&&i===a.typeSeparator&&(e.element.style.display="none"),i=e.type});for(var r=n-1;r>=0&&(t=e[r],t.type===a.typeSeparator);r--)t.element.style.display="none"},e.supportedForProcessing=!0,e}();t.Toolbar=S,n.Class.mix(S,c.DOMEventMixin),n.Namespace.define("WinJS.UI",{Toolbar:S})}),define("WinJS/Controls/AppBar/_Layouts",["exports","../../Animations/_TransitionAnimation","../../BindingList","../../Core/_BaseUtils","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Controls/Toolbar","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Command","./_Constants"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f){"use strict";s.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarBaseLayout:s.Namespace._lazy(function(){var e=f.appBarLayoutCustom,t={get nullCommand(){return"Invalid argument: command must not be null"}},i=s.Class.define(function(e,t){this._disposed=!1,t=t||{},h.setOptions(this,t),e&&this.connect(e)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||e}},commandsInOrder:{get:function(){var e=this.appBarEl.querySelectorAll("."+f.appBarCommandClass);return Array.prototype.slice.call(e)}},connect:function(e){this.className&&m.addClass(e,this.className),this.appBarEl=e},disconnect:function(){this.className&&m.removeClass(this.appBarEl,this.className),this.appBarEl=null,this.dispose()},layout:function(e){for(var t=e.length,i=0;t>i;i++){var n=this.sanitizeCommand(e[i]);this.appBarEl.appendChild(n._element)}},sanitizeCommand:function(e){if(!e)throw new o("WinJS.UI.AppBar.NullCommand",t.nullCommand);return e=e.winControl||e,e._element||(e=new p.AppBarCommand(null,e)),e._element.parentElement&&e._element.parentElement.removeChild(e._element),e},dispose:function(){this._disposed=!0},disposeChildren:function(){var e=this.appBarEl.querySelectorAll("."+f.firstDivClass);e=e.length>=1?e[0]:null;var t=this.appBarEl.querySelectorAll("."+f.finalDivClass);t=t.length>=1?t[0]:null;for(var i=this.appBarEl.children,n=i.length,r=0;n>r;r++){var s=i[r];s!==e&&s!==t&&_.disposeSubTree(s)}},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){},positionChanging:function(){return u.wrap()}});return i})}),s.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarCommandsLayout:s.Namespace._lazy(function(){var t=f.commandLayoutClass,i=f.appBarLayoutCommands,n=s.Class.derive(e._AppBarBaseLayout,function(n){e._AppBarBaseLayout.call(this,n,{_className:t,_type:i}),this._commandLayoutsInit(n)},{_getWidthOfFullSizeCommands:function(e){this._needToMeasureNewCommands&&this._measureContentCommands();var t=0,i=0,n=0;if(!e)return this._fullSizeWidthOfLastKnownVisibleCommands;for(var r,s=0,o=e.length;o>s;s++)r=e[s].winControl||e[s],r._type===f.typeSeparator?i++:r._type!==f.typeContent?n++:t+=r._fullSizeWidth;return t+=i*f.separatorWidth+n*f.buttonWidth},_getFocusableCommandsInLogicalOrder:function(){var e=this._secondaryCommands.children,t=this._primaryCommands.children,i=-1,n=function(e){for(var t=[],n=0,s=e.length;s>n;n++){var o=e[n];if(m.hasClass(o,f.appBarCommandClass)&&o.winControl){var a=o.contains(r.document.activeElement);(o.winControl._isFocusable()||a)&&(t.push(o),a&&(i=t.length-1))}}return t},s=Array.prototype.slice.call(e).concat(Array.prototype.slice.call(t)),o=n(s);return o.focusedIndex=i,o}});return s.Class.mix(n,g),n})});var g={layout:function(e){m.empty(this._primaryCommands),m.empty(this._secondaryCommands),this._commandsInOriginalOrder=[];for(var t=0,i=e.length;i>t;t++){var n=this.sanitizeCommand(e[t]);this._commandsInOriginalOrder.push(n.element),"primary"===n.section||"global"===n.section?this._primaryCommands.appendChild(n._element):this._secondaryCommands.appendChild(n._element)}this.appBarEl.appendChild(this._secondaryCommands),this.appBarEl.appendChild(this._primaryCommands),this._needToMeasureNewCommands=!0,d.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),d.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},commandsInOrder:{get:function(){return this._commandsInOriginalOrder.filter(function(e){return this.appBarEl.contains(e)},this)}},disposeChildren:function(){_.disposeSubTree(this._primaryCommands),_.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(e){var t=m.Key;if(!m._matchesSelector(e.target,".win-interactive, .win-interactive *")){var i="rtl"===r.getComputedStyle(this.appBarEl).direction,n=i?t.rightArrow:t.leftArrow,s=i?t.leftArrow:t.rightArrow;if(e.keyCode===n||e.keyCode===s||e.keyCode===t.home||e.keyCode===t.end){var o,a=this._primaryCommands.contains(r.document.activeElement),l=this._getFocusableCommandsInLogicalOrder(a);if(l.length)switch(e.keyCode){case n:var c=Math.max(-1,l.focusedIndex-1)+l.length;o=l[c%l.length].winControl.lastElementFocus;break;case s:var c=l.focusedIndex+1+l.length;o=l[c%l.length].winControl.firstElementFocus;break;case t.home:var c=0;o=l[c].winControl.firstElementFocus;break;case t.end:var c=l.length-1;o=l[c].winControl.lastElementFocus}o&&(o.focus(),e.preventDefault())}}},commandsUpdated:function(e){var t=e?e:this.commandsInOrder.filter(function(e){return!e.winControl.hidden});this._fullSizeWidthOfLastKnownVisibleCommands=this._getWidthOfFullSizeCommands(t)},beginAnimateCommands:function(e,t,i){this._scaleAfterAnimations=!1;var n=this._getWidthOfFullSizeCommands(e)-this._getWidthOfFullSizeCommands(t);if(n>0){var r=i.concat(e);this.commandsUpdated(r),this.scale()}else 0>n&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.hidden||this.scale())},disconnect:function(){e._AppBarBaseLayout.prototype.disconnect.call(this)},_commandLayoutsInit:function(){this._primaryCommands=r.document.createElement("DIV"),this._secondaryCommands=r.document.createElement("DIV"),m.addClass(this._primaryCommands,f.primaryCommandsClass),m.addClass(this._secondaryCommands,f.secondaryCommandsClass)},_scaleHelper:function(){var e="minimal"===this.appBarEl.winControl.closedDisplayMode?f.appBarInvokeButtonWidth:0;return r.document.documentElement.clientWidth-e},_measureContentCommands:function(){if(r.document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;var e=m.hasClass(this.appBarEl,f.hiddenClass);m.removeClass(this.appBarEl,f.hiddenClass);var t=this.appBarEl.style.display;this.appBarEl.style.display="";for(var i,n,s=this.appBarEl.querySelectorAll("div."+f.appBarCommandClass),o=0,a=s.length;a>o;o++)n=s[o],n.winControl&&n.winControl._type===f.typeContent&&(i=n.style.display,n.style.display="",n.winControl._fullSizeWidth=m.getTotalWidth(n)||0,n.style.display=i);this.appBarEl.style.display=t,e&&m.addClass(this.appBarEl,f.hiddenClass),this.commandsUpdated()}}};s.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarMenuLayout:s.Namespace._lazy(function(){var o=f.menuLayoutClass,a=f.appBarLayoutMenu,d=s.Class.derive(e._AppBarBaseLayout,function(t){e._AppBarBaseLayout.call(this,t,{_className:o,_type:a}),this._tranformNames=n._browserStyleEquivalents.transform},{layout:function(e){this._writeProfilerMark("layout,info"),this._menu?m.empty(this._menu):(this._menu=r.document.createElement("div"),m.addClass(this._menu,f.menuContainerClass),this.appBarEl.appendChild(this._menu)),this._toolbarContainer=r.document.createElement("div"),m.addClass(this._toolbarContainer,f.toolbarContainerClass),this._menu.appendChild(this._toolbarContainer),this._toolbarEl=r.document.createElement("div"),this._toolbarContainer.appendChild(this._toolbarEl),this._createToolbar(e)},connect:function(t){this._writeProfilerMark("connect,info"),e._AppBarBaseLayout.prototype.connect.call(this,t),this._id=m._uniqueID(t)},resize:function(){this._writeProfilerMark("resize,info"),this._forceLayoutPending=!0},positionChanging:function(e,t){return this._writeProfilerMark("positionChanging from:"+e+" to: "+t+",info"),"shown"===t?this._animateToolbarEntrance():this._animateToolbarExit()
},disposeChildren:function(){this._writeProfilerMark("disposeChildren,info"),this._toolbar&&_.disposeSubTree(this._toolbar)},_createToolbar:function(e){this._writeProfilerMark("_createToolbar,info");var t=[],n=this;e.forEach(function(e){t.push(n.sanitizeCommand(e))});var r=m.hasClass(this.appBarEl,f.hiddenClass);m.removeClass(this.appBarEl,f.hiddenClass);var s=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar=new c.Toolbar(this._toolbarEl,{data:new i.List(t),inlineMenu:!0}),this._positionToolbar(),this.appBarEl.style.display=s,r&&m.addClass(this.appBarEl,f.hiddenClass)},_positionToolbar:function(){this._writeProfilerMark("_positionToolbar,info");var e=this._toolbarEl.offsetHeight-(this._isMinimal()&&!this._isBottom()?0:this.appBarEl.offsetHeight),t=this._toolbarEl.offsetHeight-(this._isMinimal()?0:this.appBarEl.offsetHeight);this._toolbarContainer.style[this._tranformNames.scriptName]="translateY(0px)",this._menu.style[this._tranformNames.scriptName]="translateY(-"+e+"px)",this._toolbarEl.style[this._tranformNames.scriptName]="translateY("+t+"px)"},_animateToolbarEntrance:function(){this._writeProfilerMark("_animateToolbarEntrance,info"),this._forceLayoutPending&&(this._forceLayoutPending=!1,this._toolbar.forceLayout(),this._positionToolbar());var e,t,i=this._isMinimal()?0:this.appBarEl.offsetHeight;return this._isBottom()?(e=this._executeTranslate(this._toolbarContainer,"translateY("+(this._toolbarContainer.offsetHeight-i)+"px)"),t=this._executeTranslate(this._toolbarEl,"translateY("+-(this._toolbarContainer.offsetHeight-i)+"px)")):(e=this._executeTranslate(this._toolbarContainer,"translateY("+(this._toolbarContainer.offsetHeight-i)+"px)"),t=this._executeTranslate(this._toolbarEl,"translateY(0px)")),u.join([e,t])},_animateToolbarExit:function(){this._writeProfilerMark("_animateToolbarExit,info");var e=this._isMinimal()?0:this.appBarEl.offsetHeight,t=this._executeTranslate(this._toolbarContainer,"translateY(0px)"),i=this._executeTranslate(this._toolbarEl,"translateY("+(this._toolbarContainer.offsetHeight-e)+"px)");return u.join([t,i])},_executeTranslate:function(e,i){return t.executeTransition(e,{property:this._tranformNames.cssName,delay:0,duration:400,timing:"ease-in",to:i})},_isMinimal:function(){return"minimal"===this.appBarEl.winControl.closedDisplayMode},_isBottom:function(){return"bottom"===this.appBarEl.winControl.placement},_writeProfilerMark:function(e){l("WinJS.UI._AppBarMenuLayout:"+this._id+":"+e)}});return d})})}),define("WinJS/Controls/AppBar",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./AppBar/_Constants","./AppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","./Flyout/_Overlay","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y,b){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{AppBar:n.Namespace._lazy(function(){function e(e){if(!b._Overlay._containsRightMouseClick||e.kind!==i.Windows.UI.Input.EdgeGestureKind.mouse)if(N)N=null;else{var t=e.kind===i.Windows.UI.Input.EdgeGestureKind.keyboard;H._toggleAllAppBarsState(t)}}function m(){N||(N=H._toggleAllAppBarsState(!1))}function v(){var e=C();"showing"===N?b._Overlay._hideAppBars(e,!1):"hiding"===N&&b._Overlay._showAppBars(e,!1),N=null}function y(e){var i=t.document.querySelectorAll("."+f.appBarClass);if(i)for(var n=i.length,r=0;n>r;r++){var s=i[r],o=s.winControl;o&&!s.disabled&&o._manipulationChanged(e)}}function C(){var e=t.document.querySelectorAll("."+f.appBarClass),i=e.length,n=[];n._shown=!1,n._hidden=!1;for(var r=0;i>r;r++){var s=e[r];if(!s.disabled){var o=s.winControl;o&&(n.push(o),_.hasClass(o._element,f.hiddenClass)||_.hasClass(o._element,f.hidingClass)?n._hidden=!0:n._shown=!0)}}return n}function w(e,t,i){for(var n,r=e;r>=0;r--)if(n=i[r].winControl,n&&n.placement===t&&!n.hidden&&n._focusOnLastFocusableElement&&n._focusOnLastFocusableElement())return!0;return!1}function I(){var e=t.document.querySelectorAll("."+f.appBarClass);if(e.length){for(var i=0,n=0;n<e.length;n++)if(e[n]===this.parentElement){i=n;break}var r=this.parentElement.winControl;if(r.placement===f.appBarPlacementBottom){if(i&&w(i-1,f.appBarPlacementBottom,e))return;if(w(e.length-1,f.appBarPlacementTop,e))return;if(w(e.length-1,f.appBarPlacementBottom,e))return}else if(r.placement===f.appBarPlacementTop){if(i&&w(i-1,f.appBarPlacementTop,e))return;if(w(e.length-1,f.appBarPlacementBottom,e))return;if(w(e.length-1,f.appBarPlacementTop,e))return}}}function S(e,t,i){for(var n,r=e;r<i.length;r++)if(n=i[r].winControl,n&&n.placement===t&&!n.hidden&&n._focusOnFirstFocusableElement&&n._focusOnFirstFocusableElement())return!0;return!1}function E(){for(var e=t.document.querySelectorAll("."+f.appBarClass),i=0,n=0;n<e.length;n++)if(e[n]===this.parentElement){i=n;break}if(this.parentElement.winControl.placement===f.appBarPlacementBottom){if(S(i+1,f.appBarPlacementBottom,e))return;if(S(0,f.appBarPlacementTop,e))return;if(S(0,f.appBarPlacementBottom,e))return}else if(this.parentElement.winControl.placement===f.appBarPlacementTop){if(S(i+1,f.appBarPlacementTop,e))return;if(S(0,f.appBarPlacementBottom,e))return;if(S(0,f.appBarPlacementTop,e))return}}function x(){for(var e,i=t.document.querySelectorAll("."+f.appBarClass),n=0;n<i.length;n++)e=i[n].winControl,e&&!e.hidden&&e._updateFirstAndFinalDiv&&e._updateFirstAndFinalDiv()}function k(){for(var e=t.document.querySelectorAll("."+f.appBarClass),i=0;i<e.length;i++){var n=e[i].winControl;if(n&&!n.sticky&&(!n.hidden||n._element.winAnimating===L.shown))return!0}return!1}function P(e){e.relatedTarget&&e.relatedTarget.focus&&!b._Overlay._isAppBarOrChild(e.relatedTarget)&&T(e.relatedTarget)}function T(e){e&&(b._Overlay._ElementWithFocusPreviousToAppBar=e)}function A(){b._Overlay._trySetActive(b._Overlay._ElementWithFocusPreviousToAppBar)}var M=_.Key,B={disabled:0,none:0,hidden:0,minimal:25},L={disabled:"hidden",none:"hidden",hidden:"hidden",minimal:"minimal",shown:"shown"},D={none:"none",minimal:"minimal"},O="shown",R="hidden",F=!1,N=null,z={get ariaLabel(){return o._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get cannotChangePlacementWhenVisible(){return"Invalid argument: The placement property cannot be set when the AppBar is visible, call hide() first"},get badLayout(){return"Invalid argument: The layout property must be 'custom', 'menu' or 'commands'"},get cannotChangeLayoutWhenVisible(){return"Invalid argument: The layout property cannot be set when the AppBar is visible, call hide() first"}},H=n.Class.derive(b._Overlay,function(n,s){this._initializing=!0,s=s||{},this._element=n||t.document.createElement("div"),this._id=this._element.id||_._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),_.addClass(this._element,f.appBarClass);var o=this._element.getAttribute("role");o||this._element.setAttribute("role","menubar");var a=this._element.getAttribute("aria-label");a||this._element.setAttribute("aria-label",z.ariaLabel),this._baseOverlayConstructor(this._element),this._lastPositionVisited=L.none,_.addClass(this._element,f.hiddenClass),s.layout!==f.appBarLayoutCustom&&!s.commands&&this._element&&(s=r._shallowCopy(s),s.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.AppBarCommand")),this._invokeButton=t.document.createElement("button"),this._invokeButton.tabIndex=0,this._invokeButton.innerHTML="<span class='"+f.ellipsisClass+"'></span>",_.addClass(this._invokeButton,f.invokeButtonClass),this._element.appendChild(this._invokeButton);var l=this;_._addEventListener(this._invokeButton,"pointerdown",function(){b._Overlay._addHideFocusClass(l._invokeButton)},!1),this._invokeButton.addEventListener("click",function(){H._toggleAllAppBarsState(p._keyboardSeenLast,l)},!1),this.layout=s.layout||f.appBarLayoutCommands,delete s.layout,this.placement=s.placement||f.appBarPlacementBottom,this.closedDisplayMode=s.closedDisplayMode||D.minimal,d.setOptions(this,s);var c=this._commandsUpdated.bind(this);if(this._element.addEventListener(f.commandVisibilityChanged,function(e){l._disposed||(l.hidden||e.preventDefault(),c())}),this._initializing=!1,this._setFocusToAppBarBound=this._setFocusToAppBar.bind(this),b._Overlay._createClickEatingDivAppBar(),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),!F){if(i.Windows.UI.Input.EdgeGesture){var u=i.Windows.UI.Input.EdgeGesture.getForCurrentView();u.addEventListener("starting",m),u.addEventListener("completed",e),u.addEventListener("canceled",v)}t.document.addEventListener("MSManipulationStateChanged",y,!1),F=!0}return _._addEventListener(this._element,"focusin",function(e){P(e)},!1),_._addEventListener(this._element,"focusout",function(){b._Overlay._hideIfAllAppBarsLostFocus()},!1),this.closedDisplayMode===D.none&&this.layout===f.appBarLayoutCommands&&(this._element.style.display="none"),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(e){var t=!1;if(i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),t=!0),!this.hidden)throw new s("WinJS.UI.AppBar.CannotChangePlacementWhenVisible",z.cannotChangePlacementWhenVisible);this._placement=e===f.appBarPlacementTop?f.appBarPlacementTop:f.appBarPlacementBottom,this._placement===f.appBarPlacementTop?(_.addClass(this._element,f.topClass),_.removeClass(this._element,f.bottomClass)):this._placement===f.appBarPlacementBottom&&(_.removeClass(this._element,f.topClass),_.addClass(this._element,f.bottomClass)),t&&this._show()}},layout:{get:function(){return this._layout.type},set:function(e){if(e!==f.appBarLayoutCommands&&e!==f.appBarLayoutCustom&&e!==f.appBarLayoutMenu)throw new s("WinJS.UI.AppBar.BadLayout",z.badLayout);var t=!1;if(i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),t=!0),!this.hidden)throw new s("WinJS.UI.AppBar.CannotChangeLayoutWhenVisible",z.cannotChangeLayoutWhenVisible);var n;this._initializing||(n=this._layout.commandsInOrder,this._layout.disconnect()),this._layout=e===f.appBarLayoutCommands?new g._AppBarCommandsLayout:e===f.appBarLayoutMenu?new g._AppBarMenuLayout:new g._AppBarBaseLayout,this._layout.connect(this._element),n&&n.length&&this._layoutCommands(n),t&&this._show()},configurable:!0},sticky:{get:function(){return this._sticky},set:function(e){this._sticky!==!!e&&(this._sticky=!!e,this.hidden||"visible"!==this._element.style.visibility||(x(),this._sticky?k()||b._Overlay._hideClickEatingDivAppBar():(b._Overlay._showClickEatingDivAppBar(),this._shouldStealFocus()&&(T(t.document.activeElement),this._setFocusToAppBar()))))}},commands:{set:function(e){if(!this.hidden)throw new s("WinJS.UI.AppBar.CannotChangeCommandsWhenVisible",o._formatString(b._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"AppBar"));this._initializing||this._disposeChildren(),this._layoutCommands(e)}},_layoutCommands:function(e){_.empty(this._element),this._element.appendChild(this._invokeButton),Array.isArray(e)||(e=[e]),this._layout.layout(e)},closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(e){var t=this._closedDisplayMode;t!==e&&(e===D.none?(this._closedDisplayMode=D.none,_.removeClass(this._element,f.minimalClass)):(this._closedDisplayMode=D.minimal,_.addClass(this._element,f.minimalClass)),this._layout.resize(),(_.hasClass(this._element,f.hiddenClass)||_.hasClass(this._element,f.hidingClass))&&this._changeVisiblePosition(L[this._closedDisplayMode]))}},disabled:{get:function(){return!!this._element.disabled},set:function(e){var e=!!e;if(this.disabled!==e){this._element.disabled=e;var t;t=e?L.disabled:L[this.closedDisplayMode],this._hide(t)}}},hidden:{get:function(){return _.hasClass(this._element,f.hiddenClass)||_.hasClass(this._element,f.hidingClass)||this._doNext===L.minimal||this._doNext===L.none}},getCommandById:function(e){for(var t=this.element.querySelectorAll("#"+e),i=[],n=0,r=t.length;r>n;n++)t[n].winControl&&i.push(t[n].winControl);return 1===i.length?i[0]:0===i.length?null:i},showCommands:function(e){if(!e)throw new s("WinJS.UI.AppBar.RequiresCommands",z.requiresCommands);this._showCommands(e)},hideCommands:function(e){if(!e)throw new s("WinJS.UI.AppBar.RequiresCommands",z.requiresCommands);this._hideCommands(e)},showOnlyCommands:function(e){if(!e)throw new s("WinJS.UI.AppBar.RequiresCommands",z.requiresCommands);this._showOnlyCommands(e)},show:function(){this._writeProfilerMark("show,StartTM"),this._keyboardInvoked=!1,this._doNotFocus=!!this.sticky,this._show()},_show:function(){var e=L.shown,i=null;this.disabled||!_.hasClass(this._element,f.hiddenClass)&&!_.hasClass(this._element,f.hidingClass)||(i=O),this._changeVisiblePosition(e,i),i&&(this.sticky||b._Overlay._showClickEatingDivAppBar(),!this.sticky&&k()?x():this._updateFirstAndFinalDiv(),!this._doNotFocus&&this._shouldStealFocus()&&(b._Overlay._ElementWithFocusPreviousToAppBar||T(t.document.activeElement),this._positionChangingPromise.then(this._setFocusToAppBarBound,this._setFocusToAppBarBound)))},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(e){var e=e||L[this.closedDisplayMode],i=null;if(_.hasClass(this._element,f.hiddenClass)||_.hasClass(this._element,f.hidingClass)||(i=R),this._changeVisiblePosition(e,i),i){var n,r=t.document.querySelectorAll("."+f.appBarClass),s=!1,o=!1;for(n=0;n<r.length;n++){var a=r[n].winControl;if(a&&!a.hidden&&a!==this&&(s=!0,!a.sticky)){o=!0;break}}var l=t.document.querySelectorAll("."+f.settingsFlyoutClass),c=!1;for(n=0;n<l.length;n++){var u=l[n].winControl;if(u&&!u.hidden){c=!0;break}}o||c||b._Overlay._hideClickEatingDivAppBar();var d=this;if(s){if(H._isWithinAppBarOrChild(t.document.activeElement,d.element)){var h=!1;for(n=0;n<=r.length;n++){n===r.length&&(n=0);var m=r[n];if(m===this.element)h=!0;else if(h&&!m.winControl.hidden){m.winControl._keyboardInvoked=!!this._keyboardInvoked,m.winControl._setFocusToAppBar();break}}}}else!b._Overlay._ElementWithFocusPreviousToAppBar||t.document.activeElement&&!b._Overlay._isAppBarOrChild(t.document.activeElement)||A(),b._Overlay._ElementWithFocusPreviousToAppBar=null;this.sticky||k()||x(),this._keyboardInvoked=!1,this._doNotFocus=!1}},_dispose:function(){h.disposeSubTree(this.element),this._layout.dispose(),this.disabled=!0},_disposeChildren:function(){this._layout.disposeChildren()},_isLightDismissible:function(){return b._Overlay.prototype._isLightDismissible.call(this)||k()},_handleKeyDown:function(e){e.keyCode===M.escape&&e.keyCode!==M.IME&&(e.preventDefault(),e.stopPropagation(),this._lightDismiss(!0)),this._invokeButton.contains(t.document.activeElement)||this._layout.handleKeyDown(e)},_visiblePixels:{get:function(){return{hidden:B.hidden,minimal:B.minimal,shown:this._element.offsetHeight}}},_visiblePosition:{get:function(){return this._animating&&L[this._element.winAnimating]?this._element.winAnimating:this._lastPositionVisited}},_visible:{get:function(){return this._visiblePosition!==L.none}},_changeVisiblePosition:function(e,t){if(this._visiblePosition===e&&!this._keyboardObscured||this.disabled&&e!==L.disabled)this._afterPositionChange(null);else if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)this._doNext=e,this._afterPositionChange(null);else{this._element.winAnimating=e;var i=this._initializing?!1:!0,n=this._lastPositionVisited;this._element.style.display="";var r=e===L.hidden;this._keyboardObscured&&(r?i=!1:n=L.hidden,this._keyboardObscured=!1),t===O?this._beforeShow():t===R&&this._beforeHide(),this._ensurePosition(),this._element.style.opacity=1,this._element.style.visibility="visible",this._animationPromise=i?this._animatePositionChange(n,e):c.wrap(),this._animationPromise.then(function(){this._afterPositionChange(e,t)}.bind(this),function(){this._afterPositionChange(e,t)}.bind(this))}},_afterPositionChange:function(e,t){if(!this._disposed){if(e){this._element.winAnimating="",this._lastPositionVisited=e,this._doNext===this._lastPositionVisited&&(this._doNext=""),e===L.hidden&&(this._element.style.visibility="hidden",this._element.style.display="none");var i=r._browserStyleEquivalents.transform.scriptName;this._element.style[i]="",t===O?this._afterShow():t===R&&this._afterHide(),u.schedule(this._checkDoNext,u.Priority.normal,this,"WinJS.UI.AppBar._checkDoNext")}this._afterPositionChangeCallBack()}},_afterPositionChangeCallBack:function(){},_beforeShow:function(){this._cachedDocumentSize=this._cachedDocumentSize||b._Overlay._sizeOfDocument(),this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._layout.scale(),_.removeClass(this._element,f.hiddenClass),_.addClass(this._element,f.showingClass),this._sendEvent(b._Overlay.beforeShow)},_afterShow:function(){_.removeClass(this._element,f.showingClass),_.addClass(this._element,f.shownClass),this._sendEvent(b._Overlay.afterShow),this._writeProfilerMark("show,StopTM")},_beforeHide:function(){_.removeClass(this._element,f.shownClass),_.addClass(this._element,f.hidingClass),this._sendEvent(b._Overlay.beforeHide)},_afterHide:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),_.removeClass(this._element,f.hidingClass),_.addClass(this._element,f.hiddenClass),this._sendEvent(b._Overlay.afterHide),this._writeProfilerMark("hide,StopTM")},_animatePositionChange:function(e,t){this._positionChangingPromise=this._layout.positionChanging(e,t);var i=this._visiblePixels[e],n=this._visiblePixels[t],r=Math.abs(n-i),s=this._placement===f.appBarPlacementTop?-r:r;if(n>i){var o={top:s+"px",left:"0px"};return l.showEdgeUI(this._element,o,{mechanism:"transition"})}var a={top:s+"px",left:"0px"};return l.hideEdgeUI(this._element,a,{mechanism:"transition"})},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||(this._doNext===L.disabled||this._doNext===L.hidden||this._doNext===L.minimal?(this._hide(this._doNext),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():this._doNext===L.shown&&(this._show(),this._doNext=""))},_isABottomAppBarInTheProcessOfShowing:function(){for(var e=t.document.querySelectorAll("."+f.appBarClass+"."+f.bottomClass),i=0;i<e.length;i++)if(e[i].winAnimating===L.shown)return!0;return!1},_shouldStealFocus:function(){var e=b._Overlay._isAppBarOrChild(t.document.activeElement);if(this._element===e)return!1;if(this._placement===f.appBarPlacementBottom)return!0;var i=this._isABottomAppBarInTheProcessOfShowing();return e?e.winControl&&(e.winControl._placement===f.appBarPlacementBottom||e.winControl._placement===f.appBarPlacementTop||i)?!1:!0:!i},_setFocusToAppBar:function(){this._focusOnFirstFocusableElement()?this._keyboardInvoked||b._Overlay._addHideFocusClass(t.document.activeElement):b._Overlay._trySetActive(this._element)},_commandsUpdated:function(){this._initializing||(this._layout.commandsUpdated(),this._layout.scale())},_beginAnimateCommands:function(e,t,i){this._layout.beginAnimateCommands(e,t,i)},_endAnimateCommands:function(){this._layout.endAnimateCommands(),this._endAnimateCommandsCallBack()},_endAnimateCommandsCallBack:function(){},_getTopOfVisualViewport:function(){return b._Overlay._keyboardInfo._visibleDocTop},_getAdjustedBottom:function(){return b._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(e){if(this._keyboardObscured=!1,this._needToHandleHidingKeyboard=!1,!b._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._needToHandleShowingKeyboard=!0,!this.hidden&&this._element.contains(t.document.activeElement)&&(e.ensuredFocusedElementInView=!0),this._visible&&this._placement!==f.appBarPlacementTop&&b._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var i=this;t.setTimeout(function(e){i._checkKeyboardTimer(e)},b._Overlay._keyboardInfo._animationShowLength+b._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._needToHandleShowingKeyboard=!1,this._needToHandleHidingKeyboard=!0,b._Overlay._keyboardInfo._isResized||((this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""),this._needToHandleHidingKeyboard=!1)},_resize:function(e){this._needToHandleShowingKeyboard?this._visible&&(this._placement===f.appBarPlacementTop||this._keyboardObscured||(this._element.style.display="none")):this._needToHandleHidingKeyboard&&(this._needToHandleHidingKeyboard=!1,(this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display="")),this._initializing||this._layout.resize(e)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(e){0===e.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){if(this._needToHandleShowingKeyboard)if(this._needToHandleShowingKeyboard=!1,this._keyboardObscured||this._placement===f.appBarPlacementTop&&0===b._Overlay._keyboardInfo._visibleDocTop)this._checkDoNext();else{var e=this._visiblePosition;this._lastPositionVisited=L.hidden,this._changeVisiblePosition(e,!1)}this._scrollHappened=!1},_ensurePosition:function(){var e=this._computePositionOffset();this._element.style.bottom=e.bottom,this._element.style.top=e.top},_computePositionOffset:function(){var e={};return this._placement===f.appBarPlacementBottom?(e.bottom=this._getAdjustedBottom()+"px",e.top=""):this._placement===f.appBarPlacementTop&&(e.bottom="",e.top=this._getTopOfVisualViewport()+"px"),e},_checkScrollPosition:function(){return this._needToHandleShowingKeyboard?void(this._scrollHappened=!0):void((this._visible||this._animating)&&(this._ensurePosition(),this._checkDoNext()))},_alreadyInPlace:function(){var e=this._computePositionOffset();return e.top===this._element.style.top&&e.bottom===this._element.style.bottom},_updateFirstAndFinalDiv:function(){var e=this._element.querySelectorAll("."+f.firstDivClass);e=e.length>=1?e[0]:null;var i=this._element.querySelectorAll("."+f.finalDivClass);i=i.length>=1?i[0]:null,e&&this._element.children[0]!==e&&(e.parentNode.removeChild(e),e=null),i&&this._element.children[this._element.children.length-1]!==i&&(i.parentNode.removeChild(i),i=null),e||(e=t.document.createElement("div"),e.style.display="inline",e.className=f.firstDivClass,e.tabIndex=-1,e.setAttribute("aria-hidden","true"),_._addEventListener(e,"focusin",I,!1),this._element.children[0]?this._element.insertBefore(e,this._element.children[0]):this._element.appendChild(e)),i||(i=t.document.createElement("div"),i.style.display="inline",i.className=f.finalDivClass,i.tabIndex=-1,i.setAttribute("aria-hidden","true"),_._addEventListener(i,"focusin",E,!1),this._element.appendChild(i)),this._element.children[this._element.children.length-2]!==this._invokeButton&&this._element.insertBefore(this._invokeButton,i);var n=this._element.getElementsByTagName("*"),r=_._getHighestTabIndexInList(n);this._invokeButton.tabIndex=r,k()?(e&&(e.tabIndex=_._getLowestTabIndexInList(n)),i&&(i.tabIndex=r)):(e&&(e.tabIndex=-1),i&&(i.tabIndex=-1))},_writeProfilerMark:function(e){a("WinJS.UI.AppBar:"+this._id+":"+e)}},{_appBarsSynchronizationPromise:c.as(),_isWithinAppBarOrChild:function(e,t){if(!e||!t)return!1;if(t.contains(e))return!0;var i=b._Overlay._getParentControlUsingClassName(e,f.flyoutClass);return i&&t.contains(i._previousFocus)},_toggleAllAppBarsState:function(e,t){var i,n=C();return i=t?_.hasClass(t._element,f.showingClass)||_.hasClass(t._element,f.shownClass):n._shown&&!n._hidden,i?(H._appBarsSynchronizationPromise=H._appBarsSynchronizationPromise.then(function(){return b._Overlay._hideAppBars(n,e)}),"hiding"):(H._appBarsSynchronizationPromise=H._appBarsSynchronizationPromise.then(function(){return b._Overlay._showAppBars(n,e)}),"showing")}});return H})})}),define("WinJS/Controls/AutoSuggestBox/_SearchSuggestionManagerShim",["exports","../../_Signal","../../Core/_Base","../../Core/_BaseUtils","../../Core/_Events","../../BindingList"],function(e,t,i,n,r){"use strict";var s={reset:0,itemInserted:1,itemRemoved:2,itemChanged:3},o={Query:0,Result:1,Separator:2},a=i.Class.derive(Array,function(){},{reset:function(){this.length=0,this.dispatchEvent("vectorchanged",{collectionChange:s.reset,index:0})},insert:function(e,t){this.splice(e,0,t),this.dispatchEvent("vectorchanged",{collectionChange:s.itemInserted,index:e})},remove:function(e){this.splice(e,1),this.dispatchEvent("vectorchanged",{collectionChange:s.itemRemoved,index:e})}});i.Class.mix(a,r.eventMixin);var l=i.Class.define(function(){this._data=[]},{size:{get:function(){return this._data.length}},appendQuerySuggestion:function(e){this._data.push({kind:o.Query,text:e})},appendQuerySuggestions:function(e){e.forEach(this.appendQuerySuggestion.bind(this))},appendResultSuggestion:function(e,t,i,n,r){this._data.push({kind:o.Result,text:e,detailText:t,tag:i,imageUrl:n,imageAlternateText:r,image:null})},appendSearchSeparator:function(e){this._data.push({kind:o.Separator,text:e})}}),c=i.Class.define(function(e,t,i){this._queryText=e,this._language=t,this._linguisticDetails=i,this._searchSuggestionCollection=new l},{language:{get:function(){return this._language}},linguisticDetails:{get:function(){return this._linguisticDetails}},queryText:{get:function(){return this._queryText}},searchSuggestionCollection:{get:function(){return this._searchSuggestionCollection}},getDeferral:function(){return this._deferralSignal||(this._deferralSignal=new t)},_deferralSignal:null}),u=i.Class.define(function(){this._updateVector=this._updateVector.bind(this),this._suggestionVector=new a,this._query="",this._history={"":[]},this._dataSource=[],this.searchHistoryContext="",this.searchHistoryEnabled=!0},{addToHistory:function(e){if(e&&e.trim()){for(var t=this._history[this.searchHistoryContext],i=-1,n=0,r=t.length;r>n;n++){var s=t[n];if(s.text.toLowerCase()===e.toLowerCase()){i=n;break}}i>=0&&t.splice(i,1),t.splice(0,0,{text:e,kind:o.Query}),this._updateVector()}},clearHistory:function(){this._history[this.searchHistoryContext]=[],this._updateVector()},setLocalContentSuggestionSettings:function(){},setQuery:function(e){function t(e){i._dataSource=e,i._updateVector()}var i=this;this._query=e;var n=new c(e);this.dispatchEvent("suggestionsrequested",{request:n}),n._deferralSignal?n._deferralSignal.promise.then(t.bind(this,n.searchSuggestionCollection._data)):t(n.searchSuggestionCollection._data)},searchHistoryContext:{get:function(){return""+this._searchHistoryContext},set:function(e){e=""+e,this._history[e]||(this._history[e]=[]),this._searchHistoryContext=e}},searchHistoryEnabled:{get:function(){return this._searchHistoryEnabled},set:function(e){this._searchHistoryEnabled=e}},suggestions:{get:function(){return this._suggestionVector}},_updateVector:function(){for(this.suggestions.insert(this.suggestions.length,{text:"",kind:o.Query});this.suggestions.length>1;)this.suggestions.remove(0);var e=0,t={};if(this.searchHistoryEnabled){var i=this._query.toLowerCase();this._history[this.searchHistoryContext].forEach(function(n){var r=n.text.toLowerCase();0===r.indexOf(i)&&(this.suggestions.insert(e,n),t[r]=!0,e++)},this)}this._dataSource.forEach(function(i){i.kind===o.Query?t[i.text.toLowerCase()]||(this.suggestions.insert(e,i),e++):(this.suggestions.insert(e,i),e++)},this),this.suggestions.remove(this.suggestions.length-1)}});i.Class.mix(u,r.eventMixin),i.Namespace._moduleDefine(e,null,{_CollectionChange:s,_SearchSuggestionKind:o,_SearchSuggestionManagerShim:u})}),define("WinJS/Controls/AutoSuggestBox",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Animations","../BindingList","../Promise","./Repeater","./AutoSuggestBox/_SearchSuggestionManagerShim"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{AutoSuggestBox:n.Namespace._lazy(function(){function e(e,i,n,r){function s(e,i,n){var r=t.document.createElement("span");return r.textContent=i,r.setAttribute("aria-hidden","true"),r.classList.add(b.asbHitHighlightSpan),e.insertBefore(r,n),r}if(n){l.query("."+b.asbHitHighlightSpan,e).forEach(function(e){e.parentNode.removeChild(e)});var o=e.firstChild,a=i.hits;!a&&r&&i.kind!==p._SearchSuggestionKind.Separator&&(a=r.find(n));for(var u=I._sortAndMergeHits(a),d=0,h=0;h<u.length;h++){var _=u[h];s(e,n.substring(d,_.startPosition),o),d=_.startPosition+_.length;var m=s(e,n.substring(_.startPosition,d),o);c.addClass(m,b.asbBoxFlyoutHighlightText)}d<n.length&&s(e,n.substring(d),o)}}function u(e){var t={ctrlKey:1,altKey:2,shiftKey:4},i=0;return e.ctrlKey&&(i|=t.ctrlKey),e.altKey&&(i|=t.altKey),e.shiftKey&&(i|=t.shiftKey),i}function f(i,n){var r=t.document.createElement("div"),s=new t.Image;s.style.opacity=0;var a=function(e){function t(){s.removeEventListener("load",t,!1),d.fadeIn(s)}s.addEventListener("load",t,!1),s.src=e};null!==n.image?n.image.openReadAsync().then(function(e){null!==e&&a(t.URL.createObjectURL(e,{oneTimeOnly:!0}))}):null!==n.imageUrl&&a(n.imageUrl),s.setAttribute("aria-hidden","true"),r.appendChild(s);var l=t.document.createElement("div");c.addClass(l,b.asbSuggestionResultText),e(l,n,n.text),l.title=n.text,l.setAttribute("aria-hidden","true"),r.appendChild(l);var u=t.document.createElement("br");l.appendChild(u);var h=t.document.createElement("span");c.addClass(h,b.asbSuggestionResultDetailedText),e(h,n,n.detailText),h.title=n.detailText,h.setAttribute("aria-hidden","true"),l.appendChild(h),c.addClass(r,b.asbSuggestionResult),c._addEventListener(r,"pointerup",function(e){i._inputElement.focus(),i._processSuggestionChosen(n,e)}),r.setAttribute("role","option");var _=o._formatString(w.ariaLabelResult,n.text,n.detailText);return r.setAttribute("aria-label",_),r}function g(i,n){var r=t.document.createElement("div");e(r,n,n.text),r.title=n.text,r.classList.add(b.asbSuggestionQuery),c._addEventListener(r,"pointerup",function(e){i._inputElement.focus(),i._processSuggestionChosen(n,e)});var s=o._formatString(w.ariaLabelQuery,n.text);return r.setAttribute("role","option"),r.setAttribute("aria-label",s),r}function v(e){var i=t.document.createElement("div");if(e.text.length>0){var n=t.document.createElement("div");n.textContent=e.text,n.title=e.text,n.setAttribute("aria-hidden","true"),i.appendChild(n)}i.insertAdjacentHTML("beforeend","<hr/>"),c.addClass(i,b.asbSuggestionSeparator),i.setAttribute("role","separator");var r=o._formatString(w.ariaLabelSeparator,e.text);return i.setAttribute("aria-label",r),i}var y=c.Key,b={asb:"win-autosuggestbox",asbDisabled:"win-autosuggestbox-disabled",asbFlyout:"win-autosuggestbox-flyout",asbFlyoutAbove:"win-autosuggestbox-flyout-above",asbBoxFlyoutHighlightText:"win-autosuggestbox-flyout-highlighttext",asbHitHighlightSpan:"win-autosuggestbox-hithighlight-span",asbInput:"win-autosuggestbox-input",asbInputFocus:"win-autosuggestbox-input-focus",asbSuggestionQuery:"win-autosuggestbox-suggestion-query",asbSuggestionResult:"win-autosuggestbox-suggestion-result",asbSuggestionResultText:"win-autosuggestbox-suggestion-result-text",asbSuggestionResultDetailedText:"win-autosuggestbox-suggestion-result-detailed-text",asbSuggestionSelected:"win-autosuggestbox-suggestion-selected",asbSuggestionSeparator:"win-autosuggestbox-suggestion-separator"},C={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested"},w={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get invalidSuggestionKind(){return"Error: Invalid suggestion kind."
},get ariaLabel(){return o._getWinJSString("ui/autoSuggestBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return o._getWinJSString("ui/autoSuggestBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return o._getWinJSString("ui/autoSuggestBoxAriaLabelInputPlaceHolder").value},get ariaLabelQuery(){return o._getWinJSString("ui/autoSuggestBoxAriaLabelQuery").value},get ariaLabelResult(){return o._getWinJSString("ui/autoSuggestBoxAriaLabelResult").value},get ariaLabelSeparator(){return o._getWinJSString("ui/autoSuggestBoxAriaLabelSeparator").value}},I=n.Class.define(function(e,i){if(e=e||t.document.createElement("div"),i=i||{},e.winControl)throw new r("WinJS.UI.AutoSuggestBox.DuplicateConstruction",w.duplicateConstruction);this._suggestionsChangedHandler=this._suggestionsChangedHandler.bind(this),this._suggestionsRequestedHandler=this._suggestionsRequestedHandler.bind(this),this._element=e,e.winControl=this,e.classList.add(b.asb),e.classList.add("win-disposable"),this._setupDOM(),this._setupSSM(),this._chooseSuggestionOnEnter=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._flyoutOpenPromise=_.wrap(),this._lastKeyPressLanguage="",this._prevLinguisticDetails=this._getLinguisticDetails(),this._prevQueryText="",a.setOptions(this,i),this._hideFlyout()},{onresultsuggestionchosen:s._createEventProperty(C.resultsuggestionchosen),onquerychanged:s._createEventProperty(C.querychanged),onquerysubmitted:s._createEventProperty(C.querysubmitted),onsuggestionsrequested:s._createEventProperty(C.suggestionsrequested),element:{get:function(){return this._element}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(e){this._chooseSuggestionOnEnter=!!e}},disabled:{get:function(){return this._inputElement.disabled},set:function(e){this._inputElement.disabled!==!!e&&(e?this._disableControl():this._enableControl())}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(e){this._inputElement.placeholder=e,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(e){this._inputElement.value=e}},searchHistoryDisabled:{get:function(){return!this._suggestionManager.searchHistoryEnabled},set:function(e){this._suggestionManager.searchHistoryEnabled=!e}},searchHistoryContext:{get:function(){return this._suggestionManager.searchHistoryContext},set:function(e){this._suggestionManager.searchHistoryContext=e}},dispose:function(){this._disposed||(this._flyoutOpenPromise.cancel(),this._suggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandler),this._suggestionManager=null,this._suggestions=null,this._hitFinder=null,this._disposed=!0)},setLocalContentSuggestionSettings:function(e){this._suggestionManager.setLocalContentSuggestionSettings(e)},_setupDOM:function(){function e(e){return s._renderSuggestion(e)}var i=this._flyoutPointerReleasedHandler.bind(this),n=this._inputOrImeChangeHandler.bind(this);this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",w.ariaLabel),this._element.setAttribute("role","group"),this._inputElement=t.document.createElement("input"),this._inputElement.type="search",this._inputElement.classList.add(b.asbInput),this._inputElement.setAttribute("role","textbox"),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),this._inputElement.addEventListener("focus",this._inputFocusHandler.bind(this)),this._inputElement.addEventListener("blur",this._inputBlurHandler.bind(this)),this._inputElement.addEventListener("input",n),this._inputElement.addEventListener("compositionstart",n),this._inputElement.addEventListener("compositionupdate",n),this._inputElement.addEventListener("compositionend",n),c._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),this._updateInputElementAriaLabel(),this._element.appendChild(this._inputElement);var r=this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext();r&&(r.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),r.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))),this._flyoutElement=t.document.createElement("div"),this._flyoutElement.classList.add(b.asbFlyout),this._flyoutElement.addEventListener("blur",this._flyoutBlurHandler.bind(this)),c._addEventListener(this._flyoutElement,"pointerup",i),c._addEventListener(this._flyoutElement,"pointercancel",i),c._addEventListener(this._flyoutElement,"pointerout",i),c._addEventListener(this._flyoutElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),this._element.appendChild(this._flyoutElement);var s=this;this._suggestionsData=new h.List,this._repeaterElement=t.document.createElement("div"),this._repeater=new m.Repeater(this._repeaterElement,{data:this._suggestionsData,template:e}),c._ensureId(this._repeaterElement),this._repeaterElement.setAttribute("role","listbox"),this._repeaterElement.setAttribute("aria-live","polite"),this._flyoutElement.appendChild(this._repeaterElement)},_setupSSM:function(){this._suggestionManager=i.Windows.ApplicationModel.Search.Core.SearchSuggestionManager?new i.Windows.ApplicationModel.Search.Core.SearchSuggestionManager:new p._SearchSuggestionManagerShim,this._suggestions=this._suggestionManager.suggestions,this._suggestions.addEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandler)},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutElement.style.display="none")},_showFlyout:function(){if(!this._isFlyoutShown()&&0!==this._suggestionsData.length){this._flyoutElement.style.display="block";var e=this._inputElement.getBoundingClientRect(),i=this._flyoutElement.getBoundingClientRect(),n=t.document.documentElement.clientWidth,r=e.top,s=t.document.documentElement.clientHeight-e.bottom;this._flyoutBelowInput=s>=r,this._flyoutBelowInput?(this._flyoutElement.classList.remove(b.asbFlyoutAbove),this._flyoutElement.scrollTop=0):(this._flyoutElement.classList.add(b.asbFlyoutAbove),this._flyoutElement.scrollTop=this._flyoutElement.scrollHeight-this._flyoutElement.clientHeight),this._addFlyoutIMEPaddingIfRequired();var o;o="rtl"===t.getComputedStyle(this._flyoutElement).direction?e.right-i.width>=0||e.left+i.width>n:e.left+i.width>n&&e.right-i.width>=0,this._flyoutElement.style.left=o?e.width-i.width-this._element.clientLeft+"px":"-"+this._element.clientLeft+"px",this._flyoutElement.style.touchAction=this._flyoutElement.scrollHeight>i.height?"pan-y":"none",this._flyoutOpenPromise.cancel();var a=this._flyoutBelowInput?"WinJS-flyoutBelowASB-showPopup":"WinJS-flyoutAboveASB-showPopup";this._flyoutOpenPromise=d.showPopup(this._flyoutElement,{top:"0px",left:"0px",keyframe:a})}},_addFlyoutIMEPaddingIfRequired:function(){var e=this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext();if(e&&this._isFlyoutShown()&&this._flyoutBelowInput){var t=this._flyoutElement.getBoundingClientRect(),i=e.getCandidateWindowClientRect(),n=this._inputElement.getBoundingClientRect(),r=n.bottom,s=n.bottom+t.height;if(!(i.top<r||i.top>s)||!(i.bottom<r||i.bottom>s)){var o=e.getCandidateWindowClientRect(),a=d.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop=o.bottom-o.top+4+"px",a.execute()}}},_findNextSuggestionElementIndex:function(e){for(var t=0>e?0:e+1,i=t;i<this._suggestionsData.length;i++)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_findPreviousSuggestionElementIndex:function(e){for(var t=e>=this._suggestionsData.length?this._suggestionsData.length-1:e-1,i=t;i>=0;i--)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_isFlyoutShown:function(){return"none"!==this._flyoutElement.style.display},_isSuggestionSelectable:function(e){return e.kind===p._SearchSuggestionKind.Query||e.kind===p._SearchSuggestionKind.Result},_processSuggestionChosen:function(e,t){this.queryText=e.text,e.kind===p._SearchSuggestionKind.Query?this._submitQuery(e.text,!1,t):e.kind===p._SearchSuggestionKind.Result&&this._fireEvent(C.resultsuggestionchosen,{tag:e.tag,keyModifiers:u(t),storageFile:null}),this._hideFlyout()},_selectSuggestionAtIndex:function(e){function t(e){var t=i._flyoutElement.getBoundingClientRect().bottom-i._flyoutElement.getBoundingClientRect().top;if(e.offsetTop+e.offsetHeight>i._flyoutElement.scrollTop+t){var n=e.offsetTop+e.offsetHeight-(i._flyoutElement.scrollTop+t);c._zoomTo(i._flyoutElement,{contentX:0,contentY:i._flyoutElement.scrollTop+n,viewportX:0,viewportY:0})}else e.offsetTop<i._flyoutElement.scrollTop&&c._zoomTo(i._flyoutElement,{contentX:0,contentY:e.offsetTop,viewportX:0,viewportY:0})}for(var i=this,n=null,r=0;r<this._suggestionsData.length;r++)n=this._repeater.elementFromIndex(r),r!==e?(n.classList.remove(b.asbSuggestionSelected),n.setAttribute("aria-selected","false")):(n.classList.add(b.asbSuggestionSelected),t(n),n.setAttribute("aria-selected","true"));this._currentSelectedIndex=e,n?this._inputElement.setAttribute("aria-activedescendant",this._repeaterElement.id+e):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_updateFakeFocus:function(){var e;e=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(e)},_updateQueryTextWithSuggestionText:function(e){e>=0&&e<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(e).text)},_disableControl:function(){this._isFlyoutShown()&&this._hideFlyout(),this._element.disabled=!0,this._element.classList.add(b.asbDisabled),this._inputElement.disabled=!0},_enableControl:function(){this._element.disabled=!1,this._element.classList.remove(b.asbDisabled),this._inputElement.disabled=!1,t.document.activeElement===this._element&&c._setActive(this._inputElement)},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,i),this._element.dispatchEvent(n)},_getLinguisticDetails:function(e,t){function n(e,t,n,r,s){for(var o=null,a=[],l=0;l<e.length;l++)a[l]=r+e[l]+s;return o=i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails?new i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(a,t,n):{queryTextAlternatives:a,queryTextCompositionStart:t,queryTextCompositionLength:n}}var r=null;if(this._inputElement.value===this._prevQueryText&&e&&this._prevLinguisticDetails&&t)r=this._prevLinguisticDetails;else{var s=[],o=0,a=0,l="",c="";if(t&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext().getCompositionAlternatives){var u=this._inputElement.msGetInputContext();s=u.getCompositionAlternatives(),o=u.compositionStartOffset,a=u.compositionEndOffset-u.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||a>0?(l=this._inputElement.value.substring(0,o),c=this._inputElement.value.substring(o+a)):(l=this._inputElement.value.substring(0,this._prevCompositionStart),c=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength))}r=n(s,o,a,l,c)}return r},_isElementInSearchControl:function(e){return this.element.contains(e)||this.element===e},_renderSuggestion:function(e){var t=null;if(!e)return t;if(e.kind===p._SearchSuggestionKind.Query)t=g(this,e);else if(e.kind===p._SearchSuggestionKind.Separator)t=v(e);else{if(e.kind!==p._SearchSuggestionKind.Result)throw new r("WinJS.UI.AutoSuggestBox.invalidSuggestionKind",w.invalidSuggestionKind);t=f(this,e)}return t},_shouldIgnoreInput:function(){var e=this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey;return e||this._isFlyoutPointerDown},_submitQuery:function(e,t,n){this._disposed||(i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(C.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,t),queryText:e,keyModifiers:u(n)}),this._suggestionManager&&this._suggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?o._formatString(w.ariaLabelInputPlaceHolder,this._inputElement.placeholder):w.ariaLabelInputNoPlaceHolder)},_flyoutBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)?this._internalFocusMove=!0:(this._element.classList.remove(b.asbInputFocus),this._hideFlyout())},_flyoutPointerDownHandler:function(e){function t(){if(n)for(var e=0;e<i._suggestionsData.length;e++)if(i._repeater.elementFromIndex(e)===n)return e;return-1}var i=this,n=e.target;for(this._isFlyoutPointerDown=!0;n&&n.parentNode!==this._repeaterElement;)n=n.parentNode;var r=t();r>=0&&r<this._suggestionsData.length&&this._currentFocusedIndex!==r&&this._isSuggestionSelectable(this._suggestionsData.getAt(r))&&(this._currentFocusedIndex=r,this._selectSuggestionAtIndex(r),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),e.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var e=d.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",e.execute()}},_inputBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)||(this._element.classList.remove(b.asbInputFocus),this._hideFlyout()),this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_inputFocusHandler:function(e){this._inputElement.value!==this._prevQueryText&&i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):null),e.target!==this._inputElement||this._internalFocusMove||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),this._internalFocusMove=!1,this._element.classList.add(b.asbInputFocus)},_inputOrImeChangeHandler:function(){function e(e){var i=!1;return(t._prevLinguisticDetails.queryTextCompositionStart!==e.queryTextCompositionStart||t._prevLinguisticDetails.queryTextCompositionLength!==e.queryTextCompositionLength||t._prevLinguisticDetails.queryTextAlternatives.length!==e.queryTextAlternatives.length)&&(i=!0),t._prevLinguisticDetails=e,i}var t=this;if(!this._shouldIgnoreInput()){var n=this._getLinguisticDetails(!1,!0),e=e(n);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||n.queryTextCompositionLength>0)&&(this._prevCompositionStart=n.queryTextCompositionStart,this._prevCompositionLength=n.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!e)return;this._prevQueryText=this._inputElement.value,i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag),i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):null),this._fireEvent(C.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:n}),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,n)}},_inputPointerDownHandler:function(){t.document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_keyDownHandler:function(e){function t(t){i._currentFocusedIndex=t,i._selectSuggestionAtIndex(t),e.preventDefault(),e.stopPropagation()}var i=this;if(this._lastKeyPressLanguage=e.locale,e.keyCode===y.tab?this._isProcessingTabKey=!0:e.keyCode===y.upArrow?this._isProcessingUpKey=!0:e.keyCode===y.downArrow?this._isProcessingDownKey=!0:e.keyCode===y.enter&&"ko"===e.locale&&(this._isProcessingEnterKey=!0),e.keyCode!==y.IME)if(e.keyCode===y.tab){var n=!0;e.shiftKey?-1!==this._currentFocusedIndex&&(t(-1),n=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._flyoutBelowInput?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!==this._currentFocusedIndex&&(t(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),n=!1)),n&&this._hideFlyout()}else if(e.keyCode===y.escape)-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,t(-1)):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),e.preventDefault(),e.stopPropagation());else if(e.keyCode===y.upArrow){var r;-1!==this._currentSelectedIndex?(r=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===r&&(this.queryText=this._prevQueryText)):r=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),t(r),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else if(e.keyCode===y.downArrow){var s=this._findNextSuggestionElementIndex(this._currentSelectedIndex);-1!==this._currentSelectedIndex&&-1===s&&(this.queryText=this._prevQueryText),t(s),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else e.keyCode===y.enter&&(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,e):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),e),this._hideFlyout())},_keyUpHandler:function(e){e.keyCode===y.tab?this._isProcessingTabKey=!1:e.keyCode===y.upArrow?this._isProcessingUpKey=!1:e.keyCode===y.downArrow?this._isProcessingDownKey=!1:e.keyCode===y.enter&&(this._isProcessingEnterKey=!1)},_keyPressHandler:function(e){this._lastKeyPressLanguage=e.locale},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var e=d.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",e.execute()}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_suggestionsChangedHandler:function(i){var n=i.collectionChange||i.detail.collectionChange,r=+i.index===i.index?i.index:i.detail.index,s=p._CollectionChange;if(n===s.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(n===s.itemInserted){var o=this._suggestions[r];this._suggestionsData.splice(r,0,o),this._showFlyout()}else if(n===s.itemRemoved)1===this._suggestionsData.length&&(c._setActive(this._inputElement),this._hideFlyout()),this._suggestionsData.splice(r,1);else if(n===s.itemChanged){var o=this._suggestions[r];if(o!==this._suggestionsData.getAt(r))this._suggestionsData.setAt(r,o);else{var a=this._repeater.elementFromIndex(r);if(c.hasClass(a,b.asbSuggestionQuery))e(a,o,o.text);else{var l=a.querySelector("."+b.asbSuggestionResultText);if(l){e(l,o,o.text);var u=a.querySelector("."+b.asbSuggestionResultDetailedText);u&&e(u,o,o.detailText)}}}}t.document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(e){i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag);var t,n=e.request||e.detail.request;this._fireEvent(C.suggestionsrequested,{setPromise:function(e){t=n.getDeferral(),e.then(function(){t.complete()})},searchSuggestionCollection:n.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})}},{createResultSuggestionImage:function(e){return i.Windows.Foundation.Uri&&i.Windows.Storage.Streams.RandomAccessStreamReference?i.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new i.Windows.Foundation.Uri(e)):e},_EventNames:C,_sortAndMergeHits:function(e){function t(e,t){var i=0;return e.startPosition<t.startPosition?i=-1:e.startPosition>t.startPosition&&(i=1),i}function i(e,t,i){if(0===i)e.push(t);else{var n=e[e.length-1],r=n.startPosition+n.length;if(t.startPosition<=r){var s=t.startPosition+t.length;s>r&&(n.length=s-n.startPosition)}else e.push(t)}return e}var n=[];if(e){for(var r=new Array(e.length),s=0;s<e.length;s++)r.push({startPosition:e[s].startPosition,length:e[s].length});r.sort(t),r.reduce(i,n)}return n}});return n.Class.mix(I,a.DOMEventMixin),I})})}),define("WinJS/Controls/SearchBox",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","./AutoSuggestBox","../Utilities/_Control","../Utilities/_ElementUtilities","./AutoSuggestBox/_SearchSuggestionManagerShim","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c){"use strict";i.Namespace.define("WinJS.UI",{SearchBox:i.Namespace._lazy(function(){var n={searchBox:"win-searchbox",searchBoxInput:"win-searchbox-input",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxButtonInputFocus:"win-searchbox-button-input-focus"},r={receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},u={get invalidSearchBoxSuggestionKind(){return"Error: Invalid search suggestion kind."},get ariaLabel(){return s._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return s._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return s._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value}},d=i.Class.derive(o.AutoSuggestBox,function(e,t){o.AutoSuggestBox.call(this,e,t),this._buttonElement=null,this._focusOnKeyboardInput=!1,this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._keydownCaptureHandlerBind=this._keydownCaptureHandler.bind(this),this._frameLoadCaptureHandlerBind=this._frameLoadCaptureHandler.bind(this),this._setupSearchBoxDOM()},{focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(t){this._focusOnKeyboardInput&&!t?this._suggestionManager instanceof c._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(e.top,!1):this._suggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&t&&(this._suggestionManager instanceof c._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(e.top,!0):this._suggestionManager.addEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind)),this._focusOnKeyboardInput=!!t}},dispose:function(){this._disposed||(o.AutoSuggestBox.prototype.dispose.call(this),this._focusOnKeyboardInput&&(this._suggestionManager instanceof c._SearchSuggestionManagerShim?this._updateKeydownCaptureListeners(e.top,!1):this._suggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind)))},_setupSearchBoxDOM:function(){this.element.classList.add(n.searchBox),this._flyoutElement.classList.add(n.searchBoxFlyout),this._inputElement.classList.add(n.searchBoxInput),this._inputElement.addEventListener("blur",this._searchboxInputBlurHandler.bind(this)),this._inputElement.addEventListener("focus",this._searchboxInputFocusHandler.bind(this)),this._buttonElement=e.document.createElement("div"),this._buttonElement.tabIndex=-1,this._buttonElement.classList.add(n.searchBoxButton),this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),this.element.appendChild(this._buttonElement)},_disableControl:function(){o.AutoSuggestBox.prototype._disableControl.call(this),this._buttonElement.disabled=!0},_enableControl:function(){o.AutoSuggestBox.prototype._enableControl.call(this),this._buttonElement.disabled=!1},_renderSuggestion:function(e){var t=o.AutoSuggestBox.prototype._renderSuggestion.call(this,e);return t.classList.add(e.kind===c._SearchSuggestionKind.Query?n.searchBoxSuggestionQuery:e.kind===c._SearchSuggestionKind.Separator?n.searchBoxSuggestionSeparator:n.searchBoxSuggestionResult),t},_shouldIgnoreInput:function(){var e=o.AutoSuggestBox.prototype._shouldIgnoreInput(),t=l._matchesSelector(this._buttonElement,":active");return e||t},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?s._formatString(u.ariaLabelInputPlaceHolder,this._inputElement.placeholder):u.ariaLabelInputNoPlaceHolder)},_buttonClickHandler:function(e){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,e),this._hideFlyout()},_searchboxInputBlurHandler:function(){l.removeClass(this._buttonElement,n.searchBoxButtonInputFocus)},_searchboxInputFocusHandler:function(){l.addClass(this._buttonElement,n.searchBoxButtonInputFocus)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(r.receivingfocusonkeyboardinput,null),e.document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(t){}},_keydownCaptureHandler:function(e){this._focusOnKeyboardInput&&this._shouldKeyTriggerTypeToSearch(e)&&this._requestingFocusOnKeyboardInputHandler(e)},_frameLoadCaptureHandler:function(e){this._focusOnKeyboardInput&&this._updateKeydownCaptureListeners(e.target.contentWindow,!0)},_updateKeydownCaptureListeners:function(e,t){try{t?e.document.addEventListener("keydown",this._keydownCaptureHandlerBind,!0):e.document.removeEventListener("keydown",this._keydownCaptureHandlerBind,!0)}catch(i){}if(e.frames)for(var n=0,r=e.frames.length;r>n;n++){var s=e.frames[n];this._updateKeydownCaptureListeners(s,t);try{t?s.frameElement&&s.frameElement.addEventListener("load",this._frameLoadCaptureHandlerBind,!0):s.frameElement&&s.frameElement.removeEventListener("load",this._frameLoadCaptureHandlerBind,!0)}catch(i){}}},_shouldKeyTriggerTypeToSearch:function(e){var t=!1;if(!e.metaKey&&(!e.ctrlKey&&!e.altKey||e.getModifierState&&e.getModifierState("AltGraph")))switch(e.keyCode){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 186:case 187:case 188:case 189:case 190:case 191:case 192:case 219:case 220:case 221:case 222:case 223:case 226:case 229:case 231:t=!0}return t}},{createResultSuggestionImage:function(e){return t.Windows.Foundation.Uri&&t.Windows.Storage.Streams.RandomAccessStreamReference?t.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new t.Windows.Foundation.Uri(e)):e},_getKeyModifiers:function(e){var t={ctrlKey:1,altKey:2,shiftKey:4},i=0;return e.ctrlKey&&(i|=t.ctrlKey),e.altKey&&(i|=t.altKey),e.shiftKey&&(i|=t.shiftKey),i},_isTypeToSearchKey:function(e){return e.shiftKey||e.ctrlKey||e.altKey?!1:!0}});return i.Class.mix(d,a.DOMEventMixin),d})})}),define("WinJS/Controls/SettingsFlyout",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Pages","../Promise","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./AppBar/_Constants","./Flyout/_Overlay","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p){"use strict";i.Namespace.define("WinJS.UI",{SettingsFlyout:i.Namespace._lazy(function(){function n(){if(t.Windows.UI.ApplicationSettings.SettingsEdgeLocation){var e=t.Windows.UI.ApplicationSettings;return e.SettingsPane.edge===e.SettingsEdgeLocation.left}return!1}function _(e,t){for(var i,n,r=e.querySelectorAll("."+m.settingsFlyoutClass),s=0;s<r.length;s++)if(n=r[s].winControl){if(n.settingsCommandId===t){i=n;break}r[s].id===t&&(i=i||n)}return i}var f,g=d.Key,v="narrow",y="wide",b=i.Class.derive(p._Overlay,function(t,i){this._element=t||e.document.createElement("div"),this._id=this._element.id||d._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,i),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),p._Overlay._createClickEatingDivAppBar(),this._element.style.visibilty="hidden",this._element.style.display="none",d.addClass(this._element,m.settingsFlyoutClass),h.query("div.win-content",this._element).forEach(function(e){d._matchesSelector(e,".win-ui-dark, .win-ui-dark *")||d.addClass(e,m.flyoutLightClass)});var n=this._element.getAttribute("role");(null===n||""===n||void 0===n)&&this._element.setAttribute("role","dialog");var r=this._element.getAttribute("aria-label");(null===r||""===r||void 0===r)&&this._element.setAttribute("aria-label",w.ariaLabel),this._handleOverlayEventsForFlyoutOrSettingsFlyout(),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(e){d._deprecated(w.widthDeprecationMessage),e!==this._width&&(this._width===v?d.removeClass(this._element,m.narrowClass):this._width===y&&d.removeClass(this._element,m.wideClass),this._width=e,this._width===v?d.addClass(this._element,m.narrowClass):this._width===y&&d.addClass(this._element,m.wideClass))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(e){this._settingsCommandId=e}},show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){u.disposeSubTree(this.element),this._dismiss()},_show:function(){this._baseShow(),p._Overlay._showClickEatingDivAppBar()},_endShow:function(){this._initAfterAnimation()},_initAfterAnimation:function(){if(f=0,!d.hasClass(this.element.children[0],m.firstDivClass)){var e=this.element.querySelectorAll(".win-first");e&&e.length>0&&e.item(0).parentNode.removeChild(e.item(0)),this._addFirstDiv()}if(this.element.children[0]&&(d._addEventListener(this.element.children[0],"focusout",function(){f=1},!1),this.element.children[0].focus()),!d.hasClass(this.element.children[this.element.children.length-1],m.finalDivClass)){var t=this.element.querySelectorAll(".win-final");t&&t.length>0&&t.item(0).parentNode.removeChild(t.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel()},_setBackButtonsAriaLabel:function(){for(var e,t=this.element.querySelectorAll(".win-backbutton"),i=0;i<t.length;i++)e=t[i].getAttribute("aria-label"),(null===e||""===e||void 0===e)&&t[i].setAttribute("aria-label",w.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()&&p._Overlay._hideClickEatingDivAppBar()},_animateSlideIn:function(){var e=n(),t=e?"-100px":"100px";h.query("div.win-content",this._element).forEach(function(e){a.enterPage(e,{left:t})});var i,r=this._element.offsetWidth;return e?(i={top:"0px",left:"-"+r+"px"},this._element.style.right="auto",this._element.style.left="0px"):(i={top:"0px",left:r+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",a.showPanel(this._element,i)
},_animateSlideOut:function(){var e,t=this._element.offsetWidth;return n()?(e={top:"0px",left:t+"px"},this._element.style.right="auto",this._element.style.left="-"+t+"px"):(e={top:"0px",left:"-"+t+"px"},this._element.style.right="-"+t+"px",this._element.style.left="auto"),a.showPanel(this._element,e)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(e){this._fragDiv=e}},_unloadPage:function(t){var i=t.currentTarget.winControl;i.removeEventListener(p._Overlay.afterHide,this._unloadPage,!1),c.as().then(function(){i._fragmentDiv&&(e.document.body.removeChild(i._fragmentDiv),i._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(p._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(t){if(t.keyCode===g.escape)t.preventDefault(),t.stopPropagation(),this.winControl._dismiss();else if(t.keyCode!==g.space&&t.keyCode!==g.enter||this.children[0]!==e.document.activeElement){if(t.shiftKey&&t.keyCode===g.tab&&this.children[0]===e.document.activeElement){t.preventDefault(),t.stopPropagation();for(var i=this.getElementsByTagName("*"),n=i.length-2;n>=0&&(i[n].focus(),i[n]!==e.document.activeElement);n--);}}else t.preventDefault(),t.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var t=e.document.activeElement;if(f&&t&&d.hasClass(t,m.firstDivClass)){var i=this.parentElement.getElementsByTagName("*");if(!(i.length<=2)){var n,r=i[i.length-1].tabIndex;if(r){for(n=i.length-2;n>0;n--)if(i[n].tabIndex===r){i[n].focus();break}}else for(n=i.length-2;n>0&&("DIV"===i[n].tagName&&null===i[n].getAttribute("tabIndex")||(i[n].focus(),i[n]!==e.document.activeElement));n--);}}},_focusOnFirstFocusableElementFromParent:function(){var t=e.document.activeElement;if(t&&d.hasClass(t,m.finalDivClass)){var i=this.parentElement.getElementsByTagName("*");if(!(i.length<=2)){var n,r=i[0].tabIndex;if(r){for(n=1;n<i.length-1;n++)if(i[n].tabIndex===r){i[n].focus();break}}else for(n=1;n<i.length-1&&("DIV"===i[n].tagName&&null===i[n].getAttribute("tabIndex")||(i[n].focus(),i[n]!==e.document.activeElement));n++);}}},_addFirstDiv:function(){for(var t=this._element.getElementsByTagName("*"),i=0,n=0;n<t.length;n++)0<t[n].tabIndex&&(0===i||t[n].tabIndex<i)&&(i=t[n].tabIndex);var r=e.document.createElement("div");r.className=m.firstDivClass,r.style.display="inline",r.setAttribute("role","menuitem"),r.setAttribute("aria-hidden","true"),r.tabIndex=i,d._addEventListener(r,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(r,this._element.children[0]):this._element.appendChild(r)},_addFinalDiv:function(){for(var t=this._element.getElementsByTagName("*"),i=0,n=0;n<t.length;n++)t[n].tabIndex>i&&(i=t[n].tabIndex);var r=e.document.createElement("div");r.className=m.finalDivClass,r.style.display="inline",r.setAttribute("role","menuitem"),r.setAttribute("aria-hidden","true"),r.tabIndex=i,d._addEventListener(r,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(r)},_writeProfilerMark:function(e){o("WinJS.UI.SettingsFlyout:"+this._id+":"+e)}});b.show=function(){t.Windows.UI.ApplicationSettings.SettingsPane&&t.Windows.UI.ApplicationSettings.SettingsPane.show();for(var i=e.document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),n=i.length,r=0;n>r;r++){var s=i[r].winControl;s&&s._dismiss()}};var C={event:void 0};b.populateSettings=function(e){if(C.event=e.detail,C.event.applicationcommands){var i=t.Windows.UI.ApplicationSettings;Object.keys(C.event.applicationcommands).forEach(function(e){var t=C.event.applicationcommands[e];t.title||(t.title=e);var n=new i.SettingsCommand(e,t.title,b._onSettingsCommand);C.event.e.request.applicationCommands.append(n)})}},b._onSettingsCommand=function(e){var t=e.id;C.event.applicationcommands&&C.event.applicationcommands[t]&&b.showSettings(t,C.event.applicationcommands[t].href)},b.showSettings=function(t,i){var n=_(e.document,t);if(n)n.show();else{if(!i)throw new r("WinJS.UI.SettingsFlyout.BadReference",w.badReference);var s=e.document.createElement("div");s=e.document.body.appendChild(s),l.render(i,s).then(function(){n=_(s,t),n?(n._fragmentDiv=s,n.show()):e.document.body.removeChild(s)})}};var w={get ariaLabel(){return s._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return"Invalid argument: Invalid href to settings flyout fragment"},get backbuttonAriaLabel(){return s._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return"SettingsFlyout.width may be altered or unavailable in future versions. Instead, style the CSS width property on elements with the .win-settingsflyout class."}};return b})})}),define("WinJS/Controls/NavBar/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Navigation","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Icon"],function(e,t,i,n,r,s,o,a,l,c){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_WinPressed:i.Namespace._lazy(function(){var e=i.Class.define(function(e){this._element=e,l._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(i){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),i.isPrimary&&(this._pointerId&&this._resetPointer(),l._matchesSelector(i.target,".win-interactive, .win-interactive *")||(this._pointerId=i.pointerId,l._addEventListener(t,"pointerup",this._pointerUpBound,!0),l._addEventListener(t,"pointercancel",this._pointerCancelBound),!0,l._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),l._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),l.addClass(this._element,e.winPressed)))},_MSPointerOverHandler:function(t){this._pointerId===t.pointerId&&l.addClass(this._element,e.winPressed)},_MSPointerOutHandler:function(t){this._pointerId===t.pointerId&&l.removeClass(this._element,e.winPressed)},_MSPointerCancelHandler:function(e){this._pointerId===e.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(e){this._pointerId===e.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,l._removeEventListener(t,"pointerup",this._pointerUpBound,!0),l._removeEventListener(t,"pointercancel",this._pointerCancelBound,!0),l._removeEventListener(this._element,"pointerover",this._pointerOverBound,!0),l._removeEventListener(this._element,"pointerout",this._pointerOutBound,!0),l.removeClass(this._element,e.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return e}),NavBarCommand:i.Namespace._lazy(function(){var r=l.Key,u={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},d=i.Class.define(function(e,i){if(e=e||t.document.createElement("DIV"),i=i||{},e.winControl)throw new n("WinJS.UI.NavBarCommand.DuplicateConstruction",u.duplicateConstruction);e.winControl=this,this._element=e,l.addClass(this.element,d._ClassName.navbarcommand),l.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),e.addEventListener("keydown",this._keydownHandler.bind(this)),a.setOptions(this,i)},{element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(e){this._label=e,this._labelEl.textContent=e}},tooltip:{get:function(){return this._tooltip},set:function(e){this._tooltip=e,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(e){this._icon=c[e]||e,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},location:{get:function(){return this._location},set:function(e){this._location=e}},state:{get:function(){return this._state},set:function(e){this._state=e}},splitButton:{get:function(){return this._split},set:function(e){this._split=e,this._splitButtonEl.style.display=this._split?"":"none"}},splitOpened:{get:function(){return this._splitOpened},set:function(e){this._splitOpened!==!!e&&this._toggleSplit()}},_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(l.addClass(this._splitButtonEl,d._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","true")):(l.removeClass(this._splitButtonEl,d._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(d._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===t.getComputedStyle(this.element).direction}},_keydownHandler:function(e){if(!l._matchesSelector(e.target,".win-interactive, .win-interactive *")){var t=this._rtl?r.rightArrow:r.leftArrow,i=this._rtl?r.leftArrow:r.rightArrow;e.altKey||e.keyCode!==t&&e.keyCode!==r.home&&e.keyCode!==r.end||e.target!==this._splitButtonEl?e.altKey||e.keyCode!==i||!this.splitButton||e.target!==this._buttonEl&&!this._buttonEl.contains(e.target)?e.keyCode!==r.space&&e.keyCode!==r.enter||e.target!==this._buttonEl&&!this._buttonEl.contains(e.target)?e.keyCode!==r.space&&e.keyCode!==r.enter||e.target!==this._splitButtonEl||this._toggleSplit():(this.location&&o.navigate(this.location,this.state),this._fireEvent(d._EventName._invoked)):(l._setActive(this._splitButtonEl),e.keyCode===i&&e.stopPropagation(),e.preventDefault()):(l._setActive(this._buttonEl),e.keyCode===t&&e.stopPropagation(),e.preventDefault())}},_getFocusInto:function(e){var t=this._rtl?r.rightArrow:r.leftArrow;return e===t&&this.splitButton?this._splitButtonEl:this._buttonEl},_buildDom:function(){var t='<div tabindex="0" role="button" class="'+d._ClassName.navbarcommandbutton+'"><div class="'+d._ClassName.navbarcommandbuttoncontent+'"><div class="'+d._ClassName.navbarcommandicon+'"></div><div class="'+d._ClassName.navbarcommandlabel+'"></div></div></div><div tabindex="-1" aria-expanded="false" class="'+d._ClassName.navbarcommandsplitbutton+'"></div>';this.element.insertAdjacentHTML("afterBegin",t),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new e._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new e._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",l._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this));var i=new l._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));i.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this));for(var n=this._splitButtonEl.nextSibling;n;)this._buttonEl.insertBefore(n,this._contentEl),"#text"!==n.nodeName&&s.processAll(n),n=this._splitButtonEl.nextSibling},_handleButtonClick:function(e){var t=e.target;l._matchesSelector(t,".win-interactive, .win-interactive *")||(this.location&&o.navigate(this.location,this.state),this._fireEvent(d._EventName._invoked))},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!1,i),this.element.dispatchEvent(n)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:{navbarcommand:"win-navbarcommand",navbarcommandbutton:"win-navbarcommand-button",navbarcommandbuttoncontent:"win-navbarcommand-button-content",navbarcommandsplitbutton:"win-navbarcommand-splitbutton",navbarcommandsplitbuttonopened:"win-navbarcommand-splitbutton-opened",navbarcommandicon:"win-navbarcommand-icon",navbarcommandlabel:"win-navbarcommand-label"},_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return i.Class.mix(d,a.DOMEventMixin),d})})}),define("WinJS/Controls/NavBar/_Container",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../AppBar/_Constants","../Repeater","./_Command"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m,p,f,g,v,y,b,C,w){"use strict";function I(){return null===t.document.activeElement||t.document.activeElement===t.document.body}i.Namespace._moduleDefine(e,"WinJS.UI",{NavBarContainer:i.Namespace._lazy(function(){var e=g.Key,S=3e3,E=g._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",x=0,k=s._createEventProperty,P={invoked:"invoked",splittoggle:"splittoggle"},T={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarContainerViewportAriaLabel(){return a._getWinJSString("ui/navBarContainerViewportAriaLabel").value}},A=i.Class.define(function(e,i){if(e=e||t.document.createElement("DIV"),this._id=e.id||g._uniqueID(e),this._writeProfilerMark("constructor,StartTM"),i=i||{},e.winControl)throw new r("WinJS.UI.NavBarContainer.DuplicateConstruction",T.duplicateConstruction);e.winControl=this,this._element=e,g.addClass(this.element,A._ClassName.navbarcontainer),g.addClass(this.element,"win-disposable"),e.getAttribute("tabIndex")||(e.tabIndex=-1),this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this),this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this),this._currentManipulationState=x,this._panningDisabled=!1,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),_.addEventListener("navigated",this._closeSplitAndResetBound),this.layout=i.layout||y.Orientation.horizontal,i.maxRows&&(this.maxRows=i.maxRows),i.template&&(this.template=i.template),i.data&&(this.data=i.data),i.fixedSize&&(this.fixedSize=i.fixedSize),f._setOptions(this,i,!0),this._duringConstructor=!1,i.currentIndex&&(this.currentIndex=i.currentIndex);var n=this,s=!1;g._detectSnapPointsSupport().then(function(e){n._panningDisabled=!e,n._disposed||(n._updatePageUI(),s=!0)}),s||this._updatePageUI(),p.schedule(function(){this._updateAppBarReference()},p.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize"),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(e){if(this._template=e,this._repeater){var i=this.element.contains(t.document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}}},_render:function(e){var i=t.document.createElement("div"),n=this._template;n&&(n.render?n.render(e,i):n.winControl&&n.winControl.render?n.winControl.render(e,i):i.appendChild(n(e)));var r=new w.NavBarCommand(i,e);return r._element},data:{get:function(){return this._repeater&&this._repeater.data},set:function(e){e||(e=new d.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var i=this.element.contains(t.document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new C.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(e),this._repeater.data=e,this._addDataChangedEvents(e),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(e){e=+e===e?e:1,this._maxRows=Math.max(1,e),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(e){e===y.Orientation.vertical?(this._layout=y.Orientation.vertical,g.removeClass(this.element,A._ClassName.horizontal),g.addClass(this.element,A._ClassName.vertical)):(this._layout=y.Orientation.horizontal,g.removeClass(this.element,A._ClassName.vertical),g.addClass(this.element,A._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(e){if(e===+e){var i=this.element.contains(t.document.activeElement);this._keyboardBehavior.currentIndex=e,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),i&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(e){this._fixedSize=!!e,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:k(P.invoked),onsplittoggle:k(P.splittoggle),forceLayout:function(){this._resizeHandler(),this._measured&&(this._scrollPosition=g.getScrollPosition(this._viewportEl)[this.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"]),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._appBarEl.removeEventListener("aftershow",this._focusCurrentItemPassivelyBound));for(var e=this.element.parentNode;e&&!g.hasClass(e,b.appBarClass);)e=e.parentNode;this._appBarEl=e,this._appBarEl&&(this._appBarEl.addEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.addEventListener("aftershow",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(e){this._elementHadFocus=t.document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===e.type?this._surfaceEl.children[e.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===e.type?this._surfaceEl.children[e.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===e.type?this._surfaceEl.children[e.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===e.type&&this._closeSplitIfOpen())},_dataChanged:function(e){this._measured=!1,"itemremoved"===e.type?e.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:e.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===e.type?e.detail.index===this._keyboardBehavior.currentIndex&&I()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===e.type?e.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===e.type?e.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=e.detail.newIndex,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===e.type&&(this._keyboardBehavior.currentIndex=0,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(e){e.addEventListener("itemchanged",this._dataChangingBound),e.addEventListener("iteminserted",this._dataChangingBound),e.addEventListener("itemmoved",this._dataChangingBound),e.addEventListener("itemremoved",this._dataChangingBound),e.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(e){e.pointerType===E&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(e){e.pointerType!==E&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=m.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),g._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),g._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),g._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=t.document.createElement("div"),g.addClass(this._pageindicatorsEl,A._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=t.document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=t.document.createElement("div"),g.addClass(this._viewportEl,A._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",T.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),g._resizeNotifier.subscribe(this._element,this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=t.document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=t.document.createElement("div"),g.addClass(this._surfaceEl,A._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener("_invoked",this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener("_splittoggle",this._navbarCommandSplitToggleHandler.bind(this)),g._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var e=this.element.firstElementChild;e!==this._pageindicatorsEl;)this._surfaceEl.appendChild(e),h.process(e),e=this.element.firstElementChild;this._leftArrowEl=t.document.createElement("div"),g.addClass(this._leftArrowEl,A._ClassName.navleftarrow),g.addClass(this._leftArrowEl,A._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=m.wrap(),this._rightArrowEl=t.document.createElement("div"),g.addClass(this._rightArrowEl,A._ClassName.navrightarrow),g.addClass(this._rightArrowEl,A._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=m.wrap(),this._keyboardBehavior=new v._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl}),this._winKeyboard=new v._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var e=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.min(Math.floor(this._keyboardBehavior.currentIndex/e)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(e*t,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var e=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/e)-1);this._keyboardBehavior.currentIndex=Math.max(e*t,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===y.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var e=this.layout===y.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(t.getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(t.getComputedStyle(this._viewportEl).height);e&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&this._appBarEl.winControl.hidden?(p.schedule(this._resizeImplBound,p.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeshow",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(i){var n=i.keyCode;if(!i.altKey&&(n===e.pageUp||n===e.pageDown)){var r=i.target;if(g._matchesSelector(r,".win-interactive, .win-interactive *"))return;var s=this._keyboardBehavior.currentIndex;this._measure();var o=this._sizes,a=Math.floor(s/(o.columnsPerPage*o.rowsPerPage)),l=null;if(n===e.pageUp){if(this.layout===y.Orientation.horizontal){var c=a*o.columnsPerPage*o.rowsPerPage;s===c&&this._surfaceEl.children[s].winControl._buttonEl===t.document.activeElement?s-=o.columnsPerPage*o.rowsPerPage:s=c}else{var u=this._surfaceEl.children[s],d=u.offsetTop,h=d+u.offsetHeight,_=this._zooming?this._zoomPosition:this._scrollPosition;if(d>=_&&h<_+o.viewportOffsetHeight)for(;s>0&&this._surfaceEl.children[s-1].offsetTop>_;)s--;if(this._keyboardBehavior.currentIndex===s){var m=h-o.viewportOffsetHeight;for(s=Math.max(0,s-1);s>0&&this._surfaceEl.children[s-1].offsetTop>m;)s--;l=s>0?this._surfaceEl.children[s].offsetTop-this._sizes.itemMarginTop:0}}s=Math.max(s,0),this._keyboardBehavior.currentIndex=s;var p=this._surfaceEl.children[s].winControl._buttonEl;null!==l&&this._scrollTo(l),g._setActive(p,this._viewportEl)}else{if(this.layout===y.Orientation.horizontal){var f=(a+1)*o.columnsPerPage*o.rowsPerPage-1;s===f?s+=o.columnsPerPage*o.rowsPerPage:s=f}else{var u=this._surfaceEl.children[this._keyboardBehavior.currentIndex],d=u.offsetTop,h=d+u.offsetHeight,_=this._zooming?this._zoomPosition:this._scrollPosition;if(d>=_&&h<_+o.viewportOffsetHeight)for(;s<this._surfaceEl.children.length-1&&this._surfaceEl.children[s+1].offsetTop+this._surfaceEl.children[s+1].offsetHeight<_+o.viewportOffsetHeight;)s++;if(s===this._keyboardBehavior.currentIndex){var v=d+o.viewportOffsetHeight;for(s=Math.min(this._surfaceEl.children.length-1,s+1);s<this._surfaceEl.children.length-1&&this._surfaceEl.children[s+1].offsetTop+this._surfaceEl.children[s+1].offsetHeight<v;)s++;l=s<this._surfaceEl.children.length-1?this._surfaceEl.children[s+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}s=Math.min(s,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=s;var p=this._surfaceEl.children[s].winControl._buttonEl;null!==l&&this._scrollTo(l);try{g._setActive(p,this._viewportEl)}catch(b){}}}},_focusHandler:function(e){var t=e.target;this._surfaceEl.contains(t)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(e){var t=e.target;if(t!==this._surfaceEl){for(;t.parentNode!==this._surfaceEl;)t=t.parentNode;for(var i=-1;t;)i++,t=t.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(i)}},_ensureVisible:function(e,t){if(this._measure(),this.layout===y.Orientation.horizontal){var i=Math.floor(e/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(i*this._sizes.viewportOffsetWidth,t)}else{var n,r=this._surfaceEl.children[e];n=e>0?r.offsetTop-this._sizes.itemMarginTop:0;var s;s=e<this._surfaceEl.children.length-1?this._surfaceEl.children[e+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var o=this._zooming?this._zoomPosition:this._scrollPosition;o=Math.max(o,s),o=Math.min(o,n),this._scrollTo(o,t)}},_scrollTo:function(e,t){if(this._measure(),e=this.layout===y.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,e)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,e)),t){if(Math.abs(this._scrollPosition-e)>1){this._zooming=!1,this._scrollPosition=e,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen();var i={};i[this.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"]=e,g.setScrollPosition(this._viewportEl,i)
}}else(!this._zooming&&Math.abs(this._scrollPosition-e)>1||this._zooming&&Math.abs(this._zoomPosition-e)>1)&&(this._zoomPosition=e,this._zooming=!0,this.layout===y.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",g._zoomTo(this._viewportEl,{contentX:e,contentY:0,viewportX:0,viewportY:0})):g._zoomTo(this._viewportEl,{contentX:0,contentY:e,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(e){this._currentManipulationState=e.currentState,e.currentState===e.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),t.clearTimeout(this._manipulationStateTimeoutId),e.currentState===e.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=t.setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var e=this;this._checkingScroll=n._requestAnimationFrame(function(){if(!e._disposed){e._checkingScroll=null;var t=g.getScrollPosition(e._viewportEl)[e.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"];t!==e._scrollPosition&&(e._scrollPosition=t,e._closeSplitIfOpen()),e._updatePageUI(),e._zooming||e._currentManipulationState!==x||e._updateCurrentIndexIfPageChanged()}})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===y.Orientation.horizontal){this._measure();var e=this._currentPage,i=e*this._sizes.rowsPerPage*this._sizes.columnsPerPage,n=(e+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<i||this._keyboardBehavior.currentIndex>n)&&(this._keyboardBehavior.currentIndex=i,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var e=this._sizes;e.rtl="rtl"===t.getComputedStyle(this._element).direction;var i=this._surfaceEl.children.length;if(i>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var n=this._surfaceEl.firstElementChild;n.style.margin="",n.style.width="";var r=t.getComputedStyle(n);e.itemOffsetWidth=parseFloat(t.getComputedStyle(n).width),0===n.offsetWidth&&(e.itemOffsetWidth=0),e.itemMarginLeft=parseFloat(r.marginLeft),e.itemMarginRight=parseFloat(r.marginRight),e.itemWidth=e.itemOffsetWidth+e.itemMarginLeft+e.itemMarginRight,e.itemOffsetHeight=parseFloat(t.getComputedStyle(n).height),0===n.offsetHeight&&(e.itemOffsetHeight=0),e.itemMarginTop=parseFloat(r.marginTop),e.itemMarginBottom=parseFloat(r.marginBottom),e.itemHeight=e.itemOffsetHeight+e.itemMarginTop+e.itemMarginBottom,e.itemOffsetWidth>0&&e.itemOffsetHeight>0&&(e.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")}if(e.viewportOffsetWidth=parseFloat(t.getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(e.viewportOffsetWidth=0),e.viewportOffsetHeight=parseFloat(t.getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(e.viewportOffsetHeight=0),this._measured=0===e.viewportOffsetWidth||0===e.itemOffsetHeight?!1:!0,this.layout===y.Orientation.horizontal){this._scrollPosition=g.getScrollPosition(this._viewportEl).scrollLeft,e.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(t.getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(t.getComputedStyle(this._leftArrowEl).marginRight);var s=e.viewportOffsetWidth-2*e.leadingEdge;e.maxColumns=e.itemWidth?Math.max(1,Math.floor(s/e.itemWidth)):1,e.rowsPerPage=Math.min(this.maxRows,Math.ceil(i/e.maxColumns)),e.columnsPerPage=Math.min(e.maxColumns,i),e.pages=Math.ceil(i/(e.columnsPerPage*e.rowsPerPage)),e.trailingEdge=e.leadingEdge,e.extraSpace=s-e.columnsPerPage*e.itemWidth,this._scrollLength=e.viewportOffsetWidth*e.pages,this._keyboardBehavior.fixedSize=e.rowsPerPage,this._keyboardBehavior.fixedDirection=v._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=e.itemHeight*e.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,e.leadingEdge=0,e.rowsPerPage=i,e.columnsPerPage=1,e.pages=1,e.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=e.columnsPerPage,this._keyboardBehavior.fixedDirection=v._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else e.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var e=this._sizes,t=this._surfaceEl.children.length,i=0;t>i;i++){var n,r,s=this._surfaceEl.children[i],o="";if(this.layout===y.Orientation.horizontal){var a=Math.floor(i/e.rowsPerPage),l=a%e.columnsPerPage===0,c=a%e.columnsPerPage===e.columnsPerPage-1,u=e.trailingEdge;if(this.fixedSize)u+=e.extraSpace;else{var d=e.extraSpace-(e.maxColumns-e.columnsPerPage)*e.itemWidth;o=e.itemOffsetWidth+d/e.maxColumns+"px"}var h,_;e.rtl?(h=l?e.leadingEdge:0,_=c?u:0):(h=c?u:0,_=l?e.leadingEdge:0),n=h+e.itemMarginRight+"px",r=_+e.itemMarginLeft+"px"}else n="",r="";s.style.marginRight!==n&&(s.style.marginRight=n),s.style.marginLeft!==r&&(s.style.marginLeft=r),s.style.width!==o&&(s.style.width=o)}},_updatePageUI:function(){this._measure();var e=this._currentPage;this._hasPreviousContent=0!==e,this._hasNextContent=e<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+A._ClassName.indicator+'"></span>'));for(var t=0;t<this._pageindicatorsEl.children.length;t++)t===e?g.addClass(this._pageindicatorsEl.children[t],A._ClassName.currentindicator):g.removeClass(this._pageindicatorsEl.children[t],A._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX=this._panningDisabled?"hidden":"",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==y.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var i=e*this._sizes.rowsPerPage*this._sizes.columnsPerPage,n=this._surfaceEl.children[i].winControl._buttonEl;g._ensureId(n),this._ariaStartMarker.setAttribute("aria-flowto",n.id);var r=Math.min(this._surfaceEl.children.length-1,(e+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),s=this._surfaceEl.children[r].winControl._buttonEl;g._ensureId(s),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",s.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var e=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,t=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,i=this;(this._mouseInViewport||this._panningDisabled)&&e?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||c.fadeIn(this._leftArrowEl)):(e?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||m.timeout(u._animationTimeAdjustment(S)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=m.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||c.fadeOut(this._leftArrowEl).then(function(){i._leftArrowEl.style.visibility="hidden"})}.bind(this))),(this._mouseInViewport||this._panningDisabled)&&t?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||c.fadeIn(this._rightArrowEl)):(t?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||m.timeout(u._animationTimeAdjustment(S)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=m.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||c.fadeOut(this._rightArrowEl).then(function(){i._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(e){for(var t=e.target,i=-1;t;)i++,t=t.previousSibling;this._fireEvent(A._EventName.invoked,{index:i,navbarCommand:e.target.winControl,data:this._repeater?this._repeater.data.getAt(i):null})},_navbarCommandSplitToggleHandler:function(e){for(var t=e.target,i=-1;t;)i++,t=t.previousSibling;var n=e.target.winControl;this._closeSplitIfOpen(),n.splitOpened&&(this._currentSplitNavItem=n),this._fireEvent(A._EventName.splitToggle,{opened:n.splitOpened,index:i,navbarCommand:n,data:this._repeater?this._repeater.data.getAt(i):null})},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!1,i),this.element.dispatchEvent(n)},_writeProfilerMark:function(e){var t="WinJS.UI.NavBarContainer:"+this._id+":"+e;l(t),o.log&&o.log(t,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeshow",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound)),_.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),g._resizeNotifier.unsubscribe(this._element,this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:P.invoked,splitToggle:P.splittoggle}});return i.Class.mix(A,f.DOMEventMixin),A})})}),define("WinJS/Controls/NavBar",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./AppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u){"use strict";var d="custom";i.Namespace.define("WinJS.UI",{NavBar:i.Namespace._lazy(function(){var c="childrenprocessed",h=r._createEventProperty,_=i.Class.derive(u.AppBar,function(e,i){i=i||{},i=n._shallowCopy(i),i.placement=i.placement||"top",i.layout=d,u.AppBar.call(this,e,i),this._element.addEventListener("beforeshow",this._handleBeforeShow.bind(this)),l.addClass(this.element,_._ClassName.navbar),t.Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():a.schedule(this._processChildren.bind(this),a.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{layout:{get:function(){return d},set:function(){Object.getOwnPropertyDescriptor(u.AppBar.prototype,"layout").set.call(this,d)}},onchildrenprocessed:h(c),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var e=this,t=o.as();return this._processors&&this._processors.forEach(function(i){for(var n=0,r=e.element.children.length;r>n;n++)!function(e){t=t.then(function(){i(e)})}(e.element.children[n])}),t.then(function(){e._writeProfilerMark("processChildren,StopTM"),e._fireEvent(_._EventName.childrenProcessed)},function(){e._writeProfilerMark("processChildren,StopTM"),e._fireEvent(_._EventName.childrenProcessed)})}return o.wrap()},_show:function(){if(!this.disabled){var e=this;this._processChildren().then(function(){u.AppBar.prototype._show.call(e)})}},_handleBeforeShow:function(){if(!this._disposed)for(var e=this.element.querySelectorAll(".win-navbarcontainer"),t=0;t<e.length;t++)e[t].winControl.forceLayout()},_fireEvent:function(t,i){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!1,i||{}),this.element.dispatchEvent(n)},_writeProfilerMark:function(e){s("WinJS.UI.NavBar:"+this._id+":"+e)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:c},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){if(e._processed)for(var i=0,n=e.element.children.length;n>i;i++)t(e.element.children[i]);else e._processors=e._processors||[],e._processors.push(t)})});return _})})}),define("WinJS/Controls/ViewBox",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l){"use strict";t.Namespace.define("WinJS.UI",{ViewBox:t.Namespace._lazy(function(){function r(e){if(e&&!e._resizing){e._resizing=e._resizing||0,e._resizing++;try{e._updateLayout()}finally{e._resizing--}}}function c(e){e.target&&r(e.target.winControl)}function u(e){e.target&&r(e.target.parentElement.winControl)}var d={get invalidViewBoxChildren(){return"ViewBox expects to only have one child element"}},h=t.Class.define(function(t){this._disposed=!1,this._element=t||e.document.createElement("div");var i=this.element;i.winControl=this,l.addClass(i,"win-disposable"),l.addClass(i,"win-viewbox"),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===e.getComputedStyle(this.element).direction}},_initialize:function(){var e=this.element;if(e.firstElementChild!==this._sizer){if(i.validation&&1!==e.childElementCount)throw new n("WinJS.UI.ViewBox.InvalidChildren",d.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var t=e.firstElementChild;if(this._sizer=t,t&&(l._resizeNotifier.subscribe(e,c),e.addEventListener("mselementresize",c),l._resizeNotifier.subscribe(t,u),t.addEventListener("mselementresize",u)),0===e.clientWidth&&0===e.clientHeight){var r=this;s.schedule(function(){r._updateLayout()},s.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var e=this._sizer;if(e){var t=this.element,n=e.clientWidth,r=e.clientHeight,s=t.clientWidth,o=t.clientHeight,a=s/n,l=o/r,c=Math.min(a,l),u=Math.abs(s-n*c)/2,d=Math.abs(o-r*c)/2,h=this._rtl;this._sizer.style[i._browserStyleEquivalents.transform.scriptName]="translate("+(h?"-":"")+u+"px,"+d+"px) scale("+c+")",this._sizer.style[i._browserStyleEquivalents["transform-origin"].scriptName]=h?"top right":"top left"}},dispose:function(){this._disposed||(this.element&&l._resizeNotifier.unsubscribe(this.element,c),this._sizer&&l._resizeNotifier.unsubscribe(this._sizer,u),this._disposed=!0,a.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return t.Class.mix(h,o.DOMEventMixin),h})})}),define("WinJS/Controls/ContentDialog",["../Application","../Utilities/_Dispose","../Promise","../_Signal","../Core/_BaseUtils","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_Events","../Core/_ErrorFromName","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Animations","require-style!less/controls"],function(e,t,i,n,r,s,o,a,l,c,u,d,h,_,m){"use strict";a.Namespace.define("WinJS.UI",{ContentDialog:a.Namespace._lazy(function(){function u(e){for(;e;){if(h.hasClass(e,"win-flyout"))return!0;e=e.parentNode}return!1}function _(e){return i._cancelBlocker(e,function(){e.cancel()})}function p(e){e.ensuredFocusedElementInView=!0,this.dialog._renderForInputPane(e.occludedRect.height)}function f(){this.dialog._clearInputPaneRendering()}function g(){}function v(e,t){e._interruptibleWorkPromises=e._interruptibleWorkPromises||[];var i=new n;e._interruptibleWorkPromises.push(t(e,i.promise)),i.complete()}function y(){(this._interruptibleWorkPromises||[]).forEach(function(e){e.cancel()})}var b={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get controlDisposed(){return"Cannot interact with the control after it has been disposed"},get contentDialogAlreadyShowing(){return"Cannot show a ContentDialog if there is already a ContentDialog that is showing"}},C={none:"none",primary:"primary",secondary:"secondary"},w={contentDialog:"win-contentdialog",backgroundOverlay:"win-contentdialog-backgroundoverlay",dialog:"win-contentdialog-dialog",title:"win-contentdialog-title",content:"win-contentdialog-content",commands:"win-contentdialog-commands",primaryCommand:"win-contentdialog-primarycommand",secondaryCommand:"win-contentdialog-secondarycommand",_verticalAlignment:"win-contentdialog-verticalalignment",_scroller:"win-contentdialog-scroller",_column0or1:"win-contentdialog-column0or1",_visible:"win-contentdialog-visible",_tabStop:"win-contentdialog-tabstop",_commandSpacer:"win-contentdialog-commandspacer"},I={beforeShow:"beforeshow",afterShow:"aftershow",beforeHide:"beforehide",afterHide:"afterhide"},S=120,E=new(a.Class.define(function(){this._dialogs=[],this._prevFocus=null},{willShow:function(e){var t=this._dialogs.length;this._pruneDialogsMissingFromDom(),-1===this._dialogs.indexOf(e)&&this._dialogs.push(e),0===t&&1===this._dialogs.length&&this._firstDialogWillShow(e)},didHide:function(e){var t=this._dialogs.length;this._pruneDialogsMissingFromDom();var i=this._dialogs.indexOf(e);-1!==i&&this._dialogs.splice(i,1),t>0&&0===this._dialogs.length&&this._lastDialogDidHide()},aDialogIsShowing:function(){return this._dialogs.some(function(e){return!e.hidden})},_pruneDialogsMissingFromDom:function(){this._dialogs=this._dialogs.filter(function(e){return!s.document.body.contains(e.element)})},_firstDialogWillShow:function(){this._prevFocus=s.document.activeElement},_lastDialogDidHide:function(){var e=this._prevFocus;this._prevFocus=null,e&&e.focus()}})),x={Init:a.Class.define(null,{name:"Init",hidden:!0,enter:function(){this.dialog._dismissedSignal=new n,this.dialog._setState(x.Hidden,!1)},exit:g,show:function(){throw"It's illegal to call show on the Init state"},hide:g,onCommandClicked:g,onInputPaneShown:g,onInputPaneHidden:g}),Hidden:a.Class.define(null,{name:"Hidden",hidden:!0,enter:function(e){e?this.show():E.didHide(this.dialog)},exit:g,show:function(){if(E.aDialogIsShowing())return i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing));var e=this.dialog._dismissedSignal.promise;return this.dialog._setState(x.BeforeShow),e},hide:g,onCommandClicked:g,onInputPaneShown:g,onInputPaneHidden:g}),BeforeShow:a.Class.define(null,{name:"BeforeShow",hidden:!0,enter:function(){v(this,function(e,t){return t.then(function(){return e.dialog._fireBeforeShow()}).then(function(t){return t||e.dialog._cancelDismissalPromise(),t}).then(function(t){t?e.dialog._setState(x.Showing):e.dialog._setState(x.Hidden,!1)})})},exit:y,show:function(){return i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing))},hide:g,onCommandClicked:g,onInputPaneShown:g,onInputPaneHidden:g}),Showing:a.Class.define(null,{name:"Showing",hidden:{get:function(){return!!this._pendingHide}},enter:function(){v(this,function(e,t){return t.then(function(){if(e._pendingHide=null,h.addClass(e.dialog._dom.root,w._visible),e.dialog._addExternalListeners(),o.Windows.UI.ViewManagement.InputPane){var t=o.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height;t>0&&e.dialog._renderForInputPane(t)}return E.willShow(e.dialog),e.dialog._focusInitialElement(),e.dialog._playEntranceAnimation()}).then(function(){e.dialog._fireEvent(I.afterShow)}).then(function(){e.dialog._setState(x.Shown,e._pendingHide)})})},exit:y,show:function(){if(this._pendingHide){var e=this._pendingHide.reason;return this._pendingHide=null,this.dialog._resetDismissalPromise(e).promise}return i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing))},hide:function(e){this._pendingHide={reason:e}},onCommandClicked:g,onInputPaneShown:p,onInputPaneHidden:f}),Shown:a.Class.define(null,{name:"Shown",hidden:!1,enter:function(e){e&&this.hide(e.reason)},exit:g,show:function(){return i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing))},hide:function(e){this.dialog._setState(x.BeforeHide,e)},onCommandClicked:function(e){this.hide(e)},onInputPaneShown:p,onInputPaneHidden:f}),BeforeHide:a.Class.define(null,{name:"BeforeHide",hidden:!1,enter:function(e){v(this,function(t,i){return i.then(function(){return t.dialog._fireBeforeHide(e)}).then(function(i){i?t.dialog._setState(x.Hiding,e):t.dialog._setState(x.Shown,null)})})},exit:y,show:function(){return i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing))},hide:g,onCommandClicked:g,onInputPaneShown:p,onInputPaneHidden:f}),Hiding:a.Class.define(null,{name:"Hiding",hidden:{get:function(){return!this._showIsPending}},enter:function(e){v(this,function(t,i){return i.then(function(){t._showIsPending=!1,t.dialog._resetDismissalPromise(e)}).then(function(){return t.dialog._playExitAnimation()}).then(function(){t.dialog._removeExternalListeners(),h.removeClass(t.dialog._dom.root,w._visible),t.dialog._clearInputPaneRendering(),t.dialog._fireAfterHide(e)}).then(function(){t.dialog._setState(x.Hidden,t._showIsPending)})})},exit:y,show:function(){return this._showIsPending?i.wrapError(new c("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",b.contentDialogAlreadyShowing)):(this._showIsPending=!0,this.dialog._dismissedSignal.promise)},hide:function(e){this._showIsPending&&(this._showIsPending=!1,this.dialog._resetDismissalPromise(e))},onCommandClicked:g,onInputPaneShown:g,onInputPaneHidden:g}),Disposed:a.Class.define(null,{name:"Disposed",hidden:!0,enter:function(){E.didHide(this.dialog),this.dialog._removeExternalListeners(),this.dialog._dismissedSignal.error(new c("WinJS.UI.ContentDialog.ControlDisposed",b.controlDisposed))},exit:g,show:function(){return i.wrapError(new c("WinJS.UI.ContentDialog.ControlDisposed",b.controlDisposed))},hide:g,onCommandClicked:g,onInputPaneShown:g,onInputPaneHidden:g})},k=a.Class.define(function(e,t){if(e&&e.winControl)throw new c("WinJS.UI.ContentDialog.DuplicateConstruction",b.duplicateConstruction);t=t||{},this._onBackClickBound=this._onBackClick.bind(this),this._onInputPaneShownBound=this._onInputPaneShown.bind(this),this._onInputPaneHiddenBound=this._onInputPaneHidden.bind(this),this._onFocusInBound=this._onFocusIn.bind(this),this._onKeyDownBound=this._onKeyDown.bind(this),this._disposed=!1,this._resizedForInputPane=!1,this._currentFocus=null,this._initializeDom(e||s.document.createElement("div")),this._setState(x.Init),this.title="",this.primaryCommandText="",this.primaryCommandDisabled=!1,this.secondaryCommandText="",this.secondaryCommandDisabled=!1,d.setOptions(this,t)},{element:{get:function(){return this._dom.root}},title:{get:function(){return this._title},set:function(e){e=e||"",this._title!==e&&(this._title=e,this._dom.title.textContent=e,this._dom.title.style.display=e?"":"none")}},primaryCommandText:{get:function(){return this._primaryCommandText},set:function(e){e=e||"",this._primaryCommandText!==e&&(this._primaryCommandText=e,this._dom.commands[0].textContent=e,this._updateCommandsUI())}},secondaryCommandText:{get:function(){return this._secondaryCommandText},set:function(e){e=e||"",this._secondaryCommandText!==e&&(this._secondaryCommandText=e,this._dom.commands[1].textContent=e,this._updateCommandsUI())}},primaryCommandDisabled:{get:function(){return this._primaryCommandDisabled},set:function(e){e=!!e,this._primaryCommandDisabled!==e&&(this._primaryCommandDisabled=e,this._dom.commands[0].disabled=e)}},secondaryCommandDisabled:{get:function(){return this._secondaryCommandDisabled},set:function(e){e=!!e,this._secondaryCommandDisabled!==e&&(this._secondaryCommandDisabled=e,this._dom.commands[1].disabled=e)}},hidden:{get:function(){return this._state.hidden}},dispose:function(){this._disposed||(this._setState(x.Disposed),this._disposed=!0,t._disposeElement(this._dom.content))},show:function(){return this._state.show()},hide:function(e){this._state.hide(void 0===e?C.none:e)},_initializeDom:function(e){var t=s.document.createElement("div");t.className=w.content,h._reparentChildren(e,t),e.winControl=this,e.className=w.contentDialog+" "+w._verticalAlignment+" win-disposable",e.innerHTML='<div class="'+w.backgroundOverlay+'"></div><div class="'+w._tabStop+'"></div><div tabindex="-1" role="dialog" class="'+w.dialog+'"><div class="'+w.title+'"></div><div class="'+w._scroller+'"></div><div class="'+w.commands+'"><button class="'+w._commandSpacer+'"></button><button class="'+w.primaryCommand+'"></button><button class="'+w.secondaryCommand+'"></button></div></div><div class="'+w._tabStop+'"></div><div class="'+w._column0or1+'"></div>';var i={};i.root=e,i.backgroundOverlay=i.root.firstElementChild,i.startBodyTab=i.backgroundOverlay.nextElementSibling,i.dialog=i.startBodyTab.nextElementSibling,i.title=i.dialog.firstElementChild,i.scroller=i.title.nextElementSibling,i.commandContainer=i.scroller.nextElementSibling,i.commandSpacer=i.commandContainer.firstElementChild,i.commands=[],i.commands.push(i.commandSpacer.nextElementSibling),i.commands.push(i.commands[0].nextElementSibling),i.endBodyTab=i.dialog.nextElementSibling,i.content=t,this._dom=i,i.scroller.appendChild(i.content),h._ensureId(i.title),i.dialog.setAttribute("aria-labelledby",i.title.id),this._updateTabIndices(),h._addEventListener(i.root,"pointerdown",this._onPointerDown.bind(this)),h._addEventListener(i.root,"pointerup",this._onPointerUp.bind(this)),i.root.addEventListener("click",this._onClick.bind(this)),h._addEventListener(i.startBodyTab,"focusin",this._onStartBodyTabFocusIn.bind(this)),h._addEventListener(i.endBodyTab,"focusin",this._onEndBodyTabFocusIn.bind(this)),i.commands[0].addEventListener("click",this._onCommandClicked.bind(this,C.primary)),i.commands[1].addEventListener("click",this._onCommandClicked.bind(this,C.secondary))},_updateCommandsUI:function(){this._dom.commands[0].style.display=this.primaryCommandText?"":"none",this._dom.commands[1].style.display=this.secondaryCommandText?"":"none",this._dom.commandSpacer.style.display=this.primaryCommandText&&!this.secondaryCommandText||!this.primaryCommandText&&this.secondaryCommandText?"":"none"},_updateTabIndices:function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=r._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},_updateTabIndicesImpl:function(){var e=h._getHighAndLowTabIndices(this._dom.content);this._dom.startBodyTab.tabIndex=e.lowest,this._dom.commands[0].tabIndex=e.highest,this._dom.commands[1].tabIndex=e.highest,this._dom.endBodyTab.tabIndex=e.highest},_elementInDialog:function(e){return this._dom.dialog.contains(e)||e===this._dom.startBodyTab||e===this._dom.endBodyTab},_retakeFocus:function(){this._currentFocus&&this._elementInDialog(this._currentFocus)&&h._tryFocus(this._currentFocus)||this._focusInitialElement()},_isTopLevel:{get:function(){return!u(s.document.activeElement)}},_onCommandClicked:function(e){this._state.onCommandClicked(e)},_onPointerDown:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onPointerUp:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onClick:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onFocusIn:function(e){e=e.detail.originalEvent,this._isTopLevel&&(this._elementInDialog(e.target)?this._currentFocus=e.target:this._retakeFocus())},_onKeyDown:function(e){e=e.detail.originalEvent,this._isTopLevel&&(e.keyCode===h.Key.tab?this._updateTabIndices():e.keyCode===h.Key.escape?(this.hide(C.none),e.preventDefault(),e.stopPropagation()):this._elementInDialog(s.document.activeElement)||(e.preventDefault(),e.stopPropagation()))},_onBackClick:function(e){this._isTopLevel&&(this.hide(C.none),e.preventDefault())},_onStartBodyTabFocusIn:function(){h._focusLastFocusableElement(this._dom.dialog)},_onEndBodyTabFocusIn:function(){h._focusFirstFocusableElement(this._dom.dialog)},_onInputPaneShown:function(e){this._state.onInputPaneShown(e.detail.originalEvent)},_onInputPaneHidden:function(){this._state.onInputPaneHidden()},_setState:function(e,t){this._disposed||(this._state&&this._state.exit(),this._state=new e,this._state.dialog=this,this._state.enter(t))},_resetDismissalPromise:function(e){var t=this._dismissedSignal,i=this._dismissedSignal=new n;return t.complete({reason:e}),i},_cancelDismissalPromise:function(){var e=this._dismissedSignal,t=this._dismissedSignal=new n;return e.cancel(),t},_fireEvent:function(e,t){t=t||{};var i=t.detail||null,n=!!t.cancelable,r=s.document.createEvent("CustomEvent");return r.initCustomEvent(e,!0,n,i),this._dom.root.dispatchEvent(r)},_fireBeforeShow:function(){return this._fireEvent(I.beforeShow,{cancelable:!0})},_fireBeforeHide:function(e){return this._fireEvent(I.beforeHide,{detail:{reason:e},cancelable:!0})},_fireAfterHide:function(e){this._fireEvent(I.afterHide,{detail:{reason:e}})},_playEntranceAnimation:function(){return _(m.fadeIn(this._dom.root))},_playExitAnimation:function(){return _(m.fadeOut(this._dom.root))},_addExternalListeners:function(){h._inputPaneListener.addEventListener(this._dom.root,"showing",this._onInputPaneShownBound),h._inputPaneListener.addEventListener(this._dom.root,"hiding",this._onInputPaneShownBound),h._documentElementListener.addEventListener(this._dom.root,"keydown",this._onKeyDownBound,!0),h._documentElementListener.addEventListener(this._dom.root,"focusin",this._onFocusInBound),e._applicationListener.addEventListener(this._dom.root,"backclick",this._onBackClickBound)},_removeExternalListeners:function(){h._inputPaneListener.removeEventListener(this._dom.root,"showing",this._onInputPaneShownBound),h._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._onInputPaneShownBound),h._documentElementListener.removeEventListener(this._dom.root,"keydown",this._onKeyDownBound,!0),h._documentElementListener.removeEventListener(this._dom.root,"focusin",this._onFocusInBound),e._applicationListener.removeEventListener(this._dom.root,"backclick",this._onBackClickBound)},_renderForInputPane:function(e){this._clearInputPaneRendering();var t=this._dom.dialog,i=t.style,n=t.offsetLeft,r=t.offsetTop,o=t.offsetHeight,a=r+o,l=this._dom.root.offsetHeight-e,c=h.getTotalHeight(this._dom.title),u=h.getTotalHeight(this._dom.commandContainer);if(a>l){var d=o-(a-l);S>d-c-u&&this._dom.scroller.insertBefore(this._dom.title,this._dom.content),this._dom.root.style.display="block",i.height=d+"px",i.position="absolute",i.left=n+"px",i.top=r+"px",i.minHeight=0,this._resizedForInputPane=!0,s.document.activeElement.focus()
}},_clearInputPaneRendering:function(){if(this._resizedForInputPane){this._dom.title.parentNode!==this._dom.dialog&&this._dom.dialog.insertBefore(this._dom.title,this._dom.scroller);var e=this._dom.dialog.style;this._dom.root.style.display="",e.height="",e.position="",e.left="",e.top="",e.minHeight="",this._resizedForInputPane=!1}},_focusInitialElement:function(){h._focusFirstFocusableElement(this._dom.content)||this._dom.dialog.focus()}},{DismissalReason:C,_ClassNames:w});return a.Class.mix(k,l.createEventProperties("beforeshow","aftershow","beforehide","afterhide")),a.Class.mix(k,d.DOMEventMixin),k})})}),define("WinJS",["WinJS/Core/_WinJS","WinJS/Core","WinJS/Promise","WinJS/_Signal","WinJS/Scheduler","WinJS/Utilities","WinJS/Fragments","WinJS/Application","WinJS/Navigation","WinJS/Animations","WinJS/Binding","WinJS/BindingTemplate","WinJS/BindingList","WinJS/Res","WinJS/Pages","WinJS/ControlProcessor","WinJS/Controls/HtmlControl","WinJS/VirtualizedDataSource","WinJS/Controls/IntrinsicControls","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/AppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox","WinJS/Controls/ContentDialog","WinJS/Controls/Toolbar"],function(e){"use strict";return e}),require(["WinJS/Core/_WinJS","WinJS"],function(e){return global.WinJS=e,e})})}(this);
/*! Babylon 2014-10-23 */
function TridentAdapter(n){this.app="loki";typeof n!="undefined"&&(this.app=n);this.catalog=null}function nullFunction(){}function TridentMemoryAdapter(n){this.name="memory adapter";this.successCallback=nullFunction;this.errorCallback=nullFunction;n.hasOwnProperty("successCallback")&&(this.successCallback=n.successCallback);n.hasOwnProperty("errorCallback")&&(this.errorCallback=n.errorCallback);this.db=new loki("trident memory");this.kvpColl=this.db.addCollection("kvp");this.successCallback()}function TridentIndexedAdapter(n){this.name="indexedDB";this.db=null;this.upgradeCallback=nullFunction;this.successCallback=nullFunction;this.errorCallback=nullFunction;n.hasOwnProperty("upgradeCallback")&&(this.upgradeCallback=n.upgradeCallback);n.hasOwnProperty("successCallback")&&(this.successCallback=n.successCallback);n.hasOwnProperty("errorCallback")&&(this.errorCallback=n.errorCallback);this.initializeDatabase()}function TridentServiceAdapter(n){this.name="service";this.serviceLocation="";this.successCallback=nullFunction;this.errorCallback=nullFunction;n.hasOwnProperty("serviceLocation")&&(this.serviceLocation=n.serviceLocation);typeof n.successCallback=="function"&&(this.successCallback=n.successCallback);typeof n.errorCallback=="function"&&(this.errorCallback=n.errorCallback);setTimeout(this.successCallback,1)}function TridentList(n,t){this.listSettings={listElementId:n,selectedId:null,clickCallback:t,bright:!1}}function Pool(n){var t=this;this.taskQueue=[];this.workerQueue=[];this.poolSize=n;this.addWorkerTask=function(n){if(t.workerQueue.length>0){var i=t.workerQueue.shift();i.run(n)}else t.taskQueue.push(n)};this.init=function(){for(var i=0;i<n;i++)t.workerQueue.push(new WorkerThread(t))};this.freeWorkerThread=function(n){if(t.taskQueue.length>0){var i=t.taskQueue.shift();n.run(i)}else t.workerQueue.push(n)}}function WorkerThread(n){function i(n){t.workerTask.callback(n);t.parentPool.freeWorkerThread(t)}var t=this;this.parentPool=n;this.workerTask={};this.run=function(n){if(this.workerTask=n,this.workerTask.script!=null){var t=new Worker(n.script);t.addEventListener("message",i,!1);t.postMessage(n.startMessage)}}}function WorkerTask(n,t,i){this.script=n;this.callback=t;this.startMessage=i}var __extends,BABYLON,lokiIndexedAdapter,prettyPrint,saveAs;!function(n){var l=function(){function n(n,t,i){"undefined"==typeof n&&(n=0);"undefined"==typeof t&&(t=0);"undefined"==typeof i&&(i=0);this.r=n;this.g=t;this.b=i}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.toArray=function(n,t){void 0===t&&(t=0);n[t]=this.r;n[t+1]=this.g;n[t+2]=this.b},n.prototype.toColor4=function(n){return"undefined"==typeof n&&(n=1),new r(this.r,this.g,this.b,n)},n.prototype.asArray=function(){var n=[];return this.toArray(n,0),n},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(n,t){t.r=this.r*n.r;t.g=this.g*n.g;t.b=this.b*n.b},n.prototype.equals=function(n){return n&&this.r===n.r&&this.g===n.g&&this.b===n.b},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(n,t){t.r=this.r*n;t.g=this.g*n;t.b=this.b*n},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(n,t){t.r=this.r+n.r;t.g=this.g+n.g;t.b=this.b+n.b},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(n,t){t.r=this.r-n.r;t.g=this.g-n.g;t.b=this.b-n.b},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(n){this.r=n.r;this.g=n.g;this.b=n.b},n.prototype.copyFromFloats=function(n,t,i){this.r=n;this.g=t;this.b=i},n.FromArray=function(t){return new n(t[0],t[1],t[2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var u=t.r+(i.r-t.r)*r,f=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(u,f,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}(),r,f,t,i,e,u,o,s,h,c;n.Color3=l;r=function(){function t(n,t,i,r){this.r=n;this.g=t;this.b=i;this.a=r}return t.prototype.addInPlace=function(n){this.r+=n.r;this.g+=n.g;this.b+=n.b;this.a+=n.a},t.prototype.asArray=function(){var n=[];return this.toArray(n,0),n},t.prototype.toArray=function(n,t){void 0===t&&(t=0);n[t]=this.r;n[t+1]=this.g;n[t+2]=this.b;n[t+3]=this.a},t.prototype.add=function(n){return new t(this.r+n.r,this.g+n.g,this.b+n.b,this.a+n.a)},t.prototype.subtract=function(n){return new t(this.r-n.r,this.g-n.g,this.b-n.b,this.a-n.a)},t.prototype.subtractToRef=function(n,t){t.r=this.r-n.r;t.g=this.g-n.g;t.b=this.b-n.b;t.a=this.a-n.a},t.prototype.scale=function(n){return new t(this.r*n,this.g*n,this.b*n,this.a*n)},t.prototype.scaleToRef=function(n,t){t.r=this.r*n;t.g=this.g*n;t.b=this.b*n;t.a=this.a*n},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.Lerp=function(i,r,u){var f=new t(0,0,0,0);return n.Color4.LerpToRef(i,r,u,f),f},t.LerpToRef=function(n,t,i,r){r.r=n.r+(t.r-n.r)*i;r.g=n.g+(t.g-n.g)*i;r.b=n.b+(t.b-n.b)*i;r.a=n.a+(t.a-n.a)*i},t.FromArray=function(n,i){return"undefined"==typeof i&&(i=0),new t(n[i],n[i+1],n[i+2],n[i+3])},t.FromInts=function(n,i,r,u){return new t(n/255,i/255,r/255,u/255)},t}();n.Color4=r;f=function(){function n(n,t){this.x=n;this.y=t}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.toArray=function(n,t){void 0===t&&(t=0);n[t]=this.x;n[t+1]=this.y},n.prototype.asArray=function(){var n=[];return this.toArray(n,0),n},n.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y},n.prototype.copyFromFloats=function(n,t){this.x=n;this.y=t},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractInPlace=function(n){this.x-=n.x;this.y-=n.y},n.prototype.multiplyInPlace=function(n){this.x*=n.x;this.y*=n.y},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(n,t){t.x=this.x*n.x;t.y=this.y*n.y},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(n,t){t.x=this.x/n.x;t.y=this.y/n.y},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length(),n;return 0===t?this:(n=1/t,this.x*=n,this.y*=n,this)},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(n,t,i){i.x=n[t];i.y=n[t+1]},n.CatmullRom=function(t,i,r,u,f){var e=f*f,o=f*e,s=.5*(2*i.x+(-t.x+r.x)*f+(2*t.x-5*i.x+4*r.x-u.x)*e+(-t.x+3*i.x-3*r.x+u.x)*o),h=.5*(2*i.y+(-t.y+r.y)*f+(2*t.y-5*i.y+4*r.y-u.y)*e+(-t.y+3*i.y-3*r.y+u.y)*o);return new n(s,h)},n.Clamp=function(t,i,r){var f=t.x,u;return f=f>r.x?r.x:f,f=f<i.x?i.x:f,u=t.y,u=u>r.y?r.y:u,u=u<i.y?i.y:u,new n(f,u)},n.Hermite=function(t,i,r,u,f){var e=f*f,o=f*e,s=2*o-3*e+1,h=-2*o+3*e,c=o-2*e+f,l=o-e,a=t.x*s+r.x*h+i.x*c+u.x*l,v=t.y*s+r.y*h+i.y*c+u.y*l;return new n(a,v)},n.Lerp=function(t,i,r){var u=t.x+(i.x-t.x)*r,f=t.y+(i.y-t.y)*r;return new n(u,f)},n.Dot=function(n,t){return n.x*t.x+n.y*t.y},n.Normalize=function(n){var t=n.clone();return t.normalize(),t},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,u=t.y<i.y?t.y:i.y;return new n(r,u)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,u=t.y>i.y?t.y:i.y;return new n(r,u)},n.Transform=function(t,i){var r=t.x*i.m[0]+t.y*i.m[4],u=t.x*i.m[1]+t.y*i.m[5];return new n(r,u)},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(n,t){var i=n.x-t.x,r=n.y-t.y;return i*i+r*r},n}();n.Vector2=f;t=function(){function t(n,t,i){this.x=n;this.y=t;this.z=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.asArray=function(){var n=[];return this.toArray(n,0),n},t.prototype.toArray=function(n,t){void 0===t&&(t=0);n[t]=this.x;n[t+1]=this.y;n[t+2]=this.z},t.prototype.addInPlace=function(n){this.x+=n.x;this.y+=n.y;this.z+=n.z},t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y,this.z+n.z)},t.prototype.addToRef=function(n,t){t.x=this.x+n.x;t.y=this.y+n.y;t.z=this.z+n.z},t.prototype.subtractInPlace=function(n){this.x-=n.x;this.y-=n.y;this.z-=n.z},t.prototype.subtract=function(n){return new t(this.x-n.x,this.y-n.y,this.z-n.z)},t.prototype.subtractToRef=function(n,t){t.x=this.x-n.x;t.y=this.y-n.y;t.z=this.z-n.z},t.prototype.subtractFromFloats=function(n,i,r){return new t(this.x-n,this.y-i,this.z-r)},t.prototype.subtractFromFloatsToRef=function(n,t,i,r){r.x=this.x-n;r.y=this.y-t;r.z=this.z-i},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this.z*=n,this},t.prototype.scale=function(n){return new t(this.x*n,this.y*n,this.z*n)},t.prototype.scaleToRef=function(n,t){t.x=this.x*n;t.y=this.y*n;t.z=this.z*n},t.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z},t.prototype.equalsWithEpsilon=function(t){return Math.abs(this.x-t.x)<n.Engine.Epsilon&&Math.abs(this.y-t.y)<n.Engine.Epsilon&&Math.abs(this.z-t.z)<n.Engine.Epsilon},t.prototype.equalsToFloats=function(n,t,i){return this.x===n&&this.y===t&&this.z===i},t.prototype.multiplyInPlace=function(n){this.x*=n.x;this.y*=n.y;this.z*=n.z},t.prototype.multiply=function(n){return new t(this.x*n.x,this.y*n.y,this.z*n.z)},t.prototype.multiplyToRef=function(n,t){t.x=this.x*n.x;t.y=this.y*n.y;t.z=this.z*n.z},t.prototype.multiplyByFloats=function(n,i,r){return new t(this.x*n,this.y*i,this.z*r)},t.prototype.divide=function(n){return new t(this.x/n.x,this.y/n.y,this.z/n.z)},t.prototype.divideToRef=function(n,t){t.x=this.x/n.x;t.y=this.y/n.y;t.z=this.z/n.z},t.prototype.MinimizeInPlace=function(n){n.x<this.x&&(this.x=n.x);n.y<this.y&&(this.y=n.y);n.z<this.z&&(this.z=n.z)},t.prototype.MaximizeInPlace=function(n){n.x>this.x&&(this.x=n.x);n.y>this.y&&(this.y=n.y);n.z>this.z&&(this.z=n.z)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var t=this.length(),n;return 0===t?this:(n=1/t,this.x*=n,this.y*=n,this.z*=n,this)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y;this.z=n.z},t.prototype.copyFromFloats=function(n,t,i){this.x=n;this.y=t;this.z=i},t.FromArray=function(n,i){return i||(i=0),new t(n[i],n[i+1],n[i+2])},t.FromArrayToRef=function(n,t,i){i.x=n[t];i.y=n[t+1];i.z=n[t+2]},t.FromFloatArrayToRef=function(n,t,i){i.x=n[t];i.y=n[t+1];i.z=n[t+2]},t.FromFloatsToRef=function(n,t,i,r){r.x=n;r.y=t;r.z=i},t.Zero=function(){return new t(0,0,0)},t.Up=function(){return new t(0,1,0)},t.TransformCoordinates=function(n,i){var r=t.Zero();return t.TransformCoordinatesToRef(n,i,r),r},t.TransformCoordinatesToRef=function(n,t,i){var u=n.x*t.m[0]+n.y*t.m[4]+n.z*t.m[8]+t.m[12],f=n.x*t.m[1]+n.y*t.m[5]+n.z*t.m[9]+t.m[13],e=n.x*t.m[2]+n.y*t.m[6]+n.z*t.m[10]+t.m[14],r=n.x*t.m[3]+n.y*t.m[7]+n.z*t.m[11]+t.m[15];i.x=u/r;i.y=f/r;i.z=e/r},t.TransformCoordinatesFromFloatsToRef=function(n,t,i,r,u){var e=n*r.m[0]+t*r.m[4]+i*r.m[8]+r.m[12],o=n*r.m[1]+t*r.m[5]+i*r.m[9]+r.m[13],s=n*r.m[2]+t*r.m[6]+i*r.m[10]+r.m[14],f=n*r.m[3]+t*r.m[7]+i*r.m[11]+r.m[15];u.x=e/f;u.y=o/f;u.z=s/f},t.TransformNormal=function(n,i){var r=t.Zero();return t.TransformNormalToRef(n,i,r),r},t.TransformNormalToRef=function(n,t,i){i.x=n.x*t.m[0]+n.y*t.m[4]+n.z*t.m[8];i.y=n.x*t.m[1]+n.y*t.m[5]+n.z*t.m[9];i.z=n.x*t.m[2]+n.y*t.m[6]+n.z*t.m[10]},t.TransformNormalFromFloatsToRef=function(n,t,i,r,u){u.x=n*r.m[0]+t*r.m[4]+i*r.m[8];u.y=n*r.m[1]+t*r.m[5]+i*r.m[9];u.z=n*r.m[2]+t*r.m[6]+i*r.m[10]},t.CatmullRom=function(n,i,r,u,f){var e=f*f,o=f*e,s=.5*(2*i.x+(-n.x+r.x)*f+(2*n.x-5*i.x+4*r.x-u.x)*e+(-n.x+3*i.x-3*r.x+u.x)*o),h=.5*(2*i.y+(-n.y+r.y)*f+(2*n.y-5*i.y+4*r.y-u.y)*e+(-n.y+3*i.y-3*r.y+u.y)*o),c=.5*(2*i.z+(-n.z+r.z)*f+(2*n.z-5*i.z+4*r.z-u.z)*e+(-n.z+3*i.z-3*r.z+u.z)*o);return new t(s,h,c)},t.Clamp=function(n,i,r){var e=n.x,u,f;return e=e>r.x?r.x:e,e=e<i.x?i.x:e,u=n.y,u=u>r.y?r.y:u,u=u<i.y?i.y:u,f=n.z,f=f>r.z?r.z:f,f=f<i.z?i.z:f,new t(e,u,f)},t.Hermite=function(n,i,r,u,f){var e=f*f,o=f*e,s=2*o-3*e+1,h=-2*o+3*e,c=o-2*e+f,l=o-e,a=n.x*s+r.x*h+i.x*c+u.x*l,v=n.y*s+r.y*h+i.y*c+u.y*l,y=n.z*s+r.z*h+i.z*c+u.z*l;return new t(a,v,y)},t.Lerp=function(n,i,r){var u=n.x+(i.x-n.x)*r,f=n.y+(i.y-n.y)*r,e=n.z+(i.z-n.z)*r;return new t(u,f,e)},t.Dot=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z},t.Cross=function(n,i){var r=t.Zero();return t.CrossToRef(n,i,r),r},t.CrossToRef=function(n,t,i){i.x=n.y*t.z-n.z*t.y;i.y=n.z*t.x-n.x*t.z;i.z=n.x*t.y-n.y*t.x},t.Normalize=function(n){var i=t.Zero();return t.NormalizeToRef(n,i),i},t.NormalizeToRef=function(n,t){t.copyFrom(n);t.normalize()},t.Project=function(i,r,u,f){var e=f.width,o=f.height,s=f.x,h=f.y,c=n.Matrix.FromValues(e/2,0,0,0,0,-o/2,0,0,0,0,1,0,s+e/2,o/2+h,0,1),l=r.multiply(u).multiply(c);return t.TransformCoordinates(i,l)},t.Unproject=function(t,i,r,u,f,e){var o=u.multiply(f).multiply(e),s,h;return o.invert(),t.x=t.x/i*2-1,t.y=-(t.y/r*2-1),s=n.Vector3.TransformCoordinates(t,o),h=t.x*o.m[3]+t.y*o.m[7]+t.z*o.m[11]+o.m[15],n.Tools.WithinEpsilon(h,1)&&(s=s.scale(1/h)),s},t.Minimize=function(n,t){var i=n.clone();return i.MinimizeInPlace(t),i},t.Maximize=function(n,t){var i=n.clone();return i.MaximizeInPlace(t),i},t.Distance=function(n,i){return Math.sqrt(t.DistanceSquared(n,i))},t.DistanceSquared=function(n,t){var i=n.x-t.x,r=n.y-t.y,u=n.z-t.z;return i*i+r*r+u*u},t.Center=function(n,t){var i=n.add(t);return i.scaleInPlace(.5),i},t}();n.Vector3=t;i=function(){function n(n,t,i,r){"undefined"==typeof n&&(n=0);"undefined"==typeof t&&(t=0);"undefined"==typeof i&&(i=0);"undefined"==typeof r&&(r=1);this.x=n;this.y=t;this.z=i;this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},n.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y;this.z=n.z;this.w=n.w},n.prototype.copyFromFloats=function(n,t,i,r){this.x=n;this.y=t;this.z=i;this.w=r},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.multiply=function(t){var i=new n(0,0,0,1);return this.multiplyToRef(t,i),i},n.prototype.multiplyToRef=function(n,t){t.x=this.x*n.w+this.y*n.z-this.z*n.y+this.w*n.x;t.y=-this.x*n.z+this.y*n.w+this.z*n.x+this.w*n.y;t.z=this.x*n.y-this.y*n.x+this.z*n.w+this.w*n.z;t.w=-this.x*n.x-this.y*n.y-this.z*n.z+this.w*n.w},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.normalize=function(){var n=1/this.length();this.x*=n;this.y*=n;this.z*=n;this.w*=n},n.prototype.toEulerAngles=function(){var n=t.Zero();return this.toEulerAnglesToRef(n),n},n.prototype.toEulerAnglesToRef=function(n){var t=this.x,i=this.y,r=this.z,u=this.w,h=t*t,c=i*i,o=r*r,f=Math.atan2(2*(i*u-t*r),1-2*(c+o)),l=Math.asin(2*(t*i+r*u)),e=Math.atan2(2*(t*u-i*r),1-2*(h+o)),s=t*i+r*u;s>.499?(f=2*Math.atan2(t,u),e=0):-.499>s&&(f=-2*Math.atan2(t,u),e=0);n.x=l;n.y=f;n.z=e},n.prototype.toRotationMatrix=function(n){var t=this.x*this.x,i=this.y*this.y,r=this.z*this.z,u=this.x*this.y,f=this.z*this.w,e=this.z*this.x,o=this.y*this.w,s=this.y*this.z,h=this.x*this.w;n.m[0]=1-2*(i+r);n.m[1]=2*(u+f);n.m[2]=2*(e-o);n.m[3]=0;n.m[4]=2*(u-f);n.m[5]=1-2*(r+t);n.m[6]=2*(s+h);n.m[7]=0;n.m[8]=2*(e+o);n.m[9]=2*(s-h);n.m[10]=1-2*(i+t);n.m[11]=0;n.m[12]=0;n.m[13]=0;n.m[14]=0;n.m[15]=1},n.prototype.fromRotationMatrix=function(n){var t,i=n.m,r=i[0],e=i[4],o=i[8],s=i[1],u=i[5],h=i[9],c=i[2],l=i[6],f=i[10],a=r+u+f;return a>0?(t=.5/Math.sqrt(a+1),this.w=.25/t,this.x=(l-h)*t,this.y=(o-c)*t,void(this.z=(s-e)*t)):r>u&&r>f?(t=2*Math.sqrt(1+r-u-f),this.w=(l-h)/t,this.x=.25*t,this.y=(e+s)/t,void(this.z=(o+c)/t)):u>f?(t=2*Math.sqrt(1+u-r-f),this.w=(o-c)/t,this.x=(e+s)/t,this.y=.25*t,void(this.z=(h+l)/t)):(t=2*Math.sqrt(1+f-r-u),this.w=(s-e)/t,this.x=(o+c)/t,this.y=(h+l)/t,void(this.z=.25*t))},n.Inverse=function(t){return new n(-t.x,-t.y,-t.z,t.w)},n.RotationAxis=function(t,i){var r=new n,u=Math.sin(i/2);return r.w=Math.cos(i/2),r.x=t.x*u,r.y=t.y*u,r.z=t.z*u,r},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.RotationYawPitchRoll=function(t,i,r){var u=new n;return n.RotationYawPitchRollToRef(t,i,r,u),u},n.RotationYawPitchRollToRef=function(n,t,i,r){var c=.5*i,l=.5*t,a=.5*n,u=Math.sin(c),f=Math.cos(c),e=Math.sin(l),o=Math.cos(l),s=Math.sin(a),h=Math.cos(a);r.x=h*e*f+s*o*u;r.y=s*o*f-h*e*u;r.z=h*o*u-s*e*f;r.w=h*o*f+s*e*u},n.Slerp=function(t,i,r){var u,f,e=r,o=t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w,c=!1,s,h;return(0>o&&(c=!0,o=-o),o>.999999)?(f=1-e,u=c?-e:e):(s=Math.acos(o),h=1/Math.sin(s),f=Math.sin((1-e)*s)*h,u=c?-Math.sin(e*s)*h:Math.sin(e*s)*h),new n(f*t.x+u*i.x,f*t.y+u*i.y,f*t.z+u*i.z,f*t.w+u*i.w)},n}();n.Quaternion=i;e=function(){function n(){this.m=new Float32Array(16)}return n.prototype.isIdentity=function(){return 1!=this.m[0]||1!=this.m[5]||1!=this.m[10]||1!=this.m[15]?!1:0!=this.m[1]||0!=this.m[2]||0!=this.m[3]||0!=this.m[4]||0!=this.m[6]||0!=this.m[7]||0!=this.m[8]||0!=this.m[9]||0!=this.m[11]||0!=this.m[12]||0!=this.m[13]||0!=this.m[14]?!1:!0},n.prototype.determinant=function(){var n=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],i=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],u=this.m[8]*this.m[14]-this.m[10]*this.m[12],f=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*n-this.m[6]*t+this.m[7]*i)-this.m[1]*(this.m[4]*n-this.m[6]*r+this.m[7]*u)+this.m[2]*(this.m[4]*t-this.m[5]*r+this.m[7]*f)-this.m[3]*(this.m[4]*i-this.m[5]*u+this.m[6]*f)},n.prototype.toArray=function(){return this.m},n.prototype.asArray=function(){return this.toArray()},n.prototype.invert=function(){this.invertToRef(this)},n.prototype.invertToRef=function(n){var i=this.m[0],r=this.m[1],u=this.m[2],f=this.m[3],e=this.m[4],o=this.m[5],s=this.m[6],h=this.m[7],c=this.m[8],l=this.m[9],a=this.m[10],v=this.m[11],y=this.m[12],p=this.m[13],w=this.m[14],b=this.m[15],k=a*b-v*w,d=l*b-v*p,g=l*w-a*p,nt=c*b-v*y,tt=c*w-a*y,it=c*p-l*y,rt=o*k-s*d+h*g,ut=-(e*k-s*nt+h*tt),ft=e*d-o*nt+h*it,et=-(e*g-o*tt+s*it),t=1/(i*rt+r*ut+u*ft+f*et),ot=s*b-h*w,st=o*b-h*p,ht=o*w-s*p,ct=e*b-h*y,lt=e*w-s*y,at=e*p-o*y,vt=s*v-h*a,yt=o*v-h*l,pt=o*a-s*l,wt=e*v-h*c,bt=e*a-s*c,kt=e*l-o*c;n.m[0]=rt*t;n.m[4]=ut*t;n.m[8]=ft*t;n.m[12]=et*t;n.m[1]=-(r*k-u*d+f*g)*t;n.m[5]=(i*k-u*nt+f*tt)*t;n.m[9]=-(i*d-r*nt+f*it)*t;n.m[13]=(i*g-r*tt+u*it)*t;n.m[2]=(r*ot-u*st+f*ht)*t;n.m[6]=-(i*ot-u*ct+f*lt)*t;n.m[10]=(i*st-r*ct+f*at)*t;n.m[14]=-(i*ht-r*lt+u*at)*t;n.m[3]=-(r*vt-u*yt+f*pt)*t;n.m[7]=(i*vt-u*wt+f*bt)*t;n.m[11]=-(i*yt-r*wt+f*kt)*t;n.m[15]=(i*pt-r*bt+u*kt)*t},n.prototype.setTranslation=function(n){this.m[12]=n.x;this.m[13]=n.y;this.m[14]=n.z},n.prototype.multiply=function(t){var i=new n;return this.multiplyToRef(t,i),i},n.prototype.copyFrom=function(n){for(var t=0;16>t;t++)this.m[t]=n.m[t]},n.prototype.copyToArray=function(n,t){"undefined"==typeof t&&(t=0);for(var i=0;16>i;i++)n[t+i]=this.m[i]},n.prototype.multiplyToRef=function(n,t){this.multiplyToArray(n,t.m,0)},n.prototype.multiplyToArray=function(n,t,i){var r=this.m[0],u=this.m[1],f=this.m[2],e=this.m[3],o=this.m[4],s=this.m[5],h=this.m[6],c=this.m[7],l=this.m[8],a=this.m[9],v=this.m[10],y=this.m[11],p=this.m[12],w=this.m[13],b=this.m[14],k=this.m[15],d=n.m[0],g=n.m[1],nt=n.m[2],tt=n.m[3],it=n.m[4],rt=n.m[5],ut=n.m[6],ft=n.m[7],et=n.m[8],ot=n.m[9],st=n.m[10],ht=n.m[11],ct=n.m[12],lt=n.m[13],at=n.m[14],vt=n.m[15];t[i]=r*d+u*it+f*et+e*ct;t[i+1]=r*g+u*rt+f*ot+e*lt;t[i+2]=r*nt+u*ut+f*st+e*at;t[i+3]=r*tt+u*ft+f*ht+e*vt;t[i+4]=o*d+s*it+h*et+c*ct;t[i+5]=o*g+s*rt+h*ot+c*lt;t[i+6]=o*nt+s*ut+h*st+c*at;t[i+7]=o*tt+s*ft+h*ht+c*vt;t[i+8]=l*d+a*it+v*et+y*ct;t[i+9]=l*g+a*rt+v*ot+y*lt;t[i+10]=l*nt+a*ut+v*st+y*at;t[i+11]=l*tt+a*ft+v*ht+y*vt;t[i+12]=p*d+w*it+b*et+k*ct;t[i+13]=p*g+w*rt+b*ot+k*lt;t[i+14]=p*nt+w*ut+b*st+k*at;t[i+15]=p*tt+w*ft+b*ht+k*vt},n.prototype.equals=function(n){return n&&this.m[0]===n.m[0]&&this.m[1]===n.m[1]&&this.m[2]===n.m[2]&&this.m[3]===n.m[3]&&this.m[4]===n.m[4]&&this.m[5]===n.m[5]&&this.m[6]===n.m[6]&&this.m[7]===n.m[7]&&this.m[8]===n.m[8]&&this.m[9]===n.m[9]&&this.m[10]===n.m[10]&&this.m[11]===n.m[11]&&this.m[12]===n.m[12]&&this.m[13]===n.m[13]&&this.m[14]===n.m[14]&&this.m[15]===n.m[15]},n.prototype.clone=function(){return n.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},n.FromArray=function(t,i){var r=new n;return i||(i=0),n.FromArrayToRef(t,i,r),r},n.FromArrayToRef=function(n,t,i){for(var r=0;16>r;r++)i.m[r]=n[r+t]},n.FromValuesToRef=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){w.m[0]=n;w.m[1]=t;w.m[2]=i;w.m[3]=r;w.m[4]=u;w.m[5]=f;w.m[6]=e;w.m[7]=o;w.m[8]=s;w.m[9]=h;w.m[10]=c;w.m[11]=l;w.m[12]=a;w.m[13]=v;w.m[14]=y;w.m[15]=p},n.FromValues=function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=new n;return b.m[0]=t,b.m[1]=i,b.m[2]=r,b.m[3]=u,b.m[4]=f,b.m[5]=e,b.m[6]=o,b.m[7]=s,b.m[8]=h,b.m[9]=c,b.m[10]=l,b.m[11]=a,b.m[12]=v,b.m[13]=y,b.m[14]=p,b.m[15]=w,b},n.Identity=function(){return n.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},n.IdentityToRef=function(t){n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},n.Zero=function(){return n.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},n.RotationX=function(t){var i=new n;return n.RotationXToRef(t,i),i},n.RotationXToRef=function(n,t){var i=Math.sin(n),r=Math.cos(n);t.m[0]=1;t.m[15]=1;t.m[5]=r;t.m[10]=r;t.m[9]=-i;t.m[6]=i;t.m[1]=0;t.m[2]=0;t.m[3]=0;t.m[4]=0;t.m[7]=0;t.m[8]=0;t.m[11]=0;t.m[12]=0;t.m[13]=0;t.m[14]=0},n.RotationY=function(t){var i=new n;return n.RotationYToRef(t,i),i},n.RotationYToRef=function(n,t){var i=Math.sin(n),r=Math.cos(n);t.m[5]=1;t.m[15]=1;t.m[0]=r;t.m[2]=-i;t.m[8]=i;t.m[10]=r;t.m[1]=0;t.m[3]=0;t.m[4]=0;t.m[6]=0;t.m[7]=0;t.m[9]=0;t.m[11]=0;t.m[12]=0;t.m[13]=0;t.m[14]=0},n.RotationZ=function(t){var i=new n;return n.RotationZToRef(t,i),i},n.RotationZToRef=function(n,t){var i=Math.sin(n),r=Math.cos(n);t.m[10]=1;t.m[15]=1;t.m[0]=r;t.m[1]=i;t.m[4]=-i;t.m[5]=r;t.m[2]=0;t.m[3]=0;t.m[6]=0;t.m[7]=0;t.m[8]=0;t.m[9]=0;t.m[11]=0;t.m[12]=0;t.m[13]=0;t.m[14]=0},n.RotationAxis=function(t,i){var f=Math.sin(-i),e=Math.cos(-i),u=1-e,r;return t.normalize(),r=n.Zero(),r.m[0]=t.x*t.x*u+e,r.m[1]=t.x*t.y*u-t.z*f,r.m[2]=t.x*t.z*u+t.y*f,r.m[3]=0,r.m[4]=t.y*t.x*u+t.z*f,r.m[5]=t.y*t.y*u+e,r.m[6]=t.y*t.z*u-t.x*f,r.m[7]=0,r.m[8]=t.z*t.x*u-t.y*f,r.m[9]=t.z*t.y*u+t.x*f,r.m[10]=t.z*t.z*u+e,r.m[11]=0,r.m[15]=1,r},n.RotationYawPitchRoll=function(t,i,r){var u=new n;return n.RotationYawPitchRollToRef(t,i,r,u),u},n.RotationYawPitchRollToRef=function(n,t,r,u){i.RotationYawPitchRollToRef(n,t,r,this._tempQuaternion);this._tempQuaternion.toRotationMatrix(u)},n.Scaling=function(t,i,r){var u=n.Zero();return n.ScalingToRef(t,i,r,u),u},n.ScalingToRef=function(n,t,i,r){r.m[0]=n;r.m[1]=0;r.m[2]=0;r.m[3]=0;r.m[4]=0;r.m[5]=t;r.m[6]=0;r.m[7]=0;r.m[8]=0;r.m[9]=0;r.m[10]=i;r.m[11]=0;r.m[12]=0;r.m[13]=0;r.m[14]=0;r.m[15]=1},n.Translation=function(t,i,r){var u=n.Identity();return n.TranslationToRef(t,i,r,u),u},n.TranslationToRef=function(t,i,r,u){n.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1,u)},n.LookAtLH=function(t,i,r){var u=n.Zero();return n.LookAtLHToRef(t,i,r,u),u},n.LookAtLHToRef=function(i,r,u,f){r.subtractToRef(i,this._zAxis);this._zAxis.normalize();t.CrossToRef(u,this._zAxis,this._xAxis);this._xAxis.normalize();t.CrossToRef(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();var e=-t.Dot(this._xAxis,i),o=-t.Dot(this._yAxis,i),s=-t.Dot(this._zAxis,i);return n.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,o,s,1,f)},n.OrthoLH=function(t,i,r,u){var f=2/t,e=2/i,o=1/(u-r),s=r/(r-u);return n.FromValues(f,0,0,0,0,e,0,0,0,0,o,0,0,0,s,1)},n.OrthoOffCenterLH=function(t,i,r,u,f,e){var o=n.Zero();return n.OrthoOffCenterLHToRef(t,i,r,u,f,e,o),o},n.OrthoOffCenterLHToRef=function(n,t,i,r,u,f,e){e.m[0]=2/(t-n);e.m[1]=e.m[2]=e.m[3]=0;e.m[5]=2/(r-i);e.m[4]=e.m[6]=e.m[7]=0;e.m[10]=-1/(u-f);e.m[8]=e.m[9]=e.m[11]=0;e.m[12]=(n+t)/(n-t);e.m[13]=(r+i)/(i-r);e.m[14]=u/(u-f);e.m[15]=1},n.PerspectiveLH=function(t,i,r,u){var f=n.Zero();return f.m[0]=2*r/t,f.m[1]=f.m[2]=f.m[3]=0,f.m[5]=2*r/i,f.m[4]=f.m[6]=f.m[7]=0,f.m[10]=-u/(r-u),f.m[8]=f.m[9]=0,f.m[11]=1,f.m[12]=f.m[13]=f.m[15]=0,f.m[14]=r*u/(r-u),f},n.PerspectiveFovLH=function(t,i,r,u){var f=n.Zero();return n.PerspectiveFovLHToRef(t,i,r,u,f),f},n.PerspectiveFovLHToRef=function(n,t,i,r,u){var f=1/Math.tan(.5*n);u.m[0]=f/t;u.m[1]=u.m[2]=u.m[3]=0;u.m[5]=f;u.m[4]=u.m[6]=u.m[7]=0;u.m[8]=u.m[9]=0;u.m[10]=-r/(i-r);u.m[11]=1;u.m[12]=u.m[13]=u.m[15]=0;u.m[14]=i*r/(i-r)},n.GetFinalMatrix=function(t,i,r,u,f,e){var o=t.width,s=t.height,h=t.x,c=t.y,l=n.FromValues(o/2,0,0,0,0,-s/2,0,0,0,0,e-f,0,h+o/2,s/2+c,f,1);return i.multiply(r).multiply(u).multiply(l)},n.Transpose=function(t){var i=new n;return i.m[0]=t.m[0],i.m[1]=t.m[4],i.m[2]=t.m[8],i.m[3]=t.m[12],i.m[4]=t.m[1],i.m[5]=t.m[5],i.m[6]=t.m[9],i.m[7]=t.m[13],i.m[8]=t.m[2],i.m[9]=t.m[6],i.m[10]=t.m[10],i.m[11]=t.m[14],i.m[12]=t.m[3],i.m[13]=t.m[7],i.m[14]=t.m[11],i.m[15]=t.m[15],i},n.Reflection=function(t){var i=new n;return n.ReflectionToRef(t,i),i},n.ReflectionToRef=function(n,t){n.normalize();var i=n.normal.x,r=n.normal.y,u=n.normal.z,f=-2*i,e=-2*r,o=-2*u;t.m[0]=f*i+1;t.m[1]=e*i;t.m[2]=o*i;t.m[3]=0;t.m[4]=f*r;t.m[5]=e*r+1;t.m[6]=o*r;t.m[7]=0;t.m[8]=f*u;t.m[9]=e*u;t.m[10]=o*u+1;t.m[11]=0;t.m[12]=f*n.d;t.m[13]=e*n.d;t.m[14]=o*n.d;t.m[15]=1},n._tempQuaternion=new i,n._xAxis=t.Zero(),n._yAxis=t.Zero(),n._zAxis=t.Zero(),n}();n.Matrix=e;u=function(){function i(n,i,r,u){this.normal=new t(n,i,r);this.d=u}return i.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},i.prototype.clone=function(){return new i(this.normal.x,this.normal.y,this.normal.z,this.d)},i.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),n=0;0!=t&&(n=1/t);this.normal.x*=n;this.normal.y*=n;this.normal.z*=n;this.d*=n},i.prototype.transform=function(t){var i=n.Matrix.Transpose(t),r=this.normal.x,u=this.normal.y,f=this.normal.z,e=this.d,o=r*i.m[0]+u*i.m[1]+f*i.m[2]+e*i.m[3],s=r*i.m[4]+u*i.m[5]+f*i.m[6]+e*i.m[7],h=r*i.m[8]+u*i.m[9]+f*i.m[10]+e*i.m[11],c=r*i.m[12]+u*i.m[13]+f*i.m[14]+e*i.m[15];return new n.Plane(o,s,h,c)},i.prototype.dotCoordinate=function(n){return this.normal.x*n.x+this.normal.y*n.y+this.normal.z*n.z+this.d},i.prototype.copyFromPoints=function(n,t,i){var r,o=t.x-n.x,s=t.y-n.y,h=t.z-n.z,c=i.x-n.x,l=i.y-n.y,a=i.z-n.z,u=s*a-h*l,f=h*c-o*a,e=o*l-s*c,v=Math.sqrt(u*u+f*f+e*e);r=0!=v?1/v:0;this.normal.x=u*r;this.normal.y=f*r;this.normal.z=e*r;this.d=-(this.normal.x*n.x+this.normal.y*n.y+this.normal.z*n.z)},i.prototype.isFrontFacingTo=function(n,i){var r=t.Dot(this.normal,n);return i>=r},i.prototype.signedDistanceTo=function(n){return t.Dot(n,this.normal)+this.d},i.FromArray=function(t){return new n.Plane(t[0],t[1],t[2],t[3])},i.FromPoints=function(t,i,r){var u=new n.Plane(0,0,0,0);return u.copyFromPoints(t,i,r),u},i.FromPositionAndNormal=function(t,i){var r=new n.Plane(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},i.SignedDistanceToPlaneFromPositionAndNormal=function(n,i,r){var u=-(i.x*n.x+i.y*n.y+i.z*n.z);return t.Dot(r,i)+u},i}();n.Plane=u;o=function(){function n(n,t,i,r){this.x=n;this.y=t;this.width=i;this.height=r}return n.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new n(this.x*i,this.y*r,this.width*i,this.height*r)},n}();n.Viewport=o;s=function(){function n(){}return n.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new u(0,0,0,0));return n.GetPlanesToRef(t,i),i},n.GetPlanesToRef=function(n,t){t[0].normal.x=n.m[3]+n.m[2];t[0].normal.y=n.m[7]+n.m[6];t[0].normal.z=n.m[10]+n.m[10];t[0].d=n.m[15]+n.m[14];t[0].normalize();t[1].normal.x=n.m[3]-n.m[2];t[1].normal.y=n.m[7]-n.m[6];t[1].normal.z=n.m[11]-n.m[10];t[1].d=n.m[15]-n.m[14];t[1].normalize();t[2].normal.x=n.m[3]+n.m[0];t[2].normal.y=n.m[7]+n.m[4];t[2].normal.z=n.m[11]+n.m[8];t[2].d=n.m[15]+n.m[12];t[2].normalize();t[3].normal.x=n.m[3]-n.m[0];t[3].normal.y=n.m[7]-n.m[4];t[3].normal.z=n.m[11]-n.m[8];t[3].d=n.m[15]-n.m[12];t[3].normalize();t[4].normal.x=n.m[3]-n.m[1];t[4].normal.y=n.m[7]-n.m[5];t[4].normal.z=n.m[11]-n.m[9];t[4].d=n.m[15]-n.m[13];t[4].normalize();t[5].normal.x=n.m[3]+n.m[1];t[5].normal.y=n.m[7]+n.m[5];t[5].normal.z=n.m[11]+n.m[9];t[5].d=n.m[15]+n.m[13];t[5].normalize()},n}();n.Frustum=s;h=function(){function i(n,t){this.origin=n;this.direction=t}return i.prototype.intersectsBoxMinMax=function(n,t){var u=0,f=Number.MAX_VALUE,o;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>t.x)return!1}else{var e=1/this.direction.x,i=(n.x-this.origin.x)*e,r=(t.x-this.origin.x)*e;if(i>r&&(o=i,i=r,r=o),u=Math.max(i,u),f=Math.min(r,f),u>f)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>t.y)return!1}else if(e=1/this.direction.y,i=(n.y-this.origin.y)*e,r=(t.y-this.origin.y)*e,i>r&&(o=i,i=r,r=o),u=Math.max(i,u),f=Math.min(r,f),u>f)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>t.z)return!1}else if(e=1/this.direction.z,i=(n.z-this.origin.z)*e,r=(t.z-this.origin.z)*e,i>r&&(o=i,i=r,r=o),u=Math.max(i,u),f=Math.min(r,f),u>f)return!1;return!0},i.prototype.intersectsBox=function(n){return this.intersectsBoxMinMax(n.minimum,n.maximum)},i.prototype.intersectsSphere=function(n){var i=n.center.x-this.origin.x,r=n.center.y-this.origin.y,u=n.center.z-this.origin.z,f=i*i+r*r+u*u,e=n.radius*n.radius,t,o;return e>=f?!0:(t=i*this.direction.x+r*this.direction.y+u*this.direction.z,0>t)?!1:(o=f-t*t,e>=o)},i.prototype.intersectsTriangle=function(i,r,u){var s,e,f,o;return(this._edge1||(this._edge1=n.Vector3.Zero(),this._edge2=n.Vector3.Zero(),this._pvec=n.Vector3.Zero(),this._tvec=n.Vector3.Zero(),this._qvec=n.Vector3.Zero()),r.subtractToRef(i,this._edge1),u.subtractToRef(i,this._edge2),n.Vector3.CrossToRef(this.direction,this._edge2,this._pvec),s=t.Dot(this._edge1,this._pvec),0===s)?null:(e=1/s,this.origin.subtractToRef(i,this._tvec),f=t.Dot(this._tvec,this._pvec)*e,0>f||f>1)?null:(t.CrossToRef(this._tvec,this._edge1,this._qvec),o=t.Dot(this.direction,this._qvec)*e,0>o||f+o>1?null:new n.IntersectionInfo(f,o,t.Dot(this._edge2,this._qvec)*e))},i.CreateNew=function(t,r,u,f,e,o,s){var h=n.Vector3.Unproject(new n.Vector3(t,r,0),u,f,e,o,s),l=n.Vector3.Unproject(new n.Vector3(t,r,1),u,f,e,o,s),c=l.subtract(h);return c.normalize(),new i(h,c)},i.Transform=function(t,r){var u=n.Vector3.TransformCoordinates(t.origin,r),f=n.Vector3.TransformNormal(t.direction,r);return new i(u,f)},i}();n.Ray=h,function(n){n[n.LOCAL=0]="LOCAL";n[n.WORLD=1]="WORLD"}(n.Space||(n.Space={}));c=(n.Space,function(){function t(){}return t.X=new n.Vector3(1,0,0),t.Y=new n.Vector3(0,1,0),t.Z=new n.Vector3(0,0,1),t}());n.Axis=c}(BABYLON||(BABYLON={}));!function(n){var i,r=60,t=[],u=60,f=0,e=function(t,i){return t?t instanceof n.Mesh?null:t instanceof n.SubMesh?t.clone(i):t.clone?t.clone():null:null},o=function(){function o(){}return o.GetFilename=function(n){var t=n.lastIndexOf("/");return 0>t?n:n.substring(t+1)},o.GetDOMTextContent=function(n){for(var i="",t=n.firstChild;t;)3==t.nodeType&&(i+=t.textContent),t=t.nextSibling;return i},o.ToDegrees=function(n){return 180*n/Math.PI},o.ToRadians=function(n){return n*Math.PI/180},o.ExtractMinAndMaxIndexed=function(t,i,r,u){for(var s,e=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new n.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=r;r+u>f;f++)s=new n.Vector3(t[3*i[f]],t[3*i[f]+1],t[3*i[f]+2]),e=n.Vector3.Minimize(s,e),o=n.Vector3.Maximize(s,o);return{minimum:e,maximum:o}},o.ExtractMinAndMax=function(t,i,r){for(var o,f=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new n.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=i;i+r>u;u++)o=new n.Vector3(t[3*u],t[3*u+1],t[3*u+2]),f=n.Vector3.Minimize(o,f),e=n.Vector3.Maximize(o,e);return{minimum:f,maximum:e}},o.MakeArray=function(n,t){if(t===!0||void 0!==n&&null!=n)return Array.isArray(n)?n:[n]},o.GetPointerPrefix=function(){var n="pointer";return navigator.pointerEnabled||(n="mouse"),n},o.QueueNewFrame=function(n){window.requestAnimationFrame?window.requestAnimationFrame(n):window.msRequestAnimationFrame?window.msRequestAnimationFrame(n):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(n):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(n):window.oRequestAnimationFrame?window.oRequestAnimationFrame(n):window.setTimeout(n,16)},o.RequestFullscreen=function(n){n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.mozRequestFullScreen&&n.mozRequestFullScreen()},o.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},o.CleanUrl=function(n){return n.replace(/#/gm,"%23")},o.LoadImage=function(t,i,r,u){var f,s,c,h,e;if(t=o.CleanUrl(t),f=new Image,"data:"!=t.substr(0,5)&&(f.crossOrigin="anonymous"),f.onload=function(){i(f)},f.onerror=function(n){r(f,n)},s=function(){f.src=t},c=function(){u.loadImageFromDB(t,f)},u&&u.enableTexturesOffline&&n.Database.isUASupportingBlobStorage)u.openAsync(c,s);else if(-1===t.indexOf("file:"))s();else try{e=t.substring(5);try{h=URL.createObjectURL(n.FilesInput.FilesTextures[e],{oneTimeOnly:!0})}catch(l){h=URL.createObjectURL(n.FilesInput.FilesTextures[e])}f.src=h}catch(a){o.Log("Error while trying to load texture: "+e);f.src=null}return f},o.LoadFile=function(t,i,r,u,f,e){var s,h,c;t=o.CleanUrl(t);s=function(){var u=new XMLHttpRequest,s=o.BaseUrl+t;u.open("GET",s,!0);f&&(u.responseType="arraybuffer");u.onprogress=r;u.onreadystatechange=function(){if(4==u.readyState)if(200==u.status||n.Tools.ValidateXHRData(u,f?6:1))i(f?u.response:u.responseText);else{if(!e)throw new Error("Error status: "+u.status+" - Unable to load "+s);e()}};u.send(null)};h=function(){u.loadFileFromDB(t,i,r,s,f)};-1!==t.indexOf("file:")?(c=t.substring(5),n.Tools.ReadFile(n.FilesInput.FilesToLoad[c],i,r,!0)):u&&u.enableSceneOffline?u.openAsync(h,s):s()},o.ReadFileAsDataURL=function(n,t,i){var r=new FileReader;r.onload=function(n){t(n.target.result)};r.onprogress=i;r.readAsDataURL(n)},o.ReadFile=function(n,t,i,r){var u=new FileReader;u.onload=function(n){t(n.target.result)};u.onprogress=i;r?u.readAsArrayBuffer(n):u.readAsText(n)},o.CheckExtends=function(n,t,i){n.x<t.x&&(t.x=n.x);n.y<t.y&&(t.y=n.y);n.z<t.z&&(t.z=n.z);n.x>i.x&&(i.x=n.x);n.y>i.y&&(i.y=n.y);n.z>i.z&&(i.z=n.z)},o.WithinEpsilon=function(n,t){var i=n-t;return i>=-1401298e-51&&1401298e-51>=i},o.DeepCopy=function(n,t,i,r){var u,f,s,o,h;for(u in n)if(("_"!==u[0]||r&&-1!==r.indexOf(u))&&(!i||-1===i.indexOf(u))&&(f=n[u],s=typeof f,"function"!=s))if("object"==s)if(f instanceof Array){if(t[u]=[],f.length>0)if("object"==typeof f[0])for(o=0;o<f.length;o++)h=e(f[o],t),-1===t[u].indexOf(h)&&t[u].push(h);else t[u]=f.slice(0)}else t[u]=e(f,t);else t[u]=f},o.IsEmpty=function(n){for(var t in n)return!1;return!0},o.RegisterTopRootEvents=function(n){for(var t,i=0;i<n.length;i++){t=n[i];window.addEventListener(t.name,t.handler,!1);try{window.parent&&window.parent.addEventListener(t.name,t.handler,!1)}catch(r){}}},o.UnregisterTopRootEvents=function(n){for(var t,i=0;i<n.length;i++){t=n[i];window.removeEventListener(t.name,t.handler);try{window.parent&&window.parent.removeEventListener(t.name,t.handler)}catch(r){}}},o.GetFps=function(){return u},o.GetDeltaTime=function(){return f},o._MeasureFps=function(){var n,e,i;if(t.push((new Date).getTime()),n=t.length,n>=2&&(f=t[n-1]-t[n-2]),n>=r){for(n>r&&(t.splice(0,1),n=t.length),e=0,i=0;n-1>i;i++)e+=t[i+1]-t[i];u=1e3/(e/(n-1))}},o.CreateScreenshot=function(t,r,u){var f,e,h=r.getScene(),c=null,s;if(h.activeCamera!==r&&(c=h.activeCamera,h.activeCamera=r),u.precision)f=Math.round(t.getRenderWidth()*u.precision),e=Math.round(f/t.getAspectRatio(r)),u={width:f,height:e};else if(u.width&&u.height)f=u.width,e=u.height;else if(u.width&&!u.height)f=u.width,e=Math.round(f/t.getAspectRatio(r)),u={width:f,height:e};else if(u.height&&!u.width)e=u.height,f=Math.round(e*t.getAspectRatio(r)),u={width:f,height:e};else{if(isNaN(u))return void o.Error("Invalid 'size' parameter !");e=u;f=u}s=new n.RenderTargetTexture("screenShot",u,t.scenes[0],!1,!1);s.renderList=t.scenes[0].meshes;s.onAfterRender=function(){for(var o,c,l,a,n,r,b,v,y,h=4*f,k=e/2,u=t.readPixels(0,0,f,e),s=0;k>s;s++)for(o=0;h>o;o++){var p=o+s*h,d=e-s-1,w=o+d*h,g=u[p];u[p]=u[w];u[w]=g}i||(i=document.createElement("canvas"));i.width=f;i.height=e;c=i.getContext("2d");l=c.createImageData(f,e);l.data.set(u);c.putImageData(l,0,0);a=i.toDataURL();"download"in document.createElement("a")?(n=window.document.createElement("a"),n.href=a,r=new Date,b=r.getFullYear()+"/"+r.getMonth()+"/"+r.getDate()+"-"+r.getHours()+":"+r.getMinutes(),n.setAttribute("download","screenshot-"+b+".png"),window.document.body.appendChild(n),n.addEventListener("click",function(){n.parentElement.removeChild(n)}),n.click()):(v=window.open(""),y=v.document.createElement("img"),y.src=a,v.document.body.appendChild(y))};s.render(!0);s.dispose();c&&(h.activeCamera=c)},o.ValidateXHRData=function(t,i){var r,u;"undefined"==typeof i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){if(r=n.Internals.TGATools.GetTGAHeader(t.response),r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i)return u=new Uint8Array(t.response,0,3),68==u[0]&&68==u[1]&&83==u[2]?!0:!1}catch(f){}return!1},Object.defineProperty(o,"NoneLogLevel",{get:function(){return o._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(o,"MessageLogLevel",{get:function(){return o._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(o,"WarningLogLevel",{get:function(){return o._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ErrorLogLevel",{get:function(){return o._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(o,"AllLogLevel",{get:function(){return o._MessageLogLevel|o._WarningLogLevel|o._ErrorLogLevel},enumerable:!0,configurable:!0}),o._FormatMessage=function(n){var t=function(n){return 10>n?"0"+n:""+n},i=new Date;return"BJS - ["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+n},o._LogDisabled=function(){},o._LogEnabled=function(n){console.log(o._FormatMessage(n))},o._WarnDisabled=function(){},o._WarnEnabled=function(n){console.warn(o._FormatMessage(n))},o._ErrorDisabled=function(){},o._ErrorEnabled=function(n){console.error(o._FormatMessage(n))},Object.defineProperty(o,"LogLevels",{set:function(n){o.Log=(n&o.MessageLogLevel)===o.MessageLogLevel?o._LogEnabled:o._LogDisabled;o.Warn=(n&o.WarningLogLevel)===o.WarningLogLevel?o._WarnEnabled:o._WarnDisabled;o.Error=(n&o.ErrorLogLevel)===o.ErrorLogLevel?o._ErrorEnabled:o._ErrorDisabled},enumerable:!0,configurable:!0}),o.BaseUrl="",o.GetExponantOfTwo=function(n,t){var i=1;do i*=2;while(n>i);return i>t&&(i=t),i},o._NoneLogLevel=0,o._MessageLogLevel=1,o._WarningLogLevel=2,o._ErrorLogLevel=4,o.Log=o._LogEnabled,o.Warn=o._WarnEnabled,o.Error=o._ErrorEnabled,o}();n.Tools=o}(BABYLON||(BABYLON={}));!function(n){var u=function(){function n(){this._isDepthTestDirty=!1;this._isDepthMaskDirty=!1;this._isDepthFuncDirty=!1;this._isCullFaceDirty=!1;this._isCullDirty=!1}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cullFace",{get:function(){return this._cullFace},set:function(n){this._cullFace!==n&&(this._cullFace=n,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cull",{get:function(){return this._cull},set:function(n){this._cull!==n&&(this._cull=n,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(n){this._depthFunc!==n&&(this._depthFunc=n,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"depthMask",{get:function(){return this._depthMask},set:function(n){this._depthMask!==n&&(this._depthMask=n,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"depthTest",{get:function(){return this._depthTest},set:function(n){this._depthTest!==n&&(this._depthTest=n,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),n.prototype.reset=function(){this._depthMask=!0;this._depthTest=!0;this._depthFunc=null;this._cull=null;this._cullFace=null;this._isDepthTestDirty=!0;this._isDepthMaskDirty=!0;this._isDepthFuncDirty=!1;this._isCullFaceDirty=!1;this._isCullDirty=!1},n.prototype.apply=function(n){this.isDirty&&(this._isCullDirty&&(this.cull===!0?n.enable(n.CULL_FACE):this.cull===!1&&n.disable(n.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(n.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(n.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest===!0?n.enable(n.DEPTH_TEST):this.depthTest===!1&&n.disable(n.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(n.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1))},n}(),t,s;n._DepthCullingState=u;t=function(){function n(){this._isAlphaBlendDirty=!1;this._isBlendFunctionParametersDirty=!1;this._alphaBlend=!1;this._blendFunctionParameters=new Array(4)}return Object.defineProperty(n.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(n){this._alphaBlend!==n&&(this._alphaBlend=n,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),n.prototype.setAlphaBlendFunctionParameters=function(n,t,i,r){(this._blendFunctionParameters[0]!==n||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=n,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},n.prototype.reset=function(){this._alphaBlend=!1;this._blendFunctionParameters[0]=null;this._blendFunctionParameters[1]=null;this._blendFunctionParameters[2]=null;this._blendFunctionParameters[3]=null;this._isAlphaBlendDirty=!0;this._isBlendFunctionParametersDirty=!1},n.prototype.apply=function(n){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend===!0?n.enable(n.BLEND):this._alphaBlend===!1&&n.disable(n.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(n.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},n}();n._AlphaState=t;var f=function(n,t,i,r){var u=n.createShader("vertex"===i?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(n.shaderSource(u,(r?r+"\n":"")+t),n.compileShader(u),!n.getShaderParameter(u,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(u));return u},i=function(t,i,r){var u=r.NEAREST,f=r.NEAREST;return t===n.Texture.BILINEAR_SAMPLINGMODE?(u=r.LINEAR,f=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===n.Texture.TRILINEAR_SAMPLINGMODE?(u=r.LINEAR,f=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===n.Texture.NEAREST_SAMPLINGMODE&&(u=r.NEAREST,f=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:f,mag:u}},r=function(t,r,u,f,e,o,s,h,c,l){var v;"undefined"==typeof l&&(l=n.Texture.TRILINEAR_SAMPLINGMODE);var a=u.getEngine(),y=n.Tools.GetExponantOfTwo(f,a.getCaps().maxTextureSize),p=n.Tools.GetExponantOfTwo(e,a.getCaps().maxTextureSize);r.bindTexture(r.TEXTURE_2D,t);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,void 0===o?1:o?1:0);c(y,p);v=i(l,!s,r);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,v.mag);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,v.min);s||h||r.generateMipmap(r.TEXTURE_2D);r.bindTexture(r.TEXTURE_2D,null);a._activeTexturesCache=[];t._baseWidth=f;t._baseHeight=e;t._width=y;t._height=p;t.isReady=!0;u._removePendingData(t)},e=function(t,i,r,u,f,o){var s,h=function(){r.push(s);u._removePendingData(s);i!=o.length-1?e(t,i+1,r,u,f,o):f(r)},c=function(){u._removePendingData(s)};s=n.Tools.LoadImage(t+o[i],h,c,u.database);u._addPendingData(s)},o=function(){function n(){}return n}();n.EngineCapabilities=o;s=function(){function s(n,i,r){var f=this;this.isFullscreen=!1;this.isPointerLock=!1;this.forceWireframe=!1;this.cullBackFaces=!0;this.renderEvenInBackground=!0;this.scenes=[];this._windowIsBackground=!1;this._runningLoop=!1;this._loadingDivBackgroundColor="black";this._depthCullingState=new u;this._alphaState=new t;this._loadedTexturesCache=[];this._activeTexturesCache=[];this._compiledEffects={};this._renderingCanvas=n;this._canvasClientRect=this._renderingCanvas.getBoundingClientRect();r=r||{};r.antialias=i;try{this._gl=n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}catch(e){throw new Error("WebGL not supported");}if(!this._gl)throw new Error("WebGL not supported");this._onBlur=function(){f._windowIsBackground=!0};this._onFocus=function(){f._windowIsBackground=!1};window.addEventListener("blur",this._onBlur);window.addEventListener("focus",this._onFocus);this._workingCanvas=document.createElement("canvas");this._workingContext=this._workingCanvas.getContext("2d");this._hardwareScalingLevel=1/(window.devicePixelRatio||1);this.resize();this._caps=new o;this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE);this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives");this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc");this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float");this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic");this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays");this.setDepthBuffer(!0);this.setDepthFunctionToLessOrEqual();this.setDepthWrite(!0);this._onFullscreenChange=function(){void 0!==document.fullscreen?f.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?f.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?f.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(f.isFullscreen=document.msIsFullScreen);f.isFullscreen&&f._pointerLockRequested&&(n.requestPointerLock=n.requestPointerLock||n.msRequestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock&&n.requestPointerLock())};document.addEventListener("fullscreenchange",this._onFullscreenChange,!1);document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1);this._onPointerLockChange=function(){f.isPointerLock=document.mozPointerLockElement===n||document.webkitPointerLockElement===n||document.msPointerLockElement===n||document.pointerLockElement===n};document.addEventListener("pointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1);document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1)}return Object.defineProperty(s,"ALPHA_DISABLE",{get:function(){return s._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(s,"ALPHA_ADD",{get:function(){return s._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(s,"ALPHA_COMBINE",{get:function(){return s._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DELAYLOADSTATE_NONE",{get:function(){return s._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DELAYLOADSTATE_LOADED",{get:function(){return s._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DELAYLOADSTATE_LOADING",{get:function(){return s._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DELAYLOADSTATE_NOTLOADED",{get:function(){return s._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(s,"Version",{get:function(){return"1.14.0"},enumerable:!0,configurable:!0}),s.prototype.getAspectRatio=function(n){var t=n.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},s.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},s.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},s.prototype.getRenderingCanvas=function(){return this._renderingCanvas},s.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},s.prototype.setHardwareScalingLevel=function(n){this._hardwareScalingLevel=n;this.resize()},s.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},s.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},s.prototype.getCaps=function(){return this._caps},s.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},s.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},s.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},s.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},s.prototype.stopRenderLoop=function(){this._renderFunction=null;this._runningLoop=!1},s.prototype._renderLoop=function(){var i=this,t=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1);t&&(this.beginFrame(),this._renderFunction&&this._renderFunction(),this.endFrame());this._runningLoop&&n.Tools.QueueNewFrame(function(){i._renderLoop()})},s.prototype.runRenderLoop=function(t){var i=this;this._runningLoop=!0;this._renderFunction=t;n.Tools.QueueNewFrame(function(){i._renderLoop()})},s.prototype.switchFullscreen=function(t){this.isFullscreen?n.Tools.ExitFullscreen():(this._pointerLockRequested=t,n.Tools.RequestFullscreen(this._renderingCanvas))},s.prototype.clear=function(n,t,i){this.applyStates();this._gl.clearColor(n.r,n.g,n.b,void 0!==n.a?n.a:1);this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT);i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT);this._gl.clear(r)},s.prototype.setViewport=function(n,t,i){var r=t||this._renderingCanvas.width,u=i||this._renderingCanvas.height,f=n.x||0,e=n.y||0;this._cachedViewport=n;this._gl.viewport(f*r,e*u,r*n.width,u*n.height)},s.prototype.setDirectViewport=function(n,t,i,r){this._cachedViewport=null;this._gl.viewport(n,t,i,r)},s.prototype.beginFrame=function(){n.Tools._MeasureFps()},s.prototype.endFrame=function(){this.flushFramebuffer()},s.prototype.resize=function(){this._renderingCanvas.width=this._renderingCanvas.clientWidth/this._hardwareScalingLevel;this._renderingCanvas.height=this._renderingCanvas.clientHeight/this._hardwareScalingLevel;this._canvasClientRect=this._renderingCanvas.getBoundingClientRect()},s.prototype.bindFramebuffer=function(n){this._currentRenderTarget=n;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,n._framebuffer);this._gl.viewport(0,0,n._width,n._height);this.wipeCaches()},s.prototype.unBindFramebuffer=function(n){if(this._currentRenderTarget=null,n.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,n);t.generateMipmap(t.TEXTURE_2D);t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},s.prototype.flushFramebuffer=function(){this._gl.flush()},s.prototype.restoreDefaultFramebuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);this.setViewport(this._cachedViewport);this.wipeCaches()},s.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null);this._cachedVertexBuffers=null},s.prototype.createVertexBuffer=function(n){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(n),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},s.prototype.createDynamicVertexBuffer=function(n){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},s.prototype.updateDynamicVertexBuffer=function(n,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,n);t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t));this._resetVertexBufferBinding()},s.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null);this._cachedIndexBuffer=null},s.prototype.createIndexBuffer=function(n){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t},s.prototype.bindBuffers=function(n,t,i,r,u){var e,f,o;if(this._cachedVertexBuffers!==n||this._cachedEffectForVertexBuffers!==u)for(this._cachedVertexBuffers=n,this._cachedEffectForVertexBuffers=u,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,n),e=0,f=0;f<i.length;f++)o=u.getAttributeLocation(f),o>=0&&this._gl.vertexAttribPointer(o,i[f],this._gl.FLOAT,!1,r,e),e+=4*i[f];this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t))},s.prototype.bindMultiBuffers=function(n,t,i){var f,r,e,u,o;if(this._cachedVertexBuffers!==n||this._cachedEffectForVertexBuffers!==i)for(this._cachedVertexBuffers=n,this._cachedEffectForVertexBuffers=i,f=i.getAttributesNames(),r=0;r<f.length;r++)if(e=i.getAttributeLocation(r),e>=0){if(u=n[f[r]],!u)continue;o=u.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,u.getBuffer());this._gl.vertexAttribPointer(e,o,this._gl.FLOAT,!1,4*o,0)}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t))},s.prototype._releaseBuffer=function(n){return n.references--,0===n.references?(this._gl.deleteBuffer(n),!0):!1},s.prototype.createInstancesBuffer=function(n){var t=this._gl.createBuffer();return t.capacity=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),t},s.prototype.deleteInstancesBuffer=function(n){this._gl.deleteBuffer(n)},s.prototype.updateAndBindInstancesBuffer=function(n,t,i){var r,u;for(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,n),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),r=0;4>r;r++)u=i[r],this._gl.enableVertexAttribArray(u),this._gl.vertexAttribPointer(u,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(u,1)},s.prototype.unBindInstancesBuffer=function(n,t){var i,r;for(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,n),i=0;4>i;i++)r=t[i],this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)},s.prototype.applyStates=function(){this._depthCullingState.apply(this._gl);this._alphaState.apply(this._gl)},s.prototype.draw=function(n,t,i,r){return this.applyStates(),r?void this._caps.instancedArrays.drawElementsInstancedANGLE(n?this._gl.TRIANGLES:this._gl.LINES,i,this._gl.UNSIGNED_SHORT,2*t,r):void this._gl.drawElements(n?this._gl.TRIANGLES:this._gl.LINES,i,this._gl.UNSIGNED_SHORT,2*t)},s.prototype._releaseEffect=function(n){this._compiledEffects[n._key]&&(delete this._compiledEffects[n._key],n.getProgram()&&this._gl.deleteProgram(n.getProgram()))},s.prototype.createEffect=function(t,i,r,u,f,e,o,s){var l=t.vertexElement||t.vertex||t,a=t.fragmentElement||t.fragment||t,h=l+"+"+a+"@"+f,c;return this._compiledEffects[h]?this._compiledEffects[h]:(c=new n.Effect(t,i,r,u,this,f,e,o,s),c._key=h,this._compiledEffects[h]=c,c)},s.prototype.createEffectForParticles=function(n,t,i,r,u,f,e){return"undefined"==typeof t&&(t=[]),"undefined"==typeof i&&(i=[]),"undefined"==typeof r&&(r=""),this.createEffect({vertex:"particles",fragmentElement:n},["position","color","options"],["view","projection"].concat(t),["diffuseSampler"].concat(i),r,u,f,e)},s.prototype.createShaderProgram=function(n,t,i){var e=f(this._gl,n,"vertex",i),o=f(this._gl,t,"fragment",i),r=this._gl.createProgram(),s,u;if(this._gl.attachShader(r,e),this._gl.attachShader(r,o),this._gl.linkProgram(r),s=this._gl.getProgramParameter(r,this._gl.LINK_STATUS),!s&&(u=this._gl.getProgramInfoLog(r),u))throw new Error(u);return this._gl.deleteShader(e),this._gl.deleteShader(o),r},s.prototype.getUniforms=function(n,t){for(var r=[],i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(n,t[i]));return r},s.prototype.getAttributes=function(n,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(n,t[r]))}catch(u){i.push(-1)}return i},s.prototype.enableEffect=function(n){var t,u,i,r;if(n&&n.getAttributesCount()&&this._currentEffect!==n){this._vertexAttribArrays=this._vertexAttribArrays||[];this._gl.useProgram(n.getProgram());for(t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(u=n.getAttributesCount(),i=0;u>i;i++)r=n.getAttributeLocation(i),r>=0&&(this._vertexAttribArrays[r]=!0,this._gl.enableVertexAttribArray(r));this._currentEffect=n}},s.prototype.setArray=function(n,t){n&&this._gl.uniform1fv(n,t)},s.prototype.setMatrices=function(n,t){n&&this._gl.uniformMatrix4fv(n,!1,t)},s.prototype.setMatrix=function(n,t){n&&this._gl.uniformMatrix4fv(n,!1,t.toArray())},s.prototype.setFloat=function(n,t){n&&this._gl.uniform1f(n,t)},s.prototype.setFloat2=function(n,t,i){n&&this._gl.uniform2f(n,t,i)},s.prototype.setFloat3=function(n,t,i,r){n&&this._gl.uniform3f(n,t,i,r)},s.prototype.setBool=function(n,t){n&&this._gl.uniform1i(n,t)},s.prototype.setFloat4=function(n,t,i,r,u){n&&this._gl.uniform4f(n,t,i,r,u)},s.prototype.setColor3=function(n,t){n&&this._gl.uniform3f(n,t.r,t.g,t.b)},s.prototype.setColor4=function(n,t,i){n&&this._gl.uniform4f(n,t.r,t.g,t.b,i)},s.prototype.setState=function(n,t){(this._depthCullingState.cull!==n||t)&&(n?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1)},s.prototype.setDepthBuffer=function(n){this._depthCullingState.depthTest=n},s.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},s.prototype.setDepthWrite=function(n){this._depthCullingState.depthMask=n},s.prototype.setColorWrite=function(n){this._gl.colorMask(n,n,n,n)},s.prototype.setAlphaMode=function(t){switch(t){case n.Engine.ALPHA_DISABLE:this.setDepthWrite(!0);this._alphaState.alphaBlend=!1;break;case n.Engine.ALPHA_COMBINE:this.setDepthWrite(!1);this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case n.Engine.ALPHA_ADD:this.setDepthWrite(!1);this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0}},s.prototype.setAlphaTesting=function(n){this._alphaTest=n},s.prototype.getAlphaTesting=function(){return this._alphaTest},s.prototype.wipeCaches=function(){this._activeTexturesCache=[];this._currentEffect=null;this._depthCullingState.reset();this._alphaState.reset();this._cachedVertexBuffers=null;this._cachedIndexBuffer=null;this._cachedEffectForVertexBuffers=null},s.prototype.setSamplingMode=function(t,i){var r=this._gl,u,f;r.bindTexture(r.TEXTURE_2D,t);u=r.NEAREST;f=r.NEAREST;i===n.Texture.BILINEAR_SAMPLINGMODE?(u=r.LINEAR,f=r.LINEAR):i===n.Texture.TRILINEAR_SAMPLINGMODE&&(u=r.LINEAR,f=r.LINEAR_MIPMAP_LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,u);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,f);r.bindTexture(r.TEXTURE_2D,null)},s.prototype.createTexture=function(t,i,u,f,e,o,s,h){var c=this,p,l,a,w,k,d,y,v,b;return"undefined"==typeof e&&(e=n.Texture.TRILINEAR_SAMPLINGMODE),"undefined"==typeof o&&(o=null),"undefined"==typeof s&&(s=null),"undefined"==typeof h&&(h=null),l=this._gl.createTexture(),a=!1,("data:"===t.substr(0,5)&&(a=!0),a)?(w=t,a=w.split(":"),t=w,p=a[1].substr(a[1].length-4,4).toLowerCase()):p=t.substr(t.length-4,4).toLowerCase(),k=this.getCaps().s3tc&&".dds"===p,d=".tga"===p,f._addPendingData(l),l.url=t,l.noMipmap=i,l.references=1,this._loadedTexturesCache.push(l),y=function(){f._removePendingData(l);s&&s()},d?(v=function(t){var s=new Uint8Array(t),h=n.Internals.TGATools.GetTGAHeader(s);r(l,c._gl,f,h.width,h.height,u,i,!1,function(){n.Internals.TGATools.UploadContent(c._gl,s);o&&o()},e)},a instanceof Array?v(h):n.Tools.LoadFile(t,function(n){v(n)},y,f.database,!0)):k?(v=function(t){var s=n.Internals.DDSTools.GetDDSInfo(t),h=(s.isRGB||s.isLuminance||s.mipmapCount>1)&&!i&&s.width>>s.mipmapCount-1==1;r(l,c._gl,f,s.width,s.height,u,!h,s.isFourCC,function(){n.Internals.DDSTools.UploadDDSLevels(c._gl,c.getCaps().s3tc,t,s,h,1);o&&o()},e)},a instanceof Array?v(h):n.Tools.LoadFile(t,function(n){v(n)},y,f.database,!0)):(b=function(n){r(l,c._gl,f,n.width,n.height,u,i,!1,function(t,i){var r=n.width==t&&n.height==i;r||(c._workingCanvas.width=t,c._workingCanvas.height=i,c._workingContext.drawImage(n,0,0,n.width,n.height,0,0,t,i));c._gl.texImage2D(c._gl.TEXTURE_2D,0,c._gl.RGBA,c._gl.RGBA,c._gl.UNSIGNED_BYTE,r?n:c._workingCanvas);o&&o()},e)},a instanceof Array?n.Tools.LoadImage(h,b,y,f.database):n.Tools.LoadImage(t,b,y,f.database)),l},s.prototype.createDynamicTexture=function(t,r,u,f){var e=this._gl.createTexture(),o;return t=n.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),r=n.Tools.GetExponantOfTwo(r,this._caps.maxTextureSize),this._gl.bindTexture(this._gl.TEXTURE_2D,e),o=i(f,u,this._gl),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,o.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,o.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e._baseWidth=t,e._baseHeight=r,e._width=t,e._height=r,e.isReady=!1,e.generateMipMaps=u,e.references=1,this._loadedTexturesCache.push(e),e},s.prototype.updateDynamicTexture=function(n,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,n);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);n.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._activeTexturesCache=[];n.isReady=!0},s.prototype.updateVideoTexture=function(n,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,n);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1);t.videoWidth!==n._width||t.videoHeight!==n._height?(n._workingCanvas||(n._workingCanvas=document.createElement("canvas"),n._workingContext=n._workingCanvas.getContext("2d"),n._workingCanvas.width=n._width,n._workingCanvas.height=n._height),n._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,n._width,n._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n._workingCanvas)):this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);n.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._activeTexturesCache=[];n.isReady=!0},s.prototype.createRenderTargetTexture=function(t,r){var s=!1,e=!0,a=n.Texture.TRILINEAR_SAMPLINGMODE,u,f,o,l;void 0!==r&&(s=void 0===r.generateMipMaps?r:r.generateMipmaps,e=void 0===r.generateDepthBuffer?!0:r.generateDepthBuffer,void 0!==r.samplingMode&&(a=r.samplingMode));u=this._gl;f=u.createTexture();u.bindTexture(u.TEXTURE_2D,f);var h=t.width||t,c=t.height||t,v=i(a,s,u);return u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,v.mag),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,v.min),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,h,c,0,u.RGBA,u.UNSIGNED_BYTE,null),e&&(o=u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,o),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,h,c)),l=u.createFramebuffer(),u.bindFramebuffer(u.FRAMEBUFFER,l),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,f,0),e&&u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null),f._framebuffer=l,e&&(f._depthBuffer=o),f._width=h,f._height=c,f.isReady=!0,f.generateMipMaps=s,f.references=1,this._activeTexturesCache=[],this._loadedTexturesCache.push(f),f},s.prototype.createCubeTexture=function(t,i,r,u){var s=this,f=this._gl,o=f.createTexture(),h,c;return o.isCube=!0,o.url=t,o.references=1,this._loadedTexturesCache.push(o),h=t.substr(t.length-4,4).toLowerCase(),c=this.getCaps().s3tc&&".dds"===h,c?n.Tools.LoadFile(t,function(t){var i=n.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!u;f.bindTexture(f.TEXTURE_CUBE_MAP,o);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1);n.Internals.DDSTools.UploadDDSLevels(s._gl,s.getCaps().s3tc,t,i,r,6);u||i.isFourCC||1!=i.mipmapCount||f.generateMipmap(f.TEXTURE_CUBE_MAP);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,r?f.LINEAR_MIPMAP_LINEAR:f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(f.TEXTURE_CUBE_MAP,null);s._activeTexturesCache=[];o._width=i.width;o._height=i.height;o.isReady=!0},null,null,!0):e(t,0,[],i,function(t){var r=n.Tools.GetExponantOfTwo(t[0].width,s._caps.maxCubemapTextureSize),e=r,h,i;for(s._workingCanvas.width=r,s._workingCanvas.height=e,h=[f.TEXTURE_CUBE_MAP_POSITIVE_X,f.TEXTURE_CUBE_MAP_POSITIVE_Y,f.TEXTURE_CUBE_MAP_POSITIVE_Z,f.TEXTURE_CUBE_MAP_NEGATIVE_X,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,f.TEXTURE_CUBE_MAP_NEGATIVE_Z],f.bindTexture(f.TEXTURE_CUBE_MAP,o),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),i=0;i<h.length;i++)s._workingContext.drawImage(t[i],0,0,t[i].width,t[i].height,0,0,r,e),f.texImage2D(h[i],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,s._workingCanvas);u||f.generateMipmap(f.TEXTURE_CUBE_MAP);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,u?f.LINEAR:f.LINEAR_MIPMAP_LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(f.TEXTURE_CUBE_MAP,null);s._activeTexturesCache=[];o._width=r;o._height=e;o.isReady=!0},r),o},s.prototype._releaseTexture=function(n){var i=this._gl,t,r;for(n._framebuffer&&i.deleteFramebuffer(n._framebuffer),n._depthBuffer&&i.deleteRenderbuffer(n._depthBuffer),i.deleteTexture(n),t=0;t<this._caps.maxTexturesImageUnits;t++)this._gl.activeTexture(this._gl["TEXTURE"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null;r=this._loadedTexturesCache.indexOf(n);-1!==r&&this._loadedTexturesCache.splice(r,1)},s.prototype.bindSamplers=function(n){var i,t,r;for(this._gl.useProgram(n.getProgram()),i=n.getSamplers(),t=0;t<i.length;t++)r=n.getUniform(i[t]),this._gl.uniform1i(r,t);this._currentEffect=null},s.prototype._bindTexture=function(n,t){this._gl.activeTexture(this._gl["TEXTURE"+n]);this._gl.bindTexture(this._gl.TEXTURE_2D,t);this._activeTexturesCache[n]=null},s.prototype.setTextureFromPostProcess=function(n,t){this._bindTexture(n,t._textures.data[t._currentRenderTextureInd])},s.prototype.setTexture=function(t,i){var r,u;if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl["TEXTURE"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof n.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState==n.Engine.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!=i)if(this._activeTexturesCache[t]=i,r=i.getInternalTexture(),this._gl.activeTexture(this._gl["TEXTURE"+t]),r.isCube)(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode)&&(r._cachedCoordinatesMode=i.coordinatesMode,u=i.coordinatesMode!==n.Texture.CUBIC_MODE&&i.coordinatesMode!==n.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE,this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,u),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,u)),this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i);else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case n.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case n.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case n.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case n.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case n.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case n.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}},s.prototype._setAnisotropicLevel=function(n,t){var i=this._caps.textureAnisotropicFilterExtension;i&&t._cachedAnisotropicFilteringLevel!==t.anisotropicFilteringLevel&&(this._gl.texParameterf(n,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropicFilteringLevel,this._caps.maxAnisotropy)),t._cachedAnisotropicFilteringLevel=t.anisotropicFilteringLevel)},s.prototype.readPixels=function(n,t,i,r){var u=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,u),u},s.prototype.dispose=function(){var t,n;for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();for(t in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[t]._program);for(n in this._vertexAttribArrays)n>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[n]||this._gl.disableVertexAttribArray(n);window.removeEventListener("blur",this._onBlur);window.removeEventListener("focus",this._onFocus);document.removeEventListener("fullscreenchange",this._onFullscreenChange);document.removeEventListener("mozfullscreenchange",this._onFullscreenChange);document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange);document.removeEventListener("msfullscreenchange",this._onFullscreenChange);document.removeEventListener("pointerlockchange",this._onPointerLockChange);document.removeEventListener("mspointerlockchange",this._onPointerLockChange);document.removeEventListener("mozpointerlockchange",this._onPointerLockChange);document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},s.prototype.displayLoadingUI=function(){var i=this,n,r,u,t;this._loadingDiv=document.createElement("div");this._loadingDiv.style.opacity="0";this._loadingDiv.style.transition="opacity 1.5s ease";this._loadingTextDiv=document.createElement("div");this._loadingTextDiv.style.position="absolute";this._loadingTextDiv.style.left="0";this._loadingTextDiv.style.top="50%";this._loadingTextDiv.style.marginTop="80px";this._loadingTextDiv.style.width="100%";this._loadingTextDiv.style.height="20px";this._loadingTextDiv.style.fontFamily="Arial";this._loadingTextDiv.style.fontSize="14px";this._loadingTextDiv.style.color="white";this._loadingTextDiv.style.textAlign="center";this._loadingTextDiv.innerHTML="Loading";this._loadingDiv.appendChild(this._loadingTextDiv);n=new Image;n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==";n.style.position="absolute";n.style.left="50%";n.style.top="50%";n.style.marginLeft="-50px";n.style.marginTop="-50px";n.style.transition="transform 1.0s ease";n.style.webkitTransition="-webkit-transform 1.0s ease";r=360;u=function(){r+=360;n.style.transform="rotateZ("+r+"deg)";n.style.webkitTransform="rotateZ("+r+"deg)"};n.addEventListener("transitionend",u);n.addEventListener("webkitTransitionEnd",u);this._loadingDiv.appendChild(n);t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=";t.style.position="absolute";t.style.left="50%";t.style.top="50%";t.style.marginLeft="-50px";t.style.marginTop="-50px";this._loadingDiv.appendChild(t);this._resizeLoadingUI=function(){var n=i.getRenderingCanvasClientRect();i._loadingDiv.style.position="absolute";i._loadingDiv.style.left=n.left+"px";i._loadingDiv.style.top=n.top+"px";i._loadingDiv.style.width=n.width+"px";i._loadingDiv.style.height=n.height+"px"};this._resizeLoadingUI();window.addEventListener("resize",this._resizeLoadingUI);this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;document.body.appendChild(this._loadingDiv);setTimeout(function(){i._loadingDiv.style.opacity="1";n.style.transform="rotateZ(360deg)";n.style.webkitTransform="rotateZ(360deg)"},0)},Object.defineProperty(s.prototype,"loadingUIText",{set:function(n){this._loadingDiv&&(this._loadingTextDiv.innerHTML=n)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(n){this._loadingDivBackgroundColor=n;this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),s.prototype.hideLoadingUI=function(){var n=this,t;this._loadingDiv&&(t=function(){n._loadingDiv&&(document.body.removeChild(n._loadingDiv),window.removeEventListener("resize",n._resizeLoadingUI),n._loadingDiv=null)},this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",t))},s.isSupported=function(){try{var n=document.createElement("canvas"),t=n.getContext("webgl")||n.getContext("experimental-webgl");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},s._ALPHA_DISABLE=0,s._ALPHA_ADD=1,s._ALPHA_COMBINE=2,s._DELAYLOADSTATE_NONE=0,s._DELAYLOADSTATE_LOADED=1,s._DELAYLOADSTATE_LOADING=2,s._DELAYLOADSTATE_NOTLOADED=4,s.Epsilon=.001,s.CollisionsEpsilon=.001,s.ShadersRepository="Babylon/Shaders/",s}();n.Engine=s}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t){this.state="";this.animations=[];this._childrenFlag=-1;this._isEnabled=!0;this._isReady=!0;this._currentRenderId=-1;this.name=n;this.id=n;this._scene=t;this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return n.Matrix.Identity()},t.prototype._initCache=function(){this._cache={};this._cache.parent=void 0},t.prototype.updateCache=function(n){(n||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(){},t.prototype._isSynchronized=function(){return!0},t.prototype.isSynchronizedWithParent=function(){return this.parent?this.parent._currentRenderId<=this._currentRenderId:!0},t.prototype.isSynchronized=function(n){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),n&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(n){return this._cache.parent===this.parent?!1:(n&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(n){this._isEnabled=n},t.prototype.isDescendantOf=function(n){return this.parent?this.parent===n?!0:this.parent.isDescendantOf(n):!1},t.prototype._getDescendants=function(n,t){for(var r,i=0;i<n.length;i++)r=n[i],r.isDescendantOf(this)&&t.push(r)},t.prototype.getDescendants=function(){var n=[];return this._getDescendants(this._scene.meshes,n),this._getDescendants(this._scene.lights,n),this._getDescendants(this._scene.cameras,n),n},t.prototype._setReady=function(n){if(n!=this._isReady){if(!n)return void(this._isReady=!1);this._isReady=!0;this.onReady&&this.onReady(this)}},t}();n.Node=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){this.minimum=t;this.maximum=i;this._tempRadiusVector=n.Vector3.Zero();var r=n.Vector3.Distance(t,i);this.center=n.Vector3.Lerp(t,i,.5);this.radius=.5*r;this.centerWorld=n.Vector3.Zero();this._update(n.Matrix.Identity())}return t.prototype._update=function(t){n.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld);n.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector);this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(n){for(var t=0;6>t;t++)if(n[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,u=this.centerWorld.z-t.z,f=Math.sqrt(i*i+r*r+u*u);return Math.abs(this.radiusWorld-f)<n.Engine.Epsilon?!1:!0},t.Intersects=function(n,t){var i=n.centerWorld.x-t.centerWorld.x,r=n.centerWorld.y-t.centerWorld.y,u=n.centerWorld.z-t.centerWorld.z,f=Math.sqrt(i*i+r*r+u*u);return n.radiusWorld+t.radiusWorld<f?!1:!0},t}();n.BoundingSphere=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){this.minimum=t;this.maximum=i;this.vectors=[];this.vectorsWorld=[];this.vectors.push(this.minimum.clone());this.vectors.push(this.maximum.clone());this.vectors.push(this.minimum.clone());this.vectors[2].x=this.maximum.x;this.vectors.push(this.minimum.clone());this.vectors[3].y=this.maximum.y;this.vectors.push(this.minimum.clone());this.vectors[4].z=this.maximum.z;this.vectors.push(this.maximum.clone());this.vectors[5].z=this.minimum.z;this.vectors.push(this.maximum.clone());this.vectors[6].x=this.minimum.x;this.vectors.push(this.maximum.clone());this.vectors[7].y=this.minimum.y;this.center=this.maximum.add(this.minimum).scale(.5);this.extendSize=this.maximum.subtract(this.minimum).scale(.5);this.directions=[n.Vector3.Zero(),n.Vector3.Zero(),n.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=n.Vector3.Zero();this.minimumWorld=n.Vector3.Zero();this.maximumWorld=n.Vector3.Zero();this._update(n.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){var r,i;for(n.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),n.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld),r=0;r<this.vectors.length;r++)i=this.vectorsWorld[r],n.Vector3.TransformCoordinatesToRef(this.vectors[r],t,i),i.x<this.minimumWorld.x&&(this.minimumWorld.x=i.x),i.y<this.minimumWorld.y&&(this.minimumWorld.y=i.y),i.z<this.minimumWorld.z&&(this.minimumWorld.z=i.z),i.x>this.maximumWorld.x&&(this.maximumWorld.x=i.x),i.y>this.maximumWorld.y&&(this.maximumWorld.y=i.y),i.z>this.maximumWorld.z&&(this.maximumWorld.z=i.z);this.maximumWorld.addToRef(this.minimumWorld,this.center);this.center.scaleInPlace(.5);n.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]);n.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]);n.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]);this._worldMatrix=t},t.prototype.isInFrustum=function(n){return t.IsInFrustum(this.vectorsWorld,n)},t.prototype.intersectsPoint=function(t){var i=n.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(n){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,n.centerWorld,n.radiusWorld)},t.prototype.intersectsMinMax=function(n,t){return this.maximumWorld.x<n.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<n.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<n.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(n,t){return n.maximumWorld.x<t.minimumWorld.x||n.minimumWorld.x>t.maximumWorld.x?!1:n.maximumWorld.y<t.minimumWorld.y||n.minimumWorld.y>t.maximumWorld.y?!1:n.maximumWorld.z<t.minimumWorld.z||n.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,u){var f=n.Vector3.Clamp(r,t,i),e=n.Vector3.DistanceSquared(r,f);return u*u>=e},t.IsInFrustum=function(n,t){for(var u,r,i=0;6>i;i++){for(u=8,r=0;8>r&&t[i].dotCoordinate(n[r])<0;r++)--u;if(0==u)return!1}return!0},t}();n.BoundingBox=t}(BABYLON||(BABYLON={}));!function(n){var i=function(t,i){var r=n.Vector3.Dot(i.center,t),f=Math.abs(n.Vector3.Dot(i.directions[0],t))*i.extendSize.x,e=Math.abs(n.Vector3.Dot(i.directions[1],t))*i.extendSize.y,o=Math.abs(n.Vector3.Dot(i.directions[2],t))*i.extendSize.z,u=f+e+o;return{min:r-u,max:r+u}},r=function(n,t,i,r){return!(n>r||i>t)},t=function(n,t,u){var f=i(n,t),e=i(n,u);return r(f.min,f.max,e.min,e.max)},u=function(){function i(t,i){this.minimum=t;this.maximum=i;this.boundingBox=new n.BoundingBox(t,i);this.boundingSphere=new n.BoundingSphere(t,i)}return i.prototype._update=function(n){this.boundingBox._update(n);this.boundingSphere._update(n)},i.prototype.isInFrustum=function(n){return this.boundingSphere.isInFrustum(n)?this.boundingBox.isInFrustum(n):!1},i.prototype._checkCollision=function(n){return n._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},i.prototype.intersectsPoint=function(n){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(n)&&this.boundingBox.intersectsPoint(n)?!0:!1},i.prototype.intersects=function(i,r){if(!this.boundingSphere.centerWorld||!i.boundingSphere.centerWorld||!n.BoundingSphere.Intersects(this.boundingSphere,i.boundingSphere)||!n.BoundingBox.Intersects(this.boundingBox,i.boundingBox))return!1;if(!r)return!0;var u=this.boundingBox,f=i.boundingBox;return t(u.directions[0],u,f)&&t(u.directions[1],u,f)&&t(u.directions[2],u,f)&&t(f.directions[0],u,f)&&t(f.directions[1],u,f)&&t(f.directions[2],u,f)&&t(n.Vector3.Cross(u.directions[0],f.directions[0]),u,f)&&t(n.Vector3.Cross(u.directions[0],f.directions[1]),u,f)&&t(n.Vector3.Cross(u.directions[0],f.directions[2]),u,f)&&t(n.Vector3.Cross(u.directions[1],f.directions[0]),u,f)&&t(n.Vector3.Cross(u.directions[1],f.directions[1]),u,f)&&t(n.Vector3.Cross(u.directions[1],f.directions[2]),u,f)&&t(n.Vector3.Cross(u.directions[2],f.directions[0]),u,f)&&t(n.Vector3.Cross(u.directions[2],f.directions[1]),u,f)&&t(n.Vector3.Cross(u.directions[2],f.directions[2]),u,f)?!0:!1},i}();n.BoundingInfo=u}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.diffuse=new n.Color3(1,1,1);this.specular=new n.Color3(1,1,1);this.intensity=1;this.range=Number.MAX_VALUE;this.includedOnlyMeshes=[];this.excludedMeshes=[];this._excludedMeshesIds=[];this._includedOnlyMeshesIds=[];r.lights.push(this)}return __extends(i,t),i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.transferToEffect=function(){},i.prototype._getWorldMatrix=function(){return n.Matrix.Identity()},i.prototype.canAffectMesh=function(n){return n?this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(n)?!1:this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(n)?!1:!0:!0},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=n.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._parentedWorldMatrix):t},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null);var n=this.getScene().lights.indexOf(this);this.getScene().lights.splice(n,1)},i}(n.Node);n.Light=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r){t.call(this,n,r);this.position=i}return __extends(i,t),i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=n.Vector3.Zero()),n.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void t.setFloat4(i,this.position.x,this.position.y,this.position.z,0)},i.prototype.getShadowGenerator=function(){return null},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),n.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(n.Light);n.PointLight=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r,u,f,e){t.call(this,n,e);this.position=i;this.direction=r;this.angle=u;this.exponent=f}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=n.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.transferToEffect=function(t,i,r){var u,f;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=n.Vector3.Zero()),this._transformedPosition||(this._transformedPosition=n.Vector3.Zero()),f=this.parent.getWorldMatrix(),n.Vector3.TransformCoordinatesToRef(this.position,f,this._transformedPosition),n.Vector3.TransformNormalToRef(this.direction,f,this._transformedDirection),t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,this.exponent),u=n.Vector3.Normalize(this._transformedDirection)):(t.setFloat4(i,this.position.x,this.position.y,this.position.z,this.exponent),u=n.Vector3.Normalize(this.direction));t.setFloat4(r,u.x,u.y,u.z,Math.cos(.5*this.angle))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),n.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(n.Light);n.SpotLight=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r){t.call(this,n,r);this.direction=i;this.position=i.scale(-1)}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=n.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype._computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=n.Vector3.Zero()),n.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=n.Vector3.Zero()),n.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(i,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(i,this.direction.x,this.direction.y,this.direction.z,1)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),n.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(n.Light);n.DirectionalLight=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(i,r){var u=this,f;this.filter=t.FILTER_VARIANCESHADOWMAP;this._darkness=0;this._transparencyShadow=!1;this._viewMatrix=n.Matrix.Zero();this._projectionMatrix=n.Matrix.Zero();this._transformMatrix=n.Matrix.Zero();this._worldViewProjection=n.Matrix.Zero();this._light=r;this._scene=r.getScene();r._shadowGenerator=this;this._shadowMap=new n.RenderTargetTexture(r.name+"_shadowMap",i,this._scene,!1);this._shadowMap.wrapU=n.Texture.CLAMP_ADDRESSMODE;this._shadowMap.wrapV=n.Texture.CLAMP_ADDRESSMODE;this._shadowMap.renderParticles=!1;f=function(t){var i=t.getRenderingMesh(),a=u._scene,f=a.getEngine(),r,s,e,h,c,o,l;if(f.setState(t.getMaterial().backFaceCulling),r=i._getInstancesRenderList(t._id),!r.mustReturn)if(s=null!==f.getCaps().instancedArrays&&null!==r.visibleInstances[t._id],u.isReady(t,s)){if(f.enableEffect(u._effect),i._bind(t,u._effect,!1),e=t.getMaterial(),(u._effect.setMatrix("viewProjection",u.getTransformMatrix()),e&&e.needAlphaTesting())&&(h=e.getAlphaTestTexture(),u._effect.setTexture("diffuseSampler",h),u._effect.setMatrix("diffuseMatrix",h.getTextureMatrix())),c=i.skeleton&&i.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&i.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind),c&&u._effect.setMatrices("mBones",i.skeleton.getTransformMatrices()),s)i._renderWithInstances(t,!1,r,u._effect,f);else if(r.renderSelf[t._id]&&(u._effect.setMatrix("world",i.getWorldMatrix()),i._draw(t,!0)),r.visibleInstances[t._id])for(o=0;o<r.visibleInstances[t._id].length;o++)l=r.visibleInstances[t._id][o],u._effect.setMatrix("world",l.getWorldMatrix()),i._draw(t,!0)}else u._shadowMap.resetRefreshCounter()};this._shadowMap.customRenderFunction=function(n,t,i){for(var r=0;r<n.length;r++)f(n.data[r]);for(r=0;r<t.length;r++)f(t.data[r]);if(u._transparencyShadow)for(r=0;r<i.length;r++)f(i.data[r])}}return Object.defineProperty(t,"FILTER_NONE",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_VARIANCESHADOWMAP",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_POISSONSAMPLING",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP},set:function(n){this.filter=n?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING},set:function(n){this.filter=n?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var u=[],e;this.useVarianceShadowMap&&u.push("#define VSM");var r=[n.VertexBuffer.PositionKind],f=t.getMesh(),o=t.getMaterial();return o&&o.needAlphaTesting()&&(u.push("#define ALPHATEST"),f.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(r.push(n.VertexBuffer.UVKind),u.push("#define UV1")),f.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(r.push(n.VertexBuffer.UV2Kind),u.push("#define UV2"))),f.skeleton&&f.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&f.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(r.push(n.VertexBuffer.MatricesIndicesKind),r.push(n.VertexBuffer.MatricesWeightsKind),u.push("#define BONES"),u.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))),i&&(u.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3")),e=u.join("\n"),this._cachedDefines!=e&&(this._cachedDefines=e,this._effect=this._scene.getEngine().createEffect("shadowMap",r,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],e)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._light.position,i=this._light.direction,r;return(this._light._computeTransformedPosition()&&(t=this._light._transformedPosition),this._cachedPosition&&this._cachedDirection&&t.equals(this._cachedPosition)&&i.equals(this._cachedDirection))||(this._cachedPosition=t.clone(),this._cachedDirection=i.clone(),r=this._scene.activeCamera,n.Matrix.LookAtLHToRef(t,this._light.position.add(i),n.Vector3.Up(),this._viewMatrix),n.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,r.minZ,r.maxZ,this._projectionMatrix),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(n){this._darkness=n>=1?1:0>=n?0:n},t.prototype.setTransparencyShadow=function(n){this._transparencyShadow=n},t.prototype.dispose=function(){this._shadowMap.dispose()},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t}();n.ShadowGenerator=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){t.call(this,i,u);this.direction=r;this.groundColor=new n.Color3(0,0,0)}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=n.Vector3.Normalize(t.subtract(n.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i,r){var u=n.Vector3.Normalize(this.direction);t.setFloat4(i,u.x,u.y,u.z,0);t.setColor3(r,this.groundColor.scale(this.intensity))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),this._worldMatrix},i}(n.Light);n.HemisphericLight=t}(BABYLON||(BABYLON={}));!function(n){var i=function(n,t,i,r){return n.x>i.x+r?!1:i.x-r>t.x?!1:n.y>i.y+r?!1:i.y-r>t.y?!1:n.z>i.z+r?!1:i.z-r>t.z?!1:!0},t=function(n,t,i,r){var o=t*t-4*n*i,u={root:0,found:!1},h;if(0>o)return u;var s=Math.sqrt(o),f=(-t-s)/(2*n),e=(-t+s)/(2*n);return f>e&&(h=e,e=f,f=h),f>0&&r>f?(u.root=f,u.found=!0,u):e>0&&r>e?(u.root=e,u.found=!0,u):u},r=function(){function r(){this.radius=new n.Vector3(1,1,1);this.retry=0;this.basePointWorld=n.Vector3.Zero();this.velocityWorld=n.Vector3.Zero();this.normalizedVelocity=n.Vector3.Zero();this._collisionPoint=n.Vector3.Zero();this._planeIntersectionPoint=n.Vector3.Zero();this._tempVector=n.Vector3.Zero();this._tempVector2=n.Vector3.Zero();this._tempVector3=n.Vector3.Zero();this._tempVector4=n.Vector3.Zero();this._edge=n.Vector3.Zero();this._baseToVertex=n.Vector3.Zero();this._destinationPoint=n.Vector3.Zero();this._slidePlaneNormal=n.Vector3.Zero();this._displacementVector=n.Vector3.Zero()}return r.prototype._initialize=function(t,i,r){this.velocity=i;n.Vector3.NormalizeToRef(i,this.normalizedVelocity);this.basePoint=t;t.multiplyToRef(this.radius,this.basePointWorld);i.multiplyToRef(this.radius,this.velocityWorld);this.velocityWorldLength=this.velocityWorld.length();this.epsilon=r;this.collisionFound=!1},r.prototype._checkPointInTriangle=function(t,i,r,u,f){i.subtractToRef(t,this._tempVector);r.subtractToRef(t,this._tempVector2);n.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var e=n.Vector3.Dot(this._tempVector4,f);return 0>e?!1:(u.subtractToRef(t,this._tempVector3),n.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),e=n.Vector3.Dot(this._tempVector4,f),0>e?!1:(n.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),e=n.Vector3.Dot(this._tempVector4,f),e>=0))},r.prototype._canDoCollision=function(t,r,u,f){var o=n.Vector3.Distance(this.basePointWorld,t),e=Math.max(this.radius.x,this.radius.y,this.radius.z);return o>this.velocityWorldLength+e+r?!1:i(u,f,this.basePointWorld,this.velocityWorldLength+e)?!0:!1},r.prototype._testTriangle=function(i,r,u,f,e){var a,rt=!1,k,nt,tt,d,ut,w,s,g,b,v,it;if(r._trianglePlanes||(r._trianglePlanes=[]),r._trianglePlanes[i]||(r._trianglePlanes[i]=new n.Plane(0,0,0,0),r._trianglePlanes[i].copyFromPoints(u,f,e)),k=r._trianglePlanes[i],r.getMaterial()||k.isFrontFacingTo(this.normalizedVelocity,0)){if(nt=k.signedDistanceTo(this.basePoint),tt=n.Vector3.Dot(k.normal,this.velocity),0==tt){if(Math.abs(nt)>=1)return;rt=!0;a=0}else{if(a=(-1-nt)/tt,d=(1-nt)/tt,a>d&&(ut=d,d=a,a=ut),a>1||0>d)return;0>a&&(a=0);a>1&&(a=1)}if(this._collisionPoint.copyFromFloats(0,0,0),w=!1,s=1,rt||(this.basePoint.subtractToRef(k.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(a,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,u,f,e,k.normal)&&(w=!0,s=a,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!w){g=this.velocity.lengthSquared();b=g;this.basePoint.subtractToRef(u,this._tempVector);var y=2*n.Vector3.Dot(this.velocity,this._tempVector),p=this._tempVector.lengthSquared()-1,o=t(b,y,p,s);o.found&&(s=o.root,w=!0,this._collisionPoint.copyFrom(u));this.basePoint.subtractToRef(f,this._tempVector);y=2*n.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1;o=t(b,y,p,s);o.found&&(s=o.root,w=!0,this._collisionPoint.copyFrom(f));this.basePoint.subtractToRef(e,this._tempVector);y=2*n.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1;o=t(b,y,p,s);o.found&&(s=o.root,w=!0,this._collisionPoint.copyFrom(e));f.subtractToRef(u,this._edge);u.subtractToRef(this.basePoint,this._baseToVertex);var h=this._edge.lengthSquared(),c=n.Vector3.Dot(this._edge,this.velocity),l=n.Vector3.Dot(this._edge,this._baseToVertex);(b=h*-g+c*c,y=2*h*n.Vector3.Dot(this.velocity,this._baseToVertex)-2*c*l,p=h*(1-this._baseToVertex.lengthSquared())+l*l,o=t(b,y,p,s),o.found)&&(v=(c*o.root-l)/h,v>=0&&1>=v&&(s=o.root,w=!0,this._edge.scaleInPlace(v),u.addToRef(this._edge,this._collisionPoint)));e.subtractToRef(f,this._edge);f.subtractToRef(this.basePoint,this._baseToVertex);h=this._edge.lengthSquared();c=n.Vector3.Dot(this._edge,this.velocity);l=n.Vector3.Dot(this._edge,this._baseToVertex);b=h*-g+c*c;y=2*h*n.Vector3.Dot(this.velocity,this._baseToVertex)-2*c*l;p=h*(1-this._baseToVertex.lengthSquared())+l*l;o=t(b,y,p,s);o.found&&(v=(c*o.root-l)/h,v>=0&&1>=v&&(s=o.root,w=!0,this._edge.scaleInPlace(v),f.addToRef(this._edge,this._collisionPoint)));u.subtractToRef(e,this._edge);e.subtractToRef(this.basePoint,this._baseToVertex);h=this._edge.lengthSquared();c=n.Vector3.Dot(this._edge,this.velocity);l=n.Vector3.Dot(this._edge,this._baseToVertex);b=h*-g+c*c;y=2*h*n.Vector3.Dot(this.velocity,this._baseToVertex)-2*c*l;p=h*(1-this._baseToVertex.lengthSquared())+l*l;o=t(b,y,p,s);o.found&&(v=(c*o.root-l)/h,v>=0&&1>=v&&(s=o.root,w=!0,this._edge.scaleInPlace(v),e.addToRef(this._edge,this._collisionPoint)))}w&&(it=s*this.velocity.length(),(!this.collisionFound||it<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=it,this.collisionFound=!0,this.collidedMesh=r.getMesh()))}},r.prototype._collide=function(n,t,i,r,u,f){for(var e=r;u>e;e+=3){var o=t[i[e]-f],s=t[i[e+1]-f],h=t[i[e+2]-f];this._testTriangle(e,n,h,s,o)}},r.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint);i.scaleInPlace(this.nearestDistance/i.length());this.basePoint.addToRef(i,t);t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal);this._slidePlaneNormal.normalize();this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector);t.addInPlace(this._displacementVector);this.intersectionPoint.addInPlace(this._displacementVector);this._slidePlaneNormal.scaleInPlace(n.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint));this._destinationPoint.subtractInPlace(this._slidePlaneNormal);this._destinationPoint.subtractToRef(this.intersectionPoint,i)},r}();n.Collider=r}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(r,u,f){t.call(this,r,f);this.position=u;this.upVector=n.Vector3.Up();this.orthoLeft=null;this.orthoRight=null;this.orthoBottom=null;this.orthoTop=null;this.fov=.8;this.minZ=1;this.maxZ=1e4;this.inertia=.9;this.mode=i.PERSPECTIVE_CAMERA;this.isIntermediate=!1;this.viewport=new n.Viewport(0,0,1,1);this.subCameras=[];this.layerMask=4294967295;this._computedViewMatrix=n.Matrix.Identity();this._projectionMatrix=new n.Matrix;this._postProcesses=[];this._postProcessesTakenIndices=[];f.cameras.push(this);f.activeCamera||(f.activeCamera=this)}return __extends(i,t),i.prototype._initCache=function(){t.prototype._initCache.call(this);this._cache.position=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.upVector=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.mode=void 0;this._cache.minZ=void 0;this._cache.maxZ=void 0;this._cache.fov=void 0;this._cache.aspectRatio=void 0;this._cache.orthoLeft=void 0;this._cache.orthoRight=void 0;this._cache.orthoBottom=void 0;this._cache.orthoTop=void 0;this._cache.renderWidth=void 0;this._cache.renderHeight=void 0},i.prototype._updateCache=function(n){n||t.prototype._updateCache.call(this);var i=this.getEngine();this._cache.position.copyFrom(this.position);this._cache.upVector.copyFrom(this.upVector);this._cache.mode=this.mode;this._cache.minZ=this.minZ;this._cache.maxZ=this.maxZ;this._cache.fov=this.fov;this._cache.aspectRatio=i.getAspectRatio(this);this._cache.orthoLeft=this.orthoLeft;this._cache.orthoRight=this.orthoRight;this._cache.orthoBottom=this.orthoBottom;this._cache.orthoTop=this.orthoTop;this._cache.renderWidth=i.getRenderWidth();this._cache.renderHeight=i.getRenderHeight()},i.prototype._updateFromScene=function(){this.updateCache();this._update()},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return t.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},i.prototype._isSynchronizedProjectionMatrix=function(){var i=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ,t;return i?(t=this.getEngine(),this.mode===n.Camera.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()):!1},i.prototype.attachControl=function(){},i.prototype.detachControl=function(){},i.prototype._update=function(){},i.prototype.attachPostProcess=function(t,i){var u,e,r,f,o;if("undefined"==typeof i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1)return n.Tools.Error("You're trying to reuse a post process not defined as reusable."),0;if(null==i||0>i)return this._postProcesses.push(t),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1;if(u=0,this._postProcesses[i]){for(e=this._postProcesses.length-1,r=e;r>=i+1;--r)this._postProcesses[r+1]=this._postProcesses[r];u=1}for(r=0;r<this._postProcessesTakenIndices.length;++r)if(!(this._postProcessesTakenIndices[r]<i)){for(e=this._postProcessesTakenIndices.length-1,f=e;f>=r;--f)this._postProcessesTakenIndices[f+1]=this._postProcessesTakenIndices[f]+u;this._postProcessesTakenIndices[r]=i;break}return u||-1!=this._postProcessesTakenIndices.indexOf(i)||this._postProcessesTakenIndices.push(i),o=i+u,this._postProcesses[o]=t,o},i.prototype.detachPostProcess=function(n,t){var u,f,e,i,r;if("undefined"==typeof t&&(t=null),u=[],t)for(t=t instanceof Array?t:[t],i=0;i<t.length;i++)f=this._postProcesses[t[i]],f===n?(delete this._postProcesses[t[i]],r=this._postProcessesTakenIndices.indexOf(t[i]),this._postProcessesTakenIndices.splice(r,1)):u.push(i);else for(e=this._postProcesses.length,i=0;e>i;i++)this._postProcesses[i]===n&&(delete this._postProcesses[i],r=this._postProcessesTakenIndices.indexOf(i),this._postProcessesTakenIndices.splice(r,1));return u},i.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=n.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},i.prototype._getViewMatrix=function(){return n.Matrix.Identity()},i.prototype.getViewMatrix=function(){return this._computedViewMatrix=this._computeViewMatrix(),this.parent&&this.parent.getWorldMatrix&&!this.isSynchronized()?(this._worldMatrix||(this._worldMatrix=n.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._computedViewMatrix.invert(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix):this._computedViewMatrix},i.prototype._computeViewMatrix=function(n){return!n&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this.parent&&this.parent.getWorldMatrix||(this._currentRenderId=this.getScene().getRenderId()),this._computedViewMatrix)},i.prototype.getProjectionMatrix=function(t){var i,r,u;return!t&&this._isSynchronizedProjectionMatrix()?this._projectionMatrix:(i=this.getEngine(),this.mode===n.Camera.PERSPECTIVE_CAMERA)?(this.minZ<=0&&(this.minZ=.1),n.Matrix.PerspectiveFovLHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix):(r=i.getRenderWidth()/2,u=i.getRenderHeight()/2,n.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-r,this.orthoRight||r,this.orthoBottom||-u,this.orthoTop||u,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix)},i.prototype.dispose=function(){var t=this.getScene().cameras.indexOf(this),n;for(this.getScene().cameras.splice(t,1),n=0;n<this._postProcessesTakenIndices.length;++n)this._postProcesses[this._postProcessesTakenIndices[n]].dispose(this)},i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i}(n.Node);n.Camera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){t.call(this,i,r,u);this.cameraDirection=new n.Vector3(0,0,0);this.cameraRotation=new n.Vector2(0,0);this.rotation=new n.Vector3(0,0,0);this.speed=2;this.noRotationConstraint=!1;this.lockedTarget=null;this._currentTarget=n.Vector3.Zero();this._viewMatrix=n.Matrix.Zero();this._camMatrix=n.Matrix.Zero();this._cameraTransformMatrix=n.Matrix.Zero();this._cameraRotationMatrix=n.Matrix.Zero();this._referencePoint=new n.Vector3(0,0,1);this._transformedReferencePoint=n.Vector3.Zero();this._lookAtTemp=n.Matrix.Zero();this._tempMatrix=n.Matrix.Zero()}return __extends(i,t),i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},i.prototype._initCache=function(){t.prototype._initCache.call(this);this._cache.lockedTarget=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotation=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(n){n||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null;this._cache.rotation.copyFrom(this.rotation)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var n=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(n):!n)&&this._cache.rotation.equals(this.rotation)},i.prototype._computeLocalCameraSpeed=function(){return this.speed*(n.Tools.GetDeltaTime()/(10*n.Tools.GetFps()))},i.prototype.setTarget=function(t){this.upVector.normalize();n.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix);this._camMatrix.invert();this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);this.rotation.y=i.x>=0?-Math.atan(i.z/i.x)+Math.PI/2:-Math.atan(i.z/i.x)-Math.PI/2;this.rotation.z=-Math.acos(n.Vector3.Dot(new n.Vector3(0,1,0),this.upVector));isNaN(this.rotation.x)&&(this.rotation.x=0);isNaN(this.rotation.y)&&(this.rotation.y=0);isNaN(this.rotation.z)&&(this.rotation.z=0)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},i.prototype._update=function(){var i=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0,t;(i&&this._updatePosition(),r&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint))&&(t=Math.PI/2*.95,this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t));i&&(Math.abs(this.cameraDirection.x)<n.Engine.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<n.Engine.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<n.Engine.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia));r&&(Math.abs(this.cameraRotation.x)<n.Engine.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<n.Engine.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia))},i.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(0!=this.upVector.x||1!=this.upVector.y||0!=this.upVector.z?(n.Matrix.LookAtLHToRef(n.Vector3.Zero(),this._referencePoint,this.upVector,this._lookAtTemp),n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),n.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),n.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},i}(n.Camera);n.TargetCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r){t.call(this,n,i,r);this.radius=12;this.rotationOffset=0;this.heightOffset=4;this.cameraAcceleration=.05;this.maxCameraSpeed=20}return __extends(i,t),i.prototype.getRadians=function(n){return n*Math.PI/180},i.prototype.follow=function(t){if(t){var f=this.getRadians(this.rotationOffset)+t.rotation.y,e=t.position.x+Math.sin(f)*this.radius,o=t.position.z+Math.cos(f)*this.radius,s=e-this.position.x,h=t.position.y+this.heightOffset-this.position.y,c=o-this.position.z,i=s*this.cameraAcceleration*2,r=h*this.cameraAcceleration,u=c*this.cameraAcceleration*2;(i>this.maxCameraSpeed||i<-this.maxCameraSpeed)&&(i=1>i?-this.maxCameraSpeed:this.maxCameraSpeed);(r>this.maxCameraSpeed||r<-this.maxCameraSpeed)&&(r=1>r?-this.maxCameraSpeed:this.maxCameraSpeed);(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=1>u?-this.maxCameraSpeed:this.maxCameraSpeed);this.position=new n.Vector3(this.position.x+i,this.position.y+r,this.position.z+u);this.setTarget(t.position)}},i.prototype._update=function(){t.prototype._update.call(this);this.follow(this.target)},i}(n.TargetCamera);n.FollowCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){t.call(this,i,r,u);this.ellipsoid=new n.Vector3(.5,1,.5);this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39];this.checkCollisions=!1;this.applyGravity=!1;this.angularSensibility=2e3;this._keys=[];this._collider=new n.Collider;this._needMoveForGravity=!0;this._oldPosition=n.Vector3.Zero();this._diffPosition=n.Vector3.Zero();this._newPosition=n.Vector3.Zero()}return __extends(i,t),i.prototype.attachControl=function(t,i){var u,r=this,f=this.getEngine();this._attachedElement||(this._attachedElement=t,void 0===this._onMouseDown&&(this._onMouseDown=function(n){u={x:n.clientX,y:n.clientY};i||n.preventDefault()},this._onMouseUp=function(n){u=null;i||n.preventDefault()},this._onMouseOut=function(n){u=null;r._keys=[];i||n.preventDefault()},this._onMouseMove=function(n){if(u||f.isPointerLock){var t,e;f.isPointerLock?(t=n.movementX||n.mozMovementX||n.webkitMovementX||n.msMovementX||0,e=n.movementY||n.mozMovementY||n.webkitMovementY||n.msMovementY||0):(t=n.clientX-u.x,e=n.clientY-u.y);r.cameraRotation.y+=t/r.angularSensibility;r.cameraRotation.x+=e/r.angularSensibility;u={x:n.clientX,y:n.clientY};i||n.preventDefault()}},this._onKeyDown=function(n){if(-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)){var t=r._keys.indexOf(n.keyCode);-1===t&&r._keys.push(n.keyCode);i||n.preventDefault()}},this._onKeyUp=function(n){if(-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)){var t=r._keys.indexOf(n.keyCode);t>=0&&r._keys.splice(t,1);i||n.preventDefault()}},this._onLostFocus=function(){r._keys=[]},this._reset=function(){r._keys=[];u=null;r.cameraDirection=new n.Vector3(0,0,0);r.cameraRotation=new n.Vector2(0,0)}),t.addEventListener("mousedown",this._onMouseDown,!1),t.addEventListener("mouseup",this._onMouseUp,!1),t.addEventListener("mouseout",this._onMouseOut,!1),t.addEventListener("mousemove",this._onMouseMove,!1),n.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedElement==t&&(t.removeEventListener("mousedown",this._onMouseDown),t.removeEventListener("mouseup",this._onMouseUp),t.removeEventListener("mouseout",this._onMouseOut),t.removeEventListener("mousemove",this._onMouseMove),n.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._attachedElement=null,this._reset&&this._reset())},i.prototype._collideWithWorld=function(t){var i;i=this.parent?n.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position;i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition);this._collider.radius=this.ellipsoid;this.getScene()._getNewPosition(this._oldPosition,t,this._collider,3,this._newPosition);this._newPosition.subtractToRef(this._oldPosition,this._diffPosition);this._diffPosition.length()>n.Engine.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&this.onCollide(this._collider.collidedMesh))},i.prototype._checkInputs=function(){var r,t,i;for(this._localDirection||(this._localDirection=n.Vector3.Zero(),this._transformedDirection=n.Vector3.Zero()),r=0;r<this._keys.length;r++)t=this._keys[r],i=this._computeLocalCameraSpeed(),-1!==this.keysLeft.indexOf(t)?this._localDirection.copyFromFloats(-i,0,0):-1!==this.keysUp.indexOf(t)?this._localDirection.copyFromFloats(0,0,i):-1!==this.keysRight.indexOf(t)?this._localDirection.copyFromFloats(i,0,0):-1!==this.keysDown.indexOf(t)&&this._localDirection.copyFromFloats(0,0,-i),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),n.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){if(this.checkCollisions&&this.getScene().collisionsEnabled){if(this._collideWithWorld(this.cameraDirection),this.applyGravity){var t=this.position;this._collideWithWorld(this.getScene().gravity);this._needMoveForGravity=0!=n.Vector3.DistanceSquared(t,this.position)}}else this.position.addInPlace(this.cameraDirection)},i.prototype._update=function(){this._checkInputs();t.prototype._update.call(this)},i}(n.TargetCamera);n.FreeCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r){t.call(this,n,i,r);this._offsetX=null;this._offsetY=null;this._pointerCount=0;this._pointerPressed=[];this.angularSensibility=2e5;this.moveSensibility=500}return __extends(i,t),i.prototype.attachControl=function(t,i){var u,r=this;this._attachedCanvas||(this._attachedCanvas=t,void 0===this._onPointerDown&&(this._onPointerDown=function(n){i||n.preventDefault();r._pointerPressed.push(n.pointerId);1===r._pointerPressed.length&&(u={x:n.clientX,y:n.clientY})},this._onPointerUp=function(n){i||n.preventDefault();var t=r._pointerPressed.indexOf(n.pointerId);-1!==t&&(r._pointerPressed.splice(t,1),0==t&&(u=null,r._offsetX=null,r._offsetY=null))},this._onPointerMove=function(n){if(i||n.preventDefault(),u){var t=r._pointerPressed.indexOf(n.pointerId);0==t&&(r._offsetX=n.clientX-u.x,r._offsetY=-(n.clientY-u.y))}},this._onLostFocus=function(){r._offsetX=null;r._offsetY=null}),t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointerup",this._onPointerUp),t.addEventListener("pointerout",this._onPointerUp),t.addEventListener("pointermove",this._onPointerMove),n.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedCanvas==t&&(t.removeEventListener("pointerdown",this._onPointerDown),t.removeEventListener("pointerup",this._onPointerUp),t.removeEventListener("pointerout",this._onPointerUp),t.removeEventListener("pointermove",this._onPointerMove),n.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),this._attachedCanvas=null)},i.prototype._checkInputs=function(){if(this._offsetX)if(this.cameraRotation.y+=this._offsetX/this.angularSensibility,this._pointerPressed.length>1)this.cameraRotation.x+=-this._offsetY/this.angularSensibility;else{var t=this._computeLocalCameraSpeed(),i=new n.Vector3(0,0,t*this._offsetY/this.moveSensibility);n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix);this.cameraDirection.addInPlace(n.Vector3.TransformCoordinates(i,this._cameraRotationMatrix))}},i}(n.FreeCamera);n.TouchCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r){var u=this;t.call(this,n,i,r);this._offsetX=null;this._offsetY=null;this._orientationGamma=0;this._orientationBeta=0;this._initialOrientationGamma=0;this._initialOrientationBeta=0;this.angularSensibility=1e4;this.moveSensibility=50;window.addEventListener("resize",function(){u._initialOrientationGamma=null},!1)}return __extends(i,t),i.prototype.attachControl=function(n){var t=this;this._attachedCanvas||(this._attachedCanvas=n,this._orientationChanged||(this._orientationChanged=function(n){t._initialOrientationGamma||(t._initialOrientationGamma=n.gamma,t._initialOrientationBeta=n.beta);t._orientationGamma=n.gamma;t._orientationBeta=n.beta;t._offsetY=t._initialOrientationBeta-t._orientationBeta;t._offsetX=t._initialOrientationGamma-t._orientationGamma}),window.addEventListener("deviceorientation",this._orientationChanged))},i.prototype.detachControl=function(n){this._attachedCanvas==n&&(window.removeEventListener("deviceorientation",this._orientationChanged),this._attachedCanvas=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0)},i.prototype._checkInputs=function(){if(this._offsetX){this.cameraRotation.y-=this._offsetX/this.angularSensibility;var t=this._computeLocalCameraSpeed(),i=new n.Vector3(0,0,t*this._offsetY/this.moveSensibility);n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix);this.cameraDirection.addInPlace(n.Vector3.TransformCoordinates(i,this._cameraRotationMatrix))}},i}(n.FreeCamera);n.DeviceOrientationCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=n.Tools.GetPointerPrefix(),i=function(i){function r(t,r,u,f,e,o){i.call(this,t,n.Vector3.Zero(),o);this.alpha=r;this.beta=u;this.radius=f;this.target=e;this.inertialAlphaOffset=0;this.inertialBetaOffset=0;this.inertialRadiusOffset=0;this.lowerAlphaLimit=null;this.upperAlphaLimit=null;this.lowerBetaLimit=.01;this.upperBetaLimit=Math.PI;this.lowerRadiusLimit=null;this.upperRadiusLimit=null;this.angularSensibility=1e3;this.wheelPrecision=3;this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39];this.zoomOnFactor=1;this._keys=[];this._viewMatrix=new n.Matrix;this.checkCollisions=!1;this.collisionRadius=new n.Vector3(.5,.5,.5);this._collider=new n.Collider;this._previousPosition=n.Vector3.Zero();this._collisionVelocity=n.Vector3.Zero();this._newPosition=n.Vector3.Zero();this.pinchPrecision=20;this.getViewMatrix()}return __extends(r,i),r.prototype._getTargetPosition=function(){return this.target.position||this.target},r.prototype._initCache=function(){i.prototype._initCache.call(this);this._cache.target=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.alpha=void 0;this._cache.beta=void 0;this._cache.radius=void 0},r.prototype._updateCache=function(n){n||i.prototype._updateCache.call(this);this._cache.target.copyFrom(this._getTargetPosition());this._cache.alpha=this.alpha;this._cache.beta=this.beta;this._cache.radius=this.radius},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius:!1},r.prototype.attachControl=function(i,r){var f,o,s,h,u=this,e=!1,c;this._attachedElement||(this._attachedElement=i,c=this.getEngine(),void 0===this._onPointerDown&&(this._onPointerDown=function(n){o||(o=n.pointerId,f={x:n.clientX,y:n.clientY},r||n.preventDefault())},this._onPointerUp=function(n){f=null;o=null;r||n.preventDefault()},this._onPointerMove=function(n){if(f&&o===n.pointerId&&!e){var t=n.clientX-f.x,i=n.clientY-f.y;u.inertialAlphaOffset-=t/u.angularSensibility;u.inertialBetaOffset-=i/u.angularSensibility;f={x:n.clientX,y:n.clientY};r||n.preventDefault()}},this._onMouseMove=function(n){if(c.isPointerLock&&!e){var t=n.movementX||n.mozMovementX||n.webkitMovementX||n.msMovementX||0,i=n.movementY||n.mozMovementY||n.webkitMovementY||n.msMovementY||0;u.inertialAlphaOffset-=t/u.angularSensibility;u.inertialBetaOffset-=i/u.angularSensibility;r||n.preventDefault()}},this._wheel=function(n){var t=0;n.wheelDelta?t=n.wheelDelta/(40*u.wheelPrecision):n.detail&&(t=-n.detail/u.wheelPrecision);t&&(u.inertialRadiusOffset+=t);n.preventDefault&&(r||n.preventDefault())},this._onKeyDown=function(n){if(-1!==u.keysUp.indexOf(n.keyCode)||-1!==u.keysDown.indexOf(n.keyCode)||-1!==u.keysLeft.indexOf(n.keyCode)||-1!==u.keysRight.indexOf(n.keyCode)){var t=u._keys.indexOf(n.keyCode);-1===t&&u._keys.push(n.keyCode);n.preventDefault&&(r||n.preventDefault())}},this._onKeyUp=function(n){if(-1!==u.keysUp.indexOf(n.keyCode)||-1!==u.keysDown.indexOf(n.keyCode)||-1!==u.keysLeft.indexOf(n.keyCode)||-1!==u.keysRight.indexOf(n.keyCode)){var t=u._keys.indexOf(n.keyCode);t>=0&&u._keys.splice(t,1);n.preventDefault&&(r||n.preventDefault())}},this._onLostFocus=function(){u._keys=[];o=null},this._onGestureStart=function(n){void 0!==window.MSGesture&&(u._MSGestureHandler||(u._MSGestureHandler=new MSGesture,u._MSGestureHandler.target=i),u._MSGestureHandler.addPointer(n.pointerId))},this._onGesture=function(n){u.radius*=n.scale;n.preventDefault&&(r||(n.stopPropagation(),n.preventDefault()))},this._reset=function(){u._keys=[];u.inertialAlphaOffset=0;u.inertialBetaOffset=0;u.inertialRadiusOffset=0;f=null;o=null},this._touchStart=function(n){2==n.touches.length&&(e=!0,u._pinchStart(n))},this._touchMove=function(n){e&&u._pinchMove(n)},this._touchEnd=function(n){e&&u._pinchEnd(n)},this._pinchStart=function(n){s=n.touches[0].clientX;h=n.touches[1].clientX;e=!0},this._pinchMove=function(n){var t,i,r=0,f=1;2==n.touches.length&&(t=Math.abs(s-h),i=Math.abs(n.touches[0].clientX-n.touches[1].clientX),t>i&&(f=-1),r=u.pinchPrecision/(40*u.wheelPrecision)*f,u.inertialRadiusOffset+=r,s=n.touches[0].clientX,h=n.touches[1].clientX)},this._pinchEnd=function(){e=!1}),i.addEventListener(t+"down",this._onPointerDown,!1),i.addEventListener(t+"up",this._onPointerUp,!1),i.addEventListener(t+"out",this._onPointerUp,!1),i.addEventListener(t+"move",this._onPointerMove,!1),i.addEventListener("mousemove",this._onMouseMove,!1),i.addEventListener("MSPointerDown",this._onGestureStart,!1),i.addEventListener("MSGestureChange",this._onGesture,!1),i.addEventListener("mousewheel",this._wheel,!1),i.addEventListener("DOMMouseScroll",this._wheel,!1),i.addEventListener("touchstart",this._touchStart,!1),i.addEventListener("touchmove",this._touchMove,!1),i.addEventListener("touchend",this._touchEnd,!1),n.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},r.prototype.detachControl=function(i){this._attachedElement==i&&(i.removeEventListener(t+"down",this._onPointerDown),i.removeEventListener(t+"up",this._onPointerUp),i.removeEventListener(t+"out",this._onPointerUp),i.removeEventListener(t+"move",this._onPointerMove),i.removeEventListener("mousemove",this._onMouseMove),i.removeEventListener("MSPointerDown",this._onGestureStart),i.removeEventListener("MSGestureChange",this._onGesture),i.removeEventListener("mousewheel",this._wheel),i.removeEventListener("DOMMouseScroll",this._wheel),i.removeEventListener("touchstart",this._touchStart),i.removeEventListener("touchmove",this._touchMove),i.removeEventListener("touchend",this._touchEnd),n.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},r.prototype._update=function(){for(var t,i=0;i<this._keys.length;i++)t=this._keys[i],-1!==this.keysLeft.indexOf(t)?this.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(t)?this.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(t)?this.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(t)&&(this.inertialBetaOffset+=.01);(0!=this.inertialAlphaOffset||0!=this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<n.Engine.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<n.Engine.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<n.Engine.Epsilon&&(this.inertialRadiusOffset=0));this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit);this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit);this.lowerBetaLimit&&this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit);this.upperBetaLimit&&this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit);this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit);this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},r.prototype.setPosition=function(n){var t=n.subtract(this._getTargetPosition());this.radius=t.length();this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)));t.z<0&&(this.alpha=2*Math.PI-this.alpha);this.beta=Math.acos(t.y/this.radius)},r.prototype._getViewMatrix=function(){var r=Math.cos(this.alpha),u=Math.sin(this.alpha),f=Math.cos(this.beta),t=Math.sin(this.beta),i=this._getTargetPosition();return i.addToRef(new n.Vector3(this.radius*r*t,this.radius*f,this.radius*u*t),this.position),this.checkCollisions&&(this._collider.radius=this.collisionRadius,this.position.subtractToRef(this._previousPosition,this._collisionVelocity),this.getScene()._getNewPosition(this._previousPosition,this._collisionVelocity,this._collider,3,this._newPosition),this._newPosition.equalsWithEpsilon(this.position)||(this.position.copyFrom(this._previousPosition),this.alpha=this._previousAlpha,this.beta=this._previousBeta,this.radius=this._previousRadius,this.onCollide&&this.onCollide(this._collider.collidedMesh))),n.Matrix.LookAtLHToRef(this.position,i,this.upVector,this._viewMatrix),this._previousAlpha=this.alpha,this._previousBeta=this.beta,this._previousRadius=this.radius,this._previousPosition.copyFrom(this.position),this._viewMatrix},r.prototype.zoomOn=function(t){t=t||this.getScene().meshes;var i=n.Mesh.MinMax(t),r=n.Vector3.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor;this.focusOn({min:i.min,max:i.max,distance:r})},r.prototype.focusOn=function(t){var i,r;void 0===t.min?(i=t||this.getScene().meshes,i=n.Mesh.MinMax(i),r=n.Vector3.Distance(i.min,i.max)):(i=t,r=t.distance);this.target=n.Mesh.Center(i);this.maxZ=2*r},r}(n.Camera);n.ArcRotateCamera=i}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t){this.autoClear=!0;this.clearColor=new n.Color3(.2,.2,.3);this.ambientColor=new n.Color3(0,0,0);this.forceWireframe=!1;this.cameraToUseForPointers=null;this.fogMode=n.Scene.FOGMODE_NONE;this.fogColor=new n.Color3(.2,.2,.3);this.fogDensity=.1;this.fogStart=0;this.fogEnd=1e3;this.lightsEnabled=!0;this.lights=[];this.cameras=[];this.activeCameras=[];this.meshes=[];this._geometries=[];this.materials=[];this.multiMaterials=[];this.defaultMaterial=new n.StandardMaterial("default material",this);this.texturesEnabled=!0;this.textures=[];this.particlesEnabled=!0;this.particleSystems=[];this.spriteManagers=[];this.layers=[];this.skeletons=[];this.lensFlareSystems=[];this.collisionsEnabled=!0;this.gravity=new n.Vector3(0,-9,0);this.postProcessesEnabled=!0;this.renderTargetsEnabled=!0;this.customRenderTargets=[];this.importedMeshesFiles=[];this._actionManagers=[];this._meshesForIntersections=new n.SmartArray(256);this._totalVertices=0;this._activeVertices=0;this._activeParticles=0;this._lastFrameDuration=0;this._evaluateActiveMeshesDuration=0;this._renderTargetsDuration=0;this._particlesDuration=0;this._renderDuration=0;this._spritesDuration=0;this._animationRatio=0;this._renderId=0;this._executeWhenReadyTimeoutId=-1;this._toBeDisposed=new n.SmartArray(256);this._onReadyCallbacks=[];this._pendingData=[];this._onBeforeRenderCallbacks=[];this._activeMeshes=new n.SmartArray(256);this._processedMaterials=new n.SmartArray(256);this._renderTargets=new n.SmartArray(256);this._activeParticleSystems=new n.SmartArray(256);this._activeSkeletons=new n.SmartArray(32);this._activeAnimatables=[];this._transformMatrix=n.Matrix.Zero();this._scaledPosition=n.Vector3.Zero();this._scaledVelocity=n.Vector3.Zero();this._engine=t;t.scenes.push(this);this._renderingManager=new n.RenderingManager(this);this.postProcessManager=new n.PostProcessManager(this);this.postProcessRenderPipelineManager=new n.PostProcessRenderPipelineManager;this._boundingBoxRenderer=new n.BoundingBoxRenderer(this);this._outlineRenderer=new n.OutlineRenderer(this);this.attachControl()}return Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),t.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},t.prototype.getOutlineRenderer=function(){return this._outlineRenderer},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices},t.prototype.getActiveVertices=function(){return this._activeVertices},t.prototype.getActiveParticles=function(){return this._activeParticles},t.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},t.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},t.prototype.getRenderDuration=function(){return this._renderDuration},t.prototype.getParticlesDuration=function(){return this._particlesDuration},t.prototype.getSpritesDuration=function(){return this._spritesDuration},t.prototype.getAnimationRatio=function(){return this._animationRatio},t.prototype.getRenderId=function(){return this._renderId},t.prototype._updatePointerPosition=function(n){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=n.clientX-t.left;this._pointerY=n.clientY-t.top;this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},t.prototype.attachControl=function(){var t=this,i;this._onPointerMove=function(n){var r=t._engine.getRenderingCanvas(),i;t._updatePointerPosition(n);i=t.pick(t._pointerX,t._pointerY,function(n){return n.isPickable&&n.isVisible&&n.isReady()&&n.actionManager&&n.actionManager.hasPointerTriggers},!1,t.cameraToUseForPointers);i.hit?(t._meshUnderPointer=i.pickedMesh,t.setPointerOverMesh(i.pickedMesh),r.style.cursor="pointer"):(t.setPointerOverMesh(null),r.style.cursor="",t._meshUnderPointer=null)};this._onPointerDown=function(i){var u=null,r;if(t.onPointerDown||(u=function(n){return n.isPickable&&n.isVisible&&n.isReady()&&n.actionManager&&n.actionManager.hasPickTriggers}),t._updatePointerPosition(i),r=t.pick(t._pointerX,t._pointerY,u,!1,t.cameraToUseForPointers),r.hit&&r.pickedMesh.actionManager){switch(i.button){case 0:r.pickedMesh.actionManager.processTrigger(n.ActionManager.OnLeftPickTrigger,n.ActionEvent.CreateNew(r.pickedMesh));break;case 1:r.pickedMesh.actionManager.processTrigger(n.ActionManager.OnCenterPickTrigger,n.ActionEvent.CreateNew(r.pickedMesh));break;case 2:r.pickedMesh.actionManager.processTrigger(n.ActionManager.OnRightPickTrigger,n.ActionEvent.CreateNew(r.pickedMesh))}r.pickedMesh.actionManager.processTrigger(n.ActionManager.OnPickTrigger,n.ActionEvent.CreateNew(r.pickedMesh))}t.onPointerDown&&t.onPointerDown(i,r)};this._onKeyDown=function(i){t.actionManager&&t.actionManager.processTrigger(n.ActionManager.OnKeyDownTrigger,n.ActionEvent.CreateNewFromScene(t,i))};this._onKeyUp=function(i){t.actionManager&&t.actionManager.processTrigger(n.ActionManager.OnKeyUpTrigger,n.ActionEvent.CreateNewFromScene(t,i))};i=n.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().addEventListener(i+"move",this._onPointerMove,!1);this._engine.getRenderingCanvas().addEventListener(i+"down",this._onPointerDown,!1);window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",this._onKeyUp,!1)},t.prototype.detachControl=function(){var t=n.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+"move",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener(t+"down",this._onPointerDown);window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp)},t.prototype.isReady=function(){var t,u,i,r;if(this._pendingData.length>0)return!1;for(t=0;t<this._geometries.length;t++)if(u=this._geometries[t],u.delayLoadState===n.Engine.DELAYLOADSTATE_LOADING)return!1;for(t=0;t<this.meshes.length;t++)if((i=this.meshes[t],!i.isReady())||(r=i.material,r&&!r.isReady(i)))return!1;return!0},t.prototype.registerBeforeRender=function(n){this._onBeforeRenderCallbacks.push(n)},t.prototype.unregisterBeforeRender=function(n){var t=this._onBeforeRenderCallbacks.indexOf(n);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},t.prototype._addPendingData=function(n){this._pendingData.push(n)},t.prototype._removePendingData=function(n){var t=this._pendingData.indexOf(n);-1!==t&&this._pendingData.splice(t,1)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},t.prototype.executeWhenReady=function(n){var t=this;this._onReadyCallbacks.push(n);-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype._checkIsReady=function(){var n=this;return this.isReady()?(this._onReadyCallbacks.forEach(function(n){n()}),this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){n._checkIsReady()},150))},t.prototype.beginAnimation=function(t,i,r,u,f,e,o){if(void 0===f&&(f=1),this.stopAnimation(t),o||(o=new n.Animatable(this,t,i,r,u,f,e)),t.animations&&o.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),s=0;s<h.length;s++)this.beginAnimation(h[s],i,r,u,f,e,o);return o},t.prototype.beginDirectAnimation=function(t,i,r,u,f,e,o){void 0===e&&(e=1);return new n.Animatable(this,t,r,u,f,e,o,i)},t.prototype.getAnimatableByTarget=function(n){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===n)return this._activeAnimatables[t];return null},t.prototype.stopAnimation=function(n){var t=this.getAnimatableByTarget(n);t&&t.stop()},t.prototype._animate=function(){this._animationStartDate||(this._animationStartDate=(new Date).getTime());for(var t=(new Date).getTime(),i=t-this._animationStartDate,n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n]._animate(i)||(this._activeAnimatables.splice(n,1),n--)},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(n,t){this._viewMatrix=n;this._projectionMatrix=t;this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},t.prototype.setActiveCameraByID=function(n){var t=this.getCameraByID(n);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(n){var t=this.getCameraByName(n);return t?(this.activeCamera=t,t):null},t.prototype.getMaterialByID=function(n){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===n)return this.materials[t];return null},t.prototype.getMaterialByName=function(n){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===n)return this.materials[t];return null},t.prototype.getCameraByID=function(n){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===n)return this.cameras[t];return null},t.prototype.getCameraByName=function(n){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===n)return this.cameras[t];return null},t.prototype.getLightByName=function(n){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===n)return this.lights[t];return null},t.prototype.getLightByID=function(n){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===n)return this.lights[t];return null},t.prototype.getGeometryByID=function(n){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===n)return this._geometries[t];return null},t.prototype.pushGeometry=function(n,t){return!t&&this.getGeometryByID(n.id)?!1:(this._geometries.push(n),!0)},t.prototype.getGeometries=function(){return this._geometries},t.prototype.getMeshByID=function(n){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===n)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(n){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===n)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(n){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===n)return this.meshes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===n)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===n)return this.lights[t];return null},t.prototype.getMeshByName=function(n){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===n)return this.meshes[t];return null},t.prototype.getLastSkeletonByID=function(n){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===n)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(n){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===n)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(n){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===n)return this.skeletons[t];return null},t.prototype.isActiveMesh=function(n){return-1!==this._activeMeshes.indexOf(n)},t.prototype._evaluateSubMesh=function(n,t){if(1==t.subMeshes.length||n.isInFrustum(this._frustumPlanes)){var i=n.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(n.getBoundingInfo().boundingBox);i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concat(i.getRenderTargetTextures())),this._activeVertices+=n.verticesCount,this._renderingManager.dispatch(n))}},t.prototype._evaluateActiveMeshes=function(){var f,e,o,r,t,s,u,i;for(this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._boundingBoxRenderer.reset(),this._frustumPlanes?n.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=n.Frustum.GetPlanes(this._transformMatrix),this._selectionOctree?(o=this._selectionOctree.select(this._frustumPlanes),f=o.data,e=o.length):(e=this.meshes.length,f=this.meshes),r=0;e>r;r++)t=f[r],this._totalVertices+=t.getTotalVertices(),t.isReady()&&(t.computeWorldMatrix(),t._preActivate(),t.actionManager&&t.actionManager.hasSpecificTriggers([n.ActionManager.OnIntersectionEnterTrigger,n.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(t),t.isEnabled()&&t.isVisible&&t.visibility>0&&0!=(t.layerMask&this.activeCamera.layerMask)&&t.isInFrustum(this._frustumPlanes)&&(this._activeMeshes.push(t),t._activate(this._renderId),this._activeMesh(t)));if(s=(new Date).getTime(),this.particlesEnabled)for(u=0;u<this.particleSystems.length;u++)i=this.particleSystems[u],i.isStarted()&&(!i.emitter.position||i.emitter&&i.emitter.isEnabled())&&(this._activeParticleSystems.push(i),i.animate());this._particlesDuration+=(new Date).getTime()-s},t.prototype._activeMesh=function(n){var r,t,u,i,f;if(n.skeleton&&this._activeSkeletons.pushNoDuplicate(n.skeleton),n.showBoundingBox&&this._boundingBoxRenderer.renderList.push(n.getBoundingInfo().boundingBox),n.subMeshes)for(n._submeshesOctree&&n.useOctreeForRenderingSelection?(u=n._submeshesOctree.select(this._frustumPlanes),r=u.length,t=u.data):(t=n.subMeshes,r=t.length),i=0;r>i;i++)f=t[i],this._evaluateSubMesh(f,n)},t.prototype.updateTransformMatrix=function(n){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(n))},t.prototype._renderForCamera=function(n){var i=this._engine,s,u,h,c,f,o,l,t,r,e;if(this.activeCamera=n,!this.activeCamera)throw new Error("Active camera not set");for(i.setViewport(this.activeCamera.viewport),this._renderId++,this.updateTransformMatrix(),this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera),s=(new Date).getTime(),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=(new Date).getTime()-s,u=0;u<this._activeSkeletons.length;u++)h=this._activeSkeletons.data[u],h.prepare();if(c=(new Date).getTime(),this.renderTargetsEnabled){for(f=0;f<this._renderTargets.length;f++)o=this._renderTargets.data[f],o._shouldRender()&&(this._renderId++,o.render());this._renderId++}if(this._renderTargets.length>0&&i.restoreDefaultFramebuffer(),this._renderTargetsDuration+=(new Date).getTime()-c,this.postProcessManager._prepareFrame(),l=(new Date).getTime(),this.layers.length){for(i.setDepthBuffer(!1),t=0;t<this.layers.length;t++)r=this.layers[t],r.isBackground&&r.render();i.setDepthBuffer(!0)}for(this._renderingManager.render(null,null,!0,!0),this._boundingBoxRenderer.render(),e=0;e<this.lensFlareSystems.length;e++)this.lensFlareSystems[e].render();if(this.layers.length){for(i.setDepthBuffer(!1),t=0;t<this.layers.length;t++)r=this.layers[t],r.isBackground||r.render();i.setDepthBuffer(!0)}this._renderDuration+=(new Date).getTime()-l;this.postProcessManager._finalizeFrame(n.isIntermediate);this.activeCamera._updateFromScene();this._renderTargets.reset();this.afterCameraRender&&this.afterCameraRender(this.activeCamera)},t.prototype._processSubCameras=function(n){if(0==n.subCameras.length)return void this._renderForCamera(n);for(var t=0;t<n.subCameras.length;t++)this._renderForCamera(n.subCameras[t]);this.activeCamera=n;this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix());this.activeCamera._updateFromScene()},t.prototype._checkIntersections=function(){for(var t,u,i,e,r=0;r<this._meshesForIntersections.length;r++)for(t=this._meshesForIntersections.data[r],u=0;u<t.actionManager.actions.length;u++)if(i=t.actionManager.actions[u],i.trigger==n.ActionManager.OnIntersectionEnterTrigger||i.trigger==n.ActionManager.OnIntersectionExitTrigger){var f=i.getTriggerParameter(),o=f.intersectsMesh(t,!1),s=t._intersectionsInProgress.indexOf(f);o&&-1===s&&i.trigger==n.ActionManager.OnIntersectionEnterTrigger?(t.actionManager.processTrigger(n.ActionManager.OnIntersectionEnterTrigger,n.ActionEvent.CreateNew(t)),t._intersectionsInProgress.push(f)):!o&&s>-1&&i.trigger==n.ActionManager.OnIntersectionExitTrigger&&(t.actionManager.processTrigger(n.ActionManager.OnIntersectionExitTrigger,n.ActionEvent.CreateNew(t)),e=t._intersectionsInProgress.indexOf(f),e>-1&&t._intersectionsInProgress.splice(e,1))}},t.prototype.render=function(){var y=(new Date).getTime(),u,h,a,c,f,e,o,l,i,v,s,r;for(this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeVertices=0,this._meshesForIntersections.reset(),this.actionManager&&this.actionManager.processTrigger(n.ActionManager.OnEveryFrameTrigger,null),this.beforeRender&&this.beforeRender(),u=0;u<this._onBeforeRenderCallbacks.length;u++)this._onBeforeRenderCallbacks[u]();if(h=Math.max(t.MinDeltaTime,Math.min(n.Tools.GetDeltaTime(),t.MaxDeltaTime)),this._animationRatio=.06*h,this._animate(),this._physicsEngine&&this._physicsEngine._runOneStep(h/1e3),a=(new Date).getTime(),c=this.getEngine(),this.renderTargetsEnabled){for(f=0;f<this.customRenderTargets.length;f++)if(e=this.customRenderTargets[f],e._shouldRender()){if(this._renderId++,this.activeCamera=e.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");c.setViewport(this.activeCamera.viewport);this.updateTransformMatrix();e.render()}this._renderId++}for(this.customRenderTargets.length>0&&c.restoreDefaultFramebuffer(),this._renderTargetsDuration+=(new Date).getTime()-a,this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe,!0),o=0;o<this.lights.length;o++)l=this.lights[o],i=l.getShadowGenerator(),l.isEnabled()&&i&&-1!==i.getShadowMap().getScene().textures.indexOf(i.getShadowMap())&&this._renderTargets.push(i.getShadowMap());if(this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(v=this._renderId,s=0;s<this.activeCameras.length;s++)this._renderId=v,this._processSubCameras(this.activeCameras[s]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}for(this._checkIntersections(),this.afterRender&&this.afterRender(),r=0;r<this._toBeDisposed.length;r++)this._toBeDisposed.data[r].dispose(),this._toBeDisposed[r]=null;this._toBeDisposed.reset();this._lastFrameDuration=(new Date).getTime()-y},t.prototype.dispose=function(){this.beforeRender=null;this.afterRender=null;this.skeletons=[];this._boundingBoxRenderer.dispose();this.onDispose&&this.onDispose();this.detachControl();for(var t=this._engine.getRenderingCanvas(),n=0;n<this.cameras.length;n++)this.cameras[n].detachControl(t);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose();this._physicsEngine&&this.disablePhysicsEngine();n=this._engine.scenes.indexOf(this);n>-1&&this._engine.scenes.splice(n,1);this._engine.wipeCaches()},t.prototype._getNewPosition=function(n,t,i,r,u,f){"undefined"==typeof f&&(f=null);n.divideToRef(i.radius,this._scaledPosition);t.divideToRef(i.radius,this._scaledVelocity);i.retry=0;i.initialVelocity=this._scaledVelocity;i.initialPosition=this._scaledPosition;this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,u,f);u.multiplyInPlace(i.radius)},t.prototype._collideWithWorld=function(t,i,r,u,f,e){var h,s,o;if("undefined"==typeof e&&(e=null),h=10*n.Engine.CollisionsEpsilon,r.retry>=u)return void f.copyFrom(t);for(r._initialize(t,i,h),s=0;s<this.meshes.length;s++)o=this.meshes[s],o.isEnabled()&&o.checkCollisions&&o.subMeshes&&o!==e&&o._checkCollision(r);return r.collisionFound?((0!=i.x||0!=i.y||0!=i.z)&&r._getResponse(t,i),i.length()<=h?void f.copyFrom(t):(r.retry++,void this._collideWithWorld(t,i,r,u,f,e))):void t.addToRef(i,f)},t.prototype.createOrUpdateSelectionOctree=function(t,i){var r,o,s;"undefined"==typeof t&&(t=64);"undefined"==typeof i&&(i=2);this._selectionOctree||(this._selectionOctree=new n.Octree(n.Octree.CreationFuncForMeshes,t,i));for(var u=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new n.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e=0;e<this.meshes.length;e++)r=this.meshes[e],r.computeWorldMatrix(!0),o=r.getBoundingInfo().boundingBox.minimumWorld,s=r.getBoundingInfo().boundingBox.maximumWorld,n.Tools.CheckExtends(o,u,f),n.Tools.CheckExtends(s,u,f);return this._selectionOctree.update(u,f,this.meshes),this._selectionOctree},t.prototype.createPickingRay=function(t,i,r,u){var o=this._engine,e,f;if(!u){if(!this.activeCamera)throw new Error("Active camera not set");u=this.activeCamera}return e=u.viewport,f=e.toGlobal(o),t=t/this._engine.getHardwareScalingLevel()-f.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-f.y-f.height),n.Ray.CreateNew(t,i,f.width,f.height,r?r:n.Matrix.Identity(),u.getViewMatrix(),u.getProjectionMatrix())},t.prototype._internalPick=function(t,i,r){for(var u,f=null,e=0;e<this.meshes.length;e++){if(u=this.meshes[e],i){if(!i(u))continue}else if(!u.isEnabled()||!u.isVisible||!u.isPickable)continue;var s=u.getWorldMatrix(),h=t(s),o=u.intersects(h,r);if(o&&o.hit&&(r||null==f||!(o.distance>=f.distance))&&(f=o,r))break}return f||new n.PickingInfo},t.prototype.pick=function(n,t,i,r,u){var f=this;return this._internalPick(function(i){return f.createPickingRay(n,t,i,u)},i,r)},t.prototype.pickWithRay=function(t,i,r){var u=this;return this._internalPick(function(i){return u._pickWithRayInverseMatrix||(u._pickWithRayInverseMatrix=n.Matrix.Identity()),i.invertToRef(u._pickWithRayInverseMatrix),n.Ray.Transform(t,u._pickWithRayInverseMatrix)},i,r)},t.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(n.ActionManager.OnPointerOutTrigger,n.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(n.ActionManager.OnPointerOverTrigger,n.ActionEvent.CreateNew(this._pointerOverMesh)))},t.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},t.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.prototype.enablePhysics=function(t,i){return this._physicsEngine?!0:(this._physicsEngine=new n.PhysicsEngine(i),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(t),!0):(this._physicsEngine=null,!1))},t.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},t.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},t.prototype.setGravity=function(n){this._physicsEngine&&this._physicsEngine._setGravity(n)},t.prototype.createCompoundImpostor=function(n,t){var i,r;if(n.parts&&(t=n,n=n.parts),!this._physicsEngine)return null;for(i=0;i<n.length;i++)r=n[i].mesh,r._physicImpostor=n[i].impostor,r._physicsMass=t.mass/n.length,r._physicsFriction=t.friction,r._physicRestitution=t.restitution;return this._physicsEngine._registerMeshesAsCompound(n,t)},t.prototype.deleteCompoundImpostor=function(t){for(var r,i=0;i<t.parts.length;i++)r=t.parts[i].mesh,r._physicImpostor=n.PhysicsEngine.NoImpostor,this._physicsEngine._unregisterMesh(r)},t.prototype._getByTags=function(t,i){var r,f,u;if(void 0===i)return t;r=[];for(f in t)u=t[f],n.Tags.MatchesQuery(u,i)&&r.push(u);return r},t.prototype.getMeshesByTags=function(n){return this._getByTags(this.meshes,n)},t.prototype.getCamerasByTags=function(n){return this._getByTags(this.cameras,n)},t.prototype.getLightsByTags=function(n){return this._getByTags(this.lights,n)},t.prototype.getMaterialByTags=function(n){return this._getByTags(this.materials,n).concat(this._getByTags(this.multiMaterials,n))},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}();n.Scene=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(i,r,u,f,e){switch(this._engine=i instanceof n.Mesh?i.getScene().getEngine():i,this._updatable=f,this._data=r,e||this.create(),this._kind=u,u){case t.PositionKind:this._strideSize=3;break;case t.NormalKind:this._strideSize=3;break;case t.UVKind:this._strideSize=2;break;case t.UV2Kind:this._strideSize=2;break;case t.ColorKind:this._strideSize=3;break;case t.MatricesIndicesKind:this._strideSize=4;break;case t.MatricesWeightsKind:this._strideSize=4}}return t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.create=function(n){(n||!this._buffer)&&(n=n||this._data,this._buffer||(this._buffer=this._updatable?this._engine.createDynamicVertexBuffer(4*n.length):this._engine.createVertexBuffer(n)),this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n),this._data=n))},t.prototype.update=function(n){this.create(n)},t.prototype.updateDirectly=function(n){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Object.defineProperty(t,"PositionKind",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NormalKind",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UVKind",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV2Kind",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorKind",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesKind",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsKind",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),t._PositionKind="position",t._NormalKind="normal",t._UVKind="uv",t._UV2Kind="uv2",t._ColorKind="color",t._MatricesIndicesKind="matricesIndices",t._MatricesWeightsKind="matricesWeights",t}();n.VertexBuffer=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.position=new n.Vector3(0,0,0);this.rotation=new n.Vector3(0,0,0);this.scaling=new n.Vector3(1,1,1);this.billboardMode=n.AbstractMesh.BILLBOARDMODE_NONE;this.visibility=1;this.infiniteDistance=!1;this.isVisible=!0;this.isPickable=!0;this.showBoundingBox=!1;this.showSubMeshesBoundingBox=!1;this.onDispose=null;this.checkCollisions=!1;this.isBlocker=!1;this.renderingGroupId=0;this.receiveShadows=!1;this.renderOutline=!1;this.outlineColor=n.Color3.Red();this.outlineWidth=.02;this.useOctreeForRenderingSelection=!0;this.useOctreeForPicking=!0;this.useOctreeForCollisions=!0;this.layerMask=4294967295;this._physicImpostor=n.PhysicsEngine.NoImpostor;this.ellipsoid=new n.Vector3(.5,1,.5);this.ellipsoidOffset=new n.Vector3(0,0,0);this._collider=new n.Collider;this._oldPositionForCollisions=new n.Vector3(0,0,0);this._diffPositionForCollisions=new n.Vector3(0,0,0);this._newPositionForCollisions=new n.Vector3(0,0,0);this._localScaling=n.Matrix.Zero();this._localRotation=n.Matrix.Zero();this._localTranslation=n.Matrix.Zero();this._localBillboard=n.Matrix.Zero();this._localPivotScaling=n.Matrix.Zero();this._localPivotScalingRotation=n.Matrix.Zero();this._localWorld=n.Matrix.Zero();this._worldMatrix=n.Matrix.Zero();this._rotateYByPI=n.Matrix.RotationY(Math.PI);this._absolutePosition=n.Vector3.Zero();this._collisionsTransformMatrix=n.Matrix.Zero();this._collisionsScalingMatrix=n.Matrix.Zero();this._isDirty=!1;this._pivotMatrix=n.Matrix.Identity();this._isDisposed=!1;this._renderId=0;this._intersectionsInProgress=[];r.meshes.push(this)}return __extends(i,t),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(){return null},i.prototype.isVerticesDataPresent=function(){return!1},i.prototype.getBoundingInfo=function(){return this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo},i.prototype._preActivate=function(){},i.prototype._activate=function(n){this._renderId=n},i.prototype.getWorldMatrix=function(){return this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},Object.defineProperty(i.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){var f,u;(this.rotationQuaternion||(this.rotationQuaternion=n.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=n.Vector3.Zero()),r&&0!=r)?(this.parent&&(f=this.parent.getWorldMatrix().clone(),f.invert(),t=n.Vector3.TransformNormal(t,f)),u=n.Quaternion.RotationAxis(t,i),this.rotationQuaternion=u.multiply(this.rotationQuaternion)):(u=n.Quaternion.RotationAxis(t,i),this.rotationQuaternion=this.rotationQuaternion.multiply(u))},i.prototype.translate=function(n,t,i){var r=n.scale(t),u;i&&0!=i?this.setAbsolutePosition(this.getAbsolutePosition().add(r)):(u=this.getPositionExpressedInLocalSpace().add(r),this.setPositionWithLocalVector(u))},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){var i,r,u,f,e;if(t){if(void 0===t.x){if(arguments.length<3)return;i=arguments[0];r=arguments[1];u=arguments[2]}else i=t.x,r=t.y,u=t.z;this.parent?(f=this.parent.getWorldMatrix().clone(),f.invert(),e=new n.Vector3(i,r,u),this.position=n.Vector3.TransformCoordinates(e,f)):(this.position.x=i,this.position.y=r,this.position.z=u)}},i.prototype.setPivotMatrix=function(n){this._pivotMatrix=n;this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty||this.billboardMode!==i.BILLBOARDMODE_NONE||this._cache.pivotMatrixUpdated||this.infiniteDistance||!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this);this._cache.localMatrixUpdated=!1;this._cache.position=n.Vector3.Zero();this._cache.scaling=n.Vector3.Zero();this._cache.rotation=n.Vector3.Zero();this._cache.rotationQuaternion=new n.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(n){"rotation"===n&&(this.rotationQuaternion=null);this._currentRenderId=Number.MAX_VALUE;this._isDirty=!0},i.prototype._updateBoundingInfo=function(){var t,i;if(this._boundingInfo=this._boundingInfo||new n.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this.subMeshes)for(t=0;t<this.subMeshes.length;t++)i=this.subMeshes[t],i.updateBoundingInfo(this.worldMatrixFromCache)},i.prototype.computeWorldMatrix=function(t){var r,u;if(!t&&(this._currentRenderId==this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,n.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var o=this.getScene().activeCamera,f=o.getWorldMatrix(),e=new n.Vector3(f.m[12],f.m[13],f.m[14]);n.Matrix.TranslationToRef(this.position.x+e.x,this.position.y+e.y,this.position.z+e.z,this._localTranslation)}else n.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);return(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera)&&(r=this.position.clone(),u=this.getScene().activeCamera.position.clone(),this.parent&&this.parent.position&&(r.addInPlace(this.parent.position),n.Matrix.TranslationToRef(r.x,r.y,r.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)===i.BILLBOARDMODE_ALL?u=this.getScene().activeCamera.position:(this.billboardMode&n.AbstractMesh.BILLBOARDMODE_X&&(u.x=r.x+n.Engine.Epsilon),this.billboardMode&n.AbstractMesh.BILLBOARDMODE_Y&&(u.y=r.y+.001),this.billboardMode&n.AbstractMesh.BILLBOARDMODE_Z&&(u.z=r.z+.001)),n.Matrix.LookAtLHToRef(r,u,n.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)),this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===n.AbstractMesh.BILLBOARDMODE_NONE?this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._worldMatrix},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix();this.position=n.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),n.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix();this.position=n.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,u){i=i||0;r=r||0;u=u||0;var f=t.subtract(this.position),e=-Math.atan2(f.z,f.x)-Math.PI/2,o=Math.sqrt(f.x*f.x+f.z*f.z),s=Math.atan2(f.y,o);this.rotationQuaternion=n.Quaternion.RotationYawPitchRoll(e+i,s+r,u)},i.prototype.isInFrustum=function(n){return this._boundingInfo.isInFrustum(n)?!0:!1},i.prototype.intersectsMesh=function(n,t){return this._boundingInfo&&n._boundingInfo?this._boundingInfo.intersects(n._boundingInfo,t):!1},i.prototype.intersectsPoint=function(n){return this._boundingInfo?this._boundingInfo.intersectsPoint(n):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r){if(t.impostor&&(i=t,t=t.impostor),t=t||n.PhysicsEngine.NoImpostor,t===n.PhysicsEngine.NoImpostor)return void r._unregisterMesh(this);i.mass=i.mass||0;i.friction=i.friction||.2;i.restitution=i.restitution||.2;this._physicImpostor=t;this._physicsMass=i.mass;this._physicsFriction=i.friction;this._physicRestitution=i.restitution;r._registerMesh(this,t,i)}},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:n.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.applyImpulse=function(n,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,n,t)},i.prototype.setPhysicsLinkWith=function(n,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,n,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},i.prototype.moveWithCollisions=function(t){var i=this.getAbsolutePosition();i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions);this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset);this._collider.radius=this.ellipsoid;this.getScene()._getNewPosition(this._oldPositionForCollisions,t,this._collider,3,this._newPositionForCollisions,this);this._newPositionForCollisions.subtractToRef(this._oldPositionForCollisions,this._diffPositionForCollisions);this._diffPositionForCollisions.length()>n.Engine.CollisionsEpsilon&&this.position.addInPlace(this._diffPositionForCollisions)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){"undefined"==typeof t&&(t=64);"undefined"==typeof i&&(i=2);this._submeshesOctree||(this._submeshesOctree=new n.Octree(n.Octree.CreationFuncForSubMeshes,t,i));this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone();t._lastColliderWorldVertices=[];t._trianglePlanes=[];for(var f=t.verticesStart,e=t.verticesStart+t.verticesCount,u=f;e>u;u++)t._lastColliderWorldVertices.push(n.Vector3.TransformCoordinates(this._positions[u],i))}r._collide(t,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart)},i.prototype._processCollisionsForSubMeshes=function(n,t){var i,r,o,f,u,e;for(this._submeshesOctree&&this.useOctreeForCollisions?(o=n.velocityWorldLength+Math.max(n.radius.x,n.radius.y,n.radius.z),f=this._submeshesOctree.intersects(n.basePointWorld,o),r=f.length,i=f.data):(i=this.subMeshes,r=i.length),u=0;r>u;u++)e=i[u],r>1&&!e._checkCollision(n)||this._collideForSubMesh(e,t,n)},i.prototype._checkCollision=function(t){this._boundingInfo._checkCollision(t)&&(n.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var r=new n.PickingInfo,f,e,u,v,c,o,l,s,w,a;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox))||!this._generatePointsArray())return r;for(u=null,this._submeshesOctree&&this.useOctreeForPicking?(v=n.Ray.Transform(t,this.getWorldMatrix()),c=this._submeshesOctree.intersectsRay(v),e=c.length,f=c.data):(f=this.subMeshes,e=f.length),o=0;e>o;o++)if(l=f[o],(!(e>1)||l.canIntersects(t))&&(s=l.intersects(t,this._positions,this.getIndices(),i),s&&(i||!u||s.distance<u.distance)&&(u=s,i)))break;if(u){var y=this.getWorldMatrix(),p=n.Vector3.TransformCoordinates(t.origin,y),h=t.direction.clone();return h.normalize(),h=h.scale(u.distance),w=n.Vector3.TransformNormal(h,y),a=p.add(w),r.hit=!0,r.distance=n.Vector3.Distance(p,a),r.pickedPoint=a,r.pickedMesh=this,r.bu=u.bu,r.bv=u.bv,r.faceId=u.faceId,r}return r},i.prototype.clone=function(){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[]},i.prototype.dispose=function(t){var f,e,i,r,u;for(this.getPhysicsImpostor()!=n.PhysicsEngine.NoImpostor&&this.setPhysicsState(n.PhysicsEngine.NoImpostor),i=0;i<this._intersectionsInProgress.length;i++)f=this._intersectionsInProgress[i],e=f._intersectionsInProgress.indexOf(this),f._intersectionsInProgress.splice(e,1);if(this._intersectionsInProgress=[],this.releaseSubMeshes(),i=this.getScene().meshes.indexOf(this),-1!=i&&this.getScene().meshes.splice(i,1),t)for(i=0;i<this.getScene().meshes.length;i++)r=this.getScene().meshes[i],r.parent===this&&(r.parent=null,r.computeWorldMatrix(!0));else{for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter==this&&(this.getScene().particleSystems[i].dispose(),i--);for(u=this.getScene().meshes.slice(0),i=0;i<u.length;i++)u[i].parent==this&&u[i].dispose()}this._isDisposed=!0;this.onDispose&&this.onDispose()},i._BILLBOARDMODE_NONE=0,i._BILLBOARDMODE_X=1,i._BILLBOARDMODE_Y=2,i._BILLBOARDMODE_Z=4,i._BILLBOARDMODE_ALL=7,i}(n.Node);n.AbstractMesh=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(){function n(){this.mustReturn=!1;this.visibleInstances=[];this.renderSelf=[]}return n}(),i;n._InstancesBatch=t;i=function(i){function r(r,u){i.call(this,r,u);this.delayLoadState=n.Engine.DELAYLOADSTATE_NONE;this.instances=[];this._onBeforeRenderCallbacks=[];this._onAfterRenderCallbacks=[];this._visibleInstances={};this._renderIdForInstances=[];this._batchCache=new t;this._instancesBufferSize=2048}return __extends(r,i),r.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},r.prototype.getVerticesData=function(n){return this._geometry?this._geometry.getVerticesData(n):null},r.prototype.getVertexBuffer=function(n){if(this._geometry)return this._geometry.getVertexBuffer(n)},r.prototype.isVerticesDataPresent=function(n){return this._geometry?this._geometry.isVerticesDataPresent(n):this._delayInfo?-1!==this._delayInfo.indexOf(n):!1},r.prototype.getVerticesDataKinds=function(){var n,t;if(!this._geometry){if(n=[],this._delayInfo)for(t in this._delayInfo)n.push(t);return n}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(){return this._geometry?this._geometry.getIndices():[]},r.prototype.isReady=function(){return this.delayLoadState===n.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isReady.call(this)},r.prototype.isDisposed=function(){return this._isDisposed},r.prototype._preActivate=function(){var n=this.getScene().getRenderId();this._preActivateId!=n&&(this._preActivateId=n,this._visibleInstances=null)},r.prototype._registerInstanceForRenderId=function(n,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId);this._visibleInstances[t]||(this._visibleInstances[t]=[]);this._visibleInstances[t].push(n)},r.prototype.refreshBoundingInfo=function(){var r=this.getVerticesData(n.VertexBuffer.PositionKind),i,t;if(r&&(i=n.Tools.ExtractMinAndMax(r,0,this.getTotalVertices()),this._boundingInfo=new n.BoundingInfo(i.minimum,i.maximum)),this.subMeshes)for(t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo();this._updateBoundingInfo()},r.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new n.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},r.prototype.subdivide=function(t){var f;if(!(1>t)){for(var u=this.getTotalIndices(),i=u/t|0,r=0;i%3!=0;)i++;for(this.releaseSubMeshes(),f=0;t>f&&!(r>=u);f++)n.SubMesh.CreateFromIndices(0,r,Math.min(i,u-r),this),r+=i;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,r){var f,u,e;t instanceof Array&&(f=i,i=t,t=f,n.Tools.Warn("Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable)."));this._geometry?this._geometry.setVerticesData(t,i,r):(u=new n.VertexData,u.set(i,t),e=this.getScene(),new n.Geometry(n.Geometry.RandomId(),e,u,r,this))},r.prototype.updateVerticesData=function(n,t,i,r){this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(n,t,i,!1)):this._geometry.updateVerticesData(n,t,i))},r.prototype.updateVerticesDataDirectly=function(n,t,i){this._geometry&&(i?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(n,t,!1)):this._geometry.updateVerticesDataDirectly(n,t))},r.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(n.Geometry.RandomId());t.applyToMesh(this)}},r.prototype.setIndices=function(t){var i,r;this._geometry?this._geometry.setIndices(t):(i=new n.VertexData,i.indices=t,r=this.getScene(),new n.Geometry(n.Geometry.RandomId(),r,i,!1,this))},r.prototype._bind=function(n,t,i){var r=this.getScene().getEngine(),u=this._geometry.getIndexBuffer();i&&(u=n.getLinesIndexBuffer(this.getIndices(),r));r.bindMultiBuffers(this._geometry.getVertexBuffers(),u,t)},r.prototype._draw=function(n,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(t,t?n.indexStart:0,t?n.indexCount:n.linesIndexCount,i)}},r.prototype._fullDraw=function(n,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(t,t?n.indexStart:0,t?n.indexCount:n.linesIndexCount,i)}},r.prototype.registerBeforeRender=function(n){this._onBeforeRenderCallbacks.push(n)},r.prototype.unregisterBeforeRender=function(n){var t=this._onBeforeRenderCallbacks.indexOf(n);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},r.prototype.registerAfterRender=function(n){this._onAfterRenderCallbacks.push(n)},r.prototype.unregisterAfterRender=function(n){var t=this._onAfterRenderCallbacks.indexOf(n);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},r.prototype._getInstancesRenderList=function(n){var r=this.getScene(),t,i;if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[n]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[n]=null,this._visibleInstances){if(t=r.getRenderId(),this._batchCache.visibleInstances[n]=this._visibleInstances[t],i=this._renderId,!this._batchCache.visibleInstances[n]&&this._visibleInstances.defaultRenderId&&(this._batchCache.visibleInstances[n]=this._visibleInstances[this._visibleInstances.defaultRenderId],t=this._visibleInstances.defaultRenderId,i=this._visibleInstances.selfDefaultRenderId),this._batchCache.visibleInstances[n]&&this._batchCache.visibleInstances[n].length){if(this._renderIdForInstances[n]===t)return this._batchCache.mustReturn=!0,this._batchCache;t!==i&&(this._batchCache.renderSelf[n]=!1)}this._renderIdForInstances[n]=t}return this._batchCache},r.prototype._renderWithInstances=function(n,t,i,r,u){for(var e,o,l,h=this.instances.length+1,c=64*h;this._instancesBufferSize<c;)this._instancesBufferSize*=2;(!this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(this._worldMatricesInstancesBuffer&&u.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=u.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4));var f=0,s=0,v=this.getWorldMatrix();if(i.renderSelf[n._id]&&(v.copyToArray(this._worldMatricesInstancesArray,f),f+=16,s++),e=i.visibleInstances[n._id],e)for(o=0;o<e.length;o++)l=e[o],l.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,f),f+=16,s++;var y=r.getAttributeLocationByName("world0"),p=r.getAttributeLocationByName("world1"),w=r.getAttributeLocationByName("world2"),b=r.getAttributeLocationByName("world3"),a=[y,p,w,b];u.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,a);this._draw(n,!t,s);u.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,a)},r.prototype.render=function(n){var s=this.getScene(),t=this._getInstancesRenderList(n._id),i,l,h,f,e,o,a;if(!t.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){for(i=0;i<this._onBeforeRenderCallbacks.length;i++)this._onBeforeRenderCallbacks[i]();var r=s.getEngine(),c=null!==r.getCaps().instancedArrays&&null!==t.visibleInstances[n._id],u=n.getMaterial();if(u&&u.isReady(this,c)){if(l=r.getDepthWrite(),this.renderOutline&&(r.setDepthWrite(!1),s.getOutlineRenderer().render(n,t)),u._preBind(),h=u.getEffect(),f=r.forceWireframe||u.wireframe,this._bind(n,h,f),e=this.getWorldMatrix(),u.bind(e,this),c)this._renderWithInstances(n,f,t,h,r);else if(t.renderSelf[n._id]&&this._draw(n,!f),t.visibleInstances[n._id])for(o=0;o<t.visibleInstances[n._id].length;o++)a=t.visibleInstances[n._id][o],e=a.getWorldMatrix(),u.bindOnlyWorldMatrix(e),this._draw(n,!f);for(u.unbind(),this.renderOutline&&l&&(r.setDepthWrite(!0),r.setColorWrite(!1),s.getOutlineRenderer().render(n,t),r.setColorWrite(!0)),i=0;i<this._onAfterRenderCallbacks.length;i++)this._onAfterRenderCallbacks[i]()}}},r.prototype.getEmittedParticleSystems=function(){for(var i,t=[],n=0;n<this.getScene().particleSystems.length;n++)i=this.getScene().particleSystems[n],i.emitter===this&&t.push(i);return t},r.prototype.getHierarchyEmittedParticleSystems=function(){var i=[],r=this.getDescendants(),n,t;for(r.push(this),n=0;n<this.getScene().particleSystems.length;n++)t=this.getScene().particleSystems[n],-1!==r.indexOf(t.emitter)&&i.push(t);return i},r.prototype.getChildren=function(){for(var i,t=[],n=0;n<this.getScene().meshes.length;n++)i=this.getScene().meshes[n],i.parent==this&&t.push(i);return t},r.prototype._checkDelayState=function(){var t=this,r=this,i=this.getScene(),u;this._geometry?this._geometry.load(i):r.delayLoadState===n.Engine.DELAYLOADSTATE_NOTLOADED&&(r.delayLoadState=n.Engine.DELAYLOADSTATE_LOADING,i._addPendingData(r),u=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata")?!0:!1,n.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t);t.delayLoadState=n.Engine.DELAYLOADSTATE_LOADED;i._removePendingData(t)},function(){},i.database,u))},r.prototype.isInFrustum=function(t){return this.delayLoadState===n.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isInFrustum.call(this,t)?(this._checkDelayState(),!0):!1},r.prototype.setMaterialByID=function(n){for(var r,i=this.getScene().materials,t=0;t<i.length;t++)if(i[t].id==n)return void(this.material=i[t]);for(r=this.getScene().multiMaterials,t=0;t<r.length;t++)if(r[t].id==n)return void(this.material=r[t])},r.prototype.getAnimatables=function(){var n=[];return this.material&&n.push(this.material),this.skeleton&&n.push(this.skeleton),n},r.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(n.VertexBuffer.PositionKind)){this._resetPointsArrayCache();for(var r=this.getVerticesData(n.VertexBuffer.PositionKind),u=[],i=0;i<r.length;i+=3)n.Vector3.TransformCoordinates(n.Vector3.FromArray(r,i),t).toArray(u,i);if(this.setVerticesData(n.VertexBuffer.PositionKind,u,this.getVertexBuffer(n.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(n.VertexBuffer.NormalKind)){for(r=this.getVerticesData(n.VertexBuffer.NormalKind),i=0;i<r.length;i+=3)n.Vector3.TransformNormal(n.Vector3.FromArray(r,i),t).toArray(u,i);this.setVerticesData(n.VertexBuffer.NormalKind,u,this.getVertexBuffer(n.VertexBuffer.NormalKind).isUpdatable())}}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){var t,i;if(this._positions)return!0;if(this._positions=[],t=this.getVerticesData(n.VertexBuffer.PositionKind),!t)return!1;for(i=0;i<t.length;i+=3)this._positions.push(n.Vector3.FromArray(t,i));return!0},r.prototype.clone=function(t,i,r){var u=new n.Mesh(t,this.getScene()),f,e,o;if(this._geometry.applyToMesh(u),n.Tools.DeepCopy(this,u,["name","material","skeleton"],[]),u.material=this.material,i&&(u.parent=i),!r)for(f=0;f<this.getScene().meshes.length;f++)e=this.getScene().meshes[f],e.parent==this&&e.clone(e.name,u);for(f=0;f<this.getScene().particleSystems.length;f++)o=this.getScene().particleSystems[f],o.emitter==this&&o.clone(o.name,u);return u.computeWorldMatrix(!0),u},r.prototype.dispose=function(n){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._worldMatricesInstancesBuffer&&(this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length;)this.instances[0].dispose();i.prototype.dispose.call(this,n)},r.prototype.applyDisplacementMap=function(t,i,r){var u=this,f=this.getScene(),e=function(n){var t=document.createElement("canvas"),o=t.getContext("2d"),f=n.width,e=n.height,s;t.width=f;t.height=e;o.drawImage(n,0,0);s=o.getImageData(0,0,f,e).data;u.applyDisplacementMapFromBuffer(s,f,e,i,r)};n.Tools.LoadImage(t,e,function(){},f.database)},r.prototype.applyDisplacementMapFromBuffer=function(t,i,r,u,f){if(!this.isVerticesDataPresent(n.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(n.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(n.VertexBuffer.UVKind))return void n.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var o=this.getVerticesData(n.VertexBuffer.PositionKind),c=this.getVerticesData(n.VertexBuffer.NormalKind),v=this.getVerticesData(n.VertexBuffer.UVKind),s=n.Vector3.Zero(),h=n.Vector3.Zero(),l=n.Vector2.Zero(),e=0;e<o.length;e+=3){n.Vector3.FromArrayToRef(o,e,s);n.Vector3.FromArrayToRef(c,e,h);n.Vector2.FromArrayToRef(v,e/3*2,l);var y=Math.abs(l.x)*i%i|0,p=Math.abs(l.y)*r%r|0,a=4*(y+p*i),w=t[a]/255,b=t[a+1]/255,k=t[a+2]/255,d=.3*w+.59*b+.11*k;h.normalize();h.scaleInPlace(u+(f-u)*d);s=s.add(h);s.toArray(o,e)}n.VertexData.ComputeNormals(o,this.getIndices(),c);this.updateVerticesData(n.VertexBuffer.PositionKind,o);this.updateVerticesData(n.VertexBuffer.NormalKind,c)},r.prototype.convertToFlatShadedMesh=function(){for(var t,a,g,v,h,l,f,u=this.getVerticesDataKinds(),o=[],w=[],s=[],b=!1,r=0;r<u.length;r++)t=u[r],a=this.getVertexBuffer(t),t!==n.VertexBuffer.NormalKind?(o[t]=a,w[t]=o[t].getData(),s[t]=[]):(b=a.isUpdatable(),u.splice(r,1),r--);var k=this.subMeshes.slice(0),e=this.getIndices(),d=this.getTotalIndices();for(i=0;d>i;i++)for(g=e[i],r=0;r<u.length;r++)for(t=u[r],v=o[t].getStrideSize(),h=0;v>h;h++)s[t].push(w[t][g*v+h]);for(var c=[],y=s[n.VertexBuffer.PositionKind],i=0;d>i;i+=3){e[i]=i;e[i+1]=i+1;e[i+2]=i+2;for(var it=n.Vector3.FromArray(y,3*i),nt=n.Vector3.FromArray(y,3*(i+1)),rt=n.Vector3.FromArray(y,3*(i+2)),ut=it.subtract(nt),ft=rt.subtract(nt),p=n.Vector3.Normalize(n.Vector3.Cross(ut,ft)),tt=0;3>tt;tt++)c.push(p.x),c.push(p.y),c.push(p.z)}for(this.setIndices(e),this.setVerticesData(n.VertexBuffer.NormalKind,c,b),r=0;r<u.length;r++)t=u[r],this.setVerticesData(t,s[t],o[t].isUpdatable());for(this.releaseSubMeshes(),l=0;l<k.length;l++)f=k[l],new n.SubMesh(f.materialIndex,f.indexStart,f.indexCount,f.indexStart,f.indexCount,this);this.synchronizeInstances()},r.prototype.createInstance=function(t){return new n.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var t,n=0;n<this.instances.length;n++)t=this.instances[n],t._syncSubMeshes()},r.CreateBox=function(t,i,r,u){var f=new n.Mesh(t,r),e=n.VertexData.CreateBox(i);return e.applyToMesh(f,u),f},r.CreateSphere=function(t,i,r,u,f){var e=new n.Mesh(t,u),o=n.VertexData.CreateSphere(i,r);return o.applyToMesh(e,f),e},r.CreateCylinder=function(t,i,r,u,f,e,o,s){void 0!==o&&o instanceof n.Scene||(void 0!==o&&(s=o),o=e,e=1);var h=new n.Mesh(t,o),c=n.VertexData.CreateCylinder(i,r,u,f,e);return c.applyToMesh(h,s),h},r.CreateTorus=function(t,i,r,u,f,e){var o=new n.Mesh(t,f),s=n.VertexData.CreateTorus(i,r,u);return s.applyToMesh(o,e),o},r.CreateTorusKnot=function(t,i,r,u,f,e,o,s,h){var c=new n.Mesh(t,s),l=n.VertexData.CreateTorusKnot(i,r,u,f,e,o);return l.applyToMesh(c,h),c},r.CreateLines=function(t,i,r,u){var f=new n.LinesMesh(t,r,u),e=n.VertexData.CreateLines(i);return e.applyToMesh(f,u),f},r.CreatePlane=function(t,i,r,u){var f=new n.Mesh(t,r),e=n.VertexData.CreatePlane(i);return e.applyToMesh(f,u),f},r.CreateGround=function(t,i,r,u,f,e){var o=new n.GroundMesh(t,f),s;return o._setReady(!1),o._subdivisions=u,s=n.VertexData.CreateGround(i,r,u),s.applyToMesh(o,e),o._setReady(!0),o},r.CreateTiledGround=function(t,i,r,u,f,e,o,s,h){var c=new n.Mesh(t,s),l=n.VertexData.CreateTiledGround(i,r,u,f,e,o);return l.applyToMesh(c,h),c},r.CreateGroundFromHeightMap=function(t,i,r,u,f,e,o,s,h){var c=new n.GroundMesh(t,s),l;return c._subdivisions=f,c._setReady(!1),l=function(t){var i=document.createElement("canvas"),a=i.getContext("2d"),s=t.width,l=t.height,v,y;i.width=s;i.height=l;a.drawImage(t,0,0);v=a.getImageData(0,0,s,l).data;y=n.VertexData.CreateGroundFromHeightMap(r,u,f,e,o,v,s,l);y.applyToMesh(c,h);c._setReady(!0)},n.Tools.LoadImage(i,l,function(){},s.database),c},r.MinMax=function(n){var i=null,r=null,u,f,t;for(u in n)f=n[u],t=f.getBoundingInfo().boundingBox,i?(i.MinimizeInPlace(t.minimumWorld),r.MaximizeInPlace(t.maximumWorld)):(i=t.minimumWorld,r=t.maximumWorld);return{min:i,max:r}},r.Center=function(t){var i=void 0!==t.min?t:n.Mesh.MinMax(t);return n.Vector3.Center(i.min,i.max)},r}(n.AbstractMesh);n.Mesh=i}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.generateOctree=!1;this._worldInverse=new n.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(){this.subdivide(this._subdivisions);this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new n.Ray(new n.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new n.Vector3(0,-1,0)),u;return this.getWorldMatrix().invertToRef(this._worldInverse),r=n.Ray.Transform(r,this._worldInverse),u=this.intersects(r),u.hit?u.pickedPoint.y:0},i}(n.Mesh);n.GroundMesh=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i){t.call(this,n,i.getScene());i.instances.push(this);this._sourceMesh=i;this.position.copyFrom(i.position);this.rotation.copyFrom(i.rotation);this.scaling.copyFrom(i.scaling);i.rotationQuaternion&&(this.rotationQuaternion=i.rotationQuaternion.clone());this.infiniteDistance=i.infiniteDistance;this.setPivotMatrix(i.getPivotMatrix());this.refreshBoundingInfo();this._syncSubMeshes()}return __extends(i,t),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(n){return this._sourceMesh.getVerticesData(n)},i.prototype.isVerticesDataPresent=function(n){return this._sourceMesh.isVerticesDataPresent(n)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var i=this._sourceMesh.getVerticesData(n.VertexBuffer.PositionKind),t;i&&(t=n.Tools.ExtractMinAndMax(i,0,this._sourceMesh.getTotalVertices()),this._boundingInfo=new n.BoundingInfo(t.minimum,t.maximum));this._updateBoundingInfo()},i.prototype._preActivate=function(){this.sourceMesh._preActivate()},i.prototype._activate=function(n){this.sourceMesh._registerInstanceForRenderId(this,n)},i.prototype._syncSubMeshes=function(){this.releaseSubMeshes();for(var n=0;n<this._sourceMesh.subMeshes.length;n++)this._sourceMesh.subMeshes[n].clone(this,this._sourceMesh)},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,r){var u=this._sourceMesh.createInstance(t),f,e;if(n.Tools.DeepCopy(this,u,["name"],[]),this.refreshBoundingInfo(),i&&(u.parent=i),!r)for(f=0;f<this.getScene().meshes.length;f++)e=this.getScene().meshes[f],e.parent==this&&e.clone(e.name,u);return u.computeWorldMatrix(!0),u},i.prototype.dispose=function(n){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1);t.prototype.dispose.call(this,n)},i}(n.AbstractMesh);n.InstancedMesh=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t,i,r,u,f,e,o){"undefined"==typeof o&&(o=!0);this.materialIndex=n;this.verticesStart=t;this.verticesCount=i;this.indexStart=r;this.indexCount=u;this._renderId=0;this._mesh=f;this._renderingMesh=e||f;f.subMeshes.push(this);this._id=f.subMeshes.length-1;o&&this.refreshBoundingInfo()}return t.prototype.getBoundingInfo=function(){return this._boundingInfo},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var t=this._renderingMesh.material,i;return t&&t instanceof n.MultiMaterial?(i=t,i.getSubMaterial(this.materialIndex)):t?t:this._mesh.getScene().defaultMaterial},t.prototype.refreshBoundingInfo=function(){var t=this._renderingMesh.getVerticesData(n.VertexBuffer.PositionKind),i,r;if(!t)return void(this._boundingInfo=this._mesh._boundingInfo);r=this._renderingMesh.getIndices();i=0===this.indexStart&&this.indexCount===r.length?n.Tools.ExtractMinAndMax(t,this.verticesStart,this.verticesCount):n.Tools.ExtractMinAndMaxIndexed(t,r,this.indexStart,this.indexCount);this._boundingInfo=new n.BoundingInfo(i.minimum,i.maximum)},t.prototype._checkCollision=function(n){return this._boundingInfo._checkCollision(n)},t.prototype.updateBoundingInfo=function(n){this._boundingInfo||this.refreshBoundingInfo();this._boundingInfo._update(n)},t.prototype.isInFrustum=function(n){return this._boundingInfo.isInFrustum(n)},t.prototype.render=function(){this._renderingMesh.render(this)},t.prototype.getLinesIndexBuffer=function(n,t){if(!this._linesIndexBuffer){for(var r=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)r.push(n[i],n[i+1],n[i+1],n[i+2],n[i+2],n[i]);this._linesIndexBuffer=t.createIndexBuffer(r);this.linesIndexCount=r.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(n){return n.intersectsBox(this._boundingInfo.boundingBox)},t.prototype.intersects=function(n,t,i,r){for(var f=null,u=this.indexStart;u<this.indexStart+this.indexCount;u+=3){var o=t[i[u]],s=t[i[u+1]],h=t[i[u+2]],e=n.intersectsTriangle(o,s,h);if(e&&(r||!f||e.distance<f.distance)&&(f=e,f.faceId=u/3,r))break}return f},t.prototype.clone=function(i,r){var u=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,i,r,!1);return u._boundingInfo=new n.BoundingInfo(this._boundingInfo.minimum,this._boundingInfo.maximum),u},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var n=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(n,1)},t.CreateFromIndices=function(t,i,r,u,f){var o=Number.MAX_VALUE,h=-Number.MAX_VALUE,c,s,e;for(f=f||u,c=f.getIndices(),s=i;i+r>s;s++)e=c[s],o>e&&(o=e),e>h&&(h=e);return new n.SubMesh(t,o,h-o+1,i,r,u,f)},t}();n.SubMesh=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t){this.delayLoadState=n.Engine.DELAYLOADSTATE_NONE;this.hasAlpha=!1;this.getAlphaFromRGB=!1;this.level=1;this.isCube=!1;this.isRenderTarget=!1;this.animations=[];this.coordinatesIndex=0;this.coordinatesMode=n.Texture.EXPLICIT_MODE;this.wrapU=n.Texture.WRAP_ADDRESSMODE;this.wrapV=n.Texture.WRAP_ADDRESSMODE;this.anisotropicFilteringLevel=4;this._scene=t;this._scene.textures.push(this)}return t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return null},t.prototype.getReflectionTextureMatrix=function(){return null},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReady=function(){return this.delayLoadState===n.Engine.DELAYLOADSTATE_NOTLOADED?!0:this._texture?this._texture.isReady:!1},t.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},t.prototype.getBaseSize=function(){return this.isReady()?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},t.prototype._getFromCache=function(n,t){for(var i,u=this._scene.getEngine().getLoadedTexturesCache(),r=0;r<u.length;r++)if(i=u[r],i.url===n&&i.noMipmap===t)return i.references++,i;return null},t.prototype.delayLoad=function(){},t.prototype.releaseInternalTexture=function(){var n,t;this._texture&&(n=this._scene.getEngine().getLoadedTexturesCache(),(this._texture.references--,0==this._texture.references)&&(t=n.indexOf(this._texture),n.splice(t,1),this._scene.getEngine()._releaseTexture(this._texture),delete this._texture))},t.prototype.clone=function(){return null},t.prototype.dispose=function(){var n=this._scene.textures.indexOf(this);n>=0&&this._scene.textures.splice(n,1);void 0!==this._texture&&(this.releaseInternalTexture(),this.onDispose&&this.onDispose())},t}();n.BaseTexture=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){this.index=t;this._opaqueSubMeshes=new n.SmartArray(256);this._transparentSubMeshes=new n.SmartArray(256);this._alphaTestSubMeshes=new n.SmartArray(256);this._scene=i}return t.prototype.render=function(t,i){var r,u,f,e;if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,i),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return!1;for(f=this._scene.getEngine(),r=0;r<this._opaqueSubMeshes.length;r++)u=this._opaqueSubMeshes.data[r],this._activeVertices+=u.verticesCount,u.render();for(f.setAlphaTesting(!0),r=0;r<this._alphaTestSubMeshes.length;r++)u=this._alphaTestSubMeshes.data[r],this._activeVertices+=u.verticesCount,u.render();if(f.setAlphaTesting(!1),i&&i(),this._transparentSubMeshes.length){for(r=0;r<this._transparentSubMeshes.length;r++)u=this._transparentSubMeshes.data[r],u._distanceToCamera=u.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length();for(e=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length),e.sort(function(n,t){return n._distanceToCamera<t._distanceToCamera?1:n._distanceToCamera>t._distanceToCamera?-1:0}),f.setAlphaMode(n.Engine.ALPHA_COMBINE),r=0;r<e.length;r++)u=e[r],this._activeVertices+=u.verticesCount,u.render();f.setAlphaMode(n.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset();this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(n){var t=n.getMaterial(),i=n.getMesh();t.needAlphaBlending()||i.visibility<1?(t.alpha>0||i.visibility<1)&&this._transparentSubMeshes.push(n):t.needAlphaTesting()?this._alphaTestSubMeshes.push(n):this._opaqueSubMeshes.push(n)},t}();n.RenderingGroup=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n){this._renderingGroups=[];this._scene=n}return t.prototype._renderParticles=function(n,t){var u,r,i;if(0!==this._scene._activeParticleSystems.length){for(u=(new Date).getTime(),r=0;r<this._scene._activeParticleSystems.length;r++)i=this._scene._activeParticleSystems.data[r],i.renderingGroupId===n&&(this._clearDepthBuffer(),i.emitter.position&&t&&-1===t.indexOf(i.emitter)||(this._scene._activeParticles+=i.render()));this._scene._particlesDuration+=(new Date).getTime()-u}},t.prototype._renderSprites=function(n){var r,t,i;if(0!==this._scene.spriteManagers.length){for(r=(new Date).getTime(),t=0;t<this._scene.spriteManagers.length;t++)i=this._scene.spriteManagers[t],i.renderingGroupId===n&&(this._clearDepthBuffer(),i.render());this._scene._spritesDuration+=(new Date).getTime()-r}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype.render=function(t,i,r,u){for(var e,o=this,f=0;f<n.RenderingManager.MAX_RENDERINGGROUPS;f++)this._depthBufferAlreadyCleaned=!1,e=this._renderingGroups[f],e?(this._clearDepthBuffer(),e.render(t,function(){u&&o._renderSprites(f)})||this._renderingGroups.splice(f,1)):u&&this._renderSprites(f),r&&this._renderParticles(f,i)},t.prototype.reset=function(){var n,t;for(n in this._renderingGroups)t=this._renderingGroups[n],t.prepare()},t.prototype.dispatch=function(t){var r=t.getMesh(),i=r.renderingGroupId||0;this._renderingGroups[i]||(this._renderingGroups[i]=new n.RenderingGroup(i,this._scene));this._renderingGroups[i].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();n.RenderingManager=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(r,u,f,e,o,s,h,c,l){"undefined"==typeof o&&(o=i.TRILINEAR_SAMPLINGMODE);"undefined"==typeof s&&(s=null);"undefined"==typeof h&&(h=null);"undefined"==typeof c&&(c=null);"undefined"==typeof l&&(l=!1);t.call(this,u);this.uOffset=0;this.vOffset=0;this.uScale=1;this.vScale=1;this.uAng=0;this.vAng=0;this.wAng=0;this.name=r;this.url=r;this._noMipmap=f;this._invertY=e;this._samplingMode=o;this._buffer=c;this._deleteBuffer=l;r&&(this._texture=this._getFromCache(r,f),this._texture||(u.useDelayedTextureLoading?this.delayLoadState=n.Engine.DELAYLOADSTATE_NOTLOADED:(this._texture=u.getEngine().createTexture(r,f,e,u,this._samplingMode,s,h,this._buffer),l&&delete this._buffer)))}return __extends(i,t),i.prototype.delayLoad=function(){this.delayLoadState==n.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=n.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,null,null,this._buffer),this._deleteBuffer&&delete this._buffer))},i.prototype._prepareRowForTextureGeneration=function(t,i,r,u){t-=this.uOffset+.5;i-=this.vOffset+.5;r-=.5;n.Vector3.TransformCoordinatesFromFloatsToRef(t,i,r,this._rowGenerationMatrix,u);u.x*=this.uScale;u.y*=this.vScale;u.x+=.5;u.y+=.5;u.z+=.5},i.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=n.Matrix.Zero(),this._rowGenerationMatrix=new n.Matrix,this._t0=n.Vector3.Zero(),this._t1=n.Vector3.Zero(),this._t2=n.Vector3.Zero()),n.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),n.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},i.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=n.Matrix.Zero(),this._projectionModeMatrix=n.Matrix.Zero()),this.coordinatesMode){case n.Texture.SPHERICAL_MODE:n.Matrix.IdentityToRef(this._cachedTextureMatrix);this._cachedTextureMatrix[0]=-.5*this.uScale;this._cachedTextureMatrix[5]=-.5*this.vScale;this._cachedTextureMatrix[12]=.5+this.uOffset;this._cachedTextureMatrix[13]=.5+this.vOffset;break;case n.Texture.PLANAR_MODE:n.Matrix.IdentityToRef(this._cachedTextureMatrix);this._cachedTextureMatrix[0]=this.uScale;this._cachedTextureMatrix[5]=this.vScale;this._cachedTextureMatrix[12]=this.uOffset;this._cachedTextureMatrix[13]=this.vOffset;break;case n.Texture.PROJECTION_MODE:n.Matrix.IdentityToRef(this._projectionModeMatrix);this._projectionModeMatrix.m[0]=.5;this._projectionModeMatrix.m[5]=-.5;this._projectionModeMatrix.m[10]=0;this._projectionModeMatrix.m[12]=.5;this._projectionModeMatrix.m[13]=.5;this._projectionModeMatrix.m[14]=1;this._projectionModeMatrix.m[15]=1;this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:n.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},i.prototype.clone=function(){var t=new n.Texture(this._texture.url,this.getScene(),this._noMipmap,this._invertY);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t.uOffset=this.uOffset,t.vOffset=this.vOffset,t.uScale=this.uScale,t.vScale=this.vScale,t.uAng=this.uAng,t.vAng=this.vAng,t.wAng=this.wAng,t},i.NEAREST_SAMPLINGMODE=1,i.BILINEAR_SAMPLINGMODE=2,i.TRILINEAR_SAMPLINGMODE=3,i.EXPLICIT_MODE=0,i.SPHERICAL_MODE=1,i.PLANAR_MODE=2,i.CUBIC_MODE=3,i.PROJECTION_MODE=4,i.SKYBOX_MODE=5,i.CLAMP_ADDRESSMODE=0,i.WRAP_ADDRESSMODE=1,i.MIRROR_ADDRESSMODE=2,i}(n.BaseTexture);n.Texture=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f){t.call(this,r);this.coordinatesMode=n.Texture.CUBIC_MODE;this.name=i;this.url=i;this._noMipmap=f;this.hasAlpha=!1;this._texture=this._getFromCache(i,f);u||(u=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]);this._extensions=u;this._texture||(r.useDelayedTextureLoading?this.delayLoadState=n.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=r.getEngine().createCubeTexture(i,r,u,f));this.isCube=!0;this._textureMatrix=n.Matrix.Identity()}return __extends(i,t),i.prototype.clone=function(){var t=new n.CubeTexture(this.url,this.getScene(),this._extensions,this._noMipmap);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t},i.prototype.delayLoad=function(){this.delayLoadState==n.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=n.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i}(n.BaseTexture);n.CubeTexture=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f,e){"undefined"==typeof e&&(e=!0);t.call(this,null,u,!f);this.renderList=[];this.renderParticles=!0;this.renderSprites=!1;this.coordinatesMode=n.Texture.PROJECTION_MODE;this._currentRefreshId=-1;this._refreshRate=1;this.name=i;this.isRenderTarget=!0;this._size=r;this._generateMipMaps=f;this._doNotChangeAspectRatio=e;this._texture=u.getEngine().createRenderTargetTexture(r,f);this._renderingManager=new n.RenderingManager(u)}return __extends(i,t),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(n){this._refreshRate=n;this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate==this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.getRenderSize=function(){return this._size},i.prototype.resize=function(n,t){this.releaseInternalTexture();this._texture=this.getScene().getEngine().createRenderTargetTexture(n,t)},i.prototype.render=function(n){var i=this.getScene(),e=i.getEngine(),r,s,u,t,f,o;if(this._waitingRenderList){for(this.renderList=[],r=0;r<this._waitingRenderList.length;r++)s=this._waitingRenderList[r],this.renderList.push(i.getMeshByID(s));delete this._waitingRenderList}if(this.renderList){for(n&&i.postProcessManager._prepareFrame(this._texture)||e.bindFramebuffer(this._texture),e.clear(i.clearColor,!0,!0),this._renderingManager.reset(),u=0;u<this.renderList.length;u++)if(t=this.renderList[u],t){if(!t.isReady()||t.material&&!t.material.isReady()){this.resetRefreshCounter();continue}if(t.isEnabled()&&t.isVisible&&t.subMeshes&&0!=(t.layerMask&i.activeCamera.layerMask))for(t._activate(i.getRenderId()),f=0;f<t.subMeshes.length;f++)o=t.subMeshes[f],i._activeVertices+=o.verticesCount,this._renderingManager.dispatch(o)}this._doNotChangeAspectRatio||i.updateTransformMatrix(!0);this.onBeforeRender&&this.onBeforeRender();this._renderingManager.render(this.customRenderFunction,this.renderList,this.renderParticles,this.renderSprites);n&&i.postProcessManager._finalizeFrame(!1,this._texture);this.onAfterRender&&this.onAfterRender();e.unBindFramebuffer(this._texture);this._doNotChangeAspectRatio||i.updateTransformMatrix(!0)}},i.prototype.clone=function(){var i=this.getSize(),t=new n.RenderTargetTexture(this.name,i.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t.renderList=this.renderList.slice(0),t},i}(n.Texture);n.RenderTargetTexture=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f){var e=this;t.call(this,i,r,u,f,!0);this.mirrorPlane=new n.Plane(0,1,0,1);this._transformMatrix=n.Matrix.Zero();this._mirrorMatrix=n.Matrix.Zero();this.onBeforeRender=function(){n.Matrix.ReflectionToRef(e.mirrorPlane,e._mirrorMatrix);e._savedViewMatrix=u.getViewMatrix();e._mirrorMatrix.multiplyToRef(e._savedViewMatrix,e._transformMatrix);u.setTransformMatrix(e._transformMatrix,u.getProjectionMatrix());u.clipPlane=e.mirrorPlane;u.getEngine().cullBackFaces=!1};this.onAfterRender=function(){u.setTransformMatrix(e._savedViewMatrix,u.getProjectionMatrix());u.getEngine().cullBackFaces=!0;delete u.clipPlane}}return __extends(i,t),i.prototype.clone=function(){var i=this.getSize(),t=new n.MirrorTexture(this.name,i.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.mirrorPlane=this.mirrorPlane.clone(),t.renderList=this.renderList.slice(0),t},i}(n.RenderTargetTexture);n.MirrorTexture=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f,e){"undefined"==typeof e&&(e=n.Texture.TRILINEAR_SAMPLINGMODE);t.call(this,null,u,!f);this.name=i;this.wrapU=n.Texture.CLAMP_ADDRESSMODE;this.wrapV=n.Texture.CLAMP_ADDRESSMODE;this._generateMipMaps=f;r.getContext?(this._canvas=r,this._texture=u.getEngine().createDynamicTexture(r.width,r.height,f,e)):(this._canvas=document.createElement("canvas"),this._texture=r.width?u.getEngine().createDynamicTexture(r.width,r.height,f,e):u.getEngine().createDynamicTexture(r,r,f,e));var o=this.getSize();this._canvas.width=o.width;this._canvas.height=o.height;this._context=this._canvas.getContext("2d")}return __extends(i,t),i.prototype.getContext=function(){return this._context},i.prototype.update=function(n){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===n?!0:n)},i.prototype.drawText=function(n,t,i,r,u,f,e){var o=this.getSize(),s;(f&&(this._context.fillStyle=f,this._context.fillRect(0,0,o.width,o.height)),this._context.font=r,null===t)&&(s=this._context.measureText(n),t=(o.width-s.width)/2);this._context.fillStyle=u;this._context.fillText(n,t,i);this.update(e)},i.prototype.clone=function(){var i=this.getSize(),t=new n.DynamicTexture(this.name,i.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t},i}(n.Texture);n.DynamicTexture=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f,e,o,s){var h,l,a,c;"undefined"==typeof s&&(s=n.Texture.TRILINEAR_SAMPLINGMODE);h=this;t.call(this,null,f,!e,o);this._autoLaunch=!0;this.name=i;this.wrapU=n.Texture.WRAP_ADDRESSMODE;this.wrapV=n.Texture.WRAP_ADDRESSMODE;l=u.width||u;a=u.height||u;this._texture=f.getEngine().createDynamicTexture(l,a,e,s);c=this.getSize();this.video=document.createElement("video");this.video.width=c.width;this.video.height=c.height;this.video.autoplay=!1;this.video.loop=!0;this.video.addEventListener("canplaythrough",function(){h._texture&&(h._texture.isReady=!0)});r.forEach(function(n){var t=document.createElement("source");t.src=n;h.video.appendChild(t)});this._lastUpdate=(new Date).getTime()}return __extends(i,t),i.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var n=(new Date).getTime();return n-this._lastUpdate<15?!1:(this._lastUpdate=n,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},i}(n.Texture);n.VideoTexture=t}(BABYLON||(BABYLON={}));!function(n){var i=function(){function n(){this._defines={};this._currentRank=32;this._maxRank=-1}return n.prototype.addFallback=function(n,t){this._defines[n]||(n<this._currentRank&&(this._currentRank=n),n>this._maxRank&&(this._maxRank=n),this._defines[n]=[]);this._defines[n].push(t)},Object.defineProperty(n.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),n.prototype.reduce=function(n){for(var i=this._defines[this._currentRank],t=0;t<i.length;t++)n=n.replace("#define "+i[t],"");return this._currentRank++,n},n}(),t;n.EffectFallbacks=i;t=function(){function t(n,t,i,r,u,f,e,o,s){var l=this,h,c;this._isReady=!1;this._compilationError="";this._valueCache=[];this._engine=u;this.name=n;this.defines=f;this._uniformsNames=i.concat(r);this._samplers=r;this._attributesNames=t;this.onError=s;this.onCompiled=o;n.vertexElement?(h=document.getElementById(n.vertexElement),h||(h=n.vertexElement)):h=n.vertex||n;n.fragmentElement?(c=document.getElementById(n.fragmentElement),c||(c=n.fragmentElement)):c=n.fragment||n;this._loadVertexShader(h,function(n){l._loadFragmentShader(c,function(i){l._prepareEffect(n,i,t,f,e)})})}return t.prototype.isReady=function(){return this._isReady},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(n){return this._attributes[n]},t.prototype.getAttributeLocationByName=function(n){var t=this._attributesNames.indexOf(n);return this._attributes[t]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(n){return this._uniformsNames.indexOf(n)},t.prototype.getUniform=function(n){return this._uniforms[this._uniformsNames.indexOf(n)]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype._loadVertexShader=function(t,i){var r,u;if(t instanceof HTMLElement)return r=n.Tools.GetDOMTextContent(t),void i(r);if(n.Effect.ShadersStore[t+"VertexShader"])return void i(n.Effect.ShadersStore[t+"VertexShader"]);u="."===t[0]?t:n.Engine.ShadersRepository+t;n.Tools.LoadFile(u+".vertex.fx",i)},t.prototype._loadFragmentShader=function(t,i){var r,u;if(t instanceof HTMLElement)return r=n.Tools.GetDOMTextContent(t),void i(r);if(n.Effect.ShadersStore[t+"PixelShader"])return void i(n.Effect.ShadersStore[t+"PixelShader"]);if(n.Effect.ShadersStore[t+"FragmentShader"])return void i(n.Effect.ShadersStore[t+"FragmentShader"]);u="."===t[0]?t:n.Engine.ShadersRepository+t;n.Tools.LoadFile(u+".fragment.fx",i)},t.prototype._prepareEffect=function(t,i,r,u,f){var o,e,s;try{for(o=this._engine,this._program=o.createShaderProgram(t,i,u),this._uniforms=o.getUniforms(this._program,this._uniformsNames),this._attributes=o.getAttributes(this._program,r),e=0;e<this._samplers.length;e++)s=this.getUniform(this._samplers[e]),null==s&&(this._samplers.splice(e,1),e--);o.bindSamplers(this);this._isReady=!0;this.onCompiled&&this.onCompiled(this)}catch(h){f&&f.isMoreFallbacks?(u=f.reduce(u),this._prepareEffect(t,i,r,u,f)):(n.Tools.Error("Unable to compile effect: "+this.name),n.Tools.Error("Defines: "+u),n.Tools.Error("Error: "+h.message),this._compilationError=h.message,this.onError&&this.onError(this,this._compilationError))}},t.prototype._bindTexture=function(n,t){this._engine._bindTexture(this._samplers.indexOf(n),t)},t.prototype.setTexture=function(n,t){this._engine.setTexture(this._samplers.indexOf(n),t)},t.prototype.setTextureFromPostProcess=function(n,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(n),t)},t.prototype._cacheFloat2=function(n,t,i){return this._valueCache[n]?(this._valueCache[n][0]=t,void(this._valueCache[n][1]=i)):void(this._valueCache[n]=[t,i])},t.prototype._cacheFloat3=function(n,t,i,r){return this._valueCache[n]?(this._valueCache[n][0]=t,this._valueCache[n][1]=i,void(this._valueCache[n][2]=r)):void(this._valueCache[n]=[t,i,r])},t.prototype._cacheFloat4=function(n,t,i,r,u){return this._valueCache[n]?(this._valueCache[n][0]=t,this._valueCache[n][1]=i,this._valueCache[n][2]=r,void(this._valueCache[n][3]=u)):void(this._valueCache[n]=[t,i,r,u])},t.prototype.setArray=function(n,t){return this._engine.setArray(this.getUniform(n),t),this},t.prototype.setMatrices=function(n,t){return this._engine.setMatrices(this.getUniform(n),t),this},t.prototype.setMatrix=function(n,t){return this._engine.setMatrix(this.getUniform(n),t),this},t.prototype.setFloat=function(n,t){return this._valueCache[n]&&this._valueCache[n]===t?this:(this._valueCache[n]=t,this._engine.setFloat(this.getUniform(n),t),this)},t.prototype.setBool=function(n,t){return this._valueCache[n]&&this._valueCache[n]===t?this:(this._valueCache[n]=t,this._engine.setBool(this.getUniform(n),t?1:0),this)},t.prototype.setVector2=function(n,t){return this._valueCache[n]&&this._valueCache[n][0]==t.x&&this._valueCache[n][1]==t.y?this:(this._cacheFloat2(n,t.x,t.y),this._engine.setFloat2(this.getUniform(n),t.x,t.y),this)},t.prototype.setFloat2=function(n,t,i){return this._valueCache[n]&&this._valueCache[n][0]==t&&this._valueCache[n][1]==i?this:(this._cacheFloat2(n,t,i),this._engine.setFloat2(this.getUniform(n),t,i),this)},t.prototype.setVector3=function(n,t){return this._valueCache[n]&&this._valueCache[n][0]==t.x&&this._valueCache[n][1]==t.y&&this._valueCache[n][2]==t.z?this:(this._cacheFloat3(n,t.x,t.y,t.z),this._engine.setFloat3(this.getUniform(n),t.x,t.y,t.z),this)},t.prototype.setFloat3=function(n,t,i,r){return this._valueCache[n]&&this._valueCache[n][0]==t&&this._valueCache[n][1]==i&&this._valueCache[n][2]==r?this:(this._cacheFloat3(n,t,i,r),this._engine.setFloat3(this.getUniform(n),t,i,r),this)},t.prototype.setFloat4=function(n,t,i,r,u){return this._valueCache[n]&&this._valueCache[n][0]==t&&this._valueCache[n][1]==i&&this._valueCache[n][2]==r&&this._valueCache[n][3]==u?this:(this._cacheFloat4(n,t,i,r,u),this._engine.setFloat4(this.getUniform(n),t,i,r,u),this)},t.prototype.setColor3=function(n,t){return this._valueCache[n]&&this._valueCache[n][0]==t.r&&this._valueCache[n][1]==t.g&&this._valueCache[n][2]==t.b?this:(this._cacheFloat3(n,t.r,t.g,t.b),this._engine.setColor3(this.getUniform(n),t),this)},t.prototype.setColor4=function(n,t,i){return this._valueCache[n]&&this._valueCache[n][0]==t.r&&this._valueCache[n][1]==t.g&&this._valueCache[n][2]==t.b&&this._valueCache[n][3]==i?this:(this._cacheFloat4(n,t.r,t.g,t.b,i),this._engine.setColor4(this.getUniform(n),t,i),this)},t.ShadersStore={anaglyphPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\n\nvoid main(void)\n{\n    vec4 leftFrag = texture2D(leftSampler, vUV);\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\n\n\tvec4 rightFrag = texture2D(textureSampler, vUV);\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\n\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\n}",blackAndWhitePixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nvoid main(void) \n{\n\tfloat luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\n\tgl_FragColor = vec4(luminance, luminance, luminance, 1.0);\n}",blurPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nvoid main(void)\n{\n\tfloat weights[7];\n\tweights[0] = 0.05;\n\tweights[1] = 0.1;\n\tweights[2] = 0.2;\n\tweights[3] = 0.3;\n\tweights[4] = 0.2;\n\tweights[5] = 0.1;\n\tweights[6] = 0.05;\n\n\tvec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\n\tvec2 texelStep = texelSize * direction * blurWidth;\n\tvec2 start = vUV - 3.0 * texelStep;\n\n\tvec4 baseColor = vec4(0., 0., 0., 0.);\n\tvec2 texelOffset = vec2(0., 0.);\n\n\tfor (int i = 0; i < 7; i++)\n\t{\n\t\tbaseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\n\t\ttexelOffset += texelStep;\n\t}\n\n\tgl_FragColor = baseColor;\n}",colorPixelShader:"precision highp float;\n\nuniform vec4 color;\n\nvoid main(void) {\n\tgl_FragColor = color;\n}",colorVertexShader:"precision highp float;\n\n// Attributes\nattribute vec3 position;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\nvoid main(void) {\n\tgl_Position = worldViewProjection * vec4(position, 1.0);\n}",convolutionPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform float kernel[9];\n\nvoid main(void)\n{\n\tvec2 onePixel = vec2(1.0, 1.0) / screenSize;\n\tvec4 colorSum =\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\n\t\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\n\n\tfloat kernelWeight =\n\t\tkernel[0] +\n\t\tkernel[1] +\n\t\tkernel[2] +\n\t\tkernel[3] +\n\t\tkernel[4] +\n\t\tkernel[5] +\n\t\tkernel[6] +\n\t\tkernel[7] +\n\t\tkernel[8];\n\n\tif (kernelWeight <= 0.0) {\n\t\tkernelWeight = 1.0;\n\t}\n\n\tgl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\n}",defaultPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define MAP_EXPLICIT\t0.\n#define MAP_SPHERICAL\t1.\n#define MAP_PLANAR\t\t2.\n#define MAP_CUBIC\t\t3.\n#define MAP_PROJECTION\t4.\n#define MAP_SKYBOX\t\t5.\n\n// Constants\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\nuniform vec4 vSpecularColor;\nuniform vec3 vEmissiveColor;\n\n// Input\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n// Lights\n#ifdef LIGHT0\nuniform vec4 vLightData0;\nuniform vec4 vLightDiffuse0;\nuniform vec3 vLightSpecular0;\n#ifdef SHADOW0\nvarying vec4 vPositionFromLight0;\nuniform sampler2D shadowSampler0;\nuniform float darkness0;\n#endif\n#ifdef SPOTLIGHT0\nuniform vec4 vLightDirection0;\n#endif\n#ifdef HEMILIGHT0\nuniform vec3 vLightGround0;\n#endif\n#endif\n\n#ifdef LIGHT1\nuniform vec4 vLightData1;\nuniform vec4 vLightDiffuse1;\nuniform vec3 vLightSpecular1;\n#ifdef SHADOW1\nvarying vec4 vPositionFromLight1;\nuniform sampler2D shadowSampler1;\nuniform float darkness1;\n#endif\n#ifdef SPOTLIGHT1\nuniform vec4 vLightDirection1;\n#endif\n#ifdef HEMILIGHT1\nuniform vec3 vLightGround1;\n#endif\n#endif\n\n#ifdef LIGHT2\nuniform vec4 vLightData2;\nuniform vec4 vLightDiffuse2;\nuniform vec3 vLightSpecular2;\n#ifdef SHADOW2\nvarying vec4 vPositionFromLight2;\nuniform sampler2D shadowSampler2;\nuniform float darkness2;\n#endif\n#ifdef SPOTLIGHT2\nuniform vec4 vLightDirection2;\n#endif\n#ifdef HEMILIGHT2\nuniform vec3 vLightGround2;\n#endif\n#endif\n\n#ifdef LIGHT3\nuniform vec4 vLightData3;\nuniform vec4 vLightDiffuse3;\nuniform vec3 vLightSpecular3;\n#ifdef SHADOW3\nvarying vec4 vPositionFromLight3;\nuniform sampler2D shadowSampler3;\nuniform float darkness3;\n#endif\n#ifdef SPOTLIGHT3\nuniform vec4 vLightDirection3;\n#endif\n#ifdef HEMILIGHT3\nuniform vec3 vLightGround3;\n#endif\n#endif\n\n// Samplers\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\t\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n// Fresnel\n#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\n{\n\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\n\treturn clamp(fresnelTerm, 0., 1.);\n}\n#endif\n\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n// Reflection\n#ifdef REFLECTION\nvarying vec3 vPositionUVW;\nuniform samplerCube reflectionCubeSampler;\nuniform sampler2D reflection2DSampler;\nuniform vec3 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform mat4 view;\n\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\n{\n\tif (mode == MAP_SPHERICAL)\n\t{\n\t\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\n\t}\n\telse if (mode == MAP_PLANAR)\n\t{\n\t\tvec3 viewDir = worldPos.xyz - vEyePosition;\n\t\tvec3 coords = normalize(reflect(viewDir, worldNormal));\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 1));\n\t}\n\telse if (mode == MAP_CUBIC)\n\t{\n\t\tvec3 viewDir = worldPos.xyz - vEyePosition;\n\t\tvec3 coords = reflect(viewDir, worldNormal);\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 0));\n\t}\n\telse if (mode == MAP_PROJECTION)\n\t{\n\t\treturn vec3(reflectionMatrix * (view * worldPos));\n\t}\n\telse if (mode == MAP_SKYBOX)\n\t{\n\t\treturn vPositionUVW;\n\t}\n\n\treturn vec3(0, 0, 0);\n}\n#endif\n\n// Shadows\n#ifdef SHADOWS\n\nfloat unpack(vec4 color)\n{\n\tconst vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\n\treturn dot(color, bitShift);\n}\n\nfloat unpackHalf(vec2 color)\n{\n\treturn color.x + (color.y / 255.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tfloat shadow = unpack(texture2D(shadowSampler, uv));\n\n\tif (depth.z > shadow)\n\t{\n\t\treturn darkness;\n\t}\n\treturn 1.;\n}\n\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tfloat visibility = 1.;\n\n\tvec2 poissonDisk[4];\n\tpoissonDisk[0] = vec2(-0.94201624, -0.39906216);\n\tpoissonDisk[1] = vec2(0.94558609, -0.76890725);\n\tpoissonDisk[2] = vec2(-0.094184101, -0.92938870);\n\tpoissonDisk[3] = vec2(0.34495938, 0.29387760);\n\n\t// Poisson Sampling\n\tfor (int i = 0; i<4; i++){\n\t\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[i] / 1500.0))  <  depth.z){\n\t\t\tvisibility -= 0.2;\n\t\t}\n\t}\n\treturn visibility;\n}\n\n// Thanks to http://devmaster.net/\nfloat ChebychevInequality(vec2 moments, float t)\n{\n\tif (t <= moments.x)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tfloat variance = moments.y - (moments.x * moments.x);\n\tvariance = max(variance, 0.);\n\n\tfloat d = t - moments.x;\n\treturn variance / (variance + d * d);\n}\n\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tvec4 texel = texture2D(shadowSampler, uv);\n\n\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\n\treturn clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\n}\n#endif\n\n// Bump\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform sampler2D bumpSampler;\n\n// Thanks to http://www.thetenthplanet.de/archives/1180\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\n{\n\t// get edge vectors of the pixel triangle\n\tvec3 dp1 = dFdx(p);\n\tvec3 dp2 = dFdy(p);\n\tvec2 duv1 = dFdx(uv);\n\tvec2 duv2 = dFdy(uv);\n\n\t// solve the linear system\n\tvec3 dp2perp = cross(dp2, normal);\n\tvec3 dp1perp = cross(normal, dp1);\n\tvec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n\tvec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\n\n\t// construct a scale-invariant frame \n\tfloat invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\n\treturn mat3(tangent * invmax, binormal * invmax, normal);\n}\n\nvec3 perturbNormal(vec3 viewDir)\n{\n\tvec3 map = texture2D(bumpSampler, vBumpUV).xyz * vBumpInfos.y;\n\tmap = map * 255. / 127. - 128. / 127.;\n\tmat3 TBN = cotangent_frame(vNormalW, -viewDir, vBumpUV);\n\treturn normalize(TBN * map);\n}\n#endif\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n\tfloat fogCoeff = 1.0;\n\tfloat fogStart = vFogInfos.y;\n\tfloat fogEnd = vFogInfos.z;\n\tfloat fogDensity = vFogInfos.w;\n\n\tif (FOGMODE_LINEAR == vFogInfos.x)\n\t{\n\t\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n\t}\n\telse if (FOGMODE_EXP == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n\t}\n\telse if (FOGMODE_EXP2 == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n\t}\n\n\treturn clamp(fogCoeff, 0.0, 1.0);\n}\n#endif\n\n// Light Computing\nstruct lightingInfo\n{\n\tvec3 diffuse;\n\tvec3 specular;\n};\n\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\n\tlightingInfo result;\n\n\tvec3 lightVectorW;\n\tfloat attenuation = 1.0;\n\tif (lightData.w == 0.)\n\t{\n\t\tvec3 direction = lightData.xyz - vPositionW;\n\n\t\tattenuation = max(0., 1.0 - length(direction) / range);\n\t\tlightVectorW = normalize(direction);\n\t}\n\telse\n\t{\n\t\tlightVectorW = normalize(-lightData.xyz);\n\t}\n\n\t// diffuse\n\tfloat ndl = max(0., dot(vNormal, lightVectorW));\n\n\t// Specular\n\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\n\tfloat specComp = max(0., dot(vNormal, angleW));\n\tspecComp = pow(specComp, max(1., vSpecularColor.a));\n\n\tresult.diffuse = ndl * diffuseColor * attenuation;\n\tresult.specular = specComp * specularColor * attenuation;\n\n\treturn result;\n}\n\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\n\tlightingInfo result;\n\n\tvec3 direction = lightData.xyz - vPositionW;\n\tvec3 lightVectorW = normalize(direction);\n\tfloat attenuation = max(0., 1.0 - length(direction) / range);\n\n\t// diffuse\n\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\n\tfloat spotAtten = 0.0;\n\n\tif (cosAngle >= lightDirection.w)\n\t{\n\t\tcosAngle = max(0., pow(cosAngle, lightData.w));\n\t\tspotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\n\n\t\t// Diffuse\n\t\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\n\n\t\t// Specular\n\t\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\n\t\tfloat specComp = max(0., dot(vNormal, angleW));\n\t\tspecComp = pow(specComp, vSpecularColor.a);\n\n\t\tresult.diffuse = ndl * spotAtten * diffuseColor * attenuation;\n\t\tresult.specular = specComp * specularColor * spotAtten * attenuation;\n\n\t\treturn result;\n\t}\n\n\tresult.diffuse = vec3(0.);\n\tresult.specular = vec3(0.);\n\n\treturn result;\n}\n\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\n\tlightingInfo result;\n\n\t// Diffuse\n\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\n\n\t// Specular\n\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\n\tfloat specComp = max(0., dot(vNormal, angleW));\n\tspecComp = pow(specComp, vSpecularColor.a);\n\n\tresult.diffuse = mix(groundColor, diffuseColor, ndl);\n\tresult.specular = specComp * specularColor;\n\n\treturn result;\n}\n\nvoid main(void) {\n\t// Clip plane\n#ifdef CLIPPLANE\n\tif (fClipDistance > 0.0)\n\t\tdiscard;\n#endif\n\n\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\n\n\t// Base color\n\tvec4 baseColor = vec4(1., 1., 1., 1.);\n\tvec3 diffuseColor = vDiffuseColor.rgb;\n\n\t// Alpha\n\tfloat alpha = vDiffuseColor.a;\n\n#ifdef VERTEXCOLOR\n\tdiffuseColor *= vColor;\n#endif\n\n#ifdef DIFFUSE\n\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\n\n#ifdef ALPHATEST\n\tif (baseColor.a < 0.4)\n\t\tdiscard;\n#endif\n\n#ifdef ALPHAFROMDIFFUSE\n\talpha *= baseColor.a;\n#endif\n\n\tbaseColor.rgb *= vDiffuseInfos.y;\n#endif\n\n\t// Bump\n\tvec3 normalW = normalize(vNormalW);\n\n#ifdef BUMP\n\tnormalW = perturbNormal(viewDirectionW);\n#endif\n\n\t// Ambient color\n\tvec3 baseAmbientColor = vec3(1., 1., 1.);\n\n#ifdef AMBIENT\n\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\n#endif\n\n\t// Lighting\n\tvec3 diffuseBase = vec3(0., 0., 0.);\n\tvec3 specularBase = vec3(0., 0., 0.);\n\tfloat shadow = 1.;\n\n#ifdef LIGHT0\n#ifdef SPOTLIGHT0\n\tlightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\n#endif\n#ifdef HEMILIGHT0\n\tlightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\n#endif\n#ifdef POINTDIRLIGHT0\n\tlightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\n#endif\n#ifdef SHADOW0\n#ifdef SHADOWVSM0\n\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\n#else\n\t#ifdef SHADOWPCF0\n\t\tshadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0);\n\t#else\n\t\tshadow = computeShadow(vPositionFromLight0, shadowSampler0, darkness0);\n\t#endif\n#endif\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info.diffuse * shadow;\n\tspecularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT1\n#ifdef SPOTLIGHT1\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\n#endif\n#ifdef HEMILIGHT1\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\n#endif\n#ifdef POINTDIRLIGHT1\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\n#endif\n#ifdef SHADOW1\n#ifdef SHADOWVSM1\n\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\n#else\n\t#ifdef SHADOWPCF1\n\t\tshadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1);\n\t#else\n\t\tshadow = computeShadow(vPositionFromLight1, shadowSampler1, darkness1);\n\t#endif\n#endif\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info.diffuse * shadow;\n\tspecularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT2\n#ifdef SPOTLIGHT2\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\n#endif\n#ifdef HEMILIGHT2\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\n#endif\n#ifdef POINTDIRLIGHT2\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\n#endif\n#ifdef SHADOW2\n#ifdef SHADOWVSM2\n\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\n#else\n\t#ifdef SHADOWPCF2\n\t\tshadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2);\n\t#else\n\t\tshadow = computeShadow(vPositionFromLight2, shadowSampler2, darkness2);\n\t#endif\t\n#endif\t\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info.diffuse * shadow;\n\tspecularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT3\n#ifdef SPOTLIGHT3\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\n#endif\n#ifdef HEMILIGHT3\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\n#endif\n#ifdef POINTDIRLIGHT3\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\n#endif\n#ifdef SHADOW3\n#ifdef SHADOWVSM3\n\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\n#else\n\t#ifdef SHADOWPCF3\n\t\tshadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3);\n\t#else\n\t\tshadow = computeShadow(vPositionFromLight3, shadowSampler3, darkness3);\n\t#endif\t\n#endif\t\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info.diffuse * shadow;\n\tspecularBase += info.specular * shadow;\n#endif\n\n\t// Reflection\n\tvec3 reflectionColor = vec3(0., 0., 0.);\n\n#ifdef REFLECTION\n\tvec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\n\n\tif (vReflectionInfos.z != 0.0)\n\t{\n\t\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\n\t}\n\telse\n\t{\n\t\tvec2 coords = vReflectionUVW.xy;\n\n\t\tif (vReflectionInfos.x == MAP_PROJECTION)\n\t\t{\n\t\t\tcoords /= vReflectionUVW.z;\n\t\t}\n\n\t\tcoords.y = 1.0 - coords.y;\n\n\t\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\n\t}\n\n#ifdef REFLECTIONFRESNEL\n\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\n\n\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\n#endif\n#endif\n\n#ifdef OPACITY\n\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\n\n#ifdef OPACITYRGB\n\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\n\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\n#else\n\talpha *= opacityMap.a * vOpacityInfos.y;\n#endif\n\n#endif\n\n#ifdef OPACITYFRESNEL\n\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\n\n\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\n#endif\n\n\t// Emissive\n\tvec3 emissiveColor = vEmissiveColor;\n#ifdef EMISSIVE\n\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\n#endif\n\n#ifdef EMISSIVEFRESNEL\n\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\n\n\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\n#endif\n\n\t// Specular map\n\tvec3 specularColor = vSpecularColor.rgb;\n#ifdef SPECULAR\n\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\n#endif\n\n\t// Fresnel\n#ifdef DIFFUSEFRESNEL\n\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\n\n\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\n#endif\n\n\t// Composition\n\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\n\tvec3 finalSpecular = specularBase * specularColor;\n\n#ifdef SPECULAROVERALPHA\n\talpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\n#endif\n\n\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\n\n#ifdef FOG\n\tfloat fog = CalcFogFactor();\n\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n\tgl_FragColor = color;\n}",defaultVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec3 color;\n#endif\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniforms\n\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif\n\nuniform mat4 view;\nuniform mat4 viewProjection;\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n// Output\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\n#ifdef SHADOWS\n#ifdef LIGHT0\nuniform mat4 lightMatrix0;\nvarying vec4 vPositionFromLight0;\n#endif\n#ifdef LIGHT1\nuniform mat4 lightMatrix1;\nvarying vec4 vPositionFromLight1;\n#endif\n#ifdef LIGHT2\nuniform mat4 lightMatrix2;\nvarying vec4 vPositionFromLight2;\n#endif\n#ifdef LIGHT3\nuniform mat4 lightMatrix3;\nvarying vec4 vPositionFromLight3;\n#endif\n#endif\n\n#ifdef REFLECTION\nvarying vec3 vPositionUVW;\n#endif\n\nvoid main(void) {\n\tmat4 finalWorld;\n\n#ifdef REFLECTION\n\tvPositionUVW = position;\n#endif \n\n#ifdef BONES\n\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\n#ifdef BONES4\n\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n\tfinalWorld = world * (m0 + m1 + m2 + m3);\n#else\n\tfinalWorld = world * (m0 + m1 + m2);\n#endif \n\n#else\n#ifdef INSTANCES\n\tfinalWorld = mat4(world0, world1, world2, world3);\n#else\n\tfinalWorld = world;\n#endif\n#endif\n\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n\n\tvec4 worldPos = finalWorld * vec4(position, 1.0);\n\tvPositionW = vec3(worldPos);\n\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\n\t// Texture coordinates\n#ifndef UV1\n\tvec2 uv = vec2(0., 0.);\n#endif\n#ifndef UV2\n\tvec2 uv2 = vec2(0., 0.);\n#endif\n\n#ifdef DIFFUSE\n\tif (vDiffuseInfos.x == 0.)\n\t{\n\t\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef AMBIENT\n\tif (vAmbientInfos.x == 0.)\n\t{\n\t\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef OPACITY\n\tif (vOpacityInfos.x == 0.)\n\t{\n\t\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef EMISSIVE\n\tif (vEmissiveInfos.x == 0.)\n\t{\n\t\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef SPECULAR\n\tif (vSpecularInfos.x == 0.)\n\t{\n\t\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef BUMP\n\tif (vBumpInfos.x == 0.)\n\t{\n\t\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n\t// Clip plane\n#ifdef CLIPPLANE\n\tfClipDistance = dot(worldPos, vClipPlane);\n#endif\n\n\t// Fog\n#ifdef FOG\n\tfFogDistance = (view * worldPos).z;\n#endif\n\n\t// Shadows\n#ifdef SHADOWS\n#ifdef LIGHT0\n\tvPositionFromLight0 = lightMatrix0 * worldPos;\n#endif\n#ifdef LIGHT1\n\tvPositionFromLight1 = lightMatrix1 * worldPos;\n#endif\n#ifdef LIGHT2\n\tvPositionFromLight2 = lightMatrix2 * worldPos;\n#endif\n#ifdef LIGHT3\n\tvPositionFromLight3 = lightMatrix3 * worldPos;\n#endif\n#endif\n\n\t// Vertex color\n#ifdef VERTEXCOLOR\n\tvColor = color;\n#endif\n}",displayPassPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(passSampler, vUV);\n}",filterPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform mat4 kernelMatrix;\n\nvoid main(void)\n{\n\tvec3 baseColor = texture2D(textureSampler, vUV).rgb;\n\tvec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\n\n\tgl_FragColor = vec4(updatedColor, 1.0);\n}",fxaaPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\n\nvoid main(){\n\tvec2 localTexelSize = texelSize;\n\tvec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\n\tvec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\n\tvec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\n\tvec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\n\tvec4 rgbM = texture2D(textureSampler, vUV);\n\tvec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\n\tfloat lumaNW = dot(rgbNW, luma);\n\tfloat lumaNE = dot(rgbNE, luma);\n\tfloat lumaSW = dot(rgbSW, luma);\n\tfloat lumaSE = dot(rgbSE, luma);\n\tfloat lumaM = dot(rgbM, luma);\n\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\n\tfloat dirReduce = max(\n\t\t(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n\t\tFXAA_REDUCE_MIN);\n\n\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n\t\tmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n\t\tdir * rcpDirMin)) * localTexelSize;\n\n\tvec4 rgbA = 0.5 * (\n\t\ttexture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\n\t\ttexture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\n\n\tvec4 rgbB = rgbA * 0.5 + 0.25 * (\n\t\ttexture2D(textureSampler, vUV + dir *  -0.5) +\n\t\ttexture2D(textureSampler, vUV + dir * 0.5));\n\tfloat lumaB = dot(rgbB, luma);\n\tif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\n\t\tgl_FragColor = rgbA;\n\t}\n\telse {\n\t\tgl_FragColor = rgbB;\n\t}\n}",layerPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Color\nuniform vec4 color;\n\nvoid main(void) {\n\tvec4 baseColor = texture2D(textureSampler, vUV);\n\n\tgl_FragColor = baseColor * color;\n}",layerVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Uniforms\nuniform mat4 textureMatrix;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {\t\n\n\tvUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\n\tgl_Position = vec4(position, 0.0, 1.0);\n}",legacydefaultPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define MAP_PROJECTION\t4.\n\n// Constants\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\nuniform vec4 vSpecularColor;\nuniform vec3 vEmissiveColor;\n\n// Input\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n// Lights\n#ifdef LIGHT0\nuniform vec4 vLightData0;\nuniform vec4 vLightDiffuse0;\nuniform vec3 vLightSpecular0;\n#ifdef SHADOW0\nvarying vec4 vPositionFromLight0;\nuniform sampler2D shadowSampler0;\n#endif\n#ifdef SPOTLIGHT0\nuniform vec4 vLightDirection0;\n#endif\n#ifdef HEMILIGHT0\nuniform vec3 vLightGround0;\n#endif\n#endif\n\n#ifdef LIGHT1\nuniform vec4 vLightData1;\nuniform vec4 vLightDiffuse1;\nuniform vec3 vLightSpecular1;\n#ifdef SHADOW1\nvarying vec4 vPositionFromLight1;\nuniform sampler2D shadowSampler1;\n#endif\n#ifdef SPOTLIGHT1\nuniform vec4 vLightDirection1;\n#endif\n#ifdef HEMILIGHT1\nuniform vec3 vLightGround1;\n#endif\n#endif\n\n#ifdef LIGHT2\nuniform vec4 vLightData2;\nuniform vec4 vLightDiffuse2;\nuniform vec3 vLightSpecular2;\n#ifdef SHADOW2\nvarying vec4 vPositionFromLight2;\nuniform sampler2D shadowSampler2;\n#endif\n#ifdef SPOTLIGHT2\nuniform vec4 vLightDirection2;\n#endif\n#ifdef HEMILIGHT2\nuniform vec3 vLightGround2;\n#endif\n#endif\n\n#ifdef LIGHT3\nuniform vec4 vLightData3;\nuniform vec4 vLightDiffuse3;\nuniform vec3 vLightSpecular3;\n#ifdef SHADOW3\nvarying vec4 vPositionFromLight3;\nuniform sampler2D shadowSampler3;\n#endif\n#ifdef SPOTLIGHT3\nuniform vec4 vLightDirection3;\n#endif\n#ifdef HEMILIGHT3\nuniform vec3 vLightGround3;\n#endif\n#endif\n\n// Samplers\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\t\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\nuniform samplerCube reflectionCubeSampler;\nuniform sampler2D reflection2DSampler;\nuniform vec3 vReflectionInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n// Fresnel\n#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\n{\n\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\n\treturn clamp(fresnelTerm, 0., 1.);\n}\n#endif\n\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n// Shadows\n#ifdef SHADOWS\n\nfloat unpack(vec4 color)\n{\n\tconst vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\n\treturn dot(color, bitShift);\n}\n\nfloat unpackHalf(vec2 color)\n{\n\treturn color.x + (color.y / 255.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tfloat shadow = unpack(texture2D(shadowSampler, uv));\n\n\tif (depth.z > shadow)\n\t{\n\t\treturn 0.;\n\t}\n\treturn 1.;\n}\n\n// Thanks to http://devmaster.net/\nfloat ChebychevInequality(vec2 moments, float t)\n{\n\tif (t <= moments.x)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tfloat variance = moments.y - (moments.x * moments.x);\n\tvariance = max(variance, 0.);\n\n\tfloat d = t - moments.x;\n\treturn variance / (variance + d * d);\n}\n\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\tvec4 texel = texture2D(shadowSampler, uv);\n\n\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\n\treturn clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\n}\n#endif\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n\tfloat fogCoeff = 1.0;\n\tfloat fogStart = vFogInfos.y;\n\tfloat fogEnd = vFogInfos.z;\n\tfloat fogDensity = vFogInfos.w;\n\n\tif (FOGMODE_LINEAR == vFogInfos.x)\n\t{\n\t\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n\t}\n\telse if (FOGMODE_EXP == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n\t}\n\telse if (FOGMODE_EXP2 == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n\t}\n\n\treturn clamp(fogCoeff, 0.0, 1.0);\n}\n#endif\n\n// Light Computing\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\n\tmat3 result;\n\n\tvec3 lightVectorW;\n\tif (lightData.w == 0.)\n\t{\n\t\tlightVectorW = normalize(lightData.xyz - vPositionW);\n\t}\n\telse\n\t{\n\t\tlightVectorW = normalize(-lightData.xyz);\n\t}\n\n\t// diffuse\n\tfloat ndl = max(0., dot(vNormal, lightVectorW));\n\n\t// Specular\n\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\n\tfloat specComp = max(0., dot(vNormal, angleW));\n\tspecComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\n\n\tresult[0] = ndl * diffuseColor.rgb;\n\tresult[1] = specComp * specularColor;\n\tresult[2] = vec3(0.);\n\n\treturn result;\n}\n\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\n\tmat3 result;\n\n\tvec3 lightVectorW = normalize(lightData.xyz - vPositionW);\n\n\t// diffuse\n\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\n\tfloat spotAtten = 0.0;\n\n\tif (cosAngle >= lightDirection.w)\n\t{\n\t\tcosAngle = max(0., pow(cosAngle, lightData.w));\n\t\tspotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\n\n\t\t// Diffuse\n\t\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\n\n\t\t// Specular\n\t\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\n\t\tfloat specComp = max(0., dot(vNormal, angleW));\n\t\tspecComp = pow(specComp, vSpecularColor.a);\n\n\t\tresult[0] = ndl * spotAtten * diffuseColor.rgb;\n\t\tresult[1] = specComp * specularColor * spotAtten;\n\t\tresult[2] = vec3(0.);\n\n\t\treturn result;\n\t}\n\n\tresult[0] = vec3(0.);\n\tresult[1] = vec3(0.);\n\tresult[2] = vec3(0.);\n\n\treturn result;\n}\n\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\n\tmat3 result;\n\n\t// Diffuse\n\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\n\n\t// Specular\n\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\n\tfloat specComp = max(0., dot(vNormal, angleW));\n\tspecComp = pow(specComp, vSpecularColor.a);\n\n\tresult[0] = mix(groundColor, diffuseColor.rgb, ndl);\n\tresult[1] = specComp * specularColor;\n\tresult[2] = vec3(0.);\n\n\treturn result;\n}\n\nvoid main(void) {\n\t// Clip plane\n#ifdef CLIPPLANE\n\tif (fClipDistance > 0.0)\n\t\tdiscard;\n#endif\n\n\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\n\n\t// Base color\n\tvec4 baseColor = vec4(1., 1., 1., 1.);\n\tvec3 diffuseColor = vDiffuseColor.rgb;\n\n#ifdef VERTEXCOLOR\n\tdiffuseColor *= vColor;\n#endif\n\n#ifdef DIFFUSE\n\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\n\n#ifdef ALPHATEST\n\tif (baseColor.a < 0.4)\n\t\tdiscard;\n#endif\n\n\tbaseColor.rgb *= vDiffuseInfos.y;\n#endif\n\n\t// Bump\n\tvec3 normalW = normalize(vNormalW);\n\n\t// Ambient color\n\tvec3 baseAmbientColor = vec3(1., 1., 1.);\n\n#ifdef AMBIENT\n\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\n#endif\n\n\t// Lighting\n\tvec3 diffuseBase = vec3(0., 0., 0.);\n\tvec3 specularBase = vec3(0., 0., 0.);\n\tfloat shadow = 1.;\n\n#ifdef LIGHT0\n#ifdef SPOTLIGHT0\n\tmat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\n#endif\n#ifdef HEMILIGHT0\n\tmat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\n#endif\n#ifdef POINTDIRLIGHT0\n\tmat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\n#endif\n#ifdef SHADOW0\n#ifdef SHADOWVSM0\n\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\n#else\n\tshadow = computeShadow(vPositionFromLight0, shadowSampler0);\n#endif\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info[0] * shadow;\n\tspecularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT1\n#ifdef SPOTLIGHT1\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\n#endif\n#ifdef HEMILIGHT1\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\n#endif\n#ifdef POINTDIRLIGHT1\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\n#endif\n#ifdef SHADOW1\n#ifdef SHADOWVSM1\n\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\n#else\n\tshadow = computeShadow(vPositionFromLight1, shadowSampler1);\n#endif\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info[0] * shadow;\n\tspecularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT2\n#ifdef SPOTLIGHT2\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\n#endif\n#ifdef HEMILIGHT2\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\n#endif\n#ifdef POINTDIRLIGHT2\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\n#endif\n#ifdef SHADOW2\n#ifdef SHADOWVSM2\n\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\n#else\n\tshadow = computeShadow(vPositionFromLight2, shadowSampler2);\n#endif\t\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info[0] * shadow;\n\tspecularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT3\n#ifdef SPOTLIGHT3\n\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\n#endif\n#ifdef HEMILIGHT3\n\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\n#endif\n#ifdef POINTDIRLIGHT3\n\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\n#endif\n#ifdef SHADOW3\n#ifdef SHADOWVSM3\n\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\n#else\n\tshadow = computeShadow(vPositionFromLight3, shadowSampler3);\n#endif\t\n#else\n\tshadow = 1.;\n#endif\n\tdiffuseBase += info[0] * shadow;\n\tspecularBase += info[1] * shadow;\n#endif\n\n\t// Reflection\n\tvec3 reflectionColor = vec3(0., 0., 0.);\n\n#ifdef REFLECTION\n\tif (vReflectionInfos.z != 0.0)\n\t{\n\t\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\n\t}\n\telse\n\t{\n\t\tvec2 coords = vReflectionUVW.xy;\n\n\t\tif (vReflectionInfos.x == MAP_PROJECTION)\n\t\t{\n\t\t\tcoords /= vReflectionUVW.z;\n\t\t}\n\n\t\tcoords.y = 1.0 - coords.y;\n\n\t\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\n\t}\n\n#ifdef REFLECTIONFRESNEL\n\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\n\n\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\n#endif\n#endif\n\n\t// Alpha\n\tfloat alpha = vDiffuseColor.a;\n\n#ifdef OPACITY\n\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\n#ifdef OPACITYRGB\n\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\n\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\n#else\n\talpha *= opacityMap.a * vOpacityInfos.y;\n#endif\n#endif\n\n#ifdef OPACITYFRESNEL\n\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\n\n\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\n#endif\n\n\t// Emissive\n\tvec3 emissiveColor = vEmissiveColor;\n#ifdef EMISSIVE\n\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\n#endif\n\n#ifdef EMISSIVEFRESNEL\n\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\n\n\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\n#endif\n\n\t// Specular map\n\tvec3 specularColor = vSpecularColor.rgb;\n#ifdef SPECULAR\n\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\n#endif\n\n\t// Fresnel\n#ifdef DIFFUSEFRESNEL\n\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\n\n\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\n#endif\n\n\t// Composition\n\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\n\tvec3 finalSpecular = specularBase * specularColor;\n\n\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\n\n#ifdef FOG\n\tfloat fog = CalcFogFactor();\n\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n\tgl_FragColor = color;\n}",legacydefaultVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define MAP_EXPLICIT\t0.\n#define MAP_SPHERICAL\t1.\n#define MAP_PLANAR\t\t2.\n#define MAP_CUBIC\t\t3.\n#define MAP_PROJECTION\t4.\n#define MAP_SKYBOX\t\t5.\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec3 color;\n#endif\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniforms\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform vec3 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n// Output\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\n#ifdef SHADOWS\n#ifdef LIGHT0\nuniform mat4 lightMatrix0;\nvarying vec4 vPositionFromLight0;\n#endif\n#ifdef LIGHT1\nuniform mat4 lightMatrix1;\nvarying vec4 vPositionFromLight1;\n#endif\n#ifdef LIGHT2\nuniform mat4 lightMatrix2;\nvarying vec4 vPositionFromLight2;\n#endif\n#ifdef LIGHT3\nuniform mat4 lightMatrix3;\nvarying vec4 vPositionFromLight3;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\n{\n\tif (mode == MAP_SPHERICAL)\n\t{\n\t\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\n\t}\n\telse if (mode == MAP_PLANAR)\n\t{\n\t\tvec3 viewDir = worldPos.xyz - vEyePosition;\n\t\tvec3 coords = normalize(reflect(viewDir, worldNormal));\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 1));\n\t}\n\telse if (mode == MAP_CUBIC)\n\t{\n\t\tvec3 viewDir = worldPos.xyz - vEyePosition;\n\t\tvec3 coords = reflect(viewDir, worldNormal);\n\n\t\treturn vec3(reflectionMatrix * vec4(coords, 0));\n\t}\n\telse if (mode == MAP_PROJECTION)\n\t{\n\t\treturn vec3(reflectionMatrix * (view * worldPos));\n\t}\n\telse if (mode == MAP_SKYBOX)\n\t{\n\t\treturn position;\n\t}\n\n\treturn vec3(0, 0, 0);\n}\n#endif\n\nvoid main(void) {\n\tmat4 finalWorld;\n\n#ifdef BONES\n\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\n#ifdef BONES4\n\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n\tfinalWorld = world * (m0 + m1 + m2 + m3);\n#else\n\tfinalWorld = world * (m0 + m1 + m2);\n#endif \n\n#else\n\tfinalWorld = world;\n#endif\n\n\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n\n\tvec4 worldPos = finalWorld * vec4(position, 1.0);\n\tvPositionW = vec3(worldPos);\n\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\n\t// Texture coordinates\n#ifndef UV1\n\tvec2 uv = vec2(0., 0.);\n#endif\n#ifndef UV2\n\tvec2 uv2 = vec2(0., 0.);\n#endif\n\n#ifdef DIFFUSE\n\tif (vDiffuseInfos.x == 0.)\n\t{\n\t\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef AMBIENT\n\tif (vAmbientInfos.x == 0.)\n\t{\n\t\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef OPACITY\n\tif (vOpacityInfos.x == 0.)\n\t{\n\t\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef REFLECTION\n\tvReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\n#endif\n\n#ifdef EMISSIVE\n\tif (vEmissiveInfos.x == 0.)\n\t{\n\t\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef SPECULAR\n\tif (vSpecularInfos.x == 0.)\n\t{\n\t\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n#ifdef BUMP\n\tif (vBumpInfos.x == 0.)\n\t{\n\t\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\n\t}\n\telse\n\t{\n\t\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\n\t}\n#endif\n\n\t// Clip plane\n#ifdef CLIPPLANE\n\tfClipDistance = dot(worldPos, vClipPlane);\n#endif\n\n\t// Fog\n#ifdef FOG\n\tfFogDistance = (view * worldPos).z;\n#endif\n\n\t// Shadows\n#ifdef SHADOWS\n#ifdef LIGHT0\n\tvPositionFromLight0 = lightMatrix0 * worldPos;\n#endif\n#ifdef LIGHT1\n\tvPositionFromLight1 = lightMatrix1 * worldPos;\n#endif\n#ifdef LIGHT2\n\tvPositionFromLight2 = lightMatrix2 * worldPos;\n#endif\n#ifdef LIGHT3\n\tvPositionFromLight3 = lightMatrix3 * worldPos;\n#endif\n#endif\n\n\t// Vertex color\n#ifdef VERTEXCOLOR\n\tvColor = color;\n#endif\n}",lensFlarePixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Color\nuniform vec4 color;\n\nvoid main(void) {\n\tvec4 baseColor = texture2D(textureSampler, vUV);\n\n\tgl_FragColor = baseColor * color;\n}",lensFlareVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Uniforms\nuniform mat4 viewportMatrix;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {\t\n\n\tvUV = position * madd + madd;\n\tgl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\n}",oculusDistortionCorrectionPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\n\nvec2 HmdWarp(vec2 in01) {\n\n\tvec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\n\tfloat rSq = theta.x * theta.x + theta.y * theta.y;\n\tvec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\n\treturn LensCenter + Scale * rvector;\n}\n\nvoid main(void)\n{\n\tvec2 tc = HmdWarp(vUV);\n\tif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\n\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\telse{\n\t\tgl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\n\t}\n}",outlinePixelShader:"precision highp float;\n\nuniform vec3 color;\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n\nvoid main(void) {\n#ifdef ALPHATEST\n\tif (texture2D(diffuseSampler, vUV).a < 0.4)\n\t\tdiscard;\n#endif\n\n\tgl_FragColor = vec4(color, 1.);\n}",outlineVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attribute\nattribute vec3 position;\nattribute vec3 normal;\n\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniform\nuniform float offset;\n\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif\n\nuniform mat4 viewProjection;\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nvoid main(void)\n{\n#ifdef INSTANCES\n\tmat4 finalWorld = mat4(world0, world1, world2, world3);\n#else\n\tmat4 finalWorld = world;\n#endif\n\n\tvec3 offsetPosition = position + normal * offset;\n\n#ifdef BONES\n\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\n\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\n#else\n\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\n#endif\n\n#ifdef ALPHATEST\n#ifdef UV1\n\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n#endif\n#ifdef UV2\n\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n#endif\n#endif\n}",particlesPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\nvoid main(void) {\n#ifdef CLIPPLANE\n\tif (fClipDistance > 0.0)\n\t\tdiscard;\n#endif\n\tvec4 baseColor = texture2D(diffuseSampler, vUV);\n\n\tgl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\n}",particlesVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\n// Uniforms\nuniform mat4 view;\nuniform mat4 projection;\n\n// Output\nvarying vec2 vUV;\nvarying vec4 vColor;\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\n\nvoid main(void) {\t\n\tvec3 viewPos = (view * vec4(position, 1.0)).xyz; \n\tvec3 cornerPos;\n\tfloat size = options.y;\n\tfloat angle = options.x;\n\tvec2 offset = options.zw;\n\n\tcornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\n\n\t// Rotate\n\tvec3 rotatedCorner;\n\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\n\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\n\trotatedCorner.z = 0.;\n\n\t// Position\n\tviewPos += rotatedCorner;\n\tgl_Position = projection * vec4(viewPos, 1.0);   \n\t\n\tvColor = color;\n\tvUV = offset;\n\n\t// Clip plane\n#ifdef CLIPPLANE\n\tvec4 worldPos = invView * vec4(viewPos, 1.0);\n\tfClipDistance = dot(worldPos, vClipPlane);\n#endif\n}",passPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nvoid main(void) \n{\n\tgl_FragColor = texture2D(textureSampler, vUV);\n}",postprocessVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {\t\n\n\tvUV = position * madd + madd;\n\tgl_Position = vec4(position, 0.0, 1.0);\n}",refractionPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\n// Parameters\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\n\nvoid main() {\n\tfloat ref = 1.0 - texture2D(refractionSampler, vUV).r;\n\n\tvec2 uv = vUV - vec2(0.5);\n\tvec2 offset = uv * depth * ref;\n\tvec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\n\n\tgl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\n}",shadowMapPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nvec4 pack(float depth)\n{\n\tconst vec4 bitOffset = vec4(255. * 255. * 255., 255. * 255., 255., 1.);\n\tconst vec4 bitMask = vec4(0., 1. / 255., 1. / 255., 1. / 255.);\n\t\n\tvec4 comp = mod(depth * bitOffset * vec4(254.), vec4(255.)) / vec4(254.);\n\tcomp -= comp.xxyz * bitMask;\n\t\n\treturn comp;\n}\n\n// Thanks to http://devmaster.net/\nvec2 packHalf(float depth) \n{ \n\tconst vec2 bitOffset = vec2(1.0 / 255., 0.);\n\tvec2 color = vec2(depth, fract(depth * 255.));\n\n\treturn color - (color.yy * bitOffset);\n}\n\n#ifndef VSM\nvarying vec4 vPosition;\n#endif\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n\nvoid main(void)\n{\n#ifdef ALPHATEST\n\tif (texture2D(diffuseSampler, vUV).a < 0.4)\n\t\tdiscard;\n#endif\n\n#ifdef VSM\n\tfloat moment1 = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat moment2 = moment1 * moment1;\n\tgl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\n#else\n\tgl_FragColor = pack(vPosition.z / vPosition.w);\n#endif\n}",shadowMapVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attribute\nattribute vec3 position;\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniform\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif\n\nuniform mat4 viewProjection;\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n#ifndef VSM\nvarying vec4 vPosition;\n#endif\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nvoid main(void)\n{\n#ifdef INSTANCES\n\tmat4 finalWorld = mat4(world0, world1, world2, world3);\n#else\n\tmat4 finalWorld = world;\n#endif\n\n#ifdef BONES\n\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\n\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n#else\n#ifndef VSM\n\tvPosition = viewProjection * finalWorld * vec4(position, 1.0);\n#endif\n\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n#endif\n\n#ifdef ALPHATEST\n#ifdef UV1\n\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n#endif\n#ifdef UV2\n\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n#endif\n#endif\n}",spritesPixelShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform bool alphaTest;\n\nvarying vec4 vColor;\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n\tfloat fogCoeff = 1.0;\n\tfloat fogStart = vFogInfos.y;\n\tfloat fogEnd = vFogInfos.z;\n\tfloat fogDensity = vFogInfos.w;\n\n\tif (FOGMODE_LINEAR == vFogInfos.x)\n\t{\n\t\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n\t}\n\telse if (FOGMODE_EXP == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n\t}\n\telse if (FOGMODE_EXP2 == vFogInfos.x)\n\t{\n\t\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n\t}\n\n\treturn min(1., max(0., fogCoeff));\n}\n#endif\n\n\nvoid main(void) {\n\tvec4 baseColor = texture2D(diffuseSampler, vUV);\n\n\tif (alphaTest) \n\t{\n\t\tif (baseColor.a < 0.95)\n\t\t\tdiscard;\n\t}\n\n\tbaseColor *= vColor;\n\n#ifdef FOG\n\tfloat fog = CalcFogFactor();\n\tbaseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n\tgl_FragColor = baseColor;\n}",spritesVertexShader:"#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\n// Uniforms\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\n// Output\nvarying vec2 vUV;\nvarying vec4 vColor;\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\nvoid main(void) {\t\n\tvec3 viewPos = (view * vec4(position, 1.0)).xyz; \n\tvec3 cornerPos;\n\t\n\tfloat angle = options.x;\n\tfloat size = options.y;\n\tvec2 offset = options.zw;\n\tvec2 uvScale = textureInfos.xy;\n\n\tcornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\n\n\t// Rotate\n\tvec3 rotatedCorner;\n\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\n\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\n\trotatedCorner.z = 0.;\n\n\t// Position\n\tviewPos += rotatedCorner;\n\tgl_Position = projection * vec4(viewPos, 1.0);   \n\n\t// Color\n\tvColor = color;\n\t\n\t// Texture\n\tvec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\n\n\tvUV = (uvOffset + cellInfo.zw) * uvScale;\n\n\t// Fog\n#ifdef FOG\n\tfFogDistance = viewPos.z;\n#endif\n}"},t}();n.Effect=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(n,t,i){this.name=n;this.checkReadyOnEveryCall=!0;this.checkReadyOnlyOnce=!1;this.state="";this.alpha=1;this.wireframe=!1;this.backFaceCulling=!0;this._wasPreviouslyReady=!1;this.id=n;this._scene=t;i||t.materials.push(this)}return n.prototype.isReady=function(){return!0},n.prototype.getEffect=function(){return this._effect},n.prototype.getScene=function(){return this._scene},n.prototype.needAlphaBlending=function(){return this.alpha<1},n.prototype.needAlphaTesting=function(){return!1},n.prototype.getAlphaTestTexture=function(){return null},n.prototype.trackCreation=function(){},n.prototype._preBind=function(){var n=this._scene.getEngine();n.enableEffect(this._effect);n.setState(this.backFaceCulling)},n.prototype.bind=function(){},n.prototype.bindOnlyWorldMatrix=function(){},n.prototype.unbind=function(){},n.prototype.dispose=function(n){var t=this._scene.materials.indexOf(this);this._scene.materials.splice(t,1);n&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null);this.onDispose&&this.onDispose()},n}();n.Material=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=4,r=function(){function t(){this.isEnabled=!0;this.leftColor=n.Color3.White();this.rightColor=n.Color3.Black();this.bias=0;this.power=1}return t}(),i;n.FresnelParameters=r;i=function(i){function r(t,r){var u=this;i.call(this,t,r);this.ambientColor=new n.Color3(0,0,0);this.diffuseColor=new n.Color3(1,1,1);this.specularColor=new n.Color3(1,1,1);this.specularPower=64;this.emissiveColor=new n.Color3(0,0,0);this.useAlphaFromDiffuseTexture=!1;this.useSpecularOverAlpha=!0;this._cachedDefines=null;this._renderTargets=new n.SmartArray(16);this._worldViewProjectionMatrix=n.Matrix.Zero();this._globalAmbientColor=new n.Color3(0,0,0);this._scaledDiffuse=new n.Color3;this._scaledSpecular=new n.Color3;this.getRenderTargetTextures=function(){return u._renderTargets.reset(),u.reflectionTexture&&u.reflectionTexture.isRenderTarget&&u._renderTargets.push(u.reflectionTexture),u._renderTargets}}return __extends(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},r.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&!this.diffuseTexture.getAlphaFromRGB},r.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},r.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},r.prototype.isReady=function(i,r){var s,w,f,l,o,a,b,v,k,d,y,c,h,p,g;if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady||(s=this.getScene(),!this.checkReadyOnEveryCall&&this._renderId===s.getRenderId()))return!0;var nt=s.getEngine(),u=[],e=new n.EffectFallbacks;if(s.texturesEnabled){if(this.diffuseTexture&&n.StandardMaterial.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;u.push("#define DIFFUSE")}if(this.ambientTexture&&n.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;u.push("#define AMBIENT")}if(this.opacityTexture&&n.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;u.push("#define OPACITY");this.opacityTexture.getAlphaFromRGB&&u.push("#define OPACITYRGB")}if(this.reflectionTexture&&n.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;u.push("#define REFLECTION");e.addFallback(0,"REFLECTION")}if(this.emissiveTexture&&n.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;u.push("#define EMISSIVE")}if(this.specularTexture&&n.StandardMaterial.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;u.push("#define SPECULAR");e.addFallback(0,"SPECULAR")}}if(s.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&n.StandardMaterial.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;u.push("#define BUMP");e.addFallback(0,"BUMP")}if(this.useSpecularOverAlpha&&(u.push("#define SPECULAROVERALPHA"),e.addFallback(0,"SPECULAROVERALPHA")),s.clipPlane&&u.push("#define CLIPPLANE"),nt.getAlphaTesting()&&u.push("#define ALPHATEST"),this._shouldUseAlphaFromDiffuseTexture()&&u.push("#define ALPHAFROMDIFFUSE"),s.fogMode!==n.Scene.FOGMODE_NONE&&(u.push("#define FOG"),e.addFallback(1,"FOG")),w=!1,f=0,s.lightsEnabled)for(l=0;l<s.lights.length;l++)if(o=s.lights[l],o.isEnabled()){if(o._excludedMeshesIds.length>0){for(a=0;a<o._excludedMeshesIds.length;a++)b=s.getMeshByID(o._excludedMeshesIds[a]),b&&o.excludedMeshes.push(b);o._excludedMeshesIds=[]}if(o._includedOnlyMeshesIds.length>0){for(v=0;v<o._includedOnlyMeshesIds.length;v++)k=s.getMeshByID(o._includedOnlyMeshesIds[v]),k&&o.includedOnlyMeshes.push(k);o._includedOnlyMeshesIds=[]}if(o.canAffectMesh(i)&&(u.push("#define LIGHT"+f),f>0&&e.addFallback(f,"LIGHT"+f),d=o instanceof n.SpotLight?"#define SPOTLIGHT"+f:o instanceof n.HemisphericLight?"#define HEMILIGHT"+f:"#define POINTDIRLIGHT"+f,u.push(d),f>0&&e.addFallback(f,d.replace("#define ","")),y=o.getShadowGenerator(),i&&i.receiveShadows&&y&&(u.push("#define SHADOW"+f),e.addFallback(0,"SHADOW"+f),w||(u.push("#define SHADOWS"),w=!0),y.useVarianceShadowMap&&(u.push("#define SHADOWVSM"+f),f>0&&e.addFallback(0,"SHADOWVSM"+f)),y.usePoissonSampling&&(u.push("#define SHADOWPCF"+f),f>0&&e.addFallback(0,"SHADOWPCF"+f))),f++,f==t))break}return(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)&&(c=1,this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(u.push("#define DIFFUSEFRESNEL"),e.addFallback(c,"DIFFUSEFRESNEL"),c++),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(u.push("#define OPACITYFRESNEL"),e.addFallback(c,"OPACITYFRESNEL"),c++),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(u.push("#define REFLECTIONFRESNEL"),e.addFallback(c,"REFLECTIONFRESNEL"),c++),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(u.push("#define EMISSIVEFRESNEL"),e.addFallback(c,"EMISSIVEFRESNEL"),c++),u.push("#define FRESNEL"),e.addFallback(c-1,"FRESNEL")),h=[n.VertexBuffer.PositionKind,n.VertexBuffer.NormalKind],i&&(i.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(h.push(n.VertexBuffer.UVKind),u.push("#define UV1")),i.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(h.push(n.VertexBuffer.UV2Kind),u.push("#define UV2")),i.isVerticesDataPresent(n.VertexBuffer.ColorKind)&&(h.push(n.VertexBuffer.ColorKind),u.push("#define VERTEXCOLOR")),i.skeleton&&i.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&i.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(h.push(n.VertexBuffer.MatricesIndicesKind),h.push(n.VertexBuffer.MatricesWeightsKind),u.push("#define BONES"),u.push("#define BonesPerMesh "+(i.skeleton.bones.length+1)),u.push("#define BONES4"),e.addFallback(0,"BONES4")),r&&(u.push("#define INSTANCES"),h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"))),p=u.join("\n"),this._cachedDefines!=p&&(this._cachedDefines=p,g="default",s.getEngine().getCaps().standardDerivatives||(g="legacydefault"),this._effect=s.getEngine().createEffect(g,h,["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vLightData0","vLightDiffuse0","vLightSpecular0","vLightDirection0","vLightGround0","lightMatrix0","vLightData1","vLightDiffuse1","vLightSpecular1","vLightDirection1","vLightGround1","lightMatrix1","vLightData2","vLightDiffuse2","vLightSpecular2","vLightDirection2","vLightGround2","lightMatrix2","vLightData3","vLightDiffuse3","vLightSpecular3","vLightDirection3","vLightGround3","lightMatrix3","vFogInfos","vFogColor","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","darkness0","darkness1","darkness2","darkness3","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor"],["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","shadowSampler0","shadowSampler1","shadowSampler2","shadowSampler3"],p,e,this.onCompiled,this.onError)),this._effect.isReady()?(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0):!1},r.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null)},r.prototype.bindOnlyWorldMatrix=function(n){this._effect.setMatrix("world",n)},r.prototype.bind=function(i,r){var u=this.getScene(),e,h,f,o,s;if(this.bindOnlyWorldMatrix(i),this._effect.setMatrix("viewProjection",u.getTransformMatrix()),r.skeleton&&r.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&r.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&this._effect.setMatrices("mBones",r.skeleton.getTransformMatrices()),this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new n.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias)),this.diffuseTexture&&n.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&n.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&n.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&n.StandardMaterial.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat3("vReflectionInfos",this.reflectionTexture.coordinatesMode,this.reflectionTexture.level,this.reflectionTexture.isCube?1:0)),this.emissiveTexture&&n.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.specularTexture&&n.StandardMaterial.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&u.getEngine().getCaps().standardDerivatives&&n.StandardMaterial.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat2("vBumpInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),u.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._effect.setVector3("vEyePosition",u.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*r.visibility),this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor),u.lightsEnabled)for(e=0,h=0;h<u.lights.length;h++)if(f=u.lights[h],f.isEnabled()&&f.canAffectMesh(r)&&(f instanceof n.PointLight?f.transferToEffect(this._effect,"vLightData"+e):f instanceof n.DirectionalLight?f.transferToEffect(this._effect,"vLightData"+e):f instanceof n.SpotLight?f.transferToEffect(this._effect,"vLightData"+e,"vLightDirection"+e):f instanceof n.HemisphericLight&&f.transferToEffect(this._effect,"vLightData"+e,"vLightGround"+e),f.diffuse.scaleToRef(f.intensity,this._scaledDiffuse),f.specular.scaleToRef(f.intensity,this._scaledSpecular),this._effect.setColor4("vLightDiffuse"+e,this._scaledDiffuse,f.range),this._effect.setColor3("vLightSpecular"+e,this._scaledSpecular),o=f.getShadowGenerator(),r.receiveShadows&&o&&(this._effect.setMatrix("lightMatrix"+e,o.getTransformMatrix()),this._effect.setTexture("shadowSampler"+e,o.getShadowMap()),this._effect.setFloat("darkness"+e,o.getDarkness())),e++,e==t))break;u.clipPlane&&(s=u.clipPlane,this._effect.setFloat4("vClipPlane",s.normal.x,s.normal.y,s.normal.z,s.d));(u.fogMode!==n.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",u.getViewMatrix());u.fogMode!==n.Scene.FOGMODE_NONE&&(this._effect.setFloat4("vFogInfos",u.fogMode,u.fogStart,u.fogEnd,u.fogDensity),this._effect.setColor3("vFogColor",u.fogColor))},r.prototype.getAnimatables=function(){var n=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&n.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&n.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&n.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&n.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&n.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&this.specularTexture.animations.length>0&&n.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&n.push(this.bumpTexture),n},r.prototype.dispose=function(n){this.diffuseTexture&&this.diffuseTexture.dispose();this.ambientTexture&&this.ambientTexture.dispose();this.opacityTexture&&this.opacityTexture.dispose();this.reflectionTexture&&this.reflectionTexture.dispose();this.emissiveTexture&&this.emissiveTexture.dispose();this.specularTexture&&this.specularTexture.dispose();this.bumpTexture&&this.bumpTexture.dispose();i.prototype.dispose.call(this,n)},r.prototype.clone=function(t){var i=new n.StandardMaterial(t,this.getScene());return i.checkReadyOnEveryCall=this.checkReadyOnEveryCall,i.alpha=this.alpha,i.wireframe=this.wireframe,i.backFaceCulling=this.backFaceCulling,this.diffuseTexture&&this.diffuseTexture.clone&&(i.diffuseTexture=this.diffuseTexture.clone()),this.ambientTexture&&this.ambientTexture.clone&&(i.ambientTexture=this.ambientTexture.clone()),this.opacityTexture&&this.opacityTexture.clone&&(i.opacityTexture=this.opacityTexture.clone()),this.reflectionTexture&&this.reflectionTexture.clone&&(i.reflectionTexture=this.reflectionTexture.clone()),this.emissiveTexture&&this.emissiveTexture.clone&&(i.emissiveTexture=this.emissiveTexture.clone()),this.specularTexture&&this.specularTexture.clone&&(i.specularTexture=this.specularTexture.clone()),this.bumpTexture&&this.bumpTexture.clone&&(i.bumpTexture=this.bumpTexture.clone()),i.ambientColor=this.ambientColor.clone(),i.diffuseColor=this.diffuseColor.clone(),i.specularColor=this.specularColor.clone(),i.specularPower=this.specularPower,i.emissiveColor=this.emissiveColor.clone(),i},r.DiffuseTextureEnabled=!0,r.AmbientTextureEnabled=!0,r.OpacityTextureEnabled=!0,r.ReflectionTextureEnabled=!0,r.EmissiveTextureEnabled=!0,r.SpecularTextureEnabled=!0,r.BumpTextureEnabled=!0,r}(n.Material);n.StandardMaterial=i}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i){n.call(this,t,i,!0);this.subMaterials=[];i.multiMaterials.push(this)}return __extends(t,n),t.prototype.getSubMaterial=function(n){return 0>n||n>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[n]},t.prototype.isReady=function(n){for(var i,t=0;t<this.subMaterials.length;t++)if(i=this.subMaterials[t],i&&!this.subMaterials[t].isReady(n))return!1;return!0},t}(n.Material);n.MultiMaterial=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.callbackManifestChecked=i;this.currentSceneUrl=n.Database.ReturnFullUrlLocation(t);this.db=null;this.enableSceneOffline=!1;this.enableTexturesOffline=!1;this.manifestVersionFound=0;this.mustUpdateRessources=!1;this.hasReachedQuota=!1;this.checkManifestFile()}return t.prototype.checkManifestFile=function(){function u(){n.Tools.Log("Valid manifest file not found. Scene & textures will be loaded directly from the web server.");r.enableSceneOffline=!1;r.enableTexturesOffline=!1;r.callbackManifestChecked(!1)}var i=this,r=this,f=this.currentSceneUrl+".manifest",t=new XMLHttpRequest,e=f+(null==f.match(/\?/)?"?":"&")+(new Date).getTime();t.open("GET",e,!0);t.addEventListener("load",function(){if(200===t.status||n.Tools.ValidateXHRData(t,1))try{var r=JSON.parse(t.response);i.enableSceneOffline=r.enableSceneOffline;i.enableTexturesOffline=r.enableTexturesOffline;r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version);i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(f){u()}else u()},!1);t.addEventListener("error",function(){u()},!1);try{t.send()}catch(o){n.Tools.Error("Error on XHR send request.");r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function f(){e.isSupported=!1;i&&i()}var u=this,e=this,r;this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline)?this.db?t&&t():(this.hasReachedQuota=!1,this.isSupported=!0,r=this.idbFactory.open("babylonjs",1),r.onerror=function(){f()},r.onblocked=function(){n.Tools.Error("IDB request blocked. Please reload the page.");f()},r.onsuccess=function(){u.db=r.result;t()},r.onupgradeneeded=function(t){u.db=t.target.result;try{u.db.createObjectStore("scenes",{keyPath:"sceneUrl"});u.db.createObjectStore("versions",{keyPath:"sceneUrl"});u.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(i){n.Tools.Error("Error while creating object stores. Exception: "+i.message);f()}}):(this.isSupported=!1,i&&i())},t.prototype.loadImageFromDB=function(t,i){var r=this,u=n.Database.ReturnFullUrlLocation(t),f=function(){r.hasReachedQuota||null===r.db?i.src=t:r._saveImageIntoDBAsync(u,i)};this.mustUpdateRessources?f():this._loadImageFromDBAsync(u,i,f)},t.prototype._loadImageFromDBAsync=function(t,i,r){var f,u,e;this.isSupported&&null!==this.db?(u=this.db.transaction(["textures"]),u.onabort=function(){i.src=t},u.oncomplete=function(){var u,e;f?(e=window.URL||window.webkitURL,u=e.createObjectURL(f.data,{oneTimeOnly:!0}),i.onerror=function(){n.Tools.Error("Error loading image from blob URL: "+u+" switching back to web url: "+t);i.src=t},i.src=u):r()},e=u.objectStore("textures").get(t),e.onsuccess=function(n){f=n.target.result},e.onerror=function(){n.Tools.Error("Error loading texture "+t+" from DB.");i.src=t}):(n.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t)},t.prototype._saveImageIntoDBAsync=function(t,i){var e=this,f,u,r;this.isSupported?(f=function(){var n,t;if(u){t=window.URL||window.webkitURL;try{n=t.createObjectURL(u,{oneTimeOnly:!0})}catch(r){n=t.createObjectURL(u)}}i.src=n},n.Database.isUASupportingBlobStorage?(r=new XMLHttpRequest,r.open("GET",t,!0),r.responseType="blob",r.addEventListener("load",function(){var o,h,s;if(200===r.status){u=r.response;o=e.db.transaction(["textures"],"readwrite");o.onabort=function(n){try{"QuotaExceededError"===n.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}f()};o.oncomplete=function(){f()};h={textureUrl:t,data:u};try{s=o.objectStore("textures").put(h);s.onsuccess=function(){};s.onerror=function(){f()}}catch(c){25===c.code&&(n.Database.isUASupportingBlobStorage=!1);i.src=t}}else i.src=t},!1),r.addEventListener("error",function(){n.Tools.Error("Error in XHR request in BABYLON.Database.");i.src=t},!1),r.send()):i.src=t):(n.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t)},t.prototype._checkVersionFromDB=function(n,t){var i=this,r=function(){i._saveVersionIntoDBAsync(n,t)};this._loadVersionFromDBAsync(n,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var e=this,u,f,o;if(this.isSupported)try{f=this.db.transaction(["versions"]);f.oncomplete=function(){u?e.manifestVersionFound>u.data?(e.mustUpdateRessources=!0,r()):i(u.data):(e.mustUpdateRessources=!0,r())};f.onabort=function(){i(-1)};o=f.objectStore("versions").get(t);o.onsuccess=function(n){u=n.target.result};o.onerror=function(){n.Tools.Error("Error loading version for scene "+t+" from DB.");i(-1)}}catch(s){n.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+s.message);i(-1)}else n.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var f=this,r,e,u;if(this.isSupported&&!this.hasReachedQuota)try{r=this.db.transaction(["versions"],"readwrite");r.onabort=function(n){try{"QuotaExceededError"===n.srcElement.error.name&&(f.hasReachedQuota=!0)}catch(t){}i(-1)};r.oncomplete=function(){i(f.manifestVersionFound)};e={sceneUrl:t,data:this.manifestVersionFound};u=r.objectStore("versions").put(e);u.onsuccess=function(){};u.onerror=function(){n.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(o){n.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+o.message);i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(t,i,r,u,f){var e=this,o=n.Database.ReturnFullUrlLocation(t),s=function(){e._saveFileIntoDBAsync(o,i,r)};this._checkVersionFromDB(o,function(n){-1!==n?e.mustUpdateRessources?e._saveFileIntoDBAsync(o,i,r,f):e._loadFileFromDBAsync(o,i,s,f):u()})},t.prototype._loadFileFromDBAsync=function(t,i,r){var f,e,u,o;this.isSupported?(f=-1!==t.indexOf(".babylon")?"scenes":"textures",u=this.db.transaction([f]),u.oncomplete=function(){e?i(e.data):r()},u.onabort=function(){r()},o=u.objectStore(f).get(t),o.onsuccess=function(n){e=n.target.result},o.onerror=function(){n.Tools.Error("Error loading file "+t+" from DB.");r()}):(n.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i())},t.prototype._saveFileIntoDBAsync=function(t,i,r,u){var s=this,o,e,f;this.isSupported?(o=-1!==t.indexOf(".babylon")?"scenes":"textures",f=new XMLHttpRequest,f.open("GET",t,!0),u&&(f.responseType="arraybuffer"),f.onprogress=r,f.addEventListener("load",function(){var r,c,h;if(200===f.status||n.Tools.ValidateXHRData(f,u?6:1))if(e=u?f.response:f.responseText,s.hasReachedQuota)i(e);else{r=s.db.transaction([o],"readwrite");r.onabort=function(n){try{"QuotaExceededError"===n.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(e)};r.oncomplete=function(){i(e)};c="scenes"===o?{sceneUrl:t,data:e,version:s.manifestVersionFound}:{textureUrl:t,data:e};try{h=r.objectStore(o).put(c);h.onsuccess=function(){};h.onerror=function(){n.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(l){i(e)}}else i()},!1),f.addEventListener("error",function(){n.Tools.Error("error on XHR request.");i()},!1),f.send()):(n.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i())},t.isUASupportingBlobStorage=!0,t.parseURL=function(n){var t=document.createElement("a");t.href=n;var i=n.substring(0,n.lastIndexOf("#")),r=n.substring(i.lastIndexOf("/")+1,n.length);return n.substring(0,n.indexOf(r,0))},t.ReturnFullUrlLocation=function(t){return-1===t.indexOf("http:/")?n.Database.parseURL(window.location.href)+t:t},t}();n.Database=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u,f,e){this.name=t;this.cellSize=u;this.sprites=[];this.renderingGroupId=0;this._vertexDeclaration=[3,4,4,4];this._vertexStrideSize=60;this._capacity=r;this._spriteTexture=new n.Texture(i,f,!0,!1);this._spriteTexture.wrapU=n.Texture.CLAMP_ADDRESSMODE;this._spriteTexture.wrapV=n.Texture.CLAMP_ADDRESSMODE;this._epsilon=void 0===e?.01:e;this._scene=f;this._scene.spriteManagers.push(this);this._vertexDeclaration=[3,4,4,4];this._vertexStrideSize=60;this._vertexBuffer=f.getEngine().createDynamicVertexBuffer(r*this._vertexStrideSize*4);for(var o=[],s=0,h=0;r>h;h++)o.push(s),o.push(s+1),o.push(s+2),o.push(s),o.push(s+2),o.push(s+3),s+=4;this._indexBuffer=f.getEngine().createIndexBuffer(o);this._vertices=new Float32Array(r*this._vertexStrideSize);this._effectBase=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],"");this._effectFog=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return t.prototype._appendSpriteVertex=function(n,t,i,r,u){var f=15*n,e;0==i?i=this._epsilon:1==i&&(i=1-this._epsilon);0==r?r=this._epsilon:1==r&&(r=1-this._epsilon);this._vertices[f]=t.position.x;this._vertices[f+1]=t.position.y;this._vertices[f+2]=t.position.z;this._vertices[f+3]=t.angle;this._vertices[f+4]=t.size;this._vertices[f+5]=i;this._vertices[f+6]=r;this._vertices[f+7]=t.invertU?1:0;this._vertices[f+8]=t.invertV?1:0;e=t.cellIndex/u>>0;this._vertices[f+9]=t.cellIndex-e*u;this._vertices[f+10]=e;this._vertices[f+11]=t.color.r;this._vertices[f+12]=t.color.g;this._vertices[f+13]=t.color.b;this._vertices[f+14]=t.color.a},t.prototype.render=function(){var r,t,h;if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var i=this._scene.getEngine(),o=this._spriteTexture.getBaseSize(),c=n.Tools.GetDeltaTime(),u=Math.min(this._capacity,this.sprites.length),f=o.width/this.cellSize,e=0,s=0;u>s;s++)r=this.sprites[s],r&&(r._animate(c),this._appendSpriteVertex(e++,r,0,0,f),this._appendSpriteVertex(e++,r,1,0,f),this._appendSpriteVertex(e++,r,1,1,f),this._appendSpriteVertex(e++,r,0,1,f));i.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,u*this._vertexStrideSize);t=this._effectBase;this._scene.fogMode!==n.Scene.FOGMODE_NONE&&(t=this._effectFog);i.enableEffect(t);h=this._scene.getViewMatrix();t.setTexture("diffuseSampler",this._spriteTexture);t.setMatrix("view",h);t.setMatrix("projection",this._scene.getProjectionMatrix());t.setFloat2("textureInfos",this.cellSize/o.width,this.cellSize/o.height);this._scene.fogMode!==n.Scene.FOGMODE_NONE&&(t.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),t.setColor3("vFogColor",this._scene.fogColor));i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,t);t.setBool("alphaTest",!0);i.setColorWrite(!1);i.draw(!0,0,6*u);i.setColorWrite(!0);t.setBool("alphaTest",!1);i.setAlphaMode(n.Engine.ALPHA_COMBINE);i.draw(!0,0,6*u);i.setAlphaMode(n.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var n=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(n,1);this.onDispose&&this.onDispose()},t}();n.SpriteManager=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i){this.name=t;this.color=new n.Color4(1,1,1,1);this.size=1;this.angle=0;this.cellIndex=0;this.invertU=0;this.invertV=0;this.animations=[];this._animationStarted=!1;this._loopAnimation=!1;this._fromIndex=0;this._toIndex=0;this._delay=0;this._direction=1;this._frameCount=0;this._time=0;this._manager=i;this._manager.sprites.push(this);this.position=n.Vector3.Zero()}return t.prototype.playAnimation=function(n,t,i,r){this._fromIndex=n;this._toIndex=t;this._loopAnimation=i;this._delay=r;this._animationStarted=!0;this._direction=t>n?1:-1;this.cellIndex=n;this._time=0},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(n){this._animationStarted&&(this._time+=n,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var n=0;n<this._manager.sprites.length;n++)this._manager.sprites[n]==this&&this._manager.sprites.splice(n,1)},t}();n.Sprite=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u,f){var o,e;this.name=t;this._vertexDeclaration=[2];this._vertexStrideSize=8;this.texture=i?new n.Texture(i,r,!0):null;this.isBackground=void 0===u?!0:u;this.color=void 0===f?new n.Color4(1,1,1,1):f;this._scene=r;this._scene.layers.push(this);o=[];o.push(1,1);o.push(-1,1);o.push(-1,-1);o.push(1,-1);this._vertexBuffer=r.getEngine().createVertexBuffer(o);e=[];e.push(0);e.push(1);e.push(2);e.push(0);e.push(2);e.push(3);this._indexBuffer=r.getEngine().createIndexBuffer(e);this._effect=this._scene.getEngine().createEffect("layer",["position"],["textureMatrix","color"],["textureSampler"],"")}return t.prototype.render=function(){if(this._effect.isReady()&&this.texture&&this.texture.isReady()){var t=this._scene.getEngine();t.enableEffect(this._effect);t.setState(!1);this._effect.setTexture("textureSampler",this.texture);this._effect.setMatrix("textureMatrix",this.texture.getTextureMatrix());this._effect.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a);t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect);t.setAlphaMode(n.Engine.ALPHA_COMBINE);t.draw(!0,0,6);t.setAlphaMode(n.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);var n=this._scene.layers.indexOf(this);this._scene.layers.splice(n,1);this.onDispose&&this.onDispose()},t}();n.Layer=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){this.position=n.Vector3.Zero();this.direction=n.Vector3.Zero();this.color=new n.Color4(0,0,0,0);this.colorStep=new n.Color4(0,0,0,0);this.lifeTime=1;this.age=0;this.size=0;this.angle=0;this.angularSpeed=0}return t}();n.Particle=t}(BABYLON||(BABYLON={}));!function(n){var t=function(n,t){if(n==t)return n;var i=Math.random();return i*(t-n)+n},i=function(){function i(i,r,u,f){var e=this;this.name=i;this.renderingGroupId=0;this.emitter=null;this.emitRate=10;this.manualEmitCount=-1;this.updateSpeed=.01;this.targetStopDuration=0;this.disposeOnStop=!1;this.minEmitPower=1;this.maxEmitPower=1;this.minLifeTime=1;this.maxLifeTime=1;this.minSize=1;this.maxSize=1;this.minAngularSpeed=0;this.maxAngularSpeed=0;this.blendMode=n.ParticleSystem.BLENDMODE_ONEONE;this.forceDepthWrite=!1;this.gravity=n.Vector3.Zero();this.direction1=new n.Vector3(0,1,0);this.direction2=new n.Vector3(0,1,0);this.minEmitBox=new n.Vector3(-.5,-.5,-.5);this.maxEmitBox=new n.Vector3(.5,.5,.5);this.color1=new n.Color4(1,1,1,1);this.color2=new n.Color4(1,1,1,1);this.colorDead=new n.Color4(0,0,0,1);this.textureMask=new n.Color4(1,1,1,1);this.particles=[];this._vertexDeclaration=[3,4,4];this._vertexStrideSize=44;this._stockParticles=[];this._newPartsExcess=0;this._scaledColorStep=new n.Color4(0,0,0,0);this._colorDiff=new n.Color4(0,0,0,0);this._scaledDirection=n.Vector3.Zero();this._scaledGravity=n.Vector3.Zero();this._currentRenderId=-1;this._started=!1;this._stopped=!1;this._actualFrame=0;this.id=i;this._capacity=r;this._scene=u;this._customEffect=f;u.particleSystems.push(this);this._vertexBuffer=u.getEngine().createDynamicVertexBuffer(r*this._vertexStrideSize*4);for(var o=[],s=0,h=0;r>h;h++)o.push(s),o.push(s+1),o.push(s+2),o.push(s),o.push(s+2),o.push(s+3),s+=4;this._indexBuffer=u.getEngine().createIndexBuffer(o);this._vertices=new Float32Array(r*this._vertexStrideSize);this.startDirectionFunction=function(i,r,u){var f=t(e.direction1.x,e.direction2.x),o=t(e.direction1.y,e.direction2.y),s=t(e.direction1.z,e.direction2.z);n.Vector3.TransformNormalFromFloatsToRef(f*i,o*i,s*i,r,u)};this.startPositionFunction=function(i,r){var u=t(e.minEmitBox.x,e.maxEmitBox.x),f=t(e.minEmitBox.y,e.maxEmitBox.y),o=t(e.minEmitBox.z,e.maxEmitBox.z);n.Vector3.TransformCoordinatesFromFloatsToRef(u,f,o,i,r)}}return i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype.start=function(){this._started=!0;this._stopped=!1;this._actualFrame=0},i.prototype.stop=function(){this._stopped=!0},i.prototype._appendParticleVertex=function(n,t,i,r){var u=11*n;this._vertices[u]=t.position.x;this._vertices[u+1]=t.position.y;this._vertices[u+2]=t.position.z;this._vertices[u+3]=t.color.r;this._vertices[u+4]=t.color.g;this._vertices[u+5]=t.color.b;this._vertices[u+6]=t.color.a;this._vertices[u+7]=t.angle;this._vertices[u+8]=t.size;this._vertices[u+9]=i;this._vertices[u+10]=r},i.prototype._update=function(i){var u,r,f,e,o;for(this._alive=this.particles.length>0,u=0;u<this.particles.length;u++)r=this.particles[u],r.age+=this._scaledUpdateSpeed,r.age>=r.lifeTime?(this._stockParticles.push(this.particles.splice(u,1)[0]),u--):(r.colorStep.scaleToRef(this._scaledUpdateSpeed,this._scaledColorStep),r.color.addInPlace(this._scaledColorStep),r.color.a<0&&(r.color.a=0),r.angle+=r.angularSpeed*this._scaledUpdateSpeed,r.direction.scaleToRef(this._scaledUpdateSpeed,this._scaledDirection),r.position.addInPlace(this._scaledDirection),this.gravity.scaleToRef(this._scaledUpdateSpeed,this._scaledGravity),r.direction.addInPlace(this._scaledGravity));for(f=this.emitter.position?this.emitter.getWorldMatrix():n.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z),u=0;i>u&&this.particles.length!=this._capacity;u++)0!==this._stockParticles.length?(r=this._stockParticles.pop(),r.age=0):r=new n.Particle,this.particles.push(r),e=t(this.minEmitPower,this.maxEmitPower),this.startDirectionFunction(e,f,r.direction),r.lifeTime=t(this.minLifeTime,this.maxLifeTime),r.size=t(this.minSize,this.maxSize),r.angularSpeed=t(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(f,r.position),o=t(0,1),n.Color4.LerpToRef(this.color1,this.color2,o,r.color),this.colorDead.subtractToRef(r.color,this._colorDiff),this._colorDiff.scaleToRef(1/r.lifeTime,r.colorStep)},i.prototype._getEffect=function(){var t,n;return this._customEffect?this._customEffect:(t=[],this._scene.clipPlane&&t.push("#define CLIPPLANE"),n=t.join("\n"),this._cachedDefines!=n&&(this._cachedDefines=n,this._effect=this._scene.getEngine().createEffect("particles",["position","color","options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],n)),this._effect)},i.prototype.animate=function(){var f,r,n,t,u,i,e;if(this._started&&(f=this._getEffect(),this.emitter&&f.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId())){for(this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio(),this.manualEmitCount>-1?(r=this.manualEmitCount,this.manualEmitCount=0):r=this.emitRate,n=r*this._scaledUpdateSpeed>>0,this._newPartsExcess+=r*this._scaledUpdateSpeed-n,this._newPartsExcess>1&&(n+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?n=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(n),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this))),t=0,u=0;u<this.particles.length;u++)i=this.particles[u],this._appendParticleVertex(t++,i,0,0),this._appendParticleVertex(t++,i,1,0),this._appendParticleVertex(t++,i,1,1),this._appendParticleVertex(t++,i,0,1);e=this._scene.getEngine();e.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,this.particles.length*this._vertexStrideSize)}},i.prototype.render=function(){var t=this._getEffect(),i,u,r,f;return(this.emitter&&t.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length)?(i=this._scene.getEngine(),i.enableEffect(t),u=this._scene.getViewMatrix(),(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",u),t.setMatrix("projection",this._scene.getProjectionMatrix()),t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane)&&(r=this._scene.clipPlane,f=u.clone(),f.invert(),t.setMatrix("invView",f),t.setFloat4("vClipPlane",r.normal.x,r.normal.y,r.normal.z,r.d)),i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,t),i.setAlphaMode(this.blendMode===n.ParticleSystem.BLENDMODE_ONEONE?n.Engine.ALPHA_ADD:n.Engine.ALPHA_COMBINE),this.forceDepthWrite&&i.setDepthWrite(!0),i.draw(!0,0,6*this.particles.length),i.setAlphaMode(n.Engine.ALPHA_DISABLE),this.particles.length):0},i.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var n=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(n,1);this.onDispose&&this.onDispose()},i.prototype.clone=function(t,i){var r=new n.ParticleSystem(t,this._capacity,this._scene);return n.Tools.DeepCopy(this,r,["particles"],["_vertexDeclaration","_vertexStrideSize"]),void 0===i&&(i=this.emitter),r.emitter=i,this.particleTexture&&(r.particleTexture=new n.Texture(this.particleTexture.url,this._scene)),r.start(),r},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i}();n.ParticleSystem=i}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,i,r,u,f){this.name=n;this.targetProperty=i;this.framePerSecond=r;this.dataType=u;this.loopMode=f;this._offsetsCache={};this._highLimitsCache={};this._stopped=!1;this.targetPropertyPath=i.split(".");this.dataType=u;this.loopMode=void 0===f?t.ANIMATIONLOOPMODE_CYCLE:f}return t.prototype.isStopped=function(){return this._stopped},t.prototype.getKeys=function(){return this._keys},t.prototype.floatInterpolateFunction=function(n,t,i){return n+(t-n)*i},t.prototype.quaternionInterpolateFunction=function(t,i,r){return n.Quaternion.Slerp(t,i,r)},t.prototype.vector3InterpolateFunction=function(t,i,r){return n.Vector3.Lerp(t,i,r)},t.prototype.color3InterpolateFunction=function(t,i,r){return n.Color3.Lerp(t,i,r)},t.prototype.clone=function(){var n=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);return n.setKeys(this._keys),n},t.prototype.setKeys=function(n){this._keys=n.slice(0);this._offsetsCache={};this._highLimitsCache={}},t.prototype._interpolate=function(n,i,r,u,f){var e,c;if(r===t.ANIMATIONLOOPMODE_CONSTANT&&i>0)return f.clone?f.clone():f;for(this.currentFrame=n,e=0;e<this._keys.length;e++)if(this._keys[e+1].frame>=n){var o=this._keys[e].value,s=this._keys[e+1].value,h=(n-this._keys[e].frame)/(this._keys[e+1].frame-this._keys[e].frame);switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:switch(r){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(o,s,h);case t.ANIMATIONLOOPMODE_RELATIVE:return u*i+this.floatInterpolateFunction(o,s,h)}break;case t.ANIMATIONTYPE_QUATERNION:c=null;switch(r){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:c=this.quaternionInterpolateFunction(o,s,h);break;case t.ANIMATIONLOOPMODE_RELATIVE:c=this.quaternionInterpolateFunction(o,s,h).add(u.scale(i))}return c;case t.ANIMATIONTYPE_VECTOR3:switch(r){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(o,s,h);case t.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(o,s,h).add(u.scale(i))}case t.ANIMATIONTYPE_COLOR3:switch(r){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(o,s,h);case t.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(o,s,h).add(u.scale(i))}case t.ANIMATIONTYPE_MATRIX:switch(r){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_RELATIVE:return o}}break}return this._keys[this._keys.length-1].value},t.prototype.animate=function(i,r,u,f,e){var c,b,s,a,v,y,o,l,h,p,w;if(!this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1;if(c=!0,0!=this._keys[0].frame&&(b={frame:0,value:this._keys[0].value},this._keys.splice(0,0,b)),(r<this._keys[0].frame||r>this._keys[this._keys.length-1].frame)&&(r=this._keys[0].frame),(u<this._keys[0].frame||u>this._keys[this._keys.length-1].frame)&&(u=this._keys[this._keys.length-1].frame),a=u-r,v=i*this.framePerSecond*e/1e3,v>a&&!f)c=!1,y=this._keys[this._keys.length-1].value;else if(y=0,this.loopMode!=t.ANIMATIONLOOPMODE_CYCLE){if(o=u.toString()+r.toString(),!this._offsetsCache[o]){l=this._interpolate(r,0,t.ANIMATIONLOOPMODE_CYCLE);h=this._interpolate(u,0,t.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:this._offsetsCache[o]=h-l;break;case t.ANIMATIONTYPE_QUATERNION:this._offsetsCache[o]=h.subtract(l);break;case t.ANIMATIONTYPE_VECTOR3:this._offsetsCache[o]=h.subtract(l);case t.ANIMATIONTYPE_COLOR3:this._offsetsCache[o]=h.subtract(l)}this._highLimitsCache[o]=h}y=this._highLimitsCache[o];s=this._offsetsCache[o]}if(void 0===s)switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:s=0;break;case t.ANIMATIONTYPE_QUATERNION:s=new n.Quaternion(0,0,0,0);break;case t.ANIMATIONTYPE_VECTOR3:s=n.Vector3.Zero();break;case t.ANIMATIONTYPE_COLOR3:s=n.Color3.Black()}var d=v/a>>0,g=c?r+v%a:u,k=this._interpolate(g,d,this.loopMode,s,y);if(this.targetPropertyPath.length>1){for(p=this._target[this.targetPropertyPath[0]],w=1;w<this.targetPropertyPath.length-1;w++)p=p[this.targetPropertyPath[w]];p[this.targetPropertyPath[this.targetPropertyPath.length-1]]=k}else this._target[this.targetPropertyPath[0]]=k;return this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty),c||(this._stopped=!0),c},Object.defineProperty(t,"ANIMATIONTYPE_FLOAT",{get:function(){return t._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_VECTOR3",{get:function(){return t._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_QUATERNION",{get:function(){return t._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_MATRIX",{get:function(){return t._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_COLOR3",{get:function(){return t._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return t._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return t._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return t._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),t._ANIMATIONTYPE_FLOAT=0,t._ANIMATIONTYPE_VECTOR3=1,t._ANIMATIONTYPE_QUATERNION=2,t._ANIMATIONTYPE_MATRIX=3,t._ANIMATIONTYPE_COLOR3=4,t._ANIMATIONLOOPMODE_RELATIVE=0,t._ANIMATIONLOOPMODE_CYCLE=1,t._ANIMATIONLOOPMODE_CONSTANT=2,t}();n.Animation=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(n,t,i,r,u,f,e,o){"undefined"==typeof i&&(i=0);"undefined"==typeof r&&(r=100);"undefined"==typeof u&&(u=!1);"undefined"==typeof f&&(f=1);this.target=t;this.fromFrame=i;this.toFrame=r;this.loopAnimation=u;this.speedRatio=f;this.onAnimationEnd=e;this._animations=[];this._paused=!1;this.animationStarted=!1;o&&this.appendAnimations(t,o);this._scene=n;n._activeAnimatables.push(this)}return n.prototype.appendAnimations=function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],r._target=n,this._animations.push(r)},n.prototype.getAnimationByTargetProperty=function(n){for(var i=this._animations,t=0;t<i.length;t++)if(i[t].targetProperty===n)return i[t];return null},n.prototype.pause=function(){this._paused=!0},n.prototype.restart=function(){this._paused=!1},n.prototype.stop=function(){var n=this._scene._activeAnimatables.indexOf(this);n>-1&&this._scene._activeAnimatables.splice(n,1);this.onAnimationEnd&&this.onAnimationEnd()},n.prototype._animate=function(n){var u,f;if(this._paused)return!0;this._localDelayOffset||(this._localDelayOffset=n);for(var t=!1,r=this._animations,i=0;i<r.length;i++)u=r[i],f=u.animate(n-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio),t=t||f;return!t&&this.onAnimationEnd&&this.onAnimationEnd(),t},n}();n.Animatable=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r){"undefined"==typeof r&&(r=2);this.maxDepth=r;this.dynamicContent=[];this._maxBlockCapacity=i||64;this._selectionContent=new n.SmartArray(1024);this._creationFunc=t}return t.prototype.update=function(n,i,r){t._CreateBlocks(n,i,r,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(n){for(var i,t=0;t<this.blocks.length;t++)i=this.blocks[t],i.addEntry(n)},t.prototype.select=function(n,t){var i,r;for(this._selectionContent.reset(),i=0;i<this.blocks.length;i++)r=this.blocks[i],r.select(n,this._selectionContent,t);return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(n,t,i){var r,u;for(this._selectionContent.reset(),r=0;r<this.blocks.length;r++)u=this.blocks[r],u.intersects(n,t,this._selectionContent,i);return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(n){var t,i;for(this._selectionContent.reset(),t=0;t<this.blocks.length;t++)i=this.blocks[t],i.intersectsRay(n,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,i,r,u,f,e,o,s){var a,h,c,l;for(o.blocks=[],a=new n.Vector3((i.x-t.x)/2,(i.y-t.y)/2,(i.z-t.z)/2),h=0;2>h;h++)for(c=0;2>c;c++)for(l=0;2>l;l++){var y=t.add(a.multiplyByFloats(h,c,l)),p=t.add(a.multiplyByFloats(h+1,c+1,l+1)),v=new n.OctreeBlock(y,p,u,f+1,e,s);v.addEntries(r);o.blocks.push(v)}},t.CreationFuncForMeshes=function(n,t){n.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(n)},t.CreationFuncForSubMeshes=function(n,t){n.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(n)},t}();n.Octree=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t,i,r,u,f){this.entries=[];this._boundingVectors=[];this._capacity=i;this._depth=r;this._maxDepth=u;this._creationFunc=f;this._minPoint=n;this._maxPoint=t;this._boundingVectors.push(n.clone());this._boundingVectors.push(t.clone());this._boundingVectors.push(n.clone());this._boundingVectors[2].x=t.x;this._boundingVectors.push(n.clone());this._boundingVectors[3].y=t.y;this._boundingVectors.push(n.clone());this._boundingVectors[4].z=t.z;this._boundingVectors.push(t.clone());this._boundingVectors[5].z=n.z;this._boundingVectors.push(t.clone());this._boundingVectors[6].x=n.x;this._boundingVectors.push(t.clone());this._boundingVectors[7].y=n.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(n){var t,i;if(this.blocks)for(t=0;t<this.blocks.length;t++)i=this.blocks[t],i.addEntry(n);else this._creationFunc(n,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(n){for(var i,t=0;t<n.length;t++)i=n[t],this.addEntry(i)},t.prototype.select=function(t,i,r){var u,f;if(n.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(u=0;u<this.blocks.length;u++)f=this.blocks[u],f.select(t,i,r);return}r?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,i,r,u){var f,e;if(n.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,i)){if(this.blocks){for(f=0;f<this.blocks.length;f++)e=this.blocks[f],e.intersects(t,i,r,u);return}u?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(n,t){var i,r;if(n.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(i=0;i<this.blocks.length;i++)r=this.blocks[i],r.intersectsRay(n,t);return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){n.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();n.OctreeBlock=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u){this.name=t;this.children=[];this.animations=[];this._worldTransform=new n.Matrix;this._absoluteTransform=new n.Matrix;this._invertedAbsoluteTransform=new n.Matrix;this._skeleton=i;this._matrix=u;this._baseMatrix=u;i.bones.push(this);r?(this._parent=r,r.children.push(this)):this._parent=null;this._updateDifferenceMatrix()}return t.prototype.getParent=function(){return this._parent},t.prototype.getLocalMatrix=function(){return this._matrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteMatrix=function(){for(var t=this._matrix.clone(),n=this._parent;n;)t=t.multiply(n.getLocalMatrix()),n=n.getParent();return t},t.prototype.updateMatrix=function(n){this._matrix=n;this._skeleton._markAsDirty();this._updateDifferenceMatrix()},t.prototype._updateDifferenceMatrix=function(){this._parent?this._matrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(this._matrix);this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var n=0;n<this.children.length;n++)this.children[n]._updateDifferenceMatrix()},t.prototype.markAsDirty=function(){this._skeleton._markAsDirty()},t}();n.Bone=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r){this.name=t;this.id=i;this.bones=[];this._isDirty=!0;this._identity=n.Matrix.Identity();this.bones=[];this._scene=r;r.skeletons.push(this)}return t.prototype.getTransformMatrices=function(){return this._transformMatrices},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype.prepare=function(){var t,n,i;if(this._isDirty){for(this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),t=0;t<this.bones.length;t++)n=this.bones[t],i=n.getParent(),i?n.getLocalMatrix().multiplyToRef(i.getWorldMatrix(),n.getWorldMatrix()):n.getWorldMatrix().copyFrom(n.getLocalMatrix()),n.getInvertedAbsoluteTransform().multiplyToArray(n.getWorldMatrix(),this._transformMatrices,16*t);this._identity.copyToArray(this._transformMatrices,16*this.bones.length);this._isDirty=!1}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!=this.bones.length){this._animatables=[];for(var n=0;n<this.bones.length;n++)this._animatables.push(this.bones[n])}return this._animatables},t.prototype.clone=function(t,i){for(var r,e,o,s,u=new n.Skeleton(t,i||t,this._scene),f=0;f<this.bones.length;f++)r=this.bones[f],e=null,r.getParent()&&(o=this.bones.indexOf(r.getParent()),e=u.bones[o]),s=new n.Bone(r.name,u,e,r.getBaseMatrix()),n.Tools.DeepCopy(r.animations,s.animations);return u},t}();n.Skeleton=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u,f,e,o,s,h){this.name=t;this.width=-1;this.height=-1;this._reusable=!1;this._textures=new n.SmartArray(2);this._currentRenderTextureInd=0;null!=e?(this._camera=e,this._scene=e.getScene(),e.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=s;this._renderRatio=f;this.renderTargetSamplingMode=o?o:n.Texture.NEAREST_SAMPLINGMODE;this._reusable=h||!1;u=u||[];u.push("textureSampler");this._effect=this._engine.createEffect({vertex:"postprocess",fragment:i},["position"],r||[],u,"")}return t.prototype.isReusable=function(){return this._reusable},t.prototype.activate=function(t,i){var f;t=t||this._camera;var e=t.getScene(),o=t.getEngine().getCaps().maxTextureSize,r=(i?i._width:this._engine.getRenderingCanvas().width)*this._renderRatio|0,u=(i?i._height:this._engine.getRenderingCanvas().height)*this._renderRatio|0;if(r=n.Tools.GetExponantOfTwo(r,o),u=n.Tools.GetExponantOfTwo(u,o),this.width!==r||this.height!==u){if(this._textures.length>0){for(f=0;f<this._textures.length;f++)this._engine._releaseTexture(this._textures.data[f]);this._textures.reset()}this.width=r;this.height=u;this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:t._postProcesses.indexOf(this)===t._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode}));this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:t._postProcesses.indexOf(this)===t._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode}));this.onSizeChanged&&this.onSizeChanged()}this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]);this.onActivate&&this.onActivate(t);this._engine.clear(e.clearColor,e.autoClear||e.forceWireframe,!0);this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},t.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(n.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this.onApply&&this.onApply(this._effect),this._effect):null},t.prototype.dispose=function(n){var t,i;if(n=n||this._camera,this._textures.length>0){for(t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.reset()}n.detachPostProcess(this);i=n._postProcesses.indexOf(this);i===n._postProcessesTakenIndices[0]&&n._postProcessesTakenIndices.length>0&&(this._camera._postProcesses[n._postProcessesTakenIndices[0]].width=-1)},t}();n.PostProcess=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(n){var i,t;this._vertexDeclaration=[2];this._vertexStrideSize=8;this._scene=n;i=[];i.push(1,1);i.push(-1,1);i.push(-1,-1);i.push(1,-1);this._vertexBuffer=n.getEngine().createVertexBuffer(i);t=[];t.push(0);t.push(1);t.push(2);t.push(0);t.push(2);t.push(3);this._indexBuffer=n.getEngine().createIndexBuffer(t)}return n.prototype._prepareFrame=function(n){var t=this._scene.activeCamera._postProcesses,i=this._scene.activeCamera._postProcessesTakenIndices;return 0!==i.length&&this._scene.postProcessesEnabled?(t[this._scene.activeCamera._postProcessesTakenIndices[0]].activate(this._scene.activeCamera,n),!0):!1},n.prototype._finalizeFrame=function(n,t){var o=this._scene.activeCamera._postProcesses,u=this._scene.activeCamera._postProcessesTakenIndices,i,r,f,e;if(0!==u.length&&this._scene.postProcessesEnabled){for(i=this._scene.getEngine(),r=0;r<u.length&&(r<u.length-1?o[u[r+1]].activate(this._scene.activeCamera):t?i.bindFramebuffer(t):i.restoreDefaultFramebuffer(),!n);r++)f=o[u[r]],e=f.apply(),e&&(f.onBeforeRender&&f.onBeforeRender(e),i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,e),i.draw(!0,0,6));i.setDepthBuffer(!0);i.setDepthWrite(!0)}},n.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},n}();n.PostProcessManager=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e){n.call(this,t,"pass",null,null,i,r,u,f,e)}return __extends(t,n),t}(n.PostProcess);n.PassPostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f,e,o,s,h){"undefined"==typeof o&&(o=n.Texture.BILINEAR_SAMPLINGMODE);var c=this;t.call(this,i,"blur",["screenSize","direction","blurWidth"],null,f,e,o,s,h);this.direction=r;this.blurWidth=u;this.onApply=function(n){n.setFloat2("screenSize",c.width,c.height);n.setVector2("direction",c.direction);n.setFloat("blurWidth",c.blurWidth)}}return __extends(i,t),i}(n.PostProcess);n.BlurPostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e,o){var s=this;n.call(this,t,"filter",["kernelMatrix"],null,r,u,f,e,o);this.kernelMatrix=i;this.onApply=function(n){n.setMatrix("kernelMatrix",s.kernelMatrix)}}return __extends(t,n),t}(n.PostProcess);n.FilterPostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=this;t.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],o,s,h,c,l);this.color=u;this.depth=f;this.colorLevel=e;this.onActivate=function(t){a._refRexture=a._refRexture||new n.Texture(r,t.getScene())};this.onApply=function(n){n.setColor3("baseColor",a.color);n.setFloat("depth",a.depth);n.setFloat("colorLevel",a.colorLevel);n.setTexture("refractionSampler",a._refRexture)}}return __extends(i,t),i.prototype.dispose=function(n){this._refRexture&&this._refRexture.dispose();t.prototype.dispose.call(this,n)},i}(n.PostProcess);n.RefractionPostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e){n.call(this,t,"blackAndWhite",null,null,i,r,u,f,e)}return __extends(t,n),t}(n.PostProcess);n.BlackAndWhitePostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e,o){var s=this;n.call(this,t,"convolution",["kernel","screenSize"],null,r,u,f,e,o);this.kernel=i;this.onApply=function(n){n.setFloat2("screenSize",s.width,s.height);n.setArray("kernel",s.kernel)}}return __extends(t,n),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(n.PostProcess);n.ConvolutionPostProcess=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e){var o=this;n.call(this,t,"fxaa",["texelSize"],null,i,r,u,f,e);this.onSizeChanged=function(){o.texelWidth=1/o.width;o.texelHeight=1/o.height};this.onApply=function(n){n.setFloat2("texelSize",o.texelWidth,o.texelHeight)}}return __extends(t,n),t}(n.PostProcess);n.FxaaPostProcess=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u,f){this.size=t;this.position=i;this.dispose=function(){this.texture&&this.texture.dispose();var n=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(n,1)};this.color=r||new n.Color3(1,1,1);this.texture=u?new n.Texture(u,f.getScene(),!0):null;this._system=f;f.lensFlares.push(this)}return t}();n.LensFlare=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t,i){var u,r;this.name=n;this.lensFlares=[];this.borderLimit=300;this._vertexDeclaration=[2];this._vertexStrideSize=8;this._isEnabled=!0;this._scene=i;this._emitter=t;i.lensFlareSystems.push(this);this.meshesSelectionPredicate=function(n){return n.material&&n.isVisible&&n.isEnabled()&&n.isBlocker&&0!=(n.layerMask&i.activeCamera.layerMask)};u=[];u.push(1,1);u.push(-1,1);u.push(-1,-1);u.push(1,-1);this._vertexBuffer=i.getEngine().createVertexBuffer(u);r=[];r.push(0);r.push(1);r.push(2);r.push(0);r.push(2);r.push(3);this._indexBuffer=i.getEngine().createIndexBuffer(r);this._effect=this._scene.getEngine().createEffect("lensFlare",["position"],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(n){this._isEnabled=n},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var i=this.getEmitterPosition();return i=n.Vector3.Project(i,n.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=i.x,this._positionY=i.y,i=n.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),i.z>0&&this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&this._positionY<t.y+t.height?!0:!1},t.prototype._isVisible=function(){var r,i;if(!this._isEnabled)return!1;var u=this.getEmitterPosition(),t=u.subtract(this._scene.activeCamera.position),f=t.length();return t.normalize(),r=new n.Ray(this._scene.activeCamera.position,t),i=this._scene.pickWithRay(r,this.meshesSelectionPredicate,!0),!i.hit||i.distance>f},t.prototype.render=function(){var o,s,f,u,e;if(!this._effect.isReady())return!1;var i=this._scene.getEngine(),l=this._scene.activeCamera.viewport,t=l.toGlobal(i);if(!this.computeEffectivePosition(t)||!this._isVisible()||(o=this._positionX<this.borderLimit+t.x?this.borderLimit+t.x-this._positionX:this._positionX>t.x+t.width-this.borderLimit?this._positionX-t.x-t.width+this.borderLimit:0,s=this._positionY<this.borderLimit+t.y?this.borderLimit+t.y-this._positionY:this._positionY>t.y+t.height-this.borderLimit?this._positionY-t.y-t.height+this.borderLimit:0,f=o>s?o:s,f>this.borderLimit&&(f=this.borderLimit),u=1-f/this.borderLimit,0>u))return!1;u>1&&(u=1);var h=t.x+t.width/2,c=t.y+t.height/2,a=h-this._positionX,v=c-this._positionY;for(i.enableEffect(this._effect),i.setState(!1),i.setDepthBuffer(!1),i.setAlphaMode(n.Engine.ALPHA_ADD),i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),e=0;e<this.lensFlares.length;e++){var r=this.lensFlares[e],y=h-a*r.position,p=c-v*r.position,w=r.size,b=r.size*i.getAspectRatio(this._scene.activeCamera),k=2*(y/t.width)-1,d=1-2*(p/t.height),g=n.Matrix.FromValues(w/2,0,0,0,0,b/2,0,0,0,0,1,0,k,d,0,1);this._effect.setMatrix("viewportMatrix",g);this._effect.setTexture("textureSampler",r.texture);this._effect.setFloat4("color",r.color.r*u,r.color.g*u,r.color.b*u,1);i.draw(!0,0,6)}return i.setDepthBuffer(!0),i.setAlphaMode(n.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){for(this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var n=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(n,1)},t}();n.LensFlareSystem=t}(BABYLON||(BABYLON={}));!function(n){var i=function(){function n(n,t,i){this.bu=n;this.bv=t;this.distance=i;this.faceId=0}return n}(),t;n.IntersectionInfo=i;t=function(){function t(){this.hit=!1;this.distance=0;this.pickedPoint=null;this.pickedMesh=null;this.bu=0;this.bv=0;this.faceId=-1}return t.prototype.getNormal=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.VertexBuffer.NormalKind))return null;var u=this.pickedMesh.getIndices(),f=this.pickedMesh.getVerticesData(n.VertexBuffer.NormalKind),t=n.Vector3.FromArray(f,3*u[3*this.faceId]),i=n.Vector3.FromArray(f,3*u[3*this.faceId+1]),r=n.Vector3.FromArray(f,3*u[3*this.faceId+2]);return t=t.scale(this.bu),i=i.scale(this.bv),r=r.scale(1-this.bu-this.bv),new n.Vector3(t.x+i.x+r.x,t.y+i.y+r.y,t.z+i.z+r.z)},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.VertexBuffer.UVKind))return null;var u=this.pickedMesh.getIndices(),f=this.pickedMesh.getVerticesData(n.VertexBuffer.UVKind),t=n.Vector2.FromArray(f,2*u[3*this.faceId]),i=n.Vector2.FromArray(f,2*u[3*this.faceId+1]),r=n.Vector2.FromArray(f,2*u[3*this.faceId+2]);return t=t.scale(this.bu),i=i.scale(this.bv),r=r.scale(1-this.bu-this.bv),new n.Vector2(t.x+i.x+r.x,t.y+i.y+r.y)},t}();n.PickingInfo=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t,i,r,u,f,e,o){this.engine=n;this.canvas=i;this.currentScene=t;this.sceneLoadedCallback=r;this.progressCallback=u;this.additionnalRenderLoopLogicCallback=f;this.textureLoadingCallback=e;this.startingProcessingFilesCallback=o}return t.prototype.monitorElementForDragNDrop=function(n){var t=this;n&&(this.elementToMonitor=n,this.elementToMonitor.addEventListener("dragenter",function(n){t.drag(n)},!1),this.elementToMonitor.addEventListener("dragover",function(n){t.drag(n)},!1),this.elementToMonitor.addEventListener("drop",function(n){t.drop(n)},!1))},t.prototype.renderFunction=function(){if(this.additionnalRenderLoopLogicCallback&&this.additionnalRenderLoopLogicCallback(),this.currentScene){if(this.textureLoadingCallback){var n=this.currentScene.getWaitingItemsCount();n>0&&this.textureLoadingCallback(n)}this.currentScene.render()}},t.prototype.drag=function(n){n.stopPropagation();n.preventDefault()},t.prototype.drop=function(n){n.stopPropagation();n.preventDefault();this.loadFiles(n)},t.prototype.loadFiles=function(t){var e=this,u=this,f,i,r;if(this.startingProcessingFilesCallback&&this.startingProcessingFilesCallback(),t&&t.dataTransfer&&t.dataTransfer.files&&(i=t.dataTransfer.files),t&&t.target&&t.target.files&&(i=t.target.files),i&&i.length>0){for(r=0;r<i.length;r++)switch(i[r].type){case"image/jpeg":case"image/png":n.FilesInput.FilesTextures[i[r].name]=i[r];break;case"image/targa":case"image/vnd.ms-dds":n.FilesInput.FilesToLoad[i[r].name]=i[r];break;default:-1!==i[r].name.indexOf(".babylon")&&-1===i[r].name.indexOf(".manifest")&&-1===i[r].name.indexOf(".incremental")&&-1===i[r].name.indexOf(".babylonmeshdata")&&-1===i[r].name.indexOf(".babylongeometrydata")&&(f=i[r])}f?(this.currentScene&&(this.engine.stopRenderLoop(),this.currentScene.dispose()),n.SceneLoader.Load("file:",f,this.engine,function(n){u.currentScene=n;u.currentScene.executeWhenReady(function(){u.currentScene.activeCamera&&u.currentScene.activeCamera.attachControl(u.canvas);u.sceneLoadedCallback&&u.sceneLoadedCallback(f,u.currentScene);u.engine.runRenderLoop(function(){u.renderFunction()})})},function(n){e.progressCallback&&e.progressCallback(n)})):n.Tools.Error("Please provide a valid .babylon file.")}},t.FilesTextures=[],t.FilesToLoad=[],t}();n.FilesInput=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){this._registeredMeshes=[];this.updateBodyPosition=function(n){for(var t,i,u,f,e,r=0;r<this._registeredMeshes.length;r++){if(t=this._registeredMeshes[r],t.mesh===n||t.mesh===n.parent)return i=t.body.body,n.computeWorldMatrix(!0),u=n.getBoundingInfo().boundingBox.center,i.setPosition(u.x,u.y,u.z),void i.setOrientation(n.rotation.x,n.rotation.y,n.rotation.z);if(t.mesh.parent===n)return n.computeWorldMatrix(!0),t.mesh.computeWorldMatrix(!0),f=t.mesh.getAbsolutePosition(),e=n.rotation,i=t.body.body,i.setPosition(f.x,f.y,f.z),void i.setOrientation(e.x,e.y,e.z)}}}return t.prototype._checkWithEpsilon=function(t){return t<n.PhysicsEngine.Epsilon?n.PhysicsEngine.Epsilon:t},t.prototype.initialize=function(){this._world=new OIMO.World;this._world.clear()},t.prototype.setGravity=function(n){this._world.gravity=n},t.prototype.registerMesh=function(t,i,r){var f=null;switch(this.unregisterMesh(t),t.computeWorldMatrix(!0),i){case n.PhysicsEngine.SphereImpostor:var u=t.getBoundingInfo().boundingBox,s=u.maximumWorld.x-u.minimumWorld.x,h=u.maximumWorld.y-u.minimumWorld.y,c=u.maximumWorld.z-u.minimumWorld.z,l=Math.max(this._checkWithEpsilon(s),this._checkWithEpsilon(h),this._checkWithEpsilon(c))/2,o=t.position.subtract(u.center);f=new OIMO.Body({type:"sphere",size:[l],pos:[u.center.x,u.center.y,u.center.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=r.mass,config:[r.mass,r.friction,r.restitution],world:this._world});this._registeredMeshes.push({mesh:t,body:f,delta:o});break;case n.PhysicsEngine.PlaneImpostor:case n.PhysicsEngine.BoxImpostor:u=t.getBoundingInfo().boundingBox;var a=u.minimumWorld,v=u.maximumWorld,e=v.subtract(a),y=this._checkWithEpsilon(e.x),p=this._checkWithEpsilon(e.y),w=this._checkWithEpsilon(e.z),o=t.position.subtract(u.center);f=new OIMO.Body({type:"box",size:[y,p,w],pos:[u.center.x,u.center.y,u.center.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=r.mass,config:[r.mass,r.friction,r.restitution],world:this._world});this._registeredMeshes.push({mesh:t,body:f,delta:o})}return f},t.prototype.registerMeshesAsCompound=function(n,t){for(var c,i,o,s=[],r=[],u=[],f=[],h=n[0].mesh,e=0;e<n.length;e++)c=n[e],i=this._createBodyAsCompound(c,t,h),s.push(i.type),r.push.apply(r,i.size),u.push.apply(u,i.pos),f.push.apply(f,i.rot);return o=new OIMO.Body({type:s,size:r,pos:u,rot:f,move:0!=t.mass,config:[t.mass,t.friction,t.restitution],world:this._world}),this._registeredMeshes.push({mesh:h,body:o}),o},t.prototype._createBodyAsCompound=function(t){var u=null,i=t.mesh;switch(t.impostor){case n.PhysicsEngine.SphereImpostor:var r=i.getBoundingInfo().boundingBox,o=r.maximumWorld.x-r.minimumWorld.x,s=r.maximumWorld.y-r.minimumWorld.y,h=r.maximumWorld.z-r.minimumWorld.z,c=Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(h))/2;u={type:"sphere",size:[c,-1,-1],pos:[i.position.x,i.position.y,i.position.z],rot:[i.rotation.x/OIMO.TO_RAD,i.rotation.y/OIMO.TO_RAD,i.rotation.z/OIMO.TO_RAD]};break;case n.PhysicsEngine.PlaneImpostor:case n.PhysicsEngine.BoxImpostor:r=i.getBoundingInfo().boundingBox;var l=r.minimumWorld,a=r.maximumWorld,f=a.subtract(l),v=this._checkWithEpsilon(f.x),y=this._checkWithEpsilon(f.y),p=this._checkWithEpsilon(f.z),e=i.position;u={type:"box",size:[v,y,p],pos:[e.x,e.y,e.z],rot:[i.rotation.x/OIMO.TO_RAD,i.rotation.y/OIMO.TO_RAD,i.rotation.z/OIMO.TO_RAD]}}return u},t.prototype.unregisterMesh=function(n){for(var t,i=0;i<this._registeredMeshes.length;i++)if(t=this._registeredMeshes[i],t.mesh===n||t.mesh===n.parent)return t.body&&(this._world.removeRigidBody(t.body.body),this._unbindBody(t.body)),void this._registeredMeshes.splice(i,1)},t.prototype._unbindBody=function(n){for(var i,t=0;t<this._registeredMeshes.length;t++)i=this._registeredMeshes[t],i.body===n&&(i.body=null)},t.prototype.applyImpulse=function(n,t,i){for(var r,f,u=0;u<this._registeredMeshes.length;u++)if(r=this._registeredMeshes[u],r.mesh===n||r.mesh===n.parent)return f=r.body.body.massInfo.mass,void r.body.body.applyImpulse(i.scale(OIMO.INV_SCALE),t.scale(OIMO.INV_SCALE*f))},t.prototype.createLink=function(n,t,i,r,u){for(var f,e=null,o=null,s=0;s<this._registeredMeshes.length;s++)f=this._registeredMeshes[s],f.mesh===n?e=f.body.body:f.mesh===t&&(o=f.body.body);return e&&o?(u||(u={}),new OIMO.Link({type:u.type,body1:e,body2:o,min:u.min,max:u.max,axe1:u.axe1,axe2:u.axe2,pos1:[i.x,i.y,i.z],pos2:[r.x,r.y,r.z],collision:u.collision,spring:u.spring,world:this._world}),!0):!1},t.prototype.dispose=function(){for(this._world.clear();this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==OIMO},t.prototype._getLastShape=function(n){for(var t=n.shapes;t.next;)t=t.next;return t},t.prototype.runOneStep=function(){var o,r,e,i;for(this._world.step(),r=this._registeredMeshes.length;r--;){var u=this._registeredMeshes[r].body.body,t=this._registeredMeshes[r].mesh,f=this._registeredMeshes[r].delta;if(!u.sleeping)if(u.shapes.next)e=this._getLastShape(u),t.position.x=e.position.x*OIMO.WORLD_SCALE,t.position.y=e.position.y*OIMO.WORLD_SCALE,t.position.z=e.position.z*OIMO.WORLD_SCALE,i=n.Matrix.FromArray(u.getMatrix()),t.rotationQuaternion||(t.rotationQuaternion=new n.Quaternion(0,0,0,1)),t.rotationQuaternion.fromRotationMatrix(i);else{o=u.getMatrix();i=n.Matrix.FromArray(o);var s=i.m[12],h=i.m[13],c=i.m[14];f?(t.position.x=s+f.x,t.position.y=h+f.y,t.position.z=c+f.z):(t.position.x=s,t.position.y=h,t.position.z=c);t.rotationQuaternion||(t.rotationQuaternion=new n.Quaternion(0,0,0,1));t.rotationQuaternion.fromRotationMatrix(i)}}},t}();n.OimoJSPlugin=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t){this._currentPlugin=t||new n.OimoJSPlugin}return t.prototype._initialize=function(n){this._currentPlugin.initialize();this._setGravity(n)},t.prototype._runOneStep=function(n){n>.1?n=.1:0>=n&&(n=1/60);this._currentPlugin.runOneStep(n)},t.prototype._setGravity=function(t){this.gravity=t||new n.Vector3(0,-9.82,0);this._currentPlugin.setGravity(this.gravity)},t.prototype._registerMesh=function(n,t,i){return this._currentPlugin.registerMesh(n,t,i)},t.prototype._registerMeshesAsCompound=function(n,t){return this._currentPlugin.registerMeshesAsCompound(n,t)},t.prototype._unregisterMesh=function(n){this._currentPlugin.unregisterMesh(n)},t.prototype._applyImpulse=function(n,t,i){this._currentPlugin.applyImpulse(n,t,i)},t.prototype._createLink=function(n,t,i,r,u){return this._currentPlugin.createLink(n,t,i,r,u)},t.prototype._updateBodyPosition=function(n){this._currentPlugin.updateBodyPosition(n)},t.prototype.dispose=function(){this._currentPlugin.dispose()},t.prototype.isSupported=function(){return this._currentPlugin.isSupported()},t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CapsuleImpostor=5,t.ConeImpostor=6,t.CylinderImpostor=7,t.ConvexHullImpostor=8,t.Epsilon=.001,t}();n.PhysicsEngine=t}(BABYLON||(BABYLON={}));!function(n){var h=function(t){var i={},u,r,f;return(i.name=t.name,i.id=t.id,i.tags=n.Tags.GetTags(t),t instanceof n.PointLight)?(i.type=0,i.position=t.position.asArray()):t instanceof n.DirectionalLight?(i.type=1,u=t,i.position=u.position.asArray(),i.direction=u.direction.asArray()):t instanceof n.SpotLight?(i.type=2,r=t,i.position=r.position.asArray(),i.direction=r.position.asArray(),i.angle=r.angle,i.exponent=r.exponent):t instanceof n.HemisphericLight&&(i.type=3,f=t,i.direction=f.direction.asArray(),i.groundColor=f.groundColor.asArray()),t.intensity&&(i.intensity=t.intensity),i.range=t.range,i.diffuse=t.diffuse.asArray(),i.specular=t.specular.asArray(),i},r=function(n){var t={};return t.isEnabled=n.isEnabled,t.leftColor=n.leftColor,t.rightColor=n.rightColor,t.bias=n.bias,t.power=n.power,t},c=function(t){var i={};return i.name=t.name,i.tags=n.Tags.GetTags(t),i.id=t.id,i.position=t.position.asArray(),t.parent&&(i.parentId=t.parent.id),i.rotation=t.rotation.asArray(),t.lockedTarget&&t.lockedTarget.id&&(i.lockedTargetId=t.lockedTarget.id),i.fov=t.fov,i.minZ=t.minZ,i.maxZ=t.maxZ,i.speed=t.speed,i.inertia=t.inertia,i.checkCollisions=t.checkCollisions,i.applyGravity=t.applyGravity,t.ellipsoid&&(i.ellipsoid=t.ellipsoid.asArray()),u(t,i),i.layerMask=t.layerMask,i},u=function(n,t){var i,r;if(n.animations)for(t.animations=[],i=0;i<n.animations.length;i++)r=n.animations[i],t.animations.push(e(r))},e=function(t){var i={},o,e,u,f,r;for(i.name=t.name,i.property=t.targetProperty,i.framePerSecond=t.framePerSecond,i.dataType=t.dataType,i.loopBehavior=t.loopMode,o=t.dataType,i.keys=[],e=t.getKeys(),u=0;u<e.length;u++){f=e[u];r={};switch(r.frame=f.frame,o){case n.Animation.ANIMATIONTYPE_FLOAT:r.values=[f.value];break;case n.Animation.ANIMATIONTYPE_QUATERNION:case n.Animation.ANIMATIONTYPE_MATRIX:case n.Animation.ANIMATIONTYPE_VECTOR3:r.values=f.value.asArray()}i.keys.push(r)}return i},l=function(t){var i={},r,u;for(i.name=t.name,i.id=t.id,i.tags=n.Tags.GetTags(t),i.materials=[],r=0;r<t.subMaterials.length;r++)u=t.subMaterials[r],i.materials.push(u?u.id:null);return i},a=function(i){var u={};return u.name=i.name,u.ambient=i.ambientColor.asArray(),u.diffuse=i.diffuseColor.asArray(),u.specular=i.specularColor.asArray(),u.specularPower=i.specularPower,u.emissive=i.emissiveColor.asArray(),u.alpha=i.alpha,u.id=i.id,u.tags=n.Tags.GetTags(i),u.backFaceCulling=i.backFaceCulling,i.diffuseTexture&&(u.diffuseTexture=t(i.diffuseTexture)),i.diffuseFresnelParameters&&(u.diffuseFresnelParameters=r(i.diffuseFresnelParameters)),i.ambientTexture&&(u.ambientTexture=t(i.ambientTexture)),i.opacityTexture&&(u.opacityTexture=t(i.opacityTexture)),i.opacityFresnelParameters&&(u.opacityFresnelParameters=r(i.opacityFresnelParameters)),i.reflectionTexture&&(u.reflectionTexture=t(i.reflectionTexture)),i.reflectionFresnelParameters&&(u.reflectionFresnelParameters=r(i.reflectionFresnelParameters)),i.emissiveTexture&&(u.emissiveTexture=t(i.emissiveTexture)),i.emissiveFresnelParameters&&(u.emissiveFresnelParameters=r(i.emissiveFresnelParameters)),i.specularTexture&&(u.specularTexture=t(i.specularTexture)),i.bumpTexture&&(u.bumpTexture=t(i.bumpTexture)),u},t=function(t){var i={},e,r,o,f;if(!t.name)return null;if(t instanceof n.CubeTexture)return i.name=t.name,i.hasAlpha=t.hasAlpha,i.level=t.level,i.coordinatesMode=t.coordinatesMode,i;if(t instanceof n.MirrorTexture){for(e=t,i.renderTargetSize=e.getRenderSize(),i.renderList=[],r=0;r<e.renderList.length;r++)i.renderList.push(e.renderList[r].id);i.mirrorPlane=e.mirrorPlane.asArray()}else if(t instanceof n.RenderTargetTexture)for(o=t,i.renderTargetSize=o.getRenderSize(),i.renderList=[],r=0;r<o.renderList.length;r++)i.renderList.push(o.renderList[r].id);return f=t,i.name=t.name,i.hasAlpha=t.hasAlpha,i.level=t.level,i.coordinatesIndex=t.coordinatesIndex,i.coordinatesMode=t.coordinatesMode,i.uOffset=f.uOffset,i.vOffset=f.vOffset,i.uScale=f.uScale,i.vScale=f.vScale,i.uAng=f.uAng,i.vAng=f.vAng,i.wAng=f.wAng,i.wrapU=t.wrapU,i.wrapV=t.wrapV,u(t,i),i},v=function(n){var i={},r,t,u;for(i.name=n.name,i.id=n.id,i.bones=[],r=0;r<n.bones.length;r++)t=n.bones[r],u={parentBoneIndex:t.getParent()?n.bones.indexOf(t.getParent()):-1,name:t.name,matrix:t.getLocalMatrix().toArray()},i.bones.push(u),t.animations&&t.animations.length>0&&(u.animation=e(t.animations[0]));return i},y=function(n){var t={};return t.emitterId=n.emitter.id,t.capacity=n.getCapacity(),n.particleTexture&&(t.textureName=n.particleTexture.name),t.minAngularSpeed=n.minAngularSpeed,t.maxAngularSpeed=n.maxAngularSpeed,t.minSize=n.minSize,t.maxSize=n.maxSize,t.minLifeTime=n.minLifeTime,t.maxLifeTime=n.maxLifeTime,t.emitRate=n.emitRate,t.minEmitBox=n.minEmitBox.asArray(),t.maxEmitBox=n.maxEmitBox.asArray(),t.gravity=n.gravity.asArray(),t.direction1=n.direction1.asArray(),t.direction2=n.direction2.asArray(),t.color1=n.color1.asArray(),t.color2=n.color2.asArray(),t.colorDead=n.colorDead.asArray(),t.updateSpeed=n.updateSpeed,t.targetStopDuration=n.targetStopDuration,t.textureMask=n.textureMask.asArray(),t.blendMode=n.blendMode,t},p=function(t){var i={},u,r;for(i.emitterId=t.getEmitter().id,i.borderLimit=t.borderLimit,i.flares=[],u=0;u<t.lensFlares.length;u++)r=t.lensFlares[u],i.flares.push({size:r.size,position:r.position,color:r.color.asArray(),textureName:n.Tools.GetFilename(r.texture.name)});return i},w=function(n){var t={},i=n.getShadowGenerator(),r,u;for(t.lightId=n.id,t.mapSize=i.getShadowMap().getRenderSize(),t.useVarianceShadowMap=i.useVarianceShadowMap,t.usePoissonSampling=i.usePoissonSampling,t.renderList=[],r=0;r<i.getShadowMap().renderList.length;r++)u=i.getShadowMap().renderList[r],t.renderList.push(u.id);return t},f=[],o=function(t,i){if(!f[t.id]){if(t instanceof n.Geometry.Primitives.Box)i.boxes.push(k(t));else if(t instanceof n.Geometry.Primitives.Sphere)i.spheres.push(d(t));else if(t instanceof n.Geometry.Primitives.Cylinder)i.cylinders.push(g(t));else if(t instanceof n.Geometry.Primitives.Torus)i.toruses.push(nt(t));else if(t instanceof n.Geometry.Primitives.Ground)i.grounds.push(tt(t));else if(t instanceof n.Geometry.Primitives.Plane)i.planes.push(it(t));else if(t instanceof n.Geometry.Primitives.TorusKnot)i.torusKnots.push(rt(t));else{if(t instanceof n.Geometry.Primitives._Primitive)throw new Error("Unknow primitive type");i.vertexData.push(b(t))}f[t.id]=!0}},s=function(t){var i={};return i.id=t.id,n.Tags.HasTags(t)&&(i.tags=n.Tags.GetTags(t)),i},b=function(t){var i=s(t);return t.isVerticesDataPresent(n.VertexBuffer.PositionKind)&&(i.positions=t.getVerticesData(n.VertexBuffer.PositionKind)),t.isVerticesDataPresent(n.VertexBuffer.NormalKind)&&(i.normals=t.getVerticesData(n.VertexBuffer.NormalKind)),t.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(i.uvs=t.getVerticesData(n.VertexBuffer.UVKind)),t.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(i.uvs2=t.getVerticesData(n.VertexBuffer.UV2Kind)),t.isVerticesDataPresent(n.VertexBuffer.ColorKind)&&(i.colors=t.getVerticesData(n.VertexBuffer.ColorKind)),t.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&(i.matricesIndices=t.getVerticesData(n.VertexBuffer.MatricesIndicesKind),i.matricesIndices._isExpanded=!0),t.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(i.matricesWeights=t.getVerticesData(n.VertexBuffer.MatricesWeightsKind)),i.indices=t.getIndices(),i},i=function(n){var t=s(n);return t.canBeRegenerated=n.canBeRegenerated(),t},k=function(n){var t=i(n);return t.size=n.size,t},d=function(n){var t=i(n);return t.segments=n.segments,t.diameter=n.diameter,t},g=function(n){var t=i(n);return t.height=n.height,t.diameterTop=n.diameterTop,t.diameterBottom=n.diameterBottom,t.tessellation=n.tessellation,t},nt=function(n){var t=i(n);return t.diameter=n.diameter,t.thickness=n.thickness,t.tessellation=n.tessellation,t},tt=function(n){var t=i(n);return t.width=n.width,t.height=n.height,t.subdivisions=n.subdivisions,t},it=function(n){var t=i(n);return t.size=n.size,t},rt=function(n){var t=i(n);return t.radius=n.radius,t.tube=n.tube,t.radialSegments=n.radialSegments,t.tubularSegments=n.tubularSegments,t.p=n.p,t.q=n.q,t},ut=function(t,i){var r={},s,l,h,e,c,f,a;if(r.name=t.name,r.id=t.id,n.Tags.HasTags(t)&&(r.tags=n.Tags.GetTags(t)),r.position=t.position.asArray(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(r.rotation=t.rotation.asArray()),r.scaling=t.scaling.asArray(),r.localMatrix=t.getPivotMatrix().asArray(),r.isEnabled=t.isEnabled(),r.isVisible=t.isVisible,r.infiniteDistance=t.infiniteDistance,r.pickable=t.isPickable,r.receiveShadows=t.receiveShadows,r.billboardMode=t.billboardMode,r.visibility=t.visibility,r.checkCollisions=t.checkCollisions,t.parent&&(r.parentId=t.parent.id),s=t._geometry,s)for(l=s.id,r.geometryId=l,t.getScene().getGeometryByID(l)||o(s,i.geometries),r.subMeshes=[],h=0;h<t.subMeshes.length;h++)e=t.subMeshes[h],r.subMeshes.push({materialIndex:e.materialIndex,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount});if(t.material?r.materialId=t.material.id:t.material=null,t.skeleton&&(r.skeletonId=t.skeleton.id),t.getPhysicsImpostor()!==n.PhysicsEngine.NoImpostor)switch(r.physicsMass=t.getPhysicsMass(),r.physicsFriction=t.getPhysicsFriction(),r.physicsRestitution=t.getPhysicsRestitution(),t.getPhysicsImpostor()){case n.PhysicsEngine.BoxImpostor:r.physicsImpostor=1;break;case n.PhysicsEngine.SphereImpostor:r.physicsImpostor=2}for(r.instances=[],c=0;c<t.instances.length;c++)f=t.instances[c],a={name:f.name,position:f.position,rotation:f.rotation,rotationQuaternion:f.rotationQuaternion,scaling:f.scaling},r.instances.push(a),u(f,a);return u(t,r),r.layerMask=t.layerMask,r},ft=function(){function t(){}return t.Serialize=function(t){var i={},u,b,e,k,r,d,g,s;for(i.useDelayedTextureLoading=t.useDelayedTextureLoading,i.autoClear=t.autoClear,i.clearColor=t.clearColor.asArray(),i.ambientColor=t.ambientColor.asArray(),i.gravity=t.gravity.asArray(),t.fogMode&&0!==t.fogMode&&(i.fogMode=t.fogMode,i.fogColor=t.fogColor.asArray(),i.fogStart=t.fogStart,i.fogEnd=t.fogEnd,i.fogDensity=t.fogDensity),i.lights=[],r=0;r<t.lights.length;r++)u=t.lights[r],i.lights.push(h(u));for(i.cameras=[],r=0;r<t.cameras.length;r++)b=t.cameras[r],b instanceof n.FreeCamera&&i.cameras.push(c(b));for(t.activeCamera&&(i.activeCameraID=t.activeCamera.id),i.materials=[],i.multiMaterials=[],r=0;r<t.materials.length;r++)e=t.materials[r],e instanceof n.StandardMaterial?i.materials.push(a(e)):e instanceof n.MultiMaterial&&i.multiMaterials.push(l(e));for(i.skeletons=[],r=0;r<t.skeletons.length;r++)i.skeletons.push(v(t.skeletons[r]));for(i.geometries={},i.geometries.boxes=[],i.geometries.spheres=[],i.geometries.cylinders=[],i.geometries.toruses=[],i.geometries.grounds=[],i.geometries.planes=[],i.geometries.torusKnots=[],i.geometries.vertexData=[],f=[],k=t.getGeometries(),r=0;r<k.length;r++)d=k[r],d.isReady()&&o(d,i.geometries);for(i.meshes=[],r=0;r<t.meshes.length;r++)g=t.meshes[r],g instanceof n.Mesh&&(s=g,(s.delayLoadState===n.Engine.DELAYLOADSTATE_LOADED||s.delayLoadState===n.Engine.DELAYLOADSTATE_NONE)&&i.meshes.push(ut(s,i)));for(i.particleSystems=[],r=0;r<t.particleSystems.length;r++)i.particleSystems.push(y(t.particleSystems[r]));for(i.lensFlareSystems=[],r=0;r<t.lensFlareSystems.length;r++)i.lensFlareSystems.push(p(t.lensFlareSystems[r]));for(i.shadowGenerators=[],r=0;r<t.lights.length;r++)u=t.lights[r],u.getShadowGenerator()&&i.shadowGenerators.push(w(u));return i},t}();n.SceneSerializer=ft}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){}return Object.defineProperty(t,"ForceFullSceneLoadingForIncremental",{get:function(){return t._ForceFullSceneLoadingForIncremental},set:function(n){t._ForceFullSceneLoadingForIncremental=n},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ShowLoadingScreen",{get:function(){return t._ShowLoadingScreen},set:function(n){t._ShowLoadingScreen=n},enumerable:!0,configurable:!0}),t._getPluginForFilename=function(n){for(var i,r=n.lastIndexOf("."),u=n.substring(r).toLowerCase(),t=0;t<this._registeredPlugins.length;t++)if(i=this._registeredPlugins[t],-1!==i.extensions.indexOf(u))return i;return this._registeredPlugins[this._registeredPlugins.length-1]},t.RegisterPlugin=function(n){n.extensions=n.extensions.toLowerCase();t._registeredPlugins.push(n)},t.ImportMesh=function(t,i,r,u,f,e,o){var h=this,c=function(){u.database=s;var l=h._getPluginForFilename(r),c=function(n){var e=[],s=[],h=[];try{if(!l.importMesh(t,u,n,i,e,s,h))return void(o&&o(u))}catch(c){return void(o&&o(u))}f&&(u.importedMeshesFiles.push(i+r),f(e,s,h))};return r.substr&&"data:"===r.substr(0,5)?void c(r.substr(5)):void n.Tools.LoadFile(i+r,function(n){c(n)},e,s)},s=new n.Database(i+r,c)},t.Load=function(i,r,u,f,e,o){t.Append(i,r,new n.Scene(u),f,e,o)},t.Append=function(i,r,u,f,e,o){var h,l=this._getPluginForFilename(r.name||r),s,c;return t.ShowLoadingScreen&&u.getEngine().displayLoadingUI(),s=function(n){return u.database=h,l.load(u,n,i)?(f&&f(u),void(t.ShowLoadingScreen&&u.executeWhenReady(function(){u.getEngine().hideLoadingUI()}))):(o&&o(u),void u.getEngine().hideLoadingUI())},c=function(){n.Tools.LoadFile(i+r,s,e,h)},r.substr&&"data:"===r.substr(0,5)?void s(r.substr(5)):void(-1===i.indexOf("file:")?h=new n.Database(i+r,c):n.Tools.ReadFile(r,s,e))},t._ForceFullSceneLoadingForIncremental=!1,t._ShowLoadingScreen=!0,t._registeredPlugins=[],t}();n.SceneLoader=t}(BABYLON||(BABYLON={}));!function(n){!function(){var v=function(t,i,r){var u=new n.CubeTexture(t+i.name,r);return u.name=i.name,u.hasAlpha=i.hasAlpha,u.level=i.level,u.coordinatesMode=i.coordinatesMode,u},i=function(t,i,u){var f,e,o;if(!i.name&&!i.isRenderTarget)return null;if(i.isCube)return v(t,i,u);if(i.mirrorPlane?(f=new n.MirrorTexture(i.name,i.renderTargetSize,u),f._waitingRenderList=i.renderList,f.mirrorPlane=n.Plane.FromArray(i.mirrorPlane)):i.isRenderTarget?(f=new n.RenderTargetTexture(i.name,i.renderTargetSize,u),f._waitingRenderList=i.renderList):f=new n.Texture(t+i.name,u),f.name=i.name,f.hasAlpha=i.hasAlpha,f.getAlphaFromRGB=i.getAlphaFromRGB,f.level=i.level,f.coordinatesIndex=i.coordinatesIndex,f.coordinatesMode=i.coordinatesMode,f.uOffset=i.uOffset,f.vOffset=i.vOffset,f.uScale=i.uScale,f.vScale=i.vScale,f.uAng=i.uAng,f.vAng=i.vAng,f.wAng=i.wAng,f.wrapU=i.wrapU,f.wrapV=i.wrapV,i.animations)for(e=0;e<i.animations.length;e++)o=i.animations[e],f.animations.push(r(o));return f},f=function(t,i){for(var u,o,s,f=new n.Skeleton(t.name,t.id,i),e=0;e<t.bones.length;e++)u=t.bones[e],o=null,u.parentBoneIndex>-1&&(o=f.bones[u.parentBoneIndex]),s=new n.Bone(u.name,f,o,n.Matrix.FromArray(u.matrix)),u.animation&&s.animations.push(r(u.animation));return f},u=function(t){var i=new n.FresnelParameters;return i.isEnabled=t.isEnabled,i.leftColor=n.Color3.FromArray(t.leftColor),i.rightColor=n.Color3.FromArray(t.rightColor),i.bias=t.bias,i.power=t.power||1,i},e=function(t,r,f){var e;return e=new n.StandardMaterial(t.name,r),e.ambientColor=n.Color3.FromArray(t.ambient),e.diffuseColor=n.Color3.FromArray(t.diffuse),e.specularColor=n.Color3.FromArray(t.specular),e.specularPower=t.specularPower,e.emissiveColor=n.Color3.FromArray(t.emissive),e.alpha=t.alpha,e.id=t.id,n.Tags.AddTagsTo(e,t.tags),e.backFaceCulling=t.backFaceCulling,e.wireframe=t.wireframe,t.diffuseTexture&&(e.diffuseTexture=i(f,t.diffuseTexture,r)),t.diffuseFresnelParameters&&(e.diffuseFresnelParameters=u(t.diffuseFresnelParameters)),t.ambientTexture&&(e.ambientTexture=i(f,t.ambientTexture,r)),t.opacityTexture&&(e.opacityTexture=i(f,t.opacityTexture,r)),t.opacityFresnelParameters&&(e.opacityFresnelParameters=u(t.opacityFresnelParameters)),t.reflectionTexture&&(e.reflectionTexture=i(f,t.reflectionTexture,r)),t.reflectionFresnelParameters&&(e.reflectionFresnelParameters=u(t.reflectionFresnelParameters)),t.emissiveTexture&&(e.emissiveTexture=i(f,t.emissiveTexture,r)),t.emissiveFresnelParameters&&(e.emissiveFresnelParameters=u(t.emissiveFresnelParameters)),t.specularTexture&&(e.specularTexture=i(f,t.specularTexture,r)),t.bumpTexture&&(e.bumpTexture=i(f,t.bumpTexture,r)),e},o=function(n,t,i,r){for(var f,u=0;u<t.materials.length;u++)if(f=t.materials[u],f.id===n)return e(f,i,r);return null},s=function(t,i){var r=new n.MultiMaterial(t.name,i),u,f;for(r.id=t.id,n.Tags.AddTagsTo(r,t.tags),u=0;u<t.materials.length;u++)f=t.materials[u],r.subMaterials.push(f?i.getMaterialByID(f):null);return r},y=function(t,i,r){var o=i.getLastEntryByID(t.emitterId),e=new n.LensFlareSystem("lensFlareSystem#"+t.emitterId,o,i),f,u;for(e.borderLimit=t.borderLimit,f=0;f<t.flares.length;f++)u=t.flares[f],new n.LensFlare(u.size,u.position,n.Color3.FromArray(u.color),r+u.textureName,e);return e},h=function(t,i,r){var f=i.getLastMeshByID(t.emitterId),u=new n.ParticleSystem("particles#"+f.name,t.capacity,i);return t.textureName&&(u.particleTexture=new n.Texture(r+t.textureName,i),u.particleTexture.name=t.textureName),u.minAngularSpeed=t.minAngularSpeed,u.maxAngularSpeed=t.maxAngularSpeed,u.minSize=t.minSize,u.maxSize=t.maxSize,u.minLifeTime=t.minLifeTime,u.maxLifeTime=t.maxLifeTime,u.emitter=f,u.emitRate=t.emitRate,u.minEmitBox=n.Vector3.FromArray(t.minEmitBox),u.maxEmitBox=n.Vector3.FromArray(t.maxEmitBox),u.gravity=n.Vector3.FromArray(t.gravity),u.direction1=n.Vector3.FromArray(t.direction1),u.direction2=n.Vector3.FromArray(t.direction2),u.color1=n.Color4.FromArray(t.color1),u.color2=n.Color4.FromArray(t.color2),u.colorDead=n.Color4.FromArray(t.colorDead),u.updateSpeed=t.updateSpeed,u.targetStopDuration=t.targetStopFrame,u.textureMask=n.Color4.FromArray(t.textureMask),u.blendMode=t.blendMode,u.start(),u},p=function(t,i){for(var f,e=i.getLightByID(t.lightId),r=new n.ShadowGenerator(t.mapSize,e),u=0;u<t.renderList.length;u++)f=i.getMeshByID(t.renderList[u]),r.getShadowMap().renderList.push(f);return t.usePoissonSampling?r.usePoissonSampling=!0:r.useVarianceShadowMap=t.useVarianceShadowMap,r},r=function(t){for(var r,i,f=new n.Animation(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),o=t.dataType,e=[],u=0;u<t.keys.length;u++){i=t.keys[u];switch(o){case n.Animation.ANIMATIONTYPE_FLOAT:r=i.values[0];break;case n.Animation.ANIMATIONTYPE_QUATERNION:r=n.Quaternion.FromArray(i.values);break;case n.Animation.ANIMATIONTYPE_MATRIX:r=n.Matrix.FromArray(i.values);break;case n.Animation.ANIMATIONTYPE_VECTOR3:default:r=n.Vector3.FromArray(i.values)}e.push({frame:i.frame,value:r})}return f.setKeys(e),f},w=function(t,i){var u,f,e;switch(t.type){case 0:u=new n.PointLight(t.name,n.Vector3.FromArray(t.position),i);break;case 1:u=new n.DirectionalLight(t.name,n.Vector3.FromArray(t.direction),i);u.position=n.Vector3.FromArray(t.position);break;case 2:u=new n.SpotLight(t.name,n.Vector3.FromArray(t.position),n.Vector3.FromArray(t.direction),t.angle,t.exponent,i);break;case 3:u=new n.HemisphericLight(t.name,n.Vector3.FromArray(t.direction),i);u.groundColor=n.Color3.FromArray(t.groundColor)}if(u.id=t.id,n.Tags.AddTagsTo(u,t.tags),void 0!==t.intensity&&(u.intensity=t.intensity),t.range&&(u.range=t.range),u.diffuse=n.Color3.FromArray(t.diffuse),u.specular=n.Color3.FromArray(t.specular),t.excludedMeshesIds&&(u._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(u._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.animations)for(f=0;f<t.animations.length;f++)e=t.animations[f],u.animations.push(r(e));t.autoAnimate&&i.beginAnimation(u,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1)},b=function(t,i){var u,f=n.Vector3.FromArray(t.position),e=t.lockedTargetId?i.getLastMeshByID(t.lockedTargetId):null,o,s,a;if("AnaglyphArcRotateCamera"===t.type||"ArcRotateCamera"===t.type){var h=t.alpha,c=t.beta,l=t.radius;"AnaglyphArcRotateCamera"===t.type?(o=t.eye_space,u=new n.AnaglyphArcRotateCamera(t.name,h,c,l,e,o,i)):u=new n.ArcRotateCamera(t.name,h,c,l,e,i)}else"AnaglyphFreeCamera"===t.type?(o=t.eye_space,u=new n.AnaglyphFreeCamera(t.name,f,o,i)):"DeviceOrientationCamera"===t.type?u=new n.DeviceOrientationCamera(t.name,f,i):"FollowCamera"===t.type?(u=new n.FollowCamera(t.name,f,i),u.heightOffset=t.heightOffset,u.radius=t.radius,u.rotationOffset=t.rotationOffset,e&&(u.target=e)):u="GamepadCamera"===t.type?new n.GamepadCamera(t.name,f,i):"OculusCamera"===t.type?new n.OculusCamera(t.name,f,i):"TouchCamera"===t.type?new n.TouchCamera(t.name,f,i):"VirtualJoysticksCamera"===t.type?new n.VirtualJoysticksCamera(t.name,f,i):"WebVRCamera"===t.type?new n.WebVRCamera(t.name,f,i):"VRDeviceOrientationCamera"===t.type?new n.VRDeviceOrientationCamera(t.name,f,i):new n.FreeCamera(t.name,f,i);if(e&&u instanceof n.FreeCamera&&(u.lockedTarget=e),u.id=t.id,n.Tags.AddTagsTo(u,t.tags),t.parentId&&(u._waitingParentId=t.parentId),t.target?u.setTarget(n.Vector3.FromArray(t.target)):u.rotation=n.Vector3.FromArray(t.rotation),u.fov=t.fov,u.minZ=t.minZ,u.maxZ=t.maxZ,u.speed=t.speed,u.inertia=t.inertia,u.checkCollisions=t.checkCollisions,u.applyGravity=t.applyGravity,t.ellipsoid&&(u.ellipsoid=n.Vector3.FromArray(t.ellipsoid)),t.animations)for(s=0;s<t.animations.length;s++)a=t.animations[s],u.animations.push(r(a));return t.autoAnimate&&i.beginAnimation(u,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),u.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):4294967295,u},t=function(n,t){var i=n.id;return t.getGeometryByID(i)},k=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Box(i.id,r,i.size,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},d=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Sphere(i.id,r,i.segments,i.diameter,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},g=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Cylinder(i.id,r,i.height,i.diameterTop,i.diameterBottom,i.tessellation,i.subdivisions,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},nt=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Torus(i.id,r,i.diameter,i.thickness,i.tessellation,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},tt=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Ground(i.id,r,i.width,i.height,i.subdivisions,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},it=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.Plane(i.id,r,i.size,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},rt=function(i,r){if(t(i,r))return null;var u=new n.Geometry.Primitives.TorusKnot(i.id,r,i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.canBeRegenerated,null);return n.Tags.AddTagsTo(u,i.tags),r.pushGeometry(u,!0),u},ut=function(i,r,u){if(t(i,r))return null;var f=new n.Geometry(i.id,r);return n.Tags.AddTagsTo(f,i.tags),i.delayLoadingFile?(f.delayLoadState=n.Engine.DELAYLOADSTATE_NOTLOADED,f.delayLoadingFile=u+i.delayLoadingFile,f._boundingInfo=new n.BoundingInfo(n.Vector3.FromArray(i.boundingBoxMinimum),n.Vector3.FromArray(i.boundingBoxMaximum)),f._delayInfo=[],i.hasUVs&&f._delayInfo.push(n.VertexBuffer.UVKind),i.hasUVs2&&f._delayInfo.push(n.VertexBuffer.UV2Kind),i.hasColors&&f._delayInfo.push(n.VertexBuffer.ColorKind),i.hasMatricesIndices&&f._delayInfo.push(n.VertexBuffer.MatricesIndicesKind),i.hasMatricesWeights&&f._delayInfo.push(n.VertexBuffer.MatricesWeightsKind),f._delayLoadingFunction=l):l(i,f),r.pushGeometry(f,!0),f},c=function(t,i,u){var f=new n.Mesh(t.name,i),o,h,c,e,s;if(f.id=t.id,n.Tags.AddTagsTo(f,t.tags),f.position=n.Vector3.FromArray(t.position),t.rotationQuaternion?f.rotationQuaternion=n.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(f.rotation=n.Vector3.FromArray(t.rotation)),f.scaling=n.Vector3.FromArray(t.scaling),t.localMatrix?f.setPivotMatrix(n.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&f.setPivotMatrix(n.Matrix.FromArray(t.pivotMatrix)),f.setEnabled(t.isEnabled),f.isVisible=t.isVisible,f.infiniteDistance=t.infiniteDistance,f.showBoundingBox=t.showBoundingBox,f.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.pickable&&(f.isPickable=t.pickable),f.receiveShadows=t.receiveShadows,f.billboardMode=t.billboardMode,void 0!==t.visibility&&(f.visibility=t.visibility),f.checkCollisions=t.checkCollisions,f._shouldGenerateFlatShading=t.useFlatShading,t.parentId&&(f._waitingParentId=t.parentId),t.delayLoadingFile?(f.delayLoadState=n.Engine.DELAYLOADSTATE_NOTLOADED,f.delayLoadingFile=u+t.delayLoadingFile,f._boundingInfo=new n.BoundingInfo(n.Vector3.FromArray(t.boundingBoxMinimum),n.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(f._binaryInfo=t._binaryInfo),f._delayInfo=[],t.hasUVs&&f._delayInfo.push(n.VertexBuffer.UVKind),t.hasUVs2&&f._delayInfo.push(n.VertexBuffer.UV2Kind),t.hasColors&&f._delayInfo.push(n.VertexBuffer.ColorKind),t.hasMatricesIndices&&f._delayInfo.push(n.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&f._delayInfo.push(n.VertexBuffer.MatricesWeightsKind),f._delayLoadingFunction=a,n.SceneLoader.ForceFullSceneLoadingForIncremental&&f._checkDelayState()):a(t,f),t.materialId?f.setMaterialByID(t.materialId):f.material=null,t.skeletonId>-1&&(f.skeleton=i.getLastSkeletonByID(t.skeletonId)),t.physicsImpostor&&(i.isPhysicsEnabled()||i.enablePhysics(),f.setPhysicsState({impostor:t.physicsImpostor,mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution})),t.animations)for(o=0;o<t.animations.length;o++)h=t.animations[o],f.animations.push(r(h));if(t.autoAnimate&&i.beginAnimation(f,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),f.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):4294967295,t.instances)for(c=0;c<t.instances.length;c++)if(e=t.instances[c],s=f.createInstance(e.name),n.Tags.AddTagsTo(s,e.tags),s.position=n.Vector3.FromArray(e.position),e.rotationQuaternion?s.rotationQuaternion=n.Quaternion.FromArray(e.rotationQuaternion):e.rotation&&(s.rotation=n.Vector3.FromArray(e.rotation)),s.scaling=n.Vector3.FromArray(e.scaling),s.checkCollisions=f.checkCollisions,t.animations)for(o=0;o<t.animations.length;o++)h=t.animations[o],s.animations.push(r(h));return f},ft=function(n,t,i){t=t instanceof Array?t:[t];for(var r in t)if(n.name===t[r])return i.push(n.id),!0;return n.parentId&&-1!==i.indexOf(n.parentId)?(i.push(n.id),!0):!1},l=function(t,i){var r=new n.VertexData,l=t.positions,u,f,e,o,s,h,c;l&&r.set(l,n.VertexBuffer.PositionKind);u=t.normals;u&&r.set(u,n.VertexBuffer.NormalKind);f=t.uvs;f&&r.set(f,n.VertexBuffer.UVKind);e=t.uv2s;e&&r.set(e,n.VertexBuffer.UV2Kind);o=t.colors;o&&r.set(o,n.VertexBuffer.ColorKind);s=t.matricesIndices;s&&r.set(s,n.VertexBuffer.MatricesIndicesKind);h=t.matricesWeights;h&&r.set(h,n.VertexBuffer.MatricesWeightsKind);c=t.indices;c&&(r.indices=c);i.setAllVerticesData(r,t.updatable)},a=function(t,i){var c=i.getScene(),a=t.geometryId,l,r,v,y,p,w,b,k,d,g,f,e,u,s,h,o;if(a)l=c.getGeometryByID(a),l&&l.applyToMesh(i);else{if(t instanceof ArrayBuffer){if(r=i._binaryInfo,r.positionsAttrDesc&&r.positionsAttrDesc.count>0&&(v=new Float32Array(t,r.positionsAttrDesc.offset,r.positionsAttrDesc.count),i.setVerticesData(n.VertexBuffer.PositionKind,v,!1)),r.normalsAttrDesc&&r.normalsAttrDesc.count>0&&(y=new Float32Array(t,r.normalsAttrDesc.offset,r.normalsAttrDesc.count),i.setVerticesData(n.VertexBuffer.NormalKind,y,!1)),r.uvsAttrDesc&&r.uvsAttrDesc.count>0&&(p=new Float32Array(t,r.uvsAttrDesc.offset,r.uvsAttrDesc.count),i.setVerticesData(n.VertexBuffer.UVKind,p,!1)),r.uvs2AttrDesc&&r.uvs2AttrDesc.count>0&&(w=new Float32Array(t,r.uvs2AttrDesc.offset,r.uvs2AttrDesc.count),i.setVerticesData(n.VertexBuffer.UV2Kind,w,!1)),r.colorsAttrDesc&&r.colorsAttrDesc.count>0&&(b=new Float32Array(t,r.colorsAttrDesc.offset,r.colorsAttrDesc.count),i.setVerticesData(n.VertexBuffer.ColorKind,b,!1)),r.matricesIndicesAttrDesc&&r.matricesIndicesAttrDesc.count>0&&(k=new Int32Array(t,r.matricesIndicesAttrDesc.offset,r.matricesIndicesAttrDesc.count),i.setVerticesData(n.VertexBuffer.MatricesIndicesKind,k,!1)),r.matricesWeightsAttrDesc&&r.matricesWeightsAttrDesc.count>0&&(d=new Float32Array(t,r.matricesWeightsAttrDesc.offset,r.matricesWeightsAttrDesc.count),i.setVerticesData(n.VertexBuffer.MatricesWeightsKind,d,!1)),r.indicesAttrDesc&&r.indicesAttrDesc.count>0&&(g=new Int32Array(t,r.indicesAttrDesc.offset,r.indicesAttrDesc.count),i.setIndices(g)),r.subMeshesAttrDesc&&r.subMeshesAttrDesc.count>0)for(f=new Int32Array(t,r.subMeshesAttrDesc.offset,5*r.subMeshesAttrDesc.count),i.subMeshes=[],u=0;u<r.subMeshesAttrDesc.count;u++){var nt=f[5*u+0],tt=f[5*u+1],it=f[5*u+2],rt=f[5*u+3],ut=f[5*u+4];new n.SubMesh(nt,tt,it,rt,ut,i)}return}if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(n.VertexBuffer.PositionKind,t.positions,!1),i.setVerticesData(n.VertexBuffer.NormalKind,t.normals,!1),t.uvs&&i.setVerticesData(n.VertexBuffer.UVKind,t.uvs,!1),t.uvs2&&i.setVerticesData(n.VertexBuffer.UV2Kind,t.uvs2,!1),t.colors&&i.setVerticesData(n.VertexBuffer.ColorKind,t.colors,!1),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(n.VertexBuffer.MatricesIndicesKind,t.matricesIndices,!1);else{for(e=[],u=0;u<t.matricesIndices.length;u++)s=t.matricesIndices[u],e.push(255&s),e.push((65280&s)>>8),e.push((16711680&s)>>16),e.push(s>>24);i.setVerticesData(n.VertexBuffer.MatricesIndicesKind,e,!1)}t.matricesWeights&&i.setVerticesData(n.VertexBuffer.MatricesWeightsKind,t.matricesWeights,!1);i.setIndices(t.indices)}}if(t.subMeshes)for(i.subMeshes=[],h=0;h<t.subMeshes.length;h++)o=t.subMeshes[h],new n.SubMesh(o.materialIndex,o.verticesStart,o.verticesCount,o.indexStart,o.indexCount,i);i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),delete i._shouldGenerateFlatShading);i.computeWorldMatrix(!0);c._selectionOctree&&c._selectionOctree.addMesh(i)};n.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(n,t,i,r,u,e,l){for(var a,k,d,p,g,it,ot,nt,tt,st,w,rt,v=JSON.parse(i),ut=[],b=[],et=[],y=0;y<v.meshes.length;y++)if(a=v.meshes[y],!n||ft(a,n,et)){if(n instanceof Array&&delete n[n.indexOf(a.name)],a.materialId){if(k=-1!==b.indexOf(a.materialId),!k)for(d=0;d<v.multiMaterials.length;d++)if(p=v.multiMaterials[d],p.id==a.materialId){for(g=0;g<p.materials.length;g++)it=p.materials[g],b.push(it),o(it,v,t,r);b.push(p.id);s(p,t);k=!0;break}k||(b.push(a.materialId),o(a.materialId,v,t,r))}if(a.skeletonId>-1&&t.skeletons&&(ot=ut.indexOf(a.skeletonId)>-1,!ot))for(nt=0;nt<v.skeletons.length;nt++)tt=v.skeletons[nt],tt.id===a.skeletonId&&(l.push(f(tt,t)),ut.push(tt.id));st=c(a,t,r);u.push(st)}for(y=0;y<t.meshes.length;y++)w=t.meshes[y],w._waitingParentId&&(w.parent=t.getLastEntryByID(w._waitingParentId),w._waitingParentId=void 0);if(v.particleSystems)for(y=0;y<v.particleSystems.length;y++)rt=v.particleSystems[y],-1!==et.indexOf(rt.emitterId)&&e.push(h(rt,t,r));return!0},load:function(t,i,r){var o=JSON.parse(i),u,vt,yt,pt,wt,l,ft,bt,et,kt,ot,dt,st,gt,ht,ni,ct,ti,lt,ii,at,ri,ui,fi,a,v,ei,oi,si;for(t.useDelayedTextureLoading=o.useDelayedTextureLoading&&!n.SceneLoader.ForceFullSceneLoadingForIncremental,t.autoClear=o.autoClear,t.clearColor=n.Color3.FromArray(o.clearColor),t.ambientColor=n.Color3.FromArray(o.ambientColor),t.gravity=n.Vector3.FromArray(o.gravity),o.fogMode&&0!==o.fogMode&&(t.fogMode=o.fogMode,t.fogColor=n.Color3.FromArray(o.fogColor),t.fogStart=o.fogStart,t.fogEnd=o.fogEnd,t.fogDensity=o.fogDensity),u=0;u<o.lights.length;u++)vt=o.lights[u],w(vt,t);if(o.materials)for(u=0;u<o.materials.length;u++)yt=o.materials[u],e(yt,t,r);if(o.multiMaterials)for(u=0;u<o.multiMaterials.length;u++)pt=o.multiMaterials[u],s(pt,t);if(o.skeletons)for(u=0;u<o.skeletons.length;u++)wt=o.skeletons[u],f(wt,t);if(l=o.geometries,l){if(ft=l.boxes,ft)for(u=0;u<ft.length;u++)bt=ft[u],k(bt,t);if(et=l.spheres,et)for(u=0;u<et.length;u++)kt=et[u],d(kt,t);if(ot=l.cylinders,ot)for(u=0;u<ot.length;u++)dt=ot[u],g(dt,t);if(st=l.toruses,st)for(u=0;u<st.length;u++)gt=st[u],nt(gt,t);if(ht=l.grounds,ht)for(u=0;u<ht.length;u++)ni=ht[u],tt(ni,t);if(ct=l.planes,ct)for(u=0;u<ct.length;u++)ti=ct[u],it(ti,t);if(lt=l.torusKnots,lt)for(u=0;u<lt.length;u++)ii=lt[u],rt(ii,t);if(at=l.vertexData,at)for(u=0;u<at.length;u++)ri=at[u],ut(ri,t,r)}for(u=0;u<o.meshes.length;u++)ui=o.meshes[u],c(ui,t,r);for(u=0;u<o.cameras.length;u++)fi=o.cameras[u],b(fi,t);for(o.activeCameraID&&t.setActiveCameraByID(o.activeCameraID),u=0;u<t.cameras.length;u++)a=t.cameras[u],a._waitingParentId&&(a.parent=t.getLastEntryByID(a._waitingParentId),a._waitingParentId=void 0);for(u=0;u<t.meshes.length;u++)v=t.meshes[u],v._waitingParentId&&(v.parent=t.getLastEntryByID(v._waitingParentId),v._waitingParentId=void 0);if(o.particleSystems)for(u=0;u<o.particleSystems.length;u++)ei=o.particleSystems[u],h(ei,t,r);if(o.lensFlareSystems)for(u=0;u<o.lensFlareSystems.length;u++)oi=o.lensFlareSystems[u],y(oi,t,r);if(o.shadowGenerators)for(u=0;u<o.shadowGenerators.length;u++)si=o.shadowGenerators[u],p(si,t);return!0}})}(n.Internals||(n.Internals={}));n.Internals}(BABYLON||(BABYLON={}));!function(n){var r=0,u=function(){function t(n,t,i){this.pos=n;this.normal=t;this.uv=i}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(i,r){return new t(n.Vector3.Lerp(this.pos,i.pos,r),n.Vector3.Lerp(this.normal,i.normal,r),n.Vector2.Lerp(this.uv,i.uv,r))},t}(),f=function(){function t(n,t){this.normal=n;this.w=t}return t.FromPoints=function(i,r,u){var e=u.subtract(i),o=r.subtract(i),f;return 0===e.lengthSquared()||0===o.lengthSquared()?null:(f=n.Vector3.Normalize(n.Vector3.Cross(e,o)),new t(f,n.Vector3.Dot(f,i)))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1);this.w=-this.w},t.prototype.splitPolygon=function(r,u,f,e,o){for(var l,k,a,v,d,c,g=0,w=1,y=2,nt=3,tt=0,b=[],s=0;s<r.vertices.length;s++)l=n.Vector3.Dot(this.normal,r.vertices[s].pos)-this.w,k=l<-t.EPSILON?y:l>t.EPSILON?w:g,tt|=k,b.push(k);switch(tt){case g:(n.Vector3.Dot(this.normal,r.plane.normal)>0?u:f).push(r);break;case w:e.push(r);break;case y:o.push(r);break;case nt:for(a=[],v=[],s=0;s<r.vertices.length;s++){var it=(s+1)%r.vertices.length,p=b[s],ut=b[it],h=r.vertices[s],rt=r.vertices[it];(p!=y&&a.push(h),p!=w&&v.push(p!=y?h.clone():h),(p|ut)==nt)&&(l=(this.w-n.Vector3.Dot(this.normal,h.pos))/n.Vector3.Dot(this.normal,rt.pos.subtract(h.pos)),d=h.interpolate(rt,l),a.push(d),v.push(d.clone()))}a.length>=3&&(c=new i(a,r.shared),c.plane&&e.push(c));v.length>=3&&(c=new i(v,r.shared),c.plane&&o.push(c))}},t.EPSILON=1e-5,t}(),i=function(){function n(n,t){this.vertices=n;this.shared=t;this.plane=f.FromPoints(n[0].pos,n[1].pos,n[2].pos)}return n.prototype.clone=function(){var t=this.vertices.map(function(n){return n.clone()});return new n(t,this.shared)},n.prototype.flip=function(){this.vertices.reverse().map(function(n){n.flip()});this.plane.flip()},n}(),t=function(){function n(n){this.plane=null;this.front=null;this.back=null;this.polygons=[];n&&this.build(n)}return n.prototype.clone=function(){var t=new n;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(n){return n.clone()}),t},n.prototype.invert=function(){for(var t,n=0;n<this.polygons.length;n++)this.polygons[n].flip();this.plane&&this.plane.flip();this.front&&this.front.invert();this.back&&this.back.invert();t=this.front;this.front=this.back;this.back=t},n.prototype.clipPolygons=function(n){if(!this.plane)return n.slice();for(var t=[],i=[],r=0;r<n.length;r++)this.plane.splitPolygon(n[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},n.prototype.clipTo=function(n){this.polygons=n.clipPolygons(this.polygons);this.front&&this.front.clipTo(n);this.back&&this.back.clipTo(n)},n.prototype.allPolygons=function(){var n=this.polygons.slice();return this.front&&(n=n.concat(this.front.allPolygons())),this.back&&(n=n.concat(this.back.allPolygons())),n},n.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var i=[],r=[],u=0;u<t.length;u++)this.plane.splitPolygon(t[u],this.polygons,this.polygons,i,r);i.length&&(this.front||(this.front=new n),this.front.build(i));r.length&&(this.back||(this.back=new n),this.back.build(r))}},n}(),e=function(){function f(){this.polygons=[]}return f.FromMesh=function(t){var d,a,g,v,y,p,nt=[],e,it,o,c;if(!(t instanceof n.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0);for(var w=t.getWorldMatrix(),rt=t.position.clone(),ut=t.rotation.clone(),ft=t.scaling.clone(),s=t.getIndices(),b=t.getVerticesData(n.VertexBuffer.PositionKind),k=t.getVerticesData(n.VertexBuffer.NormalKind),tt=t.getVerticesData(n.VertexBuffer.UVKind),l=t.subMeshes,h=0,et=l.length;et>h;h++)for(e=l[h].indexStart,it=l[h].indexCount+l[h].indexStart;it>e;e+=3){for(p=[],o=0;3>o;o++)a=new n.Vector3(k[3*s[e+o]],k[3*s[e+o]+1],k[3*s[e+o]+2]),g=new n.Vector2(tt[2*s[e+o]],tt[2*s[e+o]+1]),v=new n.Vector3(b[3*s[e+o]],b[3*s[e+o]+1],b[3*s[e+o]+2]),n.Vector3.TransformCoordinatesToRef(v,w,v),n.Vector3.TransformNormalToRef(a,w,a),d=new u(v,a,g),p.push(d);y=new i(p,{subMeshId:h,meshId:r,materialIndex:l[h].materialIndex});y.plane&&nt.push(y)}return c=f.FromPolygons(nt),c.matrix=w,c.position=rt,c.rotation=ut,c.scaling=ft,r++,c},f.FromPolygons=function(t){var i=new n.CSG;return i.polygons=t,i},f.prototype.clone=function(){var t=new n.CSG;return t.polygons=this.polygons.map(function(n){return n.clone()}),t.copyTransformAttributes(this),t},f.prototype.toPolygons=function(){return this.polygons},f.prototype.union=function(n){var r=new t(this.clone().polygons),i=new t(n.clone().polygons);return r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),f.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},f.prototype.unionInPlace=function(n){var r=new t(this.polygons),i=new t(n.polygons);r.clipTo(i);i.clipTo(r);i.invert();i.clipTo(r);i.invert();r.build(i.allPolygons());this.polygons=r.allPolygons()},f.prototype.subtract=function(n){var i=new t(this.clone().polygons),r=new t(n.clone().polygons);return i.invert(),i.clipTo(r),r.clipTo(i),r.invert(),r.clipTo(i),r.invert(),i.build(r.allPolygons()),i.invert(),f.FromPolygons(i.allPolygons()).copyTransformAttributes(this)},f.prototype.subtractInPlace=function(n){var i=new t(this.polygons),r=new t(n.polygons);i.invert();i.clipTo(r);r.clipTo(i);r.invert();r.clipTo(i);r.invert();i.build(r.allPolygons());i.invert();this.polygons=i.allPolygons()},f.prototype.intersect=function(n){var i=new t(this.clone().polygons),r=new t(n.clone().polygons);return i.invert(),r.clipTo(i),r.invert(),i.clipTo(r),r.clipTo(i),i.build(r.allPolygons()),i.invert(),f.FromPolygons(i.allPolygons()).copyTransformAttributes(this)},f.prototype.intersectInPlace=function(n){var i=new t(this.polygons),r=new t(n.polygons);i.invert();r.clipTo(i);r.invert();i.clipTo(r);r.clipTo(i);i.build(r.allPolygons());i.invert();this.polygons=i.allPolygons()},f.prototype.inverse=function(){var n=this.clone();return n.inverseInPlace(),n},f.prototype.inverseInPlace=function(){this.polygons.map(function(n){n.flip()})},f.prototype.copyTransformAttributes=function(n){return this.matrix=n.matrix,this.position=n.position,this.rotation=n.rotation,this.scaling=n.scaling,this},f.prototype.buildMeshGeometry=function(t,i,r){var d=this.matrix.clone(),b,et,p,ot,a,k,it,rt,st;d.invert();var u,o,e,c=new n.Mesh(t,i),g=[],ut=[],v=[],w=[],f=n.Vector3.Zero(),s=n.Vector3.Zero(),y=n.Vector2.Zero(),nt=this.polygons,l=[0,0,0],ft={},tt=0,h={};for(r&&nt.sort(function(n,t){return n.shared.meshId===t.shared.meshId?n.shared.subMeshId-t.shared.subMeshId:n.shared.meshId-t.shared.meshId}),b=0,et=nt.length;et>b;b++)for(u=nt[b],h[u.shared.meshId]||(h[u.shared.meshId]={}),h[u.shared.meshId][u.shared.subMeshId]||(h[u.shared.meshId][u.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:u.shared.materialIndex}),e=h[u.shared.meshId][u.shared.subMeshId],p=2,ot=u.vertices.length;ot>p;p++)for(l[0]=0,l[1]=p-1,l[2]=p,a=0;3>a;a++)f.copyFrom(u.vertices[l[a]].pos),s.copyFrom(u.vertices[l[a]].normal),y.copyFrom(u.vertices[l[a]].uv),n.Vector3.TransformCoordinatesToRef(f,d,f),n.Vector3.TransformNormalToRef(s,d,s),o=ft[f.x+","+f.y+","+f.z],("undefined"==typeof o||v[3*o]!==s.x||v[3*o+1]!==s.y||v[3*o+2]!==s.z||w[2*o]!==y.x||w[2*o+1]!==y.y)&&(g.push(f.x,f.y,f.z),w.push(y.x,y.y),v.push(s.x,s.y,s.z),o=ft[f.x+","+f.y+","+f.z]=g.length/3-1),ut.push(o),e.indexStart=Math.min(tt,e.indexStart),e.indexEnd=Math.max(tt,e.indexEnd),tt++;if(c.setVerticesData(n.VertexBuffer.PositionKind,g),c.setVerticesData(n.VertexBuffer.NormalKind,v),c.setVerticesData(n.VertexBuffer.UVKind,w),c.setIndices(ut),r){it=0;c.subMeshes.length=0;for(rt in h){k=-1;for(st in h[rt])e=h[rt][st],n.SubMesh.CreateFromIndices(e.materialIndex+it,e.indexStart,e.indexEnd-e.indexStart+1,c),k=Math.max(e.materialIndex,k);it+=++k}}return c},f.prototype.toMesh=function(n,t,i,r){var u=this.buildMeshGeometry(n,i,r);return u.material=t,u.position.copyFrom(this.position),u.rotation.copyFrom(this.rotation),u.scaling.copyFrom(this.scaling),u.computeWorldMatrix(!0),u},f}();n.CSG=e}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f){var e=this;t.call(this,i,"oculusDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,f.PostProcessScaleFactor,r,n.Texture.BILINEAR_SAMPLINGMODE,null,null);this._isRightEye=u;this._distortionFactors=f.DistortionK;this._postProcessScaleFactor=f.PostProcessScaleFactor;this._lensCenterOffset=f.LensCenterOffset;this.onSizeChanged=function(){e.aspectRatio=.5*e.width/e.height;e._scaleIn=new n.Vector2(2,2/e.aspectRatio);e._scaleFactor=new n.Vector2(.5*(1/e._postProcessScaleFactor),.5*(1/e._postProcessScaleFactor)*e.aspectRatio);e._lensCenter=new n.Vector2(e._isRightEye?.5-.5*e._lensCenterOffset:.5+.5*e._lensCenterOffset,.5)};this.onApply=function(n){n.setFloat2("LensCenter",e._lensCenter.x,e._lensCenter.y);n.setFloat2("Scale",e._scaleFactor.x,e._scaleFactor.y);n.setFloat2("ScaleIn",e._scaleIn.x,e._scaleIn.y);n.setFloat4("HmdWarpParam",e._distortionFactors[0],e._distortionFactors[1],e._distortionFactors[2],e._distortionFactors[3])}}return __extends(i,t),i}(n.PostProcess);n.OculusDistortionCorrectionPostProcess=t}(BABYLON||(BABYLON={}));!function(n){!function(n){n[n.X=0]="X";n[n.Y=1]="Y";n[n.Z=2]="Z"}(n.JoystickAxis||(n.JoystickAxis={}));var t=(n.JoystickAxis,function(){function t(i){var r=this;this._leftJoystick=i?!0:!1;this._joystickIndex=t._globalJoystickIndex;t._globalJoystickIndex++;this._axisTargetedByLeftAndRight=0;this._axisTargetedByUpAndDown=1;this.reverseLeftRight=!1;this.reverseUpDown=!1;this._touches=new n.VirtualJoystick.Collection;this.deltaPosition=n.Vector3.Zero();this._joystickSensibility=25;this._inversedSensibility=1e3/this._joystickSensibility;this._rotationSpeed=25;this._inverseRotationSpeed=1e3/this._rotationSpeed;this._rotateOnAxisRelativeToMesh=!1;t.vjCanvas||(window.addEventListener("resize",function(){t.vjCanvasWidth=window.innerWidth;t.vjCanvasHeight=window.innerHeight;t.vjCanvas.width=t.vjCanvasWidth;t.vjCanvas.height=t.vjCanvasHeight;t.halfWidth=t.vjCanvasWidth/2;t.halfHeight=t.vjCanvasHeight/2},!1),t.vjCanvas=document.createElement("canvas"),t.vjCanvasWidth=window.innerWidth,t.vjCanvasHeight=window.innerHeight,t.vjCanvas.width=window.innerWidth,t.vjCanvas.height=window.innerHeight,t.vjCanvas.style.width="100%",t.vjCanvas.style.height="100%",t.vjCanvas.style.position="absolute",t.vjCanvas.style.backgroundColor="transparent",t.vjCanvas.style.top="0px",t.vjCanvas.style.left="0px",t.vjCanvas.style.zIndex="5",t.vjCanvas.style.msTouchAction="none",t.vjCanvasContext=t.vjCanvas.getContext("2d"),t.vjCanvasContext.strokeStyle="#ffffff",t.vjCanvasContext.lineWidth=2,document.body.appendChild(t.vjCanvas));t.halfWidth=t.vjCanvas.width/2;t.halfHeight=t.vjCanvas.height/2;this.pressed=!1;this._joystickColor="cyan";this._joystickPointerID=-1;this._joystickPointerPos=new n.Vector2(0,0);this._joystickPointerStartPos=new n.Vector2(0,0);this._deltaJoystickVector=new n.Vector2(0,0);t.vjCanvas.addEventListener("pointerdown",function(n){r._onPointerDown(n)},!1);t.vjCanvas.addEventListener("pointermove",function(n){r._onPointerMove(n)},!1);t.vjCanvas.addEventListener("pointerup",function(n){r._onPointerUp(n)},!1);t.vjCanvas.addEventListener("pointerout",function(n){r._onPointerUp(n)},!1);t.vjCanvas.addEventListener("contextmenu",function(n){n.preventDefault()},!1);requestAnimationFrame(function(){r._drawVirtualJoystick()})}return t.prototype.setJoystickSensibility=function(n){this._joystickSensibility=n;this._inversedSensibility=1e3/this._joystickSensibility},t.prototype._onPointerDown=function(n){var i;n.preventDefault();i=this._leftJoystick===!0?n.clientX<t.halfWidth:n.clientX>t.halfWidth;i&&this._joystickPointerID<0?(this._joystickPointerID=n.pointerId,this._joystickPointerStartPos.x=n.clientX,this._joystickPointerStartPos.y=n.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(n.pointerId.toString(),n)):t._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(n.pointerId.toString(),n))},t.prototype._onPointerMove=function(n){var r,t,u,i;if(this._joystickPointerID==n.pointerId){this._joystickPointerPos.x=n.clientX;this._joystickPointerPos.y=n.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone();this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);r=this.reverseLeftRight?-1:1;t=r*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case 0:this.deltaPosition.x=Math.min(1,Math.max(-1,t));break;case 1:this.deltaPosition.y=Math.min(1,Math.max(-1,t));break;case 2:this.deltaPosition.z=Math.min(1,Math.max(-1,t))}u=this.reverseUpDown?1:-1;i=u*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case 0:this.deltaPosition.x=Math.min(1,Math.max(-1,i));break;case 1:this.deltaPosition.y=Math.min(1,Math.max(-1,i));break;case 2:this.deltaPosition.z=Math.min(1,Math.max(-1,i))}}else this._touches.item(n.pointerId.toString())&&(this._touches.item(n.pointerId.toString()).x=n.clientX,this._touches.item(n.pointerId.toString()).y=n.clientY)},t.prototype._onPointerUp=function(n){this._clearCanvas();this._joystickPointerID==n.pointerId&&(this._joystickPointerID=-1,this.pressed=!1);this._deltaJoystickVector.x=0;this._deltaJoystickVector.y=0;this._touches.remove(n.pointerId.toString())},t.prototype.setJoystickColor=function(n){this._joystickColor=n},t.prototype.setActionOnTouch=function(n){this._action=n},t.prototype.setAxisForLeftRight=function(n){switch(n){case 0:case 1:case 2:this._axisTargetedByLeftAndRight=n;break;default:this._axisTargetedByLeftAndRight=0}},t.prototype.setAxisForUpDown=function(n){switch(n){case 0:case 1:case 2:this._axisTargetedByUpAndDown=n;break;default:this._axisTargetedByUpAndDown=1}},t.prototype._clearCanvas=function(){this._leftJoystick?t.vjCanvasContext.clearRect(0,0,t.vjCanvasWidth/2,t.vjCanvasHeight):t.vjCanvasContext.clearRect(t.vjCanvasWidth/2,0,t.vjCanvasWidth,t.vjCanvasHeight)},t.prototype._drawVirtualJoystick=function(){var n=this;this.pressed&&(this._clearCanvas(),this._touches.forEach(function(i){i.pointerId===n._joystickPointerID?(t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=n._joystickColor,t.vjCanvasContext.lineWidth=6,t.vjCanvasContext.arc(n._joystickPointerStartPos.x,n._joystickPointerStartPos.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke(),t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=n._joystickColor,t.vjCanvasContext.lineWidth=2,t.vjCanvasContext.arc(n._joystickPointerStartPos.x,n._joystickPointerStartPos.y,60,0,2*Math.PI,!0),t.vjCanvasContext.stroke(),t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=n._joystickColor,t.vjCanvasContext.arc(n._joystickPointerPos.x,n._joystickPointerPos.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke()):(t.vjCanvasContext.beginPath(),t.vjCanvasContext.fillStyle="white",t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle="red",t.vjCanvasContext.lineWidth=6,t.vjCanvasContext.arc(i.x,i.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke())}));requestAnimationFrame(function(){n._drawVirtualJoystick()})},t.prototype.releaseCanvas=function(){t.vjCanvas&&(document.body.removeChild(t.vjCanvas),t.vjCanvas=null)},t._globalJoystickIndex=0,t}());n.VirtualJoystick=t}(BABYLON||(BABYLON={}));!function(n){!function(n){var t=function(){function n(){this._count=0;this._collection=[]}return n.prototype.Count=function(){return this._count},n.prototype.add=function(n,t){if(void 0==this._collection[n])return(this._collection[n]=t,++this._count)},n.prototype.remove=function(n){if(void 0!=this._collection[n])return(delete this._collection[n],--this._count)},n.prototype.item=function(n){return this._collection[n]},n.prototype.forEach=function(n){for(var t in this._collection)this._collection.hasOwnProperty(t)&&n(this._collection[t])},n}();n.Collection=t}(n.VirtualJoystick||(n.VirtualJoystick={}));n.VirtualJoystick}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t={HResolution:1280,VResolution:800,HScreenSize:.149759993,VScreenSize:.0935999975,VScreenCenter:.0467999987,EyeToScreenDistance:.0410000011,LensSeparationDistance:.063500002,InterpupillaryDistance:.064000003,DistortionK:[1,.219999999,.239999995,0],ChromaAbCorrection:[.995999992,-.00400000019,1.01400006,0],PostProcessScaleFactor:1.7146055078084119,LensCenterOffset:.151976421},i=function(i){function r(r,u,f,e){i.call(this,r,u,f);this._workMatrix=new n.Matrix;this._actualUp=new n.Vector3(0,0,0);this._aspectRatioAspectRatio=t.HResolution/(2*t.VResolution);this._aspectRatioFov=2*Math.atan(t.PostProcessScaleFactor*t.VScreenSize/(2*t.EyeToScreenDistance));var s=t.HScreenSize/4-t.LensSeparationDistance/2,o=4*s/t.HScreenSize;this._hMatrix=n.Matrix.Translation(e?o:-o,0,0);this.viewport=new n.Viewport(e?0:.5,0,.5,1);this._preViewMatrix=n.Matrix.Translation(e?.5*t.InterpupillaryDistance:-.5*t.InterpupillaryDistance,0,0);new n.OculusDistortionCorrectionPostProcess("Oculus Distortion",this,!e,t)}return __extends(r,i),r.prototype.getProjectionMatrix=function(){return n.Matrix.PerspectiveFovLHToRef(this._aspectRatioFov,this._aspectRatioAspectRatio,this.minZ,this.maxZ,this._workMatrix),this._workMatrix.multiplyToRef(this._hMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype._getViewMatrix=function(){return n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),n.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),n.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._actualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),n.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._actualUp,this._workMatrix),this._workMatrix.multiplyToRef(this._preViewMatrix,this._viewMatrix),this._viewMatrix},r}(n.FreeCamera),r=function(n){function t(t,r,u){n.call(this,t,r,u);this._leftCamera=new i(t+"_left",r.clone(),u,!0);this._rightCamera=new i(t+"_right",r.clone(),u,!1);this.subCameras.push(this._leftCamera);this.subCameras.push(this._rightCamera);this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(t,n),t.prototype._update=function(){this._leftCamera.position.copyFrom(this.position);this._rightCamera.position.copyFrom(this.position);this._updateCamera(this._leftCamera);this._updateCamera(this._rightCamera);n.prototype._update.call(this)},t.prototype._updateCamera=function(n){n.minZ=this.minZ;n.maxZ=this.maxZ;n.rotation.x=this.rotation.x;n.rotation.y=this.rotation.y;n.rotation.z=this.rotation.z},t.prototype._onOrientationEvent=function(n){var t=n.alpha/180*Math.PI,i=n.beta/180*Math.PI,r=n.gamma/180*Math.PI;return this._offsetOrientation?(this.rotation.y+=t-this._offsetOrientation.yaw,this.rotation.x+=i-this._offsetOrientation.pitch,this.rotation.z+=this._offsetOrientation.roll-r,this._offsetOrientation.yaw=t,this._offsetOrientation.pitch=i,this._offsetOrientation.roll=r,void 0):void(this._offsetOrientation={yaw:t,pitch:i,roll:r})},t.prototype.attachControl=function(t,i){n.prototype.attachControl.call(this,t,i);window.addEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype.detachControl=function(t){n.prototype.detachControl.call(this,t);window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},t}(n.FreeCamera);n.OculusCamera=r}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t={HResolution:1280,VResolution:800,HScreenSize:.149759993,VScreenSize:.0935999975,VScreenCenter:.0467999987,EyeToScreenDistance:.0410000011,LensSeparationDistance:.063500002,InterpupillaryDistance:.064000003,DistortionK:[1,.219999999,.239999995,0],ChromaAbCorrection:[.995999992,-.00400000019,1.01400006,0],PostProcessScaleFactor:1.7146055078084119,LensCenterOffset:.151976421},i=function(i){function r(r,u,f,e){i.call(this,r,u,f);this._workMatrix=new n.Matrix;this._actualUp=new n.Vector3(0,0,0);this._aspectRatioAspectRatio=t.HResolution/(2*t.VResolution);this._aspectRatioFov=2*Math.atan(t.PostProcessScaleFactor*t.VScreenSize/(2*t.EyeToScreenDistance));var s=t.HScreenSize/4-t.LensSeparationDistance/2,o=4*s/t.HScreenSize;this._hMatrix=n.Matrix.Translation(e?o:-o,0,0);this.viewport=new n.Viewport(e?0:.5,0,.5,1);this._preViewMatrix=n.Matrix.Translation(e?.5*t.InterpupillaryDistance:-.5*t.InterpupillaryDistance,0,0);new n.OculusDistortionCorrectionPostProcess("Oculus Distortion",this,!e,t)}return __extends(r,i),r.prototype.getProjectionMatrix=function(){return n.Matrix.PerspectiveFovLHToRef(this._aspectRatioFov,this._aspectRatioAspectRatio,this.minZ,this.maxZ,this._workMatrix),this._workMatrix.multiplyToRef(this._hMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype._getViewMatrix=function(){return n.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),n.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),n.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._actualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),n.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._actualUp,this._workMatrix),this._workMatrix.multiplyToRef(this._preViewMatrix,this._viewMatrix),this._viewMatrix},r}(n.FreeCamera),r=function(t){function r(r,u,f){var e=this;t.call(this,r,u,f);this.angularSensibility=200;this.moveSensibility=75;this._leftCamera=new i(r+"_left",u.clone(),f,!0);this._rightCamera=new i(r+"_right",u.clone(),f,!1);this.subCameras.push(this._leftCamera);this.subCameras.push(this._rightCamera);this._deviceOrientationHandler=this._onOrientationEvent.bind(this);this._gamepads=new n.Gamepads(function(n){e._onNewGameConnected(n)})}return __extends(r,t),r.prototype._onNewGameConnected=function(n){0===n.index&&(this._gamepad=n)},r.prototype._update=function(){this._leftCamera.position.copyFrom(this.position);this._rightCamera.position.copyFrom(this.position);this._updateCamera(this._leftCamera);this._updateCamera(this._rightCamera);t.prototype._update.call(this)},r.prototype._checkInputs=function(){var u,f;if(this._gamepad){var t=this._gamepad.leftStick,i=t.x/this.moveSensibility,r=t.y/this.moveSensibility;t.x=Math.abs(i)>.005?0+i:0;t.y=Math.abs(r)>.005?0+r:0;u=n.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0);f=n.Vector3.TransformCoordinates(new n.Vector3(t.x,0,-t.y),u);this.cameraDirection=this.cameraDirection.add(f)}},r.prototype._updateCamera=function(n){n.minZ=this.minZ;n.maxZ=this.maxZ;n.rotation.x=this.rotation.x;n.rotation.y=this.rotation.y;n.rotation.z=this.rotation.z},r.prototype._onOrientationEvent=function(n){var t=n.alpha/180*Math.PI,i=n.beta/180*Math.PI,r=n.gamma/180*Math.PI;return this._offsetOrientation?(this.rotation.y+=t-this._offsetOrientation.yaw,this.rotation.x+=i-this._offsetOrientation.pitch,this.rotation.z+=this._offsetOrientation.roll-r,this._offsetOrientation.yaw=t,this._offsetOrientation.pitch=i,this._offsetOrientation.roll=r,void 0):void(this._offsetOrientation={yaw:t,pitch:i,roll:r})},r.prototype.attachControl=function(n,i){t.prototype.attachControl.call(this,n,i);window.addEventListener("deviceorientation",this._deviceOrientationHandler)},r.prototype.detachControl=function(n){t.prototype.detachControl.call(this,n);window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},r.prototype.dispose=function(){this._gamepads.dispose();t.prototype.dispose.call(this)},r}(n.FreeCamera);n.OculusGamepadCamera=r}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){t.call(this,i,r,u);this._leftjoystick=new n.VirtualJoystick(!0);this._leftjoystick.setAxisForUpDown(2);this._leftjoystick.setAxisForLeftRight(0);this._leftjoystick.setJoystickSensibility(.15);this._rightjoystick=new n.VirtualJoystick(!1);this._rightjoystick.setAxisForUpDown(0);this._rightjoystick.setAxisForLeftRight(1);this._rightjoystick.reverseUpDown=!0;this._rightjoystick.setJoystickSensibility(.05);this._rightjoystick.setJoystickColor("yellow")}return __extends(i,t),i.prototype._checkInputs=function(){var t=n.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),i=n.Vector3.TransformCoordinates(this._leftjoystick.deltaPosition,t);this.cameraDirection=this.cameraDirection.add(i);this.cameraRotation=this.cameraRotation.addVector3(this._rightjoystick.deltaPosition);this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9));this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))},i.prototype.dispose=function(){this._leftjoystick.releaseCanvas();t.prototype.dispose.call(this)},i}(n.FreeCamera);n.VirtualJoysticksCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u,f){t.call(this,i,r);this._textures=[];this._floats=[];this._floatsArrays={};this._colors3=[];this._colors4=[];this._vectors2=[];this._vectors3=[];this._matrices=[];this._cachedWorldViewMatrix=new n.Matrix;this._shaderPath=u;f.needAlphaBlending=f.needAlphaBlending||!1;f.needAlphaTesting=f.needAlphaTesting||!1;f.attributes=f.attributes||["position","normal","uv"];f.uniforms=f.uniforms||["worldViewProjection"];f.samplers=f.samplers||[];this._options=f}return __extends(i,t),i.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(n){-1===this._options.uniforms.indexOf(n)&&this._options.uniforms.push(n)},i.prototype.setTexture=function(n,t){return-1===this._options.samplers.indexOf(n)&&this._options.samplers.push(n),this._textures[n]=t,this},i.prototype.setFloat=function(n,t){return this._checkUniform(n),this._floats[n]=t,this},i.prototype.setFloats=function(n,t){return this._checkUniform(n),this._floatsArrays[n]=t,this},i.prototype.setColor3=function(n,t){return this._checkUniform(n),this._colors3[n]=t,this},i.prototype.setColor4=function(n,t){return this._checkUniform(n),this._colors4[n]=t,this},i.prototype.setVector2=function(n,t){return this._checkUniform(n),this._vectors2[n]=t,this},i.prototype.setVector3=function(n,t){return this._checkUniform(n),this._vectors3[n]=t,this},i.prototype.setMatrix=function(n,t){return this._checkUniform(n),this._matrices[n]=t,this},i.prototype.isReady=function(){var n=this.getScene().getEngine();return this._effect=n.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,"",null,this.onCompiled,this.onError),this._effect.isReady()?!0:!1},i.prototype.bind=function(n){var t,i;-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",n);-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix());-1!==this._options.uniforms.indexOf("worldView")&&(n.multiplyToRef(this.getScene().getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix));-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix());-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",n.multiply(this.getScene().getTransformMatrix()));for(t in this._textures)this._effect.setTexture(t,this._textures[t]);for(t in this._floats)this._effect.setFloat(t,this._floats[t]);for(t in this._floatsArrays)this._effect.setArray(t,this._floatsArrays[t]);for(t in this._colors3)this._effect.setColor3(t,this._colors3[t]);for(t in this._colors4)i=this._colors4[t],this._effect.setFloat4(t,i.r,i.g,i.b,i.a);for(t in this._vectors2)this._effect.setVector2(t,this._vectors2[t]);for(t in this._vectors3)this._effect.setVector3(t,this._vectors3[t]);for(t in this._matrices)this._effect.setMatrix(t,this._matrices[t])},i.prototype.dispose=function(n){for(var i in this._textures)this._textures[i].dispose();this._textures=[];t.prototype.dispose.call(this,n)},i}(n.Material);n.ShaderMaterial=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){}return t.prototype.set=function(t,i){switch(i){case n.VertexBuffer.PositionKind:this.positions=t;break;case n.VertexBuffer.NormalKind:this.normals=t;break;case n.VertexBuffer.UVKind:this.uvs=t;break;case n.VertexBuffer.UV2Kind:this.uv2s=t;break;case n.VertexBuffer.ColorKind:this.colors=t;break;case n.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case n.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t}},t.prototype.applyToMesh=function(n,t){this._applyTo(n,t)},t.prototype.applyToGeometry=function(n,t){this._applyTo(n,t)},t.prototype.updateMesh=function(n){this._update(n)},t.prototype.updateGeometry=function(n){this._update(n)},t.prototype._applyTo=function(t,i){this.positions&&t.setVerticesData(n.VertexBuffer.PositionKind,this.positions,i);this.normals&&t.setVerticesData(n.VertexBuffer.NormalKind,this.normals,i);this.uvs&&t.setVerticesData(n.VertexBuffer.UVKind,this.uvs,i);this.uv2s&&t.setVerticesData(n.VertexBuffer.UV2Kind,this.uv2s,i);this.colors&&t.setVerticesData(n.VertexBuffer.ColorKind,this.colors,i);this.matricesIndices&&t.setVerticesData(n.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i);this.matricesWeights&&t.setVerticesData(n.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i);this.indices&&t.setIndices(this.indices)},t.prototype._update=function(t,i,r){this.positions&&t.updateVerticesData(n.VertexBuffer.PositionKind,this.positions,i,r);this.normals&&t.updateVerticesData(n.VertexBuffer.NormalKind,this.normals,i,r);this.uvs&&t.updateVerticesData(n.VertexBuffer.UVKind,this.uvs,i,r);this.uv2s&&t.updateVerticesData(n.VertexBuffer.UV2Kind,this.uv2s,i,r);this.colors&&t.updateVerticesData(n.VertexBuffer.ColorKind,this.colors,i,r);this.matricesIndices&&t.updateVerticesData(n.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,r);this.matricesWeights&&t.updateVerticesData(n.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,r);this.indices&&t.setIndices(this.indices)},t.prototype.transform=function(t){var r=n.Vector3.Zero(),u,i,f;if(this.positions)for(u=n.Vector3.Zero(),i=0;i<this.positions.length;i+=3)n.Vector3.FromArrayToRef(this.positions,i,u),n.Vector3.TransformCoordinatesToRef(u,t,r),this.positions[i]=r.x,this.positions[i+1]=r.y,this.positions[i+2]=r.z;if(this.normals)for(f=n.Vector3.Zero(),i=0;i<this.normals.length;i+=3)n.Vector3.FromArrayToRef(this.normals,i,f),n.Vector3.TransformNormalToRef(f,t,r),this.normals[i]=r.x,this.normals[i+1]=r.y,this.normals[i+2]=r.z},t.prototype.merge=function(n){if(n.indices){this.indices||(this.indices=[]);for(var i=this.positions?this.positions.length/3:0,t=0;t<n.indices.length;t++)this.indices.push(n.indices[t]+i)}if(n.positions)for(this.positions||(this.positions=[]),t=0;t<n.positions.length;t++)this.positions.push(n.positions[t]);if(n.normals)for(this.normals||(this.normals=[]),t=0;t<n.normals.length;t++)this.normals.push(n.normals[t]);if(n.uvs)for(this.uvs||(this.uvs=[]),t=0;t<n.uvs.length;t++)this.uvs.push(n.uvs[t]);if(n.uv2s)for(this.uv2s||(this.uv2s=[]),t=0;t<n.uv2s.length;t++)this.uv2s.push(n.uv2s[t]);if(n.matricesIndices)for(this.matricesIndices||(this.matricesIndices=[]),t=0;t<n.matricesIndices.length;t++)this.matricesIndices.push(n.matricesIndices[t]);if(n.matricesWeights)for(this.matricesWeights||(this.matricesWeights=[]),t=0;t<n.matricesWeights.length;t++)this.matricesWeights.push(n.matricesWeights[t]);if(n.colors)for(this.colors||(this.colors=[]),t=0;t<n.colors.length;t++)this.colors.push(n.colors[t])},t.ExtractFromMesh=function(n){return t._ExtractFrom(n)},t.ExtractFromGeometry=function(n){return t._ExtractFrom(n)},t._ExtractFrom=function(t){var i=new n.VertexData;return t.isVerticesDataPresent(n.VertexBuffer.PositionKind)&&(i.positions=t.getVerticesData(n.VertexBuffer.PositionKind)),t.isVerticesDataPresent(n.VertexBuffer.NormalKind)&&(i.normals=t.getVerticesData(n.VertexBuffer.NormalKind)),t.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(i.uvs=t.getVerticesData(n.VertexBuffer.UVKind)),t.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(i.uv2s=t.getVerticesData(n.VertexBuffer.UV2Kind)),t.isVerticesDataPresent(n.VertexBuffer.ColorKind)&&(i.colors=t.getVerticesData(n.VertexBuffer.ColorKind)),t.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&(i.matricesIndices=t.getVerticesData(n.VertexBuffer.MatricesIndicesKind)),t.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(i.matricesWeights=t.getVerticesData(n.VertexBuffer.MatricesWeightsKind)),i.indices=t.getIndices(),i},t.CreateBox=function(t){var v=[new n.Vector3(0,0,1),new n.Vector3(0,0,-1),new n.Vector3(1,0,0),new n.Vector3(-1,0,0),new n.Vector3(0,1,0),new n.Vector3(0,-1,0)],u=[],f=[],s=[],h=[],l,r,o;for(t=t||1,l=0;l<v.length;l++){var i=v[l],c=new n.Vector3(i.y,i.z,i.x),a=n.Vector3.Cross(i,c),e=f.length/3;u.push(e);u.push(e+1);u.push(e+2);u.push(e);u.push(e+2);u.push(e+3);r=i.subtract(c).subtract(a).scale(t/2);f.push(r.x,r.y,r.z);s.push(i.x,i.y,i.z);h.push(1,1);r=i.subtract(c).add(a).scale(t/2);f.push(r.x,r.y,r.z);s.push(i.x,i.y,i.z);h.push(0,1);r=i.add(c).add(a).scale(t/2);f.push(r.x,r.y,r.z);s.push(i.x,i.y,i.z);h.push(0,0);r=i.add(c).subtract(a).scale(t/2);f.push(r.x,r.y,r.z);s.push(i.x,i.y,i.z);h.push(1,0)}return o=new n.VertexData,o.indices=u,o.positions=f,o.normals=s,o.uvs=h,o},t.CreateSphere=function(t,i){var v,r,e;t=t||32;i=i||1;for(var k=i/2,h=2+t,u=2*h,f=[],c=[],y=[],p=[],o=0;h>=o;o++){for(var w=o/h,d=w*Math.PI,l=0;u>=l;l++){var b=l/u,g=b*Math.PI*2,nt=n.Matrix.RotationZ(-d),tt=n.Matrix.RotationY(g),it=n.Vector3.TransformCoordinates(n.Vector3.Up(),nt),rt=n.Vector3.TransformCoordinates(it,tt),s=rt.scale(k),a=n.Vector3.Normalize(s);c.push(s.x,s.y,s.z);y.push(a.x,a.y,a.z);p.push(w,b)}if(o>0)for(v=c.length/3,r=v-2*(u+1);v>r+u+2;r++)f.push(r),f.push(r+1),f.push(r+u+1),f.push(r+u+1),f.push(r+1),f.push(r+u+2)}return e=new n.VertexData,e.indices=f,e.positions=c,e.normals=y,e.uvs=p,e},t.CreateCylinder=function(t,i,r,u,f){var s,o,h;"undefined"==typeof f&&(f=1);var w=i/2,a=r/2,e=[],c=[],b=[],v=[];t=t||1;i=i||.5;r=r||1;u=u||16;f=f||1;f=1>f?1:f;for(var k=function(t){var i=2*t*Math.PI/u,r=Math.cos(i),f=Math.sin(i);return new n.Vector3(r,0,f)},d=function(i){var l=i?w:a,r;if(0!=l){var f=c.length/3,y=new n.Vector3(0,t/2,0),o=new n.Vector2(.5,.5);for(i||(y.scaleInPlace(-1),o.x=-o.x),r=0;u>r;r++){var s=k(r),h=s.scale(l).add(y),p=new n.Vector2(s.x*o.x+.5,s.z*o.y+.5);c.push(h.x,h.y,h.z);v.push(p.x,p.y)}for(r=0;u-2>r;r++)i?(e.push(f),e.push(f+(r+1)%u),e.push(f+(r+2)%u)):(e.push(f),e.push(f+(r+2)%u),e.push(f+(r+1)%u))}},nt=new n.Vector3(0,-1,0).scale(t/2),tt=new n.Vector3(0,1,0).scale(t/f),y=u+1,o=0;u>=o;o++)for(var l,it=k(o),p=new n.Vector2(o/u,0),g=a,s=0;f>=s;s++)l=it.scale(g),l.addInPlace(nt.add(tt.scale(s))),p.y+=1/f,g+=(w-a)/f,c.push(l.x,l.y,l.z),v.push(p.x,p.y);for(f+=1,s=0;f-1>s;s++)for(o=0;u>=o;o++)e.push(o*f+s),e.push((o*f+(s+f))%(y*f)),e.push(o*f+(s+1)),e.push(o*f+(s+1)),e.push((o*f+(s+f))%(y*f)),e.push((o*f+(s+f+1))%(y*f));return d(!0),d(!1),n.VertexData.ComputeNormals(c,e,b),h=new n.VertexData,h.indices=e,h.positions=c,h.normals=b,h.uvs=v,h},t.CreateTorus=function(t,i,r){var o=[],v=[],y=[],p=[],u,f,l,a,h;for(t=t||1,i=i||.5,r=r||16,u=r+1,f=0;r>=f;f++)for(var d=f/r,g=f*Math.PI*2/r-Math.PI/2,w=n.Matrix.Translation(t/2,0,0).multiply(n.Matrix.RotationY(g)),e=0;r>=e;e++){var nt=1-e/r,b=e*Math.PI*2/r+Math.PI,tt=Math.cos(b),it=Math.sin(b),s=new n.Vector3(tt,it,0),c=s.scale(i/2),k=new n.Vector2(d,nt);c=n.Vector3.TransformCoordinates(c,w);s=n.Vector3.TransformNormal(s,w);v.push(c.x,c.y,c.z);y.push(s.x,s.y,s.z);p.push(k.x,k.y);l=(f+1)%u;a=(e+1)%u;o.push(f*u+e);o.push(f*u+a);o.push(l*u+e);o.push(f*u+a);o.push(l*u+a);o.push(l*u+e)}return h=new n.VertexData,h.indices=o,h.positions=v,h.normals=y,h.uvs=p,h},t.CreateLines=function(t){for(var r,u=[],f=[],i=0;i<t.length;i++)f.push(t[i].x,t[i].y,t[i].z),i>0&&(u.push(i-1),u.push(i));return r=new n.VertexData,r.indices=u,r.positions=f,r},t.CreateGround=function(t,i,r){var u,f,e=[],c=[],l=[],a=[],s,h,o;for(t=t||1,i=i||1,r=r||1,u=0;r>=u;u++)for(f=0;r>=f;f++)s=new n.Vector3(f*t/r-t/2,0,(r-u)*i/r-i/2),h=new n.Vector3(0,1,0),c.push(s.x,s.y,s.z),l.push(h.x,h.y,h.z),a.push(f/r,1-u/r);for(u=0;r>u;u++)for(f=0;r>f;f++)e.push(f+1+(u+1)*(r+1)),e.push(f+1+u*(r+1)),e.push(f+u*(r+1)),e.push(f+(u+1)*(r+1)),e.push(f+1+(u+1)*(r+1)),e.push(f+u*(r+1));return o=new n.VertexData,o.indices=e,o.positions=c,o.normals=l,o.uvs=a,o},t.CreateTiledGround=function(t,i,r,u,f,e){function b(t,i,r,u){var l=y.length/3,a=e.w+1,f,c,v;for(o=0;o<e.h;o++)for(s=0;s<e.w;s++)f=[l+s+o*a,l+(s+1)+o*a,l+(s+1)+(o+1)*a,l+s+(o+1)*a],h.push(f[1]),h.push(f[2]),h.push(f[3]),h.push(f[0]),h.push(f[1]),h.push(f[3]);for(c=n.Vector3.Zero(),v=new n.Vector3(0,1,0),o=0;o<=e.h;o++)for(c.z=o*(u-i)/e.h+i,s=0;s<=e.w;s++)c.x=s*(r-t)/e.w+t,c.y=0,y.push(c.x,c.y,c.z),p.push(v.x,v.y,v.z),w.push(s/e.w,o/e.h)}var v,c;"undefined"==typeof f&&(f={w:1,h:1});"undefined"==typeof e&&(e={w:1,h:1});var o,s,l,a,h=[],y=[],p=[],w=[];for(f.h=f.w<1?1:f.h,f.w=f.w<1?1:f.w,e.w=e.w<1?1:e.w,e.h=e.h<1?1:e.h,v={w:(r-t)/f.w,h:(u-i)/f.h},l=0;l<f.h;l++)for(a=0;a<f.w;a++)b(t+a*v.w,i+l*v.h,t+(a+1)*v.w,i+(l+1)*v.h);return c=new n.VertexData,c.indices=h,c.positions=y,c.normals=p,c.uvs=w,c},t.CreateGroundFromHeightMap=function(t,i,r,u,f,e,o,s){for(var c,l=[],y=[],p=[],b=[],v,h=0;r>=h;h++)for(c=0;r>=c;c++){var a=new n.Vector3(c*t/r-t/2,0,(r-h)*i/r-i/2),k=(a.x+t/2)/t*(o-1)|0,d=(1-(a.z+i/2)/i)*(s-1)|0,w=4*(k+d*o),g=e[w]/255,nt=e[w+1]/255,tt=e[w+2]/255,it=.3*g+.59*nt+.11*tt;a.y=u+(f-u)*it;y.push(a.x,a.y,a.z);p.push(0,0,0);b.push(c/r,1-h/r)}for(h=0;r>h;h++)for(c=0;r>c;c++)l.push(c+1+(h+1)*(r+1)),l.push(c+1+h*(r+1)),l.push(c+h*(r+1)),l.push(c+(h+1)*(r+1)),l.push(c+1+(h+1)*(r+1)),l.push(c+h*(r+1));return n.VertexData.ComputeNormals(y,l,p),v=new n.VertexData,v.indices=l,v.positions=y,v.normals=p,v.uvs=b,v},t.CreatePlane=function(t){var r=[],f=[],e=[],o=[],i,u;return t=t||1,i=t/2,f.push(-i,-i,0),e.push(0,0,-1),o.push(0,0),f.push(i,-i,0),e.push(0,0,-1),o.push(1,0),f.push(i,i,0),e.push(0,0,-1),o.push(1,1),f.push(-i,i,0),e.push(0,0,-1),o.push(0,1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),u=new n.VertexData,u.indices=r,u.positions=f,u.normals=e,u.uvs=o,u},t.CreateTorusKnot=function(t,i,r,u,f,e){var h=[],a=[],d=[],p=[],w,o,s,l;for(t=t||2,i=i||.5,r=r||32,u=u||32,f=f||2,e=e||3,w=function(i){var o=Math.cos(i),s=Math.sin(i),r=e/f*i,u=Math.cos(r),h=t*(2+u)*.5*o,c=t*(2+u)*s*.5,l=t*Math.sin(r)*.5;return new n.Vector3(h,c,l)},o=0;r>=o;o++){var et=o%r,g=et/r*2*f*Math.PI,v=w(g),nt=w(g+.01),tt=nt.subtract(v),c=nt.add(v),y=n.Vector3.Cross(tt,c);for(c=n.Vector3.Cross(y,tt),y.normalize(),c.normalize(),s=0;u>s;s++){var ot=s%u,it=ot/u*2*Math.PI,b=-i*Math.cos(it),k=i*Math.sin(it);a.push(v.x+b*c.x+k*y.x);a.push(v.y+b*c.y+k*y.y);a.push(v.z+b*c.z+k*y.z);p.push(o/r);p.push(s/u)}}for(o=0;r>o;o++)for(s=0;u>s;s++){var rt=(s+1)%u,st=o*u+s,ut=(o+1)*u+s,ht=(o+1)*u+rt,ft=o*u+rt;h.push(ft);h.push(ut);h.push(st);h.push(ft);h.push(ht);h.push(ut)}return n.VertexData.ComputeNormals(a,h,d),l=new n.VertexData,l.indices=h,l.positions=a,l.normals=d,l.uvs=p,l},t.ComputeNormals=function(t,i,r){for(var e=[],o=[],l,s,u=0;u<t.length;u+=3)l=new n.Vector3(t[u],t[u+1],t[u+2]),e.push(l),o.push([]);for(s=[],u=0;u<i.length/3;u++){var a=i[3*u],v=i[3*u+1],y=i[3*u+2],w=e[a],p=e[v],b=e[y],k=w.subtract(p),d=b.subtract(p);s[u]=n.Vector3.Normalize(n.Vector3.Cross(k,d));o[a].push(u);o[v].push(u);o[y].push(u)}for(u=0;u<e.length;u++){for(var h=o[u],f=n.Vector3.Zero(),c=0;c<h.length;c++)f.addInPlace(s[h[c]]);f=n.Vector3.Normalize(f.scale(1/h.length));r[3*u]=f.x;r[3*u+1]=f.y;r[3*u+2]=f.z}},t}();n.VertexData=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t,i){t._leftCamera.isIntermediate=!0;t.subCameras.push(t._leftCamera);t.subCameras.push(t._rightCamera);t._leftTexture=new n.PassPostProcess(i+"_leftTexture",1,t._leftCamera);t._anaglyphPostProcess=new n.AnaglyphPostProcess(i+"_anaglyph",1,t._rightCamera);t._anaglyphPostProcess.onApply=function(n){n.setTextureFromPostProcess("leftSampler",t._leftTexture)};t._update()},r=function(i){function r(r,u,f,e,o,s,h){i.call(this,r,u,f,e,o,h);this._eyeSpace=n.Tools.ToRadians(s);this._leftCamera=new n.ArcRotateCamera(r+"_left",u-this._eyeSpace,f,e,o,h);this._rightCamera=new n.ArcRotateCamera(r+"_right",u+this._eyeSpace,f,e,o,h);t(this,r)}return __extends(r,i),r.prototype._update=function(){this._updateCamera(this._leftCamera);this._updateCamera(this._rightCamera);this._leftCamera.alpha=this.alpha-this._eyeSpace;this._rightCamera.alpha=this.alpha+this._eyeSpace;i.prototype._update.call(this)},r.prototype._updateCamera=function(n){n.beta=this.beta;n.radius=this.radius;n.minZ=this.minZ;n.maxZ=this.maxZ;n.fov=this.fov;n.target=this.target},r}(n.ArcRotateCamera),i;n.AnaglyphArcRotateCamera=r;i=function(i){function r(r,u,f,e){i.call(this,r,u,e);this._eyeSpace=n.Tools.ToRadians(f);this._transformMatrix=new n.Matrix;this._leftCamera=new n.FreeCamera(r+"_left",u.clone(),e);this._rightCamera=new n.FreeCamera(r+"_right",u.clone(),e);t(this,r)}return __extends(r,i),r.prototype._getSubCameraPosition=function(t,i){var r=this.getTarget();n.Matrix.Translation(-r.x,-r.y,-r.z).multiplyToRef(n.Matrix.RotationY(t),this._transformMatrix);this._transformMatrix=this._transformMatrix.multiply(n.Matrix.Translation(r.x,r.y,r.z));n.Vector3.TransformCoordinatesToRef(this.position,this._transformMatrix,i)},r.prototype._update=function(){this._getSubCameraPosition(-this._eyeSpace,this._leftCamera.position);this._getSubCameraPosition(this._eyeSpace,this._rightCamera.position);this._updateCamera(this._leftCamera);this._updateCamera(this._rightCamera);i.prototype._update.call(this)},r.prototype._updateCamera=function(n){n.minZ=this.minZ;n.maxZ=this.maxZ;n.fov=this.fov;n.viewport=this.viewport;n.setTarget(this.getTarget())},r}(n.FreeCamera);n.AnaglyphFreeCamera=i}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e){n.call(this,t,"anaglyph",null,["leftSampler"],i,r,u,f,e)}return __extends(t,n),t}(n.PostProcess);n.AnaglyphPostProcess=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){}return t.EnableFor=function(n){n._tags=n._tags||{};n.hasTags=function(){return t.HasTags(n)};n.addTags=function(i){return t.AddTagsTo(n,i)};n.removeTags=function(i){return t.RemoveTagsFrom(n,i)};n.matchesTagsQuery=function(i){return t.MatchesQuery(n,i)}},t.DisableFor=function(n){delete n._tags;delete n.hasTags;delete n.addTags;delete n.removeTags;delete n.matchesTagsQuery},t.HasTags=function(t){return t._tags?!n.Tools.IsEmpty(t._tags):!1},t.GetTags=function(n){return n._tags?n._tags:null},t.AddTagsTo=function(n,i){var r,u;if(i){r=i.split(" ");for(u in r)t._AddTagTo(n,r[u])}},t._AddTagTo=function(n,i){i=i.trim();""!==i&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(n),n._tags[i]=!0))},t.RemoveTagsFrom=function(n,i){var r,u;if(t.HasTags(n)){r=i.split(" ");for(u in r)t._RemoveTagFrom(n,r[u])}},t._RemoveTagFrom=function(n,t){delete n._tags[t]},t.MatchesQuery=function(i,r){return void 0===r?!0:""===r?t.HasTags(i):n.Internals.AndOrNotEvaluator.Eval(r,function(n){return t.HasTags(i)&&i._tags[n]})},t}();n.Tags=t}(BABYLON||(BABYLON={}));!function(n){!function(n){var t=function(){function n(){}return n.Eval=function(t,i){return t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),n._HandleParenthesisContent(t,i)}):n._HandleParenthesisContent(t,i),"true"===t?!0:"false"===t?!1:n.Eval(t,i)},n._HandleParenthesisContent=function(t,i){var f,s,h,r,e,o,u;i=i||function(n){return"true"===n?!0:!1};s=t.split("||");for(h in s){if(r=n._SimplifyNegation(s[h].trim()),e=r.split("&&"),e.length>1)for(o=0;o<e.length;++o)if(u=n._SimplifyNegation(e[o].trim()),f="true"!==u&&"false"!==u?"!"===u[0]?!i(u.substring(1)):i(u):"true"===u?!0:!1,!f){r="false";break}if(f||"true"===r){f=!0;break}f="true"!==r&&"false"!==r?"!"===r[0]?!i(r.substring(1)):i(r):"true"===r?!0:!1}return f?"true":"false"},n._SimplifyNegation=function(n){return n=n.replace(/^[\s!]+/,function(n){return n=n.replace(/[\s]/g,function(){return""}),n.length%2?"!":""}),n=n.trim(),"!true"===n?n="false":"!false"===n&&(n="true"),n},n}();n.AndOrNotEvaluator=t}(n.Internals||(n.Internals={}));n.Internals}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r,u,f,e){this._enabled=!0;this._refCount=0;this._name=i;this._renderTexture=new n.RenderTargetTexture(i,r,t);this.setRenderList(u);this._renderTexture.onBeforeRender=f;this._renderTexture.onAfterRender=e;this._scene=t}return t.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},t.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},t.prototype._update=function(){this.setRenderList(this._renderList)},t.prototype.setRenderList=function(n){this._renderTexture.renderList=n},t.prototype.getRenderTexture=function(){return this._renderTexture},t}();n.PostProcessRenderPass=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t,i,r){this._engine=n;this._name=t;this._singleInstance=r||!0;this._getPostProcess=i;this._cameras=[];this._postProcesses=[];this._indicesForCamera=[];this._renderPasses=[];this._renderEffectAsPasses=[]}return t.prototype._update=function(){for(var n in this._renderPasses)this._renderPasses[n]._update()},t.prototype.addPass=function(n){this._renderPasses[n._name]=n;this._linkParameters()},t.prototype.removePass=function(n){delete this._renderPasses[n._name];this._linkParameters()},t.prototype.addRenderEffectAsPass=function(n){this._renderEffectAsPasses[n._name]=n;this._linkParameters()},t.prototype.getPass=function(n){for(var t in this._renderPasses)if(t===n)return this._renderPasses[n]},t.prototype.emptyPasses=function(){this._renderPasses.length=0;this._linkParameters()},t.prototype._attachCameras=function(t){for(var u,r,i,o,s,e=n.Tools.MakeArray(t||this._cameras),f=0;f<e.length;f++){r=e[f];i=r.name;u=this._singleInstance?0:i;this._postProcesses[u]=this._postProcesses[u]||this._getPostProcess();o=r.attachPostProcess(this._postProcesses[u]);this._indicesForCamera[i]||(this._indicesForCamera[i]=[]);this._indicesForCamera[i].push(o);-1===this._cameras.indexOf(r)&&(this._cameras[i]=r);for(s in this._renderPasses)this._renderPasses[s]._incRefCount()}this._linkParameters()},t.prototype._detachCameras=function(t){for(var f,r,e,o,u=n.Tools.MakeArray(t||this._cameras),i=0;i<u.length;i++){f=u[i];r=f.name;f.detachPostProcess(this._postProcesses[this._singleInstance?0:r],this._indicesForCamera[r]);e=this._cameras.indexOf(r);this._indicesForCamera.splice(e,1);this._cameras.splice(e,1);for(o in this._renderPasses)this._renderPasses[o]._decRefCount()}},t.prototype._enable=function(t){for(var o,f=n.Tools.MakeArray(t||this._cameras),i=0;i<f.length;i++){for(var e=f[i],r=e.name,u=0;u<this._indicesForCamera[r].length;u++)void 0===e._postProcesses[this._indicesForCamera[r][u]]&&t[i].attachPostProcess(this._postProcesses[this._singleInstance?0:r],this._indicesForCamera[r][u]);for(o in this._renderPasses)this._renderPasses[o]._incRefCount()}},t.prototype._disable=function(t){for(var u,f,e,r=n.Tools.MakeArray(t||this._cameras),i=0;i<r.length;i++){u=r[i];f=u.Name;u.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);for(e in this._renderPasses)this._renderPasses[e]._decRefCount()}},t.prototype.getPostProcess=function(n){return this._singleInstance?this._postProcesses[0]:this._postProcesses[n.name]},t.prototype._linkParameters=function(){var t=this;for(var n in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[n]),this._postProcesses[n].onBeforeRender=function(n){t._linkTextures(n)}},t.prototype._linkTextures=function(n){var t,i;for(t in this._renderPasses)n.setTexture(t,this._renderPasses[t].getRenderTexture());for(i in this._renderEffectAsPasses)n.setTextureFromPostProcess(i+"Sampler",this._renderEffectAsPasses[i].getPostProcess())},t}();n.PostProcessRenderEffect=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n,t){this._engine=n;this._name=t;this._renderEffects=[];this._renderEffectsForIsolatedPass=[];this._cameras=[]}return t.prototype.addEffect=function(n){this._renderEffects[n._name]=n},t.prototype._enableEffect=function(t,i){var r=this._renderEffects[t];r&&r._enable(n.Tools.MakeArray(i||this._cameras))},t.prototype._disableEffect=function(t,i){var r=this._renderEffects[t];r&&r._disable(n.Tools.MakeArray(i||this._cameras))},t.prototype._attachCameras=function(t,i){for(var u,o,s,f=n.Tools.MakeArray(t||this._cameras),e=[],r=0;r<f.length;r++)u=f[r],o=u.name,-1===this._cameras.indexOf(u)?this._cameras[o]=u:i&&e.push(r);for(r=0;r<e.length;r++)t.splice(e[r],1);for(s in this._renderEffects)this._renderEffects[s]._attachCameras(f)},t.prototype._detachCameras=function(t){var r=n.Tools.MakeArray(t||this._cameras),u,i;for(u in this._renderEffects)this._renderEffects[u]._detachCameras(r);for(i=0;i<r.length;i++)this._cameras.splice(this._cameras.indexOf(r[i]),1)},t.prototype._enableDisplayOnlyPass=function(i,r){var c=this,s=n.Tools.MakeArray(r||this._cameras),f=null,e,o,h,u;for(e in this._renderEffects)if(f=this._renderEffects[e].getPass(i),null!=f)break;if(null!==f){for(e in this._renderEffects)this._renderEffects[e]._disable(s);for(f._name=t.PASS_SAMPLER_NAME,o=0;o<s.length;o++)h=s[o],u=h.name,this._renderEffectsForIsolatedPass[u]=this._renderEffectsForIsolatedPass[u]||new n.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new n.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,c._engine,!0)}),this._renderEffectsForIsolatedPass[u].emptyPasses(),this._renderEffectsForIsolatedPass[u].addPass(f),this._renderEffectsForIsolatedPass[u]._attachCameras(h)}},t.prototype._disableDisplayOnlyPass=function(i){for(var e,r,o,s=this,u=n.Tools.MakeArray(i||this._cameras),f=0;f<u.length;f++)e=u[f],r=e.name,this._renderEffectsForIsolatedPass[r]=this._renderEffectsForIsolatedPass[r]||new n.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new n.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,s._engine,!0)}),this._renderEffectsForIsolatedPass[r]._disable(e);for(o in this._renderEffects)this._renderEffects[o]._enable(u)},t.prototype._update=function(){var i,n,t;for(i in this._renderEffects)this._renderEffects[i]._update();for(n=0;n<this._cameras.length;n++)t=this._cameras[n].name,this._renderEffectsForIsolatedPass[t]&&this._renderEffectsForIsolatedPass[t]._update()},t.PASS_EFFECT_NAME="passEffect",t.PASS_SAMPLER_NAME="passSampler",t}();n.PostProcessRenderPipeline=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(){this._renderPipelines=[]}return n.prototype.addPipeline=function(n){this._renderPipelines[n._name]=n},n.prototype.attachCamerasToRenderPipeline=function(n,t,i){var r=this._renderPipelines[n];r&&r._attachCameras(t,i)},n.prototype.detachCamerasFromRenderPipeline=function(n,t){var i=this._renderPipelines[n];i&&i._detachCameras(t)},n.prototype.enableEffectInPipeline=function(n,t,i){var r=this._renderPipelines[n];r&&r._enableEffect(t,i)},n.prototype.disableEffectInPipeline=function(n,t,i){var r=this._renderPipelines[n];r&&r._disableEffect(t,i)},n.prototype.enableDisplayOnlyPassInPipeline=function(n,t,i){var r=this._renderPipelines[n];r&&r._enableDisplayOnlyPass(t,i)},n.prototype.disableDisplayOnlyPassInPipeline=function(n,t){var i=this._renderPipelines[n];i&&i._disableDisplayOnlyPass(t)},n.prototype.update=function(){for(var n in this._renderPipelines)this._renderPipelines[n]._update()},n}();n.PostProcessRenderPipelineManager=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r,u,f,e){n.call(this,t,"displayPass",["passSampler"],["passSampler"],i,r,u,f,e)}return __extends(t,n),t}(n.PostProcess);n.DisplayPassPostProcess=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t){this.frontColor=new n.Color3(1,1,1);this.backColor=new n.Color3(.1,.1,.1);this.showBackLines=!0;this.renderList=new n.SmartArray(32);this._scene=t;this._colorShader=new n.ShaderMaterial("colorShader",t,"color",{attributes:["position"],uniforms:["worldViewProjection","color"]});var i=this._scene.getEngine(),r=n.VertexData.CreateBox(1);this._vb=new n.VertexBuffer(i,r.positions,n.VertexBuffer.PositionKind,!1);this._ib=i.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}return t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(){var t,i;if(0!=this.renderList.length&&this._colorShader.isReady()){for(t=this._scene.getEngine(),t.setDepthWrite(!1),this._colorShader._preBind(),i=0;i<this.renderList.length;i++){var u=this.renderList.data[i],e=u.minimum,s=u.maximum,r=s.subtract(e),f=e.add(r.scale(.5)),o=n.Matrix.Scaling(r.x,r.y,r.z).multiply(n.Matrix.Translation(f.x,f.y,f.z)).multiply(u.getWorldMatrix());t.bindBuffers(this._vb.getBuffer(),this._ib,[3],12,this._colorShader.getEffect());this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(o),t.draw(!1,0,24));t.setDepthFunctionToLess();this._colorShader.setColor4("color",this.frontColor.toColor4());this._colorShader.bind(o);t.draw(!1,0,24)}this._colorShader.unbind();t.setDepthFunctionToLessOrEqual();t.setDepthWrite(!0)}},t.prototype.dispose=function(){this._colorShader.dispose();this._vb.dispose();this._scene.getEngine()._releaseBuffer(this._ib)},t}();n.BoundingBoxRenderer=t}(BABYLON||(BABYLON={}));!function(n){!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(n){var t=0;return{id_length:n[t++],colormap_type:n[t++],image_type:n[t++],colormap_index:n[t++]|n[t++]<<8,colormap_length:n[t++]|n[t++]<<8,colormap_size:n[t++],origin:[n[t++]|n[t++]<<8,n[t++]|n[t++]<<8],width:n[t++]|n[t++]<<8,height:n[t++]|n[t++]<<8,pixel_size:n[t++],flags:n[t++]}},t.UploadContent=function(i,r){var e,u,c,it,o,l,g,s,f,h,nt,a,v,y,p,w,b,rt,ut;if(r.length<19)return void n.Tools.Error("Unable to load TGA file - Not enough data to contain header");if(e=18,u=t.GetTGAHeader(r),u.id_length+e>r.length)return void n.Tools.Error("Unable to load TGA file - Not enough data");e+=u.id_length;var k=!1,d=!1,ft=!1,tt=!1;switch(u.image_type){case t._TYPE_RLE_INDEXED:k=!0;case t._TYPE_INDEXED:d=!0;break;case t._TYPE_RLE_RGB:k=!0;case t._TYPE_RGB:ft=!0;break;case t._TYPE_RLE_GREY:k=!0;case t._TYPE_GREY:tt=!0}if(o=(15&u.flags,u.pixel_size>>3),l=u.width*u.height*o,d&&(it=r.subarray(e,e+=u.colormap_length*(u.colormap_size>>3))),k)for(c=new Uint8Array(l),h=0,nt=new Uint8Array(o);l>e&&l>h;)if(g=r[e++],s=(127&g)+1,128&g){for(f=0;o>f;++f)nt[f]=r[e++];for(f=0;s>f;++f)c.set(nt,h+f*o);h+=o*s}else{for(s*=o,f=0;s>f;++f)c[h+f]=r[e++];h+=s}else c=r.subarray(e,e+=d?u.width*u.height:l);switch((u.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:a=0;y=1;b=u.width;v=0;p=1;w=u.height;break;case t._ORIGIN_BL:a=0;y=1;b=u.width;v=u.height-1;p=-1;w=-1;break;case t._ORIGIN_UR:a=u.width-1;y=-1;b=-1;v=0;p=1;w=u.height;break;case t._ORIGIN_BR:a=u.width-1;y=-1;b=-1;v=u.height-1;p=-1;w=-1}rt="_getImageData"+(tt?"Grey":"")+u.pixel_size+"bits";ut=t[rt](u,it,c,v,p,w,a,y,b);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,u.width,u.height,0,i.RGBA,i.UNSIGNED_BYTE,ut)},t._getImageData8bits=function(n,t,i,r,u,f,e,o,s){for(var v,h,w=i,y=t,l=n.width,b=n.height,p=0,a=new Uint8Array(l*b*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,p++)v=w[p],a[4*(h+l*c)+3]=255,a[4*(h+l*c)+2]=y[3*v+0],a[4*(h+l*c)+1]=y[3*v+1],a[4*(h+l*c)+0]=y[3*v+2];return a},t._getImageData16bits=function(n,t,i,r,u,f,e,o,s){for(var l,h,p=i,a=n.width,w=n.height,y=0,v=new Uint8Array(a*w*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,y+=2)l=p[y+0]+(p[y+1]<<8),v[4*(h+a*c)+0]=(31744&l)>>7,v[4*(h+a*c)+1]=(992&l)>>2,v[4*(h+a*c)+2]=(31&l)>>3,v[4*(h+a*c)+3]=32768&l?0:255;return v},t._getImageData24bits=function(n,t,i,r,u,f,e,o,s){for(var h,y=i,l=n.width,p=n.height,v=0,a=new Uint8Array(l*p*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,v+=3)a[4*(h+l*c)+3]=255,a[4*(h+l*c)+2]=y[v+0],a[4*(h+l*c)+1]=y[v+1],a[4*(h+l*c)+0]=y[v+2];return a},t._getImageData32bits=function(n,t,i,r,u,f,e,o,s){for(var h,y=i,l=n.width,p=n.height,a=0,v=new Uint8Array(l*p*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,a+=4)v[4*(h+l*c)+2]=y[a+0],v[4*(h+l*c)+1]=y[a+1],v[4*(h+l*c)+0]=y[a+2],v[4*(h+l*c)+3]=y[a+3];return v},t._getImageDataGrey8bits=function(n,t,i,r,u,f,e,o,s){for(var v,h,p=i,l=n.width,w=n.height,y=0,a=new Uint8Array(l*w*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,y++)v=p[y],a[4*(h+l*c)+0]=v,a[4*(h+l*c)+1]=v,a[4*(h+l*c)+2]=v,a[4*(h+l*c)+3]=255;return a},t._getImageDataGrey16bits=function(n,t,i,r,u,f,e,o,s){for(var h,y=i,l=n.width,p=n.height,a=0,v=new Uint8Array(l*p*4),c=r;c!==f;c+=u)for(h=e;h!==s;h+=o,a+=2)v[4*(h+l*c)+0]=y[a+0],v[4*(h+l*c)+1]=y[a+0],v[4*(h+l*c)+2]=y[a+0],v[4*(h+l*c)+3]=y[a+1];return v},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(n.Internals||(n.Internals={}));n.Internals}(BABYLON||(BABYLON={}));!function(n){!function(t){function i(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<24)}function y(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)}var p=542327876,u=131072,f=512,e=4,o=64,s=131072,w=i("DXT1"),b=i("DXT3"),k=i("DXT5"),h=31,d=0,g=1,c=2,l=3,a=4,v=7,r=20,nt=21,tt=22,it=28,rt=function(){function t(){}return t.GetDDSInfo=function(n){var t=new Int32Array(n,0,h),i=1;return t[c]&u&&(i=Math.max(1,t[v])),{width:t[a],height:t[l],mipmapCount:i,isFourCC:(t[r]&e)===e,isRGB:(t[r]&o)===o,isLuminance:(t[r]&s)===s,isCube:(t[it]&f)===f}},t.GetRGBAArrayBuffer=function(n,t,i,r,u){for(var h,o,f=new Uint8Array(r),s=new Uint8Array(u),e=0,c=t-1;c>=0;c--)for(h=0;n>h;h++)o=i+4*(h+c*n),f[e+2]=s[o],f[e+1]=s[o+1],f[e]=s[o+2],f[e+3]=s[o+3],e+=4;return f},t.GetRGBArrayBuffer=function(n,t,i,r,u){for(var o,s,f=new Uint8Array(r),h=new Uint8Array(u),e=0,c=t-1;c>=0;c--)for(o=0;n>o;o++)s=i+3*(o+c*n),f[e+2]=h[s],f[e+1]=h[s+1],f[e]=h[s+2],e+=3;return f},t.GetLuminanceArrayBuffer=function(n,t,i,r,u){for(var f,h,o=new Uint8Array(r),c=new Uint8Array(u),s=0,e=t-1;e>=0;e--)for(f=0;n>f;f++)h=i+(f+e*n),o[s]=c[h],s++;return o},t.UploadDDSLevels=function(i,r,f,e,o,s){var pt,ct,lt,it,rt,ut,st,ft,vt,ot,et=new Int32Array(f,0,h),wt,at,ht;if(et[d]!=p)return void n.Tools.Error("Invalid magic number in DDS header");if(!e.isFourCC&&!e.isRGB&&!e.isLuminance)return void n.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(e.isFourCC)switch(pt=et[nt]){case w:ct=8;lt=r.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case b:ct=16;lt=r.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case k:ct=16;lt=r.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",y(pt))}for(vt=1,et[c]&u&&o!==!1&&(vt=Math.max(1,et[v])),wt=et[tt],at=0;s>at;at++)for(ht=1==s?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+at,it=et[a],rt=et[l],st=et[g]+4,ot=0;vt>ot;++ot){if(e.isRGB)24==wt?(ut=it*rt*3,ft=t.GetRGBArrayBuffer(it,rt,st,ut,f),i.texImage2D(ht,ot,i.RGB,it,rt,0,i.RGB,i.UNSIGNED_BYTE,ft)):(ut=it*rt*4,ft=t.GetRGBAArrayBuffer(it,rt,st,ut,f),i.texImage2D(ht,ot,i.RGBA,it,rt,0,i.RGBA,i.UNSIGNED_BYTE,ft));else if(e.isLuminance){var yt=i.getParameter(i.UNPACK_ALIGNMENT),bt=it,kt=Math.floor((it+yt-1)/yt)*yt;ut=kt*(rt-1)+bt;ft=t.GetLuminanceArrayBuffer(it,rt,st,ut,f);i.texImage2D(ht,ot,i.LUMINANCE,it,rt,0,i.LUMINANCE,i.UNSIGNED_BYTE,ft)}else ut=Math.max(4,it)/4*Math.max(4,rt)/4*ct,ft=new Uint8Array(f,st,ut),i.compressedTexImage2D(ht,ot,lt,it,rt,0,ft);st+=ut;it*=.5;rt*=.5;it=Math.max(1,it);rt=Math.max(1,rt)}},t}();t.DDSTools=rt}(n.Internals||(n.Internals={}));n.Internals}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(t){this.length=0;this._duplicateId=0;this.data=new Array(t);this._id=n._GlobalId++}return n.prototype.push=function(n){this.data[this.length++]=n;this.length>this.data.length&&(this.data.length*=2);n.__smartArrayFlags||(n.__smartArrayFlags={});n.__smartArrayFlags[this._id]=this._duplicateId},n.prototype.pushNoDuplicate=function(n){n.__smartArrayFlags&&n.__smartArrayFlags[this._id]===this._duplicateId||this.push(n)},n.prototype.sort=function(n){this.data.sort(n)},n.prototype.reset=function(){this.length=0;this._duplicateId++},n.prototype.concat=function(n){if(0!==n.length){this.length+n.length>this.data.length&&(this.data.length=2*(this.length+n.length));for(var t=0;t<n.length;t++)this.data[this.length++]=(n.data||n)[t]}},n.prototype.concatWithNoDuplicate=function(n){var t,i;if(0!==n.length)for(this.length+n.length>this.data.length&&(this.data.length=2*(this.length+n.length)),t=0;t<n.length;t++)i=(n.data||n)[t],this.pushNoDuplicate(i)},n.prototype.indexOf=function(n){var t=this.data.indexOf(n);return t>=this.length?-1:t},n._GlobalId=0,n}();n.SmartArray=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(){this._registeredMeshes=[];this._physicsMaterials=[];this.updateBodyPosition=function(n){for(var r,t,u,i=0;i<this._registeredMeshes.length;i++)if(r=this._registeredMeshes[i],r.mesh===n||r.mesh===n.parent)return t=r.body.body,u=n.getBoundingInfo().boundingBox.center,t.position.set(u.x,u.z,u.y),t.quaternion.x=n.rotationQuaternion.x,t.quaternion.z=n.rotationQuaternion.y,t.quaternion.y=n.rotationQuaternion.z,void(t.quaternion.w=-n.rotationQuaternion.w)}}return t.prototype.initialize=function(n){"undefined"==typeof n&&(n=10);this._world=new CANNON.World;this._world.broadphase=new CANNON.NaiveBroadphase;this._world.solver.iterations=n},t.prototype._checkWithEpsilon=function(t){return t<n.PhysicsEngine.Epsilon?n.PhysicsEngine.Epsilon:t},t.prototype.runOneStep=function(t){var r,i;for(this._world.step(t),r=0;r<this._registeredMeshes.length;r++)if(i=this._registeredMeshes[r],!i.isChild){var f=i.body.position.x,e=i.body.position.y,o=i.body.position.z,u=i.delta;u?(i.mesh.position.x=f+u.x,i.mesh.position.y=o+u.y,i.mesh.position.z=e+u.z):(i.mesh.position.x=f,i.mesh.position.y=o,i.mesh.position.z=e);i.mesh.rotationQuaternion||(i.mesh.rotationQuaternion=new n.Quaternion(0,0,0,1));i.mesh.rotationQuaternion.x=i.body.quaternion.x;i.mesh.rotationQuaternion.y=i.body.quaternion.z;i.mesh.rotationQuaternion.z=i.body.quaternion.y;i.mesh.rotationQuaternion.w=-i.body.quaternion.w}},t.prototype.setGravity=function(n){this._world.gravity.set(n.x,n.z,n.y)},t.prototype.registerMesh=function(t,i,r){var e,o;switch(this.unregisterMesh(t),t.computeWorldMatrix(!0),i){case n.PhysicsEngine.SphereImpostor:var u=t.getBoundingInfo().boundingBox,s=u.maximumWorld.x-u.minimumWorld.x,h=u.maximumWorld.y-u.minimumWorld.y,c=u.maximumWorld.z-u.minimumWorld.z;return this._createSphere(Math.max(this._checkWithEpsilon(s),this._checkWithEpsilon(h),this._checkWithEpsilon(c))/2,t,r);case n.PhysicsEngine.BoxImpostor:u=t.getBoundingInfo().boundingBox;var l=u.minimumWorld,a=u.maximumWorld,f=a.subtract(l).scale(.5);return this._createBox(this._checkWithEpsilon(f.x),this._checkWithEpsilon(f.y),this._checkWithEpsilon(f.z),t,r);case n.PhysicsEngine.PlaneImpostor:return this._createPlane(t,r);case n.PhysicsEngine.MeshImpostor:return e=t.getVerticesData(n.VertexBuffer.PositionKind),o=t.getIndices(),this._createConvexPolyhedron(e,o,t,r)}return null},t.prototype._createSphere=function(n,t,i){var r=new CANNON.Sphere(n);return i?this._createRigidBodyFromShape(r,t,i.mass,i.friction,i.restitution):r},t.prototype._createBox=function(n,t,i,r,u){var f=new CANNON.Box(new CANNON.Vec3(n,i,t));return u?this._createRigidBodyFromShape(f,r,u.mass,u.friction,u.restitution):f},t.prototype._createPlane=function(n,t){var i=new CANNON.Plane;return t?this._createRigidBodyFromShape(i,n,t.mass,t.friction,t.restitution):i},t.prototype._createConvexPolyhedron=function(t,i,r,u){var h=[],c=[],f,o,e,s;for(r.computeWorldMatrix(!0),f=0;f<t.length;f+=3)o=n.Vector3.Zero(),n.Vector3.TransformNormalFromFloatsToRef(t[f],t[f+1],t[f+2],r.getWorldMatrix(),o),h.push(new CANNON.Vec3(o.x,o.z,o.y));for(e=0;e<i.length;e+=3)c.push([i[e],i[e+2],i[e+1]]);return s=new CANNON.ConvexPolyhedron(h,c),u?this._createRigidBodyFromShape(s,r,u.mass,u.friction,u.restitution):s},t.prototype._addMaterial=function(n,t){for(var r,u,f,i=0;i<this._physicsMaterials.length;i++)if(r=this._physicsMaterials[i],r.friction===n&&r.restitution===t)return r;for(u=new CANNON.Material,u.friction=n,u.restitution=t,this._physicsMaterials.push(u),i=0;i<this._physicsMaterials.length;i++)r=this._physicsMaterials[i],f=new CANNON.ContactMaterial(r,u,r.friction*u.friction,r.restitution*u.restitution),f.contactEquationStiffness=1e10,f.contactEquationRegularizationTime=10,this._world.addContactMaterial(f);return u},t.prototype._createRigidBodyFromShape=function(t,i,r,u,f){var o=null;i.rotationQuaternion&&(o=i.rotationQuaternion.clone(),i.rotationQuaternion=new n.Quaternion(0,0,0,1));var s=i.getBoundingInfo().boundingBox,c=i.position.subtract(s.center),h=this._addMaterial(u,f),e=new CANNON.RigidBody(r,t,h);return o&&(e.quaternion.x=o.x,e.quaternion.z=o.y,e.quaternion.y=o.z,e.quaternion.w=-o.w),e.position.set(s.center.x,s.center.z,s.center.y),this._world.add(e),this._registeredMeshes.push({mesh:i,body:e,material:h,delta:c}),e},t.prototype.registerMeshesAsCompound=function(n,t){for(var r,f,o,e,u=new CANNON.Compound,i=0;i<n.length;i++)r=n[i].mesh,f=this.registerMesh(r,n[i].impostor),0==i?u.addChild(f,new CANNON.Vec3(0,0,0)):u.addChild(f,new CANNON.Vec3(r.position.x,r.position.z,r.position.y));return o=n[0].mesh,e=this._createRigidBodyFromShape(u,o,t.mass,t.friction,t.restitution),e.parts=n,e},t.prototype._unbindBody=function(n){for(var i,t=0;t<this._registeredMeshes.length;t++)i=this._registeredMeshes[t],i.body===n&&(i.body=null,i.delta=0)},t.prototype.unregisterMesh=function(n){for(var i,t=0;t<this._registeredMeshes.length;t++)if(i=this._registeredMeshes[t],i.mesh===n)return i.body&&(this._world.remove(i.body),this._unbindBody(i.body)),void this._registeredMeshes.splice(t,1)},t.prototype.applyImpulse=function(n,t,i){for(var u,f=new CANNON.Vec3(i.x,i.z,i.y),e=new CANNON.Vec3(t.x,t.z,t.y),r=0;r<this._registeredMeshes.length;r++)if(u=this._registeredMeshes[r],u.mesh===n)return void u.body.applyImpulse(e,f)},t.prototype.createLink=function(n,t,i,r){for(var u,s,f=null,e=null,o=0;o<this._registeredMeshes.length;o++)u=this._registeredMeshes[o],u.mesh===n?f=u.body:u.mesh===t&&(e=u.body);return!f||!e?!1:(s=new CANNON.PointToPointConstraint(f,new CANNON.Vec3(i.x,i.z,i.y),e,new CANNON.Vec3(r.x,r.z,r.y)),this._world.addConstraint(s),!0)},t.prototype.dispose=function(){for(;this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==window.CANNON},t}();n.CannonJSPlugin=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(){function n(n){this._actionManager=n}return n.prototype.isValid=function(){return!0},n.prototype._getProperty=function(n){return this._actionManager._getProperty(n)},n.prototype._getEffectiveTarget=function(n,t){return this._actionManager._getEffectiveTarget(n,t)},n}(),i,r,u;n.Condition=t;i=function(n){function t(i,r,u,f,e){"undefined"==typeof e&&(e=t.IsEqual);n.call(this,i);this.propertyPath=u;this.value=f;this.operator=e;this._target=this._getEffectiveTarget(r,this.propertyPath);this._property=this._getProperty(this.propertyPath)}return __extends(t,n),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._target[this._property]>this.value;case t.IsLesser:return this._target[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var n;return n=this.value.equals?this.value.equals(this._target[this._property]):this.value===this._target[this._property],this.operator===t.IsEqual?n:!n}return!1},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(t);n.ValueCondition=i;r=function(n){function t(t,i){n.call(this,t);this.predicate=i}return __extends(t,n),t.prototype.isValid=function(){return this.predicate()},t}(t);n.PredicateCondition=r;u=function(n){function t(t,i,r){n.call(this,t);this.value=r;this._target=i}return __extends(t,n),t.prototype.isValid=function(){return this._target.state===this.value},t}(t);n.StateCondition=u}(BABYLON||(BABYLON={}));!function(n){var t=function(){function n(n,t){this.triggerOptions=n;n.parameter?(this.trigger=n.trigger,this._triggerParameter=n.parameter):this.trigger=n;this._nextActiveAction=this;this._condition=t}return n.prototype._prepare=function(){},n.prototype.getTriggerParameter=function(){return this._triggerParameter},n.prototype._executeCurrent=function(n){if(this._condition){var t=this._actionManager.getScene().getRenderId();if(this._condition._evaluationId===t){if(!this._condition._currentResult)return}else{if(this._condition._evaluationId=t,!this._condition.isValid())return void(this._condition._currentResult=!1);this._condition._currentResult=!0}}this._nextActiveAction.execute(n);this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},n.prototype.execute=function(){},n.prototype.then=function(n){return this._child=n,n._actionManager=this._actionManager,n._prepare(),n},n.prototype._getProperty=function(n){return this._actionManager._getProperty(n)},n.prototype._getEffectiveTarget=function(n,t){return this._actionManager._getEffectiveTarget(n,t)},n}();n.Action=t}(BABYLON||(BABYLON={}));!function(n){var i=function(){function n(n,t,i,r,u){this.source=n;this.pointerX=t;this.pointerY=i;this.meshUnderPointer=r;this.sourceEvent=u}return n.CreateNew=function(t){var i=t.getScene();return new n(t,i.pointerX,i.pointerY,i.meshUnderPointer)},n.CreateNewFromScene=function(t,i){return new n(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},n}(),t;n.ActionEvent=i;t=function(){function t(n){this.actions=[];this._scene=n;n._actionManagers.push(this)}return Object.defineProperty(t,"NothingTrigger",{get:function(){return t._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickTrigger",{get:function(){return t._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLeftPickTrigger",{get:function(){return t._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnRightPickTrigger",{get:function(){return t._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnCenterPickTrigger",{get:function(){return t._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOverTrigger",{get:function(){return t._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOutTrigger",{get:function(){return t._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnEveryFrameTrigger",{get:function(){return t._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionEnterTrigger",{get:function(){return t._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionExitTrigger",{get:function(){return t._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyDownTrigger",{get:function(){return t._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyUpTrigger",{get:function(){return t._OnKeyUpTrigger},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this._scene._actionManagers.indexOf(this);n>-1&&this._scene._actionManagers.splice(n,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(n){for(var i,t=0;t<this.actions.length;t++)if(i=this.actions[t],n.indexOf(i.trigger)>-1)return!0;return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var i,n=0;n<this.actions.length;n++)if(i=this.actions[n],i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPointerOutTrigger)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var i,n=0;n<this.actions.length;n++)if(i=this.actions[n],i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnCenterPickTrigger)return!0;return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(i){return i.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(n.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),i._actionManager=this,i._prepare(),i)},t.prototype.processTrigger=function(n,i){for(var u,f,r=0;r<this.actions.length;r++)if(u=this.actions[r],u.trigger===n){if((n==t.OnKeyUpTrigger||n==t.OnKeyDownTrigger)&&(f=u.getTriggerParameter(),f&&i.sourceEvent.key!==f))continue;u._executeCurrent(i)}},t.prototype._getEffectiveTarget=function(n,t){for(var r=t.split("."),i=0;i<r.length-1;i++)n=n[r[i]];return n},t.prototype._getProperty=function(n){var t=n.split(".");return t[t.length-1]},t._NothingTrigger=0,t._OnPickTrigger=1,t._OnLeftPickTrigger=2,t._OnRightPickTrigger=3,t._OnCenterPickTrigger=4,t._OnPointerOverTrigger=5,t._OnPointerOutTrigger=6,t._OnEveryFrameTrigger=7,t._OnIntersectionEnterTrigger=8,t._OnIntersectionExitTrigger=9,t._OnKeyDownTrigger=10,t._OnKeyUpTrigger=11,t}();n.ActionManager=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(n,i,r,u,f,e,o){"undefined"==typeof f&&(f=1e3);t.call(this,n,e);this.propertyPath=r;this.value=u;this.duration=f;this.stopOtherAnimations=o;this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath);this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){var t,r=this._actionManager.getScene(),u=[{frame:0,value:this._target[this._property]},{frame:100,value:this.value}],i;if("number"==typeof this.value)t=n.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof n.Color3)t=n.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof n.Vector3)t=n.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof n.Matrix)t=n.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof n.Quaternion))return void n.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=n.Animation.ANIMATIONTYPE_QUATERNION}i=new n.Animation("InterpolateValueAction",this._property,1e5/this.duration,t,n.Animation.ANIMATIONLOOPMODE_CONSTANT);i.setKeys(u);this.stopOtherAnimations&&r.stopAnimation(this._target);r.beginDirectAnimation(this._target,[i],0,100)},i}(n.Action);n.InterpolateValueAction=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var c=function(n){function t(t,i,r,u){n.call(this,t,u);this.propertyPath=r;this._target=i}return __extends(t,n),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath);this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(n.Action),t,i,r,u,f,e,o,s,h;n.SwitchBooleanAction=c;t=function(n){function t(t,i,r,u){n.call(this,t,u);this.value=r;this._target=i}return __extends(t,n),t.prototype.execute=function(){this._target.state=this.value},t}(n.Action);n.SetStateAction=t;i=function(n){function t(t,i,r,u,f){n.call(this,t,f);this.propertyPath=r;this.value=u;this._target=i}return __extends(t,n),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath);this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(n.Action);n.SetValueAction=i;r=function(t){function i(n,i,r,u,f){t.call(this,n,f);this.propertyPath=r;this.value=u;this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath);this._property=this._getProperty(this.propertyPath);"number"!=typeof this._target[this._property]&&n.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(n.Action);n.IncrementValueAction=r;u=function(n){function t(t,i,r,u,f,e){n.call(this,t,e);this.from=r;this.to=u;this.loop=f;this._target=i}return __extends(t,n),t.prototype._prepare=function(){},t.prototype.execute=function(){var n=this._actionManager.getScene();n.beginAnimation(this._target,this.from,this.to,this.loop)},t}(n.Action);n.PlayAnimationAction=u;f=function(n){function t(t,i,r){n.call(this,t,r);this._target=i}return __extends(t,n),t.prototype._prepare=function(){},t.prototype.execute=function(){var n=this._actionManager.getScene();n.stopAnimation(this._target)},t}(n.Action);n.StopAnimationAction=f;e=function(t){function i(i,r){"undefined"==typeof i&&(i=n.ActionManager.NothingTrigger);t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(n.Action);n.DoNothingAction=e;o=function(n){function t(t,i,r){n.call(this,t,r);this.children=i}return __extends(t,n),t.prototype._prepare=function(){for(var n=0;n<this.children.length;n++)this.children[n]._actionManager=this._actionManager,this.children[n]._prepare()},t.prototype.execute=function(n){for(var t=0;t<this.children.length;t++)this.children[t].execute(n)},t}(n.Action);n.CombineAction=o;s=function(n){function t(t,i,r){n.call(this,t,r);this.func=i}return __extends(t,n),t.prototype.execute=function(n){this.func(n)},t}(n.Action);n.ExecuteCodeAction=s;h=function(t){function i(n,i,r,u){t.call(this,n,u);this._target=i;this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert();this._target.position=n.Vector3.TransformCoordinates(this._target.position,t);this._target.parent=this._parent}},i}(n.Action);n.SetParentAction=h}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(){function t(t,i,r,u,f){this.delayLoadState=n.Engine.DELAYLOADSTATE_NONE;this._totalVertices=0;this._indices=[];this.id=t;this._engine=i.getEngine();this._meshes=[];this._scene=i;r?this.setAllVerticesData(r,u):(this._totalVertices=0,this._indices=[]);f&&this.applyToMesh(f)}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===n.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===n.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(n,t){n.applyToGeometry(this,t)},t.prototype.setVerticesData=function(t,i,r){var e,u;if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new n.VertexBuffer(this._engine,i,t,r,0===this._meshes.length),t===n.VertexBuffer.PositionKind){e=this._vertexBuffers[t].getStrideSize();this._totalVertices=i.length/e;for(var o=n.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,h=s.length,f=0;h>f;f++)u=s[f],u._resetPointsArrayCache(),u._boundingInfo=new n.BoundingInfo(o.minimum,o.maximum),u._createGlobalSubMesh(),u.computeWorldMatrix(!0)}},t.prototype.updateVerticesDataDirectly=function(n,t){var i=this.getVertexBuffer(n);i&&i.updateDirectly(t)},t.prototype.updateVerticesData=function(t,i,r){var u=this.getVertexBuffer(t),f,s,o;if(u&&(u.update(i),t===n.VertexBuffer.PositionKind)){r&&(s=u.getStrideSize(),this._totalVertices=i.length/s,f=n.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var h=this._meshes,c=h.length,e=0;c>e;e++)o=h[e],o._resetPointsArrayCache(),r&&(o._boundingInfo=new n.BoundingInfo(f.minimum,f.maximum))}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(n){var t=this.getVertexBuffer(n);return t?t.getData():null},t.prototype.getVertexBuffer=function(n){return this.isReady()?this._vertexBuffers[n]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(n){return this._vertexBuffers?void 0!==this._vertexBuffers[n]:this._delayInfo?-1!==this._delayInfo.indexOf(n):!1},t.prototype.getVerticesDataKinds=function(){var t=[],n;if(!this._vertexBuffers&&this._delayInfo)for(n in this._delayInfo)t.push(n);else for(n in this._vertexBuffers)t.push(n);return t},t.prototype.setIndices=function(n){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indices=n;0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var i=this._meshes,r=i.length,t=0;r>t;t++)i[t]._createGlobalSubMesh()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(){return this.isReady()?this._indices:null},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(n,t){var i=this._meshes,r=i.indexOf(n),u;if(-1!==r){for(u in this._vertexBuffers)this._vertexBuffers[u].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null);i.splice(r,1);n._geometry=null;0==i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(n){var t,i;n._geometry!==this&&(t=n._geometry,t&&t.releaseForMesh(n),i=this._meshes,n._geometry=this,this._scene.pushGeometry(this),i.push(n),this.isReady()?this._applyToMesh(n):n._boundingInfo=this._boundingInfo)},t.prototype._applyToMesh=function(t){var r=this._meshes.length,i,u;for(i in this._vertexBuffers)(1===r&&this._vertexBuffers[i].create(),this._vertexBuffers[i]._buffer.references=r,i===n.VertexBuffer.PositionKind)&&(t._resetPointsArrayCache(),u=n.Tools.ExtractMinAndMax(this._vertexBuffers[i].getData(),0,this._totalVertices),t._boundingInfo=new n.BoundingInfo(u.minimum,u.maximum),t._createGlobalSubMesh());1===r&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));this._indexBuffer&&(this._indexBuffer.references=r)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==n.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=n.Engine.DELAYLOADSTATE_LOADING;t._addPendingData(this);n.Tools.LoadFile(this.delayLoadingFile,function(u){r._delayLoadingFunction(JSON.parse(u),r);r.delayLoadState=n.Engine.DELAYLOADSTATE_LOADED;r._delayInfo=[];t._removePendingData(r);for(var e=r._meshes,o=e.length,f=0;o>f;f++)r._applyToMesh(e[f]);i&&i()},function(){},t.database)}},t.prototype.dispose=function(){for(var u,i,r=this._meshes,f=r.length,t=0;f>t;t++)this.releaseForMesh(r[t]);this._meshes=[];for(u in this._vertexBuffers)this._vertexBuffers[u].dispose();this._vertexBuffers=[];this._totalVertices=0;this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indexBuffer=null;this._indices=[];this.delayLoadState=n.Engine.DELAYLOADSTATE_NONE;this.delayLoadingFile=null;this._delayLoadingFunction=null;this._delayInfo=[];this._boundingInfo=null;i=this._scene.getGeometries();t=i.indexOf(this);t>-1&&i.splice(t,1)},t.prototype.copy=function(t){var u=new n.VertexData,o,f,e,s,r,i,h;for(u.indices=[],o=this.getIndices(),f=0;f<o.length;f++)u.indices.push(o[f]);e=!1;s=!1;for(r in this._vertexBuffers)u.set(this.getVerticesData(r),r),s||(e=this.getVertexBuffer(r).isUpdatable(),s=!e);i=new n.Geometry(t,this._scene,u,e,null);i.delayLoadState=this.delayLoadState;i.delayLoadingFile=this.delayLoadingFile;i._delayLoadingFunction=this._delayLoadingFunction;for(r in this._delayInfo)i._delayInfo=i._delayInfo||[],i._delayInfo.push(r);return h=n.Tools.ExtractMinAndMax(this.getVerticesData(n.VertexBuffer.PositionKind),0,this.getTotalVertices()),i._boundingInfo=new n.BoundingInfo(h.minimum,h.maximum),i},t.ExtractFromMesh=function(n,t){var i=n._geometry;return i?i.copy(t):null},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,i="x"==n?t:3&t|8;return i.toString(16)})},t}();n.Geometry=t,function(t){!function(i){var r=function(n){function t(t,i,r,u,f){this._beingRegenerated=!0;this._canBeRegenerated=u;n.call(this,t,i,r,!1,f);this._beingRegenerated=!1}return __extends(t,n),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return n.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t){this._beingRegenerated&&n.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i){this._beingRegenerated&&n.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method");},t.prototype.copy=function(){throw new Error("Must be overriden in sub-classes.");},t}(t),u,f,e,o,s,h,c,l;i._Primitive=r;u=function(t){function i(n,i,r,u,f){this.size=r;t.call(this,n,i,this._regenerateVertexData(),u,f)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateBox(this.size)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.size,this.canBeRegenerated(),null)},i}(r);i.Box=u;f=function(t){function i(n,i,r,u,f,e){this.segments=r;this.diameter=u;t.call(this,n,i,this._regenerateVertexData(),f,e)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateSphere(this.segments,this.diameter)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null)},i}(r);i.Sphere=f;e=function(t){function i(n,i,r,u,f,e,o,s,h){"undefined"==typeof o&&(o=1);this.height=r;this.diameterTop=u;this.diameterBottom=f;this.tessellation=e;this.subdivisions=o;t.call(this,n,i,this._regenerateVertexData(),s,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Cylinder=e;o=function(t){function i(n,i,r,u,f,e,o){this.diameter=r;this.thickness=u;this.tessellation=f;t.call(this,n,i,this._regenerateVertexData(),e,o)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null)},i}(r);i.Torus=o;s=function(t){function i(n,i,r,u,f,e,o){this.width=r;this.height=u;this.subdivisions=f;t.call(this,n,i,this._regenerateVertexData(),e,o)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=s;h=function(t){function i(n,i,r,u,f,e,o,s,h,c){this.xmin=r;this.zmin=u;this.xmax=f;this.zmax=e;this.subdivisions=o;this.precision=s;t.call(this,n,i,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=h;c=function(t){function i(n,i,r,u,f){this.size=r;t.call(this,n,i,this._regenerateVertexData(),u,f)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreatePlane(this.size)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.size,this.canBeRegenerated(),null)},i}(r);i.Plane=c;l=function(t){function i(n,i,r,u,f,e,o,s,h,c){this.radius=r;this.tube=u;this.radialSegments=f;this.tubularSegments=e;this.p=o;this.q=s;t.call(this,n,i,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return n.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q)},i.prototype.copy=function(n){return new i(n,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null)},i}(r);i.TorusKnot=l}(t.Primitives||(t.Primitives={}));t.Primitives}(n.Geometry||(n.Geometry={}));t=n.Geometry}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var f=function(){function t(n){var t=this;this.babylonGamepads=[];this.oneGamepadConnected=!1;this.isMonitoring=!1;this.gamepadEventSupported="GamepadEvent"in window;this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads;this.buttonADataURL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=";this._callbackGamepadConnected=n;this.gamepadSupportAvailable?(this.gamepadEventSupported?(window.addEventListener("gamepadconnected",function(n){t._onGamepadConnected(n)},!1),window.addEventListener("gamepaddisconnected",function(n){t._onGamepadDisconnected(n)},!1)):this._startMonitoringGamepads(),this.oneGamepadConnected||this._insertGamepadDOMInstructions()):this._insertGamepadDOMNotSupported()}return t.prototype._insertGamepadDOMInstructions=function(){var i,n;t.gamepadDOMInfo=document.createElement("div");i=document.createElement("img");i.src=this.buttonADataURL;n=document.createElement("span");n.innerHTML="<strong>to activate gamepad<\/strong>";t.gamepadDOMInfo.appendChild(i);t.gamepadDOMInfo.appendChild(n);t.gamepadDOMInfo.style.position="absolute";t.gamepadDOMInfo.style.width="100%";t.gamepadDOMInfo.style.height="48px";t.gamepadDOMInfo.style.bottom="0px";t.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)";t.gamepadDOMInfo.style.textAlign="center";t.gamepadDOMInfo.style.zIndex="10";i.style.position="relative";i.style.bottom="8px";n.style.position="relative";n.style.fontSize="32px";n.style.bottom="32px";n.style.color="green";document.body.appendChild(t.gamepadDOMInfo)},t.prototype._insertGamepadDOMNotSupported=function(){t.gamepadDOMInfo=document.createElement("div");var n=document.createElement("span");n.innerHTML="<strong>gamepad not supported<\/strong>";t.gamepadDOMInfo.appendChild(n);t.gamepadDOMInfo.style.position="absolute";t.gamepadDOMInfo.style.width="100%";t.gamepadDOMInfo.style.height="40px";t.gamepadDOMInfo.style.bottom="0px";t.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)";t.gamepadDOMInfo.style.textAlign="center";t.gamepadDOMInfo.style.zIndex="10";n.style.position="relative";n.style.fontSize="32px";n.style.color="red";document.body.appendChild(t.gamepadDOMInfo)},t.prototype.dispose=function(){document.body.removeChild(t.gamepadDOMInfo)},t.prototype._onGamepadConnected=function(n){var t=this._addNewGamepad(n.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t);this._startMonitoringGamepads()},t.prototype._addNewGamepad=function(i){this.oneGamepadConnected||(this.oneGamepadConnected=!0,t.gamepadDOMInfo&&(document.body.removeChild(t.gamepadDOMInfo),t.gamepadDOMInfo=null));var r;return r=-1!==i.id.search("Xbox 360")||-1!==i.id.search("xinput")?new n.Xbox360Pad(i.id,i.index,i):new n.GenericPad(i.id,i.index,i),this.babylonGamepads.push(r),r},t.prototype._onGamepadDisconnected=function(n){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==n.gamepad.index){this.babylonGamepads.splice(t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},t.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},t.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},t.prototype._checkGamepadsStatus=function(){var n=this,t;this._updateGamepadObjects();for(t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){n._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){n._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){n._checkGamepadsStatus()}))},t.prototype._updateGamepadObjects=function(){for(var i,t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],n=0;n<t.length;n++)t[n]&&(t[n].index in this.babylonGamepads?this.babylonGamepads[n].browserGamepad=t[n]:(i=this._addNewGamepad(t[n]),this._callbackGamepadConnected&&this._callbackGamepadConnected(i)))},t}(),i,t,r,u;n.Gamepads=f;i=function(){function n(n,t){this.x=n;this.y=t}return n}();n.StickValues=i;t=function(){function n(n,t,i){this.id=n;this.index=t;this.browserGamepad=i;this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return n.prototype.onleftstickchanged=function(n){this._onleftstickchanged=n},n.prototype.onrightstickchanged=function(n){this._onrightstickchanged=n},Object.defineProperty(n.prototype,"leftStick",{get:function(){return this._leftStick},set:function(n){this._onleftstickchanged&&(this._leftStick.x!==n.x||this._leftStick.y!==n.y)&&this._onleftstickchanged(n);this._leftStick=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightStick",{get:function(){return this._rightStick},set:function(n){this._onrightstickchanged&&(this._rightStick.x!==n.x||this._rightStick.y!==n.y)&&this._onrightstickchanged(n);this._rightStick=n},enumerable:!0,configurable:!0}),n.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},n}();n.Gamepad=t;r=function(n){function t(t,i,r){n.call(this,t,i,r);this.id=t;this.index=i;this.gamepad=r;this._buttons=new Array(r.buttons.length)}return __extends(t,n),t.prototype.onbuttondown=function(n){this._onbuttondown=n},t.prototype.onbuttonup=function(n){this._onbuttonup=n},t.prototype._setButtonValue=function(n,t,i){return n!==t&&(this._onbuttondown&&1===n&&this._onbuttondown(i),this._onbuttonup&&0===n&&this._onbuttonup(i)),n},t.prototype.update=function(){n.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(t);n.GenericPad=r,function(n){n[n.A=0]="A";n[n.B=1]="B";n[n.X=2]="X";n[n.Y=3]="Y";n[n.Start=4]="Start";n[n.Back=5]="Back";n[n.LB=6]="LB";n[n.RB=7]="RB";n[n.LeftStick=8]="LeftStick";n[n.RightStick=9]="RightStick"}(n.Xbox360Button||(n.Xbox360Button={}));n.Xbox360Button;!function(n){n[n.Up=0]="Up";n[n.Down=1]="Down";n[n.Left=2]="Left";n[n.Right=3]="Right"}(n.Xbox360Dpad||(n.Xbox360Dpad={}));u=(n.Xbox360Dpad,function(n){function t(){n.apply(this,arguments);this._leftTrigger=0;this._rightTrigger=0;this._buttonA=0;this._buttonB=0;this._buttonX=0;this._buttonY=0;this._buttonBack=0;this._buttonStart=0;this._buttonLB=0;this._buttonRB=0;this._buttonLeftStick=0;this._buttonRightStick=0;this._dPadUp=0;this._dPadDown=0;this._dPadLeft=0;this._dPadRight=0}return __extends(t,n),t.prototype.onlefttriggerchanged=function(n){this._onlefttriggerchanged=n},t.prototype.onrighttriggerchanged=function(n){this._onrighttriggerchanged=n},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(n){this._onlefttriggerchanged&&this._leftTrigger!==n&&this._onlefttriggerchanged(n);this._leftTrigger=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(n){this._onrighttriggerchanged&&this._rightTrigger!==n&&this._onrighttriggerchanged(n);this._rightTrigger=n},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(n){this._onbuttondown=n},t.prototype.onbuttonup=function(n){this._onbuttonup=n},t.prototype.ondpaddown=function(n){this._ondpaddown=n},t.prototype.ondpadup=function(n){this._ondpadup=n},t.prototype._setButtonValue=function(n,t,i){return n!==t&&(this._onbuttondown&&1===n&&this._onbuttondown(i),this._onbuttonup&&0===n&&this._onbuttonup(i)),n},t.prototype._setDPadValue=function(n,t,i){return n!==t&&(this._ondpaddown&&1===n&&this._ondpaddown(i),this._ondpadup&&0===n&&this._ondpadup(i)),n},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(n){this._buttonA=this._setButtonValue(n,this._buttonA,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(n){this._buttonB=this._setButtonValue(n,this._buttonB,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(n){this._buttonX=this._setButtonValue(n,this._buttonX,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(n){this._buttonY=this._setButtonValue(n,this._buttonY,3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(n){this._buttonStart=this._setButtonValue(n,this._buttonStart,4)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(n){this._buttonBack=this._setButtonValue(n,this._buttonBack,5)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(n){this._buttonLB=this._setButtonValue(n,this._buttonLB,6)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(n){this._buttonRB=this._setButtonValue(n,this._buttonRB,7)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(n){this._buttonLeftStick=this._setButtonValue(n,this._buttonLeftStick,8)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(n){this._buttonRightStick=this._setButtonValue(n,this._buttonRightStick,9)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(n){this._dPadUp=this._setDPadValue(n,this._dPadUp,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(n){this._dPadDown=this._setDPadValue(n,this._dPadDown,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(n){this._dPadLeft=this._setDPadValue(n,this._dPadLeft,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(n){this._dPadRight=this._setDPadValue(n,this._dPadRight,3)},enumerable:!0,configurable:!0}),t.prototype.update=function(){n.prototype.update.call(this);this.buttonA=this.browserGamepad.buttons[0].value;this.buttonB=this.browserGamepad.buttons[1].value;this.buttonX=this.browserGamepad.buttons[2].value;this.buttonY=this.browserGamepad.buttons[3].value;this.buttonLB=this.browserGamepad.buttons[4].value;this.buttonRB=this.browserGamepad.buttons[5].value;this.leftTrigger=this.browserGamepad.buttons[6].value;this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonBack=this.browserGamepad.buttons[8].value;this.buttonStart=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=this.browserGamepad.buttons[15].value},t}(t));n.Xbox360Pad=u}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){var f=this;t.call(this,i,r,u);this.angularSensibility=200;this.moveSensibility=75;this._gamepads=new n.Gamepads(function(n){f._onNewGameConnected(n)})}return __extends(i,t),i.prototype._onNewGameConnected=function(n){0===n.index&&(this._gamepad=n)},i.prototype._checkInputs=function(){var o,s;if(this._gamepad){var t=this._gamepad.leftStick,r=t.x/this.moveSensibility,u=t.y/this.moveSensibility;t.x=Math.abs(r)>.005?0+r:0;t.y=Math.abs(u)>.005?0+u:0;var i=this._gamepad.rightStick,f=i.x/this.angularSensibility,e=i.y/this.angularSensibility;i.x=Math.abs(f)>.001?0+f:0;i.y=Math.abs(e)>.001?0+e:0;o=n.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0);s=n.Vector3.TransformCoordinates(new n.Vector3(t.x,0,-t.y),o);this.cameraDirection=this.cameraDirection.add(s);this.cameraRotation=this.cameraRotation.add(new n.Vector2(i.y,i.x))}},i.prototype.dispose=function(){this._gamepads.dispose();t.prototype.dispose.call(this)},i}(n.FreeCamera);n.GamepadCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){"undefined"==typeof u&&(u=!1);t.call(this,i,r);this.color=new n.Color3(1,1,1);this.alpha=1;this._indices=[];this._colorShader=new n.ShaderMaterial("colorShader",r,"color",{attributes:["position"],uniforms:["worldViewProjection","color"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPickable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(){var t=this.getScene().getEngine(),i=this._geometry.getIndexBuffer();t.bindBuffers(this._geometry.getVertexBuffer(n.VertexBuffer.PositionKind).getBuffer(),i,[3],12,this._colorShader.getEffect());this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},i.prototype._draw=function(n){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var t=this.getScene().getEngine();t.draw(!1,n.indexStart,n.indexCount)}},i.prototype.intersects=function(){return null},i.prototype.dispose=function(n){this._colorShader.dispose();t.prototype.dispose.call(this,n)},i}(n.Mesh);n.LinesMesh=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(n){this._scene=n}return t.prototype.render=function(t,i){var l=this._scene,e=this._scene.getEngine(),s=null!==e.getCaps().instancedArrays&&null!==i.visibleInstances,r,u,h,o,f,c;if(this.isReady(t,s))if(r=t.getRenderingMesh(),u=t.getMaterial(),e.enableEffect(this._effect),this._effect.setFloat("offset",r.outlineWidth),this._effect.setColor3("color",r.outlineColor),this._effect.setMatrix("viewProjection",l.getTransformMatrix()),h=r.skeleton&&r.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&r.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind),(h&&this._effect.setMatrices("mBones",r.skeleton.getTransformMatrices()),r._bind(t,this._effect,!1),u&&u.needAlphaTesting())&&(o=u.getAlphaTestTexture(),this._effect.setTexture("diffuseSampler",o),this._effect.setMatrix("diffuseMatrix",o.getTextureMatrix())),s)r._renderWithInstances(t,!1,i,this._effect,e);else if(i.renderSelf[t._id]&&(this._effect.setMatrix("world",r.getWorldMatrix()),r._draw(t,!0)),i.visibleInstances[t._id])for(f=0;f<i.visibleInstances[t._id].length;f++)c=i.visibleInstances[t._id][f],this._effect.setMatrix("world",c.getWorldMatrix()),r._draw(t,!0)},t.prototype.isReady=function(t,i){var u=[],r=[n.VertexBuffer.PositionKind,n.VertexBuffer.NormalKind],f=t.getMesh(),o=t.getMaterial(),e;return o&&o.needAlphaTesting()&&(u.push("#define ALPHATEST"),f.isVerticesDataPresent(n.VertexBuffer.UVKind)&&(r.push(n.VertexBuffer.UVKind),u.push("#define UV1")),f.isVerticesDataPresent(n.VertexBuffer.UV2Kind)&&(r.push(n.VertexBuffer.UV2Kind),u.push("#define UV2"))),f.skeleton&&f.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&f.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)&&(r.push(n.VertexBuffer.MatricesIndicesKind),r.push(n.VertexBuffer.MatricesWeightsKind),u.push("#define BONES"),u.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))),i&&(u.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3")),e=u.join("\n"),this._cachedDefines!=e&&(this._cachedDefines=e,this._effect=this._scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color"],["diffuseSampler"],e)),this._effect.isReady()},t}();n.OutlineRenderer=t}(BABYLON||(BABYLON={}));!function(n){var f=function(){function t(n,t,i,r){this.name=n;this.meshesNames=t;this.rootUrl=i;this.sceneFilename=r;this.isCompleted=!1}return t.prototype.run=function(t,i,r){var u=this;n.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(n,t,r){u.loadedMeshes=n;u.loadedParticleSystems=t;u.loadedSkeletons=r;u.isCompleted=!0;u.onSuccess&&u.onSuccess(u);i()},null,function(){u.onError&&u.onError(u);r()})},t}(),t,i,r,u,e;n.MeshAssetTask=f;t=function(){function t(n,t){this.name=n;this.url=t;this.isCompleted=!1}return t.prototype.run=function(t,i,r){var u=this;n.Tools.LoadFile(this.url,function(n){u.text=n;u.isCompleted=!0;u.onSuccess&&u.onSuccess(u);i()},null,t.database,!1,function(){u.onError&&u.onError(u);r()})},t}();n.TextFileAssetTask=t;i=function(){function t(n,t){this.name=n;this.url=t;this.isCompleted=!1}return t.prototype.run=function(t,i,r){var u=this;n.Tools.LoadFile(this.url,function(n){u.data=n;u.isCompleted=!0;u.onSuccess&&u.onSuccess(u);i()},null,t.database,!0,function(){u.onError&&u.onError(u);r()})},t}();n.BinaryFileAssetTask=i;r=function(){function n(n,t){this.name=n;this.url=t;this.isCompleted=!1}return n.prototype.run=function(n,t,i){var r=this,u=new Image;u.onload=function(){r.image=u;r.isCompleted=!0;r.onSuccess&&r.onSuccess(r);t()};u.onerror=function(){r.onError&&r.onError(r);i()};u.src=this.url},n}();n.ImageAssetTask=r;u=function(){function t(t,i,r,u,f){"undefined"==typeof f&&(f=n.Texture.TRILINEAR_SAMPLINGMODE);this.name=t;this.url=i;this.noMipmap=r;this.invertY=u;this.samplingMode=f;this.isCompleted=!1}return t.prototype.run=function(t,i,r){var u=this,f=function(){u.isCompleted=!0;u.onSuccess&&u.onSuccess(u);i()};this.texture=new n.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,f,r)},t}();n.TextureAssetTask=u;e=function(){function e(n){this._tasks=[];this._waitingTasksCount=0;this.useDefaultLoadingScreen=!0;this._scene=n}return e.prototype.addMeshTask=function(n,t,i,r){var u=new f(n,t,i,r);return this._tasks.push(u),u},e.prototype.addTextFileTask=function(n,i){var r=new t(n,i);return this._tasks.push(r),r},e.prototype.addBinaryFileTask=function(n,t){var r=new i(n,t);return this._tasks.push(r),r},e.prototype.addImageTask=function(n,t){var i=new r(n,t);return this._tasks.push(i),i},e.prototype.addTextureTask=function(t,i,r,f,e){"undefined"==typeof e&&(e=n.Texture.TRILINEAR_SAMPLINGMODE);var o=new u(t,i,r,f,e);return this._tasks.push(o),o},e.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--;0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},e.prototype._runTask=function(n){var t=this;n.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(n);t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(n);t._decreaseWaitingTasksCount()})},e.prototype.reset=function(){return this._tasks=[],this},e.prototype.load=function(){var n,t;if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;for(this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI(),n=0;n<this._tasks.length;n++)t=this._tasks[n],this._runTask(t);return this},e}();n.AssetsManager=e}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(n){function t(t,i,r){n.call(this,t,i,r);this._alpha=0;this._beta=0;this._gamma=0}return __extends(t,n),t.prototype._onOrientationEvent=function(n){this._alpha=0|+n.alpha;this._beta=0|+n.beta;this._gamma=0|+n.gamma;this._gamma=this._gamma<0?90+this._gamma:270-this._gamma;this.rotation.x=this._gamma/180*Math.PI;this.rotation.y=-this._alpha/180*Math.PI;this.rotation.z=this._beta/180*Math.PI},t}(n.OculusCamera);n.VRDeviceOrientationCamera=t}(BABYLON||(BABYLON={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};!function(n){var t=function(t){function i(i,r,u){t.call(this,i,r,u);this._hmdDevice=null;this._sensorDevice=null;this._cacheState=null;this._cacheQuaternion=new n.Quaternion;this._cacheRotation=n.Vector3.Zero();this._vrEnabled=!1;this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(n){var i=n.length,t=0;for(this._sensorDevice=null,this._hmdDevice=null;i>t&&null===this._hmdDevice;)n[t]instanceof HMDVRDevice&&(this._hmdDevice=n[t]),t++;for(t=0;i>t&&null===this._sensorDevice;)n[t]instanceof PositionSensorVRDevice&&(!this._hmdDevice||n[t].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=n[t]),t++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._update=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x);t.prototype._update.call(this)},i.prototype.attachControl=function(n,i){t.prototype.attachControl.call(this,n,i);navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(n){t.prototype.detachControl.call(this,n);this._vrEnabled=!1},i}(n.OculusCamera);n.WebVRCamera=t}(BABYLON||(BABYLON={}));
/*!
 * Knockout JavaScript library v3.3.0
 * (c) Steven Sanderson - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(){(function(n){var i=this||eval("this"),r=i.document,f=i.navigator,t=i.jQuery,u=i.JSON;(function(n){"function"==typeof define&&define.amd?define(["exports","require"],n):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(module.exports||exports):n(i.ko={})})(function(e,o){function a(n,t){return null===n||typeof n in p?n===t:!1}function w(t,i){var r;return function(){r||(r=setTimeout(function(){r=n;t()},i))}}function b(n,t){var i;return function(){clearTimeout(i);i=setTimeout(n,t)}}function v(n,t,i,r){s.d[n]={init:function(n,u,f,e,o){var c,h;return s.w(function(){var l=s.a.c(u()),f=!i!=!l,e=!h;(e||t||f!==c)&&(e&&s.Z.oa()&&(h=s.a.la(s.e.childNodes(n),!0)),f?(e||s.e.T(n,s.a.la(h)),s.Ja(r?r(o,l):o,n)):s.e.ma(n),c=f)},null,{q:n}),{controlsDescendantBindings:!0}}};s.h.ka[n]=!1;s.e.R[n]=!0}var s="undefined"!=typeof e?e:{},p,h,c,y,l;s.b=function(n,t){for(var i=n.split("."),r=s,u=0;u<i.length-1;u++)r=r[i[u]];r[i[i.length-1]]=t};s.D=function(n,t,i){n[t]=i};s.version="3.3.0";s.b("version",s.version);s.a=function(){function o(n,t){for(var i in n)n.hasOwnProperty(i)&&t(i,n[i])}function l(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function a(n,t){return n.__proto__=t,n}function v(n,t,i,r){var u=n[t].match(c)||[];s.a.o(i.match(c),function(n){s.a.ga(u,n,r)});n[t]=u.join(" ")}var y={__proto__:[]}instanceof Array,h={},p={};h[f&&/Firefox\/2/i.test(f.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];h.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");o(h,function(n,t){if(t.length)for(var i=0,r=t.length;i<r;i++)p[t[i]]=n});var w={propertychange:!0},e=r&&function(){for(var t=3,i=r.createElement("div"),u=i.getElementsByTagName("i");i.innerHTML="<!--[if gt IE "+ ++t+"]><i><\/i><![endif]-->",u[0];);return 4<t?t:n}(),c=/\S+/g;return{Bb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(n,t){for(var i=0,r=n.length;i<r;i++)t(n[i],i)},m:function(n,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(n,t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},vb:function(n,t,i){for(var r=0,u=n.length;r<u;r++)if(t.call(i,n[r],r))return n[r];return null},ya:function(n,t){var i=s.a.m(n,t);0<i?n.splice(i,1):0===i&&n.shift()},wb:function(n){n=n||[];for(var i=[],t=0,r=n.length;t<r;t++)0>s.a.m(i,n[t])&&i.push(n[t]);return i},Ka:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)r.push(t(n[i],i));return r},xa:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)t(n[i],i)&&r.push(n[i]);return r},ia:function(n,t){if(t instanceof Array)n.push.apply(n,t);else for(var i=0,r=t.length;i<r;i++)n.push(t[i]);return n},ga:function(n,t,i){var r=s.a.m(s.a.cb(n),t);0>r?i&&n.push(t):i||n.splice(r,1)},za:y,extend:l,Fa:a,Ga:y?a:l,A:o,pa:function(n,t){if(!n)return n;var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=t(n[i],i,n));return r},Ra:function(n){for(;n.firstChild;)s.removeNode(n.firstChild)},Jb:function(n){n=s.a.O(n);for(var i=(n[0]&&n[0].ownerDocument||r).createElement("div"),t=0,u=n.length;t<u;t++)i.appendChild(s.S(n[t]));return i},la:function(n,t){for(var r,i=0,f=n.length,u=[];i<f;i++)r=n[i].cloneNode(!0),u.push(t?s.S(r):r);return u},T:function(n,t){if(s.a.Ra(n),t)for(var i=0,r=t.length;i<r;i++)n.appendChild(t[i])},Qb:function(n,t){var r=n.nodeType?[n]:n;if(0<r.length){for(var f=r[0],e=f.parentNode,i=0,u=t.length;i<u;i++)e.insertBefore(t[i],f);for(i=0,u=r.length;i<u;i++)s.removeNode(r[i])}},na:function(n,t){if(n.length){for(t=8===t.nodeType&&t.parentNode||t;n.length&&n[0].parentNode!==t;)n.splice(0,1);if(1<n.length){var i=n[0],r=n[n.length-1];for(n.length=0;i!==r;)if(n.push(i),i=i.nextSibling,!i)return;n.push(r)}}return n},Sb:function(n,t){7>e?n.setAttribute("selected",t):n.selected=t},ib:function(t){return null===t||t===n?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Dc:function(n,t){return n=n||"",t.length>n.length?!1:n.substring(0,t.length)===t},jc:function(n,t){if(n===t)return!0;if(11===n.nodeType)return!1;if(t.contains)return t.contains(3===n.nodeType?n.parentNode:n);if(t.compareDocumentPosition)return 16==(t.compareDocumentPosition(n)&16);for(;n&&n!=t;)n=n.parentNode;return!!n},Qa:function(n){return s.a.jc(n,n.ownerDocument.documentElement)},tb:function(n){return!!s.a.vb(n,s.a.Qa)},v:function(n){return n&&n.tagName&&n.tagName.toLowerCase()},n:function(n,i,r){var o=e&&w[i],u,f;if(!o&&t)t(n).bind(i,r);else if(o||"function"!=typeof n.addEventListener)if("undefined"!=typeof n.attachEvent)u=function(t){r.call(n,t)},f="on"+i,n.attachEvent(f,u),s.a.C.fa(n,function(){n.detachEvent(f,u)});else throw Error("Browser doesn't support addEventListener or attachEvent");else n.addEventListener(i,r,!1)},qa:function(n,u){if(!n||!n.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var f;if("input"===s.a.v(n)&&n.type&&"click"==u.toLowerCase()?(f=n.type,f="checkbox"==f||"radio"==f):f=!1,t&&!f)t(n).trigger(u);else if("function"==typeof r.createEvent)if("function"==typeof n.dispatchEvent)f=r.createEvent(p[u]||"HTMLEvents"),f.initEvent(u,!0,!0,i,0,0,0,0,0,!1,!1,!1,!1,0,n),n.dispatchEvent(f);else throw Error("The supplied element doesn't support dispatchEvent");else if(f&&n.click)n.click();else if("undefined"!=typeof n.fireEvent)n.fireEvent("on"+u);else throw Error("Browser doesn't support triggering events");},c:function(n){return s.F(n)?n():n},cb:function(n){return s.F(n)?n.B():n},Ia:function(n,t,i){var r;t&&("object"==typeof n.classList?(r=n.classList[i?"add":"remove"],s.a.o(t.match(c),function(t){r.call(n.classList,t)})):"string"==typeof n.className.baseVal?v(n.className,"baseVal",t,i):v(n,"className",t,i))},Ha:function(t,i){var r=s.a.c(i),u;(null===r||r===n)&&(r="");u=s.e.firstChild(t);!u||3!=u.nodeType||s.e.nextSibling(u)?s.e.T(t,[t.ownerDocument.createTextNode(r)]):u.data=r;s.a.mc(t)},Rb:function(n,t){if(n.name=t,7>=e)try{n.mergeAttributes(r.createElement("<input name='"+n.name+"'/>"),!1)}catch(i){}},mc:function(n){9<=e&&(n=1==n.nodeType?n:n.parentNode,n.style&&(n.style.zoom=n.style.zoom))},kc:function(n){if(e){var t=n.style.width;n.style.width=0;n.style.width=t}},Bc:function(n,t){n=s.a.c(n);t=s.a.c(t);for(var r=[],i=n;i<=t;i++)r.push(i);return r},O:function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i},Hc:6===e,Ic:7===e,M:e,Db:function(n,t){for(var r=s.a.O(n.getElementsByTagName("input")).concat(s.a.O(n.getElementsByTagName("textarea"))),f="string"==typeof t?function(n){return n.name===t}:function(n){return t.test(n.name)},u=[],i=r.length-1;0<=i;i--)f(r[i])&&u.push(r[i]);return u},yc:function(n){return"string"==typeof n&&(n=s.a.ib(n))?u&&u.parse?u.parse(n):new Function("return "+n)():null},jb:function(n,t,i){if(!u||!u.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return u.stringify(s.a.c(n),t,i)},zc:function(n,t,i){var v,e,h,f,u,c;i=i||{};var l=i.params||{},a=i.includeFields||this.Bb,v=n;if("object"==typeof n&&"form"===s.a.v(n))for(v=n.action,e=a.length-1;0<=e;e--)for(h=s.a.Db(n,a[e]),f=h.length-1;0<=f;f--)l[h[f].name]=h[f].value;t=s.a.c(t);u=r.createElement("form");u.style.display="none";u.action=v;u.method="post";for(c in t)n=r.createElement("input"),n.type="hidden",n.name=c,n.value=s.a.jb(s.a.c(t[c])),u.appendChild(n);o(l,function(n,t){var i=r.createElement("input");i.type="hidden";i.name=n;i.value=t;u.appendChild(i)});r.body.appendChild(u);i.submitter?i.submitter(u):u.submit();setTimeout(function(){u.parentNode.removeChild(u)},0)}}}();s.b("utils",s.a);s.b("utils.arrayForEach",s.a.o);s.b("utils.arrayFirst",s.a.vb);s.b("utils.arrayFilter",s.a.xa);s.b("utils.arrayGetDistinctValues",s.a.wb);s.b("utils.arrayIndexOf",s.a.m);s.b("utils.arrayMap",s.a.Ka);s.b("utils.arrayPushAll",s.a.ia);s.b("utils.arrayRemoveItem",s.a.ya);s.b("utils.extend",s.a.extend);s.b("utils.fieldsIncludedWithJsonPost",s.a.Bb);s.b("utils.getFormFields",s.a.Db);s.b("utils.peekObservable",s.a.cb);s.b("utils.postJson",s.a.zc);s.b("utils.parseJson",s.a.yc);s.b("utils.registerEventHandler",s.a.n);s.b("utils.stringifyJson",s.a.jb);s.b("utils.range",s.a.Bc);s.b("utils.toggleDomNodeCssClass",s.a.Ia);s.b("utils.triggerEvent",s.a.qa);s.b("utils.unwrapObservable",s.a.c);s.b("utils.objectForEach",s.a.A);s.b("utils.addOrRemoveItem",s.a.ga);s.b("utils.setTextContent",s.a.Ha);s.b("unwrap",s.a.c);Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i;return 1===arguments.length?function(){return t.apply(n,arguments)}:(i=Array.prototype.slice.call(arguments,1),function(){var r=i.slice(0);return r.push.apply(r,arguments),t.apply(n,r)})});s.a.f=new function(){function r(r,f){var e=r[t];if(!e||"null"===e||!i[e]){if(!f)return n;e=r[t]="ko"+u++;i[e]={}}return i[e]}var u=0,t="__ko__"+(new Date).getTime(),i={};return{get:function(t,i){var u=r(t,!1);return u===n?n:u[i]},set:function(t,i,u){(u!==n||r(t,!1)!==n)&&(r(t,!0)[i]=u)},clear:function(n){var r=n[t];return r?(delete i[r],n[t]=null,!0):!1},I:function(){return u+++t}}};s.b("utils.domData",s.a.f);s.b("utils.domData.clear",s.a.f.clear);s.a.C=new function(){function i(t,i){var r=s.a.f.get(t,u);return r===n&&i&&(r=[],s.a.f.set(t,u,r)),r}function r(n){var t=i(n,!1),u;if(t)for(t=t.slice(0),u=0;u<t.length;u++)t[u](n);if(s.a.f.clear(n),s.a.C.cleanExternalData(n),f[n.nodeType])for(t=n.firstChild;n=t;)t=n.nextSibling,8===n.nodeType&&r(n)}var u=s.a.f.I(),e={1:!0,8:!0,9:!0},f={1:!0,9:!0};return{fa:function(n,t){if("function"!=typeof t)throw Error("Callback must be a function");i(n,!0).push(t)},Pb:function(t,r){var f=i(t,!1);f&&(s.a.ya(f,r),0==f.length&&s.a.f.set(t,u,n))},S:function(n){var t,i,u;if(e[n.nodeType]&&(r(n),f[n.nodeType]))for(t=[],s.a.ia(t,n.getElementsByTagName("*")),i=0,u=t.length;i<u;i++)r(t[i]);return n},removeNode:function(n){s.S(n);n.parentNode&&n.parentNode.removeChild(n)},cleanExternalData:function(n){t&&"function"==typeof t.cleanData&&t.cleanData([n])}}};s.S=s.a.C.S;s.removeNode=s.a.C.removeNode;s.b("cleanNode",s.S);s.b("removeNode",s.removeNode);s.b("utils.domNodeDisposal",s.a.C);s.b("utils.domNodeDisposal.addDisposeCallback",s.a.C.fa);s.b("utils.domNodeDisposal.removeDisposeCallback",s.a.C.Pb),function(){s.a.ca=function(n,u){var e,f;if(t){if(t.parseHTML)e=t.parseHTML(n,u)||[];else if((e=t.clean([n],u))&&e[0]){for(f=e[0];f.parentNode&&11!==f.parentNode.nodeType;)f=f.parentNode;f.parentNode&&f.parentNode.removeChild(f)}}else{(f=u)||(f=r);e=f.parentWindow||f.defaultView||i;var o=s.a.ib(n).toLowerCase(),f=f.createElement("div"),o=o.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","<\/table>"]||!o.indexOf("<tr")&&[2,"<table><tbody>","<\/tbody><\/table>"]||(!o.indexOf("<td")||!o.indexOf("<th"))&&[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"]||[0,"",""],h="ignored<div>"+o[1]+n+o[2]+"<\/div>";for("function"==typeof e.innerShiv?f.appendChild(e.innerShiv(h)):f.innerHTML=h;o[0]--;)f=f.lastChild;e=s.a.O(f.lastChild.childNodes)}return e};s.a.gb=function(i,r){if(s.a.Ra(i),r=s.a.c(r),null!==r&&r!==n)if("string"!=typeof r&&(r=r.toString()),t)t(i).html(r);else for(var f=s.a.ca(r,i.ownerDocument),u=0;u<f.length;u++)i.appendChild(f[u])}}();s.b("utils.parseHtmlFragment",s.a.ca);s.b("utils.setHtml",s.a.gb);s.H=function(){function i(n,t){var r;if(n)if(8==n.nodeType)r=s.H.Lb(n.nodeValue),null!=r&&t.push({ic:n,wc:r});else if(1==n.nodeType)for(var r=0,u=n.childNodes,f=u.length;r<f;r++)i(u[r],t)}var t={};return{$a:function(n){if("function"!=typeof n)throw Error("You can only pass a function to ko.memoization.memoize()");var i=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return t[i]=n,"<!--[ko_memo:"+i+"]-->"},Wb:function(i,r){var u=t[i];if(u===n)throw Error("Couldn't find any memo with ID "+i+". Perhaps it's already been unmemoized.");try{return u.apply(null,r||[]),!0}finally{delete t[i]}},Xb:function(n,t){var f=[],u,o,r,e;for(i(n,f),u=0,o=f.length;u<o;u++)r=f[u].ic,e=[r],t&&s.a.ia(e,t),s.H.Wb(f[u].wc,e),r.nodeValue="",r.parentNode&&r.parentNode.removeChild(r)},Lb:function(n){return(n=n.match(/^\[ko_memo\:(.*?)\]$/))?n[1]:null}}}();s.b("memoization",s.H);s.b("memoization.memoize",s.H.$a);s.b("memoization.unmemoize",s.H.Wb);s.b("memoization.parseMemoText",s.H.Lb);s.b("memoization.unmemoizeDomNodeAndDescendants",s.H.Xb);s.Sa={throttle:function(n,t){n.throttleEvaluation=t;var i=null;return s.j({read:n,write:function(r){clearTimeout(i);i=setTimeout(function(){n(r)},t)}})},rateLimit:function(n,t){var i,r,u;"number"==typeof t?i=t:(i=t.timeout,r=t.method);u="notifyWhenChangesStop"==r?b:w;n.Za(function(n){return u(n,i)})},notify:function(n,t){n.equalityComparer="always"==t?null:a}};p={undefined:1,boolean:1,number:1,string:1};s.b("extenders",s.Sa);s.Ub=function(n,t,i){this.da=n;this.La=t;this.hc=i;this.Gb=!1;s.D(this,"dispose",this.p)};s.Ub.prototype.p=function(){this.Gb=!0;this.hc()};s.Q=function(){s.a.Ga(this,s.Q.fn);this.G={};this.rb=1};h={U:function(n,t,i){var r=this,u;return i=i||"change",u=new s.Ub(r,t?n.bind(t):n,function(){s.a.ya(r.G[i],u);r.ua&&r.ua(i)}),r.ja&&r.ja(i),r.G[i]||(r.G[i]=[]),r.G[i].push(u),u},notifySubscribers:function(n,t){if(t=t||"change","change"===t&&this.Yb(),this.Ba(t))try{s.k.xb();for(var u=this.G[t].slice(0),r=0,i;i=u[r];++r)i.Gb||i.La(n)}finally{s.k.end()}},Aa:function(){return this.rb},pc:function(n){return this.Aa()!==n},Yb:function(){++this.rb},Za:function(n){var t=this,e=s.F(t),r,u,i,f;t.ta||(t.ta=t.notifySubscribers,t.notifySubscribers=function(n,i){i&&"change"!==i?"beforeChange"===i?t.pb(n):t.ta(n,i):t.qb(n)});f=n(function(){e&&i===t&&(i=t());r=!1;t.Wa(u,i)&&t.ta(u=i)});t.qb=function(n){r=!0;i=n;f()};t.pb=function(n){r||(u=n,t.ta(n,"beforeChange"))}},Ba:function(n){return this.G[n]&&this.G[n].length},nc:function(n){if(n)return this.G[n]&&this.G[n].length||0;var t=0;return s.a.A(this.G,function(n,i){t+=i.length}),t},Wa:function(n,t){return!this.equalityComparer||!this.equalityComparer(n,t)},extend:function(n){var t=this;return n&&s.a.A(n,function(n,i){var r=s.Sa[n];"function"==typeof r&&(t=r(t,i)||t)}),t}};s.D(h,"subscribe",h.U);s.D(h,"extend",h.extend);s.D(h,"getSubscriptionsCount",h.nc);s.a.za&&s.a.Fa(h,Function.prototype);s.Q.fn=h;s.Hb=function(n){return null!=n&&"function"==typeof n.U&&"function"==typeof n.notifySubscribers};s.b("subscribable",s.Q);s.b("isSubscribable",s.Hb);s.Z=s.k=function(){function t(t){r.push(n);n=t}function i(){n=r.pop()}var r=[],n,u=0;return{xb:t,end:i,Ob:function(t){if(n){if(!s.Hb(t))throw Error("Only subscribable things can act as dependencies");n.La(t,t.ac||(t.ac=++u))}},u:function(n,r,u){try{return t(),n.apply(r,u||[])}finally{i()}},oa:function(){if(n)return n.w.oa()},Ca:function(){if(n)return n.Ca}}}();s.b("computedContext",s.Z);s.b("computedContext.getDependenciesCount",s.Z.oa);s.b("computedContext.isInitial",s.Z.Ca);s.b("computedContext.isSleeping",s.Z.Jc);s.b("ignoreDependencies",s.Gc=s.k.u);s.r=function(n){function t(){return 0<arguments.length?(t.Wa(i,arguments[0])&&(t.X(),i=arguments[0],t.W()),this):(s.k.Ob(t),i)}var i=n;return s.Q.call(t),s.a.Ga(t,s.r.fn),t.B=function(){return i},t.W=function(){t.notifySubscribers(i)},t.X=function(){t.notifySubscribers(i,"beforeChange")},s.D(t,"peek",t.B),s.D(t,"valueHasMutated",t.W),s.D(t,"valueWillMutate",t.X),t};s.r.fn={equalityComparer:a};c=s.r.Ac="__ko_proto__";s.r.fn[c]=s.r;s.a.za&&s.a.Fa(s.r.fn,s.Q.fn);s.Ta=function(t,i){return null===t||t===n||t[c]===n?!1:t[c]===i?!0:s.Ta(t[c],i)};s.F=function(n){return s.Ta(n,s.r)};s.Da=function(n){return"function"==typeof n&&n[c]===s.r||"function"==typeof n&&n[c]===s.j&&n.qc?!0:!1};s.b("observable",s.r);s.b("isObservable",s.F);s.b("isWriteableObservable",s.Da);s.b("isWritableObservable",s.Da);s.ba=function(n){if(n=n||[],"object"!=typeof n||!("length"in n))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return n=s.r(n),s.a.Ga(n,s.ba.fn),n.extend({trackArrayChanges:!0})};s.ba.fn={remove:function(n){for(var u,r=this.B(),i=[],f="function"!=typeof n||s.F(n)?function(t){return t===n}:n,t=0;t<r.length;t++)u=r[t],f(u)&&(0===i.length&&this.X(),i.push(u),r.splice(t,1),t--);return i.length&&this.W(),i},removeAll:function(t){if(t===n){var i=this.B(),r=i.slice(0);return this.X(),i.splice(0,i.length),this.W(),r}return t?this.remove(function(n){return 0<=s.a.m(t,n)}):[]},destroy:function(n){var i=this.B(),r="function"!=typeof n||s.F(n)?function(t){return t===n}:n,t;for(this.X(),t=i.length-1;0<=t;t--)r(i[t])&&(i[t]._destroy=!0);this.W()},destroyAll:function(t){return t===n?this.destroy(function(){return!0}):t?this.destroy(function(n){return 0<=s.a.m(t,n)}):[]},indexOf:function(n){var t=this();return s.a.m(t,n)},replace:function(n,t){var i=this.indexOf(n);0<=i&&(this.X(),this.B()[i]=t,this.W())}};s.a.o("pop push reverse shift sort splice unshift".split(" "),function(n){s.ba.fn[n]=function(){var t=this.B();return this.X(),this.yb(t,n,arguments),t=t[n].apply(t,arguments),this.W(),t}});s.a.o(["slice"],function(n){s.ba.fn[n]=function(){var t=this();return t[n].apply(t,arguments)}});s.a.za&&s.a.Fa(s.ba.fn,s.r.fn);s.b("observableArray",s.ba);s.Sa.trackArrayChanges=function(n){function o(){var e,f;i||(i=!0,e=n.notifySubscribers,n.notifySubscribers=function(n,t){return t&&"change"!==t||++r,e.apply(this,arguments)},f=[].concat(n.B()||[]),t=null,u=n.U(function(i){if(i=[].concat(i||[]),n.Ba("arrayChange")){var u;(!t||1<r)&&(t=s.a.Ma(f,i,{sparse:!0}));u=t}f=i;t=null;r=0;u&&u.length&&n.notifySubscribers(u,"arrayChange")}))}if(!n.yb){var i=!1,t=null,u,r=0,f=n.ja,e=n.ua;n.ja=function(t){f&&f.call(n,t);"arrayChange"===t&&o()};n.ua=function(t){e&&e.call(n,t);"arrayChange"!==t||n.Ba("arrayChange")||(u.p(),i=!1)};n.yb=function(n,u,f){function c(n,t,i){return l[l.length]={status:n,value:t,index:i}}if(i&&!r){var l=[],e=n.length,h=f.length,o=0;switch(u){case"push":o=e;case"unshift":for(u=0;u<h;u++)c("added",f[u],o+u);break;case"pop":o=e-1;case"shift":e&&c("deleted",n[o],o);break;case"splice":u=Math.min(Math.max(0,0>f[0]?e+f[0]:f[0]),e);for(var e=1===h?e:Math.min(u+(f[1]||0),e),h=u+h-2,o=Math.max(e,h),a=[],v=[],y=2;u<o;++u,++y)u<e&&v.push(c("deleted",n[u],u)),u<h&&a.push(c("added",f[y],u));s.a.Cb(v,a);break;default:return}t=l}}}};s.w=s.j=function(t,i,r){function rt(n,t,i){if(g&&t===u)throw Error("A 'pure' computed must not be called recursively");f[n]=i;i.sa=o++;i.ea=t.Aa()}function b(){var n,t;for(n in f)if(f.hasOwnProperty(n)&&(t=f[n],t.da.pc(t.ea)))return!0}function ut(){!e&&f&&s.a.A(f,function(n,t){t.p&&t.p()});f=null;o=0;y=!0;e=c=!1}function ft(){var n=u.throttleEvaluation;n&&0<=n?(clearTimeout(st),st=setTimeout(function(){a(!0)},n)):u.nb?u.nb():a(!0)}function a(t){var v;if(!k&&!y){if(it&&it()){if(!d){p();return}}else d=!1;k=!0;try{var r=f,a=o,b=g?n:!o;s.k.xb({La:function(n,t){y||(a&&r[t]?(rt(t,n,r[t]),delete r[t],--a):f[t]||rt(t,n,e?{da:n}:n.U(ft)))},w:u,Ca:b});f={};o=0;try{v=i?l.call(i):l()}finally{s.k.end();a&&!e&&s.a.A(r,function(n,t){t.p&&t.p()});c=!1}u.Wa(h,v)&&(e||w(h,"beforeChange"),h=v,e?u.Yb():t&&w(h));b&&w(h,"awake")}finally{k=!1}o||p()}}function u(){if(0<arguments.length){if("function"==typeof nt)nt.apply(i,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}return s.k.Ob(u),(c||e&&b())&&a(),h}function et(){return(c&&!o||e&&b())&&a(),h}function ot(){return c||0<o}function w(n,t){u.notifySubscribers(n,t)}var h,c=!0,k=!1,d=!1,y=!1,l=t,g=!1,e=!1,ht;if(l&&"object"==typeof l?(r=l,l=r.read):(r=r||{},l||(l=r.read)),"function"!=typeof l)throw Error("Pass a function that returns the value of the ko.computed");var nt=r.write,v=r.disposeWhenNodeIsRemoved||r.q||null,tt=r.disposeWhen||r.Pa,it=tt,p=ut,f={},o=0,st=null;return i||(i=r.owner),s.Q.call(u),s.a.Ga(u,s.j.fn),u.B=et,u.oa=function(){return o},u.qc="function"==typeof nt,u.p=function(){p()},u.$=ot,ht=u.Za,u.Za=function(n){ht.call(u,n);u.nb=function(){u.pb(h);c=!0;u.qb(u)}},r.pure?(e=g=!0,u.ja=function(n){if(!y&&e&&"change"==n){if(e=!1,c||b())f=null,o=0,c=!0,a();else{var t=[];s.a.A(f,function(n,i){t[i.sa]=n});s.a.o(t,function(n,t){var r=f[n],i=r.da.U(ft);i.sa=t;i.ea=r.ea;f[n]=i})}y||w(h,"awake")}},u.ua=function(t){y||"change"!=t||u.Ba("change")||(s.a.A(f,function(n,t){t.p&&(f[n]={da:t.da,sa:t.sa,ea:t.ea},t.p())}),e=!0,w(n,"asleep"))},u.bc=u.Aa,u.Aa=function(){return e&&(c||b())&&a(),u.bc()}):r.deferEvaluation&&(u.ja=function(n){"change"!=n&&"beforeChange"!=n||et()}),s.D(u,"peek",u.B),s.D(u,"dispose",u.p),s.D(u,"isActive",u.$),s.D(u,"getDependenciesCount",u.oa),v&&(d=!0,v.nodeType&&(it=function(){return!s.a.Qa(v)||tt&&tt()})),e||r.deferEvaluation||a(),v&&ot()&&v.nodeType&&(p=function(){s.a.C.Pb(v,p);ut()},s.a.C.fa(v,p)),u};s.sc=function(n){return s.Ta(n,s.j)};h=s.r.Ac;s.j[h]=s.r;s.j.fn={equalityComparer:a};s.j.fn[h]=s.j;s.a.za&&s.a.Fa(s.j.fn,s.Q.fn);s.b("dependentObservable",s.j);s.b("computed",s.j);s.b("isComputed",s.sc);s.Nb=function(n,t){return"function"==typeof n?s.w(n,t,{pure:!0}):(n=s.a.extend({},n),n.pure=!0,s.w(n,t))};s.b("pureComputed",s.Nb),function(){function t(u,f,e){if(e=e||new i,u=f(u),"object"!=typeof u||null===u||u===n||u instanceof Date||u instanceof String||u instanceof Number||u instanceof Boolean)return u;var o=u instanceof Array?[]:{};return e.save(u,o),r(u,function(i){var r=f(u[i]),s;switch(typeof r){case"boolean":case"number":case"string":case"function":o[i]=r;break;case"object":case"undefined":s=e.get(r);o[i]=s!==n?s:t(r,f,e)}}),o}function r(n,t){if(n instanceof Array){for(var i=0;i<n.length;i++)t(i);"function"==typeof n.toJSON&&t("toJSON")}else for(i in n)t(i)}function i(){this.keys=[];this.mb=[]}s.Vb=function(n){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(n,function(n){for(var t=0;s.F(n)&&10>t;t++)n=n();return n})};s.toJSON=function(n,t,i){return n=s.Vb(n),s.a.jb(n,t,i)};i.prototype={save:function(n,t){var i=s.a.m(this.keys,n);0<=i?this.mb[i]=t:(this.keys.push(n),this.mb.push(t))},get:function(t){return t=s.a.m(this.keys,t),0<=t?this.mb[t]:n}}}();s.b("toJS",s.Vb);s.b("toJSON",s.toJSON),function(){s.i={s:function(t){switch(s.a.v(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?s.a.f.get(t,s.d.options.ab):7>=s.a.M?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?s.i.s(t.options[t.selectedIndex]):n;default:return t.value}},Y:function(t,i,r){switch(s.a.v(t)){case"option":switch(typeof i){case"string":s.a.f.set(t,s.d.options.ab,n);"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__;t.value=i;break;default:s.a.f.set(t,s.d.options.ab,i);t.__ko__hasDomDataOptionValue__=!0;t.value="number"==typeof i?i:""}break;case"select":(""===i||null===i)&&(i=n);for(var f=-1,u=0,o=t.options.length,e;u<o;++u)if(e=s.i.s(t.options[u]),e==i||""==e&&i===n){f=u;break}(r||0<=f||i===n&&1<t.size)&&(t.selectedIndex=f);break;default:(null===i||i===n)&&(i="");t.value=i}}}}();s.b("selectExtensions",s.i);s.b("selectExtensions.readValue",s.i.s);s.b("selectExtensions.writeValue",s.i.Y);s.h=function(){function n(n){var c,u,i;n=s.a.ib(n);123===n.charCodeAt(0)&&(n=n.slice(1,-1));var a=[],h=n.match(t),o,r=[],l=0;if(h)for(h.push(","),c=0;u=h[c];++c){if(i=u.charCodeAt(0),44===i){if(0>=l){a.push(o&&r.length?{key:o,value:r.join("")}:{unknown:o||r.join("")});o=l=0;r=[];continue}}else if(58===i){if(!l&&!o&&1===r.length){o=r.pop();continue}}else 47===i&&c&&1<u.length?(i=h[c-1].match(f))&&!e[i[0]]&&(n=n.substr(n.indexOf(u)+1),h=n.match(t),h.push(","),c=-1,u="/"):40===i||123===i||91===i?++l:41===i||125===i||93===i?--l:o||r.length||34!==i&&39!==i||(u=u.slice(1,-1));r.push(u)}return a}var r=["true","false","null","undefined"],u=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,t=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,e={"in":1,"return":1,"typeof":1},i={};return{ka:[],V:i,bb:n,Ea:function(t,f){function e(n,t){var a,f;if(!l){if(f=s.getBindingHandler(n),f&&f.preprocess&&!(t=f.preprocess(t,n,e)))return;(f=i[n])&&(a=t,0<=s.a.m(r,a)?a=!1:(f=a.match(u),a=null===f?!1:f[1]?"Object("+f[1]+")"+f[2]:a),f=a);f&&o.push("'"+n+"':function(_z){"+a+"=_z}")}c&&(t="function(){return "+t+" }");h.push("'"+n+"':"+t)}f=f||{};var h=[],o=[],c=f.valueAccessors,l=f.bindingParams,a="string"==typeof t?n(t):t;return s.a.o(a,function(n){e(n.key||n.unknown,n.value)}),o.length&&e("_ko_property_writers","{"+o.join(",")+" }"),h.join(",")},vc:function(n,t){for(var i=0;i<n.length;i++)if(n[i].key==t)return!0;return!1},ra:function(n,t,i,r,u){n&&s.F(n)?!s.Da(n)||u&&n.B()===r||n(r):(n=t.get("_ko_property_writers"))&&n[i]&&n[i](r)}}}();s.b("expressionRewriting",s.h);s.b("expressionRewriting.bindingRewriteValidators",s.h.ka);s.b("expressionRewriting.parseObjectLiteral",s.h.bb);s.b("expressionRewriting.preProcessBindings",s.h.Ea);s.b("expressionRewriting._twoWayBindings",s.h.V);s.b("jsonExpressionRewriting",s.h);s.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",s.h.Ea),function(){function n(n){return 8==n.nodeType&&e.test(t?n.text:n.nodeValue)}function i(n){return 8==n.nodeType&&o.test(t?n.text:n.nodeValue)}function u(t,r){for(var u=t,f=1,e=[];u=u.nextSibling;){if(i(u)&&(f--,0===f))return e;e.push(u);n(u)&&f++}if(!r)throw Error("Cannot find closing comment tag to match: "+t.nodeValue);return null}function f(n,t){var i=u(n,t);return i?0<i.length?i[i.length-1].nextSibling:n.nextSibling:null}var t=r&&"<!--test-->"===r.createComment("test").text,e=t?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=t?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,h={ul:!0,ol:!0};s.e={R:{},childNodes:function(t){return n(t)?u(t):t.childNodes},ma:function(t){if(n(t)){t=s.e.childNodes(t);for(var i=0,r=t.length;i<r;i++)s.removeNode(t[i])}else s.a.Ra(t)},T:function(t,i){if(n(t)){s.e.ma(t);for(var u=t.nextSibling,r=0,f=i.length;r<f;r++)u.parentNode.insertBefore(i[r],u)}else s.a.T(t,i)},Mb:function(t,i){n(t)?t.parentNode.insertBefore(i,t.nextSibling):t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i)},Fb:function(t,i,r){r?n(t)?t.parentNode.insertBefore(i,r.nextSibling):r.nextSibling?t.insertBefore(i,r.nextSibling):t.appendChild(i):s.e.Mb(t,i)},firstChild:function(t){return n(t)?!t.nextSibling||i(t.nextSibling)?null:t.nextSibling:t.firstChild},nextSibling:function(t){return n(t)&&(t=f(t)),t.nextSibling&&i(t.nextSibling)?null:t.nextSibling},oc:n,Fc:function(n){return(n=(t?n.text:n.nodeValue).match(e))?n[1]:null},Kb:function(t){var o,r,u,e;if(h[s.a.v(t)]&&(o=t.firstChild,o))do if(1===o.nodeType){if(r=o.firstChild,u=null,r)do u?u.push(r):n(r)?(e=f(r,!0),e?r=e:u=[r]):i(r)&&(u=[r]);while(r=r.nextSibling);if(r=u)for(u=o.nextSibling,e=0;e<r.length;e++)u?t.insertBefore(r[e],u):t.appendChild(r[e])}while(o=o.nextSibling)}}}();s.b("virtualElements",s.e);s.b("virtualElements.allowedBindings",s.e.R);s.b("virtualElements.emptyNode",s.e.ma);s.b("virtualElements.insertAfter",s.e.Fb);s.b("virtualElements.prepend",s.e.Mb);s.b("virtualElements.setDomNodeChildren",s.e.T),function(){s.L=function(){this.ec={}};s.a.extend(s.L.prototype,{nodeHasBindings:function(n){switch(n.nodeType){case 1:return null!=n.getAttribute("data-bind")||s.g.getComponentNameForNode(n);case 8:return s.e.oc(n);default:return!1}},getBindings:function(n,t){var i=this.getBindingsString(n,t),i=i?this.parseBindingsString(i,t,n):null;return s.g.sb(i,n,t,!1)},getBindingAccessors:function(n,t){var i=this.getBindingsString(n,t),i=i?this.parseBindingsString(i,t,n,{valueAccessors:!0}):null;return s.g.sb(i,n,t,!0)},getBindingsString:function(n){switch(n.nodeType){case 1:return n.getAttribute("data-bind");case 8:return s.e.Fc(n);default:return null}},parseBindingsString:function(n,t,i,r){var u,f,e,h,c;try{return u=this.ec,f=n+(r&&r.valueAccessors||""),(e=u[f])||(c="with($context){with($data||{}){return{"+s.h.Ea(n,r)+"}}}",h=new Function("$context","$element",c),e=u[f]=h),e(t,i)}catch(o){throw o.message="Unable to parse bindings.\nBindings value: "+n+"\nMessage: "+o.message,o;}}});s.L.instance=new s.L}();s.b("bindingProvider",s.L),function(){function v(n){return function(){return n}}function u(n){return n()}function o(n){return s.a.pa(s.k.u(n),function(t,i){return function(){return n()[i]}})}function y(n,t,i){return"function"==typeof n?o(n.bind(null,t,i)):s.a.pa(n,v)}function p(n,t){return o(this.getBindings.bind(this,n,t))}function h(n,t,i){var r,u=s.e.firstChild(t),f=s.L.instance,e=f.preprocessNode;if(e){for(;r=u;)u=s.e.nextSibling(r),e.call(f,r);u=s.e.firstChild(t)}for(;r=u;)u=s.e.nextSibling(r),c(n,r,i)}function c(n,t,i){var u=!0,r=1===t.nodeType;r&&s.e.Kb(t);(r&&i||s.L.instance.nodeHasBindings(t))&&(u=l(t,null,n,i).shouldBindDescendants);u&&!a[s.a.v(t)]&&h(n,t,!r)}function w(n){var i=[],r={},t=[];return s.a.A(n,function u(f){if(!r[f]){var e=s.getBindingHandler(f);e&&(e.after&&(t.push(f),s.a.o(e.after,function(i){if(n[i]){if(-1!==s.a.m(t,i))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+t.join(", "));u(i)}}),t.length--),i.push({key:f,Eb:e}));r[f]=!0}}),i}function l(t,i,r,e){var v=s.a.f.get(t,f),o,l,a,c;if(!i){if(v)throw Error("You cannot apply bindings multiple times to the same element.");s.a.f.set(t,f,!0)}if(!v&&e&&s.Tb(t,r),i&&"function"!=typeof i)o=i;else{var y=s.L.instance,b=y.getBindingAccessors||p,h=s.j(function(){return(o=i?i(r,t):b.call(y,t,r))&&r.K&&r.K(),o},null,{q:t});o&&h.$()||(h=null)}return o&&(a=h?function(n){return function(){return u(h()[n])}}:function(n){return o[n]},c=function(){return s.a.pa(h?h():o,u)},c.get=function(n){return o[n]&&u(a(n))},c.has=function(n){return n in o},e=w(o),s.a.o(e,function(i){var e=i.Eb.init,h=i.Eb.update,u=i.key;if(8===t.nodeType&&!s.e.R[u])throw Error("The binding '"+u+"' cannot be used with virtual elements");try{"function"==typeof e&&s.k.u(function(){var i=e(t,a(u),c,r.$data,r);if(i&&i.controlsDescendantBindings){if(l!==n)throw Error("Multiple bindings ("+l+" and "+u+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=u}});"function"==typeof h&&s.j(function(){h(t,a(u),c,r.$data,r)},null,{q:t})}catch(f){throw f.message='Unable to process binding "'+u+": "+o[u]+'"\nMessage: '+f.message,f;}})),{shouldBindDescendants:l===n}}function r(n){return n&&n instanceof s.N?n:new s.N(n)}var a,f,e;s.d={};a={script:!0,textarea:!0};s.getBindingHandler=function(n){return s.d[n]};s.N=function(t,i,r,u){var f=this,h="function"==typeof t&&!s.F(t),o,e=s.j(function(){var o=h?t():t,n=s.a.c(o);return i?(i.K&&i.K(),s.a.extend(f,i),e&&(f.K=e)):(f.$parents=[],f.$root=n,f.ko=s),f.$rawData=o,f.$data=n,r&&(f[r]=n),u&&u(f,i,n),f.$data},null,{Pa:function(){return o&&!s.a.tb(o)},q:!0});e.$()&&(f.K=e,e.equalityComparer=null,o=[],e.Zb=function(t){o.push(t);s.a.C.fa(t,function(t){s.a.ya(o,t);o.length||(e.p(),f.K=e=n)})})};s.N.prototype.createChildContext=function(n,t,i){return new s.N(n,this,t,function(n,t){n.$parentContext=t;n.$parent=t.$data;n.$parents=(t.$parents||[]).slice(0);n.$parents.unshift(n.$parent);i&&i(n)})};s.N.prototype.extend=function(n){return new s.N(this.K||this.$data,this,null,function(t,i){t.$rawData=i.$rawData;s.a.extend(t,"function"==typeof n?n():n)})};f=s.a.f.I();e=s.a.f.I();s.Tb=function(n,t){if(2==arguments.length)s.a.f.set(n,e,t),t.K&&t.K.Zb(n);else return s.a.f.get(n,e)};s.va=function(n,t,i){return 1===n.nodeType&&s.e.Kb(n),l(n,t,r(i),!0)};s.cc=function(n,t,i){return i=r(i),s.va(n,y(t,i,n),i)};s.Ja=function(n,t){1!==t.nodeType&&8!==t.nodeType||h(r(n),t,!0)};s.ub=function(n,u){if(!t&&i.jQuery&&(t=i.jQuery),u&&1!==u.nodeType&&8!==u.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");u=u||i.document.body;c(r(n),u,!0)};s.Oa=function(t){switch(t.nodeType){case 1:case 8:var i=s.Tb(t);if(i)return i;if(t.parentNode)return s.Oa(t.parentNode)}return n};s.gc=function(t){return(t=s.Oa(t))?t.$data:n};s.b("bindingHandlers",s.d);s.b("applyBindings",s.ub);s.b("applyBindingsToDescendants",s.Ja);s.b("applyBindingAccessorsToNode",s.va);s.b("applyBindingsToNode",s.cc);s.b("contextFor",s.Oa);s.b("dataFor",s.gc)}(),function(n){function u(t,u){var e=i.hasOwnProperty(t)?i[t]:n,o;e?e.U(u):(e=i[t]=new s.Q,e.U(u),f(t,function(n,u){var f=!(!u||!u.synchronous);r[t]={definition:n,tc:f};delete i[t];o||f?e.notifySubscribers(n):setTimeout(function(){e.notifySubscribers(n)},0)}),o=!0)}function f(n,i){t("getConfig",[n],function(r){r?t("loadComponent",[n,r],function(n){i(n,r)}):i(null,null)})}function t(i,r,u,f){var e,o,h;if(f||(f=s.g.loaders.slice(0)),e=f.shift(),e)if(o=e[i],o){if(h=!1,o.apply(e,r.concat(function(n){h?u(null):null!==n?u(n):t(i,r,u,f)}))!==n&&(h=!0,!e.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");}else t(i,r,u,f);else u(null)}var i={},r={};s.g={get:function(t,i){var f=r.hasOwnProperty(t)?r[t]:n;f?f.tc?s.k.u(function(){i(f.definition)}):setTimeout(function(){i(f.definition)},0):u(t,i)},zb:function(n){delete r[n]},ob:t};s.g.loaders=[];s.b("components",s.g);s.b("components.get",s.g.get);s.b("components.clearCachedDefinition",s.g.zb)}(),function(){function l(n,i,r,f){function e(){0==--c&&f(o)}var o={},c=2,h=r.template;r=r.viewModel;h?u(i,h,function(t){s.g.ob("loadTemplate",[n,t],function(n){o.template=n;e()})}):e();r?u(i,r,function(i){s.g.ob("loadViewModel",[n,i],function(n){o[t]=n;e()})}):e()}function e(n,i,r){if("function"==typeof i)r(function(n){return new i(n)});else if("function"==typeof i[t])r(i[t]);else if("instance"in i){var u=i.instance;r(function(){return u})}else"viewModel"in i?e(n,i.viewModel,r):n("Unknown viewModel value: "+i)}function h(n){switch(s.a.v(n)){case"script":return s.a.ca(n.text);case"textarea":return s.a.ca(n.value);case"template":if(c(n.content))return s.a.la(n.content.childNodes)}return s.a.la(n.childNodes)}function c(n){return i.DocumentFragment?n instanceof DocumentFragment:n&&11===n.nodeType}function u(n,t,r){"string"==typeof t.require?o||i.require?(o||i.require)([t.require],r):n("Uses require, but no AMD loader is present"):r(t)}function f(n){return function(t){throw Error("Component '"+n+"': "+t);}}var n={},t;s.g.register=function(t,i){if(!i)throw Error("Invalid configuration for "+t);if(s.g.Xa(t))throw Error("Component "+t+" is already registered");n[t]=i};s.g.Xa=function(t){return t in n};s.g.Ec=function(t){delete n[t];s.g.zb(t)};s.g.Ab={getConfig:function(t,i){i(n.hasOwnProperty(t)?n[t]:null)},loadComponent:function(n,t,i){var r=f(n);u(r,t,function(t){l(n,r,t,i)})},loadTemplate:function(n,t,u){if(n=f(n),"string"==typeof t)u(s.a.ca(t));else if(t instanceof Array)u(t);else if(c(t))u(s.a.O(t.childNodes));else if(t.element)if(t=t.element,i.HTMLElement?t instanceof HTMLElement:t&&t.tagName&&1===t.nodeType)u(h(t));else if("string"==typeof t){var e=r.getElementById(t);e?u(h(e)):n("Cannot find element with ID "+t)}else n("Unknown element type: "+t);else n("Unknown template value: "+t)},loadViewModel:function(n,t,i){e(f(n),t,i)}};t="createViewModel";s.b("components.register",s.g.register);s.b("components.isRegistered",s.g.Xa);s.b("components.unregister",s.g.Ec);s.b("components.defaultLoader",s.g.Ab);s.g.loaders.push(s.g.Ab);s.g.$b=n}(),function(){function n(n,i){var r=n.getAttribute("params");if(r){var r=t.parseBindingsString(r,i,n,{valueAccessors:!0,bindingParams:!0}),r=s.a.pa(r,function(t){return s.w(t,null,{q:n})}),u=s.a.pa(r,function(t){var i=t.B();return t.$()?s.w({read:function(){return s.a.c(t())},write:s.Da(i)&&function(n){t()(n)},q:n}):i});return u.hasOwnProperty("$raw")||(u.$raw=r),u}return{$raw:{}}}s.g.getComponentNameForNode=function(n){return n=s.a.v(n),s.g.Xa(n)&&n};s.g.sb=function(t,i,r,u){var f,e;if(1===i.nodeType&&(f=s.g.getComponentNameForNode(i),f)){if(t=t||{},t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');e={name:f,params:n(i,r)};t.component=u?function(){return e}:e}return t};var t=new s.L;9>s.a.M&&(s.g.register=function(n){return function(t){return r.createElement(t),n.apply(this,arguments)}}(s.g.register),r.createDocumentFragment=function(n){return function(){var t=n(),i=s.g.$b;for(var r in i)i.hasOwnProperty(r)&&t.createElement(r);return t}}(r.createDocumentFragment))}(),function(n){function t(n,t,i){if(t=t.template,!t)throw Error("Component '"+n+"' has no template");n=s.a.la(t);s.e.T(i,n)}function i(n,t,i,r){var u=n.createViewModel;return u?u.call(n,r,{element:t,templateNodes:i}):r}var r=0;s.d.component={init:function(u,f,e,o,h){function a(){var n=c&&c.dispose;"function"==typeof n&&n.call(c);l=null}var c,l,v=s.a.O(s.e.childNodes(u));return s.a.C.fa(u,a),s.w(function(){var o=s.a.c(f()),e,y,p;if("string"==typeof o?e=o:(e=s.a.c(o.name),y=s.a.c(o.params)),!e)throw Error("No component name specified");p=l=++r;s.g.get(e,function(r){if(l===p){if(a(),!r)throw Error("Unknown component '"+e+"'");t(e,r,u);var f=i(r,u,v,y);r=h.createChildContext(f,n,function(n){n.$component=f;n.$componentTemplateNodes=v});c=f;s.Ja(r,u)}})},null,{q:u}),{controlsDescendantBindings:!0}}};s.e.R.component=!0}();y={"class":"className","for":"htmlFor"};s.d.attr={update:function(t,i){var r=s.a.c(i())||{};s.a.A(r,function(i,r){r=s.a.c(r);var u=!1===r||null===r||r===n;u&&t.removeAttribute(i);8>=s.a.M&&i in y?(i=y[i],u?t.removeAttribute(i):t[i]=r):u||t.setAttribute(i,r.toString());"name"===i&&s.a.Rb(t,u?"":r.toString())})}},function(){s.d.checked={after:["value","attr"],init:function(t,i,r){function c(){var c=t.checked,n=a?u():c,o;s.Z.Ca()||f&&!c||(o=s.k.u(i),e?h!==n?(c&&(s.a.ga(o,n,!0),s.a.ga(o,h,!1)),h=n):s.a.ga(o,n,c):s.h.ra(o,r,"checked",n,!0))}function l(){var n=s.a.c(i());t.checked=e?0<=s.a.m(n,u()):o?n:u()===n}var u=s.Nb(function(){return r.has("checkedValue")?s.a.c(r.get("checkedValue")):r.has("value")?s.a.c(r.get("value")):t.value}),o="checkbox"==t.type,f="radio"==t.type;if(o||f){var e=o&&s.a.c(i())instanceof Array,h=e?u():n,a=f||e;f&&!t.name&&s.d.uniqueName.init(t,function(){return!0});s.w(c,null,{q:t});s.a.n(t,"click",c);s.w(l,null,{q:t})}}};s.h.V.checked=!0;s.d.checkedValue={update:function(n,t){n.value=s.a.c(t())}}}();s.d.css={update:function(n,t){var i=s.a.c(t());null!==i&&"object"==typeof i?s.a.A(i,function(t,i){i=s.a.c(i);s.a.Ia(n,t,i)}):(i=String(i||""),s.a.Ia(n,n.__ko__cssValue,!1),n.__ko__cssValue=i,s.a.Ia(n,i,!0))}};s.d.enable={update:function(n,t){var i=s.a.c(t());i&&n.disabled?n.removeAttribute("disabled"):i||n.disabled||(n.disabled=!0)}};s.d.disable={update:function(n,t){s.d.enable.update(n,function(){return!s.a.c(t())})}};s.d.event={init:function(n,t,i,r,u){var f=t()||{};s.a.A(f,function(f){"string"==typeof f&&s.a.n(n,f,function(n){var o,h=t()[f],e;if(h){try{e=s.a.O(arguments);r=u.$data;e.unshift(r);o=h.apply(r,e)}finally{!0!==o&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}!1===i.get(f+"Bubble")&&(n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation())}})})}};s.d.foreach={Ib:function(n){return function(){var i=n(),t=s.a.cb(i);return!t||"number"==typeof t.length?{foreach:i,templateEngine:s.P.Va}:(s.a.c(i),{foreach:t.data,as:t.as,includeDestroyed:t.includeDestroyed,afterAdd:t.afterAdd,beforeRemove:t.beforeRemove,afterRender:t.afterRender,beforeMove:t.beforeMove,afterMove:t.afterMove,templateEngine:s.P.Va})}},init:function(n,t){return s.d.template.init(n,s.d.foreach.Ib(t))},update:function(n,t,i,r,u){return s.d.template.update(n,s.d.foreach.Ib(t),i,r,u)}};s.h.ka.foreach=!1;s.e.R.foreach=!0;s.d.hasfocus={init:function(n,t,i){function r(r){var u,f;if(n.__ko_hasfocusUpdating=!0,u=n.ownerDocument,"activeElement"in u){try{f=u.activeElement}catch(e){f=u.body}r=f===n}u=t();s.h.ra(u,i,"hasfocus",r,!0);n.__ko_hasfocusLastValue=r;n.__ko_hasfocusUpdating=!1}var u=r.bind(null,!0),f=r.bind(null,!1);s.a.n(n,"focus",u);s.a.n(n,"focusin",u);s.a.n(n,"blur",f);s.a.n(n,"focusout",f)},update:function(n,t){var i=!!s.a.c(t());n.__ko_hasfocusUpdating||n.__ko_hasfocusLastValue===i||(i?n.focus():n.blur(),s.k.u(s.a.qa,null,[n,i?"focusin":"focusout"]))}};s.h.V.hasfocus=!0;s.d.hasFocus=s.d.hasfocus;s.h.V.hasFocus=!0;s.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(n,t){s.a.gb(n,t())}};v("if");v("ifnot",!1,!0);v("with",!0,!1,function(n,t){return n.createChildContext(t)});l={};s.d.options={init:function(n){if("select"!==s.a.v(n))throw Error("options binding applies only to SELECT elements");for(;0<n.length;)n.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,r){function v(){return s.a.xa(t.options,function(n){return n.selected})}function y(n,t,i){var r=typeof t;return"function"==r?t(n):"string"==r?n[t]:i}function p(n,i){if(o&&e)s.i.Y(t,s.a.c(r.get("value")),!0);else if(f.length){var u=0<=s.a.m(f,s.i.s(i[0]));s.a.Sb(i[0],u);o&&!u&&s.k.u(s.a.qa,null,[t,"change"])}}var h=t.multiple,c=0!=t.length&&h?t.scrollTop:null,u=s.a.c(i()),e=r.get("valueAllowUnset")&&r.has("value"),w=r.get("optionsIncludeDestroyed"),a,f,o;i={};f=[];e||(h?f=s.a.Ka(v(),s.i.s):0<=t.selectedIndex&&f.push(s.i.s(t.options[t.selectedIndex])));u&&("undefined"==typeof u.length&&(u=[u]),a=s.a.xa(u,function(t){return w||t===n||null===t||!s.a.c(t._destroy)}),r.has("optionsCaption")&&(u=s.a.c(r.get("optionsCaption")),null!==u&&u!==n&&a.unshift(l)));o=!1;i.beforeRemove=function(n){t.removeChild(n)};u=p;r.has("optionsAfterRender")&&"function"==typeof r.get("optionsAfterRender")&&(u=function(t,i){p(0,i);s.k.u(r.get("optionsAfterRender"),null,[i[0],t!==l?t:n])});s.a.fb(t,a,function(i,u,h){return h.length&&(f=!e&&h[0].selected?[s.i.s(h[0])]:[],o=!0),u=t.ownerDocument.createElement("option"),i===l?(s.a.Ha(u,r.get("optionsCaption")),s.i.Y(u,n)):(h=y(i,r.get("optionsValue"),i),s.i.Y(u,s.a.c(h)),i=y(i,r.get("optionsText"),h),s.a.Ha(u,i)),[u]},i,u);s.k.u(function(){e?s.i.Y(t,s.a.c(r.get("value")),!0):(h?f.length&&v().length<f.length:f.length&&0<=t.selectedIndex?s.i.s(t.options[t.selectedIndex])!==f[0]:f.length||0<=t.selectedIndex)&&s.a.qa(t,"change")});s.a.kc(t);c&&20<Math.abs(c-t.scrollTop)&&(t.scrollTop=c)}};s.d.options.ab=s.a.f.I();s.d.selectedOptions={after:["options","foreach"],init:function(n,t,i){s.a.n(n,"change",function(){var u=t(),r=[];s.a.o(n.getElementsByTagName("option"),function(n){n.selected&&r.push(s.i.s(n))});s.h.ra(u,i,"selectedOptions",r)})},update:function(n,t){if("select"!=s.a.v(n))throw Error("values binding applies only to SELECT elements");var i=s.a.c(t());i&&"number"==typeof i.length&&s.a.o(n.getElementsByTagName("option"),function(n){var t=0<=s.a.m(i,s.i.s(n));s.a.Sb(n,t)})}};s.h.V.selectedOptions=!0;s.d.style={update:function(t,i){var r=s.a.c(i()||{});s.a.A(r,function(i,r){r=s.a.c(r);(null===r||r===n||!1===r)&&(r="");t.style[i]=r})}};s.d.submit={init:function(n,t,i,r,u){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");s.a.n(n,"submit",function(i){var r,f=t();try{r=f.call(u.$data,n)}finally{!0!==r&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}})}};s.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(n,t){s.a.Ha(n,t())}};s.e.R.text=!0,function(){if(i&&i.navigator)var t=function(n){if(n)return parseFloat(n[1])},e=i.opera&&i.opera.version&&parseInt(i.opera.version()),r=i.navigator.userAgent,o=t(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),h=t(r.match(/Firefox\/([^ ]*)/));if(10>s.a.M)var u=s.a.f.I(),f=s.a.f.I(),c=function(n){var t=this.activeElement;(t=t&&s.a.f.get(t,f))&&t(n)},l=function(n,t){var i=n.ownerDocument;s.a.f.get(i,u)||(s.a.f.set(i,u,!0),s.a.n(i,"selectionchange",c));s.a.f.set(n,f,t)};s.d.textInput={init:function(t,i,r){function u(n,i){s.a.n(t,n,i)}function p(){var r=s.a.c(i());(null===r||r===n)&&(r="");v!==n&&r===v?setTimeout(p,4):t.value!==r&&(y=r,t.value=r)}function c(){a||(v=t.value,a=setTimeout(f,4))}function f(){clearTimeout(a);v=a=n;var u=t.value;y!==u&&(y=u,s.h.ra(i(),r,"textInput",u))}var y=t.value,a,v;10>s.a.M?(u("propertychange",function(n){"value"===n.propertyName&&f()}),8==s.a.M&&(u("keyup",f),u("keydown",f)),8<=s.a.M&&(l(t,f),u("dragend",c))):(u("input",f),5>o&&"textarea"===s.a.v(t)?(u("keydown",c),u("paste",c),u("cut",c)):11>e?u("keydown",c):4>h&&(u("DOMAutoComplete",f),u("dragdrop",f),u("drop",f)));u("change",f);s.w(p,null,{q:t})}};s.h.V.textInput=!0;s.d.textinput={preprocess:function(n,t,i){i("textInput",n)}}}();s.d.uniqueName={init:function(n,t){if(t()){var i="ko_unique_"+ ++s.d.uniqueName.fc;s.a.Rb(n,i)}}};s.d.uniqueName.fc=0;s.d.value={after:["options","foreach"],init:function(n,t,i){var o,h;if("input"!=n.tagName.toLowerCase()||"checkbox"!=n.type&&"radio"!=n.type){var r=["change"],u=i.get("valueUpdate"),f=!1,e=null;u&&("string"==typeof u&&(u=[u]),s.a.ia(r,u),r=s.a.wb(r));o=function(){e=null;f=!1;var r=t(),u=s.i.s(n);s.h.ra(r,i,"value",u)};!s.a.M||"input"!=n.tagName.toLowerCase()||"text"!=n.type||"off"==n.autocomplete||n.form&&"off"==n.form.autocomplete||-1!=s.a.m(r,"propertychange")||(s.a.n(n,"propertychange",function(){f=!0}),s.a.n(n,"focus",function(){f=!1}),s.a.n(n,"blur",function(){f&&o()}));s.a.o(r,function(t){var i=o;s.a.Dc(t,"after")&&(i=function(){e=s.i.s(n);setTimeout(o,0)},t=t.substring(5));s.a.n(n,t,i)});h=function(){var r=s.a.c(t()),u=s.i.s(n),f;null!==e&&r===e?setTimeout(h,0):r!==u&&("select"===s.a.v(n)?(f=i.get("valueAllowUnset"),u=function(){s.i.Y(n,r,f)},u(),f||r===s.i.s(n)?setTimeout(u,0):s.k.u(s.a.qa,null,[n,"change"])):s.i.Y(n,r))};s.w(h,null,{q:n})}else s.va(n,{checkedValue:t})},update:function(){}};s.h.V.value=!0;s.d.visible={update:function(n,t){var i=s.a.c(t()),r="none"!=n.style.display;i&&!r?n.style.display="":!i&&r&&(n.style.display="none")}},function(n){s.d[n]={init:function(t,i,r,u,f){return s.d.event.init.call(this,t,function(){var t={};return t[n]=i(),t},r,u,f)}}}("click");s.J=function(){};s.J.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");};s.J.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};s.J.prototype.makeTemplateSource=function(n,t){if("string"==typeof n){t=t||r;var i=t.getElementById(n);if(!i)throw Error("Cannot find template with ID "+n);return new s.t.l(i)}if(1==n.nodeType||8==n.nodeType)return new s.t.ha(n);throw Error("Unknown template type: "+n);};s.J.prototype.renderTemplate=function(n,t,i,r){return n=this.makeTemplateSource(n,r),this.renderTemplateSource(n,t,i,r)};s.J.prototype.isTemplateRewritten=function(n,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(n,t).data("isRewritten")};s.J.prototype.rewriteTemplate=function(n,t,i){n=this.makeTemplateSource(n,i);t=t(n.text());n.text(t);n.data("isRewritten",!0)};s.b("templateEngine",s.J);s.kb=function(){function n(n,t,i,r){var o,f,u,e;for(n=s.h.bb(n),o=s.h.ka,f=0;f<n.length;f++)if(u=n[f].key,o.hasOwnProperty(u))if(e=o[u],"function"==typeof e){if(u=e(n[f].value))throw Error(u);}else if(!e)throw Error("This template engine does not support the '"+u+"' binding within its templates");return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+s.h.Ea(n,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",r.createJavaScriptEvaluatorBlock(i)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{lc:function(n,t,i){t.isTemplateRewritten(n,i)||t.rewriteTemplate(n,function(n){return s.kb.xc(n,t)},i)},xc:function(r,u){return r.replace(t,function(t,i,r,f,e){return n(e,i,r,u)}).replace(i,function(t,i){return n(i,"<!-- ko -->","#comment",u)})},dc:function(n,t){return s.H.$a(function(i,r){var u=i.nextSibling;u&&u.nodeName.toLowerCase()===t&&s.va(u,n,r)})}}}();s.b("__tr_ambtns",s.kb.dc),function(){var i,t;s.t={};s.t.l=function(n){this.l=n};s.t.l.prototype.text=function(){var n=s.a.v(this.l),n="script"===n?"text":"textarea"===n?"value":"innerHTML",t;if(0==arguments.length)return this.l[n];t=arguments[0];"innerHTML"===n?s.a.gb(this.l,t):this.l[n]=t};i=s.a.f.I()+"_";s.t.l.prototype.data=function(n){if(1===arguments.length)return s.a.f.get(this.l,i+n);s.a.f.set(this.l,i+n,arguments[1])};t=s.a.f.I();s.t.ha=function(n){this.l=n};s.t.ha.prototype=new s.t.l;s.t.ha.prototype.text=function(){if(0==arguments.length){var i=s.a.f.get(this.l,t)||{};return i.lb===n&&i.Na&&(i.lb=i.Na.innerHTML),i.lb}s.a.f.set(this.l,t,{lb:arguments[0]})};s.t.l.prototype.nodes=function(){if(0==arguments.length)return(s.a.f.get(this.l,t)||{}).Na;s.a.f.set(this.l,t,{Na:arguments[0]})};s.b("templateSources",s.t);s.b("templateSources.domElement",s.t.l);s.b("templateSources.anonymousTemplate",s.t.ha)}(),function(){function t(n,t,i){var r;for(t=s.e.nextSibling(t);n&&(r=n)!==t;)n=s.e.nextSibling(r),i(r,n)}function f(n,i){if(n.length){var r=n[0],u=n[n.length-1],f=r.parentNode,e=s.L.instance,o=e.preprocessNode;if(o){if(t(r,u,function(n,t){var f=n.previousSibling,i=o.call(e,n);i&&(n===r&&(r=i[0]||t),n===u&&(u=i[i.length-1]||f))}),n.length=0,!r)return;r===u?n.push(r):(n.push(r,u),s.a.na(n,f))}t(r,u,function(n){1!==n.nodeType&&8!==n.nodeType||s.ub(i,n)});t(r,u,function(n){1!==n.nodeType&&8!==n.nodeType||s.H.Xb(n,[i])});s.a.na(n,f)}}function i(n){return n.nodeType?n:0<n.length?n[0]:null}function e(n,t,u,e,o){o=o||{};var h=(n&&i(n)||u||{}).ownerDocument,c=o.templateEngine||r;if(s.kb.lc(u,c,h),u=c.renderTemplate(u,e,o,h),"number"!=typeof u.length||0<u.length&&"number"!=typeof u[0].nodeType)throw Error("Template engine must return an array of DOM nodes");h=!1;switch(t){case"replaceChildren":s.e.T(n,u);h=!0;break;case"replaceNode":s.a.Qb(n,u);h=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t);}return h&&(f(u,e),o.afterRender&&s.k.u(o.afterRender,null,[u,e.$data])),u}function o(n,t,i){return s.F(n)?n():"function"==typeof n?n(t,i):n}var r,u;s.hb=function(t){if(t!=n&&!(t instanceof s.J))throw Error("templateEngine must inherit from ko.templateEngine");r=t};s.eb=function(t,u,f,h,c){if(f=f||{},(f.templateEngine||r)==n)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",h){var l=i(h);return s.j(function(){var n=u&&u instanceof s.N?u:new s.N(s.a.c(u)),r=o(t,n.$data,n),n=e(h,c,r,n,f);"replaceNode"==c&&(h=n,l=i(h))},null,{Pa:function(){return!l||!s.a.Qa(l)},q:l&&"replaceNode"==c?l.parentNode:l})}return s.H.$a(function(n){s.eb(t,u,f,n,"replaceNode")})};s.Cc=function(t,i,r,u,h){function l(n,t){f(t,c);r.afterRender&&r.afterRender(t,n);c=null}function a(n,i){c=h.createChildContext(n,r.as,function(n){n.$index=i});var u=o(t,n,c);return e(null,"ignoreTargetNode",u,c,r)}var c;return s.j(function(){var t=s.a.c(i)||[];"undefined"==typeof t.length&&(t=[t]);t=s.a.xa(t,function(t){return r.includeDestroyed||t===n||null===t||!s.a.c(t._destroy)});s.k.u(s.a.fb,null,[u,t,a,r,l])},null,{q:u})};u=s.a.f.I();s.d.template={init:function(n,t){var i=s.a.c(t());if("string"==typeof i||i.name)s.e.ma(n);else{if("nodes"in i){if(i=i.nodes||[],s.F(i))throw Error('The "nodes" option must be a plain, non-observable array.');}else i=s.e.childNodes(n);i=s.a.Jb(i);new s.t.ha(n).nodes(i)}return{controlsDescendantBindings:!0}},update:function(t,i,r,f,e){var h=i(),o;i=s.a.c(h);r=!0;f=null;"string"==typeof i?i={}:(h=i.name,"if"in i&&(r=s.a.c(i["if"])),r&&"ifnot"in i&&(r=!s.a.c(i.ifnot)),o=s.a.c(i.data));"foreach"in i?f=s.Cc(h||t,r&&i.foreach||[],i,t,e):r?(e="data"in i?e.createChildContext(o,i.as):e,f=s.eb(h||t,e,i,t)):s.e.ma(t);e=f;(o=s.a.f.get(t,u))&&"function"==typeof o.p&&o.p();s.a.f.set(t,u,e&&e.$()?e:n)}};s.h.ka.template=function(n){return n=s.h.bb(n),1==n.length&&n[0].unknown||s.h.vc(n,"name")?null:"This template engine does not support anonymous templates nested within its templates"};s.e.R.template=!0}();s.b("setTemplateEngine",s.hb);s.b("renderTemplate",s.eb);s.a.Cb=function(n,t,i){if(n.length&&t.length)for(var o,r,f,e,u=o=0;(!i||u<i)&&(f=n[o]);++o){for(r=0;e=t[r];++r)if(f.value===e.value){f.moved=e.index;e.moved=f.index;t.splice(r,1);u=r=0;break}u+=r}};s.a.Ma=function(){function n(n,t,i,r,u){for(var o=Math.min,l=Math.max,a=[],c=n.length,f,h=t.length,v=h-c||1,w=c+h+1,y,p,b,e=0;e<=c;e++)for(p=y,a.push(y=[]),b=o(h,e+v),f=l(0,e-1);f<=b;f++)y[f]=f?e?n[e-1]===t[f-1]?p[f-1]:o(p[f]||w,y[f-1]||w)+1:f+1:e+1;for(o=[],l=[],v=[],e=c,f=h;e||f;)h=a[e][f]-1,f&&h===a[e][f-1]?l.push(o[o.length]={status:i,value:t[--f],index:f}):e&&h===a[e-1][f]?v.push(o[o.length]={status:r,value:n[--e],index:e}):(--f,--e,u.sparse||o.push({status:"retained",value:t[f]}));return s.a.Cb(l,v,10*c),o.reverse()}return function(t,i,r){return r="boolean"==typeof r?{dontLimitMoves:r}:r||{},t=t||[],i=i||[],t.length<=i.length?n(t,i,"added","deleted",r):n(i,t,"deleted","added",r)}}();s.b("utils.compareArrays",s.a.Ma),function(){function i(t,i,r,u,f){var e=[],o=s.j(function(){var n=i(r,f,s.a.na(e,t))||[];0<e.length&&(s.a.Qb(e,n),u&&s.k.u(u,null,[r,n,f]));e.length=0;s.a.ia(e,n)},null,{q:t,Pa:function(){return!s.a.tb(e)}});return{aa:e,j:o.$()?o:n}}var t=s.a.f.I();s.a.fb=function(r,u,f,e,o){function rt(n,t){h=k[t];nt!==t&&(it[n]=h);h.Ua(nt++);s.a.na(h.aa,r);g.push(h);p.push(h)}function v(n,t){if(n)for(var i=0,r=t.length;i<r;i++)t[i]&&s.a.o(t[i].aa,function(r){n(r,i,t[i].wa)})}var c,y,ut;u=u||[];e=e||{};var y=s.a.f.get(r,t)===n,k=s.a.f.get(r,t)||[],d=s.a.Ka(k,function(n){return n.wa}),l=s.a.Ma(d,u,e.dontLimitMoves),g=[],a=0,nt=0,tt=[],p=[];u=[];for(var it=[],d=[],h,c=0,w,b;w=l[c];c++)switch(b=w.moved,w.status){case"deleted":b===n&&(h=k[a],h.j&&h.j.p(),tt.push.apply(tt,s.a.na(h.aa,r)),e.beforeRemove&&(u[c]=h,p.push(h)));a++;break;case"retained":rt(c,a++);break;case"added":b!==n?rt(c,b):(h={wa:w.value,Ua:s.r(nt++)},g.push(h),p.push(h),y||(d[c]=h))}for(v(e.beforeMove,it),s.a.o(tt,e.beforeRemove?s.S:s.removeNode),c=0,y=s.e.firstChild(r);h=p[c];c++){for(h.aa||s.a.extend(h,i(r,f,h.wa,o,h.Ua)),a=0;l=h.aa[a];y=l.nextSibling,ut=l,a++)l!==y&&s.e.Fb(r,l,ut);!h.rc&&o&&(o(h.wa,h.aa,h.Ua),h.rc=!0)}v(e.beforeRemove,u);v(e.afterMove,it);v(e.afterAdd,d);s.a.f.set(r,t,g)}}();s.b("utils.setDomNodeChildrenFromArrayMapping",s.a.fb);s.P=function(){this.allowTemplateRewriting=!1};s.P.prototype=new s.J;s.P.prototype.renderTemplateSource=function(n,t,i,r){return(t=(9>s.a.M?0:n.nodes)?n.nodes():null)?s.a.O(t.cloneNode(!0).childNodes):(n=n.text(),s.a.ca(n,r))};s.P.Va=new s.P;s.hb(s.P.Va);s.b("nativeTemplateEngine",s.P),function(){s.Ya=function(){var n=this.uc=function(){if(!t||!t.tmpl)return 0;try{if(0<=t.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(n){}return 1}();this.renderTemplateSource=function(i,u,f,e){if(e=e||r,f=f||{},2>n)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var o=i.data("precompiled");return o||(o=i.text()||"",o=t.template(null,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),i.data("precompiled",o)),i=[u.$data],u=t.extend({koBindingContext:u},f.templateOptions),u=t.tmpl(o,i,u),u.appendTo(e.createElement("div")),t.fragments={},u};this.createJavaScriptEvaluatorBlock=function(n){return"{{ko_code ((function() { return "+n+" })()) }}"};this.addTemplate=function(n,t){r.write("<script type='text/html' id='"+n+"'>"+t+"<\/script>")};0<n&&(t.tmpl.tag.ko_code={open:"__.push($1 || '');"},t.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};s.Ya.prototype=new s.J;var n=new s.Ya;0<n.uc&&s.hb(n);s.b("jqueryTmplTemplateEngine",s.Ya)}()})})()})();
/**
 * alertify
 * An unobtrusive customizable JavaScript notification system
 *
 * @author Fabien Doiron <fabien.doiron@gmail.com>
 * @copyright Fabien Doiron 2013
 * @license MIT <http://opensource.org/licenses/mit-license.php>
 * @link http://fabien-d.github.com/alertify.js/
 * @module alertify
 * @version 0.3.11
 */
(function(n,t){"use strict";var i=n.document,r;r=function(){var u={},s={},v=!1,y={ENTER:13,ESC:27,SPACE:32},a=[],e,c,l,p,w,b,k,h,f,r,g,o,d;return s={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}<\/nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}<\/button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}<\/button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}<\/button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"><\/div>',message:'<p class="alertify-message">{{message}}<\/p>',log:'<article class="alertify-log{{class}}">{{message}}<\/article>'},d=function(){var n,r,u=!1,e=i.createElement("fakeelement"),f={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(n in f)if(e.style[n]!==t){r=f[n];u=!0;break}return{type:r,supported:u}},e=function(n){return i.getElementById(n)},u={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:t,addListeners:function(n){var v=typeof l!="undefined",r=typeof c!="undefined",s=typeof o!="undefined",b="",t=this,u,f,h,a,e;u=function(t){return typeof t.preventDefault!="undefined"&&t.preventDefault(),h(t),typeof o!="undefined"&&(b=o.value),typeof n=="function"&&(typeof o!="undefined"?n(!0,b):n(!0)),!1};f=function(t){return typeof t.preventDefault!="undefined"&&t.preventDefault(),h(t),typeof n=="function"&&n(!1),!1};h=function(){t.hide();t.unbind(i.body,"keyup",a);t.unbind(p,"focus",e);v&&t.unbind(l,"click",u);r&&t.unbind(c,"click",f)};a=function(n){var t=n.keyCode;(t===y.SPACE&&!s||s&&t===y.ENTER)&&u(n);t===y.ESC&&r&&f(n)};e=function(){s?o.focus():!r||t.buttonReverse?l.focus():c.focus()};this.bind(p,"focus",e);this.bind(w,"focus",e);v&&this.bind(l,"click",u);r&&this.bind(c,"click",f);this.bind(i.body,"keyup",a);this.transition.supported||this.setFocus()},bind:function(n,t,i){typeof n.addEventListener=="function"?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)},handleErrors:function(){if(typeof n.onerror!="undefined"){var t=this;return n.onerror=function(n,i,r){t.error("["+n+" on line "+r+" of "+i+"]",0)},!0}return!1},appendButtons:function(n,t){return this.buttonReverse?t+n:n+t},build:function(n){var t="",i=n.type,r=n.message,e=n.cssClass||"";t+='<div class="alertify-dialog">';t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus<\/a>';u.buttonFocus==="none"&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"><\/a>');i==="prompt"&&(t+='<div id="alertify-form">');t+='<article class="alertify-inner">';t+=s.message.replace("{{message}}",r);i==="prompt"&&(t+=s.input);t+=s.buttons.holder;t+="<\/article>";i==="prompt"&&(t+="<\/div>");t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus<\/a>';t+="<\/div>";switch(i){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(s.buttons.cancel,s.buttons.ok));t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",this.appendButtons(s.buttons.cancel,s.buttons.submit));t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",s.buttons.ok);t=t.replace("{{ok}}",this.labels.ok)}return f.className="alertify alertify-"+i+" "+e,h.className="alertify-cover",t},close:function(n,t){var e=t&&!isNaN(t)?+t:this.delay,i=this,u,f;(this.bind(n,"click",function(){u(n)}),f=function(n){n.stopPropagation();i.unbind(this,i.transition.type,f);r.removeChild(this);r.hasChildNodes()||(r.className+=" alertify-logs-hidden")},u=function(n){typeof n!="undefined"&&n.parentNode===r&&(i.transition.supported?(i.bind(n,i.transition.type,f),n.className+=" alertify-log-hide"):(r.removeChild(n),r.hasChildNodes()||(r.className+=" alertify-logs-hidden")))},t!==0)&&setTimeout(function(){u(n)},e)},dialog:function(n,t,u,f,e){k=i.activeElement;var o=function(){r&&r.scrollTop!==null&&h&&h.scrollTop!==null||o()};if(typeof n!="string")throw new Error("message must be a string");if(typeof t!="string")throw new Error("type must be a string");if(typeof u!="undefined"&&typeof u!="function")throw new Error("fn must be a function");return this.init(),o(),a.push({type:t,message:n,callback:u,placeholder:f,cssClass:e}),v||this.setup(),this},extend:function(n){if(typeof n!="string")throw new Error("extend method must have exactly one paramter");return function(t,i){return this.log(t,n,i),this}},hide:function(){var n,t=this;a.splice(0,1);a.length>0?this.setup(!0):(v=!1,n=function(i){i.stopPropagation();t.unbind(f,t.transition.type,n)},this.transition.supported?(this.bind(f,this.transition.type,n),f.className="alertify alertify-hide alertify-hidden"):f.className="alertify alertify-hide alertify-hidden alertify-isHidden",h.className="alertify-cover alertify-cover-hidden",k.focus())},init:function(){i.createElement("nav");i.createElement("article");i.createElement("section");e("alertify-cover")==null&&(h=i.createElement("div"),h.setAttribute("id","alertify-cover"),h.className="alertify-cover alertify-cover-hidden",i.body.appendChild(h));e("alertify")==null&&(v=!1,a=[],f=i.createElement("section"),f.setAttribute("id","alertify"),f.className="alertify alertify-hidden",i.body.appendChild(f));e("alertify-logs")==null&&(r=i.createElement("section"),r.setAttribute("id","alertify-logs"),r.className="alertify-logs alertify-logs-hidden",i.body.appendChild(r));i.body.setAttribute("tabindex","0");this.transition=d()},log:function(n,t,i){var u=function(){r&&r.scrollTop!==null||u()};return this.init(),u(),r.className="alertify-logs",this.notify(n,t,i),this},notify:function(n,t,u){var f=i.createElement("article");f.className="alertify-log"+(typeof t=="string"&&t!==""?" alertify-log-"+t:"");f.innerHTML=n;r.appendChild(f);setTimeout(function(){f.className=f.className+" alertify-log-show"},50);this.close(f,u)},set:function(n){var t;if(typeof n!="object"&&n instanceof Array)throw new Error("args must be an object");for(t in n)n.hasOwnProperty(t)&&(this[t]=n[t])},setFocus:function(){o?(o.focus(),o.select()):b.focus()},setup:function(n){var i=a[0],r=this,s;v=!0;s=function(n){n.stopPropagation();r.setFocus();r.unbind(f,r.transition.type,s)};this.transition.supported&&!n&&this.bind(f,this.transition.type,s);f.innerHTML=this.build(i);p=e("alertify-resetFocus");w=e("alertify-resetFocusBack");l=e("alertify-ok")||t;c=e("alertify-cancel")||t;b=u.buttonFocus==="cancel"?c:u.buttonFocus==="none"?e("alertify-noneFocus"):l;o=e("alertify-text")||t;g=e("alertify-form")||t;typeof i.placeholder=="string"&&i.placeholder!==""&&(o.value=i.placeholder);n&&this.setFocus();this.addListeners(i.callback)},unbind:function(n,t,i){typeof n.removeEventListener=="function"?n.removeEventListener(t,i,!1):n.detachEvent&&n.detachEvent("on"+t,i)}},{alert:function(n,t,i){return u.dialog(n,"alert",t,"",i),this},confirm:function(n,t,i){return u.dialog(n,"confirm",t,"",i),this},extend:u.extend,init:u.init,log:function(n,t,i){return u.log(n,t,i),this},prompt:function(n,t,i,r){return u.dialog(n,"prompt",t,i,r),this},success:function(n,t){return u.log(n,"success",t),this},error:function(n,t){return u.log(n,"error",t),this},set:function(n){u.set(n)},labels:u.labels,debug:u.handleErrors}};typeof define=="function"?define([],function(){return new r}):typeof n.alertify=="undefined"&&(n.alertify=new r)})(this),function(n,t){typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?module.exports=t():n.loki=t()}(this,function(){return function(){"use strict";function u(n,t,i){return n===t?i?!0:!1:n===undefined?!0:t===undefined?!1:n===null?!0:t===null?!1:n<t}function o(n,t,i){return n===t?i?!0:!1:n===undefined?!1:t===undefined?!0:n===null?!1:t===null?!0:n>t}function v(n,t,i){return n===t?0:i?u(n,t)?1:-1:o(n,t)?1:-1}function y(n){return Array.isArray(n)?function(t){return n.indexOf(t)!==-1}:typeof n=="string"?function(t){return n.indexOf(t)!==-1}:n&&typeof n=="object"?function(t){return n.hasOwnProperty(t)}:void 0}function tt(n,t){var r=t||"parse-stringify",i;return r==="parse-stringify"&&(i=JSON.parse(JSON.stringify(n))),i}function p(){try{return"localStorage"in window&&window.localStorage!==null}catch(n){return!1}}function e(){}function i(n,t){this.filename=n||"loki.db";this.collections=[];this.databaseVersion=1.1;this.engineVersion=1.1;this.autosave=!1;this.autosaveInterval=5e3;this.autosaveHandle=null;this.options={};this.persistenceMethod=null;this.persistenceAdapter=null;this.events={init:[],flushChanges:[],close:[],changes:[],warning:[]};var i=function(){return typeof window=="undefined"?"NODEJS":typeof global!="undefined"&&global.window?"NODEJS":typeof document!="undefined"?document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1?"CORDOVA":"BROWSER":"CORDOVA"};this.ENV=t&&t.hasOwnProperty("env")?t.env:i();this.ENV==="undefined"&&(this.ENV="NODEJS");this.configureOptions(t,!0);this.on("init",this.clearChanges)}function h(){this.fs=require("fs")}function c(){}function t(n,t,i,r){return(this.collection=n,this.searchIsChained=!t&&!i,this.filteredrows=[],this.filterInitialized=!1,typeof t!="undefined"&&t!==null)?this.find(t,r):typeof i!="undefined"&&i!==null?this.where(i):this}function r(n,i,r){this.collection=n;this.name=i;this.persistent=!1;typeof r!="undefined"&&(this.persistent=r);this.resultset=new t(n);this.resultdata=[];this.resultsdirty=!1;this.cachedresultset=null;this.filterPipeline=[];this.sortFunction=null;this.sortCriteria=null;this.sortDirty=!1;this.events={rebuild:[]}}function n(n,t){function f(n,t,r){i.changes.push({name:n,operation:t,obj:JSON.parse(JSON.stringify(r))})}function e(){i.changes=[]}function o(n){n&&(n.meta||(n.meta={}),n.meta.created=(new Date).getTime(),n.meta.revision=0)}function s(n){n&&(n.meta.updated=(new Date).getTime(),n.meta.revision+=1)}function a(n){f(i.name,"I",n)}function v(n){f(i.name,"U",n)}function y(n){o(n);a(n)}function p(n){s(n);v(n)}function l(){h=i.disableChangesApi?o:y;c=i.disableChangesApi?s:p}var i,r,u,h,c;if(this.name=n,this.data=[],this.idIndex=[],this.binaryIndices={},this.objType=n,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,i=this,t=t||{},this.transactional=t.hasOwnProperty("transactional")?t.transactional:!1,this.cloneObjects=t.hasOwnProperty("clone")?t.clone:!1,this.asyncListeners=t.hasOwnProperty("asyncListeners")?t.asyncListeners:!1,this.disableChangesApi=t.hasOwnProperty("disableChangesApi")?t.disableChangesApi:!0,this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],"delete":[],warning:[]},this.changes=[],this.ensureId(),r=[],t&&t.indices)if(Object.prototype.toString.call(t.indices)==="[object Array]")r=t.indices;else if(typeof t.indices=="string")r=[t.indices];else throw new TypeError("Indices needs to be a string or an array of strings");for(u=0;u<r.length;u++)this.ensureIndex(r[u]);this.getChanges=function(){return i.changes};this.flushChanges=e;l();this.setChangesApi=function(n){i.disableChangesApi=!n;l()};this.on("insert",function(n){h(n)});this.on("update",function(n){c(n)});this.on("delete",function(n){i.disableChangesApi||f(i.name,"R",n)});this.on("warning",console.warn);e()}function l(n){return n.indexOf(".")!==-1}function it(n){return parseFloat(n,10)}function rt(n,t){return n+t}function w(n,t){return n-t}function a(n){return n.reduce(rt,0)/n.length}function ut(n){var t=a(n),i=n.map(function(n){var i=n-t;return i*i}),r=a(i);return Math.sqrt(r)}function s(n,t,i){if(i===!1)return n[t];for(var u=t.split("."),r=n;u.length>0;)r=r[u.shift()];return r}function b(n,t,i){for(var f=0,u=n.length,e,r;f<u;){if(r=(f+u)/2|0,e=i.apply(null,[t,n[r]]),e===0)return{found:!0,index:r};e<0?u=r:f=r+1}return{found:!1,index:u}}function k(n){return function(t,i){return b(t,i,n)}}function d(){}var g={copyProperties:function(n,t){for(var i in n)t[i]=n[i]}},f={$eq:function(n,t){return n===t},$gt:function(n,t){return o(n,t)},$gte:function(n,t){return o(n,t,!0)},$lt:function(n,t){return u(n,t)},$lte:function(n,t){return u(n,t,!0)},$ne:function(n,t){return n!==t},$regex:function(n,t){return t.test(n)},$in:function(n,t){return t.indexOf(n)>-1},$containsAny:function(n,t){var i;return Array.isArray(t)||(t=[t]),i=y(n,t)||function(){return!1},t.reduce(function(n,t){return n?n:i(t)},!1)},$contains:function(n,t){var i;return Array.isArray(t)||(t=[t]),i=y(n,t)||function(){return!0},t.reduce(function(n,t){return n?i(t):n},!0)}},nt={$eq:f.$eq,$gt:f.$gt,$gte:f.$gte,$lt:f.$lt,$lte:f.$lte,$ne:f.$ne,$regex:f.$regex,$in:f.$in,$contains:f.$contains,$containsAny:f.$containsAny};return e.prototype.events={},e.prototype.asyncListeners=!1,e.prototype.on=function(n,t){var i=this.events[n];return i||(i=this.events[n]=[]),i.push(t),t},e.prototype.emit=function(n,t){var i=this;if(n&&this.events[n])this.events[n].forEach(function(n){i.asyncListeners?setTimeout(function(){n(t)},1):n(t)});else throw new Error("No event "+n+" defined");},e.prototype.removeListener=function(n,t){if(this.events[n]){var i=this.events[n];i.splice(i.indexOf(t),1)}},i.prototype=new e,i.prototype.configureOptions=function(n,t){var i={fs:h,localStorage:c},r;this.options={};this.persistenceMethod=null;this.persistenceAdapter=null;typeof n!="undefined"&&(this.options=n,this.options.hasOwnProperty("persistenceMethod")&&typeof i[n.persistenceMethod]=="function"&&(this.persistenceMethod=n.persistenceMethod,this.persistenceAdapter=new i[n.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=n.adapter),n.hasOwnProperty("autoload")&&typeof t!="undefined"&&t&&(r=this,setTimeout(function(){r.loadDatabase(n,n.autoloadCallback)},1)),this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.autosaveEnable()));this.persistenceAdapter===null&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new i[this.persistenceMethod]))},i.prototype.anonym=function(t,i){var r=new n("anonym",i);return r.insert(t),r},i.prototype.addCollection=function(t,i){var r=new n(t,i);return this.collections.push(r),r},i.prototype.loadCollection=function(n){if(!n.name)throw new Error("Collection must be have a name property to be loaded");this.collections.push(n)},i.prototype.getCollection=function(n){for(var i=this.collections.length,t=0;t<i;t+=1)if(this.collections[t].name===n)return this.collections[t];return this.emit("warning","collection "+n+" not found"),null},i.prototype.listCollections=function(){for(var n=this.collections.length,t=[];n--;)t.push({name:this.collections[n].name,type:this.collections[n].objType,count:this.collections[n].data.length});return t},i.prototype.removeCollection=function(n){for(var i=this.collections.length,t=0;t<i;t+=1)if(this.collections[t].name===n){this.collections.splice(t,1);return}},i.prototype.getName=function(){return this.name},i.prototype.serializeReplacer=function(n,t){switch(n){case"autosaveHandle":return null;case"persistenceAdapter":return null;default:return t}},i.prototype.serialize=function(){return JSON.stringify(this,this.serializeReplacer)},i.prototype.toJson=i.prototype.serialize,i.prototype.loadJSON=function(n,t){var o=JSON.parse(n),s=0,v=o.collections.length,i,r,c,u,a,l,h,f,e;for(this.name=o.name,this.databaseVersion=1,o.hasOwnProperty("databaseVersion")&&(this.databaseVersion=o.databaseVersion),this.collections=[],s;s<v;s+=1){if(i=o.collections[s],r=this.addCollection(i.name),c=i.data.length,u=0,t&&t.hasOwnProperty(i.name))for(a=t[i.name].inflate?t[i.name].inflate:g.copyProperties,u;u<c;u++)l=new t[i.name].proto,a(i.data[u],l),r.data[u]=l;else for(u;u<c;u++)r.data[u]=i.data[u];if(r.transactional=i.transactional,r.asyncListeners=i.asyncListeners,r.disableChangesApi=i.disableChangesApi,r.cloneObjects=i.cloneObjects,r.maxId=i.data.length===0?0:i.maxId,r.idIndex=i.idIndex,typeof i.indices!="undefined"&&(r.idIndex=i.indices.id),typeof i.binaryIndices!="undefined"&&(r.binaryIndices=i.binaryIndices),r.ensureId(),typeof i.DynamicViews!="undefined")for(h=0;h<i.DynamicViews.length;h++)f=i.DynamicViews[h],e=r.addDynamicView(f.name,f.persistent),e.resultdata=f.resultdata,e.resultsdirty=f.resultsdirty,e.filterPipeline=f.filterPipeline,e.sortCriteria=f.sortCriteria,e.sortFunction=null,e.sortDirty=f.sortDirty,e.resultset.filteredrows=f.resultset.filteredrows,e.resultset.searchIsChained=f.resultset.searchIsChained,e.resultset.filterInitialized=f.resultset.filterInitialized,e.rematerialize({removeWhereFilters:!0})}},i.prototype.close=function(n){if(this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&this.saveDatabase()),n)this.on("close",n);this.emit("close")},i.prototype.generateChangesNotification=function(n){function i(n){return n.name}var t=[],r=n||this.collections.map(i);return this.collections.forEach(function(n){r.indexOf(i(n))!==-1&&(t=t.concat(n.getChanges()))}),t},i.prototype.serializeChanges=function(n){return JSON.stringify(this.generateChangesNotification(n))},i.prototype.clearChanges=function(){this.collections.forEach(function(n){n.flushChanges&&n.flushChanges()})},h.prototype.loadDatabase=function(n,t){this.fs.readFile(n,{encoding:"utf8"},function(n,i){n?t(new Error(n)):t(i)})},h.prototype.saveDatabase=function(n,t,i){this.fs.writeFile(n,t,i)},c.prototype.loadDatabase=function(n,t){p()?t(localStorage.getItem(n)):t(new Error("localStorage is not available"))},c.prototype.saveDatabase=function(n,t,i){p()?(localStorage.setItem(n,t),i(null)):i(new Error("localStorage is not available"))},i.prototype.loadDatabase=function(n,t){var i=t||function(n){if(n)throw n;return},r=this;this.persistenceAdapter!==null?this.persistenceAdapter.loadDatabase(this.filename,function(t){typeof t=="string"?(r.loadJSON(t,n||{}),i(null)):(console.warn("lokijs loadDatabase : Database not found"),typeof t=="object"?i(t):i("Database not found"))}):i(new Error("persistenceAdapter not configured"))},i.prototype.saveDatabase=function(n){var t=n||function(n){if(n)throw n;return},i=this;this.persistenceAdapter!==null?this.persistenceAdapter.saveDatabase(this.filename,i.serialize(),function(){i.autosaveClearFlags();t(null)}):t(new Error("persistenceAdapter not configured"))},i.prototype.save=i.prototype.saveDatabase,i.prototype.autosaveDirty=function(){for(var n=0;n<this.collections.length;n++)if(this.collections[n].dirty)return!0;return!1},i.prototype.autosaveClearFlags=function(){for(var n=0;n<this.collections.length;n++)this.collections[n].dirty=!1},i.prototype.autosaveEnable=function(){this.autosave=!0;var n=5e3,t=this;typeof this.autosaveInterval!="undefined"&&this.autosaveInterval!==null&&(n=this.autosaveInterval);this.autosaveHandle=setInterval(function(){t.autosaveDirty()&&t.saveDatabase()},n)},i.prototype.autosaveDisable=function(){typeof this.autosaveHandle!="undefined"&&this.autosaveHandle!==null&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},t.prototype.toJSON=function(){var n=this.copy();return n.collection=null,n},t.prototype.limit=function(n){this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.slice(0,n),t},t.prototype.offset=function(n){this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.splice(n,t.filteredrows.length),t},t.prototype.copy=function(){var n=new t(this.collection,null,null);return n.filteredrows=this.filteredrows.slice(),n.filterInitialized=this.filterInitialized,n},t.prototype.branch=t.prototype.copy,t.prototype.sort=function(n){this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data));var t=function(n,t){return function(i,r){var u=t.collection.data[i],f=t.collection.data[r];return n(u,f)}}(n,this);return this.filteredrows.sort(t),this},t.prototype.simplesort=function(n,t){this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data));typeof t=="undefined"&&(t=!1);var i=function(n,t,i){return function(r,u){var f=i.collection.data[r],e=i.collection.data[u];return v(f[n],e[n],t)}}(n,t,this);return this.filteredrows.sort(i),this},t.prototype.compoundeval=function(n,t,i){var f=n.length,u,r;if(f===0)throw new Error("Invalid call to compoundeval, need at least one property");return(u=!1,r=n[0],typeof r!="string"&&Array.isArray(r)&&(u=r[1],r=r[0]),t[r]===i[r])?f===1?0:this.compoundeval(n.slice(1),t,i,u):v(t[r],i[r],u)},t.prototype.compoundsort=function(n){this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data));var t=function(n,t){return function(i,r){var u=t.collection.data[i],f=t.collection.data[r];return t.compoundeval(n,u,f)}}(n,this);return this.filteredrows.sort(t),this},t.prototype.calculateRange=function(n,t,i){var r=this.collection.data,f=this.collection.binaryIndices[t].values,e=0,s=f.length-1,h=null,l=0,c=f.length-1,v,y,p,a;if(r.length===0)return[0,-1];v=r[f[e]][t];y=r[f[s]][t];switch(n){case"$eq":if(u(i,v)||o(i,y))return[0,-1];break;case"$gt":if(o(i,y,!0))return[0,-1];break;case"$gte":if(o(i,y))return[0,-1];break;case"$lt":if(u(i,v,!0))return[0,-1];break;case"$lte":if(u(i,v))return[0,-1]}while(e<s)h=Math.floor((e+s)/2),u(r[f[h]][t],i)?e=h+1:s=h;for(l=e,e=0,s=f.length-1;e<s;)h=Math.floor((e+s)/2),u(i,r[f[h]][t])?s=h:e=h+1;c=s;p=r[f[l]][t];a=r[f[c]][t];switch(n){case"$eq":return p!==i?[0,-1]:(a!==i&&c--,[l,c]);case"$gt":return u(a,i,!0)?[0,-1]:[c,r.length-1];case"$gte":return u(p,i)?[0,-1]:[l,r.length-1];case"$lt":return l===0&&u(p,i)?[0,0]:[0,l-1];case"$lte":return(a!==i&&c--,c===0&&u(a,i))?[0,0]:[0,c];default:return[0,r.length-1]}},t.prototype.findOr=function(n){var t=0,i=0,r=null,f=[],u=null;if(this.filterInitialized){for(f=[],i=0;i<n.length;i++)for(u=this.branch(),u.find(n[i]),u.data(),r=u.filteredrows,t=0;t<r.length;t++)f.indexOf(r[t])===-1&&f.push(r[t]);this.filteredrows=f}else for(i=0;i<n.length;i++)for(u=this.collection.chain(),u.find(n[i]),u.data(),r=u.filteredrows,t=0;t<r.length;t++)this.filteredrows.indexOf(r[t])===-1&&this.filteredrows.push(r[t]);return this.filterInitialized=!0,this},t.prototype.findAnd=function(n){for(var t=0;t<n.length;t++)this.find(n[t]);return this},t.prototype.dotSubScan=function(n,t,i,r){for(var u=null,e,s=t.split("."),o,f=0;f<s.length;f++)if(o=s[f],u){for(e=0;e<u.length;e++)if(i(u[e][o],r))return!0}else n=n[o],Array.isArray(n)&&(u=n);return i(n,r)},t.prototype.find=function(n,t){var v,l,w;if(this.collection.data.length===0)return this.searchIsChained?(this.filteredrows=[],this.filterInitialized=!0,this):[];var e=n||"getAll",s,o,h,f,y,p=!1,r=[],a=null,c,u,i,b=!0;t=t||!1;for(f in e){b=!1;break}if(b&&(e="getAll"),e==="getAll")return this.searchIsChained?(this.filteredrows=Object.keys(this.collection.data),this):this.collection.data;v=!1;for(f in e)if(e.hasOwnProperty(f)){if(s=f,f==="$and")return this.searchIsChained?(this.findAnd(e[f]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(r=this.collection.chain().findAnd(e[f]).data(),t)?r.length===0?[]:r[0]:r;if(f==="$or")return this.searchIsChained?(this.findOr(e[f]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(r=this.collection.chain().findOr(e[f]).data(),t)?r.length===0?[]:r[0]:r;if(f.indexOf(".")!=-1&&(v=!0),typeof e[f]!="object")h="$eq",o=e[f];else if(typeof e[f]=="object")for(y in e[f])e[f].hasOwnProperty(y)&&(h=y,o=e[f][y]);else throw"Do not know what you want to do.";break}if(h==="$regex"&&(o=new RegExp(o)),this.collection.data===null)throw new TypeError;if((!this.searchIsChained||this.searchIsChained&&!this.filterInitialized)&&h!=="$ne"&&h!=="$regex"&&h!=="$contains"&&h!=="$containsAny"&&h!=="$in"&&this.collection.binaryIndices.hasOwnProperty(s)&&(this.collection.ensureIndex(s),p=!0,a=this.collection.binaryIndices[s]),c=nt[h],this.searchIsChained){if(this.filterInitialized){if(p)for(u=a,i=this.filteredrows.length;i--;)c(u[this.filteredrows[i]],o)&&r.push(this.filteredrows[i]);else if(u=this.collection.data,i=this.filteredrows.length,v)while(i--)this.dotSubScan(u[this.filteredrows[i]],s,c,o)&&r.push(this.filteredrows[i]);else while(i--)c(u[this.filteredrows[i]][s],o)&&r.push(this.filteredrows[i]);return this.filteredrows=r,this}if(p){for(u=this.collection.data,l=this.calculateRange(h,s,o,this),w=l[0];w<=l[1];w++)r.push(a.values[w]);this.filteredrows=r}else if(u=this.collection.data,i=u.length,v)while(i--)this.dotSubScan(u[i],s,c,o)&&r.push(i);else while(i--)c(u[i][s],o)&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}if(p){if(u=this.collection.data,l=this.calculateRange(h,s,o,this),t)return l[1]!==-1?u[a.values[l[0]]]:[];for(i=l[0];i<=l[1];i++)r.push(u[a.values[i]]);this.filteredrows=r}else{if(u=this.collection.data,i=u.length,t){while(i--)if(c(u[i][s],o))return u[i];return[]}if(v)while(i--)this.dotSubScan(u[i],s,c,o)&&r.push(u[i]);else while(i--)c(u[i][s],o)&&r.push(u[i])}return r},t.prototype.where=function(n){var r,i=[],t;if("function"==typeof n)r=n;else throw"Argument is not a stored view or a function";try{if(this.searchIsChained){if(this.filterInitialized){for(t=this.filteredrows.length;t--;)r(this.collection.data[this.filteredrows[t]])===!0&&i.push(this.filteredrows[t]);return this.filteredrows=i,this}for(t=this.collection.data.length;t--;)r(this.collection.data[t])===!0&&i.push(t);return this.filteredrows=i,this.filterInitialized=!0,this}for(t=this.collection.data.length;t--;)r(this.collection.data[t])===!0&&i.push(this.collection.data[t]);return i}catch(u){throw u;}},t.prototype.data=function(){var t=[];if(this.searchIsChained&&!this.filterInitialized){if(this.filteredrows.length===0)return this.collection.data;this.filterInitialized=!0}for(var i=this.collection.data,r=this.filteredrows,u=this.filteredrows.length,n=0;n<u;n++)t.push(i[r[n]]);return t},t.prototype.update=function(n){var r,i,t;if(typeof n!="function")throw"Argument is not a function";for(this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data)),r=this.filteredrows.length,i=this.collection.data,t=0;t<r;t++)n(i[this.filteredrows[t]]),this.collection.update(i[this.filteredrows[t]]);return this},t.prototype.remove=function(){var t,n;for(this.searchIsChained&&!this.filterInitialized&&this.filteredrows.length===0&&(this.filteredrows=Object.keys(this.collection.data)),t=this.filteredrows.length,n=0;n<t;n++)this.collection.remove(this.filteredrows[n]);return this.filteredrows=[],this},t.prototype.mapReduce=function(n,t){try{return t(this.data().map(n))}catch(i){throw i;}},t.prototype.eqJoin=function(i,r,u,f){var s=[],c,o=[],l,h,a=[],y=typeof r=="function",p=typeof u=="function",v={},e;if(s=this.data(),c=s.length,i instanceof t)o=i.data();else if(Array.isArray(i))o=i;else throw new TypeError("joinData needs to be an array or result set");for(l=o.length,e=0;e<l;e++)h=p?u(o[e]):o[e][u],v[h]=o[e];for(f||(f=function(n,t){return{left:n,right:t}}),e=0;e<c;e++)h=y?r(s[e]):s[e][r],a.push(f(s[e],v[h]||{}));return this.collection=new n("joinData"),this.collection.insert(a),this.filteredrows=[],this.filterInitialized=!1,this},t.prototype.map=function(t){var i=this.data().map(t);return this.collection=new n("mappedData"),this.collection.insert(i),this.filteredrows=[],this.filterInitialized=!1,this},r.prototype=new e,r.prototype.rematerialize=function(n){var r,i,u,f;if(n=n||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new t(this.collection),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0),n.hasOwnProperty("removeWhereFilters"))for(r=this.filterPipeline.length,i=r;i--;)this.filterPipeline[i].type==="where"&&(i!==this.filterPipeline.length-1&&(this.filterPipeline[i]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);for(f=this.filterPipeline,this.filterPipeline=[],r=f.length,u=0;u<r;u++)this.applyFind(f[u].val);return this.data(),this.emit("rebuild",this),this},r.prototype.branchResultset=function(){return this.resultset.copy()},r.prototype.toJSON=function(){var n=new r(this.collection,this.name,this.persistent);return n.resultset=this.resultset,n.resultdata=[],n.resultsdirty=!0,n.filterPipeline=this.filterPipeline,n.sortFunction=this.sortFunction,n.sortCriteria=this.sortCriteria,n.sortDirty=this.sortDirty,n.collection=null,n},r.prototype.applySort=function(n){return this.sortFunction=n,this.sortCriteria=null,this.queueSortPhase(),this},r.prototype.applySimpleSort=function(n,t){return typeof t=="undefined"&&(t=!1),this.sortCriteria=[[n,t]],this.sortFunction=null,this.queueSortPhase(),this},r.prototype.applySortCriteria=function(n){return this.sortCriterial=n,this.sortFunction=null,this.queueSortPhase(),this},r.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},r.prototype.commit=function(){return this.cachedresultset=null,this},r.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},r.prototype.applyFind=function(n){return this.filterPipeline.push({type:"find",val:n}),this.resultset.find(n),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},r.prototype.applyWhere=function(n){return this.filterPipeline.push({type:"where",val:n}),this.resultset.where(n),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},r.prototype.data=function(){return((this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized)&&this.performSortPhase(),!this.persistent)?this.resultset.data():this.resultdata},r.prototype.queueSortPhase=function(){var n=this;this.sortDirty||(this.sortDirty=!0,setTimeout(function(){n.performSortPhase()},1))},r.prototype.performSortPhase=function(){(this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized)&&(this.sortFunction&&this.resultset.sort(this.sortFunction),this.sortCriteria&&this.resultset.compoundsort(this.sortCriteria),this.persistent)&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1,this.sortDirty=!1,this.emit("rebuild",this))},r.prototype.evaluateDocument=function(n){var r=this.resultset.filteredrows,i=r.indexOf(n),u=r.length,e=new t(this.collection),f,o;for(e.filteredrows=[n],e.filterInitialized=!0,f=0;f<this.filterPipeline.length;f++)switch(this.filterPipeline[f].type){case"find":e.find(this.filterPipeline[f].val);break;case"where":e.where(this.filterPipeline[f].val)}if(o=e.filteredrows.length===0?-1:0,i!=-1||o!=-1){if(i===-1&&o!==-1){r.push(n);this.persistent&&this.resultdata.push(this.collection.data[n]);(this.sortFunction||this.sortCriteria)&&this.queueSortPhase();return}if(i!==-1&&o===-1){i<u-1?(r[i]=r[u-1],r.length=u-1,this.persistent&&(this.resultdata[i]=this.resultdata[u-1],this.resultdata.length=u-1)):(r.length=u-1,this.persistent&&(this.resultdata.length=u-1));(this.sortFunction||this.sortCriteria)&&this.queueSortPhase();return}if(i!==-1&&o!==-1){this.persistent&&(this.resultdata[i]=this.collection.data[n]);(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0);return}}},r.prototype.removeDocument=function(n){var t=this.resultset.filteredrows,u=t.indexOf(n),i=t.length,r;for(u!==-1&&(u<i-1?(t[u]=t[i-1],t.length=i-1,this.persistent&&(this.resultdata[u]=this.resultdata[i-1],this.resultdata.length=i-1)):(t.length=i-1,this.persistent&&(this.resultdata.length=i-1)),(this.sortFunction||this.sortCriteria)&&this.queueSortPhase()),i=t.length,r=0;r<i;r++)t[r]>n&&t[r]--},r.prototype.mapReduce=function(n,t){try{return t(this.data().map(n))}catch(i){throw i;}},n.prototype=new e,n.prototype.ensureIndex=function(n,t){var r,f,i,e;if(typeof t=="undefined"&&(t=!1),n===null||n===undefined)throw"Attempting to set index without an associated property";if(!this.binaryIndices.hasOwnProperty(n)||t||this.binaryIndices[n].dirty){for(this.binaryIndices[n]={name:n,dirty:!0,values:[]},f=this.data.length,i=0,r=this.binaryIndices[n],i;i<f;i+=1)r.values.push(i);e=function(n,t){return function(i,r){var f=t.data[i],e=t.data[r];return f[n]===e[n]?0:o(f[n],e[n])?1:u(f[n],e[n])?-1:void 0}}(n,this);r.values.sort(e);r.dirty=!1;this.dirty=!0}},n.prototype.ensureAllIndexes=function(n){for(var t=Object.keys(this.binaryIndices),i=t.length;i--;)this.ensureIndex(t[i],n)},n.prototype.flagBinaryIndexesDirty=function(){for(var n=Object.keys(this.binaryIndices),t=n.length;t--;)this.binaryIndices[n[t]].dirty=!0},n.prototype.ensureId=function(){var t=this.data.length,n=0;for(this.idIndex=[],n;n<t;n+=1)this.idIndex.push(this.data[n].$loki)},n.prototype.ensureIdAsync=function(n){this.async(function(){this.ensureId()},n)},n.prototype.addDynamicView=function(n,t){var i=new r(this,n,t);return this.DynamicViews.push(i),i},n.prototype.removeDynamicView=function(n){for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].name===n&&this.DynamicViews.splice(t,1)},n.prototype.getDynamicView=function(n){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===n)return this.DynamicViews[t];return null},n.prototype.findAndUpdate=function(n,t){var r=this.where(n),i=0,u;try{for(i;i<r.length;i++)u=t(r[i]),this.update(u)}catch(f){this.rollback();console.error(f.message)}},n.prototype.insert=function(n){var r,i,t,u;if(!n){r=new Error("Object cannot be null");this.emit("error",r);throw r;}return i=this,u=Array.isArray(n)?n:[n],u.forEach(function(n){if(typeof n!="object")throw new TypeError("Document needs to be an object");t=i.clone?JSON.parse(JSON.stringify(n)):n;typeof t.meta=="undefined"&&(t.meta={revision:0,created:0});i.emit("pre-insert",t);i.add(t);i.emit("insert",t)}),t},n.prototype.clear=function(){this.data=[];this.idIndex=[];this.binaryIndices={};this.cachedIndex=null;this.cachedData=null;this.maxId=0;this.DynamicViews=[];this.dirty=!0},n.prototype.update=function(n){var t,e,i,o,r,u;if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),Array.isArray(n)){for(t=0,e=n.length,t;t<e;t+=1)this.update(n[t]);return}if(!n.hasOwnProperty("$loki"))throw"Trying to update unsynced document. Please save the document first by using insert() or addMany()";try{if(this.startTransaction(),i=this.get(n.$loki,!0),!i)throw new Error("Trying to update a document not in collection.");for(this.emit("pre-update",n),o=i[0],r=i[1],this.data[r]=n,u=0;u<this.DynamicViews.length;u++)this.DynamicViews[u].evaluateDocument(r);this.idIndex[r]=o.$loki;this.commit();this.dirty=!0;this.emit("update",n)}catch(f){this.rollback();console.error(f.message);this.emit("error",f);throw f;}},n.prototype.add=function(n){var i=this.DynamicViews.length,t;if("object"!=typeof n)throw"Object being added needs to be an object";if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),typeof n.$loki!="undefined")throw"Document is already in collection, please use update()";try{for(this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),n.$loki=this.maxId,n.meta.version=0,this.data.push(n),t=0;t<i;t++)this.DynamicViews[t].evaluateDocument(this.data.length-1);return this.idIndex.push(n.$loki),this.commit(),this.dirty=!0,n}catch(r){this.rollback();console.error(r.message)}},n.prototype.removeWhere=function(n){for(var i=typeof n=="function"?this.data.filter(n):new t(this,n),r=i.length;r--;)this.remove(i[r])},n.prototype.removeDataOnly=function(){this.removeWhere(function(){return!0})},n.prototype.remove=function(n){var t,u,f,i,r;if(typeof n=="number"&&(n=this.get(n)),"object"!=typeof n)throw new Error("Parameter is not an object");if(Array.isArray(n)){for(t=0,u=n.length,t;t<u;t+=1)this.remove(n[t]);return}if(!n.hasOwnProperty("$loki"))throw new Error("Object is not a document stored in the collection");Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty();try{for(this.startTransaction(),f=this.get(n.$loki,!0),i=f[1],r=0;r<this.DynamicViews.length;r++)this.DynamicViews[r].removeDocument(i);this.data.splice(i,1);this.idIndex.splice(i,1);this.commit();this.dirty=!0;this.emit("delete")}catch(e){this.rollback();console.error(e.message);this.emit("error",e)}},n.prototype.get=function(n,t){var e=t||!1,r=this.idIndex,u=r.length-1,i=0,f=Math.floor(i+(u-i)/2);if(n=typeof n=="number"?n:parseInt(n,10),isNaN(n))throw"Passed id is not an integer";while(r[i]<r[u])f=Math.floor((i+u)/2),r[f]<n?i=f+1:u=f;return u===i&&r[i]===n?e?[this.data[i],i]:this.data[i]:null},n.prototype.findOne=function(n){var i=new t(this,n,null,!0);return Array.isArray(i)&&i.length===0?null:i},n.prototype.chain=function(){return new t(this,null,null)},n.prototype.find=function(n){return typeof n=="undefined"&&(n="getAll"),new t(this,n,null)},n.prototype.findOneUnindexed=function(n,t){for(var i=this.data.length;i--;)if(this.data[i][n]===t)return this.data[i];return null},n.prototype.startTransaction=function(){if(this.transactional){this.cachedData=tt(this.data,"parse-stringify");this.cachedIndex=this.idIndex;this.cachedBinaryIndex=this.binaryIndices;for(var n=0;n<this.DynamicViews.length;n++)this.DynamicViews[n].startTransaction()}},n.prototype.commit=function(){if(this.transactional){this.cachedData=null;this.cachedIndex=null;this.cachedBinaryIndices=null;for(var n=0;n<this.DynamicViews.length;n++)this.DynamicViews[n].commit()}},n.prototype.rollback=function(){if(this.transactional){this.cachedData!==null&&this.cachedIndex!==null&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var n=0;n<this.DynamicViews.length;n++)this.DynamicViews[n].rollback()}},n.prototype.async=function(n,t){setTimeout(function(){if(typeof n=="function")n(),t();else throw"Argument passed for async execution is not a function";},0)},n.prototype.where=function(n){return new t(this,null,n)},n.prototype.mapReduce=function(n,t){try{return t(this.data.map(n))}catch(i){throw i;}},n.prototype.eqJoin=function(n,i,r,u){return new t(this).eqJoin(n,i,r,u)},n.prototype.no_op=function(){return},n.prototype.extract=function(n){var t=0,r=this.data.length,u=l(n),i=[];for(t;t<r;t+=1)i.push(s(this.data[t],n,u));return i},n.prototype.max=function(n){return Math.max.apply(null,this.extract(n))},n.prototype.min=function(n){return Math.min.apply(null,this.extract(n))},n.prototype.maxRecord=function(n){var t=0,f=this.data.length,u=l(n),r={index:0,value:undefined},i=undefined;for(t;t<f;t+=1)i!==undefined?i<s(this.data[t],n,u)&&(i=s(this.data[t],n,u),r.index=this.data[t].$loki):(i=s(this.data[t],n,u),r.index=this.data[t].$loki);return r.value=i,r},n.prototype.minRecord=function(n){var t=0,f=this.data.length,u=l(n),r={index:0,value:undefined},i=undefined;for(t;t<f;t+=1)i!==undefined?i>s(this.data[t],n,u)&&(i=s(this.data[t],n,u),r.index=this.data[t].$loki):(i=s(this.data[t],n,u),r.index=this.data[t].$loki);return r.value=i,r},n.prototype.extractNumerical=function(n){return this.extract(n).map(it).filter(Number).filter(function(n){return!isNaN(n)})},n.prototype.avg=function(n){return a(this.extractNumerical(n))},n.prototype.stdDev=function(n){return ut(this.extractNumerical(n))},n.prototype.mode=function(n){var t={},f=this.extract(n),r,i,u;f.forEach(function(n){t[n]?t[n]+=1:t[n]=1});r=undefined;for(i in t)r?r<t[i]&&(u=i):(u=i,r=t[i]);return u},n.prototype.median=function(n){var t=this.extractNumerical(n),i;return t.sort(w),i=Math.floor(t.length/2),t.length%2?t[i]:(t[i-1]+t[i])/2},d.prototype={keys:[],values:[],sort:function(n,t){return n<t?-1:n>t?1:0},setSort:function(n){this.bs=new k(n)},bs:function(){return new k(this.sort)},set:function(n,t){var i=this.bs(this.keys,n);i.found?this.values[i.index]=t:(this.keys.splice(i.index,0,n),this.values.splice(i.index,0,t))},get:function(n){return this.values[b(this.keys,n,this.sort).index]}},i.Collection=n,i.KeyValueStore=d,i}()});lokiIndexedAdapter=function(){function n(n){this.app="loki";typeof n!="undefined"&&(this.app=n);this.catalog=null;this.checkAvailability()||console.error("indexedDB does not seem to be supported for your environment")}function t(n){this.db=null;this.initializeLokiCatalog(n)}return n.prototype.checkAvailability=function(){return window&&window.indexedDB?!0:!1},n.prototype.loadDatabase=function(n,i){var u=this.app,r=this;if(this.catalog===null){this.catalog=new t(function(t){r.catalog=t;r.loadDatabase(n,i)});return}this.catalog.getAppKey(u,n,function(n){if(typeof i=="function"){if(n.id===0){console.warn("loki indexeddb adapter could not find database");i(null);return}i(n.val)}else console.log(n.val)})},n.prototype.loadKey=n.prototype.loadDatabase,n.prototype.saveDatabase=function(n,i,r){var u=this.app,f=this;if(this.catalog===null){this.catalog=new t(function(t){f.catalog=t;t.setAppKey(u,n,i,r)});return}this.catalog.setAppKey(u,n,i,r)},n.prototype.saveKey=n.prototype.saveDatabase,n.prototype.deleteDatabase=function(n){var r=this.app,i=this;if(this.catalog===null){this.catalog=new t(function(t){i.catalog=t;i.deleteDatabase(n)});return}this.catalog.getAppKey(r,n,function(n){var t=n.id;t!==0&&i.catalog.deleteAppKey(t)})},n.prototype.deleteKey=n.prototype.deleteDatabase,n.prototype.getDatabaseList=function(n){var r=this.app,i=this;if(this.catalog===null){this.catalog=new t(function(t){i.catalog=t;i.getDatabaseList(n)});return}this.catalog.getAppKeys(r,function(t){for(var i=[],r=0;r<t.length;r++)i.push(t[r].key);typeof n=="function"?n(i):i.forEach(function(n){console.log(n)})})},n.prototype.getKeyList=n.prototype.getDatabaseList,n.prototype.getCatalogSummary=function(n){var r=this.app,i=this;if(this.catalog===null){this.catalog=new t(function(t){i.catalog=t;i.getCatalogSummary(n)});return}this.catalog.getAllKeys(function(t){for(var r=[],i,f,e,o,s,u=0;u<t.length;u++)i=t[u],e=i.app||"",o=i.key||"",s=i.val||"",f=e.length*2+o.length*2+s.length+1,r.push({app:i.app,key:i.key,size:f});typeof n=="function"?n(r):r.forEach(function(n){console.log(n)})})},t.prototype.initializeLokiCatalog=function(n){var t=indexedDB.open("LokiCatalog",1),i=this;t.onupgradeneeded=function(n){var t=n.target.result,i;t.objectStoreNames.contains("LokiAKV")&&t.deleteObjectStore("LokiAKV");t.objectStoreNames.contains("LokiAKV")||(i=t.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0}),i.createIndex("app","app",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("appkey","appkey",{unique:!0}))};t.onsuccess=function(t){i.db=t.target.result;typeof n=="function"&&n(i)};t.onerror=function(n){throw n;}},t.prototype.getAppKey=function(n,t,i){var u=this.db.transaction(["LokiAKV"],"readonly"),f=u.objectStore("LokiAKV"),e=f.index("appkey"),o=n+","+t,r=e.get(o);r.onsuccess=function(n){return function(t){var i=t.target.result;typeof i=="undefined"&&(i={id:0,success:!1});typeof n=="function"?n(i):console.log(i)}}(i);r.onerror=function(n){return function(t){if(typeof n=="function")n({id:0,success:!1});else throw t;}}(i)},t.prototype.getAppKeyById=function(n,t,i){var r=this.db.transaction(["LokiAKV"],"readonly"),u=r.objectStore("LokiAKV"),f=u.get(n);f.onsuccess=function(n,t){return function(i){typeof t=="function"?t(i.target.result,n):console.log(i.target.result)}}(i,t)},t.prototype.setAppKey=function(n,t,i,r){var e=this.db.transaction(["LokiAKV"],"readwrite"),f=e.objectStore("LokiAKV"),o=f.index("appkey"),s=n+","+t,u=o.get(s);u.onsuccess=function(e){var o=e.target.result,s;o==null?o={app:n,key:t,appkey:n+","+t,val:i}:o.val=i;s=f.put(o);s.onerror=function(n){return function(){typeof n=="function"?n({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(u.error))}}(r);s.onsuccess=function(n){return function(){typeof n=="function"&&n({success:!0})}}(r)};u.onerror=function(n){return function(){typeof n=="function"?n({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(u.error))}}(r)},t.prototype.deleteAppKey=function(n,t){var r=this.db.transaction(["LokiAKV"],"readwrite"),u=r.objectStore("LokiAKV"),i=u.delete(n);i.onsuccess=function(n){return function(){typeof n=="function"&&n({success:!0})}}(t);i.onerror=function(n){return function(){typeof n=="function"?n(!1):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(i.error))}}(t)},t.prototype.getAppKeys=function(n,t){var r=this.db.transaction(["LokiAKV"],"readonly"),u=r.objectStore("LokiAKV"),f=u.index("app"),e=IDBKeyRange.only(n),i=f.openCursor(e);i.onsuccess=function(n,t){return function(i){var r=i.target.result,u;r?(u=r.value,n.push(u),r.continue()):typeof t=="function"?t(n):console.log(n)}}([],t);i.onerror=function(n){return function(t){typeof n=="function"?n(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))}}(t)},t.prototype.getAllKeys=function(n){var i=this.db.transaction(["LokiAKV"],"readonly"),r=i.objectStore("LokiAKV"),t=r.openCursor();t.onsuccess=function(n,t){return function(i){var r=i.target.result,u;r?(u=r.value,n.push(u),r.continue()):typeof t=="function"?t(n):console.log(n)}}([],n);t.onerror=function(n){return function(){typeof n=="function"&&n(null)}}(n)},n}();TridentAdapter.prototype.loadDatabase=function(n,t){var i=this.app;VAR_TRIDENT_API.GetAppKey(i,n,function(n){if(typeof t=="function"){if(n.id===0){console.warn("trident adapter could not find database");t(null);return}t(n.val)}else console.log(n.val)})};TridentAdapter.prototype.saveDatabase=function(n,t,i){var r=this.app;VAR_TRIDENT_API.SetAppKey(r,n,t,i)};TridentAdapter.prototype.deleteDatabase=function(n){var t=this.app;VAR_TRIDENT_API.GetAppKey(t,n,function(n){var t=n.id;t!==0&&VAR_TRIDENT_API.DeleteAppKey(t)})};TridentAdapter.prototype.getDatabaseList=function(n){var t=this.app;VAR_TRIDENT_API.GetAppKeys(t,function(t){for(var i=[],r=0;r<t.length;r++)i.push(t[r].key);typeof n=="function"?n(i):i.forEach(function(n){console.log(n)})})};TridentAdapter.prototype.getCatalogSummary=function(n){var t=this.app;VAR_TRIDENT_API.GetAllKeys(function(t){for(var r=[],i,f,e,o,s,u=0;u<t.length;u++)i=t[u],e=i.app||"",o=i.key||"",s=i.val||"",f=e.length*2+o.length*2+s.length+1,r.push({app:i.app,key:i.key,size:f});typeof n=="function"?n(r):r.forEach(function(n){console.log(n)})})};prettyPrint=function(){var n={el:function(t,i){var u=document.createElement(t),r,f;i=n.merge({},i);i&&i.style&&(f=i.style,n.applyCSS(u,i.style),delete i.style);for(r in i)i.hasOwnProperty(r)&&(u[r]=i[r]);return u},applyCSS:function(n,t){for(var i in t)if(t.hasOwnProperty(i))try{n.style[i]=t[i]}catch(r){}},txt:function(n){return document.createTextNode(n)},row:function(t,i,r){r=r||"td";var e=n.count(t,null)+1,f=n.el("tr"),u,o={style:n.getStyles(r,i),colSpan:e,onmouseover:function(){var t=this.parentNode.childNodes;n.forEach(t,function(t){t.nodeName.toLowerCase()==="td"&&n.applyCSS(t,n.getStyles("td_hover",i))})},onmouseout:function(){var t=this.parentNode.childNodes;n.forEach(t,function(t){t.nodeName.toLowerCase()==="td"&&n.applyCSS(t,n.getStyles("td",i))})}};return n.forEach(t,function(t){t!==null&&(u=n.el(r,o),t.nodeType?u.appendChild(t):u.innerHTML=n.shorten(t.toString()),f.appendChild(u))}),f},hRow:function(t,i){return n.row(t,i,"th")},table:function(t,i){t=t||[];var r={thead:{style:n.getStyles("thead",i)},tbody:{style:n.getStyles("tbody",i)},table:{style:n.getStyles("table",i)}},u=n.el("table",r.table),f=n.el("thead",r.thead),e=n.el("tbody",r.tbody);return t.length&&(u.appendChild(f),f.appendChild(n.hRow(t,i))),u.appendChild(e),{node:u,tbody:e,thead:f,appendChild:function(n){this.tbody.appendChild(n)},addRow:function(t,r,u){return this.appendChild(n.row.call(n,t,r||i,u)),this}}},shorten:function(n){var t=60;return n=n.replace(/^\s\s*|\s\s*$|\n/g,""),n.length>t?n.substring(0,t-1)+"...":n},htmlentities:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},merge:function(t,i){var r,u,f,e;typeof t!="object"&&(t={});for(r in i)if(i.hasOwnProperty(r)){if(u=i[r],typeof u=="object"){t[r]=n.merge(t[r],u);continue}t[r]=u}for(f=2,e=arguments.length;f<e;f++)n.merge(t,arguments[f]);return t},count:function(n,t){for(var r=0,i=0,u=n.length;i<u;i++)n[i]===t&&r++;return r},thead:function(n){return n.getElementsByTagName("thead")[0]},forEach:function(n,t,i){i||(i=t);for(var u=n.length,r=-1;++r<u;)if(i(n[r],r,n)===!1)break;return!0},type:function(n){try{if(n===null)return"null";if(n===undefined)return"undefined";var t=Object.prototype.toString.call(n).match(/\s(.+?)\]/)[1].toLowerCase();return n.nodeType?n.nodeType===1?"domelement":"domnode":/^(string|number|array|regexp|function|date|boolean)$/.test(t)?t:typeof n=="object"?n.jquery&&typeof n.jquery=="string"?"jquery":"object":n===window||n===document?"object":"default"}catch(i){return"default"}},within:function(n){return{is:function(t){for(var i in n)if(n[i]===t)return i;return""}}},common:{circRef:function(i,r){return n.expander("[POINTS BACK TO <strong>"+r+"<\/strong>]","Click to show this item anyway",function(){this.parentNode.appendChild(t(i,{maxDepth:1}))})},depthReached:function(i){return n.expander("[DEPTH REACHED]","Click to show this item anyway",function(){try{this.parentNode.appendChild(t(i,{maxDepth:1}))}catch(r){this.parentNode.appendChild(n.table(["ERROR OCCURED DURING OBJECT RETRIEVAL"],"error").addRow([r.message]).node)}})}},getStyles:function(i,r){return r=t.settings.styles[r]||{},n.merge({},t.settings.styles["default"][i],r[i])},expander:function(t,i,r){return n.el("a",{innerHTML:n.shorten(t)+' <b style="visibility:hidden;">[+]<\/b>',title:i,onmouseover:function(){var n=this.getElementsByTagName("b")[0];n&&(n.style.visibility="visible")},onmouseout:function(){var n=this.getElementsByTagName("b")[0];n&&(n.style.visibility="hidden")},onclick:function(){return this.style.display="none",r.call(this),!1},style:{cursor:"pointer"}})},stringify:function(t){var u=n.type(t),i,f=!0,r;if(u==="array")return i="[",n.forEach(t,function(t,r){i+=(r===0?"":", ")+n.stringify(t)}),i+"]";if(typeof t=="object"){i="{";for(r in t)t.hasOwnProperty(r)&&(i+=(f?"":", ")+r+":"+n.stringify(t[r]),f=!1);return i+"}"}return u==="regexp"?"/"+t.source+"/":u==="string"?'"'+t.replace(/"/g,'\\"')+'"':t.toString()},headerGradient:function(){var n=document.createElement("canvas"),t,i,r;return n.getContext?(t=n.getContext("2d"),n.height=30,n.width=1,i=t.createLinearGradient(0,0,0,30),i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"rgba(0,0,0,0.25)"),t.fillStyle=i,t.fillRect(0,0,1,30),r=n.toDataURL&&n.toDataURL(),"url("+(r||"")+")"):""}()},t=function(i,r){var e;r=r||{};var u=n.merge({},t.config,r),o=n.el("div"),h=t.config,f={},s=!1;return t.settings=u,e={string:function(t){return n.txt('"'+n.shorten(t.replace(/"/g,'\\"'))+'"')},number:function(t){return n.txt(t)},regexp:function(t){var i=n.table(["RegExp",null],"regexp"),r=n.table(),f=n.expander("/"+t.source+"/","Click to show more",function(){this.parentNode.appendChild(i.node)});return r.addRow(["g",t.global]).addRow(["i",t.ignoreCase]).addRow(["m",t.multiline]),i.addRow(["source","/"+t.source+"/"]).addRow(["flags",r.node]).addRow(["lastIndex",t.lastIndex]),u.expanded?i.node:f},domelement:function(t){var i=n.table(["DOMElement",null],"domelement"),r=t.nodeName||"";return i.addRow(["tag","&lt;"+r.toLowerCase()+"&gt;"]),n.forEach(["id","className","innerHTML","src","href"],function(r){t[r]&&i.addRow([r,n.htmlentities(t[r])])}),u.expanded?i.node:n.expander("DOMElement ("+r.toLowerCase()+")","Click to show more",function(){this.parentNode.appendChild(i.node)})},domnode:function(t){var i=n.table(["DOMNode",null],"domelement"),r=n.htmlentities((t.data||"UNDEFINED").replace(/\n/g,"\\n"));return i.addRow(["nodeType",t.nodeType+" ("+t.nodeName+")"]).addRow(["data",r]),u.expanded?i.node:n.expander("DOMNode","Click to show more",function(){this.parentNode.appendChild(i.node)})},jquery:function(n,t,i){return e.array(n,t,i,!0)},object:function(t,i,r){var v=n.within(f).is(t),o,c,h,l,a,y;if(v)return n.common.circRef(t,v,u);if(f[r||"TOP"]=t,i===u.maxDepth)return n.common.depthReached(t,u);o=n.table(["Object",null],"object");c=!0;for(h in t)if(!t.hasOwnProperty||t.hasOwnProperty(h)){l=t[h];a=n.type(l);c=!1;try{o.addRow([h,e[a](l,i+1,h)],a)}catch(p){window.console&&window.console.log&&console.log(p.message)}}return c?o.addRow(["<small>[empty]<\/small>"]):o.thead.appendChild(n.hRow(["key","value"],"colHeader")),y=u.expanded||s?o.node:n.expander(n.stringify(t),"Click to show more",function(){this.parentNode.appendChild(o.node)}),s=!0,y},array:function(t,i,r,o){var h=n.within(f).is(t);if(h)return n.common.circRef(t,h);if(f[r||"TOP"]=t,i===u.maxDepth)return n.common.depthReached(t);var c=o?"jQuery":"Array",s=n.table([c+"("+t.length+")",null],o?"jquery":c.toLowerCase()),l=!0,a=0;return o&&s.addRow(["selector",t.selector]),n.forEach(t,function(r,f){if(u.maxArray>=0&&++a>u.maxArray)return s.addRow([f+".."+(t.length-1),e[n.type(r)]("...",i+1,f)]),!1;l=!1;s.addRow([f,e[n.type(r)](r,i+1,f)])}),o||(l?s.addRow(["<small>[empty]<\/small>"]):s.thead.appendChild(n.hRow(["index","value"],"colHeader"))),u.expanded?s.node:n.expander(n.stringify(t),"Click to show more",function(){this.parentNode.appendChild(s.node)})},"function":function(t,i,r){var o=n.within(f).is(t);if(o)return n.common.circRef(t,o);f[r||"TOP"]=t;var e=n.table(["Function",null],"function"),c=n.table(["Arguments"]),s=t.toString().match(/\((.+?)\)/),h=t.toString().match(/\(.*?\)\s+?\{?([\S\s]+)/)[1].replace(/\}?$/,"");return e.addRow(["arguments",s?s[1].replace(/[^\w_,\s]/g,""):"<small>[none/native]<\/small>"]).addRow(["body",h]),u.expanded?e.node:n.expander("function(){...}","Click to see more about this function.",function(){this.parentNode.appendChild(e.node)})},date:function(t){var i=n.table(["Date",null],"date"),r=t.toString().split(/\s/);return i.addRow(["Time",r[4]]).addRow(["Date",r.slice(0,4).join("-")]),u.expanded?i.node:n.expander("Date (timestamp): "+ +t,"Click to see a little more info about this date",function(){this.parentNode.appendChild(i.node)})},boolean:function(t){return n.txt(t.toString().toUpperCase())},undefined:function(){return n.txt("UNDEFINED")},"null":function(){return n.txt("NULL")},"default":function(){return n.txt("prettyPrint: TypeNotFound Error")}},o.appendChild(e[u.forceObject?"object":n.type(i)](i,0)),o};return t.config={expanded:!0,forceObject:!1,maxDepth:3,maxArray:-1,styles:{array:{th:{backgroundColor:"#6DBD2A",color:"white"}},"function":{th:{backgroundColor:"#D82525"}},regexp:{th:{backgroundColor:"#E2F3FB",color:"#000"}},object:{th:{backgroundColor:"#1F96CF"}},jquery:{th:{backgroundColor:"#FBF315"}},error:{th:{backgroundColor:"red",color:"yellow"}},domelement:{th:{backgroundColor:"#F3801E"}},date:{th:{backgroundColor:"#A725D8"}},colHeader:{th:{backgroundColor:"#EEE",color:"#000",textTransform:"uppercase"}},"default":{table:{borderCollapse:"collapse",width:"100%"},td:{padding:"5px",fontSize:"12px",backgroundColor:"#FFF",color:"#222",border:"1px solid #000",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',whiteSpace:"nowrap"},td_hover:{},th:{padding:"5px",fontSize:"12px",backgroundColor:"#222",color:"#EEE",textAlign:"left",border:"1px solid #000",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',backgroundImage:n.headerGradient,backgroundRepeat:"repeat-x"}}}},t}();shortcut={all_shortcuts:{},add:function(n,t,i){var e={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1},f,r,o,u;if(i)for(f in e)typeof i[f]=="undefined"&&(i[f]=e[f]);else i=e;r=i.target;typeof i.target=="string"&&(r=document.getElementById(i.target));o=this;n=n.toLowerCase();u=function(r){var o,e,s;if(r=r||window.event,!i.disable_in_input||(r.target?o=r.target:r.srcElement&&(o=r.srcElement),o.nodeType==3&&(o=o.parentNode),o.tagName!="INPUT"&&o.tagName!="TEXTAREA")){r.keyCode?code=r.keyCode:r.which&&(code=r.which);e=String.fromCharCode(code).toLowerCase();code==188&&(e=",");code==190&&(e=".");var h=n.split("+"),f=0,c={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},u={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};for(r.ctrlKey&&(u.ctrl.pressed=!0),r.shiftKey&&(u.shift.pressed=!0),r.altKey&&(u.alt.pressed=!0),r.metaKey&&(u.meta.pressed=!0),s=0;k=h[s],s<h.length;s++)k=="ctrl"||k=="control"?(f++,u.ctrl.wanted=!0):k=="shift"?(f++,u.shift.wanted=!0):k=="alt"?(f++,u.alt.wanted=!0):k=="meta"?(f++,u.meta.wanted=!0):k.length>1?l[k]==code&&f++:i.keycode?i.keycode==code&&f++:e==k?f++:c[e]&&r.shiftKey&&(e=c[e],e==k&&f++);if(f==h.length&&u.ctrl.pressed==u.ctrl.wanted&&u.shift.pressed==u.shift.wanted&&u.alt.pressed==u.alt.wanted&&u.meta.pressed==u.meta.wanted&&(t(r),!i.propagate))return r.cancelBubble=!0,r.returnValue=!1,r.stopPropagation&&(r.stopPropagation(),r.preventDefault()),!1}};this.all_shortcuts[n]={callback:u,target:r,event:i.type};r.addEventListener?r.addEventListener(i.type,u,!1):r.attachEvent?r.attachEvent("on"+i.type,u):r["on"+i.type]=u},remove:function(n){var t;if(n=n.toLowerCase(),t=this.all_shortcuts[n],delete this.all_shortcuts[n],t){var r=t.event,i=t.target,u=t.callback;i.detachEvent?i.detachEvent("on"+r,u):i.removeEventListener?i.removeEventListener(r,u,!1):i["on"+r]=!1}}},function(n){var r,f;n.fn.metrojs={capabilities:null,checkCapabilities:function(t,i){return(n.fn.metrojs.capabilities==null||typeof i!="undefined"&&i==!0)&&(n.fn.metrojs.capabilities=new n.fn.metrojs.MetroModernizr(t)),n.fn.metrojs.capabilities}};r=n.fn.metrojs;f=99e3;n.fn.liveTile=function(t){var r,i;if(u[t]){for(r=[],i=1;i<=arguments.length;i++)r[i-1]=arguments[i];return u[t].apply(this,r)}return typeof t!="object"&&t?(n.error("Method "+t+" does not exist on jQuery.liveTile"),null):u.init.apply(this,arguments)};n.fn.liveTile.contentModules={modules:[],addContentModule:function(n,t){this.modules instanceof Array||(this.modules=[]);this.modules.push(t)},hasContentModule:function(n){if(typeof n=="undefined"||!(this.modules instanceof Array))return-1;for(var t=0;t<this.modules.length;t++)if(typeof this.modules[t].moduleName!="undefined"&&this.modules[t].moduleName==n)return t;return-1}};n.fn.liveTile.defaults={mode:"slide",speed:500,initDelay:-1,delay:5e3,stops:"100%",stack:!1,direction:"vertical",animationDirection:"forward",tileSelector:">div,>li,>p,>img,>a",tileFaceSelector:">div,>li,>p,>img,>a",ignoreDataAttributes:!1,click:null,link:"",newWindow:!1,bounce:!1,bounceDirections:"all",bounceFollowsMove:!0,pauseOnHover:!1,pauseOnHoverEvent:"both",playOnHover:!1,playOnHoverEvent:"both",onHoverDelay:0,repeatCount:-1,appendBack:!0,alwaysTrigger:!1,flipListOnHover:!1,flipListOnHoverEvent:"mouseout",noHAflipOpacity:"1",haTransFunc:"ease",noHaTransFunc:"linear",currentIndex:0,startNow:!0,useModernizr:typeof Modernizr!="undefined",useHardwareAccel:!0,useTranslate:!0,faces:{$front:null,$back:null},animationStarting:function(){},animationComplete:function(){},triggerDelay:function(){return Math.random()*3e3},swap:"",swapFront:"-",swapBack:"-",contentModules:[]};var u={init:function(u){var f=n.extend({},n.fn.liveTile.defaults,u);return r.checkCapabilities(f),i.getBrowserPrefix(),n.fn.liveTile.contentModules.hasContentModule("image")==-1&&n.fn.liveTile.contentModules.addContentModule("image",e.imageSwap),n.fn.liveTile.contentModules.hasContentModule("html")==-1&&n.fn.liveTile.contentModules.addContentModule("html",e.htmlSwap),n(this).each(function(i,r){var e=n(r),u=t.initTileData(e,f),o;u.faces=t.prepTile(e,u);u.fade=function(n){t.fade(e,n)};u.slide=function(n){t.slide(e,n)};u.carousel=function(n){t.carousel(e,n)};u.flip=function(n){t.flip(e,n)};u.flipList=function(n){t.flipList(e,n)};o={fade:u.fade,slide:u.slide,carousel:u.carousel,flip:u.flip,"flip-list":u.flipList};u.doAction=function(n){var t=o[u.mode];typeof t=="function"&&(t(n),u.hasRun=!0);n==u.timer.repeatCount&&(u.runEvents=!1)};u.timer=new n.fn.metrojs.TileTimer(u.delay,u.doAction,u.repeatCount);e.data("LiveTile",u);(u.mode!=="flip-list"||u.flipListOnHover==!1)&&(u.pauseOnHover?t.bindPauseOnHover(e):u.playOnHover&&t.bindPlayOnHover(e,u));(u.link.length>0||typeof u.click=="function")&&e.css({cursor:"pointer"}).bind("click.liveTile",function(n){var t=!0;typeof u.click=="function"&&(t=u.click(e,u)||!1);t&&u.link.length>0&&(n.preventDefault(),u.newWindow?window.open(u.link):window.location=u.link)});t.bindBounce(e,u);u.startNow&&u.mode!="none"&&(u.runEvents=!0,u.timer.start(u.initDelay))})},goto:function(t){var i,r=typeof t,u;if(r==="undefined"&&(i={index:-99,delay:0,autoAniDirection:!1}),r!=="number"&&isNaN(t))if(r==="string")if(t=="next")i={index:-99,delay:0};else if(t.indexOf("prev")===0)i={index:-100,delay:0};else return n.error(t+' is not a recognized action for .liveTile("goto")'),n(this);else r==="object"&&(typeof t.delay=="undefined"&&(t.delay=0),u=typeof t.index,u==="undefined"?t.index=0:u==="string"&&(t.index==="next"?t.index=-99:t.index.indexOf("prev")===0&&(t.index=-100)),i=t);else i={index:parseInt(t,10),delay:0};return n(this).each(function(t,r){var o=n(r),u=o.data("LiveTile"),h=o.data("metrojs.tile"),f=i.index,s,e;if(h.animating===!0)return n(this);if(u.mode==="carousel"){if(s=u.faces.$listTiles.filter(".active"),e=u.faces.$listTiles.index(s),f===-100?((typeof i.autoAniDirection=="undefined"||i.autoAniDirection==!0)&&(u.tempValues.animationDirection=typeof i.animationDirection=="undefined"?"backward":i.animationDirection),f=e===0?u.faces.$listTiles.length-1:e-1):f===-99&&((typeof i.autoAniDirection=="undefined"||i.autoAniDirection==!0)&&(u.tempValues.animationDirection=typeof i.animationDirection=="undefined"?"forward":i.animationDirection),f=e+1),e==f)return;typeof i.direction!="undefined"&&(u.tempValues.direction=i.direction);typeof i.animationDirection!="undefined"&&(u.tempValues.animationDirection=i.animationDirection);u.currentIndex=f==0?u.faces.$listTiles.length:f-1}else u.currentIndex=f;u.runEvents=!0;u.timer.start(i.delay>=0?i.delay:u.delay)})},play:function(t){var i,r=typeof t;return r==="undefined"?i={delay:-1}:r==="number"?i={delay:t}:r==="object"&&(typeof t.delay=="undefined"&&(t.delay=-1),i=t),n(this).each(function(t,r){var f=n(r),u=f.data("LiveTile");u.runEvents=!0;i.delay<0&&!u.hasRun&&(i.delay=u.initDelay);u.timer.start(i.delay>=0?i.delay:u.delay)})},animate:function(){return n(this).each(function(t,i){var r=n(i),u=r.data("LiveTile");u.doAction()})},stop:function(){return n(this).each(function(t,i){var u=n(i),r=u.data("LiveTile");r.hasRun=!1;r.runEvents=!1;r.timer.stop();window.clearTimeout(r.eventTimeout);window.clearTimeout(r.flCompleteTimeout);window.clearTimeout(r.completeTimeout);r.mode==="flip-list"&&r.faces.$listTiles.each(function(t,i){var r=n(i).data("metrojs.tile");window.clearTimeout(r.eventTimeout);window.clearTimeout(r.flCompleteTimeout);window.clearTimeout(r.completeTimeout)})})},pause:function(){return n(this).each(function(t,i){var u=n(i),r=u.data("LiveTile");r.timer.pause();r.runEvents=!1;window.clearTimeout(r.eventTimeout);window.clearTimeout(r.flCompleteTimeout);window.clearTimeout(r.completeTimeout);r.mode==="flip-list"&&r.faces.$listTiles.each(function(t,i){var r=n(i).data("metrojs.tile");window.clearTimeout(r.eventTimeout);window.clearTimeout(r.flCompleteTimeout);window.clearTimeout(r.completeTimeout)})})},restart:function(t){var i,r=typeof t;return r==="undefined"?i={delay:-1}:r==="number"?i={delay:t}:r==="object"&&(typeof t.delay=="undefined"&&(t.delay=-1),i=t),n(this).each(function(t,r){var f=n(r),u=f.data("LiveTile");i.delay<0&&!u.hasRun&&(i.delay=u.initDelay);u.hasRun=!1;u.runEvents=!0;u.timer.restart(i.delay>=0?i.delay:u.delay)})},rebind:function(t){return n(this).each(function(n,i){typeof t!="undefined"?(typeof t.timer!="undefined"&&t.timer!=null&&t.timer.stop(),t.hasRun=!1,u.init.apply(i,t)):u.init.apply(i,{})})},destroy:function(r){var f=typeof r,u;return f==="undefined"?u={removeCss:!1}:f==="boolean"?u={removeCss:r}:f==="object"&&(typeof r.removeCss=="undefined"&&(r.removeCss=!1),u=r),n(this).each(function(r,f){var o=n(f),e=o.data("LiveTile"),s;typeof e!="undefined"&&(o.unbind(".liveTile"),s=i.appendStyleProperties({margin:"",cursor:""},["transform","transition"],["",""]),e.timer.stop(),window.clearTimeout(e.eventTimeout),window.clearTimeout(e.flCompleteTimeout),window.clearTimeout(e.completeTimeout),e.faces.$listTiles!=null&&e.faces.$listTiles.each(function(i,r){var f=n(r),o,h;e.mode==="flip-list"?(o=f.data("metrojs.tile"),window.clearTimeout(o.eventTimeout),window.clearTimeout(o.flCompleteTimeout),window.clearTimeout(o.completeTimeout)):e.mode==="carousel"&&(h=e.listData[i],h.bounce&&t.unbindMsBounce(f,h));u.removeCss?(f.removeClass("ha"),f.find(e.tileFaceSelector).unbind(".liveTile").removeClass("bounce flip-front flip-back ha slide slide-front slide-back").css(s)):f.find(e.tileFaceSelector).unbind(".liveTile");f.removeData("metrojs.tile")}).unbind(".liveTile"),e.faces.$front!=null&&u.removeCss&&e.faces.$front.removeClass("flip-front flip-back ha slide slide-front slide-back").css(s),e.faces.$back!=null&&u.removeCss&&e.faces.$back.removeClass("flip-front flip-back ha slide slide-front slide-back").css(s),e.bounce&&t.unbindMsBounce(o,e),e.playOnHover&&t.unbindMsPlayOnHover(o,e),e.pauseOnhover&&t.unbindMsPauseOnHover(o,e),o.removeClass("ha"),o.removeData("LiveTile"),o.removeData("metrojs.tile"),e=null)})}},t={dataAtr:function(n,t,i){return typeof n.attr("data-"+t)!="undefined"?n.attr("data-"+t):i},dataMethod:function(n,t,i){return typeof n.data(t)!="undefined"?n.data(t):i},getDataOrDefault:null,initTileData:function(i,u){var s=u.ignoreDataAttributes==!1,f=null,e,l,o,c;this.getDataOrDefault==null&&(this.getDataOrDefault=r.capabilities.isOldJQuery?this.dataAtr:this.dataMethod);f=s?{speed:this.getDataOrDefault(i,"speed",u.speed),delay:this.getDataOrDefault(i,"delay",u.delay),stops:this.getDataOrDefault(i,"stops",u.stops),stack:this.getDataOrDefault(i,"stack",u.stack),mode:this.getDataOrDefault(i,"mode",u.mode),direction:this.getDataOrDefault(i,"direction",u.direction),useHardwareAccel:this.getDataOrDefault(i,"ha",u.useHardwareAccel),repeatCount:this.getDataOrDefault(i,"repeat",u.repeatCount),swap:this.getDataOrDefault(i,"swap",u.swap),appendBack:this.getDataOrDefault(i,"appendback",u.appendBack),currentIndex:this.getDataOrDefault(i,"start-index",u.currentIndex),animationDirection:this.getDataOrDefault(i,"ani-direction",u.animationDirection),startNow:this.getDataOrDefault(i,"start-now",u.startNow),tileSelector:this.getDataOrDefault(i,"tile-selector",u.tileSelector),tileFaceSelector:this.getDataOrDefault(i,"face-selector",u.tileFaceSelector),bounce:this.getDataOrDefault(i,"bounce",u.bounce),bounceDirections:this.getDataOrDefault(i,"bounce-dir",u.bounceDirections),bounceFollowsMove:this.getDataOrDefault(i,"bounce-follows",u.bounceFollowsMove),click:this.getDataOrDefault(i,"click",u.click),link:this.getDataOrDefault(i,"link",u.link),newWindow:this.getDataOrDefault(i,"new-window",u.newWindow),alwaysTrigger:this.getDataOrDefault(i,"always-trigger",u.alwaysTrigger),flipListOnHover:this.getDataOrDefault(i,"flip-onhover",u.flipListOnHover),pauseOnHover:this.getDataOrDefault(i,"pause-onhover",u.pauseOnHover),playOnHover:this.getDataOrDefault(i,"play-onhover",u.playOnHover),onHoverDelay:this.getDataOrDefault(i,"hover-delay",u.onHoverDelay),noHAflipOpacity:this.getDataOrDefault(i,"flip-opacity",u.noHAflipOpacity),useTranslate:this.getDataOrDefault(i,"use-translate",u.useTranslate),runEvents:!1,isReversed:!1,loopCount:0,contentModules:[],listData:[],height:i.height(),width:i.width(),tempValues:{}}:n.extend(!0,{runEvents:!1,isReversed:!1,loopCount:0,contentModules:[],listData:[],height:i.height(),width:i.width(),tempValues:{}},u);f.useTranslate=f.useTranslate&&f.useHardwareAccel&&r.capabilities.canTransform&&r.capabilities.canTransition;f.margin=f.direction==="vertical"?f.height/2:f.width/2;f.stops=typeof u.stops=="object"&&u.stops instanceof Array?u.stops:(""+f.stops).split(",");f.stops.length===1&&f.stops.push("0px");var h=f.swap.replace(" ","").split(","),a=s?this.getDataOrDefault(i,"swap-front",u.swapFront):u.swapFront,v=s?this.getDataOrDefault(i,"swap-back",u.swapBack):u.swapBack;for(f.swapFront=a==="-"?h:a.replace(" ","").split(","),f.swapBack=v==="-"?h:v.replace(" ","").split(","),e=0;e<f.swapFront.length;e++)f.swapFront[e].length>0&&n.inArray(f.swapFront[e],h)===-1&&h.push(f.swapFront[e]);for(e=0;e<f.swapBack.length;e++)f.swapBack[e].length>0&&n.inArray(f.swapBack[e],h)===-1&&h.push(f.swapBack[e]);for(f.swap=h,e=0;e<h.length;e++)h[e].length>0&&(l=n.fn.liveTile.contentModules.hasContentModule(h[e]),l>-1&&f.contentModules.push(n.fn.liveTile.contentModules.modules[l]));for(f.initDelay=s?this.getDataOrDefault(i,"initdelay",u.initDelay):u.initDelay,f.delay<-1?f.delay=u.triggerDelay(1):f.delay<0&&(f.delay=3500+Math.random()*4501),f.initDelay<0&&(f.initDelay=f.delay),o={},e=0;e<f.contentModules.length;e++)n.extend(o,f.contentModules[e].data);for(n.extend(o,u,f),o.mode==="flip-list"?(c=i.find(o.tileSelector).not(".tile-title"),c.each(function(i,r){var u=n(r),f={direction:s?t.getDataOrDefault(u,"direction",o.direction):o.direction,newWindow:s?t.getDataOrDefault(u,"new-window",!1):!1,link:s?t.getDataOrDefault(u,"link",""):"",faces:{$front:null,$back:null},height:u.height(),width:u.width(),isReversed:!1};f.margin=f.direction==="vertical"?f.height/2:f.width/2;o.listData.push(f)})):o.mode==="carousel"&&(o.stack=!0,c=i.find(o.tileSelector).not(".tile-title"),c.each(function(i,r){var u=n(r),f={bounce:s?t.getDataOrDefault(u,"bounce",!1):!1,bounceDirections:s?t.getDataOrDefault(u,"bounce-dir","all"):"all",link:s?t.getDataOrDefault(u,"link",""):"",newWindow:s?t.getDataOrDefault(u,"new-window",!1):!1,animationDirection:s?t.getDataOrDefault(u,"ani-direction",""):"",direction:s?t.getDataOrDefault(u,"direction",""):""};o.listData.push(f)})),e=0;e<f.contentModules.length;e++)typeof o.contentModules[e].initData=="function"&&o.contentModules[e].initData(o,i);return f=null,o},prepTile:function(u,e){var o,c,l,s,h,a,v,y;u.addClass(e.mode);o={$tileFaces:null,$listTiles:null,$front:null,$back:null};switch(e.mode){case"fade":o.$tileFaces=u.find(e.tileFaceSelector).not(".tile-title");o.$front=e.faces.$front!=null&&e.faces.$front.length>0?e.faces.$front.addClass("fade-front"):o.$tileFaces.filter(":first").addClass("fade-front");o.$back=e.faces.$back!=null&&e.faces.$back.length>0?e.faces.$back.addClass("fade-back"):o.$tileFaces.length>1?o.$tileFaces.filter(":last").addClass("fade-back"):e.appendBack?n('<div class="fade-back"><\/div>').appendTo(u):n("<div><\/div>");break;case"slide":o.$tileFaces=u.find(e.tileFaceSelector).not(".tile-title");o.$front=e.faces.$front!=null&&e.faces.$front.length>0?e.faces.$front.addClass("slide-front"):o.$tileFaces.filter(":first").addClass("slide-front");o.$back=e.faces.$back!=null&&e.faces.$back.length>0?e.faces.$back.addClass("slide-back"):o.$tileFaces.length>1?o.$tileFaces.filter(":last").addClass("slide-back"):e.appendBack?n('<div class="slide-back"><\/div>').appendTo(u):n("<div><\/div>");e.stack==!0&&(e.direction==="vertical"?(a="top",v="translate(0%, -100%) translateZ(0)"):(a="left",v="translate(-100%, 0%) translateZ(0)"),s={},e.useTranslate?i.appendStyleProperties(s,["transform"],[v]):s[a]="-100%",o.$back.css(s));u.data("metrojs.tile",{animating:!1});r.capabilities.canTransition&&e.useHardwareAccel&&(u.addClass("ha"),o.$front.addClass("ha"),o.$back.addClass("ha"));break;case"carousel":o.$listTiles=u.find(e.tileSelector).not(".tile-title");y=o.$listTiles.length;u.data("metrojs.tile",{animating:!1});e.currentIndex=Math.min(e.currentIndex,y-1);o.$listTiles.each(function(u,f){var s=n(f).addClass("slide"),o=e.listData[u],c=typeof o.animationDirection=="string"&&o.animationDirection.length>0?o.animationDirection:e.animationDirection,l=typeof o.direction=="string"&&o.direction.length>0?o.direction:e.direction;u==e.currentIndex?s.addClass("active"):c==="forward"?l==="vertical"?(h=e.useTranslate?i.appendStyleProperties({},["transform"],["translate(0%, 100%) translateZ(0)"]):{left:"0%",top:"100%"},s.css(h)):(h=e.useTranslate?i.appendStyleProperties({},["transform"],["translate(100%, 0%) translateZ(0)"]):{left:"100%",top:"0%"},s.css(h)):c==="backward"&&(l==="vertical"?(h=e.useTranslate?i.appendStyleProperties({},["transform"],["translate(0%, -100%) translateZ(0)"]):{left:"0%",top:"-100%"},s.css(h)):(h=e.useTranslate?i.appendStyleProperties({},["transform"],["translate(-100%, 0%) translateZ(0)"]):{left:"-100%",top:"0%"},s.css(h)));t.bindLink(s,o);e.useHardwareAccel&&r.capabilities.canTransition&&t.bindBounce(s,o);s=null;o=null});r.capabilities.canFlip3d&&e.useHardwareAccel&&(u.addClass("ha"),o.$listTiles.addClass("ha"));break;case"flip-list":o.$listTiles=u.find(e.tileSelector).not(".tile-title");o.$listTiles.each(function(u,o){var h=n(o).addClass("tile-"+(u+1)),y=h.find(e.tileFaceSelector).filter(":first").addClass("flip-front").css({margin:"0px"}),a,v,p,w;h.find(e.tileFaceSelector).length===1&&e.appendBack==!0&&h.append("<div><\/div>");a=h.find(e.tileFaceSelector).filter(":last").addClass("flip-back").css({margin:"0px"});e.listData[u].faces.$front=y;e.listData[u].faces.$back=a;h.data("metrojs.tile",{animating:!1,count:1,completeTimeout:null,flCompleteTimeout:null,index:u});v=h.data("metrojs.tile");r.capabilities.canFlip3d&&e.useHardwareAccel?(h.addClass("ha"),y.addClass("ha"),a.addClass("ha"),c=e.listData[u].direction==="vertical"?"rotateX(180deg)":"rotateY(180deg)",s=i.appendStyleProperties({},["transform"],[c]),a.css(s)):(l=e.listData[u].direction==="vertical"?{height:"100%",width:"100%",marginTop:"0px",opacity:"1"}:{height:"100%",width:"100%",marginLeft:"0px",opacity:"1"},s=e.listData[u].direction==="vertical"?{height:"0px",width:"100%",marginTop:e.listData[u].margin+"px",opacity:e.noHAflipOpacity}:{height:"100%",width:"0px",marginLeft:e.listData[u].margin+"px",opacity:e.noHAflipOpacity},y.css(l),a.css(s));p=function(){v.count++;v.count>=f&&(v.count=1)};e.flipListOnHover&&(w=e.flipListOnHoverEvent+".liveTile",y.bind(w,function(){t.flip(h,v.count,e,p)}),a.bind(w,function(){t.flip(h,v.count,e,p)}));e.listData[u].link.length>0&&h.css({cursor:"pointer"}).bind("click.liveTile",function(){e.listData[u].newWindow?window.open(e.listData[u].link):window.location=e.listData[u].link})});break;case"flip":o.$tileFaces=u.find(e.tileFaceSelector).not(".tile-title");o.$front=e.faces.$front!=null&&e.faces.$front.length>0?e.faces.$front.addClass("flip-front"):o.$tileFaces.filter(":first").addClass("flip-front");o.$back=e.faces.$back!=null&&e.faces.$back.length>0?e.faces.$back.addClass("flip-back"):o.$tileFaces.length>1?o.$tileFaces.filter(":last").addClass("flip-back"):e.appendBack?n('<div class="flip-back"><\/div>').appendTo(u):n("<div><\/div>");u.data("metrojs.tile",{animating:!1});r.capabilities.canFlip3d&&e.useHardwareAccel?(u.addClass("ha"),o.$front.addClass("ha"),o.$back.addClass("ha"),c=e.direction==="vertical"?"rotateX(180deg)":"rotateY(180deg)",s=i.appendStyleProperties({},["transform"],[c]),o.$back.css(s)):(l=e.direction==="vertical"?{height:"100%",width:"100%",marginTop:"0px",opacity:"1"}:{height:"100%",width:"100%",marginLeft:"0px",opacity:"1"},s=e.direction==="vertical"?{height:"0%",width:"100%",marginTop:e.margin+"px",opacity:"0"}:{height:"100%",width:"0%",marginLeft:e.margin+"px",opacity:"0"},o.$front.css(l),o.$back.css(s))}return o},bindPauseOnHover:function(t){(function(){var i=t.data("LiveTile"),f=!1,u=!1,e=i.pauseOnHoverEvent=="both"||i.pauseOnHoverEvent=="mouseover"||i.pauseOnHoverEvent=="mouseenter",o=i.pauseOnHoverEvent=="both"||i.pauseOnHoverEvent=="mouseout"||i.pauseOnHoverEvent=="mouseleave";i.pOnHoverMethods={pause:function(){i.timer.pause();i.mode==="flip-list"&&i.faces.$listTiles.each(function(t,i){window.clearTimeout(n(i).data("metrojs.tile").completeTimeout)})},over:function(){f||u||i.runEvents&&(u=!0,i.eventTimeout=window.setTimeout(function(){u=!1;o&&(f=!0);i.pOnHoverMethods.pause()},i.onHoverDelay))},out:function(){if(u){window.clearTimeout(i.eventTimeout);u=!1;return}if(e){if(!f&&!u)return;i.runEvents&&i.timer.start(i.hasRun?i.delay:i.initDelay)}else i.pOnHoverMethods.pause();f=!1}};r.capabilities.canTouch?window.navigator.msPointerEnabled?(e&&t[0].addEventListener("MSPointerOver",i.pOnHoverMethods.over,!1),o&&t[0].addEventListener("MSPointerOut",i.pOnHoverMethods.out,!1)):(e&&t.bind("touchstart.liveTile",i.pOnHoverMethods.over),o&&t.bind("touchend.liveTile",i.pOnHoverMethods.out)):(e&&t.bind("mouseover.liveTile",i.pOnHoverMethods.over),o&&t.bind("mouseout.liveTile",i.pOnHoverMethods.out))})()},unbindMsPauseOnHover:function(n,t){typeof t.pOnHoverMethods!="undefined"&&window.navigator.msPointerEnabled&&(n[0].removeEventListener("MSPointerOver",t.pOnHoverMethods.over,!1),n[0].removeEventListener("MSPointerOut",t.pOnHoverMethods.out,!1))},bindPlayOnHover:function(n,t){(function(){var f=!1,i=!1,e=t.playOnHoverEvent=="both"||t.playOnHoverEvent=="mouseover"||t.playOnHoverEvent=="mouseenter",o=t.playOnHoverEvent=="both"||t.playOnHoverEvent=="mouseout"||t.playOnHoverEvent=="mouseleave";t.onHoverMethods={over:function(){if(!f&&!i&&(!t.bounce||t.bounceMethods.down=="no")){var r=t.mode=="flip"||(t.startNow?!t.isReversed:t.isReversed);window.clearTimeout(t.eventTimeout);(t.runEvents&&r||!t.hasRun)&&(i=!0,t.eventTimeout=window.setTimeout(function(){i=!1;o&&(f=!0);u.play.apply(n[0],[0])},t.onHoverDelay))}},out:function(){if(i){window.clearTimeout(t.eventTimeout);i=!1;return}(!e||f||i)&&(window.clearTimeout(t.eventTimeout),t.eventTimeout=window.setTimeout(function(){var i=t.mode=="flip"||(t.startNow?t.isReversed:!t.isReversed);t.runEvents&&i&&u.play.apply(n[0],[0]);f=!1},t.speed+200))}};r.capabilities.canTouch?window.navigator.msPointerEnabled?(e&&n[0].addEventListener("MSPointerDown",t.onHoverMethods.over,!1),o&&n.bind("mouseleave.liveTile",t.onHoverMethods.out)):(e&&n.bind("touchstart.liveTile",t.onHoverMethods.over),o&&n.bind("touchend.liveTile",t.onHoverMethods.out)):(e&&n.bind("mouseenter.liveTile",t.onHoverMethods.over),o&&n.bind("mouseleave.liveTile",t.onHoverMethods.out))})()},unbindMsPlayOnHover:function(n,t){typeof t.onHoverMethods!="undefined"&&window.navigator.msPointerEnabled&&n[0].removeEventListener("MSPointerDown",t.onHoverMethods.over,!1)},bindBounce:function(t,u){u.bounce&&(t.addClass("bounce"),t.addClass("noselect"),function(){u.bounceMethods={down:"no",threshold:30,zeroPos:{x:0,y:0},eventPos:{x:0,y:0},inTilePos:{x:0,y:0},pointPos:{x:0,y:0},regions:{c:[0,0],tl:[-1,-1],tr:[1,-1],bl:[-1,1],br:[1,1],t:[null,-1],r:[1,null],b:[null,1],l:[-1,null]},targets:{all:["c","t","r","b","l","tl","tr","bl","br"],edges:["c","t","r","b","l"],corners:["c","tl","tr","bl","br"]},hitTest:function(t,i,f,e){var k=u.bounceMethods.regions,h=u.bounceMethods.targets[f],l=0,c=null,y=null,p={hit:[0,0],name:"c"},s,o;if(r.capabilities.isOldAndroid||!r.capabilities.canTransition)return p;typeof h=="undefined"&&(typeof f=="string"&&(h=f.split(",")),n.isArray(h)&&n.inArray("c")==-1&&(e=0,p=null));for(var d=t.width(),g=t.height(),a=[d*e,g*e],w=i.x-d*.5,b=i.y-g*.5,v=[w>0?Math.abs(w)<=a[0]?0:1:Math.abs(w)<=a[0]?0:-1,b>0?Math.abs(b)<=a[1]?0:1:Math.abs(b)<=a[1]?0:-1];l<h.length;l++){if(c!=null)return c;if(s=h[l],o=k[s],s=="*")return s=h[l+1],{region:k[s],name:s};v[0]==o[0]&&v[1]==o[1]?c={hit:o,name:s}:(v[0]==o[0]||o[0]==null)&&(v[1]==o[1]||o[1]==null)&&(y={hit:o,name:s})}return c!=null?c:y!=null?y:p},bounceDown:function(r){var o,s,h;if(r.target.tagName!="A"||n(r).is(".bounce")){var f=r.originalEvent&&r.originalEvent.touches?r.originalEvent.touches[0]:r,e=t.offset(),c=window.pageXOffset,l=window.pageYOffset;u.bounceMethods.pointPos={x:f.pageX,y:f.pageY};u.bounceMethods.inTilePos={x:f.pageX-e.left,y:f.pageY-e.top};u.$tileParent||(u.$tileParent=t.parent());o=u.$tileParent.offset();u.bounceMethods.eventPos={x:e.left-o.left+t.width()/2,y:e.top-o.top+t.height()/2};s=u.bounceMethods.hitTest(t,u.bounceMethods.inTilePos,u.bounceDirections,.25);s==null?u.bounceMethods.down="no":(window.navigator.msPointerEnabled?(document.addEventListener("MSPointerUp",u.bounceMethods.bounceUp,!1),t[0].addEventListener("MSPointerUp",u.bounceMethods.bounceUp,!1),document.addEventListener("MSPointerCancel",u.bounceMethods.bounceUp,!1),u.bounceFollowsMove&&t[0].addEventListener("MSPointerMove",u.bounceMethods.bounceMove,!1)):(n(document).bind("mouseup.liveTile, touchend.liveTile, touchcancel.liveTile, dragstart.liveTile",u.bounceMethods.bounceUp),u.bounceFollowsMove&&(t.bind("touchmove.liveTile",u.bounceMethods.bounceMove),t.bind("mousemove.liveTile",u.bounceMethods.bounceMove))),h="bounce-"+s.name,t.addClass(h),u.bounceMethods.down=h,u.bounceMethods.downPcss=i.appendStyleProperties({},["perspective-origin"],[u.bounceMethods.eventPos.x+"px "+u.bounceMethods.eventPos.y+"px"]),u.$tileParent.css(u.bounceMethods.downPcss))}},bounceUp:function(){u.bounceMethods.down!="no"&&(u.bounceMethods.unBounce(),window.navigator.msPointerEnabled?(document.removeEventListener("MSPointerUp",u.bounceMethods.bounceUp,!1),t[0].removeEventListener("MSPointerUp",u.bounceMethods.bounceUp,!1),document.removeEventListener("MSPointerCancel",u.bounceMethods.bounceUp,!1),u.bounceFollowsMove&&t[0].removeEventListener("MSPointerMove",u.bounceMethods.bounceMove,!1)):n(document).unbind("mouseup.liveTile, touchend.liveTile, touchcancel.liveTile, dragstart.liveTile",u.bounceMethods.bounceUp),u.bounceFollowsMove&&(t.unbind("touchmove.liveTile",u.bounceMethods.bounceMove),t.unbind("mousemove.liveTile",u.bounceMethods.bounceMove)))},bounceMove:function(n){var i;if(u.bounceMethods.down!="no"){var r=n.originalEvent&&n.originalEvent.touches?n.originalEvent.touches[0]:n,f=Math.abs(r.pageX-u.bounceMethods.pointPos.x),e=Math.abs(r.pageY-u.bounceMethods.pointPos.y);(f>u.bounceMethods.threshold||e>u.bounceMethods.threshold)&&(i=u.bounceMethods.down,u.bounceMethods.bounceDown(n),i!=u.bounceMethods.down&&t.removeClass(i))}},unBounce:function(){if(t.removeClass(u.bounceMethods.down),typeof u.bounceMethods.downPcss=="object")u.bounceMethods.downPcss=i.appendStyleProperties({},["perspective-origin","perspective-origin-x","perspective-origin-y"],["","",""]),window.setTimeout(function(){u.$tileParent.css(u.bounceMethods.downPcss)},200);u.bounceMethods.down="no";u.bounceMethods.inTilePos=u.bounceMethods.zeroPos;u.bounceMethods.eventPos=u.bounceMethods.zeroPos}};window.navigator.msPointerEnabled?t[0].addEventListener("MSPointerDown",u.bounceMethods.bounceDown,!1):r.capabilities.canTouch?t.bind("touchstart.liveTile",u.bounceMethods.bounceDown):t.bind("mousedown.liveTile",u.bounceMethods.bounceDown)}())},unbindMsBounce:function(n,t){t.bounce&&window.navigator.msPointerEnabled&&(n[0].removeEventListener("MSPointerDown",t.bounceMethods.bounceDown,!1),n[0].removeEventListener("MSPointerCancel",t.bounceMethods.bounceUp,!1),n[0].removeEventListener("MSPointerOut",t.bounceMethods.bounceUp,!1))},bindLink:function(t,i){i.link.length>0&&t.css({cursor:"pointer"}).bind("click.liveTile",function(t){(t.target.tagName!="A"||n(t).is(".live-tile,.slide,.flip"))&&(i.newWindow?window.open(i.link):window.location=i.link)})},runContenModules:function(n,t,i,r){for(var f,u=0;u<n.contentModules.length;u++)f=n.contentModules[u],typeof f.action=="function"&&f.action(n,t,i,r)},fade:function(n,i,r){var u=typeof r=="object"?r:n.data("LiveTile"),s=function(){(u.timer.repeatCount>0||u.timer.repeatCount==-1)&&u.timer.count!=u.timer.repeatCount&&u.timer.start(u.delay)},f,e,o;if(!u.faces.$front.is(":animated")){if(u.timer.pause(),f=u.loopCount+1,u.isReversed=f%2==0,e=u.animationStarting.call(n[0],u,u.faces.$front,u.faces.$back),typeof e!="undefined"&&e==!1){s();return}u.loopCount=f;o=function(){s();t.runContenModules(u,u.faces.$front,u.faces.$back);u.animationComplete.call(n[0],u,u.faces.$front,u.faces.$back)};u.isReversed?u.faces.$front.fadeIn(u.speed,u.noHaTransFunc,o):u.faces.$front.fadeOut(u.speed,u.noHaTransFunc,o)}},slide:function(u,f,e,o,s){var h=typeof e=="object"?e:u.data("LiveTile"),c=u.data("metrojs.tile"),nt,tt,p,rt,k,d,ut,g,ot,st;if(c.animating==!0||u.is(":animated")){h=null;c=null;return}if(nt=function(){(h.timer.repeatCount>0||h.timer.repeatCount==-1)&&h.timer.count!=h.timer.repeatCount&&h.timer.start(h.delay)},h.mode!=="carousel"){if(h.isReversed=h.currentIndex%2!=0,h.timer.pause(),tt=h.animationStarting.call(u[0],h,h.faces.$front,h.faces.$back),typeof tt!="undefined"&&tt==!1){nt();return}h.loopCount=h.loopCount+1}else h.isReversed=!0;p=typeof h.tempValues.direction=="string"&&h.tempValues.direction.length>0?h.tempValues.direction:h.direction;h.tempValues.direction=null;var l={},a={},ht=typeof o=="undefined"?h.currentIndex:o,v=n.trim(h.stops[Math.min(ht,h.stops.length-1)]),ft=v.indexOf("px"),y=0,w=0,ct=p==="vertical"?h.height:h.width,it=p==="vertical"?"top":"left",b=h.stack==!0,et=function(){typeof s=="undefined"?(h.currentIndex=h.currentIndex+1,h.currentIndex>h.stops.length-1&&(h.currentIndex=0)):s();h.mode!="carousel"&&nt();t.runContenModules(h,h.faces.$front,h.faces.$back,h.currentIndex);h.animationComplete.call(u[0],h,h.faces.$front,h.faces.$back);h=null;c=null};if(ft>0?(w=parseInt(v.substring(0,ft),10),y=w-ct+"px"):(w=parseInt(v.replace("%",""),10),y=w-100+"%"),r.capabilities.canTransition&&h.useHardwareAccel){if(typeof c.animating!="undefined"&&c.animating==!0)return;c.animating=!0;rt=["transition-property","transition-duration","transition-timing-function"];k=[h.useTranslate?"transform":it,h.speed+"ms",h.haTransFunc];k[i.browserPrefix+"transition-property"]=i.browserPrefix+"transform";l=i.appendStyleProperties(l,rt,k);a=i.appendStyleProperties(a,rt,k);d=p==="vertical";ut=d?"top":"left";h.useTranslate?(g=d?"translate(0%, "+v+")":"translate("+v+", 0%)",l=i.appendStyleProperties(l,["transform"],[g+"translateZ(0)"]),b&&(g=d?"translate(0%, "+y+")":"translate("+y+", 0%)",a=i.appendStyleProperties(a,["transform"],[g+"translateZ(0)"]))):(l[ut]=v,b&&(a[ut]=y));h.faces.$front.css(l);b&&h.faces.$back.css(a);window.clearTimeout(h.completeTimeout);h.completeTimeout=window.setTimeout(function(){c.animating=!1;et()},h.speed)}else l[it]=v,a[it]=y,c.animating=!0,ot=h.faces.$front.stop(),st=h.faces.$back.stop(),ot.animate(l,h.speed,h.noHaTransFunc,function(){c.animating=!1;et()}),b&&st.animate(a,h.speed,h.noHaTransFunc,function(){})},carousel:function(n,u){var f=n.data("LiveTile"),a=n.data("metrojs.tile"),p,g,c,s,b,e,l,y;if(a.animating==!0||f.faces.$listTiles.length<=1){a=null;return}p=function(){(f.timer.repeatCount>0||f.timer.repeatCount==-1)&&f.timer.count!=f.timer.repeatCount&&f.timer.start(f.delay)};f.timer.pause();var o=f.faces.$listTiles.filter(".active"),w=f.faces.$listTiles.index(o),k=f.currentIndex,d=k!=w?k:w,v=d+1>=f.faces.$listTiles.length?0:d+1,h=f.listData[v];if(w==v){a=null;o=null;return}if(g=typeof f.tempValues.animationDirection=="string"&&f.tempValues.animationDirection.length>0?f.tempValues.animationDirection:typeof h.animationDirection=="string"&&h.animationDirection.length>0?h.animationDirection:f.animationDirection,f.tempValues.animationDirection=null,typeof f.tempValues.direction=="string"&&f.tempValues.direction.length>0?c=f.tempValues.direction:typeof h.direction=="string"&&h.direction.length>0?(c=h.direction,f.tempValues.direction=c):c=f.direction,s=f.faces.$listTiles.eq(v),b=f.animationStarting.call(n[0],f,o,s),typeof b!="undefined"&&b==!1){p();return}f.loopCount=f.loopCount+1;e=i.appendStyleProperties({},["transition-duration"],["0s"]);l=c==="vertical";g==="backward"?(f.useTranslate&&r.capabilities.canTransition?(y=l?"translate(0%, -100%)":"translate(-100%, 0%)",e=i.appendStyleProperties(e,["transform"],[y+" translateZ(0)"]),f.stops=["100%"]):(l?(e.top="-100%",e.left="0%"):(e.top="0%",e.left="-100%"),f.stops=["100%"]),f.faces.$front=o,f.faces.$back=s):(f.useTranslate&&r.capabilities.canTransition?(y=l?"translate(0%, 100%)":"translate(100%, 0%)",e=i.appendStyleProperties(e,["transform"],[y+" translateZ(0)"])):l?(e.top="100%",e.left="0%"):(e.top="0%",e.left="100%"),f.faces.$front=s,f.faces.$back=o,f.stops=["0%"]);s.css(e);window.setTimeout(function(){o.removeClass("active");s.addClass("active");t.slide(n,u,f,0,function(){f.currentIndex=v;a=null;o=null;s=null;p()})},150)},flip:function(n,u,f,e){var c=n.data("metrojs.tile"),d,rt,g,nt;if(c.animating==!0){c=null;return}var o=typeof f=="object"?f:n.data("LiveTile"),s,h,y,k,tt,it,w=typeof e=="undefined",l=0,a,b=function(){(o.timer.repeatCount>0||o.timer.repeatCount==-1)&&o.timer.count!=o.timer.repeatCount&&o.timer.start(o.delay)};if(w){if(o.timer.pause(),d=o.loopCount+1,a=d%2==0,o.isReversed=a,s=o.faces.$front,h=o.faces.$back,rt=a?[o,h,s]:[o,s,h],g=o.animationStarting.apply(n[0],rt),typeof g!="undefined"&&g==!1){b();return}y=o.direction;height=o.height;width=o.width;margin=o.margin;o.loopCount=d}else a=u%2==0,l=c.index,s=o.listData[l].faces.$front,h=o.listData[l].faces.$back,o.listData[l].isReversed=a,y=o.listData[l].direction,height=o.listData[l].height,width=o.listData[l].width,margin=o.listData[l].margin;if(r.capabilities.canFlip3d&&o.useHardwareAccel){k=a?"360deg":"180deg";tt=y==="vertical"?"rotateX("+k+")":"rotateY("+k+")";it=i.appendStyleProperties({},["transform","transition"],[tt,"all "+o.speed+"ms "+o.haTransFunc+" 0s"]);var ut=a?"540deg":"360deg",ot=y==="vertical"?"rotateX("+ut+")":"rotateY("+ut+")",st=i.appendStyleProperties({},["transform","transition"],[ot,"all "+o.speed+"ms "+o.haTransFunc+" 0s"]);s.css(it);h.css(st);nt=function(){c.animating=!1;var r,u;a?(r=y==="vertical"?"rotateX(0deg)":"rotateY(0deg)",u=i.appendStyleProperties({},["transform","transition"],[r,"all 0s "+o.haTransFunc+" 0s"]),s.css(u),t.runContenModules(o,s,h,l),w?(b(),o.animationComplete.call(n[0],o,s,h)):e(o,s,h),s=null,h=null,o=null,c=null):(t.runContenModules(o,h,s,l),w?(b(),o.animationComplete.call(n[0],o,h,s)):e(o,h,s))};o.mode==="flip-list"?(window.clearTimeout(o.listData[l].completeTimeout),o.listData[l].completeTimeout=window.setTimeout(nt,o.speed)):(window.clearTimeout(o.completeTimeout),o.completeTimeout=window.setTimeout(nt,o.speed))}else{var v=o.speed/2,ft=y==="vertical"?{height:"0px",width:"100%",marginTop:margin+"px",opacity:o.noHAflipOpacity}:{height:"100%",width:"0px",marginLeft:margin+"px",opacity:o.noHAflipOpacity},et=y==="vertical"?{height:"100%",width:"100%",marginTop:"0px",opacity:"1"}:{height:"100%",width:"100%",marginLeft:"0px",opacity:"1"},p;a?(c.animating=!0,h.stop().animate(ft,{duration:v}),p=function(){c.animating=!1;s.stop().animate(et,{duration:v,complete:function(){t.runContenModules(o,s,h,l);w?(b(),o.animationComplete.call(n[0],o,s,h)):e(o,s,h);c=null;s=null;h=null}})},o.mode==="flip-list"?(window.clearTimeout(o.listData[c.index].completeTimeout),o.listData[c.index].completeTimeout=window.setTimeout(p,v)):(window.clearTimeout(o.completeTimeout),o.completeTimeout=window.setTimeout(p,v))):(c.animating=!0,s.stop().animate(ft,{duration:v}),p=function(){c.animating=!1;h.stop().animate(et,{duration:v,complete:function(){t.runContenModules(o,h,s,l);w?(b(),o.animationComplete.call(n[0],o,h,s)):e(o,h,s);s=null;h=null;o=null;c=null}})},o.mode==="flip-list"?(window.clearTimeout(o.listData[c.index].completeTimeout),o.listData[c.index].completeTimeout=window.setTimeout(p,v)):(window.clearTimeout(o.completeTimeout),o.completeTimeout=window.setTimeout(p,v)))}},flipList:function(i){var r=i.data("LiveTile"),u=r.speed,o=!1,s=function(){(r.timer.repeatCount>0||r.timer.repeatCount==-1)&&r.timer.count!=r.timer.repeatCount&&r.timer.start(r.delay)},e;if(r.timer.pause(),e=r.animationStarting.call(i[0],r,null,null),typeof e!="undefined"&&e==!1){s();return}r.loopCount=r.loopCount+1;r.faces.$listTiles.each(function(i,e){var h=n(e),s=h.data("metrojs.tile"),a=r.triggerDelay(i),l=r.speed+Math.max(a,0),c=r.alwaysTrigger;c||(c=Math.random()*351>150?!0:!1);c&&(o=!0,u=Math.max(l+r.speed,u),window.clearTimeout(s.flCompleteTimeout),s.flCompleteTimeout=window.setTimeout(function(){t.flip(h,s.count,r,function(){s.count++;s.count>=f&&(s.count=1);h=null;s=null})},l))});o&&(window.clearTimeout(r.flCompleteTimeout),r.flCompleteTimeout=window.setTimeout(function(){t.runContenModules(r,null,null,-1);r.animationComplete.call(i[0],r,null,null);s()},u+r.speed))}},i={stylePrefixes:"Webkit Moz O ms Khtml ".split(" "),domPrefixes:"-webkit- -moz- -o- -ms- -khtml- ".split(" "),browserPrefix:null,appendStyleProperties:function(t,i,r){for(var u=0;u<=i.length-1;u++)t[n.trim(this.browserPrefix+i[u])]=r[u],t[n.trim(i[u])]=r[u];return t},applyStyleValue:function(t,i,r){return t[n.trim(this.browserPrefix+i)]=r,t[i]=r,t},getBrowserPrefix:function(){var t,n;if(this.browserPrefix==null){for(t="",n=0;n<=this.domPrefixes.length-1;n++)typeof document.body.style[this.domPrefixes[n]+"transform"]!="undefined"&&(t=this.domPrefixes[n]);return this.browserPrefix=t}return this.browserPrefix},shuffleArray:function(n){for(var t=[];n.length;)t.push(n.splice(Math.random()*n.length,1));while(t.length)n.push(t.pop());return n}},e={moduleName:"custom",customSwap:{data:{customDoSwapFront:function(){return!1},customDoSwapBack:function(){return!1},customGetContent:function(){return null}},initData:function(t){var i={};i.doSwapFront=n.inArray("custom",t.swapFront)>-1&&t.customDoSwapFront();i.doSwapBack=n.inArray("custom",t.swapBack)>-1&&t.customDoSwapBack();t.customSwap=typeof t.customSwap!="undefined"?n.extend(i,t.customSwap):i},action:function(){}},htmlSwap:{moduleName:"html",data:{frontContent:[],frontIsRandom:!0,frontIsInGrid:!1,backContent:[],backIsRandom:!0,backIsInGrid:!1},initData:function(i,r){var u={backBag:[],backIndex:0,backStaticIndex:0,backStaticRndm:-1,prevBackIndex:-1,frontBag:[],frontIndex:0,frontStaticIndex:0,frontStaticRndm:-1,prevFrontIndex:-1};i.ignoreDataAttributes?(u.frontIsRandom=i.frontIsRandom,u.frontIsInGrid=i.frontIsInGrid,u.backIsRandom=i.backIsRandom,u.backIsInGrid=i.backIsInGrid):(u.frontIsRandom=t.getDataOrDefault(r,"front-israndom",i.frontIsRandom),u.frontIsInGrid=t.getDataOrDefault(r,"front-isingrid",i.frontIsInGrid),u.backIsRandom=t.getDataOrDefault(r,"back-israndom",i.backIsRandom),u.backIsInGrid=t.getDataOrDefault(r,"back-isingrid",i.backIsInGrid));u.doSwapFront=n.inArray("html",i.swapFront)>-1&&i.frontContent instanceof Array&&i.frontContent.length>0;u.doSwapBack=n.inArray("html",i.swapBack)>-1&&i.backContent instanceof Array&&i.backContent.length>0;i.htmlSwap=typeof i.htmlSwap!="undefined"?n.extend(u,i.htmlSwap):u;i.htmlSwap.doSwapFront&&(i.htmlSwap.frontBag=this.prepBag(i.htmlSwap.frontBag,i.frontContent,i.htmlSwap.prevFrontIndex),i.htmlSwap.frontStaticRndm=i.htmlSwap.frontBag.pop());i.htmlSwap.doSwapBack&&(i.htmlSwap.backBag=this.prepBag(i.htmlSwap.backBag,i.backContent,i.htmlSwap.prevBackIndex),i.htmlSwap.backStaticRndm=i.htmlSwap.backBag.pop())},prepBag:function(n,t,r){var f,u;for(n=n||[],f=0,u=0;u<t.length;u++)(u!=r||n.length===1)&&(n[f]=u,f++);return i.shuffleArray(n)},getFrontSwapIndex:function(n){var t=0;return n.htmlSwap.frontIsRandom?(n.htmlSwap.frontBag.length===0&&(n.htmlSwap.frontBag=this.prepBag(n.htmlSwap.frontBag,n.frontContent,n.htmlSwap.prevFrontIndex)),t=n.htmlSwap.frontIsInGrid?n.htmlSwap.frontStaticRndm:n.htmlSwap.frontBag.pop()):t=n.htmlSwap.frontIsInGrid?n.htmlSwap.frontStaticIndex:n.htmlSwap.frontIndex,t},getBackSwapIndex:function(n){var t=0;return n.htmlSwap.backIsRandom?(n.htmlSwap.backBag.length===0&&(n.htmlSwap.backBag=this.prepBag(n.htmlSwap.backBag,n.backContent,n.htmlSwap.prevBackIndex)),t=n.htmlSwap.backIsInGrid?n.htmlSwap.backStaticRndm:n.htmlSwap.backBag.pop()):t=n.htmlSwap.backIsInGrid?n.htmlSwap.backStaticIndex:n.htmlSwap.backIndex,t},action:function(n,t,i,r){if(n.htmlSwap.doSwapFront||n.htmlSwap.doSwapBack){var f=n.mode==="flip-list",u=0,e=f?n.listData[Math.max(r,0)].isReversed:n.isReversed;if(f&&r==-1){e?n.htmlSwap.doSwapBack&&(n.htmlSwap.backBag.length===0&&(n.htmlSwap.backBag=this.prepBag(n.htmlSwap.backBag,n.backContent,n.htmlSwap.backStaticRndm)),n.htmlSwap.backStaticRndm=n.htmlSwap.backBag.pop(),n.htmlSwap.backStaticIndex++,n.htmlSwap.backStaticIndex>=n.backContent.length&&(n.htmlSwap.backStaticIndex=0)):n.htmlSwap.doSwapFront&&(n.htmlSwap.frontBag.length===0&&(n.htmlSwap.frontBag=this.prepBag(n.htmlSwap.frontBag,n.frontContent,n.htmlSwap.frontStaticRndm)),n.htmlSwap.frontStaticRndm=n.htmlSwap.frontBag.pop(),n.htmlSwap.frontStaticIndex++,n.htmlSwap.frontStaticIndex>=n.frontContent.length&&(n.htmlSwap.frontStaticIndex=0));return}if(e){if(!n.htmlSwap.doSwapBack)return;u=this.getBackSwapIndex(n);n.htmlSwap.prevBackIndex=u;i.html(n.backContent[n.htmlSwap.backIndex]);n.htmlSwap.backIndex++;n.htmlSwap.backIndex>=n.backContent.length&&(n.htmlSwap.backIndex=0);f||(n.htmlSwap.backStaticIndex++,n.htmlSwap.backStaticIndex>=n.backContent.length&&(n.htmlSwap.backStaticIndex=0))}else{if(!n.htmlSwap.doSwapFront)return;u=this.getFrontSwapIndex(n);n.htmlSwap.prevFrontIndex=u;n.mode==="slide"?n.startNow?i.html(n.frontContent[u]):t.html(n.frontContent[u]):i.html(n.frontContent[u]);n.htmlSwap.frontIndex++;n.htmlSwap.frontIndex>=n.frontContent.length&&(n.htmlSwap.frontIndex=0);f||(n.htmlSwap.frontStaticIndex++,n.htmlSwap.frontStaticIndex>=n.frontContent.length&&(n.htmlSwap.frontStaticIndex=0))}}}},imageSwap:{moduleName:"image",data:{preloadImages:!1,imageCssSelector:">img,>a>img",fadeSwap:!1,frontImages:[],frontIsRandom:!0,frontIsBackgroundImage:!1,frontIsInGrid:!1,backImages:null,backIsRandom:!0,backIsBackgroundImage:!1,backIsInGrid:!1},initData:function(i,r){var u={backBag:[],backIndex:0,backStaticIndex:0,backStaticRndm:-1,frontBag:[],frontIndex:0,frontStaticIndex:0,frontStaticRndm:-1,prevBackIndex:-1,prevFrontIndex:-1},f=i.ignoreDataAttributes;f?(u.imageCssSelector=t.getDataOrDefault(r,"image-css",i.imageCssSelector),u.fadeSwap=t.getDataOrDefault(r,"fadeswap",i.fadeSwap),u.frontIsRandom=t.getDataOrDefault(r,"front-israndom",i.frontIsRandom),u.frontIsInGrid=t.getDataOrDefault(r,"front-isingrid",i.frontIsInGrid),u.frontIsBackgroundImage=t.getDataOrDefault(r,"front-isbg",i.frontIsBackgroundImage),u.backIsRandom=t.getDataOrDefault(r,"back-israndom",i.backIsRandom),u.backIsInGrid=t.getDataOrDefault(r,"back-isingrid",i.backIsInGrid),u.backIsBackgroundImage=t.getDataOrDefault(r,"back-isbg",i.backIsBackgroundImage),u.doSwapFront=n.inArray("image",i.swapFront)>-1&&i.frontImages instanceof Array&&i.frontImages.length>0,u.doSwapBack=n.inArray("image",i.swapBack)>-1&&i.backImages instanceof Array&&i.backImages.length>0,u.alwaysSwapFront=t.getDataOrDefault(r,"front-alwaysswap",i.alwaysSwapFront),u.alwaysSwapBack=t.getDataOrDefault(r,"back-alwaysswap",i.alwaysSwapBack)):(u.imageCssSelector=i.imageCssSelector,u.fadeSwap=i.fadeSwap,u.frontIsRandom=i.frontIsRandom,u.frontIsInGrid=i.frontIsInGrid,u.frontIsBackgroundImage=i.frontIsBackgroundImage,u.backIsRandom=i.backIsRandom,u.backIsInGrid=i.backIsInGrid,u.backIsBackgroundImage=i.backIsBackgroundImage,u.doSwapFront=n.inArray("image",i.swapFront)>-1&&i.frontImages instanceof Array&&i.frontImages.length>0,u.doSwapBack=n.inArray("image",i.swapBack)>-1&&i.backImages instanceof Array&&i.backImages.length>0,u.alwaysSwapFront=i.alwaysSwapFront,u.alwaysSwapBack=i.alwaysSwapBack);i.imgSwap=typeof i.imgSwap!="undefined"?n.extend(u,i.imgSwap):u;i.imgSwap.doSwapFront&&(i.imgSwap.frontBag=this.prepBag(i.imgSwap.frontBag,i.frontImages,i.imgSwap.prevFrontIndex),i.imgSwap.frontStaticRndm=i.imgSwap.frontBag.pop(),i.preloadImages&&n(i.frontImages).metrojs.preloadImages(function(){}));i.imgSwap.doSwapBack&&(i.imgSwap.backBag=this.prepBag(i.imgSwap.backBag,i.backImages,i.imgSwap.prevBackIndex),i.imgSwap.backStaticRndm=i.imgSwap.backBag.pop(),i.preloadImages&&n(i.backImages).metrojs.preloadImages(function(){}))},prepBag:function(n,t,r){var f,u;for(n=n||[],f=0,u=0;u<t.length;u++)(u!=r||t.length===1)&&(n[f]=u,f++);return i.shuffleArray(n)},getFrontSwapIndex:function(n){var t=0;return n.imgSwap.frontIsRandom?(n.imgSwap.frontBag.length===0&&(n.imgSwap.frontBag=this.prepBag(n.imgSwap.frontBag,n.frontImages,n.imgSwap.prevFrontIndex)),t=n.imgSwap.frontIsInGrid?n.imgSwap.frontStaticRndm:n.imgSwap.frontBag.pop()):t=n.imgSwap.frontIsInGrid?n.imgSwap.frontStaticIndex:n.imgSwap.frontIndex,t},getBackSwapIndex:function(n){var t=0;return n.imgSwap.backIsRandom?(n.imgSwap.backBag.length===0&&(n.imgSwap.backBag=this.prepBag(n.imgSwap.backBag,n.backImages,n.imgSwap.prevBackIndex)),t=n.imgSwap.backIsInGrid?n.imgSwap.backStaticRndm:n.imgSwap.backBag.pop()):t=n.imgSwap.backIsInGrid?n.imgSwap.backStaticIndex:n.imgSwap.backIndex,t},setImageProperties:function(t,i,r){var f={},u={};typeof i.src!="undefined"&&(r?f.backgroundImage="url('"+i.src+"')":u.src=i.src);typeof i.alt!="undefined"&&(u.alt=i.alt);typeof i.css=="object"?t.css(n.extend(f,i.css)):t.css(f);typeof i.attr=="object"?t.attr(n.extend(u,i.attr)):t.attr(u)},action:function(n,t,i,r){var c,f,l,o;if(n.imgSwap.doSwapFront||n.imgSwap.doSwapBack){var s=n.mode==="flip-list",a=n.mode=="slide",u=0,h=s?n.listData[Math.max(r,0)].isReversed:n.isReversed;if(s&&r==-1){(n.alwaysSwapFront||!h)&&n.imgSwap.doSwapFront&&(n.imgSwap.frontBag.length===0&&(n.imgSwap.frontBag=this.prepBag(n.imgSwap.frontBag,n.frontImages,n.imgSwap.frontStaticRndm)),n.imgSwap.frontStaticRndm=n.imgSwap.frontBag.pop(),n.imgSwap.frontStaticIndex++,n.imgSwap.frontStaticIndex>=n.frontImages.length&&(n.imgSwap.frontStaticIndex=0));(n.alwaysSwapBack||h)&&n.imgSwap.doSwapBack&&(n.imgSwap.backBag.length===0&&(n.imgSwap.backBag=this.prepBag(n.imgSwap.backBag,n.backImages,n.imgSwap.backStaticRndm)),n.imgSwap.backStaticRndm=n.imgSwap.backBag.pop(),n.imgSwap.backStaticIndex++,n.imgSwap.backStaticIndex>=n.backImages.length&&(n.imgSwap.backStaticIndex=0));return}if(n.alwaysSwapFront||!h){if(!n.imgSwap.doSwapFront)return;u=this.getFrontSwapIndex(n);n.imgSwap.prevFrontIndex=u;c=n.mode==="slide"?t:i;f=c.find(n.imgSwap.imageCssSelector);l=typeof n.frontImages[u]=="object"?n.frontImages[u]:{src:n.frontImages[u]};o=function(t){var i=n.imgSwap.frontIsBackgroundImage;typeof t=="function"&&(i?window.setTimeout(t,100):f[0].onload=t);e.imageSwap.setImageProperties(f,l,i)};n.fadeSwap?f.fadeOut(function(){o(function(){f.fadeIn()})}):o();n.imgSwap.frontIndex++;n.imgSwap.frontIndex>=n.frontImages.length&&(n.imgSwap.frontIndex=0);s||(n.imgSwap.frontStaticIndex++,n.imgSwap.frontStaticIndex>=n.frontImages.length&&(n.imgSwap.frontStaticIndex=0))}if(n.alwaysSwapBack||h){if(!n.imgSwap.doSwapBack)return;u=this.getBackSwapIndex(n);n.imgSwap.prevBackIndex=u;c=i;f=c.find(n.imgSwap.imageCssSelector);l=typeof n.backImages[u]=="object"?n.backImages[u]:{src:n.backImages[u]};o=function(){e.imageSwap.setImageProperties(f,l,n.imgSwap.backIsBackgroundImage)};n.fadeSwap?f.fadeOut(function(){o(function(){f.fadeIn()})}):o();n.imgSwap.backIndex++;n.imgSwap.backIndex>=n.backImages.length&&(n.imgSwap.backIndex=0);s||(n.imgSwap.backStaticIndex++,n.imgSwap.backStaticIndex>=n.backImages.length&&(n.imgSwap.backStaticIndex=0))}}}}};n.fn.metrojs.TileTimer=function(n,t,i){this.timerId=null;this.interval=n;this.action=t;this.count=0;this.repeatCount=typeof i=="undefined"?0:i;this.start=function(t){window.clearTimeout(this.timerId);var i=this;this.timerId=window.setTimeout(function(){i.tick.call(i,n)},t)};this.tick=function(n){this.action(this.count+1);this.count++;this.count>=f&&(this.count=0);(this.repeatCount>0||this.repeatCount==-1)&&(this.count!=this.repeatCount?this.start(n):this.stop())};this.stop=function(){this.timerId=window.clearTimeout(this.timerId);this.reset()};this.resume=function(){(this.repeatCount>0||this.repeatCount==-1)&&this.count!=this.repeatCount&&this.start(n)};this.pause=function(){this.timerId=window.clearTimeout(this.timerId)};this.reset=function(){this.count=0};this.restart=function(n){this.stop();this.start(n)}};jQuery.fn.metrojs.theme={loadDefaultTheme:function(n){var t,i,r;typeof n=="undefined"||n==null?n=jQuery.fn.metrojs.theme.defaults:(t=jQuery.fn.metrojs.theme.defaults,jQuery.extend(t,n),n=t);i=typeof localStorage!="undefined";r=function(n){return typeof window.localStorage[n]!="undefined"&&window.localStorage[n]!=null};!i||r("Metro.JS.AccentColor")&&r("Metro.JS.BaseAccentColor")?i?(n.accentColor=window.localStorage["Metro.JS.AccentColor"],n.baseTheme=window.localStorage["Metro.JS.BaseAccentColor"],jQuery(n.accentCssSelector).addClass(n.accentColor).data("accent",n.accentColor),jQuery(n.baseThemeCssSelector).addClass(n.baseTheme),typeof n.loaded=="function"&&n.loaded(n.baseTheme,n.accentColor)):(jQuery(n.accentCssSelector).addClass(n.accentColor).data("accent",n.accentColor),jQuery(n.baseThemeCssSelector).addClass(n.baseTheme),typeof n.loaded=="function"&&n.loaded(n.baseTheme,n.accentColor),typeof n.preloadAltBaseTheme!="undefined"&&n.preloadAltBaseTheme&&jQuery([n.baseTheme=="dark"?n.metroLightUrl:n.metroDarkUrl]).metrojs.preloadImages(function(){})):(window.localStorage["Metro.JS.AccentColor"]=n.accentColor,window.localStorage["Metro.JS.BaseAccentColor"]=n.baseTheme,jQuery(n.accentCssSelector).addClass(n.accentColor).data("accent",n.accentColor),jQuery(n.baseThemeCssSelector).addClass(n.baseTheme),typeof n.loaded=="function"&&n.loaded(n.baseTheme,n.accentColor),typeof n.preloadAltBaseTheme!="undefined"&&n.preloadAltBaseTheme&&jQuery([n.baseTheme=="dark"?n.metroLightUrl:n.metroDarkUrl]).metrojs.preloadImages(function(){}))},applyTheme:function(n,t,i){var e,r,u,f;typeof i=="undefined"||i==null?i=jQuery.fn.metrojs.theme.defaults:(e=jQuery.fn.metrojs.theme.defaults,i=jQuery.extend({},e,i));typeof n!="undefined"&&n!=null&&(typeof localStorage!="undefined"&&(window.localStorage["Metro.JS.BaseAccentColor"]=n),r=jQuery(i.baseThemeCssSelector),r.length>0&&(n=="dark"?r.addClass("dark").removeClass("light"):n=="light"&&r.addClass("light").removeClass("dark")));typeof t!="undefined"&&t!=null&&(typeof localStorage!="undefined"&&(window.localStorage["Metro.JS.AccentColor"]=t),u=jQuery(i.accentCssSelector),u.length>0&&(f=!1,u.each(function(){var i,n;jQuery(this).addClass(t);i=jQuery(this).data("accent");i!=t&&(n=jQuery(this).attr("class").replace(i,""),n=n.replace(/(\s)+/," "),jQuery(this).attr("class",n),jQuery(this).data("accent",t),f=!0)}),f&&typeof i.accentPicked=="function"&&i.accentPicked(t)))},appendAccentColors:function(t){var r,i;typeof t=="undefined"||t==null?t=jQuery.fn.metrojs.theme.defaults:(r=jQuery.fn.metrojs.theme.defaults,t=jQuery.extend({},r,t));var u="",f=t.accentColors,e=t.accentListTemplate;for(i=0;i<f.length;i++)u+=e.replace(/\{0\}/g,f[i]);n(u).appendTo(t.accentListContainer)},appendBaseThemes:function(t){var r,i;typeof t=="undefined"||t==null?t=jQuery.fn.metrojs.theme.defaults:(r=jQuery.fn.metrojs.theme.defaults,t=jQuery.extend({},r,t));var u="",f=t.baseThemes,e=t.baseThemeListTemplate;for(i=0;i<f.length;i++)u+=e.replace(/\{0\}/g,f[i]);n(u).appendTo(t.baseThemeListContainer)},defaults:{baseThemeCssSelector:"body",accentCssSelector:".tiles",accentColor:"blue",baseTheme:"dark",accentColors:["amber","blue","brown","cobalt","crimson","cyan","magenta","lime","indigo","green","emerald","mango","mauve","olive","orange","pink","red","sienna","steel","teal","violet","yellow"],baseThemes:["light","dark"],accentListTemplate:"<li><a href='javascript:;' title='{0}' class='accent {0}'><\/a><\/li>",accentListContainer:"ul.theme-options,.theme-options>ul",baseThemeListTemplate:"<li><a href='javascript:;' title='{0}' class='accent {0}'><\/a><\/li>",baseThemeListContainer:"ul.base-theme-options,.base-theme-options>ul"}};jQuery.fn.applicationBar=function(t){var i=typeof jQuery.fn.metrojs.theme!="undefined"?jQuery.fn.metrojs.theme.defaults:{},r;if(jQuery.extend(i,jQuery.fn.applicationBar.defaults,t),typeof jQuery.fn.metrojs.theme!="undefined"){r=jQuery.fn.metrojs.theme;i.shouldApplyTheme&&r.loadDefaultTheme(i);var u=i.accentListContainer.replace(","," a,")+" a",f=function(){var n=jQuery(this).attr("class").replace("accent","").replace(" ","");r.applyTheme(null,n,i);typeof i.accentPicked=="function"&&i.accentPicked(n)},e=i.baseThemeListContainer.replace(","," a,")+" a",o=function(){var n=jQuery(this).attr("class").replace("accent","").replace(" ","");r.applyTheme(n,null,i);typeof i.themePicked=="function"&&i.themePicked(n)};if(typeof n.fn.on=="function"){n(this).on("click.appBar",u,f);n(this).on("click.appBar",e,o)}else n(u).live("click.appBar",f),n(e).live("click.appBar",o)}return n(this).each(function(t,r){var f=n(r),u=n.extend({},i);u.collapseHeight=="auto"&&(u.collapseHeight=n(this).height());navigator.userAgent.match(/(Android|webOS|iPhone|iPod|BlackBerry|PIE|IEMobile)/i)&&(navigator.userAgent.match(/(IEMobile\/1)/i)||navigator.userAgent.match(/(iPhone OS [56789])/i)||f.css({position:"absolute",bottom:"0px"}));u.slideOpen=function(){f.hasClass("expanded")||u.animateAppBar(!1)};u.slideClosed=function(){f.hasClass("expanded")&&u.animateAppBar(!0)};u.animateAppBar=function(n){var t=n?u.collapseHeight:u.expandHeight;n?f.removeClass("expanded"):f.hasClass("expanded")||f.addClass("expanded");f.stop().animate({height:t},{duration:u.duration})};f.data("ApplicationBar",u);f.find(i.handleSelector).click(function(){u.animateAppBar(f.hasClass("expanded"))});u.bindKeyboard==!0&&jQuery(document.documentElement).keyup(function(n){n.keyCode==38?n.target&&n.target.tagName.match(/INPUT|TEXTAREA|SELECT/i)==null&&(f.hasClass("expanded")||u.animateAppBar(!1)):n.keyCode==40&&n.target&&n.target.tagName.match(/INPUT|TEXTAREA|SELECT/i)==null&&f.hasClass("expanded")&&u.animateAppBar(!0)})})};jQuery.fn.applicationBar.defaults={applyTheme:!0,themePicked:function(){},accentPicked:function(){},loaded:function(){},duration:300,expandHeight:"320px",collapseHeight:"auto",bindKeyboard:!0,handleSelector:"a.etc",metroLightUrl:"images/metroIcons_light.jpg",metroDarkUrl:"images/metroIcons.jpg",preloadAltBaseTheme:!1};n.fn.metrojs.preloadImages=function(t){var i=n(this).toArray(),r=n("<img style='display:none;' />").appendTo("body");n(this).each(function(){var n=this;typeof this=="object"&&(n=this.src);r.attr({src:n}).load(function(){for(var n=0;n<i.length;n++)i[n]==element&&i.splice(n,1);i.length==0&&t()})});r.remove()};n.fn.metrojs.MetroModernizr=function(t){if(typeof t=="undefined"&&(t={useHardwareAccel:!0,useModernizr:typeof Modernizr!="undefined"}),this.isOldJQuery=/^1\.[0123]/.test(n.fn.jquery),this.isOldAndroid=function(){var t,i;try{if(t=navigator.userAgent,t.indexOf("Android")>=0&&(i=parseFloat(t.slice(t.indexOf("Android")+8)),i<2.3))return!0}catch(r){n.error(r)}return!1}(),this.canTransform=!1,this.canTransition=!1,this.canTransform3d=!1,this.canAnimate=!1,this.canTouch=!1,this.canFlip3d=t.useHardwareAccel,t.useHardwareAccel==!0)if(t.useModernizr==!1)if(typeof MetroModernizr!="undefined")this.canTransform=window.MetroModernizr.canTransform,this.canTransition=window.MetroModernizr.canTransition,this.canTransform3d=window.MetroModernizr.canTransform3d,this.canAnimate=window.MetroModernizr.canAnimate,this.canTouch=window.MetroModernizr.canTouch;else{window.MetroModernizr={};var i="metromodernizr",r=document.documentElement,e=document.head||document.getElementsByTagName("head")[0],u=document.createElement(i),o=u.style,s=" -webkit- -moz- -o- -ms- ".split(" "),l="Webkit Moz O ms Khtml".split(" "),f=function(n,t){for(var i in n)if(o[n[i]]!==undefined&&(!t||t(n[i],u)))return!0},h=function(n,t){var i=n.charAt(0).toUpperCase()+n.substr(1),r=(n+" "+l.join(i+" ")+i).split(" ");return!!f(r,t)},a=function(){var n=!!f(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);return n&&"webkitPerspective"in r.style&&(n=c(["@media (",s.join("transform-3d),("),i,")","{#metromodernizr{left:9px;position:absolute;height:3px;}}"].join(""),function(n){return n.offsetHeight===3&&n.offsetLeft===9})),n},c=function(n,t){var f=document.createElement("style"),u=document.createElement("div"),o;return f.textContent=n,e.appendChild(f),u.id=i,r.appendChild(u),o=t(u),f.parentNode.removeChild(f),u.parentNode.removeChild(u),!!o},v=function(){return canTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||typeof window.navigator.msMaxTouchPoints!="undefined"&&window.navigator.msMaxTouchPoints>0||c(["@media (",s.join("touch-enabled),("),i,")","{#metromodernizr{top:9px;position:absolute}}"].join(""),function(n){return n.offsetTop===9})};this.canTransform=!!f(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]);this.canTransition=h("transitionProperty");this.canTransform3d=a();this.canAnimate=h("animationName");this.canTouch=v();window.MetroModernizr.canTransform=this.canTransform;window.MetroModernizr.canTransition=this.canTransition;window.MetroModernizr.canTransform3d=this.canTransform3d;window.MetroModernizr.canAnimate=this.canAnimate;window.MetroModernizr.canTouch=this.canTouch;r=null;e=null;u=null;o=null}else this.canTransform=n("html").hasClass("csstransforms"),this.canTransition=n("html").hasClass("csstransitions"),this.canTransform3d=n("html").hasClass("csstransforms3d"),this.canAnimate=n("html").hasClass("cssanimations"),this.canTouch=n("html").hasClass("touch")||typeof window.navigator.msMaxTouchPoints!="undefined"&&window.navigator.msMaxTouchPoints>0;this.canFlip3d=this.canFlip3d&&this.canAnimate&&this.canTransform&&this.canTransform3d}}(jQuery);
/*!
* @license EaselJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.createjs=this.createjs||{};createjs.extend=function(n,t){"use strict";function i(){this.constructor=n}return i.prototype=t.prototype,n.prototype=new i};this.createjs=this.createjs||{};createjs.promote=function(n,t){"use strict";var i=n.prototype,r=Object.getPrototypeOf&&Object.getPrototypeOf(i)||i.__proto__,u;if(r){i[(t+="_")+"constructor"]=r.constructor;for(u in r)i.hasOwnProperty(u)&&"function"==typeof r[u]&&(i[t+u]=r[u])}return n};this.createjs=this.createjs||{};createjs.indexOf=function(n,t){"use strict";for(var i=0,r=n.length;r>i;i++)if(t===n[i])return i;return-1};this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i){this.type=n;this.target=null;this.currentTarget=null;this.eventPhase=0;this.bubbles=!!t;this.cancelable=!!i;this.timeStamp=(new Date).getTime();this.defaultPrevented=!1;this.propagationStopped=!1;this.immediatePropagationStopped=!1;this.removed=!1}var n=t.prototype;n.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0};n.stopPropagation=function(){this.propagationStopped=!0};n.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0};n.remove=function(){this.removed=!0};n.clone=function(){return new t(this.type,this.bubbles,this.cancelable)};n.set=function(n){for(var t in n)this[t]=n[t];return this};n.toString=function(){return"[Event (type="+this.type+")]"};createjs.Event=t}();this.createjs=this.createjs||{},function(){"use strict";function t(){this._listeners=null;this._captureListeners=null}var n=t.prototype;t.initialize=function(t){t.addEventListener=n.addEventListener;t.on=n.on;t.removeEventListener=t.off=n.removeEventListener;t.removeAllEventListeners=n.removeAllEventListeners;t.hasEventListener=n.hasEventListener;t.dispatchEvent=n.dispatchEvent;t._dispatchEvent=n._dispatchEvent;t.willTrigger=n.willTrigger};n.addEventListener=function(n,t,i){var u,r;return u=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{},r=u[n],r&&this.removeEventListener(n,t,i),r=u[n],r?r.push(t):u[n]=[t],t};n.on=function(n,t,i,r,u,f){return t.handleEvent&&(i=i||t,t=t.handleEvent),i=i||this,this.addEventListener(n,function(n){t.call(i,n,u);r&&n.remove()},f)};n.removeEventListener=function(n,t,i){var f=i?this._captureListeners:this._listeners,r,u,e;if(f&&(r=f[n],r))for(u=0,e=r.length;e>u;u++)if(r[u]==t){1==e?delete f[n]:r.splice(u,1);break}};n.off=n.removeEventListener;n.removeAllEventListeners=function(n){n?(this._listeners&&delete this._listeners[n],this._captureListeners&&delete this._captureListeners[n]):this._listeners=this._captureListeners=null};n.dispatchEvent=function(n){var u,i,r,t,f;if("string"==typeof n){if(u=this._listeners,!u||!u[n])return!1;n=new createjs.Event(n)}else n.target&&n.clone&&(n=n.clone());try{n.target=this}catch(e){}if(n.bubbles&&this.parent){for(i=this,r=[i];i.parent;)r.push(i=i.parent);for(f=r.length,t=f-1;t>=0&&!n.propagationStopped;t--)r[t]._dispatchEvent(n,1+(0==t));for(t=1;f>t&&!n.propagationStopped;t++)r[t]._dispatchEvent(n,3)}else this._dispatchEvent(n,2);return n.defaultPrevented};n.hasEventListener=function(n){var t=this._listeners,i=this._captureListeners;return!!(t&&t[n]||i&&i[n])};n.willTrigger=function(n){for(var t=this;t;){if(t.hasEventListener(n))return!0;t=t.parent}return!1};n.toString=function(){return"[EventDispatcher]"};n._dispatchEvent=function(n,t){var f,e=1==t?this._captureListeners:this._listeners,i,u,r;if(n&&e){if(i=e[n.type],!i||!(f=i.length))return;try{n.currentTarget=this}catch(o){}try{n.eventPhase=t}catch(o){}for(n.removed=!1,i=i.slice(),u=0;f>u&&!n.immediatePropagationStopped;u++)r=i[u],r.handleEvent?r.handleEvent(n):r(n),n.removed&&(this.off(n.type,r,1==t),n.removed=!1)}};createjs.EventDispatcher=t}();this.createjs=this.createjs||{},function(){"use strict";function n(){throw"Ticker cannot be instantiated.";}n.RAF_SYNCHED="synched";n.RAF="raf";n.TIMEOUT="timeout";n.useRAF=!1;n.timingMode=null;n.maxDelta=0;n.paused=!1;n.removeEventListener=null;n.removeAllEventListeners=null;n.dispatchEvent=null;n.hasEventListener=null;n._listeners=null;createjs.EventDispatcher.initialize(n);n._addEventListener=n.addEventListener;n.addEventListener=function(){return!n._inited&&n.init(),n._addEventListener.apply(n,arguments)};n._inited=!1;n._startTime=0;n._pausedTime=0;n._ticks=0;n._pausedTicks=0;n._interval=50;n._lastTime=0;n._times=null;n._tickTimes=null;n._timerId=null;n._raf=!0;n.setInterval=function(t){n._interval=t;n._inited&&n._setupTick()};n.getInterval=function(){return n._interval};n.setFPS=function(t){n.setInterval(1e3/t)};n.getFPS=function(){return 1e3/n._interval};try{Object.defineProperties(n,{interval:{get:n.getInterval,set:n.setInterval},framerate:{get:n.getFPS,set:n.setFPS}})}catch(i){console.log(i)}n.init=function(){n._inited||(n._inited=!0,n._times=[],n._tickTimes=[],n._startTime=n._getTime(),n._times.push(n._lastTime=0),n.interval=n._interval)};n.reset=function(){if(n._raf){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;t&&t(n._timerId)}else clearTimeout(n._timerId);n.removeAllEventListeners("tick");n._timerId=n._times=n._tickTimes=null;n._startTime=n._lastTime=n._ticks=0;n._inited=!1};n.getMeasuredTickTime=function(t){var u=0,i=n._tickTimes,r;if(!i||i.length<1)return-1;for(t=Math.min(i.length,t||0|n.getFPS()),r=0;t>r;r++)u+=i[r];return u/t};n.getMeasuredFPS=function(t){var i=n._times;return!i||i.length<2?-1:(t=Math.min(i.length-1,t||0|n.getFPS()),1e3/((i[0]-i[t])/t))};n.setPaused=function(t){n.paused=t};n.getPaused=function(){return n.paused};n.getTime=function(t){return n._startTime?n._getTime()-(t?n._pausedTime:0):-1};n.getEventTime=function(t){return n._startTime?(n._lastTime||n._startTime)-(t?n._pausedTime:0):-1};n.getTicks=function(t){return n._ticks-(t?n._pausedTicks:0)};n._handleSynch=function(){n._timerId=null;n._setupTick();n._getTime()-n._lastTime>=.97*(n._interval-1)&&n._tick()};n._handleRAF=function(){n._timerId=null;n._setupTick();n._tick()};n._handleTimeout=function(){n._timerId=null;n._setupTick();n._tick()};n._setupTick=function(){var t,i;if(null==n._timerId){if(t=n.timingMode||n.useRAF&&n.RAF_SYNCHED,(t==n.RAF_SYNCHED||t==n.RAF)&&(i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,i))return n._timerId=i(t==n.RAF?n._handleRAF:n._handleSynch),void(n._raf=!0);n._raf=!1;n._timerId=setTimeout(n._handleTimeout,n._interval)}};n._tick=function(){var f=n.paused,t=n._getTime(),u=t-n._lastTime,i,r;for((n._lastTime=t,n._ticks++,f&&(n._pausedTicks++,n._pausedTime+=u),n.hasEventListener("tick"))&&(i=new createjs.Event("tick"),r=n.maxDelta,i.delta=r&&u>r?r:u,i.paused=f,i.time=t,i.runTime=t-n._pausedTime,n.dispatchEvent(i)),n._tickTimes.unshift(n._getTime()-t);n._tickTimes.length>100;)n._tickTimes.pop();for(n._times.unshift(t);n._times.length>100;)n._times.pop()};var t=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);n._getTime=function(){return(t&&t.call(performance)||(new Date).getTime())-n._startTime};createjs.Ticker=n}();this.createjs=this.createjs||{},function(){"use strict";function n(){throw"UID cannot be instantiated";}n._nextID=0;n.get=function(){return n._nextID++};createjs.UID=n}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i,r,u,f,e,o,s,h){this.Event_constructor(n,t,i);this.stageX=r;this.stageY=u;this.rawX=null==s?r:s;this.rawY=null==h?u:h;this.nativeEvent=f;this.pointerID=e;this.primary=!!o}var n=createjs.extend(t,createjs.Event);n._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x};n._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y};n._get_isTouch=function(){return-1!==this.pointerID};try{Object.defineProperties(n,{localX:{get:n._get_localX},localY:{get:n._get_localY},isTouch:{get:n._get_isTouch}})}catch(i){}n.clone=function(){return new t(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)};n.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"};createjs.MouseEvent=createjs.promote(t,"Event")}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i,r,u,f){this.setValues(n,t,i,r,u,f)}var n=t.prototype;t.DEG_TO_RAD=Math.PI/180;t.identity=null;n.setValues=function(n,t,i,r,u,f){return this.a=null==n?1:n,this.b=t||0,this.c=i||0,this.d=null==r?1:r,this.tx=u||0,this.ty=f||0,this};n.append=function(n,t,i,r,u,f){var e=this.a,o=this.b,s=this.c,h=this.d;return(1!=n||0!=t||0!=i||1!=r)&&(this.a=e*n+s*t,this.b=o*n+h*t,this.c=e*i+s*r,this.d=o*i+h*r),this.tx=e*u+s*f+this.tx,this.ty=o*u+h*f+this.ty,this};n.prepend=function(n,t,i,r,u,f){var e=this.a,o=this.c,s=this.tx;return this.a=n*e+i*this.b,this.b=t*e+r*this.b,this.c=n*o+i*this.d,this.d=t*o+r*this.d,this.tx=n*s+i*this.ty+u,this.ty=t*s+r*this.ty+f,this};n.appendMatrix=function(n){return this.append(n.a,n.b,n.c,n.d,n.tx,n.ty)};n.prependMatrix=function(n){return this.prepend(n.a,n.b,n.c,n.d,n.tx,n.ty)};n.appendTransform=function(n,i,r,u,f,e,o,s,h){if(f%360)var a=f*t.DEG_TO_RAD,c=Math.cos(a),l=Math.sin(a);else c=1,l=0;return e||o?(e*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(e),Math.cos(e),n,i),this.append(c*r,l*r,-l*u,c*u,0,0)):this.append(c*r,l*r,-l*u,c*u,n,i),(s||h)&&(this.tx-=s*this.a+h*this.c,this.ty-=s*this.b+h*this.d),this};n.prependTransform=function(n,i,r,u,f,e,o,s,h){if(f%360)var a=f*t.DEG_TO_RAD,c=Math.cos(a),l=Math.sin(a);else c=1,l=0;return(s||h)&&(this.tx-=s,this.ty-=h),e||o?(e*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.prepend(c*r,l*r,-l*u,c*u,0,0),this.prepend(Math.cos(o),Math.sin(o),-Math.sin(e),Math.cos(e),n,i)):this.prepend(c*r,l*r,-l*u,c*u,n,i),this};n.rotate=function(n){n*=t.DEG_TO_RAD;var i=Math.cos(n),r=Math.sin(n),u=this.a,f=this.b;return this.a=u*i+this.c*r,this.b=f*i+this.d*r,this.c=-u*r+this.c*i,this.d=-f*r+this.d*i,this};n.skew=function(n,i){return n*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(n),Math.cos(n),0,0),this};n.scale=function(n,t){return this.a*=n,this.b*=n,this.c*=t,this.d*=t,this};n.translate=function(n,t){return this.tx+=this.a*n+this.c*t,this.ty+=this.b*n+this.d*t,this};n.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this};n.invert=function(){var t=this.a,i=this.b,r=this.c,u=this.d,f=this.tx,n=t*u-i*r;return this.a=u/n,this.b=-i/n,this.c=-r/n,this.d=t/n,this.tx=(r*this.ty-u*f)/n,this.ty=-(t*this.ty-i*f)/n,this};n.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d};n.equals=function(n){return this.tx===n.tx&&this.ty===n.ty&&this.a===n.a&&this.b===n.b&&this.c===n.c&&this.d===n.d};n.transformPoint=function(n,t,i){return i=i||{},i.x=n*this.a+t*this.c+this.tx,i.y=n*this.b+t*this.d+this.ty,i};n.decompose=function(n){null==n&&(n={});n.x=this.tx;n.y=this.ty;n.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);n.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),i=Math.atan2(this.b,this.a),u=Math.abs(1-r/i);return 1e-5>u?(n.rotation=i/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(n.rotation+=n.rotation<=0?180:-180),n.skewX=n.skewY=0):(n.skewX=r/t.DEG_TO_RAD,n.skewY=i/t.DEG_TO_RAD),n};n.copy=function(n){return this.setValues(n.a,n.b,n.c,n.d,n.tx,n.ty)};n.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)};n.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};t.identity=new t;createjs.Matrix2D=t}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i,r,u){this.setValues(n,t,i,r,u)}var n=t.prototype;n.setValues=function(n,t,i,r,u){return this.visible=null==n?!0:!!n,this.alpha=null==t?1:t,this.shadow=i,this.compositeOperation=i,this.matrix=u||this.matrix&&this.matrix.identity()||new createjs.Matrix2D,this};n.append=function(n,t,i,r,u){return this.alpha*=t,this.shadow=i||this.shadow,this.compositeOperation=r||this.compositeOperation,this.visible=this.visible&&n,u&&this.matrix.appendMatrix(u),this};n.prepend=function(n,t,i,r,u){return this.alpha*=t,this.shadow=this.shadow||i,this.compositeOperation=this.compositeOperation||r,this.visible=this.visible&&n,u&&this.matrix.prependMatrix(u),this};n.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this};n.clone=function(){return new t(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())};createjs.DisplayProps=t}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t){this.setValues(n,t)}var n=t.prototype;n.setValues=function(n,t){return this.x=n||0,this.y=t||0,this};n.copy=function(n){return this.x=n.x,this.y=n.y,this};n.clone=function(){return new t(this.x,this.y)};n.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};createjs.Point=t}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i,r){this.setValues(n,t,i,r)}var n=t.prototype;n.setValues=function(n,t,i,r){return this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0,this};n.extend=function(n,t,i,r){return i=i||0,r=r||0,n+i>this.x+this.width&&(this.width=n+i-this.x),t+r>this.y+this.height&&(this.height=t+r-this.y),n<this.x&&(this.width+=this.x-n,this.x=n),t<this.y&&(this.height+=this.y-t,this.y=t),this};n.pad=function(n,t,i,r){return this.x-=n,this.y-=t,this.width+=n+i,this.height+=t+r,this};n.copy=function(n){return this.setValues(n.x,n.y,n.width,n.height)};n.contains=function(n,t,i,r){return i=i||0,r=r||0,n>=this.x&&n+i<=this.x+this.width&&t>=this.y&&t+r<=this.y+this.height};n.union=function(n){return this.clone().extend(n.x,n.y,n.width,n.height)};n.intersection=function(n){var i=n.x,r=n.y,u=i+n.width,f=r+n.height;return this.x>i&&(i=this.x),this.y>r&&(r=this.y),this.x+this.width<u&&(u=this.x+this.width),this.y+this.height<f&&(f=this.y+this.height),i>=u||r>=f?null:new t(i,r,u-i,f-r)};n.intersects=function(n){return n.x<=this.x+this.width&&this.x<=n.x+n.width&&n.y<=this.y+this.height&&this.y<=n.y+n.height};n.isEmpty=function(){return this.width<=0||this.height<=0};n.clone=function(){return new t(this.x,this.y,this.width,this.height)};n.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"};createjs.Rectangle=t}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i,r,u,f,e){n.addEventListener&&(this.target=n,this.overLabel=null==i?"over":i,this.outLabel=null==t?"out":t,this.downLabel=null==r?"down":r,this.play=u,this._isPressed=!1,this._isOver=!1,this._enabled=!1,n.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),f&&(e&&(f.actionsEnabled=!1,f.gotoAndStop&&f.gotoAndStop(e)),n.hitArea=f))}var n=t.prototype;n.setEnabled=function(n){if(n!=this._enabled){var t=this.target;this._enabled=n;n?(t.cursor="pointer",t.addEventListener("rollover",this),t.addEventListener("rollout",this),t.addEventListener("mousedown",this),t.addEventListener("pressup",this)):(t.cursor=null,t.removeEventListener("rollover",this),t.removeEventListener("rollout",this),t.removeEventListener("mousedown",this),t.removeEventListener("pressup",this))}};n.getEnabled=function(){return this._enabled};try{Object.defineProperties(n,{enabled:{get:n.getEnabled,set:n.setEnabled}})}catch(i){}n.toString=function(){return"[ButtonHelper]"};n.handleEvent=function(n){var t,i=this.target,r=n.type;"mousedown"==r?(this._isPressed=!0,t=this.downLabel):"pressup"==r?(this._isPressed=!1,t=this._isOver?this.overLabel:this.outLabel):"rollover"==r?(this._isOver=!0,t=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,t=this._isPressed?this.overLabel:this.outLabel);this.play?i.gotoAndPlay&&i.gotoAndPlay(t):i.gotoAndStop&&i.gotoAndStop(t)};createjs.ButtonHelper=t}();this.createjs=this.createjs||{},function(){"use strict";function n(n,t,i,r){this.color=n||"black";this.offsetX=t||0;this.offsetY=i||0;this.blur=r||0}var t=n.prototype;n.identity=new n("transparent",0,0,0);t.toString=function(){return"[Shadow]"};t.clone=function(){return new n(this.color,this.offsetX,this.offsetY,this.blur)};createjs.Shadow=n}();this.createjs=this.createjs||{},function(){"use strict";function t(n){this.EventDispatcher_constructor();this.complete=!0;this.framerate=0;this._animations=null;this._frames=null;this._images=null;this._data=null;this._loadCount=0;this._frameHeight=0;this._frameWidth=0;this._numFrames=0;this._regX=0;this._regY=0;this._spacing=0;this._margin=0;this._parseData(n)}var n=createjs.extend(t,createjs.EventDispatcher);n.getAnimations=function(){return this._animations.slice()};try{Object.defineProperties(n,{animations:{get:n.getAnimations}})}catch(i){}n.getNumFrames=function(n){if(null==n)return this._frames?this._frames.length:this._numFrames||0;var t=this._data[n];return null==t?0:t.frames.length};n.getAnimation=function(n){return this._data[n]};n.getFrame=function(n){var t;return this._frames&&(t=this._frames[n])?t:null};n.getFrameBounds=function(n,t){var i=this.getFrame(n);return i?(t||new createjs.Rectangle).setValues(-i.regX,-i.regY,i.rect.width,i.rect.height):null};n.toString=function(){return"[SpriteSheet]"};n.clone=function(){throw"SpriteSheet cannot be cloned.";};n._parseData=function(n){var r,h,u,f,e,l,o,s,t,i,c;if(null!=n){if(this.framerate=n.framerate||0,n.images&&(h=n.images.length)>0)for(f=this._images=[],r=0;h>r;r++)e=n.images[r],"string"==typeof e&&(l=e,e=document.createElement("img"),e.src=l),f.push(e),e.getContext||e.complete||(this._loadCount++,this.complete=!1,function(n){e.onload=function(){n._handleImageLoad()}}(this));if(null!=n.frames)if(n.frames instanceof Array)for(this._frames=[],f=n.frames,r=0,h=f.length;h>r;r++)o=f[r],this._frames.push({image:this._images[o[4]?o[4]:0],rect:new createjs.Rectangle(o[0],o[1],o[2],o[3]),regX:o[5]||0,regY:o[6]||0});else u=n.frames,this._frameWidth=u.width,this._frameHeight=u.height,this._regX=u.regX||0,this._regY=u.regY||0,this._spacing=u.spacing||0,this._margin=u.margin||0,this._numFrames=u.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(u=n.animations)){this._data={};for(s in u){if(t={name:s},i=u[s],"number"==typeof i)f=t.frames=[i];else if(i instanceof Array)if(1==i.length)t.frames=[i[0]];else for(t.speed=i[3],t.next=i[2],f=t.frames=[],r=i[0];r<=i[1];r++)f.push(r);else t.speed=i.speed,t.next=i.next,c=i.frames,f=t.frames="number"==typeof c?[c]:c.slice(0);(t.next===!0||void 0===t.next)&&(t.next=s);(t.next===!1||f.length<2&&t.next==s)&&(t.next=null);t.speed||(t.speed=1);this._animations.push(s);this._data[s]=t}}}};n._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))};n._calculateFrames=function(){var t,e,i;if(!this._frames&&0!=this._frameWidth){this._frames=[];var c=this._numFrames||1e5,r=0,u=this._frameWidth,f=this._frameHeight,h=this._spacing,n=this._margin;n:for(t=0,e=this._images;t<e.length;t++)for(var o=e[t],l=o.width,a=o.height,s=n;a-n-f>=s;){for(i=n;l-n-u>=i;){if(r>=c)break n;r++;this._frames.push({image:o,rect:new createjs.Rectangle(i,s,u,f),regX:this._regX,regY:this._regY});i+=u+h}s+=f+h}this._numFrames=r}};createjs.SpriteSheet=createjs.promote(t,"EventDispatcher")}();this.createjs=this.createjs||{},function(){"use strict";function i(){this.command=null;this._stroke=null;this._strokeStyle=null;this._strokeIgnoreScale=!1;this._fill=null;this._instructions=[];this._commitIndex=0;this._activeInstructions=[];this._dirty=!1;this._storeIndex=0;this.clear()}var n=i.prototype,t=i,r;i.getRGB=function(n,t,i,r){return null!=n&&null==i&&(r=t,i=255&n,t=n>>8&255,n=n>>16&255),null==r?"rgb("+n+","+t+","+i+")":"rgba("+n+","+t+","+i+","+r+")"};i.getHSL=function(n,t,i,r){return null==r?"hsl("+n%360+","+t+"%,"+i+"%)":"hsla("+n%360+","+t+"%,"+i+"%,"+r+")"};i.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63};i.STROKE_CAPS_MAP=["butt","round","square"];i.STROKE_JOINTS_MAP=["miter","round","bevel"];r=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");r.getContext&&(i._ctx=r.getContext("2d"),r.width=r.height=1);n.getInstructions=function(){return this._updateInstructions(),this._instructions};try{Object.defineProperties(n,{instructions:{get:n.getInstructions}})}catch(u){}n.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)};n.draw=function(n,t){this._updateInstructions();for(var r=this._instructions,i=this._storeIndex,u=r.length;u>i;i++)r[i].exec(n,t)};n.drawAsPath=function(n){this._updateInstructions();for(var i,r=this._instructions,t=this._storeIndex,u=r.length;u>t;t++)(i=r[t]).path!==!1&&i.exec(n)};n.moveTo=function(n,i){return this.append(new t.MoveTo(n,i),!0)};n.lineTo=function(n,i){return this.append(new t.LineTo(n,i))};n.arcTo=function(n,i,r,u,f){return this.append(new t.ArcTo(n,i,r,u,f))};n.arc=function(n,i,r,u,f,e){return this.append(new t.Arc(n,i,r,u,f,e))};n.quadraticCurveTo=function(n,i,r,u){return this.append(new t.QuadraticCurveTo(n,i,r,u))};n.bezierCurveTo=function(n,i,r,u,f,e){return this.append(new t.BezierCurveTo(n,i,r,u,f,e))};n.rect=function(n,i,r,u){return this.append(new t.Rect(n,i,r,u))};n.closePath=function(){return this._activeInstructions.length?this.append(new t.ClosePath):this};n.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._stroke=this._fill=null,this._dirty=this._strokeIgnoreScale=!1,this};n.beginFill=function(n){return this._setFill(n?new t.Fill(n):null)};n.beginLinearGradientFill=function(n,i,r,u,f,e){return this._setFill((new t.Fill).linearGradient(n,i,r,u,f,e))};n.beginRadialGradientFill=function(n,i,r,u,f,e,o,s){return this._setFill((new t.Fill).radialGradient(n,i,r,u,f,e,o,s))};n.beginBitmapFill=function(n,i,r){return this._setFill(new t.Fill(null,r).bitmap(n,i))};n.endFill=function(){return this.beginFill()};n.setStrokeStyle=function(n,i,r,u,f){return this._updateInstructions(!0),this._strokeStyle=this.command=new t.StrokeStyle(n,i,r,u,f),this._stroke&&(this._stroke.ignoreScale=f),this._strokeIgnoreScale=f,this};n.beginStroke=function(n){return this._setStroke(n?new t.Stroke(n):null)};n.beginLinearGradientStroke=function(n,i,r,u,f,e){return this._setStroke((new t.Stroke).linearGradient(n,i,r,u,f,e))};n.beginRadialGradientStroke=function(n,i,r,u,f,e,o,s){return this._setStroke((new t.Stroke).radialGradient(n,i,r,u,f,e,o,s))};n.beginBitmapStroke=function(n,i){return this._setStroke((new t.Stroke).bitmap(n,i))};n.endStroke=function(){return this.beginStroke()};n.curveTo=n.quadraticCurveTo;n.drawRect=n.rect;n.drawRoundRect=function(n,t,i,r,u){return this.drawRoundRectComplex(n,t,i,r,u,u,u,u)};n.drawRoundRectComplex=function(n,i,r,u,f,e,o,s){return this.append(new t.RoundRect(n,i,r,u,f,e,o,s))};n.drawCircle=function(n,i,r){return this.append(new t.Circle(n,i,r))};n.drawEllipse=function(n,i,r,u){return this.append(new t.Ellipse(n,i,r,u))};n.drawPolyStar=function(n,i,r,u,f,e){return this.append(new t.PolyStar(n,i,r,u,f,e))};n.append=function(n,t){return this._activeInstructions.push(n),this.command=n,t||(this._dirty=!0),this};n.decodePath=function(n){for(var y,l,u,t,p,w=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],b=[2,2,4,6,0],r=0,k=n.length,e=[],o=0,s=0,f=i.BASE_64;k>r;){var a=n.charAt(r),h=f[a],c=h>>3,v=w[c];if(!v||3&h)throw"bad path data (@"+r+"): "+a;for(y=b[c],c||(o=s=0),e.length=0,r++,l=(h>>2&1)+2,u=0;y>u;u++)t=f[n.charAt(r)],p=t>>5?-1:1,t=(31&t)<<6|f[n.charAt(r+1)],3==l&&(t=t<<6|f[n.charAt(r+2)]),t=p*t/10,u%2?o=t+=o:s=t+=s,e[u]=t,r+=l;v.apply(this,e)}return this};n.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this};n.unstore=function(){return this._storeIndex=0,this};n.clone=function(){var n=new i;return n.command=this.command,n._stroke=this._stroke,n._strokeStyle=this._strokeStyle,n._strokeIgnoreScale=this._strokeIgnoreScale,n._fill=this._fill,n._instructions=this._instructions.slice(),n._commitIndex=this._commitIndex,n._activeInstructions=this._activeInstructions.slice(),n._dirty=this._dirty,n._storeIndex=this._storeIndex,n};n.toString=function(){return"[Graphics]"};n.mt=n.moveTo;n.lt=n.lineTo;n.at=n.arcTo;n.bt=n.bezierCurveTo;n.qt=n.quadraticCurveTo;n.a=n.arc;n.r=n.rect;n.cp=n.closePath;n.c=n.clear;n.f=n.beginFill;n.lf=n.beginLinearGradientFill;n.rf=n.beginRadialGradientFill;n.bf=n.beginBitmapFill;n.ef=n.endFill;n.ss=n.setStrokeStyle;n.s=n.beginStroke;n.ls=n.beginLinearGradientStroke;n.rs=n.beginRadialGradientStroke;n.bs=n.beginBitmapStroke;n.es=n.endStroke;n.dr=n.drawRect;n.rr=n.drawRoundRect;n.rc=n.drawRoundRectComplex;n.dc=n.drawCircle;n.de=n.drawEllipse;n.dp=n.drawPolyStar;n.p=n.decodePath;n._updateInstructions=function(n){var t=this._instructions,u=this._activeInstructions,o=this._commitIndex,f,e,r;if(this._dirty&&u.length){for(t.length=o,t.push(i.beginCmd),f=u.length,e=t.length,t.length=e+f,r=0;f>r;r++)t[r+e]=u[r];this._fill&&t.push(this._fill);this._stroke&&this._strokeStyle&&t.push(this._strokeStyle);this._stroke&&t.push(this._stroke);this._dirty=!1}n&&(u.length=0,this._commitIndex=t.length)};n._setFill=function(n){return this._updateInstructions(!0),(this._fill=n)&&(this.command=n),this};n._setStroke=function(n){return this._updateInstructions(!0),(this._stroke=n)&&(this.command=n,n.ignoreScale=this._strokeIgnoreScale),this};(t.LineTo=function(n,t){this.x=n;this.y=t}).prototype.exec=function(n){n.lineTo(this.x,this.y)};(t.MoveTo=function(n,t){this.x=n;this.y=t}).prototype.exec=function(n){n.moveTo(this.x,this.y)};(t.ArcTo=function(n,t,i,r,u){this.x1=n;this.y1=t;this.x2=i;this.y2=r;this.radius=u}).prototype.exec=function(n){n.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)};(t.Arc=function(n,t,i,r,u,f){this.x=n;this.y=t;this.radius=i;this.startAngle=r;this.endAngle=u;this.anticlockwise=!!f}).prototype.exec=function(n){n.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)};(t.QuadraticCurveTo=function(n,t,i,r){this.cpx=n;this.cpy=t;this.x=i;this.y=r}).prototype.exec=function(n){n.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)};(t.BezierCurveTo=function(n,t,i,r,u,f){this.cp1x=n;this.cp1y=t;this.cp2x=i;this.cp2y=r;this.x=u;this.y=f}).prototype.exec=function(n){n.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)};(t.Rect=function(n,t,i,r){this.x=n;this.y=t;this.w=i;this.h=r}).prototype.exec=function(n){n.rect(this.x,this.y,this.w,this.h)};(t.ClosePath=function(){}).prototype.exec=function(n){n.closePath()};(t.BeginPath=function(){}).prototype.exec=function(n){n.beginPath()};n=(t.Fill=function(n,t){this.style=n;this.matrix=t}).prototype;n.exec=function(n){if(this.style){n.fillStyle=this.style;var t=this.matrix;t&&(n.save(),n.transform(t.a,t.b,t.c,t.d,t.tx,t.ty));n.fill();t&&n.restore()}};n.linearGradient=function(n,t,r,u,f,e){for(var s=this.style=i._ctx.createLinearGradient(r,u,f,e),o=0,h=n.length;h>o;o++)s.addColorStop(t[o],n[o]);return s.props={colors:n,ratios:t,x0:r,y0:u,x1:f,y1:e,type:"linear"},this};n.radialGradient=function(n,t,r,u,f,e,o,s){for(var c=this.style=i._ctx.createRadialGradient(r,u,f,e,o,s),h=0,l=n.length;l>h;h++)c.addColorStop(t[h],n[h]);return c.props={colors:n,ratios:t,x0:r,y0:u,r0:f,x1:e,y1:o,r1:s,type:"radial"},this};n.bitmap=function(n,t){var r=this.style=i._ctx.createPattern(n,t||"");return r.props={image:n,repetition:t,type:"bitmap"},this};n.path=!1;n=(t.Stroke=function(n,t){this.style=n;this.ignoreScale=t}).prototype;n.exec=function(n){this.style&&(n.strokeStyle=this.style,this.ignoreScale&&(n.save(),n.setTransform(1,0,0,1,0,0)),n.stroke(),this.ignoreScale&&n.restore())};n.linearGradient=t.Fill.prototype.linearGradient;n.radialGradient=t.Fill.prototype.radialGradient;n.bitmap=t.Fill.prototype.bitmap;n.path=!1;n=(t.StrokeStyle=function(n,t,i,r){this.width=n;this.caps=t;this.joints=i;this.miterLimit=r}).prototype;n.exec=function(n){n.lineWidth=null==this.width?"1":this.width;n.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:i.STROKE_CAPS_MAP[this.caps];n.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:i.STROKE_JOINTS_MAP[this.joints];n.miterLimit=null==this.miterLimit?"10":this.miterLimit};n.path=!1;(t.RoundRect=function(n,t,i,r,u,f,e,o){this.x=n;this.y=t;this.w=i;this.h=r;this.radiusTL=u;this.radiusTR=f;this.radiusBR=e;this.radiusBL=o}).prototype.exec=function(n){var o=(h>s?s:h)/2,c=0,l=0,a=0,v=0,t=this.x,i=this.y,s=this.w,h=this.h,r=this.radiusTL,u=this.radiusTR,f=this.radiusBR,e=this.radiusBL;0>r&&(r*=c=-1);r>o&&(r=o);0>u&&(u*=l=-1);u>o&&(u=o);0>f&&(f*=a=-1);f>o&&(f=o);0>e&&(e*=v=-1);e>o&&(e=o);n.moveTo(t+s-u,i);n.arcTo(t+s+u*l,i-u*l,t+s,i+u,u);n.lineTo(t+s,i+h-f);n.arcTo(t+s+f*a,i+h+f*a,t+s-f,i+h,f);n.lineTo(t+e,i+h);n.arcTo(t-e*v,i+h+e*v,t,i+h-e,e);n.lineTo(t,i+r);n.arcTo(t-r*c,i-r*c,t+r,i,r);n.closePath()};(t.Circle=function(n,t,i){this.x=n;this.y=t;this.radius=i}).prototype.exec=function(n){n.arc(this.x,this.y,this.radius,0,2*Math.PI)};(t.Ellipse=function(n,t,i,r){this.x=n;this.y=t;this.w=i;this.h=r}).prototype.exec=function(n){var i=this.x,u=this.y,o=this.w,s=this.h,l=.5522848,f=o/2*l,e=s/2*l,h=i+o,c=u+s,r=i+o/2,t=u+s/2;n.moveTo(i,t);n.bezierCurveTo(i,t-e,r-f,u,r,u);n.bezierCurveTo(r+f,u,h,t-e,h,t);n.bezierCurveTo(h,t+e,r+f,c,r,c);n.bezierCurveTo(r-f,c,i,t+e,i,t)};(t.PolyStar=function(n,t,i,r,u,f){this.x=n;this.y=t;this.radius=i;this.sides=r;this.pointSize=u;this.angle=f}).prototype.exec=function(n){var r=this.x,u=this.y,i=this.radius,t=(this.angle||0)/180*Math.PI,o=this.sides,f=1-(this.pointSize||0),s=Math.PI/o,e;for(n.moveTo(r+Math.cos(t)*i,u+Math.sin(t)*i),e=0;o>e;e++)t+=s,1!=f&&n.lineTo(r+Math.cos(t)*i*f,u+Math.sin(t)*i*f),t+=s,n.lineTo(r+Math.cos(t)*i,u+Math.sin(t)*i);n.closePath()};i.beginCmd=new t.BeginPath;createjs.Graphics=i}();this.createjs=this.createjs||{},function(){"use strict";function t(){this.EventDispatcher_constructor();this.alpha=1;this.cacheCanvas=null;this.cacheID=0;this.id=createjs.UID.get();this.mouseEnabled=!0;this.tickEnabled=!0;this.name=null;this.parent=null;this.regX=0;this.regY=0;this.rotation=0;this.scaleX=1;this.scaleY=1;this.skewX=0;this.skewY=0;this.shadow=null;this.visible=!0;this.x=0;this.y=0;this.transformMatrix=null;this.compositeOperation=null;this.snapToPixel=!0;this.filters=null;this.mask=null;this.hitArea=null;this.cursor=null;this._cacheOffsetX=0;this._cacheOffsetY=0;this._filterOffsetX=0;this._filterOffsetY=0;this._cacheScale=1;this._cacheDataURLID=0;this._cacheDataURL=null;this._props=new createjs.DisplayProps;this._rectangle=new createjs.Rectangle;this._bounds=null}var n=createjs.extend(t,createjs.EventDispatcher),i;t._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"];t.suppressCrossDomainErrors=!1;t._snapToPixelEnabled=!1;i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._hitTestCanvas=i,t._hitTestContext=i.getContext("2d"),i.width=i.height=1);t._nextCacheID=1;n.getStage=function(){for(var n=this,t=createjs.Stage;n.parent;)n=n.parent;return n instanceof t?n:null};try{Object.defineProperties(n,{stage:{get:n.getStage}})}catch(r){}n.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)};n.draw=function(n,t){var i=this.cacheCanvas,r;return t||!i?!1:(r=this._cacheScale,n.drawImage(i,this._cacheOffsetX+this._filterOffsetX,this._cacheOffsetY+this._filterOffsetY,i.width/r,i.height/r),!0)};n.updateContext=function(n){var r=this,u=r.mask,i=r._props.matrix,f,e;u&&u.graphics&&!u.graphics.isEmpty()&&(u.getMatrix(i),n.transform(i.a,i.b,i.c,i.d,i.tx,i.ty),u.graphics.drawAsPath(n),n.clip(),i.invert(),n.transform(i.a,i.b,i.c,i.d,i.tx,i.ty));this.getMatrix(i);f=i.tx;e=i.ty;t._snapToPixelEnabled&&r.snapToPixel&&(f=f+(0>f?-.5:.5)|0,e=e+(0>e?-.5:.5)|0);n.transform(i.a,i.b,i.c,i.d,f,e);n.globalAlpha*=r.alpha;r.compositeOperation&&(n.globalCompositeOperation=r.compositeOperation);r.shadow&&this._applyShadow(n,r.shadow)};n.cache=function(n,t,i,r,u){u=u||1;this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"));this._cacheWidth=i;this._cacheHeight=r;this._cacheOffsetX=n;this._cacheOffsetY=t;this._cacheScale=u;this.updateCache()};n.updateCache=function(n){var i=this.cacheCanvas;if(!i)throw"cache() must be called before updateCache()";var r=this._cacheScale,s=this._cacheOffsetX*r,h=this._cacheOffsetY*r,f=this._cacheWidth,e=this._cacheHeight,u=i.getContext("2d"),o=this._getFilterBounds();s+=this._filterOffsetX=o.x;h+=this._filterOffsetY=o.y;f=Math.ceil(f*r)+o.width;e=Math.ceil(e*r)+o.height;f!=i.width||e!=i.height?(i.width=f,i.height=e):n||u.clearRect(0,0,f+1,e+1);u.save();u.globalCompositeOperation=n;u.setTransform(r,0,0,r,-s,-h);this.draw(u,!0);this._applyFilters();u.restore();this.cacheID=t._nextCacheID++};n.uncache=function(){this._cacheDataURL=this.cacheCanvas=null;this.cacheID=this._cacheOffsetX=this._cacheOffsetY=this._filterOffsetX=this._filterOffsetY=0;this._cacheScale=1};n.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null};n.localToGlobal=function(n,t,i){return this.getConcatenatedMatrix(this._props.matrix).transformPoint(n,t,i||new createjs.Point)};n.globalToLocal=function(n,t,i){return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(n,t,i||new createjs.Point)};n.localToLocal=function(n,t,i,r){return r=this.localToGlobal(n,t,r),i.globalToLocal(r.x,r.y,r)};n.setTransform=function(n,t,i,r,u,f,e,o,s){return this.x=n||0,this.y=t||0,this.scaleX=null==i?1:i,this.scaleY=null==r?1:r,this.rotation=u||0,this.skewX=f||0,this.skewY=e||0,this.regX=o||0,this.regY=s||0,this};n.getMatrix=function(n){var t=this,i=n&&n.identity()||new createjs.Matrix2D;return t.transformMatrix?i.copy(t.transformMatrix):i.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY)};n.getConcatenatedMatrix=function(n){for(var t=this,i=this.getMatrix(n);t=t.parent;)i.prependMatrix(t.getMatrix(t._props.matrix));return i};n.getConcatenatedDisplayProps=function(n){n=n?n.identity():new createjs.DisplayProps;var t=this,i=t.getMatrix(n.matrix);do n.prepend(t.visible,t.alpha,t.shadow,t.compositeOperation),t!=this&&i.prependMatrix(t.getMatrix(t._props.matrix));while(t=t.parent);return n};n.hitTest=function(n,i){var r=t._hitTestContext,u;return r.setTransform(1,0,0,1,-n,-i),this.draw(r),u=this._testHit(r),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,2,2),u};n.set=function(n){for(var t in n)this[t]=n[t];return this};n.getBounds=function(){var n,t;return this._bounds?this._rectangle.copy(this._bounds):(n=this.cacheCanvas,n)?(t=this._cacheScale,this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,n.width/t,n.height/t)):null};n.getTransformedBounds=function(){return this._getBounds()};n.setBounds=function(n,t,i,r){null==n&&(this._bounds=n);this._bounds=(this._bounds||new createjs.Rectangle).setValues(n,t,i,r)};n.clone=function(){return this._cloneProps(new t)};n.toString=function(){return"[DisplayObject (name="+this.name+")]"};n._cloneProps=function(n){return n.alpha=this.alpha,n.mouseEnabled=this.mouseEnabled,n.tickEnabled=this.tickEnabled,n.name=this.name,n.regX=this.regX,n.regY=this.regY,n.rotation=this.rotation,n.scaleX=this.scaleX,n.scaleY=this.scaleY,n.shadow=this.shadow,n.skewX=this.skewX,n.skewY=this.skewY,n.visible=this.visible,n.x=this.x,n.y=this.y,n.compositeOperation=this.compositeOperation,n.snapToPixel=this.snapToPixel,n.filters=null==this.filters?null:this.filters.slice(0),n.mask=this.mask,n.hitArea=this.hitArea,n.cursor=this.cursor,n._bounds=this._bounds,n};n._applyShadow=function(n,t){t=t||Shadow.identity;n.shadowColor=t.color;n.shadowOffsetX=t.offsetX;n.shadowOffsetY=t.offsetY;n.shadowBlur=t.blur};n._tick=function(n){var t=this._listeners;t&&t.tick&&(n.target=null,n.propagationStopped=n.immediatePropagationStopped=!1,this.dispatchEvent(n))};n._testHit=function(n){try{var i=n.getImageData(0,0,1,1).data[3]>1}catch(r){if(!t.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images.";}return i};n._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var t=this.filters.length,i=this.cacheCanvas.getContext("2d"),r=this.cacheCanvas.width,u=this.cacheCanvas.height,n=0;t>n;n++)this.filters[n].applyFilter(i,0,0,r,u)};n._getFilterBounds=function(){var r,u=this.filters,t=this._rectangle.setValues(0,0,0,0),n,i;if(!u||!(r=u.length))return t;for(n=0;r>n;n++)i=this.filters[n],i.getBounds&&i.getBounds(t);return t};n._getBounds=function(n,t){return this._transformBounds(this.getBounds(),n,t)};n._transformBounds=function(n,t,i){if(!n)return n;var r=n.x,u=n.y,a=n.width,v=n.height,f=this._props.matrix;f=i?f.identity():this.getMatrix(f);(r||u)&&f.appendTransform(0,0,1,1,0,0,0,-r,-u);t&&f.prependMatrix(t);var y=a*f.a,p=a*f.b,w=v*f.c,b=v*f.d,c=f.tx,l=f.ty,e=c,s=c,o=l,h=l;return(r=y+c)<e?e=r:r>s&&(s=r),(r=y+w+c)<e?e=r:r>s&&(s=r),(r=w+c)<e?e=r:r>s&&(s=r),(u=p+l)<o?o=u:u>h&&(h=u),(u=p+b+l)<o?o=u:u>h&&(h=u),(u=b+l)<o?o=u:u>h&&(h=u),n.setValues(e,o,s-e,h-o)};n._hasMouseEventListener=function(){for(var i=t._MOUSE_EVENTS,n=0,r=i.length;r>n;n++)if(this.hasEventListener(i[n]))return!0;return!!this.cursor};createjs.DisplayObject=createjs.promote(t,"EventDispatcher")}();this.createjs=this.createjs||{},function(){"use strict";function t(){this.DisplayObject_constructor();this.children=[];this.mouseChildren=!0;this.tickChildren=!0}var n=createjs.extend(t,createjs.DisplayObject);n.getNumChildren=function(){return this.children.length};try{Object.defineProperties(n,{numChildren:{get:n.getNumChildren}})}catch(i){}n.initialize=t;n.isVisible=function(){var n=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&n)};n.draw=function(n,t){var i;if(this.DisplayObject_draw(n,t))return!0;for(var u=this.children.slice(),r=0,f=u.length;f>r;r++)i=u[r],i.isVisible()&&(n.save(),i.updateContext(n),i.draw(n),n.restore());return!0};n.addChild=function(n){var t,i;if(null==n)return n;if(t=arguments.length,t>1){for(i=0;t>i;i++)this.addChild(arguments[i]);return arguments[t-1]}return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.push(n),n.dispatchEvent("added"),n};n.addChildAt=function(n,t){var i=arguments.length,u=arguments[i-1],r;if(0>u||u>this.children.length)return arguments[i-2];if(i>2){for(r=0;i-1>r;r++)this.addChildAt(arguments[r],u+r);return arguments[i-2]}return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),n.dispatchEvent("added"),n};n.removeChild=function(n){var r=arguments.length,t,i;if(r>1){for(t=!0,i=0;r>i;i++)t=t&&this.removeChild(arguments[i]);return t}return this.removeChildAt(createjs.indexOf(this.children,n))};n.removeChildAt=function(n){var f=arguments.length,i,r,t,u;if(f>1){for(i=[],t=0;f>t;t++)i[t]=arguments[t];for(i.sort(function(n,t){return t-n}),r=!0,t=0;f>t;t++)r=r&&this.removeChildAt(i[t]);return r}return 0>n||n>this.children.length-1?!1:(u=this.children[n],u&&(u.parent=null),this.children.splice(n,1),u.dispatchEvent("removed"),!0)};n.removeAllChildren=function(){for(var n=this.children;n.length;)this.removeChildAt(0)};n.getChildAt=function(n){return this.children[n]};n.getChildByName=function(n){for(var i=this.children,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null};n.sortChildren=function(n){this.children.sort(n)};n.getChildIndex=function(n){return createjs.indexOf(this.children,n)};n.swapChildrenAt=function(n,t){var i=this.children,r=i[n],u=i[t];r&&u&&(i[n]=u,i[t]=r)};n.swapChildren=function(n,t){for(var u,f,r=this.children,i=0,e=r.length;e>i&&(r[i]==n&&(u=i),r[i]==t&&(f=i),null==u||null==f);i++);i!=e&&(r[u]=t,r[f]=n)};n.setChildIndex=function(n,t){var r=this.children,u=r.length,i;if(!(n.parent!=this||0>t||t>=u)){for(i=0;u>i&&r[i]!=n;i++);i!=u&&i!=t&&(r.splice(i,1),r.splice(t,0,n))}};n.contains=function(n){for(;n;){if(n==this)return!0;n=n.parent}return!1};n.hitTest=function(n,t){return null!=this.getObjectUnderPoint(n,t)};n.getObjectsUnderPoint=function(n,t,i){var r=[],u=this.localToGlobal(n,t);return this._getObjectsUnderPoint(u.x,u.y,r,i>0,1==i),r};n.getObjectUnderPoint=function(n,t,i){var r=this.localToGlobal(n,t);return this._getObjectsUnderPoint(r.x,r.y,null,i>0,1==i)};n.getBounds=function(){return this._getBounds(null,!0)};n.getTransformedBounds=function(){return this._getBounds()};n.clone=function(n){var i=this._cloneProps(new t);return n&&this._cloneChildren(i),i};n.toString=function(){return"[Container (name="+this.name+")]"};n._tick=function(n){var t,i;if(this.tickChildren)for(t=this.children.length-1;t>=0;t--)i=this.children[t],i.tickEnabled&&i._tick&&i._tick(n);this.DisplayObject__tick(n)};n._cloneChildren=function(n){var i;n.children.length&&n.removeAllChildren();for(var r=n.children,t=0,u=this.children.length;u>t;t++)i=this.children[t].clone(!0),i.parent=n,r.push(i)};n._getObjectsUnderPoint=function(n,i,r,u,f,e){var h,c,o,s,v,l;if(e=e||0,!e&&!this._testMask(this,n,i))return null;c=createjs.DisplayObject._hitTestContext;f=f||u&&this._hasMouseEventListener();for(var y=this.children,p=y.length,a=p-1;a>=0;a--)if(o=y[a],s=o.hitArea,o.visible&&(s||o.isVisible())&&(!u||o.mouseEnabled)&&(s||this._testMask(o,n,i)))if(!s&&o instanceof t){if(v=o._getObjectsUnderPoint(n,i,r,u,f,e+1),!r&&v)return u&&!this.mouseChildren?this:v}else{if(u&&!f&&!o._hasMouseEventListener())continue;if(l=o.getConcatenatedDisplayProps(o._props),h=l.matrix,s&&(h.appendMatrix(s.getMatrix(s._props.matrix)),l.alpha=s.alpha),c.globalAlpha=l.alpha,c.setTransform(h.a,h.b,h.c,h.d,h.tx-n,h.ty-i),(s||o).draw(c),!this._testHit(c))continue;if(c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,2,2),!r)return u&&!this.mouseChildren?this:o;r.push(o)}return null};n._testMask=function(n,t,i){var f=n.mask,r,e,u;return!f||!f.graphics||f.graphics.isEmpty()?!0:(r=this._props.matrix,e=n.parent,r=e?e.getConcatenatedMatrix(r):r.identity(),r=f.getMatrix(f._props.matrix).prependMatrix(r),u=createjs.DisplayObject._hitTestContext,u.setTransform(r.a,r.b,r.c,r.d,r.tx-t,r.ty-i),f.graphics.drawAsPath(u),u.fillStyle="#000",u.fill(),this._testHit(u)?(u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,2,2),!0):!1)};n._getBounds=function(n,t){var i=this.DisplayObject_getBounds(),r,e;if(i)return this._transformBounds(i,n,t);r=this._props.matrix;r=t?r.identity():this.getMatrix(r);n&&r.prependMatrix(n);for(var o=this.children.length,u=null,f=0;o>f;f++)e=this.children[f],e.visible&&(i=e._getBounds(r))&&(u?u.extend(i.x,i.y,i.width,i.height):u=i.clone());return u};createjs.Container=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(n){this.Container_constructor();this.autoClear=!0;this.canvas="string"==typeof n?document.getElementById(n):n;this.mouseX=0;this.mouseY=0;this.drawRect=null;this.snapToPixelEnabled=!1;this.mouseInBounds=!1;this.tickOnUpdate=!0;this.mouseMoveOutside=!1;this.preventSelection=!0;this._pointerData={};this._pointerCount=0;this._primaryPointerID=null;this._mouseOverIntervalID=null;this._nextStage=null;this._prevStage=null;this.enableDOMEvents(!0)}var n=createjs.extend(t,createjs.Container);n._get_nextStage=function(){return this._nextStage};n._set_nextStage=function(n){this._nextStage&&(this._nextStage._prevStage=null);n&&(n._prevStage=this);this._nextStage=n};try{Object.defineProperties(n,{nextStage:{get:n._get_nextStage,set:n._set_nextStage}})}catch(i){}n.update=function(n){if(this.canvas&&(this.tickOnUpdate&&this.tick(n),!this.dispatchEvent("drawstart"))){createjs.DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled;var i=this.drawRect,t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0);this.autoClear&&(i?t.clearRect(i.x,i.y,i.width,i.height):t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1));t.save();this.drawRect&&(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.clip());this.updateContext(t);this.draw(t,!1);t.restore();this.dispatchEvent("drawend")}};n.tick=function(n){var i,t;if(this.tickEnabled&&!this.dispatchEvent("tickstart")){if(i=new createjs.Event("tick"),n)for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);this._tick(i);this.dispatchEvent("tickend")}};n.handleEvent=function(n){"tick"==n.type&&this.update(n)};n.clear=function(){if(this.canvas){var n=this.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);n.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}};n.toDataURL=function(n,t){var r,i=this.canvas.getContext("2d"),u=this.canvas.width,f=this.canvas.height,e,o;return n&&(r=i.getImageData(0,0,u,f),e=i.globalCompositeOperation,i.globalCompositeOperation="destination-over",i.fillStyle=n,i.fillRect(0,0,u,f)),o=this.canvas.toDataURL(t||"image/png"),n&&(i.putImageData(r,0,0),i.globalCompositeOperation=e),o};n.enableMouseOver=function(n){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==n&&this._testMouseOver(!0)),null==n)n=20;else if(0>=n)return;var t=this;this._mouseOverIntervalID=setInterval(function(){t._testMouseOver()},1e3/Math.min(50,n))};n.enableDOMEvents=function(n){var i,r,t,f,u;if(null==n&&(n=!0),t=this._eventListeners,!n&&t){for(i in t)r=t[i],r.t.removeEventListener(i,r.f,!1);this._eventListeners=null}else if(n&&!t&&this.canvas){f=window.addEventListener?window:document;u=this;t=this._eventListeners={};t.mouseup={t:f,f:function(n){u._handleMouseUp(n)}};t.mousemove={t:f,f:function(n){u._handleMouseMove(n)}};t.dblclick={t:this.canvas,f:function(n){u._handleDoubleClick(n)}};t.mousedown={t:this.canvas,f:function(n){u._handleMouseDown(n)}};for(i in t)r=t[i],r.t.addEventListener(i,r.f,!1)}};n.clone=function(){throw"Stage cannot be cloned.";};n.toString=function(){return"[Stage (name="+this.name+")]"};n._getElementRect=function(n){var i;try{i=n.getBoundingClientRect()}catch(h){i={top:n.offsetTop,left:n.offsetLeft,width:n.offsetWidth,height:n.offsetHeight}}var r=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),u=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),t=window.getComputedStyle?getComputedStyle(n,null):n.currentStyle,f=parseInt(t.paddingLeft)+parseInt(t.borderLeftWidth),e=parseInt(t.paddingTop)+parseInt(t.borderTopWidth),o=parseInt(t.paddingRight)+parseInt(t.borderRightWidth),s=parseInt(t.paddingBottom)+parseInt(t.borderBottomWidth);return{left:i.left+r+f,right:i.right+r-o,top:i.top+u+e,bottom:i.bottom+u-s}};n._getPointerData=function(n){var t=this._pointerData[n];return t||(t=this._pointerData[n]={x:0,y:0}),t};n._handleMouseMove=function(n){n||(n=window.event);this._handlePointerMove(-1,n,n.pageX,n.pageY)};n._handlePointerMove=function(n,t,i,r,u){if((!this._prevStage||void 0!==u)&&this.canvas){var o=this._nextStage,f=this._getPointerData(n),e=f.inBounds;this._updatePointerPosition(n,t,i,r);(e||f.inBounds||this.mouseMoveOutside)&&(-1===n&&f.inBounds==!e&&this._dispatchMouseEvent(this,e?"mouseleave":"mouseenter",!1,n,f,t),this._dispatchMouseEvent(this,"stagemousemove",!1,n,f,t),this._dispatchMouseEvent(f.target,"pressmove",!0,n,f,t));o&&o._handlePointerMove(n,t,i,r,null)}};n._updatePointerPosition=function(n,t,i,r){var f=this._getElementRect(this.canvas),e,o,u;i-=f.left;r-=f.top;e=this.canvas.width;o=this.canvas.height;i/=(f.right-f.left)/e;r/=(f.bottom-f.top)/o;u=this._getPointerData(n);(u.inBounds=i>=0&&r>=0&&e-1>=i&&o-1>=r)?(u.x=i,u.y=r):this.mouseMoveOutside&&(u.x=0>i?0:i>e-1?e-1:i,u.y=0>r?0:r>o-1?o-1:r);u.posEvtObj=t;u.rawX=i;u.rawY=r;(n===this._primaryPointerID||-1===n)&&(this.mouseX=u.x,this.mouseY=u.y,this.mouseInBounds=u.inBounds)};n._handleMouseUp=function(n){this._handlePointerUp(-1,n,!1)};n._handlePointerUp=function(n,t,i,r){var o=this._nextStage,u=this._getPointerData(n),e,f;this._prevStage&&void 0===r||(u.down&&this._dispatchMouseEvent(this,"stagemouseup",!1,n,u,t),u.down=!1,e=null,f=u.target,!r&&(f||o)&&(e=this._getObjectsUnderPoint(u.x,u.y,null,!0)),e==f&&this._dispatchMouseEvent(f,"click",!0,n,u,t),this._dispatchMouseEvent(f,"pressup",!0,n,u,t),i?(n==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[n]):u.target=null,o&&o._handlePointerUp(n,t,i,r||e&&this))};n._handleMouseDown=function(n){this._handlePointerDown(-1,n,n.pageX,n.pageY)};n._handlePointerDown=function(n,t,i,r,u){this.preventSelection&&t.preventDefault();(null==this._primaryPointerID||-1===n)&&(this._primaryPointerID=n);null!=r&&this._updatePointerPosition(n,t,i,r);var e=null,o=this._nextStage,f=this._getPointerData(n);f.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,n,f,t),f.down=!0);u||(e=f.target=this._getObjectsUnderPoint(f.x,f.y,null,!0),this._dispatchMouseEvent(f.target,"mousedown",!0,n,f,t));o&&o._handlePointerDown(n,t,i,r,u||e&&this)};n._testMouseOver=function(n,t,i){var s,u;if(!this._prevStage||void 0!==t){if(s=this._nextStage,!this._mouseOverIntervalID)return void(s&&s._testMouseOver(n,t,i));if(u=this._getPointerData(-1),u&&(n||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var f,r,y,e=u.posEvtObj,p=i||e&&e.target==this.canvas,o=null,l=-1,a="";!t&&(n||this.mouseInBounds&&p)&&(o=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var h=this._mouseOverTarget||[],v=h[h.length-1],c=this._mouseOverTarget=[];for(f=o;f;)c.unshift(f),null!=f.cursor&&(a=f.cursor),f=f.parent;for(this.canvas.style.cursor=a,!t&&i&&(i.canvas.style.cursor=a),r=0,y=c.length;y>r&&c[r]==h[r];r++)l=r;for(v!=o&&this._dispatchMouseEvent(v,"mouseout",!0,-1,u,e),r=h.length-1;r>l;r--)this._dispatchMouseEvent(h[r],"rollout",!1,-1,u,e);for(r=c.length-1;r>l;r--)this._dispatchMouseEvent(c[r],"rollover",!1,-1,u,e);v!=o&&this._dispatchMouseEvent(o,"mouseover",!0,-1,u,e);s&&s._testMouseOver(n,t||o&&this,i||p&&this)}}};n._handleDoubleClick=function(n,t){var i=null,u=this._nextStage,r=this._getPointerData(-1);t||(i=this._getObjectsUnderPoint(r.x,r.y,null,!0),this._dispatchMouseEvent(i,"dblclick",!0,-1,r,n));u&&u._handleDoubleClick(n,t||i&&this)};n._dispatchMouseEvent=function(n,t,i,r,u,f){if(n&&(i||n.hasEventListener(t))){var e=new createjs.MouseEvent(t,i,!1,u.x,u.y,f,r,r===this._primaryPointerID||-1===r,u.rawX,u.rawY);n.dispatchEvent(e)}};createjs.Stage=createjs.promote(t,"Container")}();this.createjs=this.createjs||{},function(){function t(n){this.DisplayObject_constructor();"string"==typeof n?(this.image=document.createElement("img"),this.image.src=n):this.image=n;this.sourceRect=null}var n=createjs.extend(t,createjs.DisplayObject);n.initialize=t;n.isVisible=function(){var n=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&n)};n.draw=function(n,t){var f,u;if(this.DisplayObject_draw(n,t)||!this.image)return!0;if(f=this.image,u=this.sourceRect,u){var i=u.x,r=u.y,e=i+u.width,o=r+u.height,s=0,h=0,c=f.width,l=f.height;0>i&&(s-=i,i=0);e>c&&(e=c);0>r&&(h-=r,r=0);o>l&&(o=l);n.drawImage(f,i,r,e-i,o-r,s,h,e-i,o-r)}else n.drawImage(f,0,0);return!0};n.getBounds=function(){var t=this.DisplayObject_getBounds(),n,i;return t?t:(n=this.sourceRect||this.image,i=this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2),i?this._rectangle.setValues(0,0,n.width,n.height):null)};n.clone=function(){var n=new t(this.image);return this.sourceRect&&(n.sourceRect=this.sourceRect.clone()),this._cloneProps(n),n};n.toString=function(){return"[Bitmap (name="+this.name+")]"};createjs.Bitmap=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t){this.DisplayObject_constructor();this.currentFrame=0;this.currentAnimation=null;this.paused=!0;this.spriteSheet=n;this.currentAnimationFrame=0;this.framerate=0;this._animation=null;this._currentFrame=null;this._skipAdvance=!1;t&&this.gotoAndPlay(t)}var n=createjs.extend(t,createjs.DisplayObject);n.isVisible=function(){var n=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&n)};n.draw=function(n,t){var r,i;return this.DisplayObject_draw(n,t)?!0:(this._normalizeFrame(),r=this.spriteSheet.getFrame(0|this._currentFrame),!r)?!1:(i=r.rect,i.width&&i.height&&n.drawImage(r.image,i.x,i.y,i.width,i.height,-r.regX,-r.regY,i.width,i.height),!0)};n.play=function(){this.paused=!1};n.stop=function(){this.paused=!0};n.gotoAndPlay=function(n){this.paused=!1;this._skipAdvance=!0;this._goto(n)};n.gotoAndStop=function(n){this.paused=!0;this._goto(n)};n.advance=function(n){var t=this.framerate||this.spriteSheet.framerate,i=t&&null!=n?n/(1e3/t):1;this._normalizeFrame(i)};n.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)};n.clone=function(){return this._cloneProps(new t(this.spriteSheet))};n.toString=function(){return"[Sprite (name="+this.name+")]"};n._cloneProps=function(n){return this.DisplayObject__cloneProps(n),n.currentFrame=this.currentFrame,n.currentAnimation=this.currentAnimation,n.paused=this.paused,n.currentAnimationFrame=this.currentAnimationFrame,n.framerate=this.framerate,n._animation=this._animation,n._currentFrame=this._currentFrame,n._skipAdvance=this._skipAdvance,n};n._tick=function(n){this.paused||(this._skipAdvance||this.advance(n&&n.delta),this._skipAdvance=!1);this.DisplayObject__tick(n)};n._normalizeFrame=function(n){var f,u,e;n=n||0;var t,i=this._animation,o=this.paused,r=this._currentFrame;if(i){if(f=i.speed||1,u=this.currentAnimationFrame,t=i.frames.length,u+n*f>=t){if(e=i.next,this._dispatchAnimationEnd(i,r,o,e,t-1))return;if(e)return this._goto(e,n-(t-u)/f);this.paused=!0;u=i.frames.length-1}else u+=n*f;this.currentAnimationFrame=u;this._currentFrame=i.frames[0|u]}else if(r=this._currentFrame+=n,t=this.spriteSheet.getNumFrames(),r>=t&&t>0&&!this._dispatchAnimationEnd(i,r,o,t-1)&&(this._currentFrame-=t)>=t)return this._normalizeFrame();r=0|this._currentFrame;this.currentFrame!=r&&(this.currentFrame=r,this.dispatchEvent("change"))};n._dispatchAnimationEnd=function(n,t,i,r,u){var o=n?n.name:null,f,e;return this.hasEventListener("animationend")&&(f=new createjs.Event("animationend"),f.name=o,f.next=r,this.dispatchEvent(f)),e=this._animation!=n||this._currentFrame!=t,e||i||!this.paused||(this.currentAnimationFrame=u,e=!0),e};n._goto=function(n,t){if(this.currentAnimationFrame=0,isNaN(n)){var i=this.spriteSheet.getAnimation(n);i&&(this._animation=i,this.currentAnimation=n,this._normalizeFrame(t))}else this.currentAnimation=this._animation=null,this._currentFrame=n,this._normalizeFrame()};createjs.Sprite=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(n){this.DisplayObject_constructor();this.graphics=n?n:new createjs.Graphics}var n=createjs.extend(t,createjs.DisplayObject);n.isVisible=function(){var n=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&n)};n.draw=function(n,t){return this.DisplayObject_draw(n,t)?!0:(this.graphics.draw(n,this),!0)};n.clone=function(n){var i=n&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new t(i))};n.toString=function(){return"[Shape (name="+this.name+")]"};createjs.Shape=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t,i){this.DisplayObject_constructor();this.text=n;this.font=t;this.color=i;this.textAlign="left";this.textBaseline="top";this.maxWidth=null;this.outline=0;this.lineHeight=0;this.lineWidth=null}var n=createjs.extend(t,createjs.DisplayObject),i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._workingContext=i.getContext("2d"),i.width=i.height=1);t.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1};t.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1};n.isVisible=function(){var n=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&n)};n.draw=function(n,t){if(this.DisplayObject_draw(n,t))return!0;var i=this.color||"#000";return this.outline?(n.strokeStyle=i,n.lineWidth=1*this.outline):n.fillStyle=i,this._drawText(this._prepContext(n)),!0};n.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)};n.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")};n.getMeasuredHeight=function(){return this._drawText(null,{}).height};n.getBounds=function(){var i=this.DisplayObject_getBounds();if(i)return i;if(null==this.text||""==this.text)return null;var n=this._drawText(null,{}),r=this.maxWidth&&this.maxWidth<n.width?this.maxWidth:n.width,u=r*t.H_OFFSETS[this.textAlign||"left"],f=this.lineHeight||this.getMeasuredLineHeight(),e=f*t.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(u,e,r,n.height)};n.getMetrics=function(){var n={lines:[]};return n.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),n.vOffset=n.lineHeight*t.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,n,n.lines)};n.clone=function(){return this._cloneProps(new t(this.text,this.font,this.color))};n.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"};n._cloneProps=function(n){return this.DisplayObject__cloneProps(n),n.textAlign=this.textAlign,n.textBaseline=this.textBaseline,n.maxWidth=this.maxWidth,n.outline=this.outline,n.lineHeight=this.lineHeight,n.lineWidth=this.lineWidth,n};n._prepContext=function(n){return n.font=this.font||"10px sans-serif",n.textAlign=this.textAlign||"left",n.textBaseline=this.textBaseline||"top",n};n._drawText=function(n,i,r){var c=!!n,u,f,e,o,p,v;c||(n=t._workingContext,n.save(),this._prepContext(n));for(var l=this.lineHeight||this.getMeasuredLineHeight(),s=0,h=0,y=String(this.text).split(/(?:\r\n|\r|\n)/),a=0,w=y.length;w>a;a++){if(u=y[a],f=null,null!=this.lineWidth&&(f=n.measureText(u).width)>this.lineWidth)for(e=u.split(/(\s)/),u=e[0],f=n.measureText(u).width,o=1,p=e.length;p>o;o+=2)v=n.measureText(e[o]+e[o+1]).width,f+v>this.lineWidth?(c&&this._drawTextLine(n,u,h*l),r&&r.push(u),f>s&&(s=f),u=e[o+1],f=n.measureText(u).width,h++):(u+=e[o]+e[o+1],f+=v);c&&this._drawTextLine(n,u,h*l);r&&r.push(u);i&&null==f&&(f=n.measureText(u).width);f>s&&(s=f);h++}return i&&(i.width=s,i.height=h*l),c||n.restore(),i};n._drawTextLine=function(n,t,i){this.outline?n.strokeText(t,0,i,this.maxWidth||65535):n.fillText(t,0,i,this.maxWidth||65535)};n._getMeasuredWidth=function(n){var i=t._workingContext,r;return i.save(),r=this._prepContext(i).measureText(n).width,i.restore(),r};createjs.Text=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(n,t){this.Container_constructor();this.text=n||"";this.spriteSheet=t;this.lineHeight=0;this.letterSpacing=0;this.spaceWidth=0;this._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var n=createjs.extend(t,createjs.Container);t.maxPoolSize=100;t._spritePool=[];n.draw=function(n,t){this.DisplayObject_draw(n,t)||(this._updateText(),this.Container_draw(n,t))};n.getBounds=function(){return this._updateText(),this.Container_getBounds()};n.isVisible=function(){var n=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&n)};n.clone=function(){return this._cloneProps(new t(this.text,this.spriteSheet))};n.addChild=n.addChildAt=n.removeChild=n.removeChildAt=n.removeAllChildren=function(){};n._cloneProps=function(n){return this.DisplayObject__cloneProps(n),n.lineHeight=this.lineHeight,n.letterSpacing=this.letterSpacing,n.spaceWidth=this.spaceWidth,n};n._getFrameIndex=function(n,t){var i,r=t.getAnimation(n);return r||(n!=(i=n.toUpperCase())||n!=(i=n.toLowerCase())||(i=null),i&&(r=t.getAnimation(i))),r&&r.frames[0]};n._getFrame=function(n,t){var i=this._getFrameIndex(n,t);return null==i?i:t.getFrame(i)};n._getLineHeight=function(n){var t=this._getFrame("1",n)||this._getFrame("T",n)||this._getFrame("L",n)||n.getFrame(0);return t?t.rect.height:1};n._getSpaceWidth=function(n){var t=this._getFrame("1",n)||this._getFrame("l",n)||this._getFrame("e",n)||this._getFrame("a",n)||n.getFrame(0);return t?t.rect.width:1};n._updateText=function(){var n,o=0,w=0,l=this._oldProps,b=!1,a=this.spaceWidth,v=this.lineHeight,u=this.spriteSheet,f=t._spritePool,s=this.children,h=0,c=s.length,e,y,i,k,r,p;for(e in l)l[e]!=this[e]&&(l[e]=this[e],b=!0);if(b){for(y=!!this._getFrame(" ",u),y||a||(a=this._getSpaceWidth(u)),v||(v=this._getLineHeight(u)),i=0,k=this.text.length;k>i;i++)r=this.text.charAt(i)," "!=r||y?"\n"!=r&&"\r"!=r?(p=this._getFrameIndex(r,u),null!=p&&(c>h?n=s[h]:(s.push(n=f.length?f.pop():new createjs.Sprite),n.parent=this,c++),n.spriteSheet=u,n.gotoAndStop(p),n.x=o,n.y=w,h++,o+=n.getBounds().width+this.letterSpacing)):("\r"==r&&"\n"==this.text.charAt(i+1)&&i++,o=0,w+=v):o+=a;for(;c>h;)f.push(n=s.pop()),n.parent=null,c--;f.length>t.maxPoolSize&&(f.length=t.maxPoolSize)}};createjs.BitmapText=createjs.promote(t,"Container")}();this.createjs=this.createjs||{},function(){"use strict";function n(){throw"SpriteSheetUtils cannot be instantiated";}var t=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");t.getContext&&(n._workingCanvas=t,n._workingContext=t.getContext("2d"),t.width=t.height=1);n.addFlippedFrames=function(t,i,r,u){if(i||r||u){var f=0;i&&n._flip(t,++f,!0,!1);r&&n._flip(t,++f,!1,!0);u&&n._flip(t,++f,!0,!0)}};n.extractFrame=function(t,i){var u,r,f,e;return(isNaN(i)&&(i=t.getAnimation(i).frames[0]),u=t.getFrame(i),!u)?null:(r=u.rect,f=n._workingCanvas,f.width=r.width,f.height=r.height,n._workingContext.drawImage(u.image,r.x,r.y,r.width,r.height,0,0,r.width,r.height),e=document.createElement("img"),e.src=f.toDataURL("image/png"),e)};n.mergeAlpha=function(n,t,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"));i.width=Math.max(t.width,n.width);i.height=Math.max(t.height,n.height);var r=i.getContext("2d");return r.save(),r.drawImage(n,0,0),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),r.restore(),i};n._flip=function(t,i,r,u){for(var f,s,h,w,o,y,k,c,p,tt,a=t._images,l=n._workingCanvas,v=n._workingContext,d=a.length/i,e=0;d>e;e++)f=a[e],f.__tmp=e,v.setTransform(1,0,0,1,0,0),v.clearRect(0,0,l.width+1,l.height+1),l.width=f.width,l.height=f.height,v.setTransform(r?-1:1,0,0,u?-1:1,r?f.width:0,u?f.height:0),v.drawImage(f,0,0),s=document.createElement("img"),s.src=l.toDataURL("image/png"),s.width=f.width,s.height=f.height,a.push(s);for(h=t._frames,w=h.length/i,e=0;w>e;e++)f=h[e],o=f.rect.clone(),s=a[f.image.__tmp+d*i],y={image:s,rect:o,regX:f.regX,regY:f.regY},r&&(o.x=s.width-o.x-o.width,y.regX=o.width-f.regX),u&&(o.y=s.height-o.y-o.height,y.regY=o.height-f.regY),h.push(y);var g="_"+(r?"h":"")+(u?"v":""),b=t._animations,nt=t._data,it=b.length/i;for(e=0;it>e;e++){for(k=b[e],f=nt[k],c={name:k+g,speed:f.speed,next:f.next,frames:[]},f.next&&(c.next+=g),h=f.frames,p=0,tt=h.length;tt>p;p++)c.frames.push(h[p]+w*i);nt[c.name]=c;b.push(c.name)}};createjs.SpriteSheetUtils=n}();this.createjs=this.createjs||{},function(){"use strict";function t(){this.EventDispatcher_constructor();this.maxWidth=2048;this.maxHeight=2048;this.spriteSheet=null;this.scale=1;this.padding=1;this.timeSlice=.3;this.progress=-1;this._frames=[];this._animations={};this._data=null;this._nextFrameIndex=0;this._index=0;this._timerID=null;this._scale=1}var n=createjs.extend(t,createjs.EventDispatcher);t.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions";t.ERR_RUNNING="a build is already running";n.addFrame=function(n,i,r,u,f){if(this._data)throw t.ERR_RUNNING;var e=i||n.bounds||n.nominalBounds;return!e&&n.getBounds&&(e=n.getBounds()),e?(r=r||1,this._frames.push({source:n,sourceRect:e,scale:r,funct:u,data:f,index:this._frames.length,height:e.height*r})-1):null};n.addAnimation=function(n,i,r,u){if(this._data)throw t.ERR_RUNNING;this._animations[n]={frames:i,next:r,frequency:u}};n.addMovieClip=function(n,i,r,u,f,e){var h,c,o,l,a,v,k,y,s,p;if(this._data)throw t.ERR_RUNNING;if(h=n.frameBounds,c=i||n.bounds||n.nominalBounds,!c&&n.getBounds&&(c=n.getBounds()),c||h){for(a=this._frames.length,v=n.timeline.duration,o=0;v>o;o++)k=h&&h[o]?h[o]:c,this.addFrame(n,k,r,this._setupMovieClipFrame,{i:o,f:u,d:f});y=n.timeline._labels;s=[];for(p in y)s.push({index:y[p],label:p});if(s.length)for(s.sort(function(n,t){return n.index-t.index}),o=0,l=s.length;l>o;o++){for(var w=s[o].label,d=a+s[o].index,g=a+(o==l-1?v:s[o+1].index),nt=[],b=d;g>b;b++)nt.push(b);(!e||(w=e(w,n,d,g)))&&this.addAnimation(w,nt,!0)}}};n.build=function(){if(this._data)throw t.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet};n.buildAsync=function(n){if(this._data)throw t.ERR_RUNNING;this.timeSlice=n;this._startBuild();var i=this;this._timerID=setTimeout(function(){i._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))};n.stopAsync=function(){clearTimeout(this._timerID);this._data=null};n.clone=function(){throw"SpriteSheetBuilder cannot be cloned.";};n.toString=function(){return"[SpriteSheetBuilder]"};n._startBuild=function(){var s=this.padding||0,e,n,i,f;if(this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale,e=[],this._data={images:[],frames:e,animations:this._animations},n=this._frames.slice(),n.sort(function(n,t){return n.height<=t.height?-1:1}),n[n.length-1].height+2*s>this.maxHeight)throw t.ERR_DIMENSIONS;for(var r=0,u=0,o=0;n.length;)i=this._fillRow(n,r,o,e,s),(i.w>u&&(u=i.w),r+=i.h,i.h&&n.length)||(f=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),f.width=this._getSize(u,this.maxWidth),f.height=this._getSize(r,this.maxHeight),this._data.images[o]=f,i.h||(u=r=0,o++))};n._setupMovieClipFrame=function(n,t){var i=n.actionsEnabled;n.actionsEnabled=!1;n.gotoAndStop(t.i);n.actionsEnabled=i;t.f&&t.f(n,t.d,t.i)};n._getSize=function(n,t){for(var i=4;Math.pow(2,++i)<n;);return Math.min(t,Math.pow(2,i))};n._fillRow=function(n,i,r,u,f){var y=this.maxWidth,w=this.maxHeight;i+=f;for(var b=w-i,s=f,v=0,c=n.length-1;c>=0;c--){var e=n[c],o=this._scale*e.scale,l=e.sourceRect,p=e.source,k=Math.floor(o*l.x-f),d=Math.floor(o*l.y-f),a=Math.ceil(o*l.height+2*f),h=Math.ceil(o*l.width+2*f);if(h>y)throw t.ERR_DIMENSIONS;a>b||s+h>y||(e.img=r,e.rect=new createjs.Rectangle(s,i,h,a),v=v||a,n.splice(c,1),u[e.index]=[s,i,h,a,r,Math.round(-k+o*p.regX-f),Math.round(-d+o*p.regY-f)],s+=h)}return{w:s,h:v}};n._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data);this._data=null;this.progress=1;this.dispatchEvent("complete")};n._run=function(){for(var r,u,n,t=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),f=(new Date).getTime()+t,i=!1;f>(new Date).getTime();)if(!this._drawNext()){i=!0;break}i?this._endBuild():(r=this,this._timerID=setTimeout(function(){r._run()},50-t));u=this.progress=this._index/this._frames.length;this.hasEventListener("progress")&&(n=new createjs.Event("progress"),n.progress=u,this.dispatchEvent(n))};n._drawNext=function(){var n=this._frames[this._index],r=n.scale*this._scale,i=n.rect,u=n.sourceRect,f=this._data.images[n.img],t=f.getContext("2d");return n.funct&&n.funct(n.source,n.data),t.save(),t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.clip(),t.translate(Math.ceil(i.x-u.x*r),Math.ceil(i.y-u.y*r)),t.scale(r,r),n.source.draw(t),t.restore(),++this._index<this._frames.length};createjs.SpriteSheetBuilder=createjs.promote(t,"EventDispatcher")}();this.createjs=this.createjs||{},function(){"use strict";function t(n){this.DisplayObject_constructor();"string"==typeof n&&(n=document.getElementById(n));this.mouseEnabled=!1;var t=n.style;t.position="absolute";t.transformOrigin=t.WebkitTransformOrigin=t.msTransformOrigin=t.MozTransformOrigin=t.OTransformOrigin="0% 0%";this.htmlElement=n;this._oldProps=null}var n=createjs.extend(t,createjs.DisplayObject);n.isVisible=function(){return null!=this.htmlElement};n.draw=function(){return!0};n.cache=function(){};n.uncache=function(){};n.updateCache=function(){};n.hitTest=function(){};n.localToGlobal=function(){};n.globalToLocal=function(){};n.localToLocal=function(){};n.clone=function(){throw"DOMElement cannot be cloned.";};n.toString=function(){return"[DOMElement (name="+this.name+")]"};n._tick=function(n){var t=this.getStage();t&&t.on("drawend",this._handleDrawEnd,this,!0);this.DisplayObject__tick(n)};n._handleDrawEnd=function(){var e=this.htmlElement,f;if(e){var i=e.style,u=this.getConcatenatedDisplayProps(this._props),t=u.matrix,o=u.visible?"visible":"hidden";if(o!=i.visibility&&(i.visibility=o),u.visible){var r=this._oldProps,s=r&&r.matrix,n=1e4;s&&s.equals(t)||(f="matrix("+(t.a*n|0)/n+","+(t.b*n|0)/n+","+(t.c*n|0)/n+","+(t.d*n|0)/n+","+(t.tx+.5|0),i.transform=i.WebkitTransform=i.OTransform=i.msTransform=f+","+(t.ty+.5|0)+")",i.MozTransform=f+"px,"+(t.ty+.5|0)+"px)",r||(r=this._oldProps=new createjs.DisplayProps(!0,NaN)),r.matrix.copy(t));r.alpha!=u.alpha&&(i.opacity=""+(u.alpha*n|0)/n,r.alpha=u.alpha)}}};createjs.DOMElement=createjs.promote(t,"DisplayObject")}();this.createjs=this.createjs||{},function(){"use strict";function t(){}var n=t.prototype;n.getBounds=function(n){return n};n.applyFilter=function(n,t,i,r,u,f,e,o){f=f||n;null==e&&(e=t);null==o&&(o=i);try{var s=n.getImageData(t,i,r,u)}catch(h){return!1}return this._applyFilter(s)?(f.putImageData(s,e,o),!0):!1};n.toString=function(){return"[Filter]"};n.clone=function(){return new t};n._applyFilter=function(){return!0};createjs.Filter=t}();this.createjs=this.createjs||{},function(){"use strict";function n(n,t,i){(isNaN(n)||0>n)&&(n=0);(isNaN(t)||0>t)&&(t=0);(isNaN(i)||1>i)&&(i=1);this.blurX=0|n;this.blurY=0|t;this.quality=0|i}var t=createjs.extend(n,createjs.Filter);n.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1];n.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9];t.getBounds=function(n){var i=0|this.blurX,r=0|this.blurY,t;return 0>=i&&0>=r?n:(t=Math.pow(this.quality,.2),(n||new createjs.Rectangle).pad(i*t+1,r*t+1,i*t+1,r*t+1))};t.clone=function(){return new n(this.blurX,this.blurY,this.quality)};t.toString=function(){return"[BlurFilter]"};t._applyFilter=function(t){var nt=this.blurX>>1,y,v,ut,o,h,c;if(isNaN(nt)||0>nt||(y=this.blurY>>1,isNaN(y)||0>y)||0==nt&&0==y)return!1;v=this.quality;(isNaN(v)||1>v)&&(v=1);v|=0;v>3&&(v=3);1>v&&(v=1);for(var i=t.data,a=0,p=0,e=0,r=0,lt=0,f=0,at=0,w=0,b=0,k=0,d=0,ft=0,et=0,ot=0,l=0,vt=nt+nt+1|0,yt=y+y+1|0,g=0|t.width,st=0|t.height,ht=g-1|0,rt=st-1|0,it=nt+1|0,tt=y+1|0,ct={r:0,b:0,g:0,a:0},s=ct,e=1;vt>e;e++)s=s.n={r:0,b:0,g:0,a:0};for(s.n=ct,ut={r:0,b:0,g:0,a:0},o=ut,e=1;yt>e;e++)o=o.n={r:0,b:0,g:0,a:0};o.n=ut;for(var u=null,pt=0|n.MUL_TABLE[nt],wt=0|n.SHG_TABLE[nt],bt=0|n.MUL_TABLE[y],kt=0|n.SHG_TABLE[y];v-->0;){for(at=f=0,h=pt,c=wt,p=st;--p>-1;){for(w=it*(ft=i[0|f]),b=it*(et=i[f+1|0]),k=it*(ot=i[f+2|0]),d=it*(l=i[f+3|0]),s=ct,e=it;--e>-1;)s.r=ft,s.g=et,s.b=ot,s.a=l,s=s.n;for(e=1;it>e;e++)r=f+((e>ht?ht:e)<<2)|0,w+=s.r=i[r],b+=s.g=i[r+1],k+=s.b=i[r+2],d+=s.a=i[r+3],s=s.n;for(u=ct,a=0;g>a;a++)i[f++]=w*h>>>c,i[f++]=b*h>>>c,i[f++]=k*h>>>c,i[f++]=d*h>>>c,r=at+((r=a+nt+1)<ht?r:ht)<<2,w-=u.r-(u.r=i[r]),b-=u.g-(u.g=i[r+1]),k-=u.b-(u.b=i[r+2]),d-=u.a-(u.a=i[r+3]),u=u.n;at+=g}for(h=bt,c=kt,a=0;g>a;a++){for(f=a<<2|0,w=tt*(ft=i[f])|0,b=tt*(et=i[f+1|0])|0,k=tt*(ot=i[f+2|0])|0,d=tt*(l=i[f+3|0])|0,o=ut,e=0;tt>e;e++)o.r=ft,o.g=et,o.b=ot,o.a=l,o=o.n;for(lt=g,e=1;y>=e;e++)f=lt+a<<2,w+=o.r=i[f],b+=o.g=i[f+1],k+=o.b=i[f+2],d+=o.a=i[f+3],o=o.n,rt>e&&(lt+=g);if(f=a,u=ut,v>0)for(p=0;st>p;p++)r=f<<2,i[r+3]=l=d*h>>>c,l>0?(i[r]=w*h>>>c,i[r+1]=b*h>>>c,i[r+2]=k*h>>>c):i[r]=i[r+1]=i[r+2]=0,r=a+((r=p+tt)<rt?r:rt)*g<<2,w-=u.r-(u.r=i[r]),b-=u.g-(u.g=i[r+1]),k-=u.b-(u.b=i[r+2]),d-=u.a-(u.a=i[r+3]),u=u.n,f+=g;else for(p=0;st>p;p++)r=f<<2,i[r+3]=l=d*h>>>c,l>0?(l=255/l,i[r]=(w*h>>>c)*l,i[r+1]=(b*h>>>c)*l,i[r+2]=(k*h>>>c)*l):i[r]=i[r+1]=i[r+2]=0,r=a+((r=p+tt)<rt?r:rt)*g<<2,w-=u.r-(u.r=i[r]),b-=u.g-(u.g=i[r+1]),k-=u.b-(u.b=i[r+2]),d-=u.a-(u.a=i[r+3]),u=u.n,f+=g}}return!0};createjs.BlurFilter=createjs.promote(n,"Filter")}();this.createjs=this.createjs||{},function(){"use strict";function t(n){this.alphaMap=n;this._alphaMap=null;this._mapData=null}var n=createjs.extend(t,createjs.Filter);n.clone=function(){var n=new t(this.alphaMap);return n._alphaMap=this._alphaMap,n._mapData=this._mapData,n};n.toString=function(){return"[AlphaMapFilter]"};n._applyFilter=function(n){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var i=n.data,r=this._mapData,t=0,u=i.length;u>t;t+=4)i[t+3]=r[t]||0;return!0};n._prepAlphaMap=function(){var i,n,t,r;if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;n=this._alphaMap=this.alphaMap;t=n;n instanceof HTMLCanvasElement?i=t.getContext("2d"):(t=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),t.width=n.width,t.height=n.height,i=t.getContext("2d"),i.drawImage(n,0,0));try{r=i.getImageData(0,0,n.width,n.height)}catch(u){return!1}return this._mapData=r.data,!0};createjs.AlphaMapFilter=createjs.promote(t,"Filter")}();this.createjs=this.createjs||{},function(){"use strict";function n(n){this.mask=n}var t=createjs.extend(n,createjs.Filter);t.applyFilter=function(n,t,i,r,u,f,e,o){return this.mask?(f=f||n,null==e&&(e=t),null==o&&(o=i),f.save(),n!=f?!1:(f.globalCompositeOperation="destination-in",f.drawImage(this.mask,e,o),f.restore(),!0)):!0};t.clone=function(){return new n(this.mask)};t.toString=function(){return"[AlphaMaskFilter]"};createjs.AlphaMaskFilter=createjs.promote(n,"Filter")}();this.createjs=this.createjs||{},function(){"use strict";function n(n,t,i,r,u,f,e,o){this.redMultiplier=null!=n?n:1;this.greenMultiplier=null!=t?t:1;this.blueMultiplier=null!=i?i:1;this.alphaMultiplier=null!=r?r:1;this.redOffset=u||0;this.greenOffset=f||0;this.blueOffset=e||0;this.alphaOffset=o||0}var t=createjs.extend(n,createjs.Filter);t.toString=function(){return"[ColorFilter]"};t.clone=function(){return new n(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)};t._applyFilter=function(n){for(var i=n.data,r=i.length,t=0;r>t;t+=4)i[t]=i[t]*this.redMultiplier+this.redOffset,i[t+1]=i[t+1]*this.greenMultiplier+this.greenOffset,i[t+2]=i[t+2]*this.blueMultiplier+this.blueOffset,i[t+3]=i[t+3]*this.alphaMultiplier+this.alphaOffset;return!0};createjs.ColorFilter=createjs.promote(n,"Filter")}();this.createjs=this.createjs||{},function(){"use strict";function n(n,t,i,r){this.setColor(n,t,i,r)}var t=n.prototype;n.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];n.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];n.LENGTH=n.IDENTITY_MATRIX.length;t.setColor=function(n,t,i,r){return this.reset().adjustColor(n,t,i,r)};t.reset=function(){return this.copy(n.IDENTITY_MATRIX)};t.adjustColor=function(n,t,i,r){return this.adjustHue(r),this.adjustContrast(t),this.adjustBrightness(n),this.adjustSaturation(i)};t.adjustBrightness=function(n){return 0==n||isNaN(n)?this:(n=this._cleanValue(n,255),this._multiplyMatrix([1,0,0,0,n,0,1,0,0,n,0,0,1,0,n,0,0,0,1,0,0,0,0,0,1]),this)};t.adjustContrast=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,100);var i;return 0>t?i=127+t/100*127:(i=t%1,i=0==i?n.DELTA_INDEX[t]:n.DELTA_INDEX[t<<0]*(1-i)+n.DELTA_INDEX[(t<<0)+1]*i,i=127*i+127),this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this};t.adjustSaturation=function(n){if(0==n||isNaN(n))return this;n=this._cleanValue(n,100);var t=1+(n>0?3*n/100:n/100),i=.3086,r=.6094,u=.082;return this._multiplyMatrix([i*(1-t)+t,r*(1-t),u*(1-t),0,0,i*(1-t),r*(1-t)+t,u*(1-t),0,0,i*(1-t),r*(1-t),u*(1-t)+t,0,0,0,0,0,1,0,0,0,0,0,1]),this};t.adjustHue=function(n){if(0==n||isNaN(n))return this;n=this._cleanValue(n,180)/180*Math.PI;var t=Math.cos(n),i=Math.sin(n),r=.213,u=.715,f=.072;return this._multiplyMatrix([r+t*(1-r)+i*-r,u+t*-u+i*-u,f+t*-f+i*(1-f),0,0,r+t*-r+.143*i,u+t*(1-u)+.14*i,f+t*-f+i*-.283,0,0,r+t*-r+i*-(1-r),u+t*-u+i*u,f+t*(1-f)+i*f,0,0,0,0,0,1,0,0,0,0,0,1]),this};t.concat=function(t){return t=this._fixMatrix(t),t.length!=n.LENGTH?this:(this._multiplyMatrix(t),this)};t.clone=function(){return(new n).copy(this)};t.toArray=function(){for(var i=[],t=0,r=n.LENGTH;r>t;t++)i[t]=this[t];return i};t.copy=function(t){for(var r=n.LENGTH,i=0;r>i;i++)this[i]=t[i];return this};t.toString=function(){return"[ColorMatrix]"};t._multiplyMatrix=function(n){for(var t,r,f=[],u,i=0;5>i;i++){for(t=0;5>t;t++)f[t]=this[t+5*i];for(t=0;5>t;t++){for(u=0,r=0;5>r;r++)u+=n[t+5*r]*f[r];this[t+5*i]=u}}};t._cleanValue=function(n,t){return Math.min(t,Math.max(-t,n))};t._fixMatrix=function(t){return t instanceof n&&(t=t.toArray()),t.length<n.LENGTH?t=t.slice(0,t.length).concat(n.IDENTITY_MATRIX.slice(t.length,n.LENGTH)):t.length>n.LENGTH&&(t=t.slice(0,n.LENGTH)),t};createjs.ColorMatrix=n}();this.createjs=this.createjs||{},function(){"use strict";function n(n){this.matrix=n}var t=createjs.extend(n,createjs.Filter);t.toString=function(){return"[ColorMatrixFilter]"};t.clone=function(){return new n(this.matrix)};t._applyFilter=function(n){for(var u,f,e,o,r=n.data,s=r.length,t=this.matrix,h=t[0],c=t[1],l=t[2],a=t[3],v=t[4],y=t[5],p=t[6],w=t[7],b=t[8],k=t[9],d=t[10],g=t[11],nt=t[12],tt=t[13],it=t[14],rt=t[15],ut=t[16],ft=t[17],et=t[18],ot=t[19],i=0;s>i;i+=4)u=r[i],f=r[i+1],e=r[i+2],o=r[i+3],r[i]=u*h+f*c+e*l+o*a+v,r[i+1]=u*y+f*p+e*w+o*b+k,r[i+2]=u*d+f*g+e*nt+o*tt+it,r[i+3]=u*rt+f*ut+e*ft+o*et+ot;return!0};createjs.ColorMatrixFilter=createjs.promote(n,"Filter")}();this.createjs=this.createjs||{},function(){"use strict";function n(){throw"Touch cannot be instantiated";}n.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)};n.enable=function(t,i,r){return t&&t.canvas&&n.isSupported()?t.__touch?!0:(t.__touch={pointers:{},multitouch:!i,preventDefault:!r,count:0},"ontouchstart"in window?n._IOS_enable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&n._IE_enable(t),!0):!1};n.disable=function(t){t&&("ontouchstart"in window?n._IOS_disable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&n._IE_disable(t),delete t.__touch)};n._IOS_enable=function(t){var i=t.canvas,r=t.__touch.f=function(i){n._IOS_handleEvent(t,i)};i.addEventListener("touchstart",r,!1);i.addEventListener("touchmove",r,!1);i.addEventListener("touchend",r,!1);i.addEventListener("touchcancel",r,!1)};n._IOS_disable=function(n){var t=n.canvas,i;t&&(i=n.__touch.f,t.removeEventListener("touchstart",i,!1),t.removeEventListener("touchmove",i,!1),t.removeEventListener("touchend",i,!1),t.removeEventListener("touchcancel",i,!1))};n._IOS_handleEvent=function(n,t){var i,u;if(n){n.__touch.preventDefault&&t.preventDefault&&t.preventDefault();for(var e=t.changedTouches,r=t.type,f=0,o=e.length;o>f;f++)i=e[f],u=i.identifier,i.target==n.canvas&&("touchstart"==r?this._handleStart(n,u,t,i.pageX,i.pageY):"touchmove"==r?this._handleMove(n,u,t,i.pageX,i.pageY):("touchend"==r||"touchcancel"==r)&&this._handleEnd(n,u,t))}};n._IE_enable=function(t){var r=t.canvas,i=t.__touch.f=function(i){n._IE_handleEvent(t,i)};void 0===window.navigator.pointerEnabled?(r.addEventListener("MSPointerDown",i,!1),window.addEventListener("MSPointerMove",i,!1),window.addEventListener("MSPointerUp",i,!1),window.addEventListener("MSPointerCancel",i,!1),t.__touch.preventDefault&&(r.style.msTouchAction="none")):(r.addEventListener("pointerdown",i,!1),window.addEventListener("pointermove",i,!1),window.addEventListener("pointerup",i,!1),window.addEventListener("pointercancel",i,!1),t.__touch.preventDefault&&(r.style.touchAction="none"));t.__touch.activeIDs={}};n._IE_disable=function(n){var t=n.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",t,!1),window.removeEventListener("MSPointerUp",t,!1),window.removeEventListener("MSPointerCancel",t,!1),n.canvas&&n.canvas.removeEventListener("MSPointerDown",t,!1)):(window.removeEventListener("pointermove",t,!1),window.removeEventListener("pointerup",t,!1),window.removeEventListener("pointercancel",t,!1),n.canvas&&n.canvas.removeEventListener("pointerdown",t,!1))};n._IE_handleEvent=function(n,t){if(n){n.__touch.preventDefault&&t.preventDefault&&t.preventDefault();var i=t.type,r=t.pointerId,u=n.__touch.activeIDs;if("MSPointerDown"==i||"pointerdown"==i){if(t.srcElement!=n.canvas)return;u[r]=!0;this._handleStart(n,r,t,t.pageX,t.pageY)}else u[r]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(n,r,t,t.pageX,t.pageY):("MSPointerUp"==i||"MSPointerCancel"==i||"pointerup"==i||"pointercancel"==i)&&(delete u[r],this._handleEnd(n,r,t)))}};n._handleStart=function(n,t,i,r,u){var f=n.__touch,e;(f.multitouch||!f.count)&&(e=f.pointers,e[t]||(e[t]=!0,f.count++,n._handlePointerDown(t,i,r,u)))};n._handleMove=function(n,t,i,r,u){n.__touch.pointers[t]&&n._handlePointerMove(t,i,r,u)};n._handleEnd=function(n,t,i){var r=n.__touch,u=r.pointers;u[t]&&(r.count--,n._handlePointerUp(t,i,!0),delete u[t])};createjs.Touch=n}();this.createjs=this.createjs||{},function(){"use strict";var n=createjs.EaselJS=createjs.EaselJS||{};n.version="0.8.0";n.buildDate="Thu, 11 Dec 2014 23:32:09 GMT"}();
/**
 * @license
 * pixi.js - v2.2.0
 * Copyright (c) 2012-2014, Mat Groves
 * http://goodboydigital.com/
 *
 * Compiled: 2014-12-12
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(){var i=this,n=n||{},t;n.WEBGL_RENDERER=0;n.CANVAS_RENDERER=1;n.VERSION="v2.2.0";n.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};n.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};n._UID=0;"undefined"!=typeof Float32Array?(n.Float32Array=Float32Array,n.Uint16Array=Uint16Array,n.Uint32Array=Uint32Array,n.ArrayBuffer=ArrayBuffer):(n.Float32Array=Array,n.Uint16Array=Array);n.INTERACTION_FREQUENCY=30;n.AUTO_PREVENT_DEFAULT=!0;n.PI_2=2*Math.PI;n.RAD_TO_DEG=180/Math.PI;n.DEG_TO_RAD=Math.PI/180;n.RETINA_PREFIX="@2x";n.dontSayHello=!1;n.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1};n.sayHello=function(t){if(!n.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+n.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+n.VERSION+" - http://www.pixijs.com/");n.dontSayHello=!0}};n.Point=function(n,t){this.x=n||0;this.y=t||0};n.Point.prototype.clone=function(){return new n.Point(this.x,this.y)};n.Point.prototype.set=function(n,t){this.x=n||0;this.y=t||(0!==t?this.x:0)};n.Point.prototype.constructor=n.Point;n.Rectangle=function(n,t,i,r){this.x=n||0;this.y=t||0;this.width=i||0;this.height=r||0};n.Rectangle.prototype.clone=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)};n.Rectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1};n.Rectangle.prototype.constructor=n.Rectangle;n.EmptyRectangle=new n.Rectangle(0,0,0,0);n.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof n.Point){for(var r=[],i=0,u=t.length;u>i;i++)r.push(t[i].x,t[i].y);t=r}this.closed=!0;this.points=t};n.Polygon.prototype.clone=function(){var t=this.points.slice();return new n.Polygon(t)};n.Polygon.prototype.contains=function(n,t){for(var r=!1,e=this.points.length/2,i=0,u=e-1;e>i;u=i++){var o=this.points[2*i],f=this.points[2*i+1],h=this.points[2*u],s=this.points[2*u+1],c=f>t!=s>t&&(h-o)*(t-f)/(s-f)+o>n;c&&(r=!r)}return r};n.Polygon.prototype.constructor=n.Polygon;n.Circle=function(n,t,i){this.x=n||0;this.y=t||0;this.radius=i||0};n.Circle.prototype.clone=function(){return new n.Circle(this.x,this.y,this.radius)};n.Circle.prototype.contains=function(n,t){if(this.radius<=0)return!1;var i=this.x-n,r=this.y-t,u=this.radius*this.radius;return i*=i,r*=r,u>=i+r};n.Circle.prototype.getBounds=function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)};n.Circle.prototype.constructor=n.Circle;n.Ellipse=function(n,t,i,r){this.x=n||0;this.y=t||0;this.width=i||0;this.height=r||0};n.Ellipse.prototype.clone=function(){return new n.Ellipse(this.x,this.y,this.width,this.height)};n.Ellipse.prototype.contains=function(n,t){if(this.width<=0||this.height<=0)return!1;var i=(n-this.x)/this.width,r=(t-this.y)/this.height;return i*=i,r*=r,1>=i+r};n.Ellipse.prototype.getBounds=function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};n.Ellipse.prototype.constructor=n.Ellipse;n.RoundedRectangle=function(n,t,i,r,u){this.x=n||0;this.y=t||0;this.width=i||0;this.height=r||0;this.radius=u||20};n.RoundedRectangle.prototype.clone=function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};n.RoundedRectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1};n.RoundedRectangle.prototype.constructor=n.RoundedRectangle;n.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};n.Matrix.prototype.fromArray=function(n){this.a=n[0];this.b=n[1];this.c=n[3];this.d=n[4];this.tx=n[2];this.ty=n[5]};n.Matrix.prototype.toArray=function(t){this.array||(this.array=new n.Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i};n.Matrix.prototype.apply=function(t,i){return i=i||new n.Point,i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i};n.Matrix.prototype.applyInverse=function(t,i){i=i||new n.Point;var r=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*r*t.x+-this.c*r*t.y+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*t.y+-this.b*r*t.x+(-this.ty*this.a+this.tx*this.b)*r,i};n.Matrix.prototype.translate=function(n,t){return this.tx+=n,this.ty+=t,this};n.Matrix.prototype.scale=function(n,t){return this.a*=n,this.d*=t,this.c*=n,this.b*=t,this.tx*=n,this.ty*=t,this};n.Matrix.prototype.rotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.a,u=this.c,f=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=u*t-this.d*i,this.d=u*i+this.d*t,this.tx=f*t-this.ty*i,this.ty=f*i+this.ty*t,this};n.Matrix.prototype.append=function(n){var t=this.a,i=this.b,r=this.c,u=this.d;return this.a=n.a*t+n.b*r,this.b=n.a*i+n.b*u,this.c=n.c*t+n.d*r,this.d=n.c*i+n.d*u,this.tx=n.tx*t+n.ty*r+this.tx,this.ty=n.tx*i+n.ty*u+this.ty,this};n.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};n.identityMatrix=new n.Matrix;n.DisplayObject=function(){this.position=new n.Point;this.scale=new n.Point(1,1);this.pivot=new n.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.buttonMode=!1;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new n.Matrix;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new n.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=!1;this._cacheIsDirty=!1};n.DisplayObject.prototype.constructor=n.DisplayObject;Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(n){this._interactive=n;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var n=this;do{if(!n.visible)return!1;n=n.parent}while(n);return!0}});Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1);this._mask=n;this._mask&&(this._mask.isMask=!0)}});Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);this._filterBlock={target:this,filterPasses:r}}this._filters=n}});Object.defineProperty(n.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}});n.DisplayObject.prototype.updateTransform=function(){var r,o,s,u,f,e,t=this.parent.worldTransform,i=this.worldTransform;this.rotation%n.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,o=this._sr*this.scale.x,s=-this._sr*this.scale.y,u=this._cr*this.scale.y,f=this.position.x,e=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*r+this.pivot.y*s,e-=this.pivot.x*o+this.pivot.y*u),i.a=r*t.a+o*t.c,i.b=r*t.b+o*t.d,i.c=s*t.a+u*t.c,i.d=s*t.b+u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty):(r=this.scale.x,u=this.scale.y,f=this.position.x-this.pivot.x*r,e=this.position.y-this.pivot.y*u,i.a=r*t.a,i.b=r*t.b,i.c=u*t.c,i.d=u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty);this.worldAlpha=this.alpha*this.parent.worldAlpha};n.DisplayObject.prototype.displayObjectUpdateTransform=n.DisplayObject.prototype.updateTransform;n.DisplayObject.prototype.getBounds=function(t){return t=t,n.EmptyRectangle};n.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(n.identityMatrix)};n.DisplayObject.prototype.setStageReference=function(n){this.stage=n;this._interactive&&(this.stage.dirty=!0)};n.DisplayObject.prototype.generateTexture=function(t,i,r){var u=this.getLocalBounds(),f=new n.RenderTexture(0|u.width,0|u.height,r,i,t);return n.DisplayObject._tempMatrix.tx=-u.x,n.DisplayObject._tempMatrix.ty=-u.y,f.render(this,n.DisplayObject._tempMatrix),f};n.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};n.DisplayObject.prototype.toGlobal=function(n){return this.displayObjectUpdateTransform(),this.worldTransform.apply(n)};n.DisplayObject.prototype.toLocal=function(n,t){return t&&(n=t.toGlobal(n)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(n)};n.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha;t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)};n.DisplayObject.prototype._generateCachedSprite=function(){var t,r,i;this._cacheAsBitmap=!1;t=this.getLocalBounds();this._cachedSprite?this._cachedSprite.texture.resize(0|t.width,0|t.height):(r=new n.RenderTexture(0|t.width,0|t.height),this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform);i=this._filters;this._filters=null;this._cachedSprite.filters=i;n.DisplayObject._tempMatrix.tx=-t.x;n.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,n.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=!0};n.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};n.DisplayObject.prototype._renderWebGL=function(n){n=n};n.DisplayObject.prototype._renderCanvas=function(n){n=n};n.DisplayObject._tempMatrix=new n.Matrix;Object.defineProperty(n.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.DisplayObjectContainer=function(){n.DisplayObject.call(this);this.children=[]};n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype);n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer;Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(n){var t=this.getLocalBounds().width;this.scale.x=0!==t?n/t:1;this._width=n}});Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(n){var t=this.getLocalBounds().height;this.scale.y=0!==t?n/t:1;this._height=n}});n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)};n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),this.stage&&n.setStageReference(this.stage),n;throw new Error(n+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);};n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.getChildIndex(n),r=this.getChildIndex(t);if(0>i||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t;this.children[r]=n}};n.DisplayObjectContainer.prototype.getChildIndex=function(n){var t=this.children.indexOf(n);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t};n.DisplayObjectContainer.prototype.setChildIndex=function(n,t){if(0>t||t>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(n);this.children.splice(i,1);this.children.splice(t,0,n)};n.DisplayObjectContainer.prototype.getChildAt=function(n){if(0>n||n>=this.children.length)throw new Error("getChildAt: Supplied index "+n+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[n]};n.DisplayObjectContainer.prototype.removeChild=function(n){var t=this.children.indexOf(n);if(-1!==t)return this.removeChildAt(t)};n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(n,1),t};n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var e=n||0,o="number"==typeof t?t:this.children.length,i=o-e,r,u,f;if(i>0&&o>=i){for(r=this.children.splice(e,i),u=0;u<r.length;u++)f=r[u],this.stage&&f.removeStageReference(),f.parent=void 0;return r}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range");};n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var n=0,t=this.children.length;t>n;n++)this.children[n].updateTransform()};n.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=n.DisplayObjectContainer.prototype.updateTransform;n.DisplayObjectContainer.prototype.getBounds=function(){var l,i;if(0===this.children.length)return n.EmptyRectangle;for(var t,s,h,r=1/0,u=1/0,f=-1/0,e=-1/0,c=!1,o=0,a=this.children.length;a>o;o++)l=this.children[o],l.visible&&(c=!0,t=this.children[o].getBounds(),r=r<t.x?r:t.x,u=u<t.y?u:t.y,s=t.width+t.x,h=t.height+t.y,f=f>s?f:s,e=e>h?e:h);return c?(i=this._bounds,i.x=r,i.y=u,i.width=f-r,i.height=e-u,i):n.EmptyRectangle};n.DisplayObjectContainer.prototype.getLocalBounds=function(){var u=this.worldTransform,t,i,r;for(this.worldTransform=n.identityMatrix,t=0,i=this.children.length;i>t;t++)this.children[t].updateTransform();return r=this.getBounds(),this.worldTransform=u,r};n.DisplayObjectContainer.prototype.setStageReference=function(n){var t,i,r;for(this.stage=n,this._interactive&&(this.stage.dirty=!0),t=0,i=this.children.length;i>t;t++)r=this.children[t],r.setStageReference(n)};n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var i,n=0,t=this.children.length;t>n;n++)i=this.children[n],i.removeStageReference();this._interactive&&(this.stage.dirty=!0);this.stage=null};n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return this._renderCachedSprite(n),void 0;var t,i;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();n.spriteBatch.start()}else for(t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n)}};n.DisplayObjectContainer.prototype._renderCanvas=function(n){var t,i,r;if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(n),void 0;for(this._mask&&n.maskManager.pushMask(this._mask,n),t=0,i=this.children.length;i>t;t++)r=this.children[t],r._renderCanvas(n);this._mask&&n.maskManager.popMask(n)}};n.Sprite=function(t){n.DisplayObjectContainer.call(this);this.anchor=new n.Point;this.texture=t||n.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL;this.shader=null;this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this));this.renderable=!0};n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Sprite.prototype.constructor=n.Sprite;Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Sprite.prototype.setTexture=function(n){this.texture=n;this.cachedTint=16777215};n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)};n.Sprite.prototype.getBounds=function(n){var ut=this.texture.frame.width,ft=this.texture.frame.height,l=ut*(1-this.anchor.x),a=ut*-this.anchor.x,v=ft*(1-this.anchor.y),y=ft*-this.anchor.y,s=n||this.worldTransform,f=s.a,p=s.b,w=s.c,e=s.d,h=s.tx,c=s.ty,r=-1/0,u=-1/0,t=1/0,i=1/0,o;if(0===p&&0===w)0>f&&(f*=-1),0>e&&(e*=-1),t=f*a+h,r=f*l+h,i=e*y+c,u=e*v+c;else{var b=f*a+w*y+h,k=e*y+p*a+c,d=f*l+w*y+h,g=e*y+p*l+c,nt=f*l+w*v+h,tt=e*v+p*l+c,it=f*a+w*v+h,rt=e*v+p*a+c;t=t>b?b:t;t=t>d?d:t;t=t>nt?nt:t;t=t>it?it:t;i=i>k?k:i;i=i>g?g:i;i=i>tt?tt:i;i=i>rt?rt:i;r=b>r?b:r;r=d>r?d:r;r=nt>r?nt:r;r=it>r?it:r;u=k>u?k:u;u=g>u?g:u;u=tt>u?tt:u;u=rt>u?rt:u}return o=this._bounds,o.x=t,o.width=r-t,o.y=i,o.height=u-i,this._currentBounds=o,o};n.Sprite.prototype._renderWebGL=function(n){var t,r,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){for(i=n.spriteBatch,this._filters&&(i.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),n.maskManager.pushMask(this.mask,n),i.start()),i.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n);i.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();i.start()}else for(n.spriteBatch.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n)};n.Sprite.prototype._renderCanvas=function(t){var i,r,u,f,e;if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){for((this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid)&&(i=this.texture.baseTexture.resolution/t.resolution,t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR),r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),r=0|r,u=0|u):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)),f=0,e=this.children.length;e>f;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};n.Sprite.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new n.Sprite(i)};n.Sprite.fromImage=function(t,i,r){var u=n.Texture.fromImage(t,i,r);return new n.Sprite(u)};n.SpriteBatch=function(t){n.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=!1};n.SpriteBatch.prototype=Object.create(n.DisplayObjectContainer.prototype);n.SpriteBatch.prototype.constructor=n.SpriteBatch;n.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new n.WebGLFastSpriteBatch(t);this.ready=!0};n.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())};n.SpriteBatch.prototype._renderCanvas=function(n){var u,t,o,i,r;if(this.visible&&!(this.alpha<=0)&&this.children.length){u=n.context;u.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var f=this.worldTransform,e=!0,s=0;s<this.children.length;s++)t=this.children[s],t.visible&&(o=t.texture,i=o.frame,(u.globalAlpha=this.worldAlpha*t.alpha,t.rotation%(2*Math.PI)==0)?(e&&(u.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e=!1),u.drawImage(o.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width*t.scale.x+t.position.x+.5|0,t.anchor.y*-i.height*t.scale.y+t.position.y+.5|0,i.width*t.scale.x,i.height*t.scale.y)):(e||(e=!0),t.displayObjectUpdateTransform(),r=t.worldTransform,n.roundPixels?u.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):u.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),u.drawImage(o.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width+.5|0,t.anchor.y*-i.height+.5|0,i.width,i.height)))}};n.MovieClip=function(t){n.Sprite.call(this,t[0]);this.textures=t;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this.currentFrame=0;this.playing=!1};n.MovieClip.prototype=Object.create(n.Sprite.prototype);n.MovieClip.prototype.constructor=n.MovieClip;Object.defineProperty(n.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}});n.MovieClip.prototype.stop=function(){this.playing=!1};n.MovieClip.prototype.play=function(){this.playing=!0};n.MovieClip.prototype.gotoAndStop=function(n){this.playing=!1;this.currentFrame=n;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])};n.MovieClip.prototype.gotoAndPlay=function(n){this.currentFrame=n;this.playing=!0};n.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var n=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length;this.loop||n<this.textures.length?this.setTexture(this.textures[n%this.textures.length]):n>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}};n.MovieClip.fromFrames=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromFrame(t[i]));return new n.MovieClip(r)};n.MovieClip.fromImages=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromImage(t[i]));return new n.MovieClip(r)};n.FilterBlock=function(){this.visible=!0;this.renderable=!0};n.FilterBlock.prototype.constructor=n.FilterBlock;n.Text=function(t,i){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;n.Sprite.call(this,n.Texture.fromCanvas(this.canvas));this.setText(t);this.setStyle(i)};n.Text.prototype=Object.create(n.Sprite.prototype);n.Text.prototype.constructor=n.Text;Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;n.dropShadow=n.dropShadow||!1;n.dropShadowAngle=n.dropShadowAngle||Math.PI/6;n.dropShadowDistance=n.dropShadowDistance||4;n.dropShadowColor=n.dropShadowColor||"black";this.style=n;this.dirty=!0};n.Text.prototype.setText=function(n){this.text=n.toString()||" ";this.dirty=!0};n.Text.prototype.updateText=function(){var o,h,c,e,l,t,f,a,v;this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;o=this.text;this.style.wordWrap&&(o=this.wordWrap(this.text));for(var i=o.split(/(?:\r\n|\r|\n)/),u=[],r=0,s=this.determineFontProperties(this.style.font),n=0;n<i.length;n++)h=this.context.measureText(i[n]).width,u[n]=h,r=Math.max(r,h);if(c=r+this.style.strokeThickness,this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.width=(c+this.context.lineWidth)*this.resolution,e=s.fontSize+this.style.strokeThickness,l=e*i.length,this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.style.dropShadow)for(this.context.fillStyle=this.style.dropShadowColor,a=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,v=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.fill&&this.context.fillText(i[n],t+a,f+v);for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t,f),this.style.fill&&this.context.fillText(i[n],t,f);this.updateTexture()};n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};n.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1);n.Sprite.prototype._renderWebGL.call(this,t)};n.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1);n.Sprite.prototype._renderCanvas.call(this,t)};n.Text.prototype.determineFontProperties=function(t){var r=n.Text.fontPropertiesCache[t],a,i;if(!r){r={};a=n.Text.fontPropertiesCanvas;i=n.Text.fontPropertiesContext;i.font=t;var c=Math.ceil(i.measureText("|Mq").width),u=Math.ceil(i.measureText("M").width),l=2*u;u=1.4*u|0;a.width=c;a.height=l;i.fillStyle="#f00";i.fillRect(0,0,c,l);i.font=t;i.textBaseline="alphabetic";i.fillStyle="#000";i.fillText("|MÉq",0,u);for(var e,v=i.getImageData(0,0,c,l).data,y=v.length,o=4*c,s=0,h=!1,f=0;u>f;f++){for(e=0;o>e;e+=4)if(255!==v[s+e]){h=!0;break}if(h)break;s+=o}for(r.ascent=u-f,s=y-o,h=!1,f=l;f>u;f--){for(e=0;o>e;e+=4)if(255!==v[s+e]){h=!0;break}if(h)break;s-=o}r.descent=f-u;r.descent+=6;r.fontSize=r.ascent+r.descent;n.Text.fontPropertiesCache[t]=r}return r};n.Text.prototype.wordWrap=function(n){for(var o,s,i="",f=n.split("\n"),r=0;r<f.length;r++){for(var e=this.style.wordWrapWidth,u=f[r].split(" "),t=0;t<u.length;t++)o=this.context.measureText(u[t]).width,s=o+this.context.measureText(" ").width,0===t||s>e?(t>0&&(i+="\n"),i+=u[t],e=this.style.wordWrapWidth-o):(e-=s,i+=" "+u[t]);r<f.length-1&&(i+="\n")}return i};n.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.getBounds.call(this,t)};n.Text.prototype.destroy=function(n){this.context=null;this.canvas=null;this.texture.destroy(void 0===n?!0:n)};n.Text.fontPropertiesCache={};n.Text.fontPropertiesCanvas=document.createElement("canvas");n.Text.fontPropertiesContext=n.Text.fontPropertiesCanvas.getContext("2d");n.BitmapText=function(t,i){n.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this._pool=[];this.setText(t);this.setStyle(i);this.updateText();this.dirty=!1};n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.BitmapText.prototype.setText=function(n){this.text=n||" ";this.dirty=!0};n.BitmapText.prototype.setStyle=function(t){t=t||{};t.align=t.align||"left";this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1];this.fontSize=i.length>=2?parseInt(i[i.length-2],10):n.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=t.tint};n.BitmapText.prototype.updateText=function(){for(var l,u,y,a,r,p,h=n.BitmapText.fonts[this.fontName],i=new n.Point,o=null,f=[],e=0,c=[],v=0,s=this.fontSize/h.size,t=0;t<this.text.length;t++)l=this.text.charCodeAt(t),/(?:\r\n|\r|\n)/.test(this.text.charAt(t))?(c.push(i.x),e=Math.max(e,i.x),v++,i.x=0,i.y+=h.lineHeight,o=null):(u=h.chars[l],u&&(o&&u.kerning[o]&&(i.x+=u.kerning[o]),f.push({texture:u.texture,line:v,charCode:l,position:new n.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,o=l));for(c.push(i.x),e=Math.max(e,i.x),y=[],t=0;v>=t;t++)a=0,"right"===this.style.align?a=e-c[t]:"center"===this.style.align&&(a=(e-c[t])/2),y.push(a);var b=this.children.length,w=f.length,k=this.tint||16777215;for(t=0;w>t;t++)r=b>t?this.children[t]:this._pool.pop(),r?r.setTexture(f[t].texture):r=new n.Sprite(f[t].texture),r.position.x=(f[t].position.x+y[f[t].line])*s,r.position.y=f[t].position.y*s,r.scale.x=r.scale.y=s,r.tint=k,r.parent||this.addChild(r);for(;this.children.length>w;)p=this.getChildAt(this.children.length-1),this._pool.push(p),this.removeChild(p);this.textWidth=e*s;this.textHeight=(i.y+h.lineHeight)*s};n.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);n.DisplayObjectContainer.prototype.updateTransform.call(this)};n.BitmapText.fonts={};n.InteractionData=function(){this.global=new n.Point;this.target=null;this.originalEvent=null};n.InteractionData.prototype.getLocalPosition=function(t,i){var r=t.worldTransform,f=this.global,e=r.a,o=r.c,c=r.tx,s=r.b,h=r.d,l=r.ty,u=1/(e*h+o*-s);return i=i||new n.Point,i.x=h*u*f.x+-o*u*f.y+(l*o-c*h)*u,i.y=e*u*f.y+-s*u*f.x+(-l*e+c*s)*u,i};n.InteractionData.prototype.constructor=n.InteractionData;n.InteractionManager=function(t){this.stage=t;this.mouse=new n.InteractionData;this.touches={};this.tempPoint=new n.Point;this.mouseoverEnabled=!0;this.pool=[];this.interactiveItems=[];this.interactionDOMElement=null;this.onMouseMove=this.onMouseMove.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseOut=this.onMouseOut.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this.mouseOut=!1;this.resolution=1;this._tempPoint=new n.Point};n.InteractionManager.prototype.constructor=n.InteractionManager;n.InteractionManager.prototype.collectInteractiveSprite=function(n,t){for(var i,u=n.children,f=u.length,r=f-1;r>=0;r--)i=u[r],i._interactive?(t.interactiveChildren=!0,this.interactiveItems.push(i),i.children.length>0&&this.collectInteractiveSprite(i,i)):(i.__iParent=null,i.children.length>0&&this.collectInteractiveSprite(i,t))};n.InteractionManager.prototype.setTarget=function(n){this.target=n;this.resolution=n.resolution;null===this.interactionDOMElement&&this.setTargetDomElement(n.view)};n.InteractionManager.prototype.setTargetDomElement=function(n){this.removeEvents();window.navigator.msPointerEnabled&&(n.style["-ms-content-zooming"]="none",n.style["-ms-touch-action"]="none");this.interactionDOMElement=n;n.addEventListener("mousemove",this.onMouseMove,!0);n.addEventListener("mousedown",this.onMouseDown,!0);n.addEventListener("mouseout",this.onMouseOut,!0);n.addEventListener("touchstart",this.onTouchStart,!0);n.addEventListener("touchend",this.onTouchEnd,!0);n.addEventListener("touchmove",this.onTouchMove,!0);window.addEventListener("mouseup",this.onMouseUp,!0)};n.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))};n.InteractionManager.prototype.update=function(){var f,r,i,t;if(this.target&&(f=Date.now(),r=f-this.last,r=r*n.INTERACTION_FREQUENCY/1e3,!(1>r))){this.last=f;i=0;this.dirty&&this.rebuildInteractiveGraph();var o=this.interactiveItems.length,u="inherit",e=!1;for(i=0;o>i;i++)t=this.interactiveItems[i],t.__hit=this.hitTest(t,this.mouse),this.mouse.target=t,t.__hit&&!e?(t.buttonMode&&(u=t.defaultCursor),t.interactiveChildren||(e=!0),t.__isOver||(t.mouseover&&t.mouseover(this.mouse),t.__isOver=!0)):t.__isOver&&(t.mouseout&&t.mouseout(this.mouse),t.__isOver=!1);this.currentCursorStyle!==u&&(this.currentCursorStyle=u,this.interactionDOMElement.style.cursor=u)}};n.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,n=0;t>n;n++)this.interactiveItems[n].interactiveChildren=!1;this.interactiveItems=[];this.stage.interactive&&this.interactiveItems.push(this.stage);this.collectInteractiveSprite(this.stage,this.stage)};n.InteractionManager.prototype.onMouseMove=function(n){var t,u,i,r;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n,t=this.interactionDOMElement.getBoundingClientRect(),this.mouse.global.x=(n.clientX-t.left)*(this.target.width/t.width)/this.resolution,this.mouse.global.y=(n.clientY-t.top)*(this.target.height/t.height)/this.resolution,u=this.interactiveItems.length,i=0;u>i;i++)r=this.interactiveItems[i],r.mousemove&&r.mousemove(this.mouse)};n.InteractionManager.prototype.onMouseDown=function(t){var i;this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=t;n.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var o=this.interactiveItems.length,e=this.mouse.originalEvent,r=2===e.button||3===e.which,u=r?"rightdown":"mousedown",s=r?"rightclick":"click",h=r?"__rightIsDown":"__mouseIsDown",c=r?"__isRightDown":"__isDown",f=0;o>f;f++)if(i=this.interactiveItems[f],(i[u]||i[s])&&(i[h]=!0,i.__hit=this.hitTest(i,this.mouse),i.__hit&&(i[u]&&i[u](this.mouse),i[c]=!0,!i.interactiveChildren)))break};n.InteractionManager.prototype.onMouseOut=function(n){var r,i,t;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n,r=this.interactiveItems.length,this.interactionDOMElement.style.cursor="inherit",i=0;r>i;i++)t=this.interactiveItems[i],t.__isOver&&(this.mouse.target=t,t.mouseout&&t.mouseout(this.mouse),t.__isOver=!1);this.mouseOut=!0;this.mouse.global.x=-1e4;this.mouse.global.y=-1e4};n.InteractionManager.prototype.onMouseUp=function(n){var t;this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=n;for(var c=this.interactiveItems.length,s=!1,h=this.mouse.originalEvent,i=2===h.button||3===h.which,r=i?"rightup":"mouseup",u=i?"rightclick":"click",f=i?"rightupoutside":"mouseupoutside",e=i?"__isRightDown":"__isDown",o=0;c>o;o++)t=this.interactiveItems[o],(t[u]||t[r]||t[f])&&(t.__hit=this.hitTest(t,this.mouse),t.__hit&&!s?(t[r]&&t[r](this.mouse),t[e]&&t[u]&&t[u](this.mouse),t.interactiveChildren||(s=!0)):t[e]&&t[f]&&t[f](this.mouse),t[e]=!1)};n.InteractionManager.prototype.hitTest=function(t,i){var p=i.global,r,u,f,s,e,a,v,y;if(!t.worldVisible)return!1;if(t.worldTransform.applyInverse(p,this._tempPoint),u=this._tempPoint.x,f=this._tempPoint.y,i.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(u,f);if(t instanceof n.Sprite){var o,h=t.texture.frame.width,c=t.texture.frame.height,l=-h*t.anchor.x;if(u>l&&l+h>u&&(o=-c*t.anchor.y,f>o&&o+c>f))return!0}else if(t instanceof n.Graphics)for(s=t.graphicsData,r=0;r<s.length;r++)if(e=s[r],e.fill&&e.shape&&e.shape.contains(u,f))return!0;for(a=t.children.length,r=0;a>r;r++)if(v=t.children[r],y=this.hitTest(v,i),y)return i.target=t,!0;return!1};n.InteractionManager.prototype.onTouchMove=function(n){var i,e,u;this.dirty&&this.rebuildInteractiveGraph();for(var t,r=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,f=0,f=0;f<o.length;f++)for(i=o[f],t=this.touches[i.identifier],t.originalEvent=n,t.global.x=(i.clientX-r.left)*(this.target.width/r.width)/this.resolution,t.global.y=(i.clientY-r.top)*(this.target.height/r.height)/this.resolution,!navigator.isCocoonJS||r.left||r.top||n.target.style.width||n.target.style.height||(t.global.x=i.clientX,t.global.y=i.clientY),e=0;e<this.interactiveItems.length;e++)u=this.interactiveItems[e],u.touchmove&&u.__touchData&&u.__touchData[i.identifier]&&u.touchmove(t)};n.InteractionManager.prototype.onTouchStart=function(t){var u,s,e,f,r,h,o,i;for(this.dirty&&this.rebuildInteractiveGraph(),u=this.interactionDOMElement.getBoundingClientRect(),n.AUTO_PREVENT_DEFAULT&&t.preventDefault(),s=t.changedTouches,e=0;e<s.length;e++)for(f=s[e],r=this.pool.pop(),r||(r=new n.InteractionData),r.originalEvent=t,this.touches[f.identifier]=r,r.global.x=(f.clientX-u.left)*(this.target.width/u.width)/this.resolution,r.global.y=(f.clientY-u.top)*(this.target.height/u.height)/this.resolution,!navigator.isCocoonJS||u.left||u.top||t.target.style.width||t.target.style.height||(r.global.x=f.clientX,r.global.y=f.clientY),h=this.interactiveItems.length,o=0;h>o;o++)if(i=this.interactiveItems[o],(i.touchstart||i.tap)&&(i.__hit=this.hitTest(i,r),i.__hit&&(i.touchstart&&i.touchstart(r),i.__isDown=!0,i.__touchData=i.__touchData||{},i.__touchData[f.identifier]=r,!i.interactiveChildren)))break};n.InteractionManager.prototype.onTouchEnd=function(n){var h,f,t;this.dirty&&this.rebuildInteractiveGraph();for(var u=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,e=0;e<o.length;e++){var i=o[e],r=this.touches[i.identifier],s=!1;for(r.global.x=(i.clientX-u.left)*(this.target.width/u.width)/this.resolution,r.global.y=(i.clientY-u.top)*(this.target.height/u.height)/this.resolution,!navigator.isCocoonJS||u.left||u.top||n.target.style.width||n.target.style.height||(r.global.x=i.clientX,r.global.y=i.clientY),h=this.interactiveItems.length,f=0;h>f;f++)t=this.interactiveItems[f],t.__touchData&&t.__touchData[i.identifier]&&(t.__hit=this.hitTest(t,t.__touchData[i.identifier]),r.originalEvent=n,(t.touchend||t.tap)&&(t.__hit&&!s?(t.touchend&&t.touchend(r),t.__isDown&&t.tap&&t.tap(r),t.interactiveChildren||(s=!0)):t.__isDown&&t.touchendoutside&&t.touchendoutside(r),t.__isDown=!1),t.__touchData[i.identifier]=null);this.pool.push(r);this.touches[i.identifier]=null}};n.Stage=function(t){n.DisplayObjectContainer.call(this);this.worldTransform=new n.Matrix;this.interactive=!0;this.interactionManager=new n.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5);this.setBackgroundColor(t)};n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.setInteractionDelegate=function(n){this.interactionManager.setTargetDomElement(n)};n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0,t=this.children.length;t>n;n++)this.children[n].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()};n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0;this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i;this.backgroundColorString="#"+i};n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(n){for(var r=0,i=["ms","moz","webkit","o"],t=0;t<i.length&&!n.requestAnimationFrame;++t)n.requestAnimationFrame=n[i[t]+"RequestAnimationFrame"],n.cancelAnimationFrame=n[i[t]+"CancelAnimationFrame"]||n[i[t]+"CancelRequestAnimationFrame"];n.requestAnimationFrame||(n.requestAnimationFrame=function(t){var i=(new Date).getTime(),u=Math.max(0,16-(i-r)),f=n.setTimeout(function(){t(i+u)},u);return r=i+u,f});n.cancelAnimationFrame||(n.cancelAnimationFrame=function(n){clearTimeout(n)});n.requestAnimFrame=n.requestAnimationFrame}(this);n.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(255&n)/255]};n.rgb2hex=function(n){return(255*n[0]<<16)+(255*n[1]<<8)+255*n[2]};"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(n){function i(){for(var t=arguments.length,f=new Array(t);t--;)f[t]=arguments[t];return f=u.concat(f),r.apply(this instanceof i?this:n,f)}var r=this,t=arguments.length-1,u=[];if(t>0)for(u.length=t;t--;)u[t]=arguments[t+1];if("function"!=typeof r)throw new TypeError;return i.prototype=function f(n){return n&&(f.prototype=n),this instanceof f?void 0:new f}(r.prototype),i}}());n.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],n;if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(n=0;n<t.length;n++)try{return new window.ActiveXObject(t[n])}catch(i){}};n.canUseNewCanvasBlendModes=function(){var t,n;return"undefined"==typeof document?!1:(t=document.createElement("canvas"),t.width=1,t.height=1,n=t.getContext("2d"),n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply",n.fillStyle="#fff",n.fillRect(0,0,1,1),0===n.getImageData(0,0,1,1).data[0])};n.getNextPowerOfTwo=function(n){if(n>0&&0==(n&n-1))return n;for(var t=1;n>t;)t<<=1;return t};n.isPowerOfTwo=function(n,t){return n>0&&0==(n&n-1)&&t>0&&0==(t&t-1)};n.EventTarget={call:function(t){t&&(t=t.prototype||t,n.EventTarget.mixin(t))},mixin:function(t){t.listeners=function(n){return this._listeners=this._listeners||{},this._listeners[n]?this._listeners[n].slice():[]};t.emit=t.dispatchEvent=function(t,i){if(this._listeners=this._listeners||{},"object"==typeof t&&(i=t,t=t.type),i&&i.__isEventObject===!0||(i=new n.Event(this,t,i)),this._listeners&&this._listeners[t]){for(var u=this._listeners[t].slice(0),e=u.length,f=u[0],r=0;e>r;f=u[++r])if(f.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i),this};t.on=t.addEventListener=function(n,t){return this._listeners=this._listeners||{},(this._listeners[n]=this._listeners[n]||[]).push(t),this};t.once=function(n,t){function i(){t.apply(r.off(n,i),arguments)}this._listeners=this._listeners||{};var r=this;return i._originalHandler=t,this.on(n,i)};t.off=t.removeEventListener=function(n,t){if(this._listeners=this._listeners||{},!this._listeners[n])return this;for(var i=this._listeners[n],r=t?i.length:0;r-->0;)(i[r]===t||i[r]._originalHandler===t)&&i.splice(r,1);return 0===i.length&&delete this._listeners[n],this};t.removeAllListeners=function(n){return this._listeners=this._listeners||{},this._listeners[n]?(delete this._listeners[n],this):this}}};n.Event=function(n,t,i){this.__isEventObject=!0;this.stopped=!1;this.stoppedImmediate=!1;this.target=n;this.type=t;this.data=i;this.content=i;this.timeStamp=Date.now()};n.Event.prototype.stopPropagation=function(){this.stopped=!0};n.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0};n.autoDetectRenderer=function(t,i,r){t||(t=800);i||(i=600);var u=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();return u?new n.WebGLRenderer(t,i,r):new n.CanvasRenderer(t,i,r)};n.autoDetectRecommendedRenderer=function(t,i,r){t||(t=800);i||(i=600);var u=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}(),f=/Android/i.test(navigator.userAgent);return u&&!f?new n.WebGLRenderer(t,i,r):new n.CanvasRenderer(t,i,r)};n.PolyK={};n.PolyK.Triangulate=function(t){var a=!0,e=t.length>>1,u,l,f;if(3>e)return[];for(var o=[],r=[],i=0;e>i;i++)r.push(i);for(i=0,u=e;u>3;){var s=r[(i+0)%u],h=r[(i+1)%u],c=r[(i+2)%u],y=t[2*s],p=t[2*s+1],w=t[2*h],b=t[2*h+1],k=t[2*c],d=t[2*c+1],v=!1;if(n.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,l=0;u>l;l++)if(f=r[l],f!==s&&f!==h&&f!==c&&n.PolyK._PointInTriangle(t[2*f],t[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)o.push(s,h,c),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u){if(!a)return null;for(o=[],r=[],i=0;e>i;i++)r.push(i);i=0;u=e;a=!1}}return o.push(r[0],r[1],r[2]),o};n.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&1>g+nt};n.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e};n.initDefaultShaders=function(){};n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)};n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)};n._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return n.shaderSource(r,u),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(window.console.log(n.getShaderInfoLog(r)),null)};n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),u};n.PixiShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=!0;this.dirty=!0;this.attributes=[];this.init()};n.PixiShader.prototype.constructor=n.PixiShader;n.PixiShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),r;t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms();this.program=i};n.PixiShader.prototype.initUniforms=function(){var t,i,r,n;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=i.uniformMatrix2fv:"mat3"===n?t.glFunc=i.uniformMatrix3fv:"mat4"===n&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)};n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount);n._init=!0;this.textureCount++}};n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?n.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))};n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];n.PixiFastShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};n.PixiFastShader.prototype.constructor=n.PixiFastShader;n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.uMatrix=t.getUniformLocation(i,"uMatrix");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord");this.aScale=t.getAttribLocation(i,"aScale");this.aRotation=t.getAttribLocation(i,"aRotation");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=i};n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.StripShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};n.StripShader.prototype.constructor=n.StripShader;n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.PrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};n.PrimitiveShader.prototype.constructor=n.PrimitiveShader;n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.colorAttribute=t.getAttribLocation(i,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.ComplexPrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};n.ComplexPrimitiveShader.prototype.constructor=n.ComplexPrimitiveShader;n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.color=t.getUniformLocation(i,"color");this.flipY=t.getUniformLocation(i,"flipY");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.WebGLGraphics=function(){};n.WebGLGraphics.renderGraphics=function(t,i){var f,r=i.gl,s=i.projection,h=i.offset,u=i.shaderManager.primitiveShader,o,e;for(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),o=t._webGL[r.id],e=0;e<o.data.length;e++)1===o.data[e].mode?(f=o.data[e],i.stencilManager.pushStencil(t,f,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(f.indices.length-4)),i.stencilManager.popStencil(t,f,i)):(f=o.data[e],i.shaderManager.setShader(u),u=i.shaderManager.primitiveShader,r.uniformMatrix3fv(u.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(u.flipY,1),r.uniform2f(u.projectionVector,s.x,-s.y),r.uniform2f(u.offsetVector,-h.x,-h.y),r.uniform3fv(u.tintColor,n.hex2rgb(t.tint)),r.uniform1f(u.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,f.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,f.indices.length,r.UNSIGNED_SHORT,0))};n.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r,s;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),n.WebGLGraphics.graphicsDataPool.push(o);u.data=[];u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.Graphics.POLY?((r.points=r.shape.points.slice(),r.shape.closed&&(r.points[0]!==r.points[r.points.length-2]||r.points[1]!==r.points[r.points.length-1])&&r.points.push(r.points[0],r.points[1]),r.fill&&r.points.length>=6)&&(r.points.length<12?(f=n.WebGLGraphics.switchMode(u,0),s=n.WebGLGraphics.buildPoly(r,f),s||(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))):(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))),r.lineWidth>0&&(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildLine(r,f))):(f=n.WebGLGraphics.switchMode(u,0),r.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(r,f):r.type===n.Graphics.CIRC||r.type===n.Graphics.ELIP?n.WebGLGraphics.buildCircle(r,f):r.type===n.Graphics.RREC&&n.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()};n.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||1===i)&&(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r};n.WebGLGraphics.buildRectangle=function(t,i){var s=t.shape,r=s.x,u=s.y,h=s.width,c=s.height,p;if(t.fill){var y=n.hex2rgb(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u);f.push(l,a,v,e);f.push(r+h,u);f.push(l,a,v,e);f.push(r,u+c);f.push(l,a,v,e);f.push(r+h,u+c);f.push(l,a,v,e);w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],n.WebGLGraphics.buildLine(t,i),t.points=p)};n.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.shape,u=l.x,f=l.y,s=l.width,h=l.height,o=l.radius,r=[],b;if(r.push(u,f+o),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.hex2rgb(t.fillColor),y=t.fillAlpha,k=p[0]*y,d=p[1]*y,g=p[2]*y,w=i.points,a=i.indices,v=w.length/6,c=n.PolyK.Triangulate(r),e=0,e=0;e<c.length;e+=3)a.push(c[e]+v),a.push(c[e]+v),a.push(c[e+1]+v),a.push(c[e+2]+v),a.push(c[e+2]+v);for(e=0;e<r.length;e++)w.push(r[e],r[++e],k,d,g,y)}t.lineWidth&&(b=t.points,t.points=r,n.WebGLGraphics.buildLine(t,i),t.points=b)};n.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var h,c,l,a,v,y,p=20,w=[],e=0,s=0;p>=s;s++)e=s/p,h=o(n,i,e),c=o(t,r,e),l=o(i,u,e),a=o(r,f,e),v=o(h,l,e),y=o(c,a,e),w.push(v,y);return w};n.WebGLGraphics.buildCircle=function(t,i){var e,o,u=t.shape,c=u.x,l=u.y,d;t.type===n.Graphics.CIRC?(e=u.radius,o=u.radius):(e=u.width,o=u.height);var a=40,s=2*Math.PI/a,r=0;if(t.fill){var v=n.hex2rgb(t.fillColor),f=t.fillAlpha,w=v[0]*f,b=v[1]*f,k=v[2]*f,y=i.points,p=i.indices,h=y.length/6;for(p.push(h),r=0;a+1>r;r++)y.push(c,l,w,b,k,f),y.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o,w,b,k,f),p.push(h++,h++);p.push(h-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;a+1>r;r++)t.points.push(c+Math.sin(s*r)*e,l+Math.cos(s*r)*o);n.WebGLGraphics.buildLine(t,i);t.points=d}};n.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,g,ht,ct;if(0!==r.length){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new n.Point(r[0],r[1]);g=new n.Point(r[r.length-2],r[r.length-1]);it.x===g.x&&it.y===g.y&&(r=r.slice(),r.pop(),r.pop(),g=new n.Point(r[r.length-2],r[r.length-1]),ht=g.x+.5*(it.x-g.x),ct=g.y+.5*(it.y-g.y),r.unshift(ht,ct),r.push(ht,ct));var rt,ut,p,w,e,o,ot,st,u,f,b,k,nt,tt,lt,at,vt,yt,pt,wt,ft,gt,c,s=i.points,bt=i.indices,et=r.length/2,ni=r.length,kt=s.length/6,d=t.lineWidth/2,dt=n.hex2rgb(t.lineColor),l=t.lineAlpha,a=dt[0]*l,v=dt[1]*l,y=dt[2]*l;for(p=r[0],w=r[1],e=r[2],o=r[3],u=-(w-o),f=p-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=d,f*=d,s.push(p-u,w-f,a,v,y,l),s.push(p+u,w+f,a,v,y,l),h=1;et-1>h;h++)p=r[2*(h-1)],w=r[2*(h-1)+1],e=r[2*h],o=r[2*h+1],ot=r[2*(h+1)],st=r[2*(h+1)+1],u=-(w-o),f=p-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=d,f*=d,b=-(o-st),k=e-ot,c=Math.sqrt(b*b+k*k),b/=c,k/=c,b*=d,k*=d,lt=-f+w-(-f+o),at=-u+e-(-u+p),vt=(-u+p)*(-f+o)-(-u+e)*(-f+w),yt=-k+st-(-k+o),pt=-b+e-(-b+ot),wt=(-b+ot)*(-k+o)-(-b+e)*(-k+st),ft=lt*pt-yt*at,Math.abs(ft)<.1?(ft+=10.1,s.push(e-u,o-f,a,v,y,l),s.push(e+u,o+f,a,v,y,l)):(rt=(at*wt-pt*vt)/ft,ut=(yt*vt-lt*wt)/ft,gt=(rt-e)*(rt-e)+(ut-o)+(ut-o),gt>19600?(nt=u-b,tt=f-k,c=Math.sqrt(nt*nt+tt*tt),nt/=c,tt/=c,nt*=d,tt*=d,s.push(e-nt,o-tt),s.push(a,v,y,l),s.push(e+nt,o+tt),s.push(a,v,y,l),s.push(e-nt,o-tt),s.push(a,v,y,l),ni++):(s.push(rt,ut),s.push(a,v,y,l),s.push(e-(rt-e),o-(ut-o)),s.push(a,v,y,l)));for(p=r[2*(et-2)],w=r[2*(et-2)+1],e=r[2*(et-1)],o=r[2*(et-1)+1],u=-(w-o),f=p-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=d,f*=d,s.push(e-u,o-f),s.push(a,v,y,l),s.push(e+u,o+f),s.push(a,v,y,l),bt.push(kt),h=0;ni>h;h++)bt.push(kt++);bt.push(kt-1)}};n.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,a;if(!(u.length<6)){l=i.indices;i.points=u;i.alpha=t.fillAlpha;i.color=n.hex2rgb(t.fillColor);for(var f,e,o=1/0,s=-1/0,h=1/0,c=-1/0,r=0;r<u.length;r+=2)f=u[r],e=u[r+1],o=o>f?f:o,s=f>s?f:s,h=h>e?e:h,c=e>c?e:c;for(u.push(o,h,s,h,s,c,o,c),a=u.length/2,r=0;a>r;r++)l.push(r)}};n.WebGLGraphics.buildPoly=function(t,i){var e=t.points,f,r;if(!(e.length<6)){var c=i.points,o=i.indices,l=e.length/2,h=n.hex2rgb(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.PolyK.Triangulate(e);if(!u)return!1;for(f=c.length/6,r=0,r=0;r<u.length;r+=3)o.push(u[r]+f),o.push(u[r]+f),o.push(u[r+1]+f),o.push(u[r+2]+f),o.push(u[r+2]+f);for(r=0;l>r;r++)c.push(e[2*r],e[2*r+1],a,v,y,s);return!0}};n.WebGLGraphics.graphicsDataPool=[];n.WebGLGraphicsData=function(n){this.gl=n;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.mode=1;this.alpha=1;this.dirty=!0};n.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};n.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new n.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new n.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=!1};n.glContexts=[];n.instances=[];n.WebGLRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)"undefined"==typeof r[u]&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.sayHello("webGL"),n.defaultRenderer=this);this.type=n.WEBGL_RENDERER;this.resolution=r.resolution;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.preserveDrawingBuffer=r.preserveDrawingBuffer;this.clearBeforeRender=r.clearBeforeRender;this.width=t||800;this.height=i||600;this.view=r.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1);this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer};this.projection=new n.Point;this.offset=new n.Point(0,0);this.shaderManager=new n.WebGLShaderManager;this.spriteBatch=new n.WebGLSpriteBatch;this.maskManager=new n.WebGLMaskManager;this.filterManager=new n.WebGLFilterManager;this.stencilManager=new n.WebGLStencilManager;this.blendModeManager=new n.WebGLBlendModeManager;this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};n.WebGLRenderer.prototype.constructor=n.WebGLRenderer;n.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=n.WebGLRenderer.glContextId++;n.glContexts[this.glContextId]=t;n.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};n.WebGLRenderer.prototype.render=function(n){if(!this.contextLost){this.__stage!==n&&(n.interactive&&n.interactionManager.removeEvents(),this.__stage=n);n.updateTransform();var t=this.gl;n._interactive?n._interactiveEventsAdded||(n._interactiveEventsAdded=!0,n.interactionManager.setTarget(this)):n._interactiveEventsAdded&&(n._interactiveEventsAdded=!1,n.interactionManager.setTarget(this));t.viewport(0,0,this.width,this.height);t.bindFramebuffer(t.FRAMEBUFFER,null);this.clearBeforeRender&&(this.transparent?t.clearColor(0,0,0,0):t.clearColor(n.backgroundColorSplit[0],n.backgroundColorSplit[1],n.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT));this.renderDisplayObject(n,this.projection)}};n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=r?-1:1;this.renderSession.projection=i;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,r);t._renderWebGL(this.renderSession);this.spriteBatch.end()};n.WebGLRenderer.prototype.resize=function(n,t){this.width=n*this.resolution;this.height=t*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};n.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&n.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}};n.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault();this.contextLost=!0};n.WebGLRenderer.prototype.handleContextRestored=function(){var t,i;this.initContext();for(t in n.TextureCache)i=n.TextureCache[t].baseTexture,i._glTextures=[];this.contextLost=!1};n.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);n.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};n.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],n.blendModesWebGL[n.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])};n.WebGLRenderer.glContextId=0;n.WebGLBlendModeManager=function(){this.currentBlendMode=99999};n.WebGLBlendModeManager.prototype.constructor=n.WebGLBlendModeManager;n.WebGLBlendModeManager.prototype.setContext=function(n){this.gl=n};n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0};n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};n.WebGLMaskManager=function(){};n.WebGLMaskManager.prototype.constructor=n.WebGLMaskManager;n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n};n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&n.WebGLGraphics.updateGraphics(t,r);t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)};n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)};n.WebGLMaskManager.prototype.destroy=function(){this.gl=null};n.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n};n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i);0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(t);u=this.count;r.colorMask(!1,!1,!1,!1);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);1===t.mode?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255));r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++};n.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var f,u=this.gl,e=r.projection,o=r.offset;1===i.mode?(f=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(f),u.uniform1f(f.flipY,r.flipY),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform3fv(f.color,i.color),u.uniform1f(f.alpha,t.worldAlpha*i.alpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,8,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(f=r.shaderManager.primitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform1f(f.flipY,r.flipY),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform1f(f.alpha,t.worldAlpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,24,0),u.vertexAttribPointer(f.colorAttribute,4,u.FLOAT,!1,24,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer))};n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),1===t.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))};n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};n.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var n=0;n<this.maxAttibs;n++)this.attribState[n]=!1;this.stack=[]};n.WebGLShaderManager.prototype.constructor=n.WebGLShaderManager;n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new n.PrimitiveShader(t);this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t);this.defaultShader=new n.PixiShader(t);this.fastShader=new n.PixiFastShader(t);this.stripShader=new n.StripShader(t);this.setShader(this.defaultShader)};n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))};n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)};n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};n.WebGLSpriteBatch=function(){var u,r,t,i;for(this.vertSize=5,this.size=2e3,u=16*this.size*this.vertSize,r=6*this.size,this.vertices=new n.ArrayBuffer(u),this.positions=new n.Float32Array(this.vertices),this.colors=new n.Uint32Array(this.vertices),this.indices=new n.Uint16Array(r),this.lastIndexCount=0,t=0,i=0;r>t;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new n.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};n.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var i=new n.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc;i.uniforms={};i.init();this.defaultShader.shaders[t.id]=i};n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};n.WebGLSpriteBatch.prototype.end=function(){this.flush()};n.WebGLSpriteBatch.prototype.render=function(n){var r=n.texture,e,o,u,s,f,b,k,w,nt;if(this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=r.baseTexture),e=r._uvs,e){b=n.anchor.x;k=n.anchor.y;r.trim?(w=r.trim,u=w.x-b*w.width,o=u+r.crop.width,f=w.y-k*w.height,s=f+r.crop.height):(o=r.frame.width*(1-b),u=r.frame.width*-b,s=r.frame.height*(1-k),f=r.frame.height*-k);var t=4*this.currentBatchSize*this.vertSize,d=r.baseTexture.resolution,p=n.worldTransform,h=p.a/d,c=p.b/d,l=p.c/d,a=p.d/d,v=p.tx,y=p.ty,g=this.colors,i=this.positions;this.renderSession.roundPixels?(i[t]=h*u+l*f+v|0,i[t+1]=a*f+c*u+y|0,i[t+5]=h*o+l*f+v|0,i[t+6]=a*f+c*o+y|0,i[t+10]=h*o+l*s+v|0,i[t+11]=a*s+c*o+y|0,i[t+15]=h*u+l*s+v|0,i[t+16]=a*s+c*u+y|0):(i[t]=h*u+l*f+v,i[t+1]=a*f+c*u+y,i[t+5]=h*o+l*f+v,i[t+6]=a*f+c*o+y,i[t+10]=h*o+l*s+v,i[t+11]=a*s+c*o+y,i[t+15]=h*u+l*s+v,i[t+16]=a*s+c*u+y);i[t+2]=e.x0;i[t+3]=e.y0;i[t+7]=e.x1;i[t+8]=e.y1;i[t+12]=e.x2;i[t+13]=e.y2;i[t+17]=e.x3;i[t+18]=e.y3;nt=n.tint;g[t+4]=g[t+9]=g[t+14]=g[t+19]=(nt>>16)+(65280&nt)+((255&nt)<<16)+(255*n.worldAlpha<<24);this.sprites[this.currentBatchSize++]=n}};n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var f=t.tilingTexture,r;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture);t._uvs||(t._uvs=new n.TextureUvs);r=t._uvs;t.tilePosition.x%=f.baseTexture.width*t.tileScaleOffset.x;t.tilePosition.y%=f.baseTexture.height*t.tileScaleOffset.y;var o=t.tilePosition.x/(f.baseTexture.width*t.tileScaleOffset.x),s=t.tilePosition.y/(f.baseTexture.height*t.tileScaleOffset.y),it=t.width/f.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),rt=t.height/f.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-o;r.y0=0-s;r.x1=1*it-o;r.y1=0-s;r.x2=1*it-o;r.y2=1*rt-s;r.x3=0-o;r.y3=1*rt-s;var tt=t.tint,h=(tt>>16)+(65280&tt)+((255&tt)<<16)+(255*t.alpha<<24),u=this.positions,c=this.colors,ut=t.width,ft=t.height,et=t.anchor.x,ot=t.anchor.y,l=ut*(1-et),a=ut*-et,v=ft*(1-ot),y=ft*-ot,i=4*this.currentBatchSize*this.vertSize,p=f.baseTexture.resolution,e=t.worldTransform,w=e.a/p,b=e.b/p,k=e.c/p,d=e.d/p,g=e.tx,nt=e.ty;u[i++]=w*a+k*y+g;u[i++]=d*y+b*a+nt;u[i++]=r.x0;u[i++]=r.y0;c[i++]=h;u[i++]=w*l+k*y+g;u[i++]=d*y+b*l+nt;u[i++]=r.x1;u[i++]=r.y1;c[i++]=h;u[i++]=w*l+k*v+g;u[i++]=d*v+b*l+nt;u[i++]=r.x2;u[i++]=r.y2;c[i++]=h;u[i++]=w*a+k*v+g;u[i++]=d*v+b*a+nt;u[i++]=r.x3;u[i++]=r.y3;c[i++]=h;this.sprites[this.currentBatchSize++]=t};n.WebGLSpriteBatch.prototype.flush=function(){var i,t,u,k,w,b;if(0!==this.currentBatchSize){t=this.gl;this.dirty&&(this.dirty=!1,t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=this.defaultShader.shaders[t.id],u=4*this.vertSize,t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,u,0),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,u,8),t.vertexAttribPointer(i.colorAttribute,4,t.UNSIGNED_BYTE,!0,u,16));this.currentBatchSize>.5*this.size?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(k=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,k));for(var h,c,l,f,e=0,a=0,o=null,v=this.renderSession.blendModeManager.currentBlendMode,r=null,y=!1,p=!1,s=0,d=this.currentBatchSize;d>s;s++)(f=this.sprites[s],h=f.texture.baseTexture,c=f.blendMode,l=f.shader||this.defaultShader,y=v!==c,p=r!==l,(o!==h||y||p)&&(this.renderBatch(o,e,a),a=s,e=0,o=h,y&&(v=c,this.renderSession.blendModeManager.setBlendMode(v)),p))&&(r=l,i=r.shaders[t.id],i||(i=new n.PixiShader(t),i.fragmentSrc=r.fragmentSrc,i.uniforms=r.uniforms,i.init(),r.shaders[t.id]=i),this.renderSession.shaderManager.setShader(i),i.dirty&&i.syncUniforms(),w=this.renderSession.projection,t.uniform2f(i.projectionVector,w.x,w.y),b=this.renderSession.offset,t.uniform2f(i.offsetVector,b.x,b.y)),e++;this.renderBatch(o,e,a);this.currentBatchSize=0}};n.WebGLSpriteBatch.prototype.renderBatch=function(n,t,i){if(0!==t){var r=this.gl;n._dirty[r.id]?this.renderSession.renderer.updateTexture(n):r.bindTexture(r.TEXTURE_2D,n._glTextures[r.id]);r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,12*i);this.renderSession.drawCount++}};n.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0};n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};n.WebGLFastSpriteBatch=function(t){var f,u,i,r;for(this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize,f=4*this.size*this.vertSize,u=6*this.maxSize,this.vertices=new n.Float32Array(f),this.indices=new n.Uint16Array(u),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,i=0,r=0;u>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};n.WebGLFastSpriteBatch.prototype.constructor=n.WebGLFastSpriteBatch;n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)};n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=n.worldTransform.toArray(!0);this.start()};n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.render=function(n){var r=n.children,t=r[0],i,u;if(t.texture._uvs){for(this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode)),i=0,u=r.length;u>i;i++)this.renderSprite(r[i]);this.flush()}};n.WebGLFastSpriteBatch.prototype.renderSprite=function(n){var r,h,c,o,u,s,f,t,i,e;n.visible&&(n.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=n.texture.baseTexture,n.texture._uvs))&&(i=this.vertices,(r=n.texture._uvs,h=n.texture.frame.width,c=n.texture.frame.height,n.texture.trim)?(e=n.texture.trim,u=e.x-n.anchor.x*e.width,o=u+n.texture.crop.width,f=e.y-n.anchor.y*e.height,s=f+n.texture.crop.height):(o=n.texture.frame.width*(1-n.anchor.x),u=n.texture.frame.width*-n.anchor.x,s=n.texture.frame.height*(1-n.anchor.y),f=n.texture.frame.height*-n.anchor.y),t=4*this.currentBatchSize*this.vertSize,i[t++]=u,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x0,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x1,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x2,i[t++]=r.y2,i[t++]=n.alpha,i[t++]=u,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x3,i[t++]=r.y3,i[t++]=n.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())};n.WebGLFastSpriteBatch.prototype.flush=function(){var n,t;0!==this.currentBatchSize&&(n=this.gl,(this.currentBaseTexture._glTextures[n.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,n),n.bindTexture(n.TEXTURE_2D,this.currentBaseTexture._glTextures[n.id]),this.currentBatchSize>.5*this.size)?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(t=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,t)),n.drawElements(n.TRIANGLES,6*this.currentBatchSize,n.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)};n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);i=this.renderSession.projection;n.uniform2f(this.shader.projectionVector,i.x,i.y);n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);t=4*this.vertSize;n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0);n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8);n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16);n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24);n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28);n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36)};n.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};n.WebGLFilterManager.prototype.constructor=n.WebGLFilterManager;n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n;this.texturePool=[];this.initShaderBuffers()};n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n;this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x;this.height=2*-i.y;this.buffer=t};n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds();this.filterStack.push(t);s=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;u=this.texturePool.pop();u?u.resize(this.width,this.height):u=new n.FilterTexture(this.gl,this.width,this.height);r.bindTexture(r.TEXTURE_2D,u.texture);i=t._filterArea;f=s.padding;i.x-=f;i.y-=f;i.width+=2*f;i.height+=2*f;i.x<0&&(i.x=0);i.width>this.width&&(i.width=this.width);i.y<0&&(i.y=0);i.height>this.height&&(i.height=this.height);r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer);r.viewport(0,0,i.width,i.height);e.x=i.width/2;e.y=-i.height/2;o.x=-i.x;o.y=-i.y;r.colorMask(!0,!0,!0,!0);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);t._glFilterTexture=u};n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,s=r._glFilterTexture,p=this.renderSession.projection,w=this.renderSession.offset,f,u,h,b,k,d,y,e,o;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),f=s,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width,this.height)),u.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),h=0;h<r.filterPasses.length-1;h++)b=r.filterPasses[h],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f.texture),this.applyFilterPass(b,i,i.width,i.height),k=f,f=u,u=k;t.enable(t.BLEND);s=f;this.texturePool.push(u)}d=r.filterPasses[r.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var c=this.width,l=this.height,a=0,v=0,g=this.buffer;0===this.filterStack.length?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,c=i.width,l=i.height,a=i.x,v=i.y,g=y._glFilterTexture.frameBuffer);p.x=c/2;p.y=-l/2;w.x=a;w.y=v;i=r._filterArea;e=i.x-a;o=i.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=e;this.vertexArray[1]=o+i.height;this.vertexArray[2]=e+i.width;this.vertexArray[3]=o+i.height;this.vertexArray[4]=e;this.vertexArray[5]=o;this.vertexArray[6]=e+i.width;this.vertexArray[7]=o;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,c,l);t.bindFramebuffer(t.FRAMEBUFFER,g);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);this.applyFilterPass(d,i,c,l);this.texturePool.push(s);r._glFilterTexture=null};n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(),t.shaders[f.id]=e);this.renderSession.shaderManager.setShader(e);f.uniform2f(e.projectionVector,r/2,-u/2);f.uniform2f(e.offsetVector,0,0);t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);this.renderSession.drawCount++};n.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new n.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new n.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new n.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null;n.deleteBuffer(this.vertexBuffer);n.deleteBuffer(this.uvBuffer);n.deleteBuffer(this.colorBuffer);n.deleteBuffer(this.indexBuffer)};n.FilterTexture=function(t,i,r,u){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();u=u||n.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(i,r)};n.FilterTexture.prototype.constructor=n.FilterTexture;n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)};n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n;this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}};n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer);n.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};n.CanvasBuffer=function(n,t){this.width=n;this.height=t;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=n;this.canvas.height=t};n.CanvasBuffer.prototype.constructor=n.CanvasBuffer;n.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n;this.height=this.canvas.height=t};n.CanvasMaskManager=function(){};n.CanvasMaskManager.prototype.constructor=n.CanvasMaskManager;n.CanvasMaskManager.prototype.pushMask=function(t,i){var f=i.context;f.save();var e=t.alpha,r=t.worldTransform,u=i.resolution;f.setTransform(r.a*u,r.b*u,r.c*u,r.d*u,r.tx*u,r.ty*u);n.CanvasGraphics.renderGraphicsMask(t,f);f.clip();t.worldAlpha=e};n.CanvasMaskManager.prototype.popMask=function(n){n.context.restore()};n.CanvasTinter=function(){};n.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture,u,f,e;return(i=n.CanvasTinter.roundColor(i),u="#"+("00000"+(0|i).toString(16)).substr(-6),r.tintCache=r.tintCache||{},r.tintCache[u])?r.tintCache[u]:(f=n.CanvasTinter.canvas||document.createElement("canvas"),(n.CanvasTinter.tintMethod(r,i,f),n.CanvasTinter.convertTintToImage)?(e=new Image,e.src=f.toDataURL(),r.tintCache[u]=e):(r.tintCache[u]=f,n.CanvasTinter.canvas=null),f)};n.CanvasTinter.tintWithMultiply=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width;i.height=r.height;u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="multiply";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithOverlay=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width;i.height=r.height;u.globalCompositeOperation="copy";u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithPerPixel=function(t,i,r){var e=r.getContext("2d"),u=t.crop;r.width=u.width;r.height=u.height;e.globalCompositeOperation="copy";e.drawImage(t.baseTexture.source,u.x,u.y,u.width,u.height,0,0,u.width,u.height);for(var s=n.hex2rgb(i),c=s[0],l=s[1],a=s[2],h=e.getImageData(0,0,u.width,u.height),o=h.data,f=0;f<o.length;f+=4)o[f+0]*=c,o[f+1]*=l,o[f+2]*=a;e.putImageData(h,0,0)};n.CanvasTinter.roundColor=function(t){var r=n.CanvasTinter.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/r*r),i[1]=Math.min(255,i[1]/r*r),i[2]=Math.min(255,i[2]/r*r),n.rgb2hex(i)};n.CanvasTinter.cacheStepsPerColorChannel=8;n.CanvasTinter.convertTintToImage=!1;n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes();n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel;n.CanvasRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)"undefined"==typeof r[u]&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.sayHello("Canvas"),n.defaultRenderer=this);this.type=n.CANVAS_RENDERER;this.resolution=r.resolution;this.clearBeforeRender=r.clearBeforeRender;this.transparent=r.transparent;this.autoResize=r.autoResize||!1;this.width=t||800;this.height=i||600;this.width*=this.resolution;this.height*=this.resolution;this.view=r.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new n.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};this.mapBlendModes();this.resize(t,i);"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")};n.CanvasRenderer.prototype.constructor=n.CanvasRenderer;n.CanvasRenderer.prototype.render=function(t){t.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=n.blendModes.NORMAL;this.context.globalCompositeOperation=n.blendModesCanvas[n.blendModes.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(t);t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)))};n.CanvasRenderer.prototype.destroy=function(n){"undefined"==typeof n&&(n=!0);n&&this.view.parent&&this.view.parent.removeChild(this.view);this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};n.CanvasRenderer.prototype.resize=function(n,t){this.width=n*this.resolution;this.height=t*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")};n.CanvasRenderer.prototype.renderDisplayObject=function(n,t){this.renderSession.context=t||this.context;this.renderSession.resolution=this.resolution;n._renderCanvas(this.renderSession)};n.CanvasRenderer.prototype.mapBlendModes=function(){n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen",n.blendModesCanvas[n.blendModes.OVERLAY]="overlay",n.blendModesCanvas[n.blendModes.DARKEN]="darken",n.blendModesCanvas[n.blendModes.LIGHTEN]="lighten",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="color-dodge",n.blendModesCanvas[n.blendModes.COLOR_BURN]="color-burn",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="hard-light",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="soft-light",n.blendModesCanvas[n.blendModes.DIFFERENCE]="difference",n.blendModesCanvas[n.blendModes.EXCLUSION]="exclusion",n.blendModesCanvas[n.blendModes.HUE]="hue",n.blendModesCanvas[n.blendModes.SATURATION]="saturation",n.blendModesCanvas[n.blendModes.COLOR]="color",n.blendModesCanvas[n.blendModes.LUMINOSITY]="luminosity"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over",n.blendModesCanvas[n.blendModes.OVERLAY]="source-over",n.blendModesCanvas[n.blendModes.DARKEN]="source-over",n.blendModesCanvas[n.blendModes.LIGHTEN]="source-over",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="source-over",n.blendModesCanvas[n.blendModes.COLOR_BURN]="source-over",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.DIFFERENCE]="source-over",n.blendModesCanvas[n.blendModes.EXCLUSION]="source-over",n.blendModesCanvas[n.blendModes.HUE]="source-over",n.blendModesCanvas[n.blendModes.SATURATION]="source-over",n.blendModesCanvas[n.blendModes.COLOR]="source-over",n.blendModesCanvas[n.blendModes.LUMINOSITY]="source-over"))};n.CanvasGraphics=function(){};n.CanvasGraphics.renderGraphics=function(t,i){var h=t.worldAlpha,d,f,b;for(t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),d=0;d<t.graphicsData.length;d++){var r=t.graphicsData[d],u=r.shape,p=r._fillTint,w=r._lineTint;if(i.lineWidth=r.lineWidth,r.type===n.Graphics.POLY){for(i.beginPath(),f=u.points,i.moveTo(f[0],f[1]),b=1;b<f.length/2;b++)i.lineTo(f[2*b],f[2*b+1]);u.closed&&i.lineTo(f[0],f[1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|w).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RECT)(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.fillRect(u.x,u.y,u.width,u.height)),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|w).toString(16)).substr(-6),i.strokeRect(u.x,u.y,u.width,u.height));else if(r.type===n.Graphics.CIRC)i.beginPath(),i.arc(u.x,u.y,u.radius,0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|w).toString(16)).substr(-6),i.stroke());else if(r.type===n.Graphics.ELIP){var g=2*u.width,nt=2*u.height,v=u.x-g/2,k=u.y-nt/2;i.beginPath();var ft=.5522848,tt=g/2*ft,it=nt/2*ft,rt=v+g,ut=k+nt,y=v+g/2,c=k+nt/2;i.moveTo(v,c);i.bezierCurveTo(v,c-it,y-tt,k,y,k);i.bezierCurveTo(y+tt,k,rt,c-it,rt,c);i.bezierCurveTo(rt,c+it,y+tt,ut,y,ut);i.bezierCurveTo(y-tt,ut,v,c+it,v,c);i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|w).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RREC){var e=u.x,o=u.y,l=u.width,a=u.height,s=u.radius,et=Math.min(l,a)/2|0;s=s>et?et:s;i.beginPath();i.moveTo(e,o+s);i.lineTo(e,o+a-s);i.quadraticCurveTo(e,o+a,e+s,o+a);i.lineTo(e+l-s,o+a);i.quadraticCurveTo(e+l,o+a,e+l,o+a-s);i.lineTo(e+l,o+s);i.quadraticCurveTo(e+l,o,e+l-s,o);i.lineTo(e+s,o);i.quadraticCurveTo(e,o,e,o+s);i.closePath();(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|w).toString(16)).substr(-6),i.stroke())}}};n.CanvasGraphics.renderGraphicsMask=function(t,i){var tt=t.graphicsData.length,b,s,r,e,y;if(0!==tt)for(tt>1&&(tt=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")),b=0;1>b;b++)if(s=t.graphicsData[b],r=s.shape,s.type===n.Graphics.POLY){for(i.beginPath(),e=r.points,i.moveTo(e[0],e[1]),y=1;y<e.length/2;y++)i.lineTo(e[2*y],e[2*y+1]);e[0]===e[e.length-2]&&e[1]===e[e.length-1]&&i.closePath()}else if(s.type===n.Graphics.RECT)i.beginPath(),i.rect(r.x,r.y,r.width,r.height),i.closePath();else if(s.type===n.Graphics.CIRC)i.beginPath(),i.arc(r.x,r.y,r.radius,0,2*Math.PI),i.closePath();else if(s.type===n.Graphics.ELIP){var k=2*r.width,d=2*r.height,a=r.x-k/2,p=r.y-d/2;i.beginPath();var ut=.5522848,g=k/2*ut,nt=d/2*ut,it=a+k,rt=p+d,v=a+k/2,h=p+d/2;i.moveTo(a,h);i.bezierCurveTo(a,h-nt,v-g,p,v,p);i.bezierCurveTo(v+g,p,it,h-nt,it,h);i.bezierCurveTo(it,h+nt,v+g,rt,v,rt);i.bezierCurveTo(v-g,rt,a,h+nt,a,h);i.closePath()}else if(s.type===n.Graphics.RREC){var w=r.points,u=w[0],f=w[1],c=w[2],l=w[3],o=w[4],ft=Math.min(c,l)/2|0;o=o>ft?ft:o;i.beginPath();i.moveTo(u,f+o);i.lineTo(u,f+l-o);i.quadraticCurveTo(u,f+l,u+o,f+l);i.lineTo(u+c-o,f+l);i.quadraticCurveTo(u+c,f+l,u+c,f+l-o);i.lineTo(u+c,f+o);i.quadraticCurveTo(u+c,f,u+c-o,f);i.lineTo(u+o,f);i.quadraticCurveTo(u,f,u,f+o);i.closePath()}};n.CanvasGraphics.updateGraphicsTint=function(n){if(16777215!==n.tint)for(var f=(n.tint>>16&255)/255,e=(n.tint>>8&255)/255,o=(255&n.tint)/255,i=0;i<n.graphicsData.length;i++){var t=n.graphicsData[i],r=0|t.fillColor,u=0|t.lineColor;t._fillTint=((r>>16&255)/255*f*255<<16)+((r>>8&255)/255*e*255<<8)+(255&r)/255*o*255;t._lineTint=((u>>16&255)/255*f*255<<16)+((u>>8&255)/255*e*255<<8)+(255&u)/255*o*255}};n.Graphics=function(){n.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=n.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new n.Rectangle(0,0,1,1);this.dirty=!0;this.webGLDirty=!1;this.cachedSpriteDirty=!1};n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Graphics.prototype.constructor=n.Graphics;Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n;this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});n.Graphics.prototype.lineStyle=function(t,i,r){if(this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new n.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}return this};n.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new n.Polygon([t,i])),this};n.Graphics.prototype.lineTo=function(n,t){return this.currentPath.shape.points.push(n,t),this.dirty=!0,this};n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var e,o,s,u;this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);s=20;u=this.currentPath.shape.points;0===u.length&&this.moveTo(0,0);for(var c=u[u.length-2],l=u[u.length-1],f=0,h=1;s>=h;h++)f=h/s,e=c+(n-c)*f,o=l+(t-l)*f,u.push(e+(n+(i-n)*f-e)*f,o+(t+(r-t)*f-o)*f);return this.dirty=!0,this};n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,h,l,c,a,y=20,s=this.currentPath.shape.points,p=s[s.length-2],w=s[s.length-1],e=0,v=1;y>=v;v++)e=v/y,o=1-e,h=o*o,l=h*o,c=e*e,a=c*e,s.push(l*p+3*h*e*n+3*o*c*i+a*u,l*w+3*h*e*t+3*o*c*r+a*f);return this.dirty=!0,this};n.Graphics.prototype.arcTo=function(n,t,i,r,u){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(n,t):this.moveTo(n,t);var f=this.currentPath.shape.points,g=f[f.length-2],nt=f[f.length-1],e=nt-t,o=g-n,s=r-t,h=i-n,a=Math.abs(e*h-o*s);if(1e-8>a||0===u)(f[f.length-2]!==n||f[f.length-1]!==t)&&f.push(n,t);else{var p=e*e+o*o,w=s*s+h*h,b=e*s+o*h,c=u*Math.sqrt(p)/a,l=u*Math.sqrt(w)/a,k=c*b/p,d=l*b/w,v=c*h+l*o,y=c*s+l*e,tt=o*(l+k),it=e*(l+k),rt=h*(c+d),ut=s*(c+d),ft=Math.atan2(it-y,tt-v),et=Math.atan2(ut-y,rt-v);this.arc(v+n,y+t,u,ft,et,o*s>h*e)}return this.dirty=!0,this};n.Graphics.prototype.arc=function(n,t,i,r,u,f){var e,o=n+Math.cos(r)*i,s=t+Math.sin(r)*i,h,a;if((this.currentPath?(e=this.currentPath.shape.points,0===e.length?e.push(o,s):(e[e.length-2]!==o||e[e.length-1]!==s)&&e.push(o,s)):(this.moveTo(o,s),e=this.currentPath.shape.points),r===u)||(!f&&r>=u?u+=2*Math.PI:f&&u>=r&&(r+=2*Math.PI),h=f?-1*(r-u):u-r,a=Math.abs(h)/(2*Math.PI)*40,0===h))return this;for(var c=h/(2*a),d=2*c,y=Math.cos(c),p=Math.sin(c),v=a-1,g=v%1/v,l=0;v>=l;l++){var nt=l+g*l,w=c+r+d*nt,b=Math.cos(w),k=-Math.sin(w);e.push((y*b+p*k)*i+n,(y*-k+p*b)*i+t)}return this.dirty=!0,this};n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this};n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};n.Graphics.prototype.drawRect=function(t,i,r,u){return this.drawShape(new n.Rectangle(t,i,r,u)),this};n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.drawShape(new n.RoundedRectangle(t,i,r,u,f)),this};n.Graphics.prototype.drawCircle=function(t,i,r){return this.drawShape(new n.Circle(t,i,r)),this};n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.drawShape(new n.Ellipse(t,i,r,u)),this};n.Graphics.prototype.drawPolygon=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new n.Polygon(t)),this};n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this};n.Graphics.prototype.generateTexture=function(t,i){t=t||1;var r=this.getBounds(),u=new n.CanvasBuffer(r.width*t,r.height*t),f=n.Texture.fromCanvas(u.canvas,i);return f.baseTexture.resolution=t,u.context.scale(t,t),u.context.translate(-r.x,-r.y),n.CanvasGraphics.renderGraphics(this,u.context),f};n.Graphics.prototype._renderWebGL=function(t){var r,i,u;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t),void 0;if((t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode)&&(t.spriteBatch.currentBlendMode=this.blendMode,r=n.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(r[0],r[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),n.WebGLGraphics.renderGraphics(this,t),this.children.length){for(t.spriteBatch.start(),i=0,u=this.children.length;u>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};n.Graphics.prototype._renderCanvas=function(t){var u,i,r,f,e;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t),void 0;for(u=t.context,i=this.worldTransform,this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,u.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),r=t.resolution,u.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r),n.CanvasGraphics.renderGraphics(this,u),f=0,e=this.children.length;e>f;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};n.Graphics.prototype.getBounds=function(t){if(this.isMask)return n.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,s=e.x,h=e.width+e.x,c=e.y,l=e.height+e.y,o=t||this.worldTransform,a=o.a,v=o.b,y=o.c,p=o.d,w=o.tx,b=o.ty,rt=a*h+y*l+w,ut=p*l+v*h+b,k=a*s+y*l+w,d=p*l+v*s+b,g=a*s+y*c+w,nt=p*c+v*s+b,tt=a*h+y*c+w,it=p*c+v*h+b,u=rt,f=ut,i=rt,r=ut;return i=i>k?k:i,i=i>g?g:i,i=i>tt?tt:i,r=r>d?d:r,r=r>nt?nt:r,r=r>it?it:r,u=k>u?k:u,u=g>u?g:u,u=tt>u?tt:u,f=d>f?d:f,f=nt>f?nt:f,f=it>f?it:f,this._bounds.x=i,this._bounds.width=u-i,this._bounds.y=r,this._bounds.height=f-r,this._bounds};n.Graphics.prototype.updateLocalBounds=function(){var u=1/0,e=-1/0,f=1/0,o=-1/0,s,v,t,i,h,c,y,l,a;if(this.graphicsData.length)for(y=0;y<this.graphicsData.length;y++){var w=this.graphicsData[y],p=w.type,r=w.lineWidth;if(s=w.shape,p===n.Graphics.RECT||p===n.Graphics.RREC)t=s.x-r/2,i=s.y-r/2,h=s.width+r,c=s.height+r,u=u>t?t:u,e=t+h>e?t+h:e,f=f>i?i:f,o=i+c>o?i+c:o;else if(p===n.Graphics.CIRC)t=s.x,i=s.y,h=s.radius+r/2,c=s.radius+r/2,u=u>t-h?t-h:u,e=t+h>e?t+h:e,f=f>i-c?i-c:f,o=i+c>o?i+c:o;else if(p===n.Graphics.ELIP)t=s.x,i=s.y,h=s.width+r/2,c=s.height+r/2,u=u>t-h?t-h:u,e=t+h>e?t+h:e,f=f>i-c?i-c:f,o=i+c>o?i+c:o;else for(v=s.points,l=0;l<v.length;l+=2)t=v[l],i=v[l+1],u=u>t-r?t-r:u,e=t+r>e?t+r:e,f=f>i-r?i-r:f,o=i+r>o?i+r:o}else u=0,e=0,f=0,o=0;a=this.boundsPadding;this._localBounds.x=u-a;this._localBounds.width=e-u+2*a;this._localBounds.y=f-a;this._localBounds.height=o-f+2*a};n.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds(),i,r;this._cachedSprite?this._cachedSprite.buffer.resize(t.width,t.height):(i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas),this._cachedSprite=new n.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};n.Graphics.prototype.updateCachedSpriteTexture=function(){var i=this._cachedSprite,n=i.texture,t=i.buffer.canvas;n.baseTexture.width=t.width;n.baseTexture.height=t.height;n.crop.width=n.frame.width=t.width;n.crop.height=n.frame.height=t.height;i._width=t.width;i._height=t.height;n.baseTexture.dirty()};n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};n.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop();this.currentPath=null;var i=new n.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===n.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i};n.GraphicsData=function(n,t,i,r,u,f,e){this.lineWidth=n;this.lineColor=t;this.lineAlpha=i;this._lineTint=t;this.fillColor=r;this.fillAlpha=u;this._fillTint=r;this.fill=f;this.shape=e;this.type=e.type};n.Graphics.POLY=0;n.Graphics.RECT=1;n.Graphics.CIRC=2;n.Graphics.ELIP=3;n.Graphics.RREC=4;n.Polygon.prototype.type=n.Graphics.POLY;n.Rectangle.prototype.type=n.Graphics.RECT;n.Circle.prototype.type=n.Graphics.CIRC;n.Ellipse.prototype.type=n.Graphics.ELIP;n.RoundedRectangle.prototype.type=n.Graphics.RREC;n.Strip=function(t){n.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new n.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new n.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new n.Float32Array([1,1,1,1]);this.indices=new n.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=n.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=n.Strip.DrawModes.TRIANGLE_STRIP};n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Strip.prototype.constructor=n.Strip;n.Strip.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())};n.Strip.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer();this._indexBuffer=t.createBuffer();this._uvBuffer=t.createBuffer();this._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)};n.Strip.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader,e=this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0));i.uniform2f(r.projectionVector,u.x,-u.y);i.uniform2f(r.offsetVector,-f.x,-f.y);i.uniform1f(r.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer));i.drawElements(e,this.indices.length,i.UNSIGNED_SHORT,0)};n.Strip.prototype._renderCanvas=function(t){var r=t.context,i=this.worldTransform;t.roundPixels?r.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):r.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(r):this._renderCanvasTriangles(r)};n.Strip.prototype._renderCanvasTriangleStrip=function(n){var r=this.vertices,u=this.uvs,f=r.length/2,t,i;for(this.count++,t=0;f-2>t;t++)i=2*t,this._renderCanvasDrawTriangle(n,r,u,i,i+2,i+4)};n.Strip.prototype._renderCanvasTriangles=function(n){var r=this.vertices,u=this.uvs,i=this.indices,f=i.length,t;for(this.count++,t=0;f>t;t+=3){var e=2*i[t],o=2*i[t+1],s=2*i[t+2];this._renderCanvasDrawTriangle(n,r,u,e,o,s)}};n.Strip.prototype._renderCanvasDrawTriangle=function(n,t,i,r,u,f){var ot=this.texture.baseTexture.source,rt=this.texture.width,ut=this.texture.height,h=t[r],c=t[u],l=t[f],a=t[r+1],v=t[u+1],y=t[f+1],p=i[r]*rt,w=i[u]*rt,b=i[f]*rt,k=i[r+1]*ut,d=i[u+1]*ut,g=i[f+1]*ut;if(this.canvasPadding>0){var ft=this.canvasPadding/this.worldTransform.a,et=this.canvasPadding/this.worldTransform.d,nt=(h+c+l)/3,tt=(a+v+y)/3,o=h-nt,s=a-tt,e=Math.sqrt(o*o+s*s);h=nt+o/e*(e+ft);a=tt+s/e*(e+et);o=c-nt;s=v-tt;e=Math.sqrt(o*o+s*s);c=nt+o/e*(e+ft);v=tt+s/e*(e+et);o=l-nt;s=y-tt;e=Math.sqrt(o*o+s*s);l=nt+o/e*(e+ft);y=tt+s/e*(e+et)}n.save();n.beginPath();n.moveTo(h,a);n.lineTo(c,v);n.lineTo(l,y);n.closePath();n.clip();var it=p*d+k*b+w*g-d*b-k*w-p*g,st=h*d+k*l+c*g-d*l-k*c-h*g,ht=p*c+h*b+w*l-c*b-h*w-p*l,ct=p*d*l+k*c*b+h*w*g-h*d*b-k*w*l-p*c*g,lt=a*d+k*y+v*g-d*y-k*v-a*g,at=p*v+a*b+w*y-v*b-a*w-p*y,vt=p*d*y+k*v*b+a*w*g-a*d*b-k*w*y-p*v*g;n.transform(st/it,lt/it,ht/it,at/it,ct/it,vt/it);n.drawImage(ot,0,0);n.restore()};n.Strip.prototype.renderStripFlat=function(n){var t=this.context,i=n.vertices,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;f-2>u;u++){var r=2*u,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h);t.lineTo(o,c);t.lineTo(s,l)}t.fillStyle="#FF0000";t.fill();t.closePath()};n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};n.Strip.prototype.getBounds=function(t){for(var i,r=t||this.worldTransform,y=r.a,p=r.b,w=r.c,b=r.d,k=r.tx,d=r.ty,o=-1/0,f=-1/0,u=1/0,e=1/0,l=this.vertices,s=0,g=l.length;g>s;s+=2){var a=l[s],v=l[s+1],h=y*a+w*v+k,c=b*v+p*a+d;u=u>h?h:u;e=e>c?c:e;o=h>o?h:o;f=c>f?c:f}return u===-1/0||1/0===f?n.EmptyRectangle:(i=this._bounds,i.x=u,i.width=o-u,i.y=e,i.height=f-e,this._currentBounds=i,i)};n.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};n.Rope=function(t,i){n.Strip.call(this,t);this.points=i;this.vertices=new n.Float32Array(4*i.length);this.uvs=new n.Float32Array(4*i.length);this.colors=new n.Float32Array(2*i.length);this.indices=new n.Uint16Array(2*i.length);this.refresh()};n.Rope.prototype=Object.create(n.Strip.prototype);n.Rope.prototype.constructor=n.Rope;n.Rope.prototype.refresh=function(){var u=this.points,s,n,r,o,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;o>i;i++)s=u[i],n=4*i,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=2*i,e[n]=1,e[n+1]=1,n=2*i,f[n]=n,f[n+1]=n+1,h=s}};n.Rope.prototype.updateTransform=function(){var u=this.points,s,e,t;if(!(u.length<1)){e=u[0];t={x:0,y:0};this.count-=.2;for(var i,f,h,c,l,o=this.vertices,a=u.length,r=0;a>r;r++)i=u[r],f=4*r,s=r<u.length-1?u[r+1]:i,t.y=-(s.x-e.x),t.x=s.y-e.y,h=10*(1-r/(a-1)),h>1&&(h=1),c=Math.sqrt(t.x*t.x+t.y*t.y),l=this.texture.height/2,t.x/=c,t.y/=c,t.x*=l,t.y*=l,o[f]=i.x+t.x,o[f+1]=i.y+t.y,o[f+2]=i.x-t.x,o[f+3]=i.y-t.y,e=i;n.DisplayObjectContainer.prototype.updateTransform.call(this)}};n.Rope.prototype.setTexture=function(n){this.texture=n};n.TilingSprite=function(t,i,r){n.Sprite.call(this,t);this._width=i||100;this._height=r||100;this.tileScale=new n.Point(1,1);this.tileScaleOffset=new n.Point(1,1);this.tilePosition=new n.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL};n.TilingSprite.prototype=Object.create(n.Sprite.prototype);n.TilingSprite.prototype.constructor=n.TilingSprite;Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}});Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}});n.TilingSprite.prototype.setTexture=function(n){this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215)};n.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha){var i,r;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(n.updateWebGLTexture(this.tilingTexture.baseTexture,t.gl),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),i=0,r=this.children.length;r>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop();this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this._mask,t);t.spriteBatch.start()}};n.TilingSprite.prototype._renderCanvas=function(t){var i,o,s,u,f,r,e;if(this.visible!==!1&&0!==this.alpha){if(i=t.context,this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha,u=this.worldTransform,f=t.resolution,i.setTransform(u.a*f,u.b*f,u.c*f,u.d*f,u.tx*f,u.ty*f),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),r=this.tilePosition,e=this.tileScale,r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,i.scale(e.x,e.y),i.translate(r.x+this.anchor.x*-this._width,r.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-r.x,-r.y,this._width/e.x,this._height/e.y),i.scale(1/e.x,1/e.y),i.translate(-r.x+this.anchor.x*this._width,-r.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t.context),o=0,s=this.children.length;s>o;o++)this.children[o]._renderCanvas(t)}};n.TilingSprite.prototype.getBounds=function(){var rt=this._width,ut=this._height,e=rt*(1-this.anchor.x),o=rt*-this.anchor.x,s=ut*(1-this.anchor.y),h=ut*-this.anchor.y,f=this.worldTransform,c=f.a,l=f.b,a=f.c,v=f.d,y=f.tx,p=f.ty,w=c*o+a*h+y,b=v*h+l*o+p,k=c*e+a*h+y,d=v*h+l*e+p,g=c*e+a*s+y,nt=v*s+l*e+p,tt=c*o+a*s+y,it=v*s+l*o+p,i=-1/0,r=-1/0,n=1/0,t=1/0,u;return n=n>w?w:n,n=n>k?k:n,n=n>g?g:n,n=n>tt?tt:n,t=t>b?b:t,t=t>d?d:t,t=t>nt?nt:t,t=t>it?it:t,i=w>i?w:i,i=k>i?k:i,i=g>i?g:i,i=tt>i?tt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,r=it>r?it:r,u=this._bounds,u.x=n,u.width=i-n,u.y=t,u.height=r-t,this._currentBounds=u,u};n.TilingSprite.prototype.onTextureUpdate=function(){};n.TilingSprite.prototype.generateTilingTexture=function(t){var e;if(this.texture.baseTexture.hasLoaded){var u,f,i=this.originalTexture||this.texture,r=i.frame,s=r.width!==i.baseTexture.width||r.height!==i.baseTexture.height,o=!1;(t?(u=n.getNextPowerOfTwo(r.width),f=n.getNextPowerOfTwo(r.height),(r.width!==u||r.height!==f||i.baseTexture.width!==u||i.baseTexture.height||f)&&(o=!0)):s&&(u=r.width,f=r.height,o=!0),o)?(this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(u,f),this.tilingTexture.baseTexture.width=u,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(e=new n.CanvasBuffer(u,f),this.tilingTexture=n.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0),e.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,u,f),this.tileScaleOffset.x=r.width/u,this.tileScaleOffset.y=r.height/f):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i);this.refreshTexture=!1;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=!0}};t={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};t.BoneData=function(n,t){this.name=n;this.parent=t};t.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1};t.SlotData=function(n,t){this.name=n;this.boneData=t};t.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1};t.IkConstraintData=function(n){this.name=n;this.bones=[]};t.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};t.Bone=function(n,t,i){this.data=n;this.skeleton=t;this.parent=i;this.setToSetupPose()};t.Bone.yDown=!1;t.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var n=this.parent,u,f;n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.data.inheritScale?(this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?n.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=n.worldFlipX!=this.flipX,this.worldFlipY=n.worldFlipY!=this.flipY):(u=this.skeleton.flipX,f=this.skeleton.flipY,this.worldX=u?-this.x:this.x,this.worldY=f!=t.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=u!=this.flipX,this.worldFlipY=f!=this.flipY);var e=this.worldRotation*t.degRad,i=Math.cos(e),r=Math.sin(e);this.worldFlipX?(this.m00=-i*this.worldScaleX,this.m01=r*this.worldScaleY):(this.m00=i*this.worldScaleX,this.m01=-r*this.worldScaleY);this.worldFlipY!=t.Bone.yDown?(this.m10=-r*this.worldScaleX,this.m11=-i*this.worldScaleY):(this.m10=r*this.worldScaleX,this.m11=i*this.worldScaleY)},setToSetupPose:function(){var n=this.data;this.x=n.x;this.y=n.y;this.rotation=n.rotation;this.rotationIK=this.rotation;this.scaleX=n.scaleX;this.scaleY=n.scaleY;this.flipX=n.flipX;this.flipY=n.flipY},worldToLocal:function(n){var f=n[0]-this.worldX,e=n[1]-this.worldY,r=this.m00,o=this.m10,s=this.m01,u=this.m11,i;this.worldFlipX!=(this.worldFlipY!=t.Bone.yDown)&&(r=-r,u=-u);i=1/(r*u-s*o);n[0]=f*r*i-e*s*i;n[1]=e*u*i-f*o*i},localToWorld:function(n){var t=n[0],i=n[1];n[0]=t*this.m00+i*this.m01+this.worldX;n[1]=t*this.m10+i*this.m11+this.worldY}};t.Slot=function(n,t){this.data=n;this.bone=t;this.setToSetupPose()};t.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(n){this.attachment=n;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(n){this._attachmentTime=this.bone.skeleton.time-n},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var n=this.data;this.r=n.r;this.g=n.g;this.b=n.b;this.a=n.a;for(var i=this.bone.skeleton.data.slots,t=0,r=i.length;r>t;t++)if(i[t]==n){this.setAttachment(n.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(t,n.attachmentName):null);break}}};t.IkConstraint=function(n,t){this.data=n;this.mix=n.mix;this.bendDirection=n.bendDirection;this.bones=[];for(var i=0,r=n.bones.length;r>i;i++)this.bones.push(t.findBone(n.bones[i].name));this.target=t.findBone(n.target.name)};t.IkConstraint.prototype={apply:function(){var n=this.target,i=this.bones;switch(i.length){case 1:t.IkConstraint.apply1(i[0],n.worldX,n.worldY,this.mix);break;case 2:t.IkConstraint.apply2(i[0],i[1],n.worldX,n.worldY,this.bendDirection,this.mix)}}};t.IkConstraint.apply1=function(n,i,r,u){var e=n.data.inheritRotation&&n.parent?n.parent.worldRotation:0,f=n.rotation,o=Math.atan2(r-n.worldY,i-n.worldX)*t.radDeg-e;n.rotationIK=f+(o-f)*u};t.IkConstraint.apply2=function(n,i,r,u,f,e){var c=i.rotation,v=n.rotation,p,w,o,l,h;if(!e)return i.rotationIK=c,n.rotationIK=v,void 0;o=t.temp;l=n.parent;l?(o[0]=r,o[1]=u,l.worldToLocal(o),r=(o[0]-n.x)*l.worldScaleX,u=(o[1]-n.y)*l.worldScaleY):(r-=n.x,u-=n.y);i.parent==n?(p=i.x,w=i.y):(o[0]=i.x,o[1]=i.y,i.parent.localToWorld(o),n.worldToLocal(o),p=o[0],w=o[1]);var b=p*n.worldScaleX,k=w*n.worldScaleY,d=Math.atan2(k,b),y=Math.sqrt(b*b+k*k),a=i.data.length*i.worldScaleX,g=2*y*a;if(.0001>g)return i.rotationIK=c+(Math.atan2(u,r)*t.radDeg-v-c)*e,void 0;h=(r*r+u*u-y*y-a*a)/g;-1>h?h=-1:h>1&&(h=1);var nt=Math.acos(h)*f,tt=y+a*h,it=a*Math.sin(nt),rt=Math.atan2(u*tt-r*it,r*tt+u*it),s=(rt-d)*t.radDeg-v;s>180?s-=360:-180>s&&(s+=360);n.rotationIK=v+s*e;s=(nt+d)*t.radDeg-c;s>180?s-=360:-180>s&&(s+=360);i.rotationIK=c+(s+n.worldRotation-i.parent.worldRotation)*e};t.Skin=function(n){this.name=n;this.attachments={}};t.Skin.prototype={addAttachment:function(n,t,i){this.attachments[n+":"+t]=i},getAttachment:function(n,t){return this.attachments[n+":"+t]},_attachAll:function(n,t){var i,u;for(i in t.attachments){var f=i.indexOf(":"),e=parseInt(i.substring(0,f)),o=i.substring(f+1),r=n.slots[e];r.attachment&&r.attachment.name==o&&(u=this.getAttachment(e,o),u&&r.setAttachment(u))}}};t.Animation=function(n,t,i){this.name=n;this.timelines=t;this.duration=i};t.Animation.prototype={apply:function(n,t,i,r,u){r&&0!=this.duration&&(i%=this.duration,t%=this.duration);for(var e=this.timelines,f=0,o=e.length;o>f;f++)e[f].apply(n,t,i,u,1)},mix:function(n,t,i,r,u,f){r&&0!=this.duration&&(i%=this.duration,t%=this.duration);for(var o=this.timelines,e=0,s=o.length;s>e;e++)o[e].apply(n,t,i,u,f)}};t.Animation.binarySearch=function(n,t,i){var f=0,r=Math.floor(n.length/i)-2,u;if(!r)return i;for(u=r>>>1;;){if(n[(u+1)*i]<=t?f=u+1:r=u,f==r)return(f+1)*i;u=f+r>>>1}};t.Animation.binarySearch1=function(n,t){var u=0,i=n.length-2,r;if(!i)return 1;for(r=i>>>1;;){if(n[r+1]<=t?u=r+1:i=r,u==i)return u+1;r=u+i>>>1}};t.Animation.linearSearch=function(n,t,i){for(var r=0,u=n.length-i;u>=r;r+=i)if(n[r]>t)return r;return-1};t.Curves=function(){this.curves=[]};t.Curves.prototype={setLinear:function(n){this.curves[19*n]=0},setStepped:function(n){this.curves[19*n]=1},setCurve:function(n,t,i,r,u){var e=.1,s=e*e,h=s*e,p=3*e,w=3*s,b=6*s,o=6*h,k=2*-t+r,d=2*-i+u,c=3*(t-r)+1,l=3*(i-u)+1,a=t*p+k*w+c*h,v=i*p+d*w+l*h,g=k*b+c*o,nt=d*b+l*o,rt=c*o,ut=l*o,f=19*n,y=this.curves;y[f++]=2;for(var tt=a,it=v,ft=f+19-1;ft>f;f+=2)y[f]=tt,y[f+1]=it,a+=g,v+=nt,g+=rt,nt+=ut,tt+=a,it+=v},getCurvePercent:function(n,t){var f,e,o;t=0>t?0:t>1?1:t;var r=this.curves,i=19*n,s=r[i];if(0===s)return t;if(1==s)return 0;i++;for(var u=0,h=i,c=i+19-1;c>i;i+=2)if(u=r[i],u>=t)return i==h?(f=0,e=0):(f=r[i-2],e=r[i-1]),e+(r[i+1]-e)*(t-f)/(u-f);return o=r[i-1],o+(1-o)*(t-u)/(1-u)}};t.RotateTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=2*n};t.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2;this.frames[n]=t;this.frames[n+1]=i},apply:function(n,i,r,u,f){var o=this.frames,s,e;if(!(r<o[0])){if(s=n.bones[this.boneIndex],r>=o[o.length-2]){for(e=s.data.rotation+o[o.length-1]-s.rotation;e>180;)e-=360;for(;-180>e;)e+=360;return s.rotation+=e*f,void 0}var h=t.Animation.binarySearch(o,r,2),l=o[h-1],a=o[h],c=1-(r-a)/(o[h-2]-a);for(c=this.curves.getCurvePercent(h/2-1,c),e=o[h+1]-l;e>180;)e-=360;for(;-180>e;)e+=360;for(e=s.data.rotation+(l+e*c)-s.rotation;e>180;)e-=360;for(;-180>e;)e+=360;s.rotation+=e*f}}};t.TranslateTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=3*n};t.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3;this.frames[n]=t;this.frames[n+1]=i;this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o;if(!(r<e[0])){if(o=n.bones[this.boneIndex],r>=e[e.length-3])return o.x+=(o.data.x+e[e.length-2]-o.x)*f,o.y+=(o.data.y+e[e.length-1]-o.y)*f,void 0;var s=t.Animation.binarySearch(e,r,3),c=e[s-2],l=e[s-1],a=e[s],h=1-(r-a)/(e[s+-3]-a);h=this.curves.getCurvePercent(s/3-1,h);o.x+=(o.data.x+c+(e[s+1]-c)*h-o.x)*f;o.y+=(o.data.y+l+(e[s+2]-l)*h-o.y)*f}}};t.ScaleTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=3*n};t.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3;this.frames[n]=t;this.frames[n+1]=i;this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o;if(!(r<e[0])){if(o=n.bones[this.boneIndex],r>=e[e.length-3])return o.scaleX+=(o.data.scaleX*e[e.length-2]-o.scaleX)*f,o.scaleY+=(o.data.scaleY*e[e.length-1]-o.scaleY)*f,void 0;var s=t.Animation.binarySearch(e,r,3),c=e[s-2],l=e[s-1],a=e[s],h=1-(r-a)/(e[s+-3]-a);h=this.curves.getCurvePercent(s/3-1,h);o.scaleX+=(o.data.scaleX*(c+(e[s+1]-c)*h)-o.scaleX)*f;o.scaleY+=(o.data.scaleY*(l+(e[s+2]-l)*h)-o.scaleY)*f}}};t.ColorTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=5*n};t.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(n,t,i,r,u,f){n*=5;this.frames[n]=t;this.frames[n+1]=i;this.frames[n+2]=r;this.frames[n+3]=u;this.frames[n+4]=f},apply:function(n,i,r,u,f){var e=this.frames,l,a,v,y,c,o;if(!(r<e[0])){if(r>=e[e.length-5])c=e.length-1,l=e[c-3],a=e[c-2],v=e[c-1],y=e[c];else{var s=t.Animation.binarySearch(e,r,5),p=e[s-4],w=e[s-3],b=e[s-2],k=e[s-1],d=e[s],h=1-(r-d)/(e[s-5]-d);h=this.curves.getCurvePercent(s/5-1,h);l=p+(e[s+1]-p)*h;a=w+(e[s+2]-w)*h;v=b+(e[s+3]-b)*h;y=k+(e[s+4]-k)*h}o=n.slots[this.slotIndex];1>f?(o.r+=(l-o.r)*f,o.g+=(a-o.g)*f,o.b+=(v-o.b)*f,o.a+=(y-o.a)*f):(o.r=l,o.g=a,o.b=v,o.a=y)}}};t.AttachmentTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=n;this.attachmentNames=[];this.attachmentNames.length=n};t.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t;this.attachmentNames[n]=i},apply:function(n,i,r){var u=this.frames,f,e;if(r<u[0])return i>r&&this.apply(n,i,Number.MAX_VALUE,null,0),void 0;i>r&&(i=-1);f=r>=u[u.length-1]?u.length-1:t.Animation.binarySearch1(u,r)-1;u[f]<i||(e=this.attachmentNames[f],n.slots[this.slotIndex].setAttachment(e?n.getAttachmentBySlotIndex(this.slotIndex,e):null))}};t.EventTimeline=function(n){this.frames=[];this.frames.length=n;this.events=[];this.events.length=n};t.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t;this.events[n]=i},apply:function(n,i,r,u,f){var o,s,e,h,c;if(u){if(o=this.frames,s=o.length,i>r)this.apply(n,i,Number.MAX_VALUE,u,f),i=-1;else if(i>=o[s-1])return;if(!(r<o[0])){if(i<o[0])e=0;else for(e=t.Animation.binarySearch1(o,i),h=o[e];e>0&&o[e-1]==h;)e--;for(c=this.events;s>e&&r>=o[e];e++)u.push(c[e])}}}};t.DrawOrderTimeline=function(n){this.frames=[];this.frames.length=n;this.drawOrders=[];this.drawOrders.length=n};t.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t;this.drawOrders[n]=i},apply:function(n,i,r){var f=this.frames,s,u,e;if(!(r<f[0])){s=r>=f[f.length-1]?f.length-1:t.Animation.binarySearch1(f,r)-1;var h=n.drawOrder,c=n.slots,o=this.drawOrders[s];if(o)for(u=0,e=o.length;e>u;u++)h[u]=n.slots[o[u]];else for(u=0,e=c.length;e>u;u++)h[u]=c[u]}}};t.FfdTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=n;this.frameVertices=[];this.frameVertices.length=n};t.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t;this.frameVertices[n]=i},apply:function(n,i,r,u,f){var b=n.slots[this.slotIndex],o,y,p,w,e,l;if(b.attachment==this.attachment&&(o=this.frames,!(r<o[0]))){var v=this.frameVertices,h=v[0].length,s=b.attachmentVertices;if(s.length!=h&&(f=1),s.length=h,r>=o[o.length-1])if(y=v[o.length-1],1>f)for(e=0;h>e;e++)s[e]+=(y[e]-s[e])*f;else for(e=0;h>e;e++)s[e]=y[e];else{var a=t.Animation.binarySearch1(o,r),k=o[a],c=1-(r-k)/(o[a-1]-k);if(c=this.curves.getCurvePercent(a-1,0>c?0:c>1?1:c),p=v[a-1],w=v[a],1>f)for(e=0;h>e;e++)l=p[e],s[e]+=(l+(w[e]-l)*c-s[e])*f;else for(e=0;h>e;e++)l=p[e],s[e]=l+(w[e]-l)*c}}}};t.IkConstraintTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=3*n};t.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3;this.frames[n]=t;this.frames[n+1]=i;this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o,a;if(!(r<e[0])){if(o=n.ikConstraints[this.ikConstraintIndex],r>=e[e.length-3])return o.mix+=(e[e.length-2]-o.mix)*f,o.bendDirection=e[e.length-1],void 0;var s=t.Animation.binarySearch(e,r,3),c=e[s+-2],l=e[s],h=1-(r-l)/(e[s+-3]-l);h=this.curves.getCurvePercent(s/3-1,h);a=c+(e[s+1]-c)*h;o.mix+=(a-o.mix)*f;o.bendDirection=e[s+-1]}}};t.FlipXTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=2*n};t.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2;this.frames[n]=t;this.frames[n+1]=i?1:0},apply:function(n,i,r){var u=this.frames,f;if(r<u[0])return i>r&&this.apply(n,i,Number.MAX_VALUE,null,0),void 0;i>r&&(i=-1);f=(r>=u[u.length-2]?u.length:t.Animation.binarySearch(u,r,2))-2;u[f]<i||(n.bones[boneIndex].flipX=0!=u[f+1])}};t.FlipYTimeline=function(n){this.curves=new t.Curves(n);this.frames=[];this.frames.length=2*n};t.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2;this.frames[n]=t;this.frames[n+1]=i?1:0},apply:function(n,i,r){var u=this.frames,f;if(r<u[0])return i>r&&this.apply(n,i,Number.MAX_VALUE,null,0),void 0;i>r&&(i=-1);f=(r>=u[u.length-2]?u.length:t.Animation.binarySearch(u,r,2))-2;u[f]<i||(n.bones[boneIndex].flipY=0!=u[f+1])}};t.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[]};t.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return slot[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSkin:function(n){for(var i=this.skins,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findEvent:function(n){for(var i=this.events,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findAnimation:function(n){for(var i=this.animations,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findIkConstraint:function(n){for(var i=this.ikConstraints,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null}};t.Skeleton=function(n){var u,f,i,r;for(this.data=n,this.bones=[],i=0,r=n.bones.length;r>i;i++)u=n.bones[i],f=u.parent?this.bones[n.bones.indexOf(u.parent)]:null,this.bones.push(new t.Bone(u,this,f));for(this.slots=[],this.drawOrder=[],i=0,r=n.slots.length;r>i;i++){var e=n.slots[i],s=this.bones[n.bones.indexOf(e.boneData)],o=new t.Slot(e,s);this.slots.push(o);this.drawOrder.push(o)}for(this.ikConstraints=[],i=0,r=n.ikConstraints.length;r>i;i++)this.ikConstraints.push(new t.IkConstraint(n.ikConstraints[i],this));this.boneCache=[];this.updateCache()};t.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var l=this.ikConstraints,a=l.length,o=a+1,n=this.boneCache,s,h,t,f,r,u,i;for(n.length>o&&(n.length=o),t=0,f=n.length;f>t;t++)n[t].length=0;for(;n.length<o;)n[n.length]=[];s=n[0];h=this.bones;n:for(t=0,f=h.length;f>t;t++){r=h[t];u=r;do{for(i=0;a>i;i++)for(var c=l[i],v=c.bones[0],e=c.bones[c.bones.length-1];;){if(u==e){n[i].push(r);n[i+1].push(r);continue n}if(e==v)break;e=e.parent}u=u.parent}while(u);s[s.length]=r}},updateWorldTransform:function(){for(var t,u,r=this.bones,n=0,e=r.length;e>n;n++)t=r[n],t.rotationIK=t.rotation;for(n=0,u=this.boneCache.length-1;;){for(var f=this.boneCache[n],i=0,o=f.length;o>i;i++)f[i].updateWorldTransform();if(n==u)break;this.ikConstraints[n].apply();n++}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t,i=this.bones,n=0,r=i.length;r>n;n++)i[n].setToSetupPose();for(var u=this.ikConstraints,n=0,r=u.length;r>n;n++)t=u[n],t.bendDirection=t.data.bendDirection,t.mix=t.data.mix},setSlotsToSetupPose:function(){for(var t=this.slots,i=this.drawOrder,n=0,r=t.length;r>n;n++)i[n]=t[n],t[n].setToSetupPose(n)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},setSkinByName:function(n){var t=this.data.findSkin(n);if(!t)throw"Skin not found: "+n;this.setSkin(t)},setSkin:function(n){var i,r,u;if(n)if(this.skin)n._attachAll(this,this.skin);else for(var f=this.slots,t=0,e=f.length;e>t;t++)i=f[t],r=i.data.attachmentName,r&&(u=n.getAttachment(t,r),u&&i.setAttachment(u));this.skin=n},getAttachmentBySlotName:function(n,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(n),t)},getAttachmentBySlotIndex:function(n,t){if(this.skin){var i=this.skin.getAttachment(n,t);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(n,t):null},setAttachment:function(n,t){for(var u,r,f=this.slots,i=0,e=f.length;e>i;i++)if(u=f[i],u.data.name==n){if(r=null,t&&(r=this.getAttachmentBySlotIndex(i,t),!r))throw"Attachment not found: "+t+", for slot: "+n;return u.setAttachment(r),void 0}throw"Slot not found: "+n;},findIkConstraint:function(n){for(var i=this.ikConstraints,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},update:function(n){this.time+=n}};t.EventData=function(n){this.name=n};t.EventData.prototype={intValue:0,floatValue:0,stringValue:null};t.Event=function(n){this.data=n};t.Event.prototype={intValue:0,floatValue:0,stringValue:null};t.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};t.RegionAttachment=function(n){this.name=n;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};t.RegionAttachment.prototype={type:t.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(n,t,i,r,u){var f=this.uvs;u?(f[2]=n,f[3]=r,f[4]=n,f[5]=t,f[6]=i,f[7]=t,f[0]=i,f[1]=r):(f[0]=n,f[1]=r,f[2]=n,f[3]=t,f[4]=i,f[5]=t,f[6]=i,f[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,o=this.height/this.regionOriginalHeight*this.scaleY,u=-this.width/2*this.scaleX+this.regionOffsetX*e,f=-this.height/2*this.scaleY+this.regionOffsetY*o,s=u+this.regionWidth*e,h=f+this.regionHeight*o,c=this.rotation*t.degRad,i=Math.cos(c),r=Math.sin(c),l=u*i+this.x,a=u*r,v=f*i+this.y,y=f*r,p=s*i+this.x,w=s*r,b=h*i+this.y,k=h*r,n=this.offset;n[0]=l-y;n[1]=v+a;n[2]=l-k;n[3]=b+a;n[4]=p-k;n[5]=b+w;n[6]=p-y;n[7]=v+w},computeVertices:function(n,t,i,r){n+=i.worldX;t+=i.worldY;var f=i.m00,e=i.m01,o=i.m10,s=i.m11,u=this.offset;r[0]=u[0]*f+u[1]*e+n;r[1]=u[0]*o+u[1]*s+t;r[2]=u[2]*f+u[3]*e+n;r[3]=u[2]*o+u[3]*s+t;r[4]=u[4]*f+u[5]*e+n;r[5]=u[4]*o+u[5]*s+t;r[6]=u[6]*f+u[7]*e+n;r[7]=u[6]*o+u[7]*s+t}};t.MeshAttachment=function(n){this.name=n};t.MeshAttachment.prototype={type:t.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var u=this.regionU2-this.regionU,r=this.regionV2-this.regionV,i=this.regionUVs.length,n;if(this.uvs&&this.uvs.length==i||(this.uvs=new t.Float32Array(i)),this.regionRotate)for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*u,this.uvs[n+1]=this.regionV+r-this.regionUVs[n]*r;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*u,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*r},computeWorldVertices:function(n,t,i,r){var f=i.bone,u,o,s;n+=f.worldX;t+=f.worldY;var c=f.m00,l=f.m01,a=f.m10,v=f.m11,e=this.vertices,h=e.length;for(i.attachmentVertices.length==h&&(e=i.attachmentVertices),u=0;h>u;u+=2)o=e[u],s=e[u+1],r[u]=o*c+s*l+n,r[u+1]=o*a+s*v+t}};t.SkinnedMeshAttachment=function(n){this.name=n};t.SkinnedMeshAttachment.prototype={type:t.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var u=this.regionU2-this.regionU,r=this.regionV2-this.regionV,i=this.regionUVs.length,n;if(this.uvs&&this.uvs.length==i||(this.uvs=new t.Float32Array(i)),this.regionRotate)for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*u,this.uvs[n+1]=this.regionV+r-this.regionUVs[n]*r;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*u,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*r},computeWorldVertices:function(n,t,i,r){var p,o,s,u,h,c,l,k=i.bone.skeleton.bones,a=this.weights,y=this.bones,v=0,f=0,e=0,w=0,d=y.length,b;if(i.attachmentVertices.length)for(b=i.attachmentVertices;d>f;v+=2){for(o=0,s=0,p=y[f++]+f;p>f;f++,e+=3,w+=2)u=k[y[f]],h=a[e]+b[w],c=a[e+1]+b[w+1],l=a[e+2],o+=(h*u.m00+c*u.m01+u.worldX)*l,s+=(h*u.m10+c*u.m11+u.worldY)*l;r[v]=o+n;r[v+1]=s+t}else for(;d>f;v+=2){for(o=0,s=0,p=y[f++]+f;p>f;f++,e+=3)u=k[y[f]],h=a[e],c=a[e+1],l=a[e+2],o+=(h*u.m00+c*u.m01+u.worldX)*l,s+=(h*u.m10+c*u.m11+u.worldY)*l;r[v]=o+n;r[v+1]=s+t}}};t.BoundingBoxAttachment=function(n){this.name=n;this.vertices=[]};t.BoundingBoxAttachment.prototype={type:t.AttachmentType.boundingbox,computeWorldVertices:function(n,t,i,r){var e,o;n+=i.worldX;t+=i.worldY;for(var s=i.m00,h=i.m01,c=i.m10,l=i.m11,f=this.vertices,u=0,a=f.length;a>u;u+=2)e=f[u],o=f[u+1],r[u]=e*s+o*h+n,r[u+1]=e*c+o*l+t}};t.AnimationStateData=function(n){this.skeletonData=n;this.animationToMixTime={}};t.AnimationStateData.prototype={defaultMix:0,setMixByName:function(n,t,i){var u=this.skeletonData.findAnimation(n),r;if(!u)throw"Animation not found: "+n;if(r=this.skeletonData.findAnimation(t),!r)throw"Animation not found: "+t;this.setMix(u,r,i)},setMix:function(n,t,i){this.animationToMixTime[n.name+":"+t.name]=i},getMix:function(n,t){var i=n.name+":"+t.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}};t.TrackEntry=function(){};t.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};t.AnimationState=function(n){this.data=n;this.tracks=[];this.events=[]};t.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(n){var i,t,u,r;for(n*=this.timeScale,i=0;i<this.tracks.length;i++)t=this.tracks[i],t&&((t.time+=n*t.timeScale,t.previous)&&(u=n*t.previous.timeScale,t.previous.time+=u,t.mixTime+=u),r=t.next,r?(r.time=t.lastTime-r.delay,r.time>=0&&this.setCurrent(i,r)):!t.loop&&t.lastTime>=t.endTime&&this.clearTrack(i))},apply:function(n){for(var t,u,o,s,h,v,c,l,i=0;i<this.tracks.length;i++)if(t=this.tracks[i],t){this.events.length=0;var r=t.time,a=t.lastTime,f=t.endTime,e=t.loop;for(!e&&r>f&&(r=f),u=t.previous,u?(o=u.time,!u.loop&&o>u.endTime&&(o=u.endTime),u.animation.apply(n,o,o,u.loop,null),s=t.mixTime/t.mixDuration*t.mix,s>=1&&(s=1,t.previous=null),t.animation.mix(n,t.lastTime,r,e,this.events,s)):1==t.mix?t.animation.apply(n,t.lastTime,r,e,this.events):t.animation.mix(n,t.lastTime,r,e,this.events,t.mix),h=0,v=this.events.length;v>h;h++)c=this.events[h],t.onEvent&&t.onEvent(i,c),this.onEvent&&this.onEvent(i,c);(e?a%f>r%f:f>a&&r>=f)&&(l=Math.floor(r/f),t.onComplete&&t.onComplete(i,l),this.onComplete&&this.onComplete(i,l));t.lastTime=t.time}},clearTracks:function(){for(var n=0,t=this.tracks.length;t>n;n++)this.clearTrack(n);this.tracks.length=0},clearTrack:function(n){if(!(n>=this.tracks.length)){var t=this.tracks[n];t&&(t.onEnd&&t.onEnd(n),this.onEnd&&this.onEnd(n),this.tracks[n]=null)}},_expandToIndex:function(n){if(n<this.tracks.length)return this.tracks[n];for(;n>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(n,t){var i=this._expandToIndex(n),r;i&&(r=i.previous,i.previous=null,i.onEnd&&i.onEnd(n),this.onEnd&&this.onEnd(n),t.mixDuration=this.data.getMix(i.animation,t.animation),t.mixDuration>0&&(t.mixTime=0,t.previous=r&&i.mixTime/i.mixDuration<.5?r:i));this.tracks[n]=t;t.onStart&&t.onStart(n);this.onStart&&this.onStart(n)},setAnimationByName:function(n,t,i){var r=this.data.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;return this.setAnimation(n,r,i)},setAnimation:function(n,i,r){var u=new t.TrackEntry;return u.animation=i,u.loop=r,u.endTime=i.duration,this.setCurrent(n,u),u},addAnimationByName:function(n,t,i,r){var u=this.data.skeletonData.findAnimation(t);if(!u)throw"Animation not found: "+t;return this.addAnimation(n,u,i,r)},addAnimation:function(n,i,r,u){var e=new t.TrackEntry,f;if(e.animation=i,e.loop=r,e.endTime=i.duration,f=this._expandToIndex(n),f){for(;f.next;)f=f.next;f.next=e}else this.tracks[n]=e;return 0>=u&&(f?u+=f.endTime-this.data.getMix(f.animation,i):u=0),e.delay=u,e},getCurrent:function(n){return n>=this.tracks.length?null:this.tracks[n]}};t.SkeletonJson=function(n){this.attachmentLoader=n};t.SkeletonJson.prototype={scale:1,readSkeletonData:function(n,i){var r=new t.SkeletonData,c,u,k,d,e,b,ct,s,f,h,a,nt,tt,it,v,rt,vt,ut,p,lt,ft,et,ot,w,st,ht;r.name=i;c=n.skeleton;c&&(r.hash=c.hash,r.version=c.spine,r.width=c.width||0,r.height=c.height||0);for(var y=n.bones,e=0,b=y.length;b>e;e++){if(u=y[e],k=null,u.parent&&(k=r.findBone(u.parent),!k))throw"Parent bone not found: "+u.parent;f=new t.BoneData(u.name,k);f.length=(u.length||0)*this.scale;f.x=(u.x||0)*this.scale;f.y=(u.y||0)*this.scale;f.rotation=u.rotation||0;f.scaleX=u.hasOwnProperty("scaleX")?u.scaleX:1;f.scaleY=u.hasOwnProperty("scaleY")?u.scaleY:1;f.inheritScale=u.hasOwnProperty("inheritScale")?u.inheritScale:!0;f.inheritRotation=u.hasOwnProperty("inheritRotation")?u.inheritRotation:!0;r.bones.push(f)}if(d=n.ik,d)for(e=0,b=d.length;b>e;e++){for(var o=d[e],l=new t.IkConstraintData(o.name),y=o.bones,g=0,yt=y.length;yt>g;g++){if(ct=r.findBone(y[g]),!ct)throw"IK bone not found: "+y[g];l.bones.push(ct)}if(l.target=r.findBone(o.target),!l.target)throw"Target bone not found: "+o.target;l.bendDirection=!o.hasOwnProperty("bendPositive")||o.bendPositive?1:-1;l.mix=o.hasOwnProperty("mix")?o.mix:1;r.ikConstraints.push(l)}for(var at=n.slots,e=0,b=at.length;b>e;e++){if(s=at[e],f=r.findBone(s.bone),!f)throw"Slot bone not found: "+s.bone;h=new t.SlotData(s.name,f);a=s.color;a&&(h.r=this.toColor(a,0),h.g=this.toColor(a,1),h.b=this.toColor(a,2),h.a=this.toColor(a,3));h.attachmentName=s.attachment;h.additiveBlending=s.additive&&"true"==s.additive;r.slots.push(h)}nt=n.skins;for(tt in nt)if(nt.hasOwnProperty(tt)){it=nt[tt];v=new t.Skin(tt);for(rt in it)if(it.hasOwnProperty(rt)){vt=r.findSlotIndex(rt);ut=it[rt];for(p in ut)ut.hasOwnProperty(p)&&(lt=this.readAttachment(v,p,ut[p]),lt&&v.addAttachment(vt,p,lt))}r.skins.push(v);"default"==v.name&&(r.defaultSkin=v)}ft=n.events;for(et in ft)ft.hasOwnProperty(et)&&(ot=ft[et],w=new t.EventData(et),w.intValue=ot.int||0,w.floatValue=ot.float||0,w.stringValue=ot.string||null,r.events.push(w));st=n.animations;for(ht in st)st.hasOwnProperty(ht)&&this.readAnimation(ht,st[ht],r);return r},readAttachment:function(n,i,r){var e,f,u,y,w;i=r.name||i;var a=t.AttachmentType[r.type||"region"],l=r.path||i,o=this.scale;if(a==t.AttachmentType.region)return(e=this.attachmentLoader.newRegionAttachment(n,i,l),!e)?null:(e.path=l,e.x=(r.x||0)*o,e.y=(r.y||0)*o,e.scaleX=r.hasOwnProperty("scaleX")?r.scaleX:1,e.scaleY=r.hasOwnProperty("scaleY")?r.scaleY:1,e.rotation=r.rotation||0,e.width=(r.width||0)*o,e.height=(r.height||0)*o,f=r.color,f&&(e.r=this.toColor(f,0),e.g=this.toColor(f,1),e.b=this.toColor(f,2),e.a=this.toColor(f,3)),e.updateOffset(),e);if(a==t.AttachmentType.mesh)return u=this.attachmentLoader.newMeshAttachment(n,i,l),u?(u.path=l,u.vertices=this.getFloatArray(r,"vertices",o),u.triangles=this.getIntArray(r,"triangles"),u.regionUVs=this.getFloatArray(r,"uvs",1),u.updateUVs(),f=r.color,f&&(u.r=this.toColor(f,0),u.g=this.toColor(f,1),u.b=this.toColor(f,2),u.a=this.toColor(f,3)),u.hullLength=2*(r.hull||0),r.edges&&(u.edges=this.getIntArray(r,"edges")),u.width=(r.width||0)*o,u.height=(r.height||0)*o,u):null;if(a==t.AttachmentType.skinnedmesh){if(u=this.attachmentLoader.newSkinnedMeshAttachment(n,i,l),!u)return null;u.path=l;for(var k=this.getFloatArray(r,"uvs",1),h=this.getFloatArray(r,"vertices",1),c=[],v=[],s=0,p=h.length;p>s;)for(y=0|h[s++],v[v.length]=y,w=s+4*y;w>s;)v[v.length]=h[s],c[c.length]=h[s+1]*o,c[c.length]=h[s+2]*o,c[c.length]=h[s+3],s+=4;return u.bones=v,u.weights=c,u.triangles=this.getIntArray(r,"triangles"),u.regionUVs=k,u.updateUVs(),f=r.color,f&&(u.r=this.toColor(f,0),u.g=this.toColor(f,1),u.b=this.toColor(f,2),u.a=this.toColor(f,3)),u.hullLength=2*(r.hull||0),r.edges&&(u.edges=this.getIntArray(r,"edges")),u.width=(r.width||0)*o,u.height=(r.height||0)*o,u}if(a==t.AttachmentType.boundingbox){for(var b=this.attachmentLoader.newBoundingBoxAttachment(n,i),h=r.vertices,s=0,p=h.length;p>s;s++)b.vertices.push(h[s]*o);return b}throw"Unknown attachment type: "+a;},readAnimation:function(n,i,r){var a=[],c=0,ii=i.slots,b,lt,tt,ut,at,l,s,vt,yt,u,pt,wt,ri,ui,hi,d,fi,bt,ei,kt,f,dt,v,oi,ft,nt,gt,k,ni,ot,ti,p,o,st,y,rt,ht;for(b in ii)if(ii.hasOwnProperty(b)){d=ii[b];p=r.findSlotIndex(b);for(l in d)if(d.hasOwnProperty(l))if(s=d[l],"color"==l){u=new t.ColorTimeline(s.length);u.slotIndex=p;for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],ct=f.color,ci=this.toColor(ct,0),li=this.toColor(ct,1),ai=this.toColor(ct,2),vi=this.toColor(ct,3);u.setFrame(h,f.time,ci,li,ai,vi);this.readCurve(u,h,f);h++}a.push(u);c=Math.max(c,u.frames[5*u.getFrameCount()-5])}else{if("attachment"!=l)throw"Invalid timeline type for a slot: "+l+" ("+b+")";u=new t.AttachmentTimeline(s.length);u.slotIndex=p;for(var h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h++,f.time,f.name);a.push(u);c=Math.max(c,u.frames[u.getFrameCount()-1])}}lt=i.bones;for(tt in lt)if(lt.hasOwnProperty(tt)){if(ut=r.findBoneIndex(tt),-1==ut)throw"Bone not found: "+tt;at=lt[tt];for(l in at)if(at.hasOwnProperty(l))if(s=at[l],"rotate"==l){u=new t.RotateTimeline(s.length);u.boneIndex=ut;for(var h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h,f.time,f.angle),this.readCurve(u,h,f),h++;a.push(u);c=Math.max(c,u.frames[2*u.getFrameCount()-2])}else if("translate"==l||"scale"==l){vt=1;"scale"==l?u=new t.ScaleTimeline(s.length):(u=new t.TranslateTimeline(s.length),vt=this.scale);u.boneIndex=ut;for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],yt=(f.x||0)*vt,yi=(f.y||0)*vt;u.setFrame(h,f.time,yt,yi);this.readCurve(u,h,f);h++}a.push(u);c=Math.max(c,u.frames[3*u.getFrameCount()-3])}else{if("flipX"!=l&&"flipY"!=l)throw"Invalid timeline type for a bone: "+l+" ("+tt+")";yt="flipX"==l;u=yt?new t.FlipXTimeline(s.length):new t.FlipYTimeline(s.length);u.boneIndex=ut;for(var pi=yt?"x":"y",h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h,f.time,f[pi]||!1),h++;a.push(u);c=Math.max(c,u.frames[2*u.getFrameCount()-2])}}pt=i.ik;for(wt in pt)if(pt.hasOwnProperty(wt)){var wi=r.findIkConstraint(wt),s=pt[wt],u=new t.IkConstraintTimeline(s.length);u.ikConstraintIndex=r.ikConstraints.indexOf(wi);for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],bi=f.hasOwnProperty("mix")?f.mix:1,ki=!f.hasOwnProperty("bendPositive")||f.bendPositive?1:-1;u.setFrame(h,f.time,bi,ki);this.readCurve(u,h,f);h++}a.push(u);c=Math.max(c,u.frames[3*u.frameCount-3])}ri=i.ffd;for(ui in ri){hi=r.findSkin(ui);d=ri[ui];for(b in d){p=r.findSlotIndex(b);fi=d[b];for(bt in fi){var s=fi[bt],u=new t.FfdTimeline(s.length),g=hi.getAttachment(p,bt);if(!g)throw"FFD attachment not found: "+bt;u.slotIndex=p;u.attachment=g;kt=g.type==t.AttachmentType.mesh;ei=kt?g.vertices.length:g.weights.length/3*2;for(var h=0,e=0,w=s.length;w>e;e++){if(f=s[e],f.vertices){if(dt=f.vertices,v=[],v.length=ei,oi=f.offset||0,ft=dt.length,1==this.scale)for(o=0;ft>o;o++)v[o+oi]=dt[o];else for(o=0;ft>o;o++)v[o+oi]=dt[o]*this.scale;if(kt)for(var di=g.vertices,o=0,ft=v.length;ft>o;o++)v[o]+=di[o]}else kt?v=g.vertices:(v=[],v.length=ei);u.setFrame(h,f.time,v);this.readCurve(u,h,f);h++}a[a.length]=u;c=Math.max(c,u.frames[u.frameCount-1])}}}if(nt=i.drawOrder,nt||(nt=i.draworder),nt){for(var u=new t.DrawOrderTimeline(nt.length),et=r.slots.length,h=0,e=0,w=nt.length;w>e;e++){if(gt=nt[e],k=null,gt.offsets){for(k=[],k.length=et,o=et-1;o>=0;o--)k[o]=-1;ni=gt.offsets;ot=[];ot.length=et-ni.length;for(var it=0,si=0,o=0,ft=ni.length;ft>o;o++){if(ti=ni[o],p=r.findSlotIndex(ti.slot),-1==p)throw"Slot not found: "+ti.slot;for(;it!=p;)ot[si++]=it++;k[it+ti.offset]=it++}for(;et>it;)ot[si++]=it++;for(o=et-1;o>=0;o--)-1==k[o]&&(k[o]=ot[--si])}u.setFrame(h++,gt.time,k)}a.push(u);c=Math.max(c,u.frames[u.getFrameCount()-1])}if(st=i.events,st){for(var u=new t.EventTimeline(st.length),h=0,e=0,w=st.length;w>e;e++){if(y=st[e],rt=r.findEvent(y.name),!rt)throw"Event not found: "+y.name;ht=new t.Event(rt);ht.intValue=y.hasOwnProperty("int")?y.int:rt.intValue;ht.floatValue=y.hasOwnProperty("float")?y.float:rt.floatValue;ht.stringValue=y.hasOwnProperty("string")?y.string:rt.stringValue;u.setFrame(h++,y.time,ht)}a.push(u);c=Math.max(c,u.frames[u.getFrameCount()-1])}r.animations.push(new t.Animation(n,a,c))},readCurve:function(n,t,i){var r=i.curve;r?"stepped"==r?n.curves.setStepped(t):r instanceof Array&&n.curves.setCurve(t,r[0],r[1],r[2],r[3]):n.curves.setLinear(t)},toColor:function(n,t){if(8!=n.length)throw"Color hexidecimal length must be 8, recieved: "+n;return parseInt(n.substring(2*t,2*t+2),16)/255},getFloatArray:function(n,i,r){var f=n[i],e=new t.Float32Array(f.length),u=0,o=f.length;if(1==r)for(;o>u;u++)e[u]=f[u];else for(;o>u;u++)e[u]=f[u]*r;return e},getIntArray:function(n,i){for(var u=n[i],f=new t.Uint16Array(u.length),r=0,e=u.length;e>r;r++)f[r]=0|u[r];return f}};t.Atlas=function(n,i){var e,r,u,o,f,s,h,c,l,a;for(this.textureLoader=i,this.pages=[],this.regions=[],e=new t.AtlasReader(n),r=[],r.length=4,u=null;;){if(o=e.readLine(),null===o)break;(o=e.trim(o),o.length)?u?(f=new t.AtlasRegion,f.name=o,f.page=u,f.rotate="true"==e.readValue(),e.readTuple(r),s=parseInt(r[0]),h=parseInt(r[1]),e.readTuple(r),c=parseInt(r[0]),l=parseInt(r[1]),f.u=s/u.width,f.v=h/u.height,f.rotate?(f.u2=(s+l)/u.width,f.v2=(h+c)/u.height):(f.u2=(s+c)/u.width,f.v2=(h+l)/u.height),f.x=s,f.y=h,f.width=Math.abs(c),f.height=Math.abs(l),4==e.readTuple(r)&&(f.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==e.readTuple(r)&&(f.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],e.readTuple(r))),f.originalWidth=parseInt(r[0]),f.originalHeight=parseInt(r[1]),e.readTuple(r),f.offsetX=parseInt(r[0]),f.offsetY=parseInt(r[1]),f.index=parseInt(e.readValue()),this.regions.push(f)):(u=new t.AtlasPage,u.name=o,2==e.readTuple(r)&&(u.width=parseInt(r[0]),u.height=parseInt(r[1]),e.readTuple(r)),u.format=t.Atlas.Format[r[0]],e.readTuple(r),u.minFilter=t.Atlas.TextureFilter[r[0]],u.magFilter=t.Atlas.TextureFilter[r[1]],a=e.readValue(),u.uWrap=t.Atlas.TextureWrap.clampToEdge,u.vWrap=t.Atlas.TextureWrap.clampToEdge,"x"==a?u.uWrap=t.Atlas.TextureWrap.repeat:"y"==a?u.vWrap=t.Atlas.TextureWrap.repeat:"xy"==a&&(u.uWrap=u.vWrap=t.Atlas.TextureWrap.repeat),i.load(u,o,this),this.pages.push(u)):u=null}};t.Atlas.prototype={findRegion:function(n){for(var i=this.regions,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},dispose:function(){for(var t=this.pages,n=0,i=t.length;i>n;n++)this.textureLoader.unload(t[n].rendererObject)},updateUVs:function(n){for(var t,r=this.regions,i=0,u=r.length;u>i;i++)t=r[i],t.page==n&&(t.u=t.x/n.width,t.v=t.y/n.height,t.rotate?(t.u2=(t.x+t.height)/n.width,t.v2=(t.y+t.width)/n.height):(t.u2=(t.x+t.width)/n.width,t.v2=(t.y+t.height)/n.height))}};t.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};t.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};t.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};t.AtlasPage=function(){};t.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};t.AtlasRegion=function(){};t.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};t.AtlasReader=function(n){this.lines=n.split(/\r\n|\r|\n/)};t.AtlasReader.prototype={index:0,trim:function(n){return n.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var n=this.readLine(),t=n.indexOf(":");if(-1==t)throw"Invalid line: "+n;return this.trim(n.substring(t+1))},readTuple:function(n){var r=this.readLine(),f=r.indexOf(":"),t,i,u;if(-1==f)throw"Invalid line: "+r;for(t=0,i=f+1;3>t;t++){if(u=r.indexOf(",",i),-1==u)break;n[t]=this.trim(r.substr(i,u-i));i=u+1}return n[t]=this.trim(r.substring(i)),t+1}};t.AtlasAttachmentLoader=function(n){this.atlas=n};t.AtlasAttachmentLoader.prototype={newRegionAttachment:function(n,i,r){var u=this.atlas.findRegion(r),f;if(!u)throw"Region not found in atlas: "+r+" (region attachment: "+i+")";return f=new t.RegionAttachment(i),f.rendererObject=u,f.setUVs(u.u,u.v,u.u2,u.v2,u.rotate),f.regionOffsetX=u.offsetX,f.regionOffsetY=u.offsetY,f.regionWidth=u.width,f.regionHeight=u.height,f.regionOriginalWidth=u.originalWidth,f.regionOriginalHeight=u.originalHeight,f},newMeshAttachment:function(n,i,r){var f=this.atlas.findRegion(r),u;if(!f)throw"Region not found in atlas: "+r+" (mesh attachment: "+i+")";return u=new t.MeshAttachment(i),u.rendererObject=f,u.regionU=f.u,u.regionV=f.v,u.regionU2=f.u2,u.regionV2=f.v2,u.regionRotate=f.rotate,u.regionOffsetX=f.offsetX,u.regionOffsetY=f.offsetY,u.regionWidth=f.width,u.regionHeight=f.height,u.regionOriginalWidth=f.originalWidth,u.regionOriginalHeight=f.originalHeight,u},newSkinnedMeshAttachment:function(n,i,r){var f=this.atlas.findRegion(r),u;if(!f)throw"Region not found in atlas: "+r+" (skinned mesh attachment: "+i+")";return u=new t.SkinnedMeshAttachment(i),u.rendererObject=f,u.regionU=f.u,u.regionV=f.v,u.regionU2=f.u2,u.regionV2=f.v2,u.regionRotate=f.rotate,u.regionOffsetX=f.offsetX,u.regionOffsetY=f.offsetY,u.regionWidth=f.width,u.regionHeight=f.height,u.regionOriginalWidth=f.originalWidth,u.regionOriginalHeight=f.originalHeight,u},newBoundingBoxAttachment:function(n,i){return new t.BoundingBoxAttachment(i)}};t.SkeletonBounds=function(){this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};t.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(n,i){var c=n.slots,v=c.length,y=n.x,p=n.y,l=this.boundingBoxes,e=this.polygonPool,o=this.polygons,a,r,h,u,f,s;for(l.length=0,r=0,a=o.length;a>r;r++)e.push(o[r]);for(o.length=0,r=0;v>r;r++)h=c[r],u=h.attachment,u.type==t.AttachmentType.boundingbox&&(l.push(u),s=e.length,s>0?(f=e[s-1],e.splice(s-1,1)):f=[],o.push(f),f.length=u.vertices.length,u.computeWorldVertices(y,p,h.bone,f));i&&this.aabbCompute()},aabbCompute:function(){for(var o,s,h=this.polygons,t=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MIN_VALUE,u=Number.MIN_VALUE,f=0,c=h.length;c>f;f++)for(var e=h[f],n=0,l=e.length;l>n;n+=2)o=e[n],s=e[n+1],t=Math.min(t,o),i=Math.min(i,s),r=Math.max(r,o),u=Math.max(u,s);this.minX=t;this.minY=i;this.maxX=r;this.maxY=u},aabbContainsPoint:function(n,t){return n>=this.minX&&n<=this.maxX&&t>=this.minY&&t<=this.maxY},aabbIntersectsSegment:function(n,t,i,r){var e=this.minX,o=this.minY,s=this.maxX,h=this.maxY,c,u,f;return e>=n&&e>=i||o>=t&&o>=r||n>=s&&i>=s||t>=h&&r>=h?!1:(c=(r-t)/(i-n),u=c*(e-n)+t,u>o&&h>u)?!0:(u=c*(s-n)+t,u>o&&h>u)?!0:(f=(o-t)/c+n,f>e&&s>f?!0:(f=(h-t)/c+n,f>e&&s>f?!0:!1))},aabbIntersectsSkeleton:function(n){return this.minX<n.maxX&&this.maxX>n.minX&&this.minY<n.maxY&&this.maxY>n.minY},containsPoint:function(n,t){for(var r=this.polygons,i=0,u=r.length;u>i;i++)if(this.polygonContainsPoint(r[i],n,t))return this.boundingBoxes[i];return null},intersectsSegment:function(n,t,i,r){for(var f=this.polygons,u=0,e=f.length;e>u;u++)if(f[u].intersectsSegment(n,t,i,r))return this.boundingBoxes[u];return null},polygonContainsPoint:function(n,t,i){for(var u,f,s,h=n.length,e=h-2,o=!1,r=0;h>r;r+=2)u=n[r+1],f=n[e+1],(i>u&&f>=i||i>f&&u>=i)&&(s=n[r],s+(i-u)/(f-u)*(n[e]-s)<t&&(o=!o)),e=r;return o},polygonIntersectsSegment:function(n,t,i,r,u){for(var f,a=n.length,v=t-r,y=i-u,p=t*u-i*r,o=n[a-2],s=n[a-1],l=0;a>l;l+=2){var h=n[l],c=n[l+1],w=o*c-s*h,b=o-h,k=s-c,d=v*k-y*b,e=(p*b-v*w)/d;if((e>=o&&h>=e||e>=h&&o>=e)&&(e>=t&&r>=e||e>=r&&t>=e)&&(f=(p*k-y*w)/d,(f>=s&&c>=f||f>=c&&s>=f)&&(f>=i&&u>=f||f>=u&&i>=f)))return!0;o=h;s=c}return!1},getPolygon:function(n){var t=this.boundingBoxes.indexOf(n);return-1==t?null:this.polygons[t]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};t.Bone.yDown=!0;n.AnimCache={};n.SpineTextureLoader=function(t,i){n.EventTarget.call(this);this.basePath=t;this.crossorigin=i;this.loadingCount=0};n.SpineTextureLoader.prototype=n.SpineTextureLoader;n.SpineTextureLoader.prototype.load=function(t,i){if(t.rendererObject=n.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!t.rendererObject.hasLoaded){var r=this;++r.loadingCount;t.rendererObject.addEventListener("loaded",function(){--r.loadingCount;r.dispatchEvent({type:"loadedBaseTexture",content:r})})}};n.SpineTextureLoader.prototype.unload=function(n){n.destroy(!0)};n.Spine=function(i){var f,h,c,o,s;if(n.DisplayObjectContainer.call(this),this.spineData=n.AnimCache[i],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+i);for(this.skeleton=new t.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new t.AnimationStateData(this.spineData),this.state=new t.AnimationState(this.stateData),this.slotContainers=[],f=0,h=this.skeleton.drawOrder.length;h>f;f++){var r=this.skeleton.drawOrder[f],u=r.attachment,e=new n.DisplayObjectContainer;if(this.slotContainers.push(e),this.addChild(e),u instanceof t.RegionAttachment)c=u.rendererObject.name,o=this.createSprite(r,u),r.currentSprite=o,r.currentSpriteName=c,e.addChild(o);else{if(!(u instanceof t.MeshAttachment))continue;s=this.createMesh(r,u);r.currentMesh=s;r.currentMeshName=u.name;e.addChild(s)}}this.autoUpdate=!0};n.Spine.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Spine.prototype.constructor=n.Spine;Object.defineProperty(n.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===n.Spine.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?n.Spine.prototype.autoUpdateTransform:n.DisplayObjectContainer.prototype.updateTransform}});n.Spine.prototype.update=function(i){var c,o,a,e,s,v;this.state.update(i);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();for(var l=this.skeleton.drawOrder,h=0,y=l.length;y>h;h++){var r=l[h],u=r.attachment,f=this.slotContainers[h];if(u){if(c=u.type,c===t.AttachmentType.region)u.rendererObject&&(!r.currentSpriteName||r.currentSpriteName!==u.name)&&(o=u.rendererObject.name,(void 0!==r.currentSprite&&(r.currentSprite.visible=!1),r.sprites=r.sprites||{},void 0!==r.sprites[o])?r.sprites[o].visible=!0:(a=this.createSprite(r,u),f.addChild(a)),r.currentSprite=r.sprites[o],r.currentSpriteName=o),e=r.bone,f.position.x=e.worldX+u.x*e.m00+u.y*e.m01,f.position.y=e.worldY+u.x*e.m10+u.y*e.m11,f.scale.x=e.worldScaleX,f.scale.y=e.worldScaleY,f.rotation=-(r.bone.worldRotation*t.degRad),r.currentSprite.tint=n.rgb2hex([r.r,r.g,r.b]);else{if(c!==t.AttachmentType.skinnedmesh){f.visible=!1;continue}r.currentMeshName&&r.currentMeshName===u.name||(s=u.name,(void 0!==r.currentMesh&&(r.currentMesh.visible=!1),r.meshes=r.meshes||{},void 0!==r.meshes[s])?r.meshes[s].visible=!0:(v=this.createMesh(r,u),f.addChild(v)),r.currentMesh=r.meshes[s],r.currentMeshName=s);u.computeWorldVertices(r.bone.skeleton.x,r.bone.skeleton.y,r,r.currentMesh.vertices)}f.visible=!0;f.alpha=r.a}else f.visible=!1}};n.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now();this.update(t);n.DisplayObjectContainer.prototype.updateTransform.call(this)};n.Spine.prototype.createSprite=function(i,r){var u=r.rendererObject,e=u.page.rendererObject,o=new n.Rectangle(u.x,u.y,u.rotate?u.height:u.width,u.rotate?u.width:u.height),s=new n.Texture(e,o),f=new n.Sprite(s),h=u.rotate?.5*Math.PI:0;return f.scale.set(u.width/u.originalWidth,u.height/u.originalHeight),f.rotation=h-r.rotation*t.degRad,f.anchor.x=f.anchor.y=.5,i.sprites=i.sprites||{},i.sprites[u.name]=f,f};n.Spine.prototype.createMesh=function(t,i){var u=i.rendererObject,f=u.page.rendererObject,e=new n.Texture(f),r=new n.Strip(e);return r.drawMode=n.Strip.DrawModes.TRIANGLES,r.canvasPadding=1.5,r.vertices=new n.Float32Array(i.uvs.length),r.uvs=i.uvs,r.indices=i.triangles,t.meshes=t.meshes||{},t.meshes[i.name]=r,r};n.BaseTextureCache={};n.BaseTextureCacheIdGenerator=0;n.BaseTexture=function(t,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=n._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var r=this;this.source.onload=function(){r.hasLoaded=!0;r.width=r.source.naturalWidth||r.source.width;r.height=r.source.naturalHeight||r.source.height;r.dirty();r.dispatchEvent({type:"loaded",content:r})};this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null;this._powerOf2=!1}};n.BaseTexture.prototype.constructor=n.BaseTexture;n.EventTarget.mixin(n.BaseTexture.prototype);n.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId];this.source=null;this.unloadFromGPU()};n.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1;this.source.src=null;this.source.src=n};n.BaseTexture.prototype.dirty=function(){for(var n=0;n<this._glTextures.length;n++)this._dirty[n]=!0};n.BaseTexture.prototype.unloadFromGPU=function(){var t,i,r;for(this.dirty(),t=this._glTextures.length-1;t>=0;t--)i=this._glTextures[t],r=n.glContexts[t],r&&i&&r.deleteTexture(i);this._glTextures.length=0;this.dirty()};n.BaseTexture.fromImage=function(t,i,r){var u=n.BaseTextureCache[t],f;return(void 0===i&&-1===t.indexOf("data:")&&(i=!0),u)||(f=new Image,i&&(f.crossOrigin=""),f.src=t,u=new n.BaseTexture(f,r),u.imageUrl=t,n.BaseTextureCache[t]=u,-1!==t.indexOf(n.RETINA_PREFIX+".")&&(u.resolution=2)),u};n.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.BaseTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r};n.TextureCache={};n.FrameCache={};n.TextureCacheIdGenerator=0;n.Texture=function(t,i,r,u){this.noFrame=!1;i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1));t instanceof n.Texture&&(t=t.baseTexture);this.baseTexture=t;this.frame=i;this.trim=u;this.valid=!1;this.requiresUpdate=!1;this._uvs=null;this.width=0;this.height=0;this.crop=r||new n.Rectangle(0,0,1,1);t.hasLoaded?(this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))};n.Texture.prototype.constructor=n.Texture;n.EventTarget.mixin(n.Texture.prototype);n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height));this.setFrame(this.frame);this.dispatchEvent({type:"update",content:this})};n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy();this.valid=!1};n.Texture.prototype.setFrame=function(n){if(this.noFrame=!1,this.frame=n,this.width=n.width,this.height=n.height,this.crop.x=n.x,this.crop.y=n.y,this.crop.width=n.width,this.crop.height=n.height,!this.trim&&(n.x+n.width>this.baseTexture.width||n.y+n.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=n&&n.width&&n.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&this._updateUvs()};n.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.width)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.width)/i;this._uvs.y2=(t.y+t.height)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.height)/r};n.Texture.fromImage=function(t,i,r){var u=n.TextureCache[t];return u||(u=new n.Texture(n.BaseTexture.fromImage(t,i,r)),n.TextureCache[t]=u),u};n.Texture.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i};n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)};n.Texture.addTextureToCache=function(t,i){n.TextureCache[i]=t};n.Texture.removeTextureFromCache=function(t){var i=n.TextureCache[t];return delete n.TextureCache[t],delete n.BaseTextureCache[t],i};n.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};n.Texture.emptyTexture=new n.Texture(new n.BaseTexture);n.RenderTexture=function(t,i,r,u,f){if(this.width=t||100,this.height=i||100,this.resolution=f||1,this.frame=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=u||n.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,n.Texture.call(this,this.baseTexture,new n.Rectangle(0,0,this.width,this.height)),this.renderer=r||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var e=this.renderer.gl;this.baseTexture._dirty[e.id]=!1;this.textureBuffer=new n.FilterTexture(e,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode);this.baseTexture._glTextures[e.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new n.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0;this._updateUvs()};n.RenderTexture.prototype=Object.create(n.Texture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===n.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))};n.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===n.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};n.RenderTexture.prototype.renderWebGL=function(n,t,i){var r,u;if(this.valid){r=n.worldTransform;r.identity();r.translate(0,2*this.projection.y);t&&r.append(t);r.scale(1,-1);n.worldAlpha=1;for(var e=n.children,f=0,o=e.length;o>f;f++)e[f].updateTransform();u=this.renderer.gl;u.viewport(0,0,this.width*this.resolution,this.height*this.resolution);u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer);i&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(n,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=!0}};n.RenderTexture.prototype.renderCanvas=function(n,t,i){var r,e,o;if(this.valid){r=n.worldTransform;r.identity();t&&r.append(t);n.worldAlpha=1;for(var f=n.children,u=0,s=f.length;s>u;u++)f[u].updateTransform();i&&this.textureBuffer.clear();e=this.textureBuffer.context;o=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(n,e);this.renderer.resolution=o}};n.RenderTexture.prototype.getImage=function(){var n=new Image;return n.src=this.getBase64(),n};n.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};n.RenderTexture.prototype.getCanvas=function(){var u,f;if(this.renderer.type===n.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,e=new Uint8Array(4*i*r);return t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,e),t.bindFramebuffer(t.FRAMEBUFFER,null),u=new n.CanvasBuffer(i,r),f=u.context.getImageData(0,0,i,r),f.data.set(e),u.context.putImageData(f,0,0),u.canvas}return this.textureBuffer.canvas};n.RenderTexture.tempMatrix=new n.Matrix;n.VideoTexture=function(t,i){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0);n.BaseTexture.call(this,t,i);this.autoUpdate=!1;this.updateBound=this._onUpdate.bind(this);t.complete||(this._onCanPlay=this.onCanPlay.bind(this),t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this.onPlayStart.bind(this)),t.addEventListener("pause",this.onPlayStop.bind(this)))};n.VideoTexture.prototype=Object.create(n.BaseTexture.prototype);n.VideoTexture.constructor=n.VideoTexture;n.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())};n.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)};n.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1};n.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))};n.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(n.BaseTextureCache[this.source._pixiId]=null,delete n.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId);n.BaseTexture.prototype.destroy.call(this)};n.VideoTexture.baseTextureFromVideo=function(t,i){t._pixiId||(t._pixiId="video_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.VideoTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r};n.VideoTexture.textureFromVideo=function(t,i){var r=n.VideoTexture.baseTextureFromVideo(t,i);return new n.Texture(r)};n.VideoTexture.fromUrl=function(t,i){var r=document.createElement("video");return r.src=t,r.autoPlay=!0,r.play(),n.VideoTexture.textureFromVideo(r,i)};n.AssetLoader=function(t,i){this.assetURLs=t;this.crossorigin=i;this.loadersByType={jpg:n.ImageLoader,jpeg:n.ImageLoader,png:n.ImageLoader,gif:n.ImageLoader,webp:n.ImageLoader,json:n.JsonLoader,atlas:n.AtlasLoader,anim:n.SpineLoader,xml:n.BitmapFontLoader,fnt:n.BitmapFontLoader}};n.EventTarget.mixin(n.AssetLoader.prototype);n.AssetLoader.prototype.constructor=n.AssetLoader;n.AssetLoader.prototype._getDataType=function(n){var i="data:",f=n.slice(0,i.length).toLowerCase(),r,u,t;return f===i?(r=n.slice(i.length),u=r.indexOf(","),-1===u)?null:(t=r.slice(0,u).split(";")[0],t&&"text/plain"!==t.toLowerCase()?t.split("/").pop().toLowerCase():"txt"):null};n.AssetLoader.prototype.load=function(){function f(n){e.onAssetLoaded(n.data.content)}var e=this,t,i,n,r,u;for(this.loadCount=this.assetURLs.length,t=0;t<this.assetURLs.length;t++){if(i=this.assetURLs[t],n=this._getDataType(i),n||(n=i.split("?").shift().split(".").pop().toLowerCase()),r=this.loadersByType[n],!r)throw new Error(n+" is an unsupported file type");u=new r(i,this.crossorigin);u.on("loaded",f);u.load()}};n.AssetLoader.prototype.onAssetLoaded=function(n){this.loadCount--;this.emit("onProgress",{content:this,loader:n});this.onProgress&&this.onProgress(n);this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())};n.JsonLoader=function(n,t){this.url=n;this.crossorigin=t;this.baseUrl=n.replace(/[^\/]*$/,"");this.loaded=!1};n.JsonLoader.prototype.constructor=n.JsonLoader;n.EventTarget.mixin(n.JsonLoader.prototype);n.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this));this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.send()};n.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()};n.JsonLoader.prototype.onJSONLoaded=function(){var r,u,o,s;if(!this.ajaxRequest.responseText)return this.onError(),void 0;if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this.baseUrl+this.json.meta.image,e=new n.ImageLoader(a,this.crossorigin),f=this.json.frames;this.texture=e.texture.baseTexture;e.addEventListener("loaded",this.onLoaded.bind(this));for(r in f)if(u=f[r].frame,u){var c=new n.Rectangle(u.x,u.y,u.w,u.h),v=c.clone(),l=null;f[r].trimmed&&(o=f[r].sourceSize,s=f[r].spriteSourceSize,l=new n.Rectangle(s.x,s.y,o.w,o.h));n.TextureCache[r]=new n.Texture(this.texture,c,v,l)}e.load()}else if(this.json.bones)if(n.AnimCache[this.url])this.onLoaded();else{var y=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",h=new n.JsonLoader(y,this.crossorigin),i=this;h.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return this.onError(),void 0;var r=new n.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),u=new t.Atlas(this.ajaxRequest.responseText,r),e=new t.AtlasAttachmentLoader(u),o=new t.SkeletonJson(e),f=o.readSkeletonData(i.json);n.AnimCache[i.url]=f;i.spine=f;i.spineAtlas=u;i.spineAtlasLoader=h;r.loadingCount>0?r.addEventListener("loadedBaseTexture",function(n){n.content.content.loadingCount<=0&&i.onLoaded()}):i.onLoaded()};h.load()}else this.onLoaded()};n.JsonLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};n.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})};n.AtlasLoader=function(n,t){this.url=n;this.baseUrl=n.replace(/[^\/]*$/,"");this.crossorigin=t;this.loaded=!1};n.AtlasLoader.constructor=n.AtlasLoader;n.EventTarget.mixin(n.AtlasLoader.prototype);n.AtlasLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)};n.AtlasLoader.prototype.onAtlasLoaded=function(){var e,h,a,s,o;if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var u=this.ajaxRequest.responseText.split(/\r?\n/),f=-3,c=0,i=null,l=!1,t=0,r=0,v=this.onLoaded.bind(this),t=0;t<u.length;t++)(u[t]=u[t].replace(/^\s+|\s+$/g,""),""===u[t]&&(l=t+1),u[t].length>0)&&(l===t?(this.atlas.meta.image.push(u[t]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),f=-3):f>0&&(f%7==1?(null!=i&&(this.atlas.frames[c][i.name]=i),i={name:u[t],frame:{}}):(e=u[t].split(" "),f%7==3?(i.frame.x=Number(e[1].replace(",","")),i.frame.y=Number(e[2])):f%7==4?(i.frame.w=Number(e[1].replace(",","")),i.frame.h=Number(e[2])):f%7==5&&(h={x:0,y:0,w:Number(e[1].replace(",","")),h:Number(e[2])},h.w>i.frame.w||h.h>i.frame.h?(i.trimmed=!0,i.realSize=h):i.trimmed=!1))),f++);if(null!=i&&(this.atlas.frames[c][i.name]=i),this.atlas.meta.image.length>0){for(this.images=[],r=0;r<this.atlas.meta.image.length;r++){a=this.baseUrl+this.atlas.meta.image[r];s=this.atlas.frames[r];this.images.push(new n.ImageLoader(a,this.crossorigin));for(t in s)o=s[t].frame,o&&(n.TextureCache[t]=new n.Texture(this.images[r].texture.baseTexture,{x:o.x,y:o.y,width:o.w,height:o.h}),s[t].trimmed&&(n.TextureCache[t].realSize=s[t].realSize,n.TextureCache[t].trim.x=0,n.TextureCache[t].trim.y=0))}for(this.currentImageId=0,r=0;r<this.images.length;r++)this.images[r].on("loaded",v);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()};n.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))};n.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})};n.SpriteSheetLoader=function(n,t){this.url=n;this.crossorigin=t;this.baseUrl=n.replace(/[^\/]*$/,"");this.texture=null;this.frames={}};n.SpriteSheetLoader.prototype.constructor=n.SpriteSheetLoader;n.EventTarget.mixin(n.SpriteSheetLoader.prototype);n.SpriteSheetLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(n){t.json=n.data.content.json;t.onLoaded()});i.load()};n.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};n.ImageLoader=function(t,i){this.texture=n.Texture.fromImage(t,i);this.frames=[]};n.ImageLoader.prototype.constructor=n.ImageLoader;n.EventTarget.mixin(n.ImageLoader.prototype);n.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))};n.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};n.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,r){var u,e;this.frames=[];for(var s=Math.floor(this.texture.width/t),h=Math.floor(this.texture.height/i),o=0,f=0;h>f;f++)for(u=0;s>u;u++,o++)e=new n.Texture(this.texture.baseTexture,{x:u*t,y:f*i,width:t,height:i}),this.frames.push(e),r&&(n.TextureCache[r+"-"+o]=e);this.load()};n.BitmapFontLoader=function(n,t){this.url=n;this.crossorigin=t;this.baseUrl=n.replace(/[^\/]*$/,"");this.texture=null};n.BitmapFontLoader.prototype.constructor=n.BitmapFontLoader;n.EventTarget.mixin(n.BitmapFontLoader.prototype);n.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest;this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml");this.ajaxRequest.send(null)};n.BitmapFontLoader.prototype.onXMLLoaded=function(){var r,h,o,c,e,i,t,s,a,f;if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){r=this.ajaxRequest.responseXML;(!r||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)&&("function"==typeof DOMParser?(h=new DOMParser,r=h.parseFromString(this.ajaxRequest.responseText,"text/xml")):(o=document.createElement("div"),o.innerHTML=this.ajaxRequest.responseText,r=o));c=this.baseUrl+r.getElementsByTagName("page")[0].getAttribute("file");e=new n.ImageLoader(c,this.crossorigin);this.texture=e.texture.baseTexture;var u={},l=r.getElementsByTagName("info")[0],v=r.getElementsByTagName("common")[0];for(u.font=l.getAttribute("face"),u.size=parseInt(l.getAttribute("size"),10),u.lineHeight=parseInt(v.getAttribute("lineHeight"),10),u.chars={},i=r.getElementsByTagName("char"),t=0;t<i.length;t++)s=parseInt(i[t].getAttribute("id"),10),a=new n.Rectangle(parseInt(i[t].getAttribute("x"),10),parseInt(i[t].getAttribute("y"),10),parseInt(i[t].getAttribute("width"),10),parseInt(i[t].getAttribute("height"),10)),u.chars[s]={xOffset:parseInt(i[t].getAttribute("xoffset"),10),yOffset:parseInt(i[t].getAttribute("yoffset"),10),xAdvance:parseInt(i[t].getAttribute("xadvance"),10),kerning:{},texture:n.TextureCache[s]=new n.Texture(this.texture,a)};for(f=r.getElementsByTagName("kerning"),t=0;t<f.length;t++){var y=parseInt(f[t].getAttribute("first"),10),p=parseInt(f[t].getAttribute("second"),10),w=parseInt(f[t].getAttribute("amount"),10);u.chars[p].kerning[y]=w}n.BitmapText.fonts[u.font]=u;e.addEventListener("loaded",this.onLoaded.bind(this));e.load()}};n.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})};n.SpineLoader=function(n,t){this.url=n;this.crossorigin=t;this.loaded=!1};n.SpineLoader.prototype.constructor=n.SpineLoader;n.EventTarget.mixin(n.SpineLoader.prototype);n.SpineLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(n){t.json=n.data.content.json;t.onLoaded()});i.load()};n.SpineLoader.prototype.onLoaded=function(){this.loaded=!0;this.emit("loaded",{content:this})};n.AbstractFilter=function(n,t){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=t||{};this.fragmentSrc=n||[]};n.AbstractFilter.prototype.constructor=n.AbstractFilter;n.AbstractFilter.prototype.syncUniforms=function(){for(var n=0,t=this.shaders.length;t>n;n++)this.shaders[n].dirty=!0};n.AlphaMaskFilter=function(t){n.AbstractFilter.call(this);this.passes=[this];t.baseTexture._powerOf2=!0;this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};t.baseTexture.hasLoaded?(this.uniforms.mask.value.x=t.width,this.uniforms.mask.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]};n.AlphaMaskFilter.prototype=Object.create(n.AbstractFilter.prototype);n.AlphaMaskFilter.prototype.constructor=n.AlphaMaskFilter;n.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height;this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(n.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(n){this.uniforms.mask.value=n}});n.ColorMatrixFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]};n.ColorMatrixFilter.prototype=Object.create(n.AbstractFilter.prototype);n.ColorMatrixFilter.prototype.constructor=n.ColorMatrixFilter;Object.defineProperty(n.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(n){this.uniforms.matrix.value=n}});n.GrayFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={gray:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]};n.GrayFilter.prototype=Object.create(n.AbstractFilter.prototype);n.GrayFilter.prototype.constructor=n.GrayFilter;Object.defineProperty(n.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(n){this.uniforms.gray.value=n}});n.DisplacementFilter=function(t){n.AbstractFilter.call(this);this.passes=[this];t.baseTexture._powerOf2=!0;this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]};n.DisplacementFilter.prototype=Object.create(n.AbstractFilter.prototype);n.DisplacementFilter.prototype.constructor=n.DisplacementFilter;n.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height;this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(n.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(n){this.uniforms.displacementMap.value=n}});Object.defineProperty(n.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.uniforms.scale.value=n}});Object.defineProperty(n.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.uniforms.offset.value=n}});n.PixelateFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new n.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]};n.PixelateFilter.prototype=Object.create(n.AbstractFilter.prototype);n.PixelateFilter.prototype.constructor=n.PixelateFilter;Object.defineProperty(n.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(n){this.dirty=!0;this.uniforms.pixelSize.value=n}});n.BlurXFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]};n.BlurXFilter.prototype=Object.create(n.AbstractFilter.prototype);n.BlurXFilter.prototype.constructor=n.BlurXFilter;Object.defineProperty(n.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.dirty=!0;this.uniforms.blur.value=1/7e3*n}});n.BlurYFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]};n.BlurYFilter.prototype=Object.create(n.AbstractFilter.prototype);n.BlurYFilter.prototype.constructor=n.BlurYFilter;Object.defineProperty(n.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}});n.BlurFilter=function(){this.blurXFilter=new n.BlurXFilter;this.blurYFilter=new n.BlurYFilter;this.passes=[this.blurXFilter,this.blurYFilter]};n.BlurFilter.prototype=Object.create(n.AbstractFilter.prototype);n.BlurFilter.prototype.constructor=n.BlurFilter;Object.defineProperty(n.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=this.blurYFilter.blur=n}});Object.defineProperty(n.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=n}});Object.defineProperty(n.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(n){this.blurYFilter.blur=n}});n.InvertFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]};n.InvertFilter.prototype=Object.create(n.AbstractFilter.prototype);n.InvertFilter.prototype.constructor=n.InvertFilter;Object.defineProperty(n.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(n){this.uniforms.invert.value=n}});n.SepiaFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={sepia:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]};n.SepiaFilter.prototype=Object.create(n.AbstractFilter.prototype);n.SepiaFilter.prototype.constructor=n.SepiaFilter;Object.defineProperty(n.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(n){this.uniforms.sepia.value=n}});n.TwistFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]};n.TwistFilter.prototype=Object.create(n.AbstractFilter.prototype);n.TwistFilter.prototype.constructor=n.TwistFilter;Object.defineProperty(n.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.dirty=!0;this.uniforms.offset.value=n}});Object.defineProperty(n.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(n){this.dirty=!0;this.uniforms.radius.value=n}});Object.defineProperty(n.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0;this.uniforms.angle.value=n}});n.ColorStepFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={step:{type:"1f",value:5}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]};n.ColorStepFilter.prototype=Object.create(n.AbstractFilter.prototype);n.ColorStepFilter.prototype.constructor=n.ColorStepFilter;Object.defineProperty(n.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(n){this.uniforms.step.value=n}});n.DotScreenFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};n.DotScreenFilter.prototype=Object.create(n.AbstractFilter.prototype);n.DotScreenFilter.prototype.constructor=n.DotScreenFilter;Object.defineProperty(n.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.dirty=!0;this.uniforms.scale.value=n}});Object.defineProperty(n.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0;this.uniforms.angle.value=n}});n.CrossHatchFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]};n.CrossHatchFilter.prototype=Object.create(n.AbstractFilter.prototype);n.CrossHatchFilter.prototype.constructor=n.CrossHatchFilter;Object.defineProperty(n.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}});n.RGBSplitFilter=function(){n.AbstractFilter.call(this);this.passes=[this];this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]};n.RGBSplitFilter.prototype=Object.create(n.AbstractFilter.prototype);n.RGBSplitFilter.prototype.constructor=n.RGBSplitFilter;Object.defineProperty(n.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(n){this.uniforms.red.value=n}});Object.defineProperty(n.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(n){this.uniforms.green.value=n}});Object.defineProperty(n.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(n){this.uniforms.blue.value=n}});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.PIXI=n):"undefined"!=typeof define&&define.amd?define(n):i.PIXI=n}).call(this),function(){"use strict";var u=this,r,n,s,t,f,h;r=typeof exports!="undefined"?exports:u.Springy={};var i=r.Graph=function(){this.nodeSet={};this.nodes=[];this.edges=[];this.adjacency={};this.nextNodeId=0;this.nextEdgeId=0;this.eventListeners=[]},e=r.Node=function(n,t){this.id=n;this.data=t!==undefined?t:{}},o=r.Edge=function(n,t,i,r){this.id=n;this.source=t;this.target=i;this.data=r!==undefined?r:{}};i.prototype.addNode=function(n){return n.id in this.nodeSet||this.nodes.push(n),this.nodeSet[n.id]=n,this.notify(),n};i.prototype.addNodes=function(){for(var t,i,n=0;n<arguments.length;n++)t=arguments[n],i=new e(t,{label:t}),this.addNode(i)};i.prototype.addEdge=function(n){var t=!1;return this.edges.forEach(function(i){n.id===i.id&&(t=!0)}),t||this.edges.push(n),n.source.id in this.adjacency||(this.adjacency[n.source.id]={}),n.target.id in this.adjacency[n.source.id]||(this.adjacency[n.source.id][n.target.id]=[]),t=!1,this.adjacency[n.source.id][n.target.id].forEach(function(i){n.id===i.id&&(t=!0)}),t||this.adjacency[n.source.id][n.target.id].push(n),this.notify(),n};i.prototype.addEdges=function(){for(var n,i,r,u,t=0;t<arguments.length;t++){if(n=arguments[t],i=this.nodeSet[n[0]],i==undefined)throw new TypeError("invalid node name: "+n[0]);if(r=this.nodeSet[n[1]],r==undefined)throw new TypeError("invalid node name: "+n[1]);u=n[2];this.newEdge(i,r,u)}};i.prototype.newNode=function(n){var t=new e(this.nextNodeId++,n);return this.addNode(t),t};i.prototype.newEdge=function(n,t,i){var r=new o(this.nextEdgeId++,n,t,i);return this.addEdge(r),r};i.prototype.loadJSON=function(n){(typeof n=="string"||n instanceof String)&&(n=JSON.parse(n));("nodes"in n||"edges"in n)&&(this.addNodes.apply(this,n.nodes),this.addEdges.apply(this,n.edges))};i.prototype.getEdges=function(n,t){return n.id in this.adjacency&&t.id in this.adjacency[n.id]?this.adjacency[n.id][t.id]:[]};i.prototype.removeNode=function(n){n.id in this.nodeSet&&delete this.nodeSet[n.id];for(var t=this.nodes.length-1;t>=0;t--)this.nodes[t].id===n.id&&this.nodes.splice(t,1);this.detachNode(n)};i.prototype.detachNode=function(n){var t=this.edges.slice();t.forEach(function(t){(t.source.id===n.id||t.target.id===n.id)&&this.removeEdge(t)},this);this.notify()};i.prototype.removeEdge=function(n){for(var t,i,f,u,r=this.edges.length-1;r>=0;r--)this.edges[r].id===n.id&&this.edges.splice(r,1);for(t in this.adjacency){for(i in this.adjacency[t]){for(f=this.adjacency[t][i],u=f.length-1;u>=0;u--)this.adjacency[t][i][u].id===n.id&&this.adjacency[t][i].splice(u,1);this.adjacency[t][i].length==0&&delete this.adjacency[t][i]}h(this.adjacency[t])&&delete this.adjacency[t]}this.notify()};i.prototype.merge=function(n){var t=[];n.nodes.forEach(function(n){t.push(this.addNode(new e(n.id,n.data)))},this);n.edges.forEach(function(n){var i=t[n.from],r=t[n.to],u=n.directed?u=n.type+"-"+i.id+"-"+r.id:i.id<r.id?n.type+"-"+i.id+"-"+r.id:n.type+"-"+r.id+"-"+i.id,f=this.addEdge(new o(u,i,r,n.data));f.data.type=n.type},this)};i.prototype.filterNodes=function(n){var t=this.nodes.slice();t.forEach(function(t){n(t)||this.removeNode(t)},this)};i.prototype.filterEdges=function(n){var t=this.edges.slice();t.forEach(function(t){n(t)||this.removeEdge(t)},this)};i.prototype.addGraphListener=function(n){this.eventListeners.push(n)};i.prototype.notify=function(){this.eventListeners.forEach(function(n){n.graphChanged()})};n=r.Layout={};n.ForceDirected=function(n,t,i,r){this.graph=n;this.stiffness=t;this.repulsion=i;this.damping=r;this.nodePoints={};this.edgeSprings={}};n.ForceDirected.prototype.point=function(i){if(!(i.id in this.nodePoints)){var r=i.data.mass!==undefined?i.data.mass:1;this.nodePoints[i.id]=new n.ForceDirected.Point(t.random(),r)}return this.nodePoints[i.id]};n.ForceDirected.prototype.spring=function(t){var f;if(!(t.id in this.edgeSprings)){var u=t.data.length!==undefined?t.data.length:1,i=!1,r=this.graph.getEdges(t.source,t.target);if(r.forEach(function(n){i===!1&&n.id in this.edgeSprings&&(i=this.edgeSprings[n.id])},this),i!==!1)return new n.ForceDirected.Spring(i.point1,i.point2,0,0);if(f=this.graph.getEdges(t.target,t.source),r.forEach(function(n){i===!1&&n.id in this.edgeSprings&&(i=this.edgeSprings[n.id])},this),i!==!1)return new n.ForceDirected.Spring(i.point2,i.point1,0,0);this.edgeSprings[t.id]=new n.ForceDirected.Spring(this.point(t.source),this.point(t.target),u,this.stiffness)}return this.edgeSprings[t.id]};n.ForceDirected.prototype.eachNode=function(n){var t=this;this.graph.nodes.forEach(function(i){n.call(t,i,t.point(i))})};n.ForceDirected.prototype.eachEdge=function(n){var t=this;this.graph.edges.forEach(function(i){n.call(t,i,t.spring(i))})};n.ForceDirected.prototype.eachSpring=function(n){var t=this;this.graph.edges.forEach(function(i){n.call(t,t.spring(i))})};n.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(n,t){this.eachNode(function(n,i){if(t!==i){var u=t.p.subtract(i.p),r=u.magnitude()+.1,f=u.normalise();t.applyForce(f.multiply(this.repulsion).divide(r*r*.5));i.applyForce(f.multiply(this.repulsion).divide(r*r*-.5))}})})};n.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(n){var t=n.point2.p.subtract(n.point1.p),i=n.length-t.magnitude(),r=t.normalise();n.point1.applyForce(r.multiply(n.k*i*-.5));n.point2.applyForce(r.multiply(n.k*i*.5))})};n.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(n,t){var i=t.p.multiply(-1);t.applyForce(i.multiply(this.repulsion/50))})};n.ForceDirected.prototype.updateVelocity=function(n){this.eachNode(function(i,r){r.v=r.v.add(r.a.multiply(n)).multiply(this.damping);r.a=new t(0,0)})};n.ForceDirected.prototype.updatePosition=function(n){this.eachNode(function(t,i){i.p=i.p.add(i.v.multiply(n))})};n.ForceDirected.prototype.totalEnergy=function(){var n=0;return this.eachNode(function(t,i){var r=i.v.magnitude();n+=.5*i.m*r*r}),n};s=function(n,t){return function(){return n.apply(t,arguments)}};r.requestAnimationFrame=s(u.requestAnimationFrame||u.webkitRequestAnimationFrame||u.mozRequestAnimationFrame||u.oRequestAnimationFrame||u.msRequestAnimationFrame||function(n){u.setTimeout(n,10)},u);n.ForceDirected.prototype.start=function(n,t,i){var u=this;this._started||(this._started=!0,this._stop=!1,i!==undefined&&i(),r.requestAnimationFrame(function f(){u.applyCoulombsLaw();u.applyHookesLaw();u.attractToCentre();u.updateVelocity(.03);u.updatePosition(.03);n!==undefined&&n();u._stop||u.totalEnergy()<.01?(u._started=!1,t!==undefined&&t()):r.requestAnimationFrame(f)}))};n.ForceDirected.prototype.stop=function(){this._stop=!0};n.ForceDirected.prototype.nearest=function(n){var t={node:null,point:null,distance:null},i=this;return this.graph.nodes.forEach(function(r){var u=i.point(r),f=u.p.subtract(n).magnitude();(t.distance===null||f<t.distance)&&(t={node:r,point:u,distance:f})}),t};n.ForceDirected.prototype.getBoundingBox=function(){var n=new t(-2,-2),i=new t(2,2),r;return this.eachNode(function(t,r){r.p.x<n.x&&(n.x=r.p.x);r.p.y<n.y&&(n.y=r.p.y);r.p.x>i.x&&(i.x=r.p.x);r.p.y>i.y&&(i.y=r.p.y)}),r=i.subtract(n).multiply(.07),{bottomleft:n.subtract(r),topright:i.add(r)}};t=r.Vector=function(n,t){this.x=n;this.y=t};t.random=function(){return new t(10*(Math.random()-.5),10*(Math.random()-.5))};t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)};t.prototype.subtract=function(n){return new t(this.x-n.x,this.y-n.y)};t.prototype.multiply=function(n){return new t(this.x*n,this.y*n)};t.prototype.divide=function(n){return new t(this.x/n||0,this.y/n||0)};t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};t.prototype.normal=function(){return new t(-this.y,this.x)};t.prototype.normalise=function(){return this.divide(this.magnitude())};n.ForceDirected.Point=function(n,i){this.p=n;this.m=i;this.v=new t(0,0);this.a=new t(0,0)};n.ForceDirected.Point.prototype.applyForce=function(n){this.a=this.a.add(n.divide(this.m))};n.ForceDirected.Spring=function(n,t,i,r){this.point1=n;this.point2=t;this.length=i;this.k=r};f=r.Renderer=function(n,t,i,r,u,f){this.layout=n;this.clear=t;this.drawEdge=i;this.drawNode=r;this.onRenderStop=u;this.onRenderStart=f;this.layout.graph.addGraphListener(this)};f.prototype.graphChanged=function(){this.start()};f.prototype.start=function(){var n=this;this.layout.start(function(){n.clear();n.layout.eachEdge(function(t,i){n.drawEdge(t,i.point1.p,i.point2.p)});n.layout.eachNode(function(t,i){n.drawNode(t,i.p)})},this.onRenderStart,this.onRenderStop)};f.prototype.stop=function(){this.layout.stop()};Array.prototype.forEach||(Array.prototype.forEach=function(n,t){var u,i,r,f,e;if(this==null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,{}.toString.call(n)!="[object Function]")throw new TypeError(n+" is not a function");for(t&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++});h=function(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0}}.call(this),function(){jQuery.fn.springy=function(n){function l(n,t,i,r){var f=(r.y-i.y)*(t.x-n.x)-(r.x-i.x)*(t.y-n.y),u,e;return f===0?!1:(u=((r.x-i.x)*(n.y-i.y)-(r.y-i.y)*(n.x-i.x))/f,e=((t.x-n.x)*(n.y-i.y)-(t.y-n.y)*(n.x-i.x))/f,u<0||u>1||e<0||e>1)?!1:new Springy.Vector(n.x+u*(t.x-n.x),n.y+u*(t.y-n.y))}function et(n,t,i,r,u){var e={x:i.x,y:i.y},o={x:i.x+r,y:i.y},s={x:i.x,y:i.y+u},h={x:i.x+r,y:i.y+u},f;return(f=l(n,t,e,o))?f:(f=l(n,t,o,h))?f:(f=l(n,t,h,s))?f:(f=l(n,t,s,e))?f:!1}var a=this.graph=n.graph||new Springy.Graph,p="16px Verdana, sans-serif",b="8px Verdana, sans-serif",k=n.stiffness||400,d=n.repulsion||400,g=n.damping||.5,w=n.nodeSelected||null,r={},nt=!0,u=this[0],t=u.getContext("2d"),s=this.layout=new Springy.Layout.ForceDirected(a,k,d,g),i=s.getBoundingBox(),v={bottomleft:new Springy.Vector(-2,-2),topright:new Springy.Vector(2,2)},c;Springy.requestAnimationFrame(function tt(){v=s.getBoundingBox();i={bottomleft:i.bottomleft.add(v.bottomleft.subtract(i.bottomleft).divide(10)),topright:i.topright.add(v.topright.subtract(i.topright).divide(10))};Springy.requestAnimationFrame(tt)});var e=function(n){var t=i.topright.subtract(i.bottomleft),r=n.subtract(i.bottomleft).divide(t.x).x*u.width,f=n.subtract(i.bottomleft).divide(t.y).y*u.height;return new Springy.Vector(r,f)},y=function(n){var t=i.topright.subtract(i.bottomleft),r=n.x/u.width*t.x+i.bottomleft.x,f=n.y/u.height*t.y+i.bottomleft.y;return new Springy.Vector(r,f)},f=null,h=null,o=null;jQuery(u).mousedown(function(n){var t=jQuery(this).offset(),i=y({x:n.pageX-t.left,y:n.pageY-t.top});f=h=o=s.nearest(i);f.node!==null&&(o.point.m=1e4,w&&w(f.node));c.start()});jQuery(u).dblclick(function(n){var t=jQuery(this).offset(),i=y({x:n.pageX-t.left,y:n.pageY-t.top});f=s.nearest(i);node=f.node;node&&node.data&&node.data.ondoubleclick&&node.data.ondoubleclick()});jQuery(u).mousemove(function(n){var i=jQuery(this).offset(),t=y({x:n.pageX-i.left,y:n.pageY-i.top});h=s.nearest(t);o!==null&&o.node!==null&&(o.point.p.x=t.x,o.point.p.y=t.y);c.start()});jQuery(window).bind("mouseup",function(){o=null});var it=function(n){var i=n.data.label!==undefined?n.data.label:n.id,r;return n._width&&n._width[i]?n._width[i]:(t.save(),t.font=n.data.font!==undefined?n.data.font:p,r=t.measureText(i).width,t.restore(),n._width||(n._width={}),n._width[i]=r,r)},rt=function(){return 16},ut=function(n){return n.data.image.width!==undefined?n.data.image.width:r[n.data.image.src].object.width},ft=function(n){return n.data.image.height!==undefined?n.data.image.height:r[n.data.image.src].object.height};return Springy.Node.prototype.getHeight=function(){return this.data.image==undefined?rt(this):this.data.image.src in r&&r[this.data.image.src].loaded?ft(this):10},Springy.Node.prototype.getWidth=function(){return this.data.image==undefined?it(this):this.data.image.src in r&&r[this.data.image.src].loaded?ut(this):10},c=this.renderer=new Springy.Renderer(s,function(){t.clearRect(0,0,u.width,u.height)},function(n,i,r){for(var l,w,s,at,k,d,h,g,tt,it=e(i).x,rt=e(i).y,v=e(r).x,y=e(r).y,ut=new Springy.Vector(v-it,y-rt),ft=ut.normal().normalise(),p=a.getEdges(n.source,n.target),vt=a.getEdges(n.target,n.source),yt=p.length+vt.length,ot=0,c=0;c<p.length;c++)p[c].id===n.id&&(ot=c);var st=12,ht=ft.multiply(-((yt-1)*st)/2+ot*st),u=e(i).add(ht),f=e(r).add(ht),ct=n.target.getWidth()+6,lt=n.target.getHeight()+6,o=et(u,f,{x:v-ct/2,y:y-lt/2},ct,lt);o||(o=f);l=n.data.color!==undefined?n.data.color:"#000000";at=n.data.weight!==undefined?n.data.weight:1;t.lineWidth=Math.max(at*2,.1);w=1+t.lineWidth;s=8;k=n.data.directional!==undefined?n.data.directional:!0;d=k?o.subtract(ut.normalise().multiply(s*.5)):f;t.strokeStyle=l;t.beginPath();t.moveTo(u.x,u.y);t.lineTo(d.x,d.y);t.stroke();k&&(t.save(),t.fillStyle=l,t.translate(o.x,o.y),t.rotate(Math.atan2(y-rt,v-it)),t.beginPath(),t.moveTo(-s,w),t.lineTo(0,0),t.lineTo(-s,-w),t.lineTo(-s*.8,-0),t.closePath(),t.fill(),t.restore());n.data.label!==undefined&&(text=n.data.label,t.save(),t.textAlign="center",t.textBaseline="top",t.font=n.data.font!==undefined?n.data.font:b,t.fillStyle=l,h=Math.atan2(f.y-u.y,f.x-u.x),g=-8,nt&&(h>Math.PI/2||h<-Math.PI/2)&&(g=8,h+=Math.PI),tt=u.add(f).divide(2).add(ft.multiply(g)),t.translate(tt.x,tt.y),t.rotate(h),t.fillText(text,0,-2),t.restore())},function(n,i){var u=e(i),y,o,v;t.save();var s=n.getWidth(),c=n.getHeight(),l=s+6,a=c+6;t.clearRect(u.x-l/2,u.y-a/2,l,a);t.fillStyle=f!==null&&f.node!==null&&f.node.id===n.id?"#FFFFE0":h!==null&&h.node!==null&&h.node.id===n.id?"#EEEEEE":"#FFFFFF";t.fillRect(u.x-l/2,u.y-a/2,l,a);n.data.image==undefined?(t.textAlign="left",t.textBaseline="top",t.font=n.data.font!==undefined?n.data.font:p,t.fillStyle="#000000",y=n.data.label!==undefined?n.data.label:n.id,t.fillText(y,u.x-s/2,u.y-c/2)):(o=n.data.image.src,o in r?r[o].loaded&&t.drawImage(r[o].object,u.x-s/2,u.y-c/2,s,c):(r[o]={},v=new Image,r[o].object=v,v.addEventListener("load",function(){r[o].loaded=!0}),v.src=o));t.restore()}),c.start(),this}}(),function(n){"use strict";var t={};t.version="1.1.0";t.author="max huang";n.obelisk=t}(window),function(n){"use strict";var i,t;i=function(){this.initialize()};t=i.prototype;t.inner=null;t.border=null;t.borderHighlight=null;t.left=null;t.right=null;t.horizontal=null;t.leftSlope=null;t.rightSlope=null;t.initialize=function(){return this};t.toString=function(){return"[AbstractColor]"};n.AbstractColor=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r,u){this.initialize(n,t,i,r,u)};t=i.prototype=new n.AbstractColor;t.BRIGHTNESS_GAIN=-20;t.initialize=function(t,i,r,u,f){return this.border=n.ColorGeom.get32(t===undefined?8882055:t),this.borderHighlight=n.ColorGeom.get32(i===undefined?16777215:i),this.left=n.ColorGeom.get32(r===undefined?13225936:r),this.right=n.ColorGeom.get32(u===undefined?14935011:u),this.horizontal=n.ColorGeom.get32(f===undefined?15658992:f),this};t.getByHorizontalColor=function(t){return new i(n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*4),n.ColorGeom.applyBrightness(t,0,!0),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*2),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN),t)};t.toString=function(){return"[CubeColor]"};n.CubeColor=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractColor;t.BRIGHTNESS_GAIN=-20;t.initialize=function(t,i,r,u){return this.border=n.ColorGeom.get32(t===undefined?9737880:t),this.borderHighlight=n.ColorGeom.get32(i===undefined?16777215:i),this.left=n.ColorGeom.get32(r===undefined?15132905:r),this.right=n.ColorGeom.get32(u===undefined?15658992:u),this};t.getByRightColor=function(t){return new i(n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*4),n.ColorGeom.applyBrightness(t,0,!0),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN),t)};t.toString=function(){return"[PyramidColor]"};n.PyramidColor=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t){this.initialize(n,t)};t=i.prototype=new n.AbstractColor;t.BRIGHTNESS_GAIN=-20;t.initialize=function(t,i){return this.border=n.ColorGeom.get32(t===undefined?8882055:t),this.inner=n.ColorGeom.get32(i===undefined?15658734:i),this};t.getByInnerColor=function(t){return new n.SideColor(n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*4),t)};t.toString=function(){return"[SideColor]"};n.SideColor=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r,u,f){this.initialize(n,t,i,r,u,f)};t=i.prototype=new n.AbstractColor;t.BRIGHTNESS_GAIN=-20;t.initialize=function(t,i,r,u,f,e){return this.border=n.ColorGeom.get32(t===undefined?9737880:t),this.borderHighlight=n.ColorGeom.get32(i===undefined?16777215:i),this.left=n.ColorGeom.get32(r===undefined?13225936:r),this.right=n.ColorGeom.get32(u===undefined?15132905:u),this.leftSlope=n.ColorGeom.get32(f===undefined?14408667:f),this.rightSlope=n.ColorGeom.get32(e===undefined?14408667:e),this};t.getByHorizontalColor=function(t){return new n.SlopeColor(n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*4),n.ColorGeom.applyBrightness(t,0,!0),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*2),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*1.5),n.ColorGeom.applyBrightness(t,this.BRIGHTNESS_GAIN*.5))};t.toString=function(){return"[SlopeColor]"};n.SlopeColor=i}(obelisk),function(n){"use strict";var i,t;i=function(){this.initialize()};t=i.prototype;t.xAxis=null;t.yAxis=null;t.zAxis=null;t.tall=!1;t.initialize=function(){return this};t.toString=function(){return"[AbstractDimension]"};n.AbstractDimension=i}(obelisk),function(n){"use strict";var t,i;t=function(n,t){this.initialize(n,t)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t){if(this.xAxis=n||30,this.yAxis=t||30,this.xAxis%2==1||this.yAxis%2==1)throw new Error("x,yAxis must be even number");if(this.xAxis<=4||this.yAxis<=4)throw new Error("dimension is too small");return this};i.toString=function(){return"[BrickDimension]"};n.BrickDimension=t}(obelisk),function(n){"use strict";var t,i;t=function(n,t,i){this.initialize(n,t,i)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t,i){if(this.xAxis=n||30,this.yAxis=t||30,this.zAxis=i||30,this.xAxis%2==1||this.yAxis%2==1)throw new Error("x,yAxis must be even number");if(this.xAxis<=4||this.yAxis<=4||this.zAxis<=2)throw new Error("dimension is too small");return this};i.toString=function(){return"[CubeDimension]"};n.CubeDimension=t}(obelisk),function(n){"use strict";var t,i;t=function(n,t){this.initialize(n,t)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t){if(this.xAxis=n||30,this.yAxis=n||30,this.tall=t||!1,this.xAxis%2==1)throw new Error("axis must be even number");if(this.xAxis<=4)throw new Error("dimension is too small");return this};i.toString=function(){return"[PyramidDimension]"};n.PyramidDimension=t}(obelisk),function(n){"use strict";var t,i;t=function(n,t){this.initialize(n,t)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t){if(this.xAxis=n||30,this.zAxis=t||30,this.xAxis%2==1)throw new Error("xAxis must be even number");if(this.xAxis<=4||this.zAxis<=2)throw new Error("dimension is too small");return this};i.toString=function(){return"[SideXDimension]"};n.SideXDimension=t}(obelisk),function(n){"use strict";var t,i;t=function(n,t){this.initialize(n,t)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t){if(this.yAxis=n||30,this.zAxis=t||30,this.yAxis%2==1)throw new Error("yAxis must be even number");if(this.yAxis<=4||this.zAxis<=2)throw new Error("dimension is too small");return this};i.toString=function(){return"[SideYDimension]"};n.SideYDimension=t}(obelisk),function(n){"use strict";var t,i;t=function(n,t){this.initialize(n,t)};i=t.prototype=new n.AbstractDimension;i.initialize=function(n,t){if(this.xAxis=n||30,this.yAxis=t||30,this.xAxis%2==1||this.yAxis%2==1)throw new Error("xAxis and yAxis must be even number");if(this.xAxis<=4||this.yAxis<=4)throw new Error("dimension is too small");return this};i.toString=function(){return"[SlopeDimension]"};n.SlopeDimension=t}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i){this.initialize(n,t,i)};t=i.prototype;t.imageData=null;t.canvas=null;t.context=null;t.initialize=function(t,i,r){if(t===undefined||i===undefined)throw new Error("BitmapData width or height is missing");return this.canvas=r?n.CanvasManager.getDefaultCanvas():n.CanvasManager.getNewCanvas(),this.canvas.setAttribute("width",t),this.canvas.setAttribute("height",i),this.context=this.canvas.getContext("2d"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.imageData=this.context.createImageData(t,i),this};t.setPixel=function(n,t,i){var r=(t*this.imageData.width+n)*4;this.setPixelByIndex(r,i)};t.setPixelByIndex=function(n,t){var i=this.imageData.data;i[n]=t>>>16&255;i[n+1]=t>>>8&255;i[n+2]=t>>>0&255;i[n+3]=t>>>24&255};t.checkPixelAvailable=function(n,t){var i=(t*this.imageData.width+n)*4;return this.imageData.data[i+3]===0};t.floodFill=function(n,t,i){if((i>>>24&255)!=0){var l=n,e=t,h=[],f=[],s=[],u,r,a,v,c=this.imageData.width,p=this.imageData.height,o,y;if(!(l<0)&&!(e<0)&&!(l>=c)&&!(e>=p)){if(!this.checkPixelAvailable(l,e))throw new Error("Start point for flood fill is already filled");for(u=l;u>=0;u-=1){for(r=e;r>=0;r-=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else{if(r===e&&this.checkPixelAvailable(u+1,r-1))for(v=this.checkPixelAvailable(u,r-1)?r-1:this.checkPixelAvailable(u+1,r-2)?r-2:-1,r=v;r>=0;r-=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else break;break}for(r=e;r<p;r+=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else{if(r===e&&this.checkPixelAvailable(u+1,r+1))for(v=this.checkPixelAvailable(u,r+1)?r+1:this.checkPixelAvailable(u+1,r+2)?r+2:p,r=v;r<p;r+=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else break;break}for(u===l&&(s=f.concat()),a=!1,o=0;o<s.length;o+=1){for(y=0;y<s.length;y+=1)if(f[y]===s[o]){a=!0;e=s[o];break}if(a)break}if(a)s=f.concat(),f=[];else break}for(l=n,e=t,s=[],f=[],u=l;u<c;u+=1){for(r=e;r>=0;r-=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else{if(r===e&&this.checkPixelAvailable(u-1,r-1))for(v=this.checkPixelAvailable(u,r-1)?r-1:this.checkPixelAvailable(u-1,r-2)?r-2:-1,r=v;r>=0;r-=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else break;break}for(r=e;r<p;r+=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else{if(r===e&&this.checkPixelAvailable(u-1,r+1))for(v=this.checkPixelAvailable(u,r+1)?r+1:this.checkPixelAvailable(u-1,r+2)?r+2:p,r=v;r<p;r+=1)if(this.checkPixelAvailable(u,r))h.push((r*c+u)*4),f.push(r);else break;break}for(u===l&&(s=f.concat()),a=!1,o=0;o<s.length;o+=1){for(y=0;y<s.length;y+=1)if(f[y]===s[o]){a=!0;e=s[o];break}if(a)break}if(a)s=f.concat(),f=[];else break}for(o=0;o<h.length;o+=1)this.setPixelByIndex(h[o],i)}}};t.toString=function(){return"[BitmapData]"};n.BitmapData=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t){this.initialize(n,t)};t=i.prototype;t.x=null;t.y=null;t.canvas=null;t.initialize=function(t,i){if(!t)throw new Error("Primitive is not defined");var r=i||new n.Point3D;return this.canvas=t.canvas,this.x=t.matrix.tx+r.x-r.y,this.y=t.matrix.ty+Math.floor(r.x/2+r.y/2)-r.z,this};t.toString=function(){return"[PixelObject]"};n.PixelObject=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t){this.initialize(n,t)};t=i.prototype;t.canvas=null;t.context=null;t.point=null;t.initialize=function(t,i){if(!t)throw new Error("Canvas is not defined");try{t instanceof jQuery&&(t=t.get(0))}catch(r){}return this.canvas=t,this.context=this.canvas.getContext("2d"),this.point=i||new n.Point(0,0),this};t.renderObject=function(t,i){var r=new n.PixelObject(t,i);this.context.drawImage(r.canvas,this.point.x+r.x,this.point.y+r.y)};t.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};t.toString=function(){return"[PixelView]"};n.PixelView=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r,u,f){this.initialize(n,t,i,r,u,f)};t=i.prototype;t.a=1;t.b=0;t.c=0;t.d=1;t.tx=0;t.ty=0;t.initialize=function(n,t,i,r,u,f){return this.a=n===undefined?1:n,this.b=t||0,this.c=i||0,this.d=r===undefined?1:r,this.tx=u||0,this.ty=f||0,this};t.toString=function(){return"[Matrix]"};n.Matrix=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t){this.initialize(n,t)};t=i.prototype;t.x=0;t.y=0;t.initialize=function(n,t){return this.x=n===undefined?0:n,this.y=t===undefined?0:t,this};t.toString=function(){return"[Point x : "+this.x+", y : "+this.y+"]"};n.Point=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i){this.initialize(n,t,i)};t=i.prototype;t.x=0;t.y=0;t.z=0;t.initialize=function(n,t,i){return this.x=n===undefined?0:n,this.y=t===undefined?0:t,this.z=i===undefined?0:i,this};t.toGlobalCoordinates=function(t){var i=new n.Point(this.x-this.y,Math.floor(this.x/2+this.y/2)-this.z);return t!==undefined&&(i.x=i.x+t.x,i.y=i.y+t.y),i};t.toString=function(){return"[Point3D x : "+this.x+", y : "+this.y+", z: "+this.z+"]"};n.Point3D=i}(obelisk),function(n){"use strict";var i,t;i=function(){this.initialize()};t=i.prototype;t.canvas=null;t.w=null;t.h=null;t.dimension=null;t.color=null;t.border=null;t.bitmapData=null;t.useDefaultCanvas=null;t.matrix=null;t.initialize=function(){return this};t.toString=function(){return"[AbstractPrimitive]"};n.AbstractPrimitive=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.BrickDimension:t;this.color=i===undefined?new n.SideColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=(this.dimension.xAxis+this.dimension.yAxis)/2;this.w-=2;this.h-=1;this.matrix=new n.Matrix;this.matrix.tx=-this.dimension.yAxis+2;this.matrix.ty=0};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var r,u,f,e,n,t,i;for(r=this.dimension.yAxis-2,u=0,f=this.dimension.xAxis-1,e=this.h-1,i=this.border?this.color.border:this.color.inner,n=0;n<this.dimension.xAxis;n+=1)this.bitmapData.setPixel(r+n,u+Math.floor(n/2),i),this.bitmapData.setPixel(f-n,e-Math.floor(n/2),i);for(t=0;t<this.dimension.yAxis;t+=1)this.bitmapData.setPixel(r+1-t,u+Math.floor(t/2),i),this.bitmapData.setPixel(f-1+t,e-Math.floor(t/2),i);this.bitmapData.floodFill(Math.floor(this.w/2),Math.floor(this.h/2),this.color.inner)};t.toString=function(){return"[Brick]"};n.Brick=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.CubeDimension:t;this.color=i===undefined?new n.CubeColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.dimension.zAxis+(this.dimension.xAxis+this.dimension.yAxis)/2;this.w-=2;this.h-=1;this.matrix=new n.Matrix;this.matrix.tx=-this.dimension.yAxis+2;this.matrix.ty=-this.dimension.zAxis};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.canvas=this.bitmapData.canvas};t.build=function(){var l,a,v,e,r,c,u,i,o,s,t,f,h;if(l=new n.Brick(new n.BrickDimension(this.dimension.xAxis,this.dimension.yAxis),new n.SideColor(this.color.border,this.color.horizontal),this.border),a=new n.SideX(new n.SideXDimension(this.dimension.xAxis,this.dimension.zAxis),new n.SideColor(this.color.border,this.color.left),this.border),v=new n.SideY(new n.SideYDimension(this.dimension.yAxis,this.dimension.zAxis),new n.SideColor(this.color.border,this.color.right),this.border),e=new n.PixelObject(l),r=new n.PixelObject(a),c=new n.PixelObject(v),u=this.bitmapData.context,u.drawImage(e.canvas,e.x+this.dimension.yAxis-2,e.y),u.drawImage(r.canvas,r.x,r.y+this.dimension.zAxis+this.dimension.yAxis/2-1),u.drawImage(c.canvas,c.x+this.w-2,r.y+this.dimension.zAxis+this.dimension.xAxis/2-1),i=new n.BitmapData(this.w,this.h),this.border){for(o=this.dimension.xAxis-2,s=(this.dimension.xAxis+this.dimension.yAxis)/2-2,t=0;t<this.dimension.xAxis-2;t+=1)i.setPixel(o+1-t,s-Math.floor(t/2),this.color.borderHighlight);for(f=0;f<this.dimension.yAxis-2;f+=1)i.setPixel(o+f,s-Math.floor(f/2),this.color.borderHighlight);for(h=0;h<this.dimension.zAxis;h+=1)i.setPixel(o,s+h,this.color.borderHighlight)}else for(t=0;t<this.dimension.zAxis;t+=1)i.setPixel(this.dimension.xAxis-2,(this.dimension.xAxis+this.dimension.yAxis)/2-1+t,this.color.left);i.context.putImageData(i.imageData,0,0);u.drawImage(i.canvas,0,0)};t.toString=function(){return"[Cube]"};n.Cube=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.hSize=null;t.hOffset=null;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.PyramidDimension:t;this.color=i===undefined?new n.PyramidColor:i;this.hSize=this.dimension.tall?this.dimension.xAxis*2:this.dimension.xAxis;this.hOffset=this.dimension.tall?-3:-2};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.hSize+this.dimension.xAxis/2;this.w-=2;this.h+=this.hOffset;this.matrix=new n.Matrix;this.matrix.tx=-this.dimension.xAxis+2;this.matrix.ty=-this.hSize/2+2-(this.dimension.tall?this.dimension.xAxis/2:1)};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var n,o,h,t,i,s,r,u,f,e;for(n=this.border?this.color.border:this.color.left,o=this.border?this.color.border:this.color.right,h=this.border?this.color.borderHighlight:n,s=0;s<this.hSize+this.dimension.xAxis/2-4;s+=1)this.bitmapData.setPixel(this.dimension.xAxis-2,s+3+this.hOffset,h);for(t=0;t<this.dimension.xAxis;t+=1)this.bitmapData.setPixel(t,this.hSize+Math.floor(t/2)+this.hOffset,n);for(i=0;i<this.dimension.xAxis;i+=1)this.bitmapData.setPixel(i+this.dimension.xAxis-2,this.hSize+this.dimension.xAxis/2-Math.floor(i/2)-1+this.hOffset,o);if(this.dimension.tall){for(f=0;f<this.hSize-2;f+=1)this.bitmapData.setPixel(Math.floor(f/2),this.hSize-f+this.hOffset,n);for(e=2;e<this.hSize;e+=1)this.bitmapData.setPixel(Math.floor(e/2)+this.dimension.xAxis-2,e+1+this.hOffset,o)}else{for(r=0;r<this.hSize;r+=1)this.bitmapData.setPixel(r,this.hSize-r+this.hOffset,n);for(u=0;u<this.hSize;u+=1)this.bitmapData.setPixel(u+this.hSize-2,u+1+this.hOffset,o)}this.border||this.bitmapData.setPixel(this.dimension.xAxis-2,this.hSize+this.dimension.xAxis/2-1+this.hOffset,n);this.bitmapData.floodFill(this.dimension.xAxis-1,this.hSize+Math.floor((this.dimension.xAxis-1)/2)+this.hOffset-1,this.color.right);this.bitmapData.floodFill(this.dimension.xAxis-3,this.hSize+Math.floor((this.dimension.xAxis-1)/2)+this.hOffset-2,this.color.left)};t.toString=function(){return"[Pyramid]"};n.Pyramid=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SideXDimension:t;this.color=i===undefined?new n.SideColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis;this.h=this.dimension.zAxis+this.dimension.xAxis/2;this.matrix=new n.Matrix;this.matrix.tx=0;this.matrix.ty=-this.dimension.zAxis};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var r,u,f,e,n,t,i;for(r=0,u=this.dimension.zAxis,f=this.dimension.xAxis-1,e=this.h-this.dimension.zAxis-1,i=this.border?this.color.border:this.color.inner,n=0;n<this.dimension.xAxis;n+=1)this.bitmapData.setPixel(r+n,u+Math.floor(n/2),i),this.bitmapData.setPixel(f-n,e-Math.floor(n/2),i);for(t=0;t<this.dimension.zAxis;t+=1)this.bitmapData.setPixel(r,u-t,i),this.bitmapData.setPixel(f,e+t,i);this.bitmapData.floodFill(Math.floor(this.w/2),Math.floor(this.h/2),this.color.inner)};t.toString=function(){return"[SideX]"};n.SideX=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SideYDimension:t;this.color=i===undefined?new n.SideColor:i};t.initRectangle=function(){this.w=this.dimension.yAxis;this.h=this.dimension.zAxis+this.dimension.yAxis/2;this.matrix=new n.Matrix;this.matrix.tx=-this.dimension.yAxis+2;this.matrix.ty=-this.dimension.zAxis};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var r,u,f,e,n,t,i;for(r=0,u=this.h-this.dimension.zAxis-1,f=this.dimension.yAxis-1,e=this.dimension.zAxis,i=this.border?this.color.border:this.color.inner,n=0;n<this.dimension.yAxis;n+=1)this.bitmapData.setPixel(r+n,u-Math.floor(n/2),i),this.bitmapData.setPixel(f-n,e+Math.floor(n/2),i);for(t=0;t<this.dimension.zAxis;t+=1)this.bitmapData.setPixel(r,u+t,i),this.bitmapData.setPixel(f,e-t,i);this.bitmapData.floodFill(Math.floor(this.w/2),Math.floor(this.h/2),this.color.inner)};t.toString=function(){return"[SideY]"};n.SideY=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SlopeDimension:t;this.color=i===undefined?new n.SlopeColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.dimension.xAxis*2+this.dimension.yAxis/2;this.w-=2;this.h-=3;this.matrix=new n.Matrix;this.matrix.tx=-(this.dimension.yAxis-2);this.matrix.ty=-(this.dimension.xAxis*3/2-2)};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var e,i,r,n,f,t,u;for(e=this.border?this.color.border:this.color.left,i=this.border?this.color.border:this.color.rightSlope,n=0;n<this.dimension.yAxis;n+=1)this.bitmapData.setPixel(n,this.dimension.yAxis/2-Math.floor(n/2)-1,i),this.bitmapData.setPixel(n+this.dimension.xAxis-2,this.h-Math.floor(n/2)-1,i);for(r=0;r<this.dimension.xAxis;r+=1)this.bitmapData.setPixel(r,this.h-this.dimension.xAxis/2+Math.floor(r/2),e);for(f=this.dimension.yAxis/2-1;f<this.h-this.dimension.xAxis/2;f+=1)this.bitmapData.setPixel(0,f,e);for(t=0;t<this.dimension.xAxis*2-2;t+=1)this.bitmapData.setPixel(this.dimension.yAxis-1+Math.floor(t/2),t,i),this.bitmapData.setPixel(1+Math.floor(t/2),this.dimension.yAxis/2+t-1,i);if(this.bitmapData.floodFill(this.dimension.yAxis-2,1,this.color.rightSlope),this.bitmapData.floodFill(this.dimension.xAxis-3,this.h-3,this.color.left),this.bitmapData.setPixel(this.dimension.xAxis-2,this.h-2,this.color.left),this.border)for(u=1;u<this.dimension.xAxis*2-3;u+=1)this.bitmapData.setPixel(1+Math.floor(u/2),this.dimension.yAxis/2+u-1,this.color.borderHighlight)};t.toString=function(){return"[SlopeEast]"};n.SlopeEast=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SlopeDimension:t;this.color=i===undefined?new n.SlopeColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.dimension.yAxis*3/2+this.dimension.xAxis/2;this.w-=2;this.h-=3;this.matrix=new n.Matrix;this.matrix.tx=-(this.dimension.yAxis-2);this.matrix.ty=-(this.dimension.yAxis-2)};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.canvas=this.bitmapData.canvas};t.build=function(){var s,u,h,c,f,o,t,e,i,r;for(s=this.border?this.color.border:this.color.left,u=this.border?this.color.border:this.color.right,h=this.border?this.color.borderHighlight:this.color.left,c=new n.SideX(new n.SideXDimension(this.dimension.xAxis,this.h-this.dimension.xAxis/2),new n.SideColor(s,this.color.left)),f=new n.PixelObject(c),o=this.bitmapData.context,o.drawImage(f.canvas,f.x,f.y+this.h-this.dimension.xAxis/2),t=new n.BitmapData(this.w,this.h),e=this.h-this.dimension.yAxis*3/2+2;e<this.h;e+=1)t.setPixel(this.dimension.xAxis-1,e,u);for(i=1;i<this.dimension.yAxis;i+=1)t.setPixel(this.dimension.xAxis+i-2,this.h-Math.floor(i/2)-1,u),t.setPixel(this.dimension.xAxis+i-2,this.dimension.xAxis/2-2+i,u);for(t.floodFill(this.dimension.xAxis+1,this.h-3,this.color.right),r=this.dimension.xAxis/2;r<this.h-1;r+=1)t.setPixel(this.dimension.xAxis-1,r,this.color.right),t.setPixel(this.dimension.xAxis-2,r,h);t.context.putImageData(t.imageData,0,0);o.drawImage(t.canvas,0,0)};t.toString=function(){return"[SlopeNorth]"};n.SlopeNorth=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SlopeDimension:t;this.color=i===undefined?new n.SlopeColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.dimension.xAxis/2+this.dimension.yAxis*2;this.w-=2;this.h-=3;this.matrix=new n.Matrix;this.matrix.tx=-(this.dimension.yAxis-2);this.matrix.ty=-(this.dimension.yAxis*3/2-2)};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.bitmapData.context.putImageData(this.bitmapData.imageData,0,0);this.canvas=this.bitmapData.canvas};t.build=function(){var i,e,r,n,f,t,u;for(i=this.border?this.color.border:this.color.leftSlope,e=this.border?this.color.border:this.color.right,n=0;n<this.dimension.xAxis;n+=1)this.bitmapData.setPixel(n,this.dimension.yAxis*2+Math.floor(n/2)-3,i),this.bitmapData.setPixel(n+this.dimension.yAxis-2,Math.floor(n/2),i);for(r=0;r<this.dimension.yAxis;r+=1)this.bitmapData.setPixel(this.dimension.xAxis-2+r,this.h-Math.floor(r/2)-1,e);for(f=this.dimension.xAxis/2-1;f<this.h-this.dimension.yAxis/2;f+=1)this.bitmapData.setPixel(this.w-1,f,e);for(t=0;t<this.dimension.yAxis*2-2;t+=1)this.bitmapData.setPixel(Math.floor(t/2),this.dimension.yAxis*2-t-3,i),this.bitmapData.setPixel(this.dimension.xAxis-2+Math.floor(t/2),this.h-t-1,i);if(this.bitmapData.floodFill(this.dimension.yAxis-1,1,this.color.leftSlope),this.bitmapData.floodFill(this.dimension.xAxis,this.h-3,this.color.right),this.bitmapData.setPixel(this.dimension.xAxis-1,this.h-2,this.color.right),this.border)for(u=1;u<this.dimension.yAxis*2-3;u+=1)this.bitmapData.setPixel(this.dimension.xAxis-2+Math.floor(u/2),this.h-u-1,this.color.borderHighlight)};t.toString=function(){return"[SlopeSouth]"};n.SlopeSouth=i}(obelisk),function(n){"use strict";var i,t;i=function(n,t,i,r){this.initialize(n,t,i,r)};t=i.prototype=new n.AbstractPrimitive;t.initialize=function(n,t,i,r){return this.initRender(n,t,i,r),this.initRectangle(),this.initBitmapData(),this.build(),this.renderBitmapDataForCanvas(),this};t.initRender=function(t,i,r,u){this.useDefaultCanvas=u||!1;this.border=r||r===undefined;this.dimension=t===undefined?new n.SlopeDimension:t;this.color=i===undefined?new n.SlopeColor:i};t.initRectangle=function(){this.w=this.dimension.xAxis+this.dimension.yAxis;this.h=this.dimension.xAxis*3/2+this.dimension.yAxis/2;this.w-=2;this.h-=3;this.matrix=new n.Matrix;this.matrix.tx=-(this.dimension.yAxis-2);this.matrix.ty=-(this.dimension.xAxis-2)};t.initBitmapData=function(){this.bitmapData=new n.BitmapData(this.w,this.h,this.useDefaultCanvas)};t.renderBitmapDataForCanvas=function(){this.canvas=this.bitmapData.canvas};t.build=function(){var r,s,h,c,u,o,t,f,i,e;for(r=this.border?this.color.border:this.color.left,s=this.border?this.color.border:this.color.right,h=this.border?this.color.borderHighlight:this.color.left,c=new n.SideY(new n.SideYDimension(this.dimension.yAxis,this.h-this.dimension.yAxis/2),new n.SideColor(s,this.color.right)),u=new n.PixelObject(c),o=this.bitmapData.context,o.drawImage(u.canvas,u.x+this.w-2,u.y+this.h-this.dimension.yAxis/2),t=new n.BitmapData(this.w,this.h),f=this.h-this.dimension.xAxis*3/2+2;f<this.h;f+=1)t.setPixel(this.dimension.xAxis-2,f,r);for(i=0;i<this.dimension.xAxis-1;i+=1)t.setPixel(i,this.dimension.xAxis+this.dimension.yAxis/2-3+Math.floor(i/2),r),t.setPixel(i,this.dimension.xAxis+this.dimension.yAxis/2-3-i,r);for(t.floodFill(this.dimension.xAxis-3,this.h-3,this.color.left),e=this.dimension.yAxis/2;e<this.h-1;e+=1)t.setPixel(this.dimension.xAxis-2,e,h);t.context.putImageData(t.imageData,0,0);o.drawImage(t.canvas,0,0)};t.toString=function(){return"[SlopeWest]"};n.SlopeWest=i}(obelisk),function(n,t){"use strict";var r,i;r=function(){throw new Error("CanvasManager is a static Class, cannot be instanced.");};i=r;i.defaultCanvas=null;i.getDefaultCanvas=function(){return i.defaultCanvas=i.defaultCanvas||t.createElement("canvas"),i.defaultCanvas};i.getNewCanvas=function(){return t.createElement("canvas")};i.toString=function(){return"[CanvasManager]"};n.CanvasManager=r}(obelisk,document),function(n){"use strict";var t,i;t=function(){throw new Error("CanvasTool is a static Class, cannot be instanced.");};i=t;i.getPixel=function(n,t,i){var r,u,f,e,o;return r=n.data,u=(i*n.width+t)*4,f=r[u],e=r[u+1],o=r[u+2],f<<16|e<<8|o};i.toString=function(){return"[CanvasTool]"};n.CanvasTool=t}(obelisk),function(n){"use strict";var i,t;i=function(){throw new Error("ColorGeom is a static Class, cannot be instanced.");};t=i;t.get32=function(n){return n<4278190080?n+4278190080:n};t.applyBrightness=function(n,t,i){var h,r,u,f,e,o,s;return h=n>>>24&255,r=n>>>16&255,u=n>>>8&255,f=n&255,e=(r*313524>>20)+(u*615514>>20)+(f*119538>>20),s=-(155189*r>>20)-(303038*u>>20)+(458227*f>>20),o=(644874*r>>20)-(540016*u>>20)-(104857*f>>20),i?e=60+Math.pow(e,1.2):e+=t,r=e+(1195376*o>>20),u=e-(408944*s>>20)-(608174*o>>20),f=e+(2128609*s>>20),r=Math.max(0,Math.min(r,255)),u=Math.max(0,Math.min(u,255)),f=Math.max(0,Math.min(f,255)),h<<24|r<<16|u<<8|f};t.toString=function(){return"[ColorGeom]"};n.ColorGeom=i}(obelisk),function(n){"use strict";var i,t;i=function(){throw new Error("ColorPattern is a static Class, cannot be instanced.");};t=i;t.GRASS_GREEN=13434624;t.YELLOW=16776960;t.WINE_RED=16711833;t.PINK=16743615;t.PURPLE=13369599;t.BLUE=52479;t.GRAY=15658734;t.BLACK=6710886;t.FINE_COLORS=[t.GRASS_GREEN,t.YELLOW,t.WINE_RED,t.PINK,t.PURPLE,t.BLUE,t.GRAY,t.BLACK];t.getRandomComfortableColor=function(){return t.FINE_COLORS[Math.floor(Math.random()*t.FINE_COLORS.length)]};t.toString=function(){return"[ColorPattern]"};n.ColorPattern=i}(obelisk),function(n,t){typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?module.exports=t():n.buckets=t()}(this,function(){"use strict";var n={};return n.defaultCompare=function(n,t){return n<t?-1:n===t?0:1},n.defaultEquals=function(n,t){return n===t},n.defaultToString=function(t){return t===null?"BUCKETS_NULL":n.isUndefined(t)?"BUCKETS_UNDEFINED":n.isString(t)?t:t.toString()},n.isFunction=function(n){return typeof n=="function"},n.isUndefined=function(n){return typeof n=="undefined"},n.isString=function(n){return Object.prototype.toString.call(n)==="[object String]"},n.reverseCompareFunction=function(t){return n.isFunction(t)?function(n,i){return t(n,i)*-1}:function(n,t){return n<t?1:n===t?0:-1}},n.compareToEquals=function(n){return function(t,i){return n(t,i)===0}},n.arrays={},n.arrays.indexOf=function(t,i,r){for(var f=r||n.defaultEquals,e=t.length,u=0;u<e;u++)if(f(t[u],i))return u;return-1},n.arrays.lastIndexOf=function(t,i,r){for(var f=r||n.defaultEquals,e=t.length,u=e-1;u>=0;u--)if(f(t[u],i))return u;return-1},n.arrays.contains=function(t,i,r){return n.arrays.indexOf(t,i,r)>=0},n.arrays.remove=function(t,i,r){var u=n.arrays.indexOf(t,i,r);return u<0?!1:(t.splice(u,1),!0)},n.arrays.frequency=function(t,i,r){for(var e=r||n.defaultEquals,o=t.length,f=0,u=0;u<o;u++)e(t[u],i)&&f++;return f},n.arrays.equals=function(t,i,r){var e=r||n.defaultEquals,f,u;if(t.length!==i.length)return!1;for(f=t.length,u=0;u<f;u++)if(!e(t[u],i[u]))return!1;return!0},n.arrays.copy=function(n){return n.concat()},n.arrays.swap=function(n,t,i){if(t<0||t>=n.length||i<0||i>=n.length)return!1;var r=n[t];return n[t]=n[i],n[i]=r,!0},n.arrays.forEach=function(n,t){for(var r=n.length,i=0;i<r;i++)if(t(n[i])===!1)return},n.LinkedList=function(){this.firstNode=null;this.lastNode=null;this.nElements=0},n.LinkedList.prototype.add=function(t,i){var r,u;return(n.isUndefined(i)&&(i=this.nElements),i<0||i>this.nElements||n.isUndefined(t))?!1:(r=this.createNode(t),this.nElements===0?(this.firstNode=r,this.lastNode=r):i===this.nElements?(this.lastNode.next=r,this.lastNode=r):i===0?(r.next=this.firstNode,this.firstNode=r):(u=this.nodeAtIndex(i-1),r.next=u.next,u.next=r),this.nElements++,!0)},n.LinkedList.prototype.first=function(){return this.firstNode!==null?this.firstNode.element:undefined},n.LinkedList.prototype.last=function(){return this.lastNode!==null?this.lastNode.element:undefined},n.LinkedList.prototype.elementAtIndex=function(n){var t=this.nodeAtIndex(n);return t===null?undefined:t.element},n.LinkedList.prototype.indexOf=function(t,i){var f=i||n.defaultEquals,r,u;if(n.isUndefined(t))return-1;for(r=this.firstNode,u=0;r!==null;){if(f(r.element,t))return u;u++;r=r.next}return-1},n.LinkedList.prototype.contains=function(n,t){return this.indexOf(n,t)>=0},n.LinkedList.prototype.remove=function(t,i){var f=i||n.defaultEquals,u,r;if(this.nElements<1||n.isUndefined(t))return!1;for(u=null,r=this.firstNode;r!==null;){if(f(r.element,t))return r===this.firstNode?(this.firstNode=this.firstNode.next,r===this.lastNode&&(this.lastNode=null)):r===this.lastNode?(this.lastNode=u,u.next=r.next,r.next=null):(u.next=r.next,r.next=null),this.nElements--,!0;u=r;r=r.next}return!1},n.LinkedList.prototype.clear=function(){this.firstNode=null;this.lastNode=null;this.nElements=0},n.LinkedList.prototype.equals=function(t,i){var r=i||n.defaultEquals;return(t instanceof n.LinkedList)?this.size()!==t.size()?!1:this.equalsAux(this.firstNode,t.firstNode,r):!1},n.LinkedList.prototype.equalsAux=function(n,t,i){while(n!==null){if(!i(n.element,t.element))return!1;n=n.next;t=t.next}return!0},n.LinkedList.prototype.removeElementAtIndex=function(n){var i,t;return n<0||n>=this.nElements?undefined:(this.nElements===1?(i=this.firstNode.element,this.firstNode=null,this.lastNode=null):(t=this.nodeAtIndex(n-1),t===null?(i=this.firstNode.element,this.firstNode=this.firstNode.next):t.next===this.lastNode&&(i=this.lastNode.element,this.lastNode=t),t!==null&&(i=t.next.element,t.next=t.next.next)),this.nElements--,i)},n.LinkedList.prototype.forEach=function(n){for(var t=this.firstNode;t!==null;){if(n(t.element)===!1)break;t=t.next}},n.LinkedList.prototype.reverse=function(){for(var i=null,n=this.firstNode,t=null;n!==null;)t=n.next,n.next=i,i=n,n=t;t=this.firstNode;this.firstNode=this.lastNode;this.lastNode=t},n.LinkedList.prototype.toArray=function(){for(var t=[],n=this.firstNode;n!==null;)t.push(n.element),n=n.next;return t},n.LinkedList.prototype.size=function(){return this.nElements},n.LinkedList.prototype.isEmpty=function(){return this.nElements<=0},n.LinkedList.prototype.nodeAtIndex=function(n){var t,i;if(n<0||n>=this.nElements)return null;if(n===this.nElements-1)return this.lastNode;for(t=this.firstNode,i=0;i<n;i++)t=t.next;return t},n.LinkedList.prototype.createNode=function(n){return{element:n,next:null}},n.Dictionary=function(t){this.table={};this.nElements=0;this.toStr=t||n.defaultToString},n.Dictionary.prototype.get=function(t){var i=this.table[this.toStr(t)];return n.isUndefined(i)?undefined:i.value},n.Dictionary.prototype.set=function(t,i){if(n.isUndefined(t)||n.isUndefined(i))return undefined;var r,u=this.toStr(t),f=this.table[u];return n.isUndefined(f)?(this.nElements++,r=undefined):r=f.value,this.table[u]={key:t,value:i},r},n.Dictionary.prototype.remove=function(t){var i=this.toStr(t),r=this.table[i];return n.isUndefined(r)?undefined:(delete this.table[i],this.nElements--,r.value)},n.Dictionary.prototype.keys=function(){var n=[];for(var t in this.table)this.table.hasOwnProperty(t)&&n.push(this.table[t].key);return n},n.Dictionary.prototype.values=function(){var n=[];for(var t in this.table)this.table.hasOwnProperty(t)&&n.push(this.table[t].value);return n},n.Dictionary.prototype.forEach=function(n){var t,i,r;for(t in this.table)if(this.table.hasOwnProperty(t)&&(i=this.table[t],r=n(i.key,i.value),r===!1))return},n.Dictionary.prototype.containsKey=function(t){return!n.isUndefined(this.get(t))},n.Dictionary.prototype.clear=function(){this.table={};this.nElements=0},n.Dictionary.prototype.size=function(){return this.nElements},n.Dictionary.prototype.isEmpty=function(){return this.nElements<=0},n.MultiDictionary=function(t,i){this.parent=new n.Dictionary(t);this.equalsF=i||n.defaultEquals},n.MultiDictionary.prototype.get=function(t){var i=this.parent.get(t);return n.isUndefined(i)?[]:n.arrays.copy(i)},n.MultiDictionary.prototype.set=function(t,i){if(n.isUndefined(t)||n.isUndefined(i))return!1;if(!this.containsKey(t))return this.parent.set(t,[i]),!0;var r=this.parent.get(t);return n.arrays.contains(r,i,this.equalsF)?!1:(r.push(i),!0)},n.MultiDictionary.prototype.remove=function(t,i){var u,r;return n.isUndefined(i)?(u=this.parent.remove(t),n.isUndefined(u))?!1:!0:(r=this.parent.get(t),n.arrays.remove(r,i,this.equalsF))?(r.length===0&&this.parent.remove(t),!0):!1},n.MultiDictionary.prototype.keys=function(){return this.parent.keys()},n.MultiDictionary.prototype.values=function(){for(var i,n,r=this.parent.values(),u=[],t=0;t<r.length;t++)for(i=r[t],n=0;n<i.length;n++)u.push(i[n]);return u},n.MultiDictionary.prototype.containsKey=function(n){return this.parent.containsKey(n)},n.MultiDictionary.prototype.clear=function(){return this.parent.clear()},n.MultiDictionary.prototype.size=function(){return this.parent.size()},n.MultiDictionary.prototype.isEmpty=function(){return this.parent.isEmpty()},n.Heap=function(t){this.data=[];this.compare=t||n.defaultCompare},n.Heap.prototype.leftChildIndex=function(n){return 2*n+1},n.Heap.prototype.rightChildIndex=function(n){return 2*n+2},n.Heap.prototype.parentIndex=function(n){return Math.floor((n-1)/2)},n.Heap.prototype.minIndex=function(n,t){return t>=this.data.length?n>=this.data.length?-1:n:this.compare(this.data[n],this.data[t])<=0?n:t},n.Heap.prototype.siftUp=function(t){for(var i=this.parentIndex(t);t>0&&this.compare(this.data[i],this.data[t])>0;)n.arrays.swap(this.data,i,t),t=i,i=this.parentIndex(t)},n.Heap.prototype.siftDown=function(t){for(var i=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));i>=0&&this.compare(this.data[t],this.data[i])>0;)n.arrays.swap(this.data,i,t),t=i,i=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},n.Heap.prototype.peek=function(){return this.data.length>0?this.data[0]:undefined},n.Heap.prototype.add=function(t){return n.isUndefined(t)?undefined:(this.data.push(t),this.siftUp(this.data.length-1),!0)},n.Heap.prototype.removeRoot=function(){if(this.data.length>0){var n=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),n}return undefined},n.Heap.prototype.contains=function(t){var i=n.compareToEquals(this.compare);return n.arrays.contains(this.data,t,i)},n.Heap.prototype.size=function(){return this.data.length},n.Heap.prototype.isEmpty=function(){return this.data.length<=0},n.Heap.prototype.clear=function(){this.data.length=0},n.Heap.prototype.forEach=function(t){n.arrays.forEach(this.data,t)},n.Stack=function(){this.list=new n.LinkedList},n.Stack.prototype.push=function(n){return this.list.add(n,0)},n.Stack.prototype.add=function(n){return this.list.add(n,0)},n.Stack.prototype.pop=function(){return this.list.removeElementAtIndex(0)},n.Stack.prototype.peek=function(){return this.list.first()},n.Stack.prototype.size=function(){return this.list.size()},n.Stack.prototype.contains=function(n,t){return this.list.contains(n,t)},n.Stack.prototype.isEmpty=function(){return this.list.isEmpty()},n.Stack.prototype.clear=function(){this.list.clear()},n.Stack.prototype.forEach=function(n){this.list.forEach(n)},n.Queue=function(){this.list=new n.LinkedList},n.Queue.prototype.enqueue=function(n){return this.list.add(n)},n.Queue.prototype.add=function(n){return this.list.add(n)},n.Queue.prototype.dequeue=function(){if(this.list.size()!==0){var n=this.list.first();return this.list.removeElementAtIndex(0),n}return undefined},n.Queue.prototype.peek=function(){return this.list.size()!==0?this.list.first():undefined},n.Queue.prototype.size=function(){return this.list.size()},n.Queue.prototype.contains=function(n,t){return this.list.contains(n,t)},n.Queue.prototype.isEmpty=function(){return this.list.size()<=0},n.Queue.prototype.clear=function(){this.list.clear()},n.Queue.prototype.forEach=function(n){this.list.forEach(n)},n.PriorityQueue=function(t){this.heap=new n.Heap(n.reverseCompareFunction(t))},n.PriorityQueue.prototype.enqueue=function(n){return this.heap.add(n)},n.PriorityQueue.prototype.add=function(n){return this.heap.add(n)},n.PriorityQueue.prototype.dequeue=function(){if(this.heap.size()!==0){var n=this.heap.peek();return this.heap.removeRoot(),n}return undefined},n.PriorityQueue.prototype.peek=function(){return this.heap.peek()},n.PriorityQueue.prototype.contains=function(n){return this.heap.contains(n)},n.PriorityQueue.prototype.isEmpty=function(){return this.heap.isEmpty()},n.PriorityQueue.prototype.size=function(){return this.heap.size()},n.PriorityQueue.prototype.clear=function(){this.heap.clear()},n.PriorityQueue.prototype.forEach=function(n){this.heap.forEach(n)},n.Set=function(t){this.dictionary=new n.Dictionary(t)},n.Set.prototype.contains=function(n){return this.dictionary.containsKey(n)},n.Set.prototype.add=function(t){return this.contains(t)||n.isUndefined(t)?!1:(this.dictionary.set(t,t),!0)},n.Set.prototype.intersection=function(n){var t=this;this.forEach(function(i){n.contains(i)||t.remove(i)})},n.Set.prototype.union=function(n){var t=this;n.forEach(function(n){t.add(n)})},n.Set.prototype.difference=function(n){var t=this;n.forEach(function(n){t.remove(n)})},n.Set.prototype.isSubsetOf=function(n){if(this.size()>n.size())return!1;var t=!0;return this.forEach(function(i){if(!n.contains(i))return t=!1,!1}),t},n.Set.prototype.remove=function(n){return this.contains(n)?(this.dictionary.remove(n),!0):!1},n.Set.prototype.forEach=function(n){this.dictionary.forEach(function(t,i){return n(i)})},n.Set.prototype.toArray=function(){return this.dictionary.values()},n.Set.prototype.isEmpty=function(){return this.dictionary.isEmpty()},n.Set.prototype.size=function(){return this.dictionary.size()},n.Set.prototype.clear=function(){this.dictionary.clear()},n.Bag=function(t){this.toStrF=t||n.defaultToString;this.dictionary=new n.Dictionary(this.toStrF);this.nElements=0},n.Bag.prototype.add=function(t,i){if((isNaN(i)||n.isUndefined(i))&&(i=1),n.isUndefined(t)||i<=0)return!1;if(this.contains(t))this.dictionary.get(t).copies+=i;else{var r={value:t,copies:i};this.dictionary.set(t,r)}return this.nElements+=i,!0},n.Bag.prototype.count=function(n){return this.contains(n)?this.dictionary.get(n).copies:0},n.Bag.prototype.contains=function(n){return this.dictionary.containsKey(n)},n.Bag.prototype.remove=function(t,i){if((isNaN(i)||n.isUndefined(i))&&(i=1),n.isUndefined(t)||i<=0)return!1;if(this.contains(t)){var r=this.dictionary.get(t);return this.nElements-=i>r.copies?r.copies:i,r.copies-=i,r.copies<=0&&this.dictionary.remove(t),!0}return!1},n.Bag.prototype.toArray=function(){for(var t,i=[],r=this.dictionary.values(),f=r.length,n=0;n<f;n++){var u=r[n],e=u.value,o=u.copies;for(t=0;t<o;t++)i.push(e)}return i},n.Bag.prototype.toSet=function(){for(var u,i=new n.Set(this.toStrF),r=this.dictionary.values(),f=r.length,t=0;t<f;t++)u=r[t].value,i.add(u);return i},n.Bag.prototype.forEach=function(n){this.dictionary.forEach(function(t,i){for(var u=i.value,f=i.copies,r=0;r<f;r++)if(n(u)===!1)return!1;return!0})},n.Bag.prototype.size=function(){return this.nElements},n.Bag.prototype.isEmpty=function(){return this.nElements===0},n.Bag.prototype.clear=function(){this.nElements=0;this.dictionary.clear()},n.BSTree=function(t){this.root=null;this.compare=t||n.defaultCompare;this.nElements=0},n.BSTree.prototype.add=function(t){return n.isUndefined(t)?!1:this.insertNode(this.createNode(t))!==null?(this.nElements++,!0):!1},n.BSTree.prototype.clear=function(){this.root=null;this.nElements=0},n.BSTree.prototype.isEmpty=function(){return this.nElements===0},n.BSTree.prototype.size=function(){return this.nElements},n.BSTree.prototype.contains=function(t){return n.isUndefined(t)?!1:this.searchNode(this.root,t)!==null},n.BSTree.prototype.remove=function(n){var t=this.searchNode(this.root,n);return t===null?!1:(this.removeNode(t),this.nElements--,!0)},n.BSTree.prototype.inorderTraversal=function(n){this.inorderTraversalAux(this.root,n,{stop:!1})},n.BSTree.prototype.preorderTraversal=function(n){this.preorderTraversalAux(this.root,n,{stop:!1})},n.BSTree.prototype.postorderTraversal=function(n){this.postorderTraversalAux(this.root,n,{stop:!1})},n.BSTree.prototype.levelTraversal=function(n){this.levelTraversalAux(this.root,n)},n.BSTree.prototype.minimum=function(){return this.isEmpty()?undefined:this.minimumAux(this.root).element},n.BSTree.prototype.maximum=function(){return this.isEmpty()?undefined:this.maximumAux(this.root).element},n.BSTree.prototype.forEach=function(n){this.inorderTraversal(n)},n.BSTree.prototype.toArray=function(){var n=[];return this.inorderTraversal(function(t){n.push(t)}),n},n.BSTree.prototype.height=function(){return this.heightAux(this.root)},n.BSTree.prototype.searchNode=function(n,t){for(var i=null;n!==null&&i!==0;)i=this.compare(t,n.element),i<0?n=n.leftCh:i>0&&(n=n.rightCh);return n},n.BSTree.prototype.transplant=function(n,t){n.parent===null?this.root=t:n===n.parent.leftCh?n.parent.leftCh=t:n.parent.rightCh=t;t!==null&&(t.parent=n.parent)},n.BSTree.prototype.removeNode=function(n){if(n.leftCh===null)this.transplant(n,n.rightCh);else if(n.rightCh===null)this.transplant(n,n.leftCh);else{var t=this.minimumAux(n.rightCh);t.parent!==n&&(this.transplant(t,t.rightCh),t.rightCh=n.rightCh,t.rightCh.parent=t);this.transplant(n,t);t.leftCh=n.leftCh;t.leftCh.parent=t}},n.BSTree.prototype.inorderTraversalAux=function(n,t,i){n===null||i.stop||(this.inorderTraversalAux(n.leftCh,t,i),i.stop)||(i.stop=t(n.element)===!1,i.stop)||this.inorderTraversalAux(n.rightCh,t,i)},n.BSTree.prototype.levelTraversalAux=function(t,i){var r=new n.Queue;for(t!==null&&r.enqueue(t);!r.isEmpty();){if(t=r.dequeue(),i(t.element)===!1)return;t.leftCh!==null&&r.enqueue(t.leftCh);t.rightCh!==null&&r.enqueue(t.rightCh)}},n.BSTree.prototype.preorderTraversalAux=function(n,t,i){n===null||i.stop||(i.stop=t(n.element)===!1,i.stop)||(this.preorderTraversalAux(n.leftCh,t,i),i.stop)||this.preorderTraversalAux(n.rightCh,t,i)},n.BSTree.prototype.postorderTraversalAux=function(n,t,i){n===null||i.stop||(this.postorderTraversalAux(n.leftCh,t,i),i.stop)||(this.postorderTraversalAux(n.rightCh,t,i),i.stop)||(i.stop=t(n.element)===!1)},n.BSTree.prototype.minimumAux=function(n){while(n.leftCh!==null)n=n.leftCh;return n},n.BSTree.prototype.maximumAux=function(n){while(n.rightCh!==null)n=n.rightCh;return n},n.BSTree.prototype.successorNode=function(n){if(n.rightCh!==null)return this.minimumAux(n.rightCh);for(var t=n.parent;t!==null&&n===t.rightCh;)n=t,t=n.parent;return t},n.BSTree.prototype.heightAux=function(n){return n===null?-1:Math.max(this.heightAux(n.leftCh),this.heightAux(n.rightCh))+1},n.BSTree.prototype.insertNode=function(n){for(var i=null,t=this.root,r=null;t!==null;){if(r=this.compare(n.element,t.element),r===0)return null;r<0?(i=t,t=t.leftCh):(i=t,t=t.rightCh)}return n.parent=i,i===null?this.root=n:this.compare(n.element,i.element)<0?i.leftCh=n:i.rightCh=n,n},n.BSTree.prototype.createNode=function(n){return{element:n,leftCh:null,rightCh:null,parent:null}},n});
/*!	
* FitText.js 1.1
*
* Copyright 2011, Dave Rupert http://daverupert.com
* Released under the WTFPL license 
* http://sam.zoy.org/wtfpl/
*
* Date: Thu May 05 14:23:00 2011 -0600
*/
(function(n){n.fn.fitText=function(t,i){var u=t||1,r=n.extend({minFontSize:Number.NEGATIVE_INFINITY,maxFontSize:Number.POSITIVE_INFINITY},i);return this.each(function(){var t=n(this),i=function(){t.css("font-size",Math.max(Math.min(t.width()/(u*10),parseFloat(r.maxFontSize)),parseFloat(r.minFontSize)))};i();n(window).on("resize",i)})}})(jQuery);
/*!	
* Lettering.JS 0.6.1
*
* Copyright 2010, Dave Rupert http://daverupert.com
* Released under the WTFPL license 
* http://sam.zoy.org/wtfpl/
*
* Thanks to Paul Irish - http://paulirish.com - for the feedback.
*
* Date: Mon Sep 20 17:14:00 2010 -0600
*/
(function(n){function t(t,i,r,u){var f=t.text().split(i),e="";f.length&&(n(f).each(function(n,t){e+='<span class="'+r+(n+1)+'">'+t+"<\/span>"+u}),t.empty().append(e))}var i={init:function(){return this.each(function(){t(n(this),"","char","")})},words:function(){return this.each(function(){t(n(this)," ","word"," ")})},lines:function(){return this.each(function(){var i="eefec303079ad17405c889e092e105b0";t(n(this).children("br").replaceWith(i).end(),i,"line","")})}};n.fn.lettering=function(t){return t&&i[t]?i[t].apply(this,[].slice.call(arguments,1)):t==="letters"||!t?i.init.apply(this,[].slice.call(arguments,0)):(n.error("Method "+t+" does not exist on jQuery.lettering"),this)}})(jQuery),function(n){"use strict";function t(t){return/In/.test(t)||n.inArray(t,n.fn.textillate.defaults.inEffects)>=0}function i(t){return/Out/.test(t)||n.inArray(t,n.fn.textillate.defaults.outEffects)>=0}function r(t){var r=t.attributes||[],i={};return r.length?(n.each(r,function(n,t){/^data-in-*/.test(t.nodeName)?(i.in=i.in||{},i.in[t.nodeName.replace(/data-in-/,"")]=t.nodeValue):/^data-out-*/.test(t.nodeName)?(i.out=i.out||{},i.out[t.nodeName.replace(/data-out-/,"")]=t.nodeValue):/^data-*/.test(t.nodeName)&&(i[t.nodeName]=t.nodeValue)}),i):i}function f(n){for(var i,r,t=n.length;t;i=parseInt(Math.random()*t),r=n[--t],n[t]=n[i],n[i]=r);return n}function e(n,t,i){n.addClass("animated "+t).css("visibility","visible").show();n.one("animationend webkitAnimationEnd oAnimationEnd",function(){n.removeClass("animated "+t);i&&i()})}function u(r,u,o){var h=this,s=r.length;if(!s){o&&o();return}u.shuffle&&(r=f(r));u.reverse&&(r=r.toArray().reverse());n.each(r,function(r,f){function c(){t(u.effect)?h.css("visibility","visible"):i(u.effect)&&h.css("visibility","hidden");s-=1;!s&&o&&o()}var h=n(f),l=u.sync?u.delay:u.delay*r*u.delayScale;h.text()?setTimeout(function(){e(h,u.effect,c)},l):c()})}var o=function(f,e){var o=this,s=n(f);o.init=function(){o.$texts=s.find(e.selector);o.$texts.length||(o.$texts=n('<ul class="texts"><li>'+s.html()+"<\/li><\/ul>"),s.html(o.$texts));o.$texts.hide();o.$current=n("<span>").text(o.$texts.find(":first-child").html()).prependTo(s);t(e.effect)?o.$current.css("visibility","hidden"):i(e.effect)&&o.$current.css("visibility","visible");o.setOptions(e);setTimeout(function(){o.options.autoStart&&o.start()},o.options.initialDelay)};o.setOptions=function(n){o.options=n};o.triggerEvent=function(t){var i=n.Event(t+".tlt");return s.trigger(i,o),i};o.in=function(f,e){f=f||0;var c=o.$texts.find(":nth-child("+(f+1)+")"),s=n.extend({},o.options,r(c)),h;c.addClass("current");o.triggerEvent("inAnimationBegin");o.$current.text(c.html()).lettering("words");o.$current.find('[class^="word"]').css({display:"inline-block","-webkit-transform":"translate3d(0,0,0)","-moz-transform":"translate3d(0,0,0)","-o-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)"}).each(function(){n(this).lettering()});h=o.$current.find('[class^="char"]').css("display","inline-block");t(s.in.effect)?h.css("visibility","hidden"):i(s.in.effect)&&h.css("visibility","visible");o.currentIndex=f;u(h,s.in,function(){o.triggerEvent("inAnimationEnd");s.in.callback&&s.in.callback();e&&e(o)})};o.out=function(t){var f=o.$texts.find(":nth-child("+(o.currentIndex+1)+")"),e=o.$current.find('[class^="char"]'),i=n.extend({},o.options,r(f));o.triggerEvent("outAnimationBegin");u(e,i.out,function(){f.removeClass("current");o.triggerEvent("outAnimationEnd");i.out.callback&&i.out.callback();t&&t(o)})};o.start=function(n){o.triggerEvent("start"),function t(n){o.in(n,function(){var i=o.$texts.children().length;n+=1;!o.options.loop&&n>=i?(o.options.callback&&o.options.callback(),o.triggerEvent("end")):(n=n%i,setTimeout(function(){o.out(function(){t(n)})},o.options.minDisplayTime))})}(n||0)};o.init()};n.fn.textillate=function(t,i){return this.each(function(){var f=n(this),u=f.data("textillate"),e=n.extend(!0,{},n.fn.textillate.defaults,r(this),typeof t=="object"&&t);u?typeof t=="string"?u[t].apply(u,[].concat(i)):u.setOptions.call(u,e):f.data("textillate",u=new o(this,e))})};n.fn.textillate.defaults={selector:".texts",loop:!1,minDisplayTime:2e3,initialDelay:0,"in":{effect:"fadeInLeftBig",delayScale:1.5,delay:50,sync:!1,reverse:!1,shuffle:!1,callback:function(){}},out:{effect:"hinge",delayScale:1.5,delay:50,sync:!1,reverse:!1,shuffle:!1,callback:function(){}},autoStart:!0,inEffects:[],outEffects:["hinge"],callback:function(){}}}(jQuery);
/*! FileSaver.js
 *  A saveAs() FileSaver implementation.
 *  2014-01-24
 *
 *  By Eli Grey, http://eligrey.com
 *  License: X11/MIT
 *    See LICENSE.md
 */
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(n){"use strict";if(typeof navigator=="undefined"||!/MSIE [1-9]\./.test(navigator.userAgent)){var i=n.document,v=function(){return n.URL||n.webkitURL||n},y=n.URL||n.webkitURL||n,r=i.createElementNS("http://www.w3.org/1999/xhtml","a"),p=!n.externalHost&&"download"in r,b=function(t){var r=i.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null);t.dispatchEvent(r)},f=n.webkitRequestFileSystem,h=n.requestFileSystem||f||n.mozRequestFileSystem,w=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},e="application/octet-stream",c=0,u=[],o=function(){for(var t=u.length,n;t--;)n=u[t],typeof n=="string"?y.revokeObjectURL(n):n.remove();u.length=0},s=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){w(f)}},l=function(t,o){var l=this,k=t.type,g=!1,y,b,nt=function(){var n=v().createObjectURL(t);return u.push(n),n},tt=function(){s(l,"writestart progress write writeend".split(" "))},a=function(){(g||!y)&&(y=nt(t));b?b.location.href=y:window.open(y,"_blank");l.readyState=l.DONE;tt()},w=function(n){return function(){if(l.readyState!==l.DONE)return n.apply(this,arguments)}},it={create:!0,exclusive:!1},rt,d;if(l.readyState=l.INIT,o||(o="download"),p){y=nt(t);i=n.document;r=i.createElementNS("http://www.w3.org/1999/xhtml","a");r.href=y;r.download=o;d=i.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null);r.dispatchEvent(d);l.readyState=l.DONE;tt();return}if(n.chrome&&k&&k!==e&&(rt=t.slice||t.webkitSlice,t=rt.call(t,0,t.size,e),g=!0),f&&o!=="download"&&(o+=".download"),(k===e||f)&&(b=n),!h){a();return}c+=t.size;h(n.TEMPORARY,c,w(function(n){n.root.getDirectory("saved",it,w(function(n){var i=function(){n.getFile(o,it,w(function(n){n.createWriter(w(function(i){i.onwriteend=function(t){b.location.href=n.toURL();u.push(n);l.readyState=l.DONE;s(l,"writeend",t)};i.onerror=function(){var n=i.error;n.code!==n.ABORT_ERR&&a()};"writestart progress write abort".split(" ").forEach(function(n){i["on"+n]=l["on"+n]});i.write(t);l.abort=function(){i.abort();l.readyState=l.DONE};l.readyState=l.WRITING}),a)}),a)};n.getFile(o,{create:!1},w(function(n){n.remove();i()}),w(function(n){n.code===n.NOT_FOUND_ERR?i():a()}))}),a)}),a)},t=l.prototype,a=function(n,t){return new l(n,t)};return t.abort=function(){var n=this;n.readyState=n.DONE;s(n,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n.addEventListener("unload",o,!1),a.unload=function(){o();n.removeEventListener("unload",o,!1)},a}}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs}),function(n,t){typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?module.exports=t():n.indexed=t()}(this,function(){function n(n){return{processCB:function(n,t){if(n&&typeof n=="function"){var i=t===!1?!0:!1;n(i,t)}else console.error("Improper callback")},parseQuery:function(n){var t=[];return Array.isArray(n)||(n=[n]),n.forEach(function(n){var i=Object.keys(n),r;typeof n[i]=="object"?(r=Object.keys(n[i]),t.push({field:i[0],operand:r[0],value:n[i][r]})):t.push({field:i[0],operand:"$eq",value:n[i]})}),t},checkType:function(n){return{}.toString.call(n).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},create:function(t){var r=this,i=window.indexedDB.open(n);i.onupgradeneeded=function(t){var i=t.target.result;i.createObjectStore(n,{keyPath:"_id",autoIncrement:!1})};i.onsuccess=function(n){n.target.result.close();r.processCB(t,!0)};i.onerror=function(){r.processCB(t,!1)}},insert:function(t,i){var r=this,u=window.indexedDB.open(n);u.onsuccess=function(u){function h(){f<t.length?(t[f]._id=(new Date).getTime()+f,o.put(t[f]).onsuccess=h,f++):r.find(s,i)}var e=u.target.result,l=e.transaction([n],r.IDBTransactionModes.READ_WRITE),o=l.objectStore(n),f,s,c;r.checkType(t)==="array"?(f=0,s={_id:{$gte:(new Date).getTime()}},h()):(t._id=(new Date).getTime(),c=o.put(t).onsuccess=function(){r.find({_id:t._id},i);e.close()},c.onerror=function(){r.processCB(i,!1)})};u.onerror=function(){r.processCB(i,!1)}},traverse:function(t,i,r){var u=this,f=window.indexedDB.open(n);f.onsuccess=function(f){var o=f.target.result,s=o.transaction([n],u.IDBTransactionModes.READ_WRITE),c=s.objectStore(n),l=IDBKeyRange.lowerBound(0),h=c.openCursor(l),e=[];h.onsuccess=function(n){function s(n,t,i){switch(t){case"$gt":return n>i;case"$lt":return n<i;case"$gte":return n>=i;case"$lte":return n<=i;case"$ne":return n!=i;case"$eq":return n==i;case"$like":return new RegExp(i,"i").test(n)}}var r=n.target.result,f,o;if(r){if(t){if(o=!0,t.forEach(function(n){o=o&&s(r.value[n.field],n.operand,n.value)}),o){if(u.checkType(i)==="object"){for(f in i)r.value[f]=i[f];r.update(r.value)}i==="delete"&&r.delete(r.value._id);e.push(r.value)}}else{if(u.checkType(i)==="object"){for(f in i)r.value[f]=i[f];r.update(r.value)}i==="delete"&&r.delete(r.value._id);e.push(r.value)}r.continue()}};s.oncomplete=function(){u.processCB(r,e);o.close()};h.onerror=function(){u.processCB(r,!1)}};f.onerror=function(){u.processCB(r,!1)}},find:function(){var t=!1,n;arguments.length===1&&typeof arguments[0]=="function"?n=arguments[0]:(t=this.parseQuery(arguments[0]),n=arguments[1]);this.traverse(t,!1,n)},update:function(){var i=!1,n,t;arguments.length===2&&typeof arguments[1]=="function"?(n=arguments[0],t=arguments[1]):(i=this.parseQuery(arguments[0]),n=arguments[1],t=arguments[2]);this.traverse(i,n,t)},"delete":function(){var t=!1,n;arguments.length===1&&typeof arguments[0]=="function"?n=arguments[0]:(t=this.parseQuery(arguments[0]),n=arguments[1]);this.traverse(t,"delete",n)},drop:function(t){var i=this,r=window.indexedDB.deleteDatabase(n);r.onsuccess=function(){i.processCB(t,!0);i.create()};r.onblocked=function(){i.processCB(t,!1)};r.onerror=function(){i.processCB(t,!1)}},IDBTransactionModes:{READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"}}}return window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,n});
//! moment.js
//! version : 2.9.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(n){function it(n,t,i){switch(arguments.length){case 2:return null!=n?n:t;case 3:return null!=n?n:null!=t?t:i;default:throw new Error("Implement me");}}function p(n,t){return uf.call(n,t)}function ot(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function ri(n){t.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+n)}function o(n,t){var i=!0;return w(function(){return i&&(ri(n),i=!1),t.apply(this,arguments)},t)}function dr(n,t){br[n]||(ri(t),br[n]=!0)}function ui(n,t){return function(i){return r(n.call(this,i),t)}}function gr(n,t){return function(i){return this.localeData().ordinal(n.call(this,i),t)}}function nu(n,t){var r,f,u=12*(t.year()-n.year())+(t.month()-n.month()),i=n.clone().add(u,"months");return 0>t-i?(r=n.clone().add(u-1,"months"),f=(t-i)/(i-r)):(r=n.clone().add(u+1,"months"),f=(t-i)/(r-i)),-(u+f)}function tu(n,t,i){var r;return null==i?t:null!=n.meridiemHour?n.meridiemHour(t,i):null!=n.isPM?(r=n.isPM(i),r&&12>t&&(t+=12),r||12!==t||(t=0),t):t}function fi(){}function rt(n,i){i!==!1&&pi(n);ei(this,n);this._d=new Date(+n._d);ii===!1&&(ii=!0,t.updateOffset(this),ii=!1)}function st(n){var i=li(n),r=i.year||0,u=i.quarter||0,f=i.month||0,e=i.week||0,o=i.day||0,s=i.hour||0,h=i.minute||0,c=i.second||0,l=i.millisecond||0;this._milliseconds=+l+1e3*c+6e4*h+36e5*s;this._days=+o+7*e;this._months=+f+3*u+12*r;this._data={};this._locale=t.localeData();this._bubble()}function w(n,t){for(var i in t)p(t,i)&&(n[i]=t[i]);return p(t,"toString")&&(n.toString=t.toString),p(t,"valueOf")&&(n.valueOf=t.valueOf),n}function ei(n,t){var u,i,r;if("undefined"!=typeof t._isAMomentObject&&(n._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(n._i=t._i),"undefined"!=typeof t._f&&(n._f=t._f),"undefined"!=typeof t._l&&(n._l=t._l),"undefined"!=typeof t._strict&&(n._strict=t._strict),"undefined"!=typeof t._tzm&&(n._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(n._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(n._offset=t._offset),"undefined"!=typeof t._pf&&(n._pf=t._pf),"undefined"!=typeof t._locale&&(n._locale=t._locale),ft.length>0)for(u in ft)i=ft[u],r=t[i],"undefined"!=typeof r&&(n[i]=r);return n}function s(n){return 0>n?Math.ceil(n):Math.floor(n)}function r(n,t,i){for(var r=""+Math.abs(n),u=n>=0;r.length<t;)r="0"+r;return(u?i?"+":"":"-")+r}function oi(n,t){var i={milliseconds:0,months:0};return i.months=t.month()-n.month()+12*(t.year()-n.year()),n.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+n.clone().add(i.months,"M"),i}function iu(n,t){var i;return t=lt(t,n),n.isBefore(t)?i=oi(n,t):(i=oi(t,n),i.milliseconds=-i.milliseconds,i.months=-i.months),i}function si(n,i){return function(r,u){var f,e;return null===u||isNaN(+u)||(dr(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period)."),e=r,r=u,u=e),r="string"==typeof r?+r:r,f=t.duration(r,u),hi(this,f,n),this}}function hi(n,i,r,u){var o=i._milliseconds,f=i._days,e=i._months;u=null==u?!0:u;o&&n._d.setTime(+n._d+o*r);f&&rr(n,"Date",bt(n,"Date")+f*r);e&&ir(n,bt(n,"Month")+e*r);u&&t.updateOffset(n,f||e)}function ut(n){return"[object Array]"===Object.prototype.toString.call(n)}function ht(n){return"[object Date]"===Object.prototype.toString.call(n)||n instanceof Date}function ci(n,t,r){for(var e=Math.min(n.length,t.length),o=Math.abs(n.length-t.length),f=0,u=0;e>u;u++)(r&&n[u]!==t[u]||!r&&i(n[u])!==i(t[u]))&&f++;return f+o}function f(n){if(n){var t=n.toLowerCase().replace(/(.)s$/,"$1");n=ne[n]||te[t]||t}return n}function li(n){var i,t,r={};for(t in n)p(n,t)&&(i=f(t),i&&(r[i]=n[t]));return r}function ru(i){var r,u;if(0===i.indexOf("week"))r=7,u="day";else{if(0!==i.indexOf("month"))return;r=12;u="month"}t[i]=function(f,e){var o,s,c=t._locale[i],h=[];if("number"==typeof f&&(e=f,f=n),s=function(n){var i=t().utc().set(u,n);return c.call(t._locale,i,f||"")},null!=e)return s(e);for(o=0;r>o;o++)h.push(s(o));return h}}function i(n){var t=+n,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function ct(n,t){return new Date(Date.UTC(n,t+1,0)).getUTCDate()}function ai(n,i,r){return b(t([n,11,31+i-r]),i,r).week}function vi(n){return yi(n)?366:365}function yi(n){return n%4==0&&n%100!=0||n%400==0}function pi(n){var t;n._a&&-2===n._pf.overflow&&(t=n._a[a]<0||n._a[a]>11?a:n._a[h]<1||n._a[h]>ct(n._a[l],n._a[a])?h:n._a[e]<0||n._a[e]>24||24===n._a[e]&&(0!==n._a[d]||0!==n._a[g]||0!==n._a[nt])?e:n._a[d]<0||n._a[d]>59?d:n._a[g]<0||n._a[g]>59?g:n._a[nt]<0||n._a[nt]>999?nt:-1,n._pf._overflowDayOfYear&&(l>t||t>h)&&(t=h),n._pf.overflow=t)}function wi(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===n)),t._isValid}function bi(n){return n?n.toLowerCase().replace("_","-"):n}function uu(n){for(var i,t,f,r,u=0;u<n.length;){for(r=bi(n[u]).split("-"),i=r.length,t=bi(n[u+1]),t=t?t.split("-"):null;i>0;){if(f=ki(r.slice(0,i).join("-")))return f;if(t&&t.length>=i&&ci(r,t,!0)>=i-1)break;i--}u++}return null}function ki(n){var i=null;if(!tt[n]&&sr)try{i=t.locale();require("./locale/"+n);t.locale(i)}catch(r){}return tt[n]}function lt(n,i){var r,u;return i._isUTC?(r=i.clone(),u=(t.isMoment(n)||ht(n)?+n:+t(n))-+r,r._d.setTime(+r._d+u),t.updateOffset(r,!1),r):t(n).local()}function fu(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function eu(n){for(var i=n.match(hr),t=0,r=i.length;r>t;t++)i[t]=v[i[t]]?v[i[t]]:fu(i[t]);return function(u){var f="";for(t=0;r>t;t++)f+=i[t]instanceof Function?i[t].call(u,n):i[t];return f}}function at(n,t){return n.isValid()?(t=di(t,n.localeData()),ti[t]||(ti[t]=eu(t)),ti[t](n)):n.localeData().invalidDate()}function di(n,t){function r(n){return t.longDateFormat(n)||n}var i=5;for(et.lastIndex=0;i>=0&&et.test(n);)n=n.replace(et,r),et.lastIndex=0,i-=1;return n}function ou(n,t){var i=t._strict;switch(n){case"Q":return lr;case"DDDD":return vr;case"YYYY":case"GGGG":case"gggg":return i?wf:hf;case"Y":case"G":case"g":return kf;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?bf:cf;case"S":if(i)return lr;case"SS":if(i)return ar;case"SSS":if(i)return vr;case"DDD":return sf;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return af;case"a":case"A":return t._locale._meridiemParse;case"x":return yf;case"X":return pf;case"Z":case"ZZ":return dt;case"T":return vf;case"SSSS":return lf;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?ar:cr;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return cr;case"Do":return i?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return new RegExp(vu(au(n.replace("\\","")),"i"))}}function vt(n){n=n||"";var r=n.match(dt)||[],f=r[r.length-1]||[],t=(f+"").match(gf)||["-",0,0],u=+(60*t[1])+i(t[2]);return"+"===t[0]?u:-u}function su(n,r,u){var o,f=u._a;switch(n){case"Q":null!=r&&(f[a]=3*(i(r)-1));break;case"M":case"MM":null!=r&&(f[a]=i(r)-1);break;case"MMM":case"MMMM":o=u._locale.monthsParse(r,n,u._strict);null!=o?f[a]=o:u._pf.invalidMonth=r;break;case"D":case"DD":null!=r&&(f[h]=i(r));break;case"Do":null!=r&&(f[h]=i(parseInt(r.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=r&&(u._dayOfYear=i(r));break;case"YY":f[l]=t.parseTwoDigitYear(r);break;case"YYYY":case"YYYYY":case"YYYYYY":f[l]=i(r);break;case"a":case"A":u._meridiem=r;break;case"h":case"hh":u._pf.bigHour=!0;case"H":case"HH":f[e]=i(r);break;case"m":case"mm":f[d]=i(r);break;case"s":case"ss":f[g]=i(r);break;case"S":case"SS":case"SSS":case"SSSS":f[nt]=i(1e3*("0."+r));break;case"x":u._d=new Date(i(r));break;case"X":u._d=new Date(1e3*parseFloat(r));break;case"Z":case"ZZ":u._useUTC=!0;u._tzm=vt(r);break;case"dd":case"ddd":case"dddd":o=u._locale.weekdaysParse(r);null!=o?(u._w=u._w||{},u._w.d=o):u._pf.invalidWeekday=r;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":n=n.substr(0,1);case"gggg":case"GGGG":case"GGGGG":n=n.substr(0,2);r&&(u._w=u._w||{},u._w[n]=i(r));break;case"gg":case"GG":u._w=u._w||{};u._w[n]=t.parseTwoDigitYear(r)}}function hu(n){var i,o,f,u,r,e,s;i=n._w;null!=i.GG||null!=i.W||null!=i.E?(r=1,e=4,o=it(i.GG,n._a[l],b(t(),1,4).year),f=it(i.W,1),u=it(i.E,1)):(r=n._locale._week.dow,e=n._locale._week.doy,o=it(i.gg,n._a[l],b(t(),r,e).year),f=it(i.w,1),null!=i.d?(u=i.d,r>u&&++f):u=null!=i.e?i.e+r:r);s=tf(o,f,u,e,r);n._a[l]=s.year;n._dayOfYear=s.dayOfYear}function yt(n){var t,i,r,u,f=[];if(!n._d){for(r=lu(n),n._w&&null==n._a[h]&&null==n._a[a]&&hu(n),n._dayOfYear&&(u=it(n._a[l],r[l]),n._dayOfYear>vi(u)&&(n._pf._overflowDayOfYear=!0),i=wt(u,0,n._dayOfYear),n._a[a]=i.getUTCMonth(),n._a[h]=i.getUTCDate()),t=0;3>t&&null==n._a[t];++t)n._a[t]=f[t]=r[t];for(;7>t;t++)n._a[t]=f[t]=null==n._a[t]?2===t?1:0:n._a[t];24===n._a[e]&&0===n._a[d]&&0===n._a[g]&&0===n._a[nt]&&(n._nextDay=!0,n._a[e]=0);n._d=(n._useUTC?wt:ku).apply(null,f);null!=n._tzm&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm);n._nextDay&&(n._a[e]=24)}}function cu(n){var t;n._d||(t=li(n._i),n._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],yt(n))}function lu(n){var t=new Date;return n._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function pt(i){if(i._f===t.ISO_8601)return void gi(i);i._a=[];i._pf.empty=!0;for(var r,f,h,u=""+i._i,l=u.length,c=0,s=di(i._f,i._locale).match(hr)||[],o=0;o<s.length;o++)f=s[o],r=(u.match(ou(f,i))||[])[0],r&&(h=u.substr(0,u.indexOf(r)),h.length>0&&i._pf.unusedInput.push(h),u=u.slice(u.indexOf(r)+r.length),c+=r.length),v[f]?(r?i._pf.empty=!1:i._pf.unusedTokens.push(f),su(f,r,i)):i._strict&&!r&&i._pf.unusedTokens.push(f);i._pf.charsLeftOver=l-c;u.length>0&&i._pf.unusedInput.push(u);i._pf.bigHour===!0&&i._a[e]<=12&&(i._pf.bigHour=n);i._a[e]=tu(i._locale,i._a[e],i._meridiem);yt(i);pi(i)}function au(n){return n.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(n,t,i,r,u){return t||i||r||u})}function vu(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function yu(n){var t,f,u,r,i;if(0===n._f.length)return n._pf.invalidFormat=!0,void(n._d=new Date(NaN));for(r=0;r<n._f.length;r++)i=0,t=ei({},n),null!=n._useUTC&&(t._useUTC=n._useUTC),t._pf=ot(),t._f=n._f[r],pt(t),wi(t)&&(i+=t._pf.charsLeftOver,i+=10*t._pf.unusedTokens.length,t._pf.score=i,(null==u||u>i)&&(u=i,f=t));w(n,f||t)}function gi(n){var t,i,r=n._i,u=df.exec(r);if(u){for(n._pf.iso=!0,t=0,i=gt.length;i>t;t++)if(gt[t][1].exec(r)){n._f=gt[t][0]+(u[6]||" ");break}for(t=0,i=ni.length;i>t;t++)if(ni[t][1].exec(r)){n._f+=ni[t][0];break}r.match(dt)&&(n._f+="Z");pt(n)}else n._isValid=!1}function pu(n){gi(n);n._isValid===!1&&(delete n._isValid,t.createFromInputFallback(n))}function wu(n,t){for(var r=[],i=0;i<n.length;++i)r.push(t(n[i],i));return r}function bu(i){var u,r=i._i;r===n?i._d=new Date:ht(r)?i._d=new Date(+r):null!==(u=ff.exec(r))?i._d=new Date(+u[1]):"string"==typeof r?pu(i):ut(r)?(i._a=wu(r.slice(0),function(n){return parseInt(n,10)}),yt(i)):"object"==typeof r?cu(i):"number"==typeof r?i._d=new Date(r):t.createFromInputFallback(i)}function ku(n,t,i,r,u,f,e){var o=new Date(n,t,i,r,u,f,e);return 1970>n&&o.setFullYear(n),o}function wt(n){var t=new Date(Date.UTC.apply(null,arguments));return 1970>n&&t.setUTCFullYear(n),t}function du(n,t){if("string"==typeof n)if(isNaN(n)){if(n=t.weekdaysParse(n),"number"!=typeof n)return null}else n=parseInt(n,10);return n}function gu(n,t,i,r,u){return u.relativeTime(t||1,!!i,n,r)}function nf(n,i,r){var u=t.duration(n).abs(),c=k(u.as("s")),e=k(u.as("m")),o=k(u.as("h")),s=k(u.as("d")),h=k(u.as("M")),l=k(u.as("y")),f=c<y.s&&["s",c]||1===e&&["m"]||e<y.m&&["mm",e]||1===o&&["h"]||o<y.h&&["hh",o]||1===s&&["d"]||s<y.d&&["dd",s]||1===h&&["M"]||h<y.M&&["MM",h]||1===l&&["y"]||["yy",l];return f[2]=i,f[3]=+n>0,f[4]=r,gu.apply({},f)}function b(n,i,r){var f,e=r-i,u=r-n.day();return u>e&&(u-=7),e-7>u&&(u+=7),f=t(n).add(u,"d"),{week:Math.ceil(f.dayOfYear()/7),year:f.year()}}function tf(n,t,i,r,u){var o,e,f=wt(n,0,1).getUTCDay();return f=0===f?7:f,i=null!=i?i:u,o=u-f+(f>r?7:0)-(u>f?7:0),e=7*(t-1)+(i-u)+o+1,{year:e>0?n:n-1,dayOfYear:e>0?e:vi(n-1)+e}}function nr(i){var u,r=i._i,f=i._f;return i._locale=i._locale||t.localeData(i._l),null===r||f===n&&""===r?t.invalid({nullInput:!0}):("string"==typeof r&&(i._i=r=i._locale.preparse(r)),t.isMoment(r)?new rt(r,!0):(f?ut(f)?yu(i):pt(i):bu(i),u=new rt(i),u._nextDay&&(u.add(1,"d"),u._nextDay=n),u))}function tr(n,i){var u,r;if(1===i.length&&ut(i[0])&&(i=i[0]),!i.length)return t();for(u=i[0],r=1;r<i.length;++r)i[r][n](u)&&(u=i[r]);return u}function ir(n,t){var i;return"string"==typeof t&&(t=n.localeData().monthsParse(t),"number"!=typeof t)?n:(i=Math.min(n.date(),ct(n.year(),t)),n._d["set"+(n._isUTC?"UTC":"")+"Month"](t,i),n)}function bt(n,t){return n._d["get"+(n._isUTC?"UTC":"")+t]()}function rr(n,t,i){return"Month"===t?ir(n,i):n._d["set"+(n._isUTC?"UTC":"")+t](i)}function c(n,i){return function(r){return null!=r?(rr(this,n,r),t.updateOffset(this,i),this):bt(this,n)}}function ur(n){return 400*n/146097}function fr(n){return 146097*n/400}function rf(n){t.duration.fn[n]=function(){return this._data[n]}}function er(n){"undefined"==typeof ender&&(or=kt.moment,kt.moment=n?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",t):t)}for(var t,or,u,kt="undefined"==typeof global||"undefined"!=typeof window&&window!==global.window?this:global,k=Math.round,uf=Object.prototype.hasOwnProperty,l=0,a=1,h=2,e=3,d=4,g=5,nt=6,tt={},ft=[],sr="undefined"!=typeof module&&module&&module.exports,ff=/^\/?Date\((\-?\d+)/i,ef=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,of=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,hr=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,et=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,cr=/\d\d?/,sf=/\d{1,3}/,hf=/\d{1,4}/,cf=/[+\-]?\d{1,6}/,lf=/\d+/,af=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,dt=/Z|[\+\-]\d\d:?\d\d/gi,vf=/T/i,yf=/[\+\-]?\d+/,pf=/[\+\-]?\d+(\.\d{1,3})?/,lr=/\d/,ar=/\d\d/,vr=/\d{3}/,wf=/\d{4}/,bf=/[+-]?\d{6}/,kf=/[+-]?\d+/,df=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ni=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],gf=/([\+\-]|\d\d)/gi,yr=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),ne={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},te={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ti={},y={s:45,m:45,h:22,d:26,M:11},pr="DDD w W M D d".split(" "),wr="M D H h m s w W".split(" "),v={M:function(){return this.month()+1},MMM:function(n){return this.localeData().monthsShort(this,n)},MMMM:function(n){return this.localeData().months(this,n)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(n){return this.localeData().weekdaysMin(this,n)},ddd:function(n){return this.localeData().weekdaysShort(this,n)},dddd:function(n){return this.localeData().weekdays(this,n)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return r(this.year()%100,2)},YYYY:function(){return r(this.year(),4)},YYYYY:function(){return r(this.year(),5)},YYYYYY:function(){var n=this.year(),t=n>=0?"+":"-";return t+r(Math.abs(n),6)},gg:function(){return r(this.weekYear()%100,2)},gggg:function(){return r(this.weekYear(),4)},ggggg:function(){return r(this.weekYear(),5)},GG:function(){return r(this.isoWeekYear()%100,2)},GGGG:function(){return r(this.isoWeekYear(),4)},GGGGG:function(){return r(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return i(this.milliseconds()/100)},SS:function(){return r(i(this.milliseconds()/10),2)},SSS:function(){return r(this.milliseconds(),3)},SSSS:function(){return r(this.milliseconds(),3)},Z:function(){var n=this.utcOffset(),t="+";return 0>n&&(n=-n,t="-"),t+r(i(n/60),2)+":"+r(i(n)%60,2)},ZZ:function(){var n=this.utcOffset(),t="+";return 0>n&&(n=-n,t="-"),t+r(i(n/60),2)+r(i(n)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},br={},kr=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],ii=!1;pr.length;)u=pr.pop(),v[u+"o"]=gr(v[u],u);for(;wr.length;)u=wr.pop(),v[u+u]=ui(v[u],2);for(v.DDDD=ui(v.DDD,3),w(fi.prototype,{set:function(n){var t;for(var i in n)t=n[i],"function"==typeof t?this[i]=t:this["_"+i]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(n){return this._months[n.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(n){return this._monthsShort[n.month()]},monthsParse:function(n,i,r){var u,f,e;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),u=0;12>u;u++)if((f=t.utc([2e3,u]),r&&!this._longMonthsParse[u]&&(this._longMonthsParse[u]=new RegExp("^"+this.months(f,"").replace(".","")+"$","i"),this._shortMonthsParse[u]=new RegExp("^"+this.monthsShort(f,"").replace(".","")+"$","i")),r||this._monthsParse[u]||(e="^"+this.months(f,"")+"|^"+this.monthsShort(f,""),this._monthsParse[u]=new RegExp(e.replace(".",""),"i")),r&&"MMMM"===i&&this._longMonthsParse[u].test(n))||r&&"MMM"===i&&this._shortMonthsParse[u].test(n)||!r&&this._monthsParse[u].test(n))return u},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(n){return this._weekdays[n.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(n){return this._weekdaysShort[n.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(n){return this._weekdaysMin[n.day()]},weekdaysParse:function(n){var i,r,u;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(r=t([2e3,1]).day(i),u="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[i]=new RegExp(u.replace(".",""),"i")),this._weekdaysParse[i].test(n))return i},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(n){var t=this._longDateFormat[n];return!t&&this._longDateFormat[n.toUpperCase()]&&(t=this._longDateFormat[n.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(n){return n.slice(1)}),this._longDateFormat[n]=t),t},isPM:function(n){return"p"===(n+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(n,t,i){return n>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(n,t,i){var r=this._calendar[n];return"function"==typeof r?r.apply(t,[i]):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(n,t,i,r){var u=this._relativeTime[i];return"function"==typeof u?u(n,t,i,r):u.replace(/%d/i,n)},pastFuture:function(n,t){var i=this._relativeTime[n>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(n){return this._ordinal.replace("%d",n)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(n){return n},postformat:function(n){return n},week:function(n){return b(n,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),t=function(t,i,r,u){var f;return"boolean"==typeof r&&(u=r,r=n),f={},f._isAMomentObject=!0,f._i=t,f._f=i,f._l=r,f._strict=u,f._isUTC=!1,f._pf=ot(),nr(f)},t.suppressDeprecationWarnings=!1,t.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))}),t.min=function(){var n=[].slice.call(arguments,0);return tr("isBefore",n)},t.max=function(){var n=[].slice.call(arguments,0);return tr("isAfter",n)},t.utc=function(t,i,r,u){var f;return"boolean"==typeof r&&(u=r,r=n),f={},f._isAMomentObject=!0,f._useUTC=!0,f._isUTC=!0,f._l=r,f._i=t,f._f=i,f._strict=u,f._pf=ot(),nr(f).utc()},t.unix=function(n){return t(1e3*n)},t.duration=function(n,r){var o,c,s,l,u=n,f=null;return t.isDuration(n)?u={ms:n._milliseconds,d:n._days,M:n._months}:"number"==typeof n?(u={},r?u[r]=n:u.milliseconds=n):(f=ef.exec(n))?(o="-"===f[1]?-1:1,u={y:0,d:i(f[h])*o,h:i(f[e])*o,m:i(f[d])*o,s:i(f[g])*o,ms:i(f[nt])*o}):(f=of.exec(n))?(o="-"===f[1]?-1:1,s=function(n){var t=n&&parseFloat(n.replace(",","."));return(isNaN(t)?0:t)*o},u={y:s(f[2]),M:s(f[3]),d:s(f[4]),h:s(f[5]),m:s(f[6]),s:s(f[7]),w:s(f[8])}):null==u?u={}:"object"==typeof u&&("from"in u||"to"in u)&&(l=iu(t(u.from),t(u.to)),u={},u.ms=l.milliseconds,u.M=l.months),c=new st(u),t.isDuration(n)&&p(n,"_locale")&&(c._locale=n._locale),c},t.version="2.9.0",t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.ISO_8601=function(){},t.momentProperties=ft,t.updateOffset=function(){},t.relativeTimeThreshold=function(t,i){return y[t]===n?!1:i===n?y[t]:(y[t]=i,!0)},t.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(n,i){return t.locale(n,i)}),t.locale=function(n,i){var r;return n&&(r="undefined"!=typeof i?t.defineLocale(n,i):t.localeData(n),r&&(t.duration._locale=t._locale=r)),t._locale._abbr},t.defineLocale=function(n,i){return null!==i?(i.abbr=n,tt[n]||(tt[n]=new fi),tt[n].set(i),t.locale(n),tt[n]):(delete tt[n],null)},t.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(n){return t.localeData(n)}),t.localeData=function(n){var i;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return t._locale;if(!ut(n)){if(i=ki(n))return i;n=[n]}return uu(n)},t.isMoment=function(n){return n instanceof rt||null!=n&&p(n,"_isAMomentObject")},t.isDuration=function(n){return n instanceof st},u=kr.length-1;u>=0;--u)ru(kr[u]);t.normalizeUnits=function(n){return f(n)};t.invalid=function(n){var i=t.utc(NaN);return null!=n?w(i._pf,n):i._pf.userInvalidated=!0,i};t.parseZone=function(){return t.apply(null,arguments).parseZone()};t.parseTwoDigitYear=function(n){return i(n)+(i(n)>68?1900:2e3)};t.isDate=ht;w(t.fn=rt.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d-6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var n=t(this).utc();return 0<n.year()&&n.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():at(n,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):at(n,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var n=this;return[n.year(),n.month(),n.date(),n.hours(),n.minutes(),n.seconds(),n.milliseconds()]},isValid:function(){return wi(this)},isDSTShifted:function(){return this._a?this.isValid()&&ci(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0:!1},parsingFlags:function(){return w({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(n){return this.utcOffset(0,n)},local:function(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(n){var i=at(this,n||t.defaultFormat);return this.localeData().postformat(i)},add:si(1,"add"),subtract:si(-1,"subtract"),diff:function(n,t,i){var r,u,e=lt(n,this),o=6e4*(e.utcOffset()-this.utcOffset());return t=f(t),"year"===t||"month"===t||"quarter"===t?(u=nu(this,e),"quarter"===t?u/=3:"year"===t&&(u/=12)):(r=this-e,u="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-o)/864e5:"week"===t?(r-o)/6048e5:r),i?u:s(u)},from:function(n,i){return t.duration({to:this,from:n}).locale(this.locale()).humanize(!i)},fromNow:function(n){return this.from(t(),n)},calendar:function(n){var r=n||t(),u=lt(r,this).startOf("day"),i=this.diff(u,"days",!0),f=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.localeData().calendar(f,this,t(r)))},isLeapYear:function(){return yi(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(n){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=n?(n=du(n,this.localeData()),this.add(n-t,"d")):t},month:c("Month",!0),startOf:function(n){switch(n=f(n)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===n?this.weekday(0):"isoWeek"===n&&this.isoWeekday(1),"quarter"===n&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=f(t),t===n||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(n,i){var r;return i=f("undefined"!=typeof i?i:"millisecond"),"millisecond"===i?(n=t.isMoment(n)?n:t(n),+this>+n):(r=t.isMoment(n)?+n:+t(n),r<+this.clone().startOf(i))},isBefore:function(n,i){var r;return i=f("undefined"!=typeof i?i:"millisecond"),"millisecond"===i?(n=t.isMoment(n)?n:t(n),+n>+this):(r=t.isMoment(n)?+n:+t(n),+this.clone().endOf(i)<r)},isBetween:function(n,t,i){return this.isAfter(n,i)&&this.isBefore(t,i)},isSame:function(n,i){var r;return i=f(i||"millisecond"),"millisecond"===i?(n=t.isMoment(n)?n:t(n),+this==+n):(r=+t(n),+this.clone().startOf(i)<=r&&r<=+this.clone().endOf(i))},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(n){return n=t.apply(null,arguments),this>n?this:n}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(n){return n=t.apply(null,arguments),n>this?this:n}),zone:o("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(n,t){return null!=n?("string"!=typeof n&&(n=-n),this.utcOffset(n,t),this):-this.utcOffset()}),utcOffset:function(n,i){var r,u=this._offset||0;return null!=n?("string"==typeof n&&(n=vt(n)),Math.abs(n)<16&&(n=60*n),!this._isUTC&&i&&(r=this._dateUtcOffset()),this._offset=n,this._isUTC=!0,null!=r&&this.add(r,"m"),u!==n&&(!i||this._changeInProgress?hi(this,t.duration(n-u,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?u:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&0===this._offset},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(vt(this._i)),this},hasAlignedHourOffset:function(n){return n=n?t(n).utcOffset():0,(this.utcOffset()-n)%60==0},daysInMonth:function(){return ct(this.year(),this.month())},dayOfYear:function(n){var i=k((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return null==n?i:this.add(n-i,"d")},quarter:function(n){return null==n?Math.ceil((this.month()+1)/3):this.month(3*(n-1)+this.month()%3)},weekYear:function(n){var t=b(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==n?t:this.add(n-t,"y")},isoWeekYear:function(n){var t=b(this,1,4).year;return null==n?t:this.add(n-t,"y")},week:function(n){var t=this.localeData().week(this);return null==n?t:this.add(7*(n-t),"d")},isoWeek:function(n){var t=b(this,1,4).week;return null==n?t:this.add(7*(n-t),"d")},weekday:function(n){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==n?t:this.add(n-t,"d")},isoWeekday:function(n){return null==n?this.day()||7:this.day(this.day()%7?n:n-7)},isoWeeksInYear:function(){return ai(this.year(),1,4)},weeksInYear:function(){var n=this.localeData()._week;return ai(this.year(),n.dow,n.doy)},get:function(n){return n=f(n),this[n]()},set:function(n,t){var i;if("object"==typeof n)for(i in n)this.set(i,n[i]);else n=f(n),"function"==typeof this[n]&&this[n](t);return this},locale:function(i){var r;return i===n?this._locale._abbr:(r=t.localeData(i),null!=r&&(this._locale=r),this)},lang:o("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===n?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return 15*-Math.round(this._d.getTimezoneOffset()/15)}});t.fn.millisecond=t.fn.milliseconds=c("Milliseconds",!1);t.fn.second=t.fn.seconds=c("Seconds",!1);t.fn.minute=t.fn.minutes=c("Minutes",!1);t.fn.hour=t.fn.hours=c("Hours",!0);t.fn.date=c("Date",!0);t.fn.dates=o("dates accessor is deprecated. Use date instead.",c("Date",!0));t.fn.year=c("FullYear",!0);t.fn.years=o("years accessor is deprecated. Use year instead.",c("FullYear",!0));t.fn.days=t.fn.day;t.fn.months=t.fn.month;t.fn.weeks=t.fn.week;t.fn.isoWeeks=t.fn.isoWeek;t.fn.quarters=t.fn.quarter;t.fn.toJSON=t.fn.toISOString;t.fn.isUTC=t.fn.isUtc;w(t.duration.fn=st.prototype,{_bubble:function(){var u,f,e,o=this._milliseconds,t=this._days,i=this._months,n=this._data,r=0;n.milliseconds=o%1e3;u=s(o/1e3);n.seconds=u%60;f=s(u/60);n.minutes=f%60;e=s(f/60);n.hours=e%24;t+=s(e/24);r=s(ur(t));t-=s(fr(r));i+=s(t/30);t%=30;r+=s(i/12);i%=12;n.days=t;n.months=i;n.years=r},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return s(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*i(this._months/12)},humanize:function(n){var t=nf(this,!n,this.localeData());return n&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(n,i){var r=t.duration(n,i);return this._milliseconds+=r._milliseconds,this._days+=r._days,this._months+=r._months,this._bubble(),this},subtract:function(n,i){var r=t.duration(n,i);return this._milliseconds-=r._milliseconds,this._days-=r._days,this._months-=r._months,this._bubble(),this},get:function(n){return n=f(n),this[n.toLowerCase()+"s"]()},as:function(n){var t,i;if(n=f(n),"month"===n||"year"===n)return t=this._days+this._milliseconds/864e5,i=this._months+12*ur(t),"month"===n?i:i/12;switch(t=this._days+Math.round(fr(this._months/12)),n){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 1440*t+this._milliseconds/6e4;case"second":return 86400*t+this._milliseconds/1e3;case"millisecond":return Math.floor(864e5*t)+this._milliseconds;default:throw new Error("Unknown unit "+n);}},lang:t.fn.lang,locale:t.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var r=Math.abs(this.years()),u=Math.abs(this.months()),f=Math.abs(this.days()),n=Math.abs(this.hours()),t=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(r?r+"Y":"")+(u?u+"M":"")+(f?f+"D":"")+(n||t||i?"T":"")+(n?n+"H":"")+(t?t+"M":"")+(i?i+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}});t.duration.fn.toString=t.duration.fn.toISOString;for(u in yr)p(yr,u)&&rf(u.toLowerCase());t.duration.fn.asMilliseconds=function(){return this.as("ms")};t.duration.fn.asSeconds=function(){return this.as("s")};t.duration.fn.asMinutes=function(){return this.as("m")};t.duration.fn.asHours=function(){return this.as("h")};t.duration.fn.asDays=function(){return this.as("d")};t.duration.fn.asWeeks=function(){return this.as("weeks")};t.duration.fn.asMonths=function(){return this.as("M")};t.duration.fn.asYears=function(){return this.as("y")};t.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var t=n%10,r=1===i(n%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return n+r}});sr?module.exports=t:"function"==typeof define&&define.amd?(define(function(n,i,r){return r.config&&r.config()&&r.config().noGlobal===!0&&(kt.moment=or),t}),er(!0)):er()}).call(this);
/*! JSON Editor v0.6.14 - JSON Schema -> HTML Editor
 * By Jeremy Dorn - https://github.com/jdorn/json-editor/
 * Released under the MIT license
 *
 * Date: 2014-06-11
 */
(function(){var u;(function(){var n=!1,t=/xyz/.test(function(){postMessage("xyz")})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(i){function u(){!n&&this.init&&this.init.apply(this,arguments)}var e=this.prototype,f,r;n=!0;f=new this;n=!1;for(r in i)f[r]=typeof i[r]=="function"&&typeof e[r]=="function"&&t.test(i[r])?function(n,t){return function(){var r=this._super,i;return this._super=e[n],i=t.apply(this,arguments),this._super=r,i}}(r,i[r]):i[r];return u.prototype=f,u.prototype.constructor=u,u.extend=arguments.callee,u}})(),function(){function n(n,t){t=t||{bubbles:!1,cancelable:!1,detail:undefined};var i=document.createEvent("CustomEvent");return i.initCustomEvent(n,t.bubbles,t.cancelable,t.detail),i}n.prototype=window.Event.prototype;window.CustomEvent=n}(),function(){for(var i=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();var f=function(n){if(n.constructor&&!n.hasOwnProperty("constructor")&&!n.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1;for(var t in n);return t===undefined||n.hasOwnProperty(t)},i=function(n){for(var r,t,u=1;u<arguments.length;u++){r=arguments[u];for(t in r)r[t]&&f(r[t])?(n[t]=n[t]||{},i(n[t],r[t])):n[t]=r[t]}return n},t=function(n,t){if(n){var i;if(typeof n.length!="undefined"){for(i=0;i<n.length;i++)if(t(i,n[i])===!1)return}else for(i in n)if(n.hasOwnProperty(i)&&t(i,n[i])===!1)return}},r=function(n,t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0);n.dispatchEvent(i)},e=function(n,t){var i=new CustomEvent(t,{bubbles:!0,cancelable:!0});n.dispatchEvent(i)},n=function(t,r){r=i({},n.defaults.options,r||{});this.element=t;this.options=r;this.init()};n.prototype={init:function(){var t=this,i,r;if(this.ready=!1,i=n.defaults.themes[this.options.theme||n.defaults.theme],!i)throw"Unknown theme "+(this.options.theme||n.defaults.theme);this.schema=this.options.schema;this.theme=new i;this.template=this.options.template;this.uuid=0;this.__data={};r=n.defaults.iconlibs[this.options.iconlib||n.defaults.iconlib];r&&(this.iconlib=new r);this.root_container=this.theme.getContainer();this.element.appendChild(this.root_container);this.validator=new n.Validator(this.schema,{ajax:this.options.ajax,refs:this.options.refs,no_additional_properties:this.options.no_additional_properties,required_by_default:this.options.required_by_default});this.validator.ready(function(n){if(!t.ready){t.schema=n;var i=t.getEditorClass(t.schema);t.root=t.createEditor(i,{jsoneditor:t,schema:t.schema,container:t.root_container,required:!0});t.options.startval&&t.root.setValue(t.options.startval);t.validation_results=t.validator.validate(t.root.getValue());t.root.showValidationErrors(t.validation_results);t.ready=!0;requestAnimationFrame(function(){t.validation_results=t.validator.validate(t.root.getValue());t.root.showValidationErrors(t.validation_results);t.trigger("ready");t.trigger("change")})}})},getValue:function(){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before getting the value";return this.root.getValue()},setValue:function(n){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before setting the value";return this.root.setValue(n),this},validate:function(n){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before validating";return arguments.length===1?this.validator.validate(n):this.validation_results},destroy:function(){this.destroyed||this.ready&&(this.schema=null,this.options=null,this.root.destroy(),this.root=null,this.root_container=null,this.validator=null,this.validation_results=null,this.theme=null,this.iconlib=null,this.template=null,this.__data=null,this.ready=!1,this.element.innerHTML="",this.destroyed=!0)},on:function(n,t){this.callbacks=this.callbacks||{};this.callbacks[n]=this.callbacks[n]||[];this.callbacks[n].push(t)},off:function(n,t){var r,i;if(n&&t){for(this.callbacks=this.callbacks||{},this.callbacks[n]=this.callbacks[n]||[],r=[],i=0;i<this.callbacks[n].length;i++)this.callbacks[n][i]!==t&&r.push(this.callbacks[n][i]);this.callbacks[n]=r}else n?(this.callbacks=this.callbacks||{},this.callbacks[n]=[]):this.callbacks={}},trigger:function(n){if(this.callbacks&&this.callbacks[n]&&this.callbacks[n].length)for(var t=0;t<this.callbacks[n].length;t++)this.callbacks[n][t]()},getEditorClass:function(i){var r;if(t(n.defaults.resolvers,function(t,u){var f=u(i);if(f&&n.defaults.editors[f])return r=f,!1}),!r)throw"Unknown editor for schema "+JSON.stringify(i);if(!n.defaults.editors[r])throw"Unknown editor "+r;return n.defaults.editors[r]},createEditor:function(n,t){return t=i({},n.options||{},t),new n(t)},onChange:function(){if(this.ready&&!this.firing_change){this.firing_change=!0;var n=this;requestAnimationFrame(function(){n.firing_change=!1;n.validation_results=n.validator.validate(n.root.getValue());n.root.showValidationErrors(n.validation_results);n.trigger("change")})}},compileTemplate:function(t,i){i=i||n.defaults.template;var r;if(typeof i=="string"){if(!n.defaults.templates[i])throw"Unknown template engine "+i;if(r=n.defaults.templates[i](),!r)throw"Template engine "+i+" missing required library.";}else r=i;if(!r)throw"No template engine set";if(!r.compile)throw"Invalid template engine set";return r.compile(t)},_data:function(n,t,i){if(arguments.length===3){var r;n.hasAttribute("data-jsoneditor-"+t)?r=n.getAttribute("data-jsoneditor-"+t):(r=this.uuid++,n.setAttribute("data-jsoneditor-"+t,r));this.__data[r]=i}else return n.hasAttribute("data-jsoneditor-"+t)?this.__data[n.getAttribute("data-jsoneditor-"+t)]:null},registerEditor:function(n){return this.editors=this.editors||{},this.editors[n.path]=n,this},unregisterEditor:function(n){return this.editors=this.editors||{},this.editors[n.path]=null,this},getEditor:function(n){if(this.editors)return this.editors[n]},watch:function(n,t){return this.watchlist=this.watchlist||{},this.watchlist[n]=this.watchlist[n]||[],this.watchlist[n].push(t),this},unwatch:function(n,t){var r,i;if(!this.watchlist||!this.watchlist[n])return this;if(!t)return this.watchlist[n]=null,this;for(r=[],i=0;i<this.watchlist[n].length;i++)if(this.watchlist[n][i]===t)continue;else r.push(this.watchlist[n][i]);return this.watchlist[n]=r.length?r:null,this},notifyWatchers:function(n){if(!this.watchlist||!this.watchlist[n])return this;for(var t=0;t<this.watchlist[n].length;t++)this.watchlist[n][t]()},isEnabled:function(){return!this.root||this.root.isEnabled()},enable:function(){this.root.enable()},disable:function(){this.root.disable()}};n.defaults={themes:{},templates:{},iconlibs:{},editors:{},resolvers:[],custom_validators:[]};n.Validator=Class.extend({init:function(n,t){this.original_schema=n;this.options=t||{};this.refs=this.options.refs||{};this.ready_callbacks=[];this.options.ready&&this.ready(this.options.ready);this.getRefs()},ready:function(n){return this.is_ready?n.apply(this,[this.expanded]):this.ready_callbacks.push(n),this},getRefs:function(){var n=this;this._getRefs(this.original_schema,function(i){n.schema=i;n.expanded=n.expandSchema(n.schema);n.is_ready=!0;t(n.ready_callbacks,function(t,i){i.apply(n,[n.expanded])})})},_getRefs:function(n,r){var u=this,a=n===this.original_schema,e,o,s,c,l,f,h;if(n=i({},n),a&&n.definitions)l=n.definitions,delete n.definitions,e=o=0,s=function(n){if(o>=e){if(c)return;c=!0;u._getRefs(n,r)}},t(l,function(){e++}),e?t(l,function(t,i){u._getRefs(i,function(i){u.refs["#/definitions/"+t]=i;o++;s(n)})}):s(n);else if(n.$ref)if(f=n.$ref,delete n.$ref,u.refs[f]&&u.refs[f]instanceof Array)u.refs[f].push(function(){n=i({},u.refs[f],n);r(n)});else if(u.refs[f])n=i({},u.refs[f],n),r(n);else{if(!u.options.ajax)throw"Must set ajax option to true to load external url "+f;h=new XMLHttpRequest;h.open("GET",f,!0);h.onreadystatechange=function(){if(h.readyState==4){if(h.status===200){var e=JSON.parse(h.responseText);u.refs[f]=[];u._getRefs(e,function(e){var o=u.refs[f];u.refs[f]=e;n=i({},u.refs[f],n);r(n);t(o,function(n,t){t()})});return}throw"Failed to fetch ref via ajax- "+f;}};h.send()}else e=o=0,s=function(n){if(o>=e){if(c)return;c=!0;r(n)}},t(n,function(n,i){typeof i=="object"&&i&&i instanceof Array?t(i,function(n,t){typeof t!="object"||!t||t instanceof Array||e++}):typeof i=="object"&&i&&e++}),e?t(n,function(i,r){typeof r=="object"&&r&&r instanceof Array?t(r,function(t,r){typeof r!="object"||!r||r instanceof Array||u._getRefs(r,function(r){n[i][t]=r;o++;s(n)})}):typeof r=="object"&&r&&u._getRefs(r,function(t){n[i]=t;o++;s(n)})}):s(n)},validate:function(n){return this._validateSchema(this.schema,n)},_validateSchema:function(r,u,f){var o=[],s,e,h,p=JSON.stringify(u),l,c,v,a,y;if(f=f||"root",r=i({},r),r.required&&r.required===!0){if(typeof u=="undefined")return o.push({path:f,property:"required",message:"Property must be set"}),o}else if(typeof u=="undefined")if(this.options.required_by_default)o.push({path:f,property:"required",message:"Property must be set"});else return o;if(r.enum){for(s=!1,e=0;e<r.enum.length;e++)p===JSON.stringify(r.enum[e])&&(s=!0);s||o.push({path:f,property:"enum",message:"Value must be one of the enumerated values"})}if(r.extends)for(e=0;e<r.extends.length;e++)o=o.concat(this._validateSchema(r.extends[e],u,f));if(r.allOf)for(e=0;e<r.allOf.length;e++)o=o.concat(this._validateSchema(r.allOf[e],u,f));if(r.anyOf){for(s=!1,e=0;e<r.anyOf.length;e++)if(!this._validateSchema(r.anyOf[e],u,f).length){s=!0;break}s||o.push({path:f,property:"anyOf",message:"Value must validate against at least one of the provided schemas"})}if(r.oneOf){for(s=0,l=[],e=0;e<r.oneOf.length;e++){for(c=this._validateSchema(r.oneOf[e],u,f),c.length||s++,h=0;h<c.length;h++)c[h].path=f+".oneOf["+e+"]"+c[h].path.substr(f.length);l=l.concat(c)}s!==1&&(o.push({path:f,property:"oneOf",message:"Value must validate against exactly one of the provided schemas. It currently validates against "+s+" of the schemas."}),o=o.concat(l))}if(r.not&&(this._validateSchema(r.not,u,f).length||o.push({path:f,property:"not",message:"Value must not validate against the provided schema"})),r.type)if(r.type instanceof Array){for(s=!1,e=0;e<r.type.length;e++)if(this._checkType(r.type[e],u)){s=!0;break}s||o.push({path:f,property:"type",message:"Value must be one of the provided types"})}else this._checkType(r.type,u)||o.push({path:f,property:"type",message:"Value must be of type "+r.type});if(r.disallow)if(r.disallow instanceof Array){for(s=!0,e=0;e<r.disallow.length;e++)if(this._checkType(r.disallow[e],u)){s=!1;break}s||o.push({path:f,property:"disallow",message:"Value must not be one of the provided disallowed types"})}else this._checkType(r.disallow,u)&&o.push({path:f,property:"disallow",message:"Value must not be of type "+r.disallow});if(typeof u=="number")(r.multipleOf||r.divisibleBy)&&(s=u/(r.multipleOf||r.divisibleBy),s!==Math.floor(s)&&o.push({path:f,property:r.multipleOf?"multipleOf":"divisibleBy",message:"Value must be a multiple of "+(r.multipleOf||r.divisibleBy)})),r.maximum&&(r.exclusiveMaximum&&u>=r.maximum?o.push({path:f,property:"maximum",message:"Value must be less than "+r.maximum}):!r.exclusiveMaximum&&u>r.maximum&&o.push({path:f,property:"maximum",message:"Value must be at most "+r.maximum})),r.minimum&&(r.exclusiveMinimum&&u<=r.minimum?o.push({path:f,property:"minimum",message:"Value must be greater than "+r.minimum}):!r.exclusiveMinimum&&u<r.minimum&&o.push({path:f,property:"minimum",message:"Value must be at least "+r.minimum}));else if(typeof u=="string")r.maxLength&&(u+"").length>r.maxLength&&o.push({path:f,property:"maxLength",message:"Value must be at most "+r.maxLength+" characters long"}),r.minLength&&(u+"").length<r.minLength&&o.push({path:f,property:"minLength",message:"Value must be at least "+r.minLength+" characters long"}),r.pattern&&(new RegExp(r.pattern).test(u)||o.push({path:f,property:"pattern",message:"Value must match the provided pattern"}));else if(typeof u=="object"&&u!==null&&u instanceof Array){if(r.items)if(r.items instanceof Array)for(e=0;e<u.length;e++)if(r.items[e])o=o.concat(this._validateSchema(r.items[e],u[e],f+"."+e));else if(r.additionalItems===!0)break;else if(r.additionalItems)o=o.concat(this._validateSchema(r.additionalItems,u[e],f+"."+e));else if(r.additionalItems===!1){o.push({path:f,property:"additionalItems",message:"No additional items allowed in this array"});break}else break;else for(e=0;e<u.length;e++)o=o.concat(this._validateSchema(r.items,u[e],f+"."+e));if(r.maxItems&&u.length>r.maxItems&&o.push({path:f,property:"maxItems",message:"Value must have at most "+r.maxItems+" items"}),r.minItems&&u.length<r.minItems&&o.push({path:f,property:"minItems",message:"Value must have at least "+r.minItems+" items"}),r.uniqueItems)for(v={},e=0;e<u.length;e++){if(s=JSON.stringify(u[e]),v[s]){o.push({path:f,property:"uniqueItems",message:"Array must have unique items"});break}v[s]=!0}}else if(typeof u=="object"&&u!==null){if(r.maxProperties){s=0;for(e in u)u.hasOwnProperty(e)&&s++;s>r.maxProperties&&o.push({path:f,property:"maxProperties",message:"Object must have at most "+r.maxProperties+" properties"})}if(r.minProperties){s=0;for(e in u)u.hasOwnProperty(e)&&s++;s<r.minProperties&&o.push({path:f,property:"minProperties",message:"Object must have at least "+r.minProperties+" properties"})}if(r.required&&r.required instanceof Array)for(e=0;e<r.required.length;e++)typeof u[r.required[e]]=="undefined"&&o.push({path:f,property:"required",message:"Object is missing the required property "+r.required[e]});if(a={},r.properties)for(e in r.properties)r.properties.hasOwnProperty(e)&&(a[e]=!0,o=o.concat(this._validateSchema(r.properties[e],u[e],f+"."+e)));if(r.patternProperties)for(e in r.patternProperties)if(r.patternProperties.hasOwnProperty(e)){y=new RegExp(e);for(h in u)u.hasOwnProperty(h)&&y.test(h)&&(a[h]=!0,o=o.concat(this._validateSchema(r.patternProperties[e],u[h],f+"."+h)))}if(typeof r.additionalProperties!="undefined"||!this.options.no_additional_properties||r.oneOf||r.anyOf||(r.additionalProperties=!1),typeof r.additionalProperties!="undefined")for(e in u)if(u.hasOwnProperty(e)&&!a[e])if(r.additionalProperties)if(r.additionalProperties===!0)break;else o=o.concat(this._validateSchema(r.additionalProperties,u[e],f+"."+e));else{o.push({path:f,property:"additionalProperties",message:"No additional properties allowed, but property "+e+" is set"});break}if(r.dependencies)for(e in r.dependencies)if(r.dependencies.hasOwnProperty(e)&&typeof u[e]!="undefined")if(r.dependencies[e]instanceof Array)for(h=0;h<r.dependencies[e].length;h++)typeof u[r.dependencies[e][h]]=="undefined"&&o.push({path:f,property:"dependencies",message:"Must have property "+r.dependencies[e][h]});else o=o.concat(this._validateSchema(r.dependencies[e],u,f))}return t(n.defaults.custom_validators,function(n,t){o=o.concat(t(r,u,f))}),o},_checkType:function(n,t){return typeof n=="string"?n==="string"?typeof t=="string":n==="number"?typeof t=="number":n==="integer"?typeof t=="number"&&t===Math.floor(t):n==="boolean"?typeof t=="boolean":n==="array"?t instanceof Array:n==="object"?t!==null&&!(t instanceof Array)&&typeof t=="object":n==="null"?t===null:!0:!this._validateSchema(n,t).length},expandSchema:function(n){var u=this,f=n,r,e;if(typeof n.type=="object"&&(n.type instanceof Array?t(n.type,function(t,i){typeof i=="object"&&(n.type[t]=u.expandSchema(i))}):n.type=u.expandSchema(n.type)),typeof n.disallow=="object"&&(n.disallow instanceof Array?t(n.disallow,function(t,i){typeof i=="object"&&(n.disallow[t]=u.expandSchema(i))}):n.disallow=u.expandSchema(n.disallow)),n.anyOf&&t(n.anyOf,function(t,i){n.anyOf[t]=u.expandSchema(i)}),n.dependencies&&t(n.dependencies,function(t,i){typeof i!="object"||i instanceof Array||(n.dependencies[t]=u.expandSchema(i))}),n.items&&(n.items instanceof Array?t(n.items,function(t,i){typeof i=="object"&&(n.items[t]=u.expandSchema(i))}):n.items=u.expandSchema(n.items)),n.properties&&t(n.properties,function(t,i){typeof i!="object"||i instanceof Array||(n.properties[t]=u.expandSchema(i))}),n.patternProperties&&t(n.patternProperties,function(t,i){typeof i!="object"||i instanceof Array||(n.patternProperties[t]=u.expandSchema(i))}),n.not&&(n.not=this.expandSchema(n.not)),n.additionalProperties&&typeof n.additionalProperties=="object"&&(n.additionalProperties=u.expandSchema(n.additionalProperties)),n.additionalItems&&typeof n.additionalItems=="object"&&(n.additionalItems=u.expandSchema(n.additionalItems)),n.allOf){for(r=0;r<n.allOf.length;r++)f=this.extend(f,this.expandSchema(n.allOf[r]));delete f.allOf}if(n.extends){if(n.extends instanceof Array)for(r=0;r<n.extends.length;r++)f=this.extend(f,this.expandSchema(n.extends[r]));else f=this.extend(f,this.expandSchema(n.extends));delete f.extends}if(n.oneOf)for(e=i({},f),delete e.oneOf,r=0;r<n.oneOf.length;r++)f.oneOf[r]=this.extend(this.expandSchema(n.oneOf[r]),e);return f},extend:function(n,r){n=i({},n);r=i({},r);var f=this,u={};return t(n,function(n,t){typeof r[n]!="undefined"?n==="required"&&typeof t=="object"&&t instanceof Array?u.required=t.concat(r[n]).reduce(function(n,t){return n.indexOf(t)<0&&n.push(t),n},[]):n==="type"?(typeof t!="object"&&(t=[t]),typeof r.type!="object"&&(r.type=[r.type]),u.type=t.filter(function(n){return r.type.indexOf(n)!==-1}),u.type.length===1&&typeof u.type[0]=="string"&&(u.type=u.type[0])):u[n]=typeof t=="object"&&t instanceof Array?t.filter(function(t){return r[n].indexOf(t)!==-1}):typeof t=="object"&&t!==null?f.extend(t,r[n]):t:u[n]=t}),t(r,function(t,i){typeof n[t]=="undefined"&&(u[t]=i)}),u}});n.AbstractEditor=Class.extend({fireChangeHeaderEvent:function(){e(this.container,"change_header_text")},onChildEditorChange:function(){if(this.watch_listener)if(this.watch_listener(),this.jsoneditor.notifyWatchers(this.path),this.parent)this.parent.onChildEditorChange(this);else this.jsoneditor.onChange()},register:function(){this.jsoneditor.registerEditor(this)},unregister:function(){this.jsoneditor&&this.jsoneditor.unregisterEditor(this)},getNumColumns:function(){return 12},init:function(n){var t=this,u,r,f,s,h,e,o;if(this.container=n.container,this.jsoneditor=n.jsoneditor,this.theme=this.jsoneditor.theme,this.template_engine=this.jsoneditor.template,this.iconlib=this.jsoneditor.iconlib,this.options=i({},this.options||{},n.schema.options||{},n),this.schema=this.options.schema,n.path||this.schema.id||(this.schema.id="root"),this.path=n.path||"root",this.formname=n.formname||this.path.replace(/\.([^.]+)/g,"[$1]"),this.jsoneditor.options.form_name_root&&(this.formname=this.formname.replace(/^root\[/,this.jsoneditor.options.form_name_root+"[")),this.schema.id&&this.container.setAttribute("data-schemaid",this.schema.id),this.schema.type&&typeof this.schema.type=="string"&&this.container.setAttribute("data-schematype",this.schema.type),this.container.setAttribute("data-schemapath",this.path),this.jsoneditor._data(this.container,"editor",this),this.key=this.path.split(".").pop(),this.parent=n.parent,this.link_watchers=[],this.register(),this.isRequired()||this.options.compact||!0||(this.title_links=this.theme.getFloatRightLinkHolder(),this.container.appendChild(this.title_links),this.addremove=this.theme.getLink("remove "+this.getTitle()),this.title_links.appendChild(this.addremove),this.addremove.addEventListener("click",function(n){if(n.preventDefault(),n.stopPropagation(),!t.disabled)if(t.property_removed?t.addProperty():t.removeProperty(),t.parent)t.parent.onChildEditorChange(t);else t.jsoneditor.onChange()})),this.watched={},this.schema.vars&&(this.schema.watch=this.schema.vars),this.watched_values={},this.watch_listener=function(){t.refreshWatchedFieldValues()&&t.onWatchedFieldChange()},this.schema.watch)for(e in this.schema.watch)if(this.schema.watch.hasOwnProperty(e)){if(u=this.schema.watch[e],u instanceof Array?r=[u[0]].concat(u[1].split(".")):(r=u.split("."),t.theme.closest(t.container,'[data-schemaid="'+r[0]+'"]')||r.unshift("#")),f=r.shift(),f==="#"&&(f=t.jsoneditor.schema.id||"root"),s=t.theme.closest(t.container,'[data-schemaid="'+f+'"]'),!s)throw"Could not find ancestor node with id "+f;h=s.getAttribute("data-schemapath")+"."+r.join(".");t.jsoneditor.watch(h,t.watch_listener);t.watched[e]=h}if(this.schema.headerTemplate&&(this.header_template=this.jsoneditor.compileTemplate(this.schema.headerTemplate,this.template_engine)),this.build(),!this.no_link_holder&&(this.link_holder=this.theme.getLinksHolder(),this.container.appendChild(this.link_holder),this.schema.links))for(o=0;o<this.schema.links.length;o++)this.addLink(this.getLink(this.schema.links[o]));this.setValue(this.getDefault(),!0);this.updateHeaderText();this.watch_listener()},getButton:function(n,t,i){var u="json-editor-btn-"+t,r;return t=this.iconlib?this.iconlib.getIcon(t):null,!t&&i&&(n=i,i=null),r=this.theme.getButton(n,t,i),r.className+=" "+u+" ",r},setButtonText:function(n,t,i,r){return i=this.iconlib?this.iconlib.getIcon(i):null,!i&&r&&(t=r,r=null),this.theme.setButtonText(n,t,i,r)},addLink:function(n){this.link_holder&&this.link_holder.appendChild(n)},getLink:function(n){var t,i,o=n.mediaType||"application/javascript",u=o.split("/")[0],f=this.jsoneditor.compileTemplate(n.href,this.template_engine),e,r;return u==="image"?(t=this.theme.getBlockLinkHolder(),i=document.createElement("a"),i.setAttribute("target","_blank"),e=document.createElement("img"),this.theme.createImageLink(t,i,e),this.link_watchers.push(function(t){var r=f(t);i.setAttribute("href",r);i.setAttribute("title",n.rel||r);e.setAttribute("src",r)})):["audio","video"].indexOf(u)>=0?(t=this.theme.getBlockLinkHolder(),i=this.theme.getBlockLink(),i.setAttribute("target","_blank"),r=document.createElement(u),r.setAttribute("controls","controls"),this.theme.createMediaLink(t,i,r),this.link_watchers.push(function(t){var u=f(t);i.setAttribute("href",u);i.textContent=n.rel||u;r.setAttribute("src",u)})):(t=this.theme.getBlockLink(),t.setAttribute("target","_blank"),t.textContent=n.rel,this.link_watchers.push(function(i){var r=f(i);t.setAttribute("href",r);t.textContent=n.rel||r})),t},refreshWatchedFieldValues:function(){var r,u,n;if(this.watched_values){var t={},i=!1,f=this;if(this.watched)for(n in this.watched)this.watched.hasOwnProperty(n)&&(u=f.jsoneditor.getEditor(this.watched[n]),r=u?u.getValue():null,f.watched_values[n]!==r&&(i=!0),t[n]=r);return t.self=this.getValue(),this.watched_values.self!==t.self&&(i=!0),this.watched_values=t,i}},getWatchedFieldValues:function(){return this.watched_values},updateHeaderText:function(){this.header&&(this.header.textContent=this.getHeaderText())},getHeaderText:function(n){return this.header_text?this.header_text:n?this.schema.title:this.getTitle()},onWatchedFieldChange:function(){var n,r,t;if(this.header_template&&(n=i(this.getWatchedFieldValues(),{key:this.key,i:this.key,title:this.getTitle()}),r=this.header_template(n),r!==this.header_text&&(this.header_text=r,this.updateHeaderText(),this.fireChangeHeaderEvent())),this.link_watchers.length)for(n=this.getWatchedFieldValues(),t=0;t<this.link_watchers.length;t++)this.link_watchers[t](n)},build:function(){},isValid:function(n){n()},setValue:function(n){this.value=n},getValue:function(){return this.value},refreshValue:function(){},getChildEditors:function(){return!1},destroy:function(){var n=this;this.unregister(this);t(this.watched,function(t,i){n.jsoneditor.unwatch(i,n.watch_listener)});this.watched=null;this.watched_values=null;this.watch_listener=null;this.header_text=null;this.header_template=null;this.value=null;this.container.parentNode&&this.container.parentNode.removeChild(this.container);this.container=null;this.jsoneditor=null;this.schema=null;this.path=null;this.key=null;this.parent=null},isRequired:function(){return typeof this.options.required!="undefined"?this.options.required:typeof this.schema.required=="boolean"?this.schema.required:this.jsoneditor.options.required_by_default?!0:!1},getDefault:function(){return this.schema.default||null},getTheme:function(){return this.theme},getSchema:function(){return this.schema},getContainer:function(){return this.container},getTitle:function(){return this.schema.title||this.key},getPath:function(){return this.path},getParent:function(){return this.parent},enable:function(){this.addremove&&(this.addremove.style.opacity="");this.disabled=!1},disable:function(){this.addremove&&(this.addremove.style.opacity=".6");this.disabled=!0},isEnabled:function(){return!this.disabled},getOption:function(n,t){return typeof this.options[n]!="undefined"?this.options[n]:t},getDisplayText:function(n){var u=[],i={},r;return t(n,function(n,t){t.title&&(i[t.title]=i[t.title]||0,i[t.title]++);t.description&&(i[t.description]=i[t.description]||0,i[t.description]++);t.format&&(i[t.format]=i[t.format]||0,i[t.format]++);t.type&&(i[t.type]=i[t.type]||0,i[t.type]++)}),t(n,function(n,t){var r;r=typeof t=="string"?t:t.title&&i[t.title]<=1?t.title:t.format&&i[t.format]<=1?t.format:t.type&&i[t.type]<=1?t.type:t.description&&i[t.description]<=1?t.descripton:t.title?t.title:t.format?t.format:t.type?t.type:t.description?t.description:JSON.stringify(t).length<50?JSON.stringify(t):"type";u.push(r)}),r={},t(u,function(n,t){r[t]=r[t]||0;r[t]++;i[t]>1&&(u[n]=t+" "+r[t])}),u},showValidationErrors:function(){}});n.defaults.editors.null=n.AbstractEditor.extend({getValue:function(){return null},setValue:function(){this.jsoneditor.notifyWatchers(this.path)},getNumColumns:function(){return 2}});n.defaults.editors.string=n.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},register:function(){(this._super(),this.input)&&this.input.setAttribute("name",this.formname)},unregister:function(){(this._super(),this.input)&&this.input.removeAttribute("name")},setValue:function(n,t,i){var u=this,r,f;if((!this.template||i)&&(n=n||"",typeof n=="object"&&(n=JSON.stringify(n)),typeof n!="string"&&(n=""+n),n!==this.serialized)&&(r=this.sanitize(n),this.select_options&&this.select_options.indexOf(r)<0&&(r=this.select_options[0]),this.input.value!==r)){if(this.input.value=r,this.sceditor_instance?this.sceditor_instance.val(r):this.epiceditor?this.epiceditor.importFile(null,r):this.ace_editor&&this.ace_editor.setValue(r),f=i||this.getValue()!==n,this.refreshValue(),f)if(u.parent)u.parent.onChildEditorChange(u);else u.jsoneditor.onChange();this.watch_listener();this.jsoneditor.notifyWatchers(this.path)}},removeProperty:function(){this._super();this.input.style.display="none";this.description&&(this.description.style.display="none");this.theme.disableLabel(this.label)},addProperty:function(){this._super();this.input.style.display="";this.description&&(this.description.style.display="");this.theme.enableLabel(this.label)},getNumColumns:function(){var t=Math.ceil(this.getTitle().length/5),n;return n=this.input_type==="textarea"?6:["text","email"].indexOf(this.input_type)>=0?4:2,Math.min(12,Math.max(t,n))},build:function(){var t=this,n;if(this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.format=this.schema.format,!this.format&&this.schema.media&&this.schema.media.type&&(this.format=this.schema.media.type.replace(/(^(application|text)\/(x-)?(script\.)?)|(-source$)/g,"")),this.schema.enum)this.input_type="select",this.select_options=this.schema.enum,this.input=this.theme.getSelectInput(this.select_options);else if(this.schema.enumSource){if(this.input_type="select",this.input=this.theme.getSelectInput([]),this.enumSource=[],this.schema.enumSource instanceof Array)for(n=0;n<this.schema.enumSource.length;n++)this.enumSource[n]=typeof this.schema.enumSource[n]=="string"?{source:this.schema.enumSource[n]}:this.schema.enumSource[n]instanceof Array?this.schema.enumSource[n]:i({},this.schema.enumSource[n]);else this.enumSource=this.schema.enumValue?[{source:this.schema.enumSource,value:this.schema.enumValue}]:[{source:this.schema.enumSource}];for(n=0;n<this.enumSource.length;n++)this.enumSource[n]&&(this.enumSource[n].value=this.jsoneditor.compileTemplate(this.enumSource[n].value,this.template_engine)),this.enumSource[n].title&&(this.enumSource[n].title=this.jsoneditor.compileTemplate(this.enumSource[n].title,this.template_engine)),this.enumSource[n].fillter&&(this.enumSource[n].filter=this.jsoneditor.compileTemplate(this.enumSource[n].filter,this.template_engine))}else if(this.format)if(this.format==="textarea")this.input_type="textarea",this.input=this.theme.getTextareaInput();else if(this.format==="range"){this.input_type="range";var r=this.schema.minimum||0,u=this.schema.maximum||Math.max(100,r+1),f=1;this.schema.multipleOf&&(r%this.schema.multipleOf&&(r=Math.ceil(r/this.schema.multipleOf)*this.schema.multipleOf),u%this.schema.multipleOf&&(u=Math.floor(u/this.schema.multipleOf)*this.schema.multipleOf),f=this.schema.multipleOf);this.input=this.theme.getRangeInput(r,u,f)}else["actionscript","batchfile","bbcode","c","c++","cpp","coffee","csharp","css","dart","django","ejs","erlang","golang","handlebars","haskell","haxe","html","ini","jade","java","javascript","json","less","lisp","lua","makefile","markdown","matlab","mysql","objectivec","pascal","perl","pgsql","php","python","r","ruby","sass","scala","scss","smarty","sql","stylus","svg","twig","vbscript","xml","yaml"].indexOf(this.format)>=0?(this.input_type=this.format,this.source_code=!0,this.input=this.theme.getTextareaInput()):(this.input_type=this.format,this.input=this.theme.getFormInputField(this.input_type));else this.input_type="text",this.input=this.theme.getFormInputField(this.input_type);typeof this.schema.maxLength!="undefined"&&this.input.setAttribute("maxlength",this.schema.maxLength);typeof this.schema.pattern!="undefined"?this.input.setAttribute("pattern",this.schema.pattern):typeof this.schema.minLength!="undefined"&&this.input.setAttribute("pattern",".{"+this.schema.minLength+",}");this.getOption("compact")&&this.container.setAttribute("class",this.container.getAttribute("class")+" compact");(this.schema.readOnly||this.schema.readonly||this.schema.template)&&(this.always_disabled=!0,this.input.disabled=!0);this.input.addEventListener("change",function(n){if(n.preventDefault(),n.stopPropagation(),t.schema.template){this.value=t.value;return}var i=this.value,r=t.sanitize(i);if(i!==r&&(this.value=r),t.refreshValue(),t.watch_listener(),t.jsoneditor.notifyWatchers(t.path),t.parent)t.parent.onChildEditorChange(t);else t.jsoneditor.onChange()});this.format&&this.input.setAttribute("data-schemaformat",this.format);this.control=this.getTheme().getFormControl(this.label,this.input,this.description);this.container.appendChild(this.control);this.input_type==="select"&&window.$&&$.fn&&$.fn.select2&&$(this.input).select2();requestAnimationFrame(function(){t.afterInputReady()});this.register();this.schema.template?(this.template=this.jsoneditor.compileTemplate(this.schema.template,this.template_engine),this.refreshValue(),this.jsoneditor.notifyWatchers(this.path)):(this.refreshValue(),this.jsoneditor.notifyWatchers(this.path))},enable:function(){this.always_disabled||(this.input.disabled=!1);this._super()},disable:function(){this.input.disabled=!0;this._super()},afterInputReady:function(){var t=this,u,r;if(this.source_code)if(this.options.wysiwyg&&["html","bbcode"].indexOf(this.input_type)>=0&&window.$&&$.fn&&$.fn.sceditor)u=i({},{plugins:t.input_type==="html"?"xhtml":"bbcode",emoticonsEnabled:!1,width:"100%",height:300},n.plugins.sceditor),$(t.input).sceditor(u),t.sceditor_instance=$(t.input).sceditor("instance"),t.sceditor_instance.blur(function(){var n=$("<div>"+t.sceditor_instance.val()+"<\/div>");if($("#sceditor-start-marker,#sceditor-end-marker,.sceditor-nlf",n).remove(),t.input.value=n.html(),t.value=t.input.value,t.parent)t.parent.onChildEditorChange(t);else t.jsoneditor.onChange();t.jsoneditor.notifyWatchers(t.path)});else if(this.input_type==="markdown"&&window.EpicEditor){this.epiceditor_container=document.createElement("div");this.input.parentNode.insertBefore(this.epiceditor_container,this.input);this.input.style.display="none";u=i({},n.plugins.epiceditor,{container:this.epiceditor_container,clientSideStorage:!1});this.epiceditor=new EpicEditor(u).load();this.epiceditor.importFile(null,this.getValue());this.epiceditor.on("update",function(){var n=t.epiceditor.exportFile();if(t.input.value=n,t.value=n,t.parent)t.parent.onChildEditorChange(t);else t.jsoneditor.onChange();t.jsoneditor.notifyWatchers(t.path)})}else if(window.ace){r=this.input_type;(r==="cpp"||r==="c++"||r==="c")&&(r="c_cpp");this.ace_container=document.createElement("div");this.ace_container.style.width="100%";this.ace_container.style.position="relative";this.ace_container.style.height="400px";this.input.parentNode.insertBefore(this.ace_container,this.input);this.input.style.display="none";this.ace_editor=ace.edit(this.ace_container);this.ace_editor.setValue(this.getValue());n.plugins.ace.theme&&this.ace_editor.setTheme("ace/theme/"+n.plugins.ace.theme);r=ace.require("ace/mode/"+r);r&&this.ace_editor.getSession().setMode(new r.Mode);this.ace_editor.on("change",function(){var n=t.ace_editor.getValue();if(t.input.value=n,t.refreshValue(),t.parent)t.parent.onChildEditorChange(t);else t.jsoneditor.onChange();t.jsoneditor.notifyWatchers(t.path)})}t.theme.afterInputReady(t.input)},refreshValue:function(){this.value=this.input.value;typeof this.value!="string"&&(this.value="");this.serialized=this.value},destroy:function(){this.sceditor_instance?this.sceditor_instance.destroy():this.epiceditor?this.epiceditor.unload():this.ace_editor&&this.ace_editor.destroy();this.template=null;this.input.parentNode&&this.input.parentNode.removeChild(this.input);this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label);this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description);this._super()},sanitize:function(n){return n},onWatchedFieldChange:function(){var c=this,f,n,i,u,t,r,o,s,e,h;if(this.template&&(f=this.getWatchedFieldValues(),this.setValue(this.template(f),!1,!0)),this.enumSource){for(f=this.getWatchedFieldValues(),i=[],u=[],t=0;t<this.enumSource.length;t++)if(this.enumSource[t]instanceof Array)i=i.concat(this.enumSource[t]),u=u.concat(this.enumSource[t]);else if(f[this.enumSource[t].source]){if(r=f[this.enumSource[t].source],this.enumSource[t].slice&&(r=Array.prototype.slice.apply(r,this.enumSource[t].slice)),this.enumSource[t].filter){for(o=[],n=0;n<r.length;n++)filter({i:n,item:r[n]})&&o.push(r[n]);r=o}for(s=[],e=[],n=0;n<r.length;n++)h=r[n],e[n]=this.enumSource[t].value?this.enumSource[t].value({i:n,item:h}):r[n],s[n]=this.enumSource[t].title?this.enumSource[t].title({i:n,item:h}):e[n];i=i.concat(e);u=u.concat(s)}if(this.theme.setSelectOptions(this.input,i,u),this.select_options=i,i.indexOf(this.value)!==-1)this.input.value=this.value;else{if(this.input.value=i[0],this.value=i[0]||"",this.parent)this.parent.onChildEditorChange(this);else this.jsoneditor.onChange();this.jsoneditor.notifyWatchers(this.path)}}this._super()},showValidationErrors:function(n){var r=this,i=[];t(n,function(n,t){t.path===r.path&&i.push(t.message)});i.length?this.theme.addInputError(this.input,i.join(". ")+"."):this.theme.removeInputError(this.input)}});n.defaults.editors.number=n.defaults.editors.string.extend({getDefault:function(){return this.schema.default||0},sanitize:function(n){return(n+"").replace(/[^0-9\.\-]/g,"")},getNumColumns:function(){return 2},getValue:function(){return this.value*1}});n.defaults.editors.integer=n.defaults.editors.number.extend({sanitize:function(n){return n=n+"",n.replace(/[^0-9\-]/g,"")},getNumColumns:function(){return 2}});n.defaults.editors.object=n.AbstractEditor.extend({getDefault:function(){return i({},this.schema.default||{})},getChildEditors:function(){return this.editors},register:function(){if(this._super(),this.editors)for(var n in this.editors)this.editors.hasOwnProperty(n)&&this.editors[n].register()},unregister:function(){if(this._super(),this.editors)for(var n in this.editors)this.editors.hasOwnProperty(n)&&this.editors[n].unregister()},getNumColumns:function(){return Math.max(Math.min(12,this.maxwidth),3)},enable:function(){if(this.editjson_button&&(this.editjson_button.disabled=!1),this.addproperty_button&&(this.addproperty_button.disabled=!1),this._super(),this.editors)for(var n in this.editors)this.editors.hasOwnProperty(n)&&this.editors[n].enable()},disable:function(){if(this.editjson_button&&(this.editjson_button.disabled=!0),this.addproperty_button&&(this.addproperty_button.disabled=!0),this.hideEditJSON(),this._super(),this.editors)for(var n in this.editors)this.editors.hasOwnProperty(n)&&this.editors[n].disable()},layoutEditors:function(){var h=this,i,r,f,n,u,o,s,e;if(this.row_container){if(this.format==="grid"){for(n=[],t(this.editors,function(t,i){var u;if(!i.property_removed){var r=!1,e=i.options.hidden?0:i.getNumColumns(),f=i.options.hidden?0:i.container.offsetHeight;for(u=0;u<n.length;u++)n[u].width+e<=12&&(!f||n[u].minh*.5<f&&n[u].maxh*2>f)&&(r=u);r===!1&&(n.push({width:0,minh:999999,maxh:0,editors:[]}),r=n.length-1);n[r].editors.push({key:t,width:e,height:f});n[r].width+=e;n[r].minh=Math.min(n[r].minh,f);n[r].maxh=Math.max(n[r].maxh,f)}}),i=0;i<n.length;i++)if(n[i].width<12){for(u=!1,o=0,r=0;r<n[i].editors.length;r++)u===!1?u=r:n[i].editors[r].width>n[i].editors[u].width&&(u=r),n[i].editors[r].width*=12/n[i].width,n[i].editors[r].width=Math.floor(n[i].editors[r].width),o+=n[i].editors[r].width;o<12&&(n[i].editors[u].width+=12-o);n[i].width=12}if(this.layout===JSON.stringify(n))return!1;for(this.layout=JSON.stringify(n),f=document.createElement("div"),i=0;i<n.length;i++)for(s=this.theme.getGridRow(),f.appendChild(s),r=0;r<n[i].editors.length;r++)e=this.editors[n[i].editors[r].key],e.options.hidden?e.container.style.display="none":this.theme.setGridColumnSize(e.container,n[i].editors[r].width),s.appendChild(e.container)}else f=document.createElement("div"),t(this.editors,function(n,t){if(!t.property_removed){var i=h.theme.getGridRow();f.appendChild(i);t.options.hidden?t.container.style.display="none":h.theme.setGridColumnSize(t.container,12);i.appendChild(t.container)}});this.row_container.innerHTML="";this.row_container.appendChild(f)}},build:function(){var n,f,e,i,u;if(this.editors={},n=this,this.format=this.getOption("layout")||this.getOption("object_layout")||this.schema.format||this.jsoneditor.options.object_layout||"normal",this.schema.properties=this.schema.properties||{},this.minwidth=0,this.maxwidth=0,this.getOption("table_row",!1))this.editor_holder=this.container,t(this.schema.properties,function(t,i){var f=n.jsoneditor.getEditorClass(i,n.jsoneditor),u=n.editor_holder.appendChild(n.getTheme().getTableCell()),r;n.editors[t]=n.jsoneditor.createEditor(f,{jsoneditor:n.jsoneditor,schema:i,container:u,path:n.path+"."+t,parent:n,compact:!0});r=n.editors[t].options.hidden?0:n.editors[t].getNumColumns();n.minwidth+=r;n.maxwidth+=r;n.editors[t].options.hidden&&(u.style.display="none")}),this.no_link_holder=!0;else if(this.getOption("table",!1))throw"Not supported yet";else this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.getTheme().getHeader(this.header),this.container.appendChild(this.title),this.container.style.position="relative",this.editjson_holder=this.theme.getModal(),this.editjson_textarea=this.theme.getTextareaInput(),this.editjson_textarea.style.height="170px",this.editjson_textarea.style.width="300px",this.editjson_textarea.style.display="block",this.editjson_save=this.getButton("Save","save","Save"),this.editjson_save.addEventListener("click",function(){n.saveJSON()}),this.editjson_cancel=this.getButton("Cancel","cancel","Cancel"),this.editjson_cancel.addEventListener("click",function(){n.hideEditJSON()}),this.editjson_holder.appendChild(this.editjson_textarea),this.editjson_holder.appendChild(this.editjson_save),this.editjson_holder.appendChild(this.editjson_cancel),this.addproperty_holder=this.theme.getModal(),this.addproperty_list=document.createElement("div"),this.addproperty_list.style.width="295px",this.addproperty_list.style.maxHeight="160px",this.addproperty_list.style.padding="5px 0",this.addproperty_list.style.overflowY="auto",this.addproperty_list.style.overflowX="hidden",this.addproperty_list.style.paddingLeft="5px",this.addproperty_add=this.getButton("add","add","add"),this.addproperty_input=this.theme.getFormInputField("text"),this.addproperty_input.setAttribute("placeholder","Property name..."),this.addproperty_input.style.width="220px",this.addproperty_input.style.marginBottom="0",this.addproperty_input.style.display="inline-block",this.addproperty_add.addEventListener("click",function(){if(n.addproperty_input.value){if(n.editors[n.addproperty_input.value]){alert("there is already a property with that name");return}n.addObjectProperty(n.addproperty_input.value);n.addPropertyCheckbox(n.addproperty_input.value);n.editors[n.addproperty_input.value]&&n.editors[n.addproperty_input.value].disable()}}),this.addproperty_holder.appendChild(this.addproperty_list),this.addproperty_holder.appendChild(this.addproperty_input),this.addproperty_holder.appendChild(this.addproperty_add),f=document.createElement("div"),f.style.clear="both",this.addproperty_holder.appendChild(f),this.schema.description&&(this.description=this.getTheme().getDescription(this.schema.description),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),this.editor_holder=this.getTheme().getIndentedPanel(),this.editor_holder.style.paddingBottom="0",this.container.appendChild(this.editor_holder),this.row_container=this.theme.getGridContainer(),this.editor_holder.appendChild(this.row_container),t(this.schema.properties,function(t,i){var f=n.jsoneditor.getEditorClass(i,n.jsoneditor),r=n.getTheme().getGridColumn(),u;n.row_container.appendChild(r);n.schema.required&&n.schema.required instanceof Array&&(u=n.schema.required.indexOf(t)>=0);n.editors[t]=n.jsoneditor.createEditor(f,{jsoneditor:n.jsoneditor,schema:i,container:r,path:n.path+"."+t,parent:n,required:u});n.minwidth=Math.max(n.minwidth,n.editors[t].getNumColumns());n.maxwidth+=n.editors[t].getNumColumns()}),this.title_controls=this.getTheme().getHeaderButtonHolder(),this.editjson_controls=this.getTheme().getHeaderButtonHolder(),this.addproperty_controls=this.getTheme().getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.title.appendChild(this.editjson_controls),this.title.appendChild(this.addproperty_controls),this.collapsed=!1,this.toggle_button=this.getButton("","collapse","Collapse"),this.title_controls.appendChild(this.toggle_button),this.toggle_button.addEventListener("click",function(){n.collapsed?(n.editor_holder.style.display="",n.collapsed=!1,n.setButtonText(n.toggle_button,"","collapse","Collapse")):(n.editor_holder.style.display="none",n.collapsed=!0,n.setButtonText(n.toggle_button,"","expand","Expand"))}),this.options.collapsed&&r(this.toggle_button,"click"),this.schema.options&&typeof this.schema.options.disable_collapse!="undefined"?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none"),this.editjson_button=this.getButton("JSON","edit","Edit JSON"),this.editjson_button.addEventListener("click",function(){n.toggleEditJSON()}),this.editjson_controls.appendChild(this.editjson_button),this.editjson_controls.appendChild(this.editjson_holder),this.schema.options&&typeof this.schema.options.disable_edit_json!="undefined"?this.schema.options.disable_edit_json&&(this.editjson_button.style.display="none"):this.jsoneditor.options.disable_edit_json&&(this.editjson_button.style.display="none"),this.addproperty_button=this.getButton("Properties","edit","Object Properties"),this.addproperty_button.addEventListener("click",function(){n.toggleAddProperty()}),this.addproperty_controls.appendChild(this.addproperty_button),this.addproperty_controls.appendChild(this.addproperty_holder),this.refreshAddProperties();for(e={},i=Object.keys(this.editors),i=i.sort(function(t,i){var r=n.editors[t].schema.propertyOrder,u=n.editors[i].schema.propertyOrder;return typeof r!="number"&&(r=1e3),typeof u!="number"&&(u=1e3),r-u}),u=0;u<i.length;u++)e[i[u]]=this.editors[i[u]];this.editors=e;this.layoutEditors();this.layoutEditors();this.jsoneditor.notifyWatchers(this.path)},showEditJSON:function(){this.editjson_holder&&(this.hideAddProperty(),this.editjson_holder.style.left=this.editjson_button.offsetLeft+"px",this.editjson_holder.style.top=this.editjson_button.offsetTop+this.editjson_button.offsetHeight+"px",this.editjson_textarea.value=JSON.stringify(this.getValue(),null,2),this.disable(),this.editjson_holder.style.display="",this.editjson_button.disabled=!1,this.editing_json=!0)},hideEditJSON:function(){this.editjson_holder&&this.editing_json&&(this.editjson_holder.style.display="none",this.enable(),this.editing_json=!1)},saveJSON:function(){if(this.editjson_holder)try{var n=JSON.parse(this.editjson_textarea.value);this.setValue(n);this.hideEditJSON()}catch(t){alert("invalid JSON");throw t;}},toggleEditJSON:function(){this.editing_json?this.hideEditJSON():this.showEditJSON()},addPropertyCheckbox:function(n){var u=this.editors[n],i,t,f,r;if(u)return i=this,t=i.theme.getCheckbox(),t.style.width="auto",f=i.theme.getCheckboxLabel(n),r=i.theme.getFormControl(f,t),r.style.paddingBottom=r.style.marginBottom=r.style.paddingTop=r.style.marginTop=0,r.style.height="auto",i.addproperty_list.appendChild(r),t.checked=!u.property_removed,u.isRequired()&&(t.disabled=!0),t.addEventListener("change",function(){t.checked?i.addObjectProperty(n):i.removeObjectProperty(n)}),t},showAddProperty:function(){if(this.addproperty_holder){this.hideEditJSON();this.addproperty_holder.style.left=this.addproperty_button.offsetLeft+"px";this.addproperty_holder.style.top=this.addproperty_button.offsetTop+this.addproperty_button.offsetHeight+"px";this.addproperty_list.innerHTML="";var n=this;this.addproperty_checkboxes={};t(this.editors,function(t){n.addproperty_checkboxes[t]=n.addPropertyCheckbox(t)});this.disable();this.adding_property=!0;this.addproperty_button.disabled=!1;this.addproperty_holder.style.display="";this.refreshAddProperties()}},hideAddProperty:function(){this.addproperty_holder&&this.adding_property&&(this.addproperty_holder.style.display="none",this.enable(),this.adding_property=!1)},toggleAddProperty:function(){this.adding_property?this.hideAddProperty():this.showAddProperty()},removeObjectProperty:function(n){if(this.editors[n])if(this.editors[n].property_removed=!0,this.editors[n].unregister(),this.refreshValue(),this.layoutEditors(),this.jsoneditor.notifyWatchers(this.path),this.parent)this.parent.onChildEditorChange(this);else this.jsoneditor.onChange()},addObjectProperty:function(n){var r=this,u,f,o,e;if(this.editors[n])if(this.editors[n].property_removed)this.editors[n].property_removed=!1,this.editors[n].register(),this.jsoneditor.notifyWatchers(this.editors[n].path);else return;else u={},f=!1,r.schema.patternProperties&&t(r.schema.patternProperties,function(t,r){var e=new RegExp(t);e.test(n)&&(f=!0,u=i(u,r))}),f||typeof r.schema.additionalProperties!="object"||(u=i(u,r.schema.additionalProperties)),o=r.jsoneditor.getEditorClass(u,r.jsoneditor),e=r.getTheme().getChildEditorHolder(),r.editor_holder.appendChild(e),r.editors[n]=r.jsoneditor.createEditor(o,{jsoneditor:r.jsoneditor,schema:u,container:e,path:r.path+"."+n,parent:r,required:!1}),r.editors[n].not_core=!0;if(r.refreshValue(),r.jsoneditor.notifyWatchers(r.path),r.parent)r.parent.onChildEditorChange(r);else r.jsoneditor.onChange();r.layoutEditors()},onChildEditorChange:function(n){this.refreshValue();this._super(n)},canHaveAdditionalProperties:function(){return this.schema.additionalProperties!==!1&&!this.jsoneditor.options.no_additional_properties},destroy:function(){t(this.editors,function(n,t){t.destroy()});this.editor_holder.innerHTML="";this.title&&this.title.parentNode.removeChild(this.title);this.error_holder&&this.error_holder.parentNode.removeChild(this.error_holder);this.editors=null;this.editor_holder.parentNode.removeChild(this.editor_holder);this.editor_holder=null;this._super()},refreshValue:function(){this.value={};this.serialized="";var r=this,u=0,i=!1,n=this.editors;t(this.editors,function(t,r){r.property_removed&&r.not_core&&(n={},i=!0)});t(this.editors,function(t,f){if(f.property_removed){if(!f.not_core&&i)n[t]=f;else if(f.not_core){var e=f.container;f.destroy();e.parentNode&&e.parentNode.removeChild(e)}return}i&&(n[t]=f);u++;r.value[t]=f.getValue()});this.editors=n;this.adding_property&&this.refreshAddProperties()},refreshAddProperties:function(){if(this.options.disable_properties||this.jsoneditor.options.disable_properties){this.addproperty_controls.style.display="none";return}var i=!1,u=!1,r=0,n,t=!1;for(n in this.editors)this.editors.hasOwnProperty(n)&&(this.editors[n].property_removed||r++);i=this.canHaveAdditionalProperties()&&!(typeof this.schema.maxProperties!="undefined"&&r>=this.schema.maxProperties);for(n in this.editors)this.editors.hasOwnProperty(n)&&(this.editors[n].isRequired()?this.addproperty_checkboxes&&this.addproperty_checkboxes[n]&&(this.addproperty_checkboxes[n].disabled=!0):typeof this.schema.minProperties!="undefined"&&r<=this.schema.minProperties?this.addproperty_checkboxes&&this.addproperty_checkboxes[n]?(this.addproperty_checkboxes[n].disabled=this.addproperty_checkboxes[n].checked,this.addproperty_checkboxes[n].checked||(t=!0)):this.editors[n].property_removed&&i&&(t=!0):this.editors[n].property_removed?this.addproperty_checkboxes&&this.addproperty_checkboxes[n]?i?(this.addproperty_checkboxes[n].disabled=!1,t=!0):this.addproperty_checkboxes[n].disabled=!0:i&&(t=!0):(this.addproperty_checkboxes&&this.addproperty_checkboxes[n]&&(this.addproperty_checkboxes[n].disabled=!1),t=!0,u=!0));if(this.canHaveAdditionalProperties()&&(t=!0),this.addproperty_checkboxes)for(n in this.addproperty_checkboxes)this.addproperty_checkboxes.hasOwnProperty(n)&&(this.editors[n]||(t=!0,this.addproperty_checkboxes[n].disabled=!i&&!u));t?this.canHaveAdditionalProperties()?this.addproperty_add.disabled=i?!1:!0:(this.addproperty_add.style.display="none",this.addproperty_input.style.display="none"):(this.hideAddProperty(),this.addproperty_controls.style.display="none")},setValue:function(n,i){var r=this;n=n||{};(typeof n!="object"||n instanceof Array)&&(n={});t(this.editors,function(t,u){if(typeof n[t]!="undefined")u.property_removed&&r.addObjectProperty(t),u.setValue(n[t],i);else{if(!i&&!u.property_removed&&!u.isRequired()){r.removeObjectProperty(t);return}u.setValue(u.getDefault(),i)}});this.canHaveAdditionalProperties()&&t(n,function(n,t){r.editors[n]||(r.addObjectProperty(n),r.editors[n]&&r.editors[n].setValue(t,i))});this.refreshValue();this.jsoneditor.notifyWatchers(this.path)},showValidationErrors:function(n){var r=this,i=[],u=[],f;t(n,function(n,t){t.path===r.path?i.push(t):u.push(t)});this.error_holder&&(i.length?(f=[],this.error_holder.innerHTML="",this.error_holder.style.display="",t(i,function(n,t){r.error_holder.appendChild(r.theme.getErrorMessage(t.message))})):this.error_holder.style.display="none");this.getOption("table_row")&&(i.length?this.theme.addTableRowError(this.container):this.theme.removeTableRowError(this.container));t(this.editors,function(n,t){t.showValidationErrors(u)})}});n.defaults.editors.array=n.AbstractEditor.extend({getDefault:function(){return this.schema.default||[]},register:function(){if(this._super(),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].register()},unregister:function(){if(this._super(),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].unregister()},getNumColumns:function(){var n=this.getItemInfo(0);return this.tabs_holder?Math.max(Math.min(12,n.width+2),4):n.width},addProperty:function(){this._super();this.row_holder.style.display="";this.tabs_holder&&(this.tabs_holder.style.display="");this.controls.style.display="";this.title_controls.style.display="";this.theme.enableHeader(this.title)},removeProperty:function(){this._super();this.row_holder.style.display="none";this.tabs_holder&&(this.tabs_holder.style.display="none");this.controls.style.display="none";this.title_controls.style.display="none";this.theme.disableHeader(this.title)},enable:function(){if(this.add_row_button&&(this.add_row_button.disabled=!1),this.remove_all_rows_button&&(this.remove_all_rows_button.disabled=!1),this.delete_last_row_button&&(this.delete_last_row_button.disabled=!1),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].enable(),this.rows[n].moveup_button&&(this.rows[n].moveup_button.disabled=!1),this.rows[n].movedown_button&&(this.rows[n].movedown_button.disabled=!1),this.rows[n].delete_button&&(this.rows[n].delete_button.disabled=!1);this._super()},disable:function(){if(this.add_row_button&&(this.add_row_button.disabled=!0),this.remove_all_rows_button&&(this.remove_all_rows_button.disabled=!0),this.delete_last_row_button&&(this.delete_last_row_button.disabled=!0),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].disable(),this.rows[n].moveup_button&&(this.rows[n].moveup_button.disabled=!0),this.rows[n].movedown_button&&(this.rows[n].movedown_button.disabled=!0),this.rows[n].delete_button&&(this.rows[n].delete_button.disabled=!0);this._super()},build:function(){this.rows=[];this.row_cache=[];var n=this;this.getOption("compact",!1)?(this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.controls=this.theme.getButtonHolder(),this.panel.appendChild(this.controls),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder)):(this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.theme.getHeader(this.header),this.container.appendChild(this.title),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.schema.description&&(this.description=this.theme.getDescription(this.schema.description),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),this.schema.format==="tabs"?(this.controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.controls),this.tabs_holder=this.theme.getTabHolder(),this.container.appendChild(this.tabs_holder),this.row_holder=this.theme.getTabContentHolder(this.tabs_holder),this.active_tab=null):(this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder),this.controls=this.theme.getButtonHolder(),this.panel.appendChild(this.controls)));this.row_holder.addEventListener("change_header_text",function(){n.refreshTabs(!0)});this.addControls();this.jsoneditor.notifyWatchers(this.path)},onChildEditorChange:function(n){this.refreshValue();this._super(n)},getItemTitle:function(){return this.schema.items&&this.schema.items.title||"item"},getItemSchema:function(n){if(this.schema.items instanceof Array)if(n>=this.schema.items.length){if(this.schema.additionalItems===!0)return{};if(this.schema.additionalItems)return i({},this.schema.additionalItems)}else return i({},this.schema.items[n]);else return this.schema.items?i({},this.schema.items):{}},getItemInfo:function(n){var u=this.getItemSchema(n),r,t,i;return(this.item_info=this.item_info||{},r=JSON.stringify(u),typeof this.item_info[r]!="undefined")?this.item_info[r]:(t=document.createElement("div"),this.container.appendChild(t),t.addEventListener("change_header_text",function(n){n.preventDefault();n.stopPropagation()}),i=this.jsoneditor.getEditorClass(u,this.jsoneditor),i=this.jsoneditor.createEditor(i,{jsoneditor:this.jsoneditor,schema:u,container:t,path:this.path+"."+n,parent:this,required:!0}),this.item_info[r]={child_editors:i.getChildEditors()?!0:!1,title:u.title||"item",width:i.getNumColumns(),"default":i.getDefault()},i.destroy(),t.parentNode&&t.parentNode.removeChild(t),this.item_info[r])},getElementEditor:function(n){var u=this.getItemInfo(n),r=this.getItemSchema(n),f,i,t;return r.title=u.title+" "+n,f=this.jsoneditor.getEditorClass(r,this.jsoneditor),i=this.tabs_holder?this.theme.getTabContent():u.child_editors?this.theme.getChildEditorHolder():this.theme.getIndentedPanel(),this.row_holder.appendChild(i),t=this.jsoneditor.createEditor(f,{jsoneditor:this.jsoneditor,schema:r,container:i,path:this.path+"."+n,parent:this,required:!0}),t.title_controls||(t.array_controls=this.theme.getButtonHolder(),i.appendChild(t.array_controls)),t},destroy:function(){this.empty(!0);this.title&&this.title.parentNode.removeChild(this.title);this.description&&this.description.parentNode.removeChild(this.description);this.row_holder&&this.row_holder.parentNode.removeChild(this.row_holder);this.controls&&this.controls.parentNode.removeChild(this.controls);this.panel&&this.panel.parentNode.removeChild(this.panel);this.rows=this.row_cache=this.title=this.description=this.row_holder=this.panel=this.controls=null;this._super()},empty:function(n){if(this.rows){var i=this;t(this.rows,function(t,r){n&&(r.tab&&r.tab.parentNode&&r.tab.parentNode.removeChild(r.tab),i.destroyRow(r,!0),i.row_cache[t]=null);i.rows[t]=null});i.rows=[];n&&(i.row_cache=[])}},destroyRow:function(n,t){var i=n.container;t?(n.destroy(),i.parentNode&&i.parentNode.removeChild(i),n.tab&&n.tab.parentNode&&n.tab.parentNode.removeChild(n.tab)):(n.tab&&(n.tab.style.display="none"),i.style.display="none",n.unregister())},getMax:function(){return this.schema.items instanceof Array&&this.schema.additionalItems===!1?Math.min(this.schema.items.length,this.schema.maxItems||Infinity):this.schema.maxItems||Infinity},refreshTabs:function(n){var i=this;t(this.rows,function(t,r){r.tab&&(n?r.tab_text.textContent=r.getHeaderText():r.tab===i.active_tab?(i.theme.markTabActive(r.tab),r.container.style.display=""):(i.theme.markTabInactive(r.tab),r.container.style.display="none"))})},setValue:function(n){var f,i,r,u;if(n=n||[],n instanceof Array||(n=[n]),f=JSON.stringify(n),f!==this.serialized){if(this.schema.minItems)while(n.length<this.schema.minItems)n.push(this.getItemInfo(n.length).default);for(this.getMax()&&n.length>this.getMax()&&(n=n.slice(0,this.getMax())),i=this,t(n,function(n,t){i.rows[n]?i.rows[n].setValue(t):i.row_cache[n]?(i.rows[n]=i.row_cache[n],i.rows[n].setValue(t),i.rows[n].container.style.display="",i.rows[n].tab&&(i.rows[n].tab.style.display=""),i.rows[n].register()):i.addRow(t)}),r=n.length;r<i.rows.length;r++)i.destroyRow(i.rows[r]),i.rows[r]=null;i.rows=i.rows.slice(0,n.length);u=null;t(i.rows,function(n,t){if(t.tab===i.active_tab)return u=t.tab,!1});!u&&i.rows.length&&(u=i.rows[0].tab);i.active_tab=u;i.refreshValue();i.refreshTabs();i.jsoneditor.notifyWatchers(i.path)}},refreshValue:function(){var i=this,r=this.value?this.value.length:0,n;this.value=[];t(this.rows,function(n,t){i.value[n]=t.getValue()});r!==this.value.length&&(n=this.schema.minItems&&this.schema.minItems>=this.rows.length,t(this.rows,function(t,r){r.movedown_button.style.display=t===i.rows.length-1?"none":"";r.delete_button.style.display=n?"none":"";i.value[t]=r.getValue()}),this.value.length?this.value.length===1?(this.remove_all_rows_button.style.display="none",this.delete_last_row_button.style.display=n?"none":""):n?(this.delete_last_row_button.style.display="none",this.delete_last_row_button.style.display="none"):(this.delete_last_row_button.style.display="",this.remove_all_rows_button.style.display=""):(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none"),this.add_row_button.style.display=this.getMax()&&this.getMax()<=this.rows.length?"none":"")},addRow:function(n){var i=this,r=this.rows.length,u;i.rows[r]=this.getElementEditor(r);i.row_cache[r]=i.rows[r];i.tabs_holder&&(i.rows[r].tab_text=document.createElement("span"),i.rows[r].tab_text.textContent=i.rows[r].getHeaderText(),i.rows[r].tab=i.theme.getTab(i.rows[r].tab_text),i.rows[r].tab.addEventListener("click",function(n){i.active_tab=i.rows[r].tab;i.refreshTabs();n.preventDefault();n.stopPropagation()}),i.theme.addTab(i.tabs_holder,i.rows[r].tab));i.rows[r].delete_button=this.getButton(i.getItemTitle(),"delete","Delete "+i.getItemTitle());i.rows[r].delete_button.className+=" delete";i.rows[r].delete_button.setAttribute("data-i",r);i.rows[r].delete_button.addEventListener("click",function(){var u=this.getAttribute("data-i")*1,f=i.getValue(),r=[],n=null;if(t(f,function(t,f){if(t===u){i.rows[t].tab===i.active_tab&&(i.rows[t+1]?n=i.rows[t+1].tab:t&&(n=i.rows[t-1].tab));return}r.push(f)}),i.setValue(r),n&&(i.active_tab=n,i.refreshTabs()),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});i.rows[r].moveup_button=this.getButton("","moveup","Move up");i.rows[r].moveup_button.className+=" moveup";i.rows[r].moveup_button.setAttribute("data-i",r);i.rows[r].moveup_button.addEventListener("click",function(){var n=this.getAttribute("data-i")*1,t,r;if(!(n<=0))if(t=i.getValue(),r=t[n-1],t[n-1]=t[n],t[n]=r,i.setValue(t),i.active_tab=i.rows[n-1].tab,i.refreshTabs(),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});i.rows[r].movedown_button=this.getButton("","movedown","Move down");i.rows[r].movedown_button.className+=" movedown";i.rows[r].movedown_button.setAttribute("data-i",r);i.rows[r].movedown_button.addEventListener("click",function(){var n=this.getAttribute("data-i")*1,t=i.getValue(),r;if(!(n>=t.length-1))if(r=t[n+1],t[n+1]=t[n],t[n]=r,i.setValue(t),i.active_tab=i.rows[n+1].tab,i.refreshTabs(),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});u=i.rows[r].title_controls||i.rows[r].array_controls;u&&(u.appendChild(i.rows[r].delete_button),r&&u.appendChild(i.rows[r].moveup_button),u.appendChild(i.rows[r].movedown_button));n&&i.rows[r].setValue(n);i.refreshTabs()},addControls:function(){var n=this,t,i;this.collapsed=!1;this.toggle_button=this.getButton("","collapse","Collapse");this.title_controls.appendChild(this.toggle_button);t=n.row_holder.style.display;i=n.controls.style.display;this.toggle_button.addEventListener("click",function(){n.collapsed?(n.collapsed=!1,n.row_holder.style.display=t,n.tabs_holder&&(n.tabs_holder.style.display=""),n.controls.style.display=i,n.setButtonText(this,"","collapse","Collapse")):(n.collapsed=!0,n.row_holder.style.display="none",n.tabs_holder&&(n.tabs_holder.style.display="none"),n.controls.style.display="none",n.setButtonText(this,"","expand","Expand"))});this.options.collapsed&&r(this.toggle_button,"click");this.schema.options&&typeof this.schema.options.disable_collapse!="undefined"?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none");this.add_row_button=this.getButton(this.getItemTitle(),"add","Add "+this.getItemTitle());this.add_row_button.addEventListener("click",function(){var t=n.rows.length;if(n.row_cache[t]?(n.rows[t]=n.row_cache[t],n.rows[t].container.style.display="",n.rows[t].tab&&(n.rows[t].tab.style.display=""),n.rows[t].register()):n.addRow(),n.active_tab=n.rows[t].tab,n.refreshTabs(),n.refreshValue(),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange();n.jsoneditor.notifyWatchers(n.path)});n.controls.appendChild(this.add_row_button);this.delete_last_row_button=this.getButton("Last "+this.getItemTitle(),"delete","Delete Last "+this.getItemTitle());this.delete_last_row_button.addEventListener("click",function(){var i=n.getValue(),t=null;if(n.rows.length>1&&n.rows[n.rows.length-1].tab===n.active_tab&&(t=n.rows[n.rows.length-2].tab),i.pop(),n.setValue(i),t&&(n.active_tab=t,n.refreshTabs()),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});n.controls.appendChild(this.delete_last_row_button);this.remove_all_rows_button=this.getButton("All","delete","Delete All");this.remove_all_rows_button.addEventListener("click",function(){if(n.setValue([]),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});n.controls.appendChild(this.remove_all_rows_button);n.tabs&&(this.add_row_button.style.width="100%",this.add_row_button.style.textAlign="left",this.add_row_button.style.marginBottom="3px",this.delete_last_row_button.style.width="100%",this.delete_last_row_button.style.textAlign="left",this.delete_last_row_button.style.marginBottom="3px",this.remove_all_rows_button.style.width="100%",this.remove_all_rows_button.style.textAlign="left",this.remove_all_rows_button.style.marginBottom="3px")},showValidationErrors:function(n){var i=this,r=[],u=[],f;t(n,function(n,t){t.path===i.path?r.push(t):u.push(t)});this.error_holder&&(r.length?(f=[],this.error_holder.innerHTML="",this.error_holder.style.display="",t(r,function(n,t){i.error_holder.appendChild(i.theme.getErrorMessage(t.message))})):this.error_holder.style.display="none");t(this.rows,function(n,t){t.showValidationErrors(u)})}});n.defaults.editors.table=n.defaults.editors.array.extend({addProperty:function(){this._super();this.value.length&&(this.table.style.display="")},removeProperty:function(){this._super();this.table.style.display="none"},register:function(){if(this._super(),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].register()},unregister:function(){if(this._super(),this.rows)for(var n=0;n<this.rows.length;n++)this.rows[n].unregister()},getNumColumns:function(){return Math.max(Math.min(12,this.width),3)},build:function(){var n,i;this.rows=[];n=this;this.schema.items=this.schema.items||[];this.table=this.theme.getTable();this.container.appendChild(this.table);this.thead=this.theme.getTableHead();this.table.appendChild(this.thead);this.header_row=this.theme.getTableRow();this.thead.appendChild(this.header_row);this.row_holder=this.theme.getTableBody();this.table.appendChild(this.row_holder);i=this.getElementEditor(0,!0);this.item_default=i.getDefault();this.item_title=this.schema.items.title||"row";this.width=i.getNumColumns();i.getChildEditors()&&(this.item_has_child_editors=!0);this.getOption("compact",!1)?(this.panel=document.createElement("div"),this.container.appendChild(this.panel)):(this.title=this.theme.getHeader(this.getTitle()),this.container.appendChild(this.title),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.schema.description&&(this.description=this.theme.getDescription(this.schema.description),this.panel.appendChild(this.description)),this.error_holder=document.createElement("div"),this.panel.appendChild(this.error_holder));this.panel.appendChild(this.table);this.controls=this.theme.getButtonHolder();this.panel.appendChild(this.controls);this.item_has_child_editors?t(i.getChildEditors(),function(t,i){var r=n.theme.getTableHeaderCell(i.getTitle());i.options.hidden&&(r.style.display="none");n.header_row.appendChild(r)}):n.header_row.appendChild(n.theme.getTableHeaderCell(this.item_title));i.destroy();this.row_holder.innerHTML="";n.header_row.appendChild(n.theme.getTableHeaderCell(" "));this.addControls();this.jsoneditor.notifyWatchers(this.path)},onChildEditorChange:function(){this.refreshValue();this._super()},getItemDefault:function(){return i({},{"default":this.item_default}).default},getItemTitle:function(){return this.item_title},getElementEditor:function(n,t){var e=i({},this.schema.items),o=this.jsoneditor.getEditorClass(e,this.jsoneditor),u=this.row_holder.appendChild(this.theme.getTableRow()),f=u,r;return this.item_has_child_editors||(f=this.theme.getTableCell(),u.appendChild(f)),t&&f.addEventListener("change_header_text",function(n){n.preventDefault();n.stopPropagation()}),r=this.jsoneditor.createEditor(o,{jsoneditor:this.jsoneditor,schema:e,container:f,path:this.path+"."+n,parent:this,compact:!0,table_row:!0}),r.controls_cell=u.appendChild(this.theme.getTableCell()),r.row=u,r.table_controls=this.theme.getButtonHolder(),r.controls_cell.appendChild(r.table_controls),r.table_controls.style.margin=0,r.table_controls.style.padding=0,r},destroy:function(){this.innerHTML="";this.title&&this.title.parentNode.removeChild(this.title);this.description&&this.description.parentNode.removeChild(this.description);this.row_holder&&this.row_holder.parentNode&&this.row_holder.parentNode.removeChild(this.row_holder);this.table.parentNode.removeChild(this.table);this.panel&&this.panel.parentNode.removeChild(this.panel);this.rows=this.title=this.description=this.row_holder=this.table=this.panel=null;this._super()},empty:function(){if(this.rows){var n=this;t(this.rows,function(t,i){n.item_has_child_editors||i.row.parentNode.removeChild(i.row);i.destroy();n.rows[t]=null});n.rows=[]}},setValue:function(n){var e,u,i,r,f;if(n=n||[],this.schema.minItems)while(n.length<this.schema.minItems)n.push(this.getItemDefault());if(this.schema.maxItems&&n.length>this.schema.maxItems&&(n=n.slice(0,this.schema.maxItems)),e=JSON.stringify(n),e!==this.serialized){for(u=!1,i=this,t(n,function(n,t){i.rows[n]?i.rows[n].setValue(t):(i.addRow(t),u=!0)}),r=n.length;r<i.rows.length;r++)f=i.rows[r].container,i.item_has_child_editors||i.rows[r].row.parentNode.removeChild(i.rows[r].row),i.rows[r].destroy(),f.parentNode&&f.parentNode.removeChild(f),i.rows[r]=null,u=!0;i.rows=i.rows.slice(0,n.length);i.refreshValue();u&&i.refreshRowButtons();i.jsoneditor.notifyWatchers(i.path)}},refreshRowButtons:function(){var i=this,n=this.schema.minItems&&this.schema.minItems>=this.rows.length;t(this.rows,function(t,r){r.movedown_button.style.display=t===i.rows.length-1?"none":"";r.delete_button.style.display=n?"none":""});this.value.length?this.value.length===1?(this.table.style.display="",this.remove_all_rows_button.style.display="none",this.delete_last_row_button.style.display=n?"none":""):(this.table.style.display="",n?(this.delete_last_row_button.style.display="none",this.delete_last_row_button.style.display="none"):(this.delete_last_row_button.style.display="",this.remove_all_rows_button.style.display="")):(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none",this.table.style.display="none");this.add_row_button.style.display=this.schema.maxItems&&this.schema.maxItems<=this.rows.length?"none":""},refreshValue:function(){var n=this;this.value=[];t(this.rows,function(t,i){n.value[t]=i.getValue()});this.serialized=JSON.stringify(this.value)},addRow:function(n){var i=this,r=this.rows.length,u;i.rows[r]=this.getElementEditor(r);i.rows[r].delete_button=this.getButton("","delete","Delete");i.rows[r].delete_button.className+=" delete";i.rows[r].delete_button.setAttribute("data-i",r);i.rows[r].delete_button.addEventListener("click",function(){var r=this.getAttribute("data-i")*1,u=i.getValue(),n=[];if(t(u,function(t,i){t!==r&&n.push(i)}),i.setValue(n),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});i.rows[r].moveup_button=this.getButton("","moveup","Move up");i.rows[r].moveup_button.className+=" moveup";i.rows[r].moveup_button.setAttribute("data-i",r);i.rows[r].moveup_button.addEventListener("click",function(){var t=this.getAttribute("data-i")*1,n,r;if(!(t<=0))if(n=i.getValue(),r=n[t-1],n[t-1]=n[t],n[t]=r,i.setValue(n),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});i.rows[r].movedown_button=this.getButton("","movedown","Move down");i.rows[r].movedown_button.className+=" movedown";i.rows[r].movedown_button.setAttribute("data-i",r);i.rows[r].movedown_button.addEventListener("click",function(){var t=this.getAttribute("data-i")*1,n=i.getValue(),r;if(!(t>=n.length-1))if(r=n[t+1],n[t+1]=n[t],n[t]=r,i.setValue(n),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()});u=i.rows[r].table_controls;u.appendChild(i.rows[r].delete_button);r&&u.appendChild(i.rows[r].moveup_button);u.appendChild(i.rows[r].movedown_button);n&&i.rows[r].setValue(n);i.jsoneditor.notifyWatchers(i.path)},addControls:function(){var n=this;this.collapsed=!1;this.toggle_button=this.getButton("","collapse","Collapse");this.title_controls.appendChild(this.toggle_button);this.toggle_button.addEventListener("click",function(t){t.preventDefault();t.stopPropagation();n.collapsed?(n.collapsed=!1,n.panel.style.display="",n.setButtonText(this,"","collapse","Collapse")):(n.collapsed=!0,n.panel.style.display="none",n.setButtonText(this,"","expand","Expand"))});this.options.collapsed&&r(this.toggle_button,"click");this.schema.options&&typeof this.schema.options.disable_collapse!="undefined"?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none");this.add_row_button=this.getButton(this.getItemTitle(),"add","Add "+this.getItemTitle());this.add_row_button.addEventListener("click",function(t){if(t.preventDefault(),t.stopPropagation(),n.addRow(),n.refreshValue(),n.refreshRowButtons(),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});n.controls.appendChild(this.add_row_button);this.delete_last_row_button=this.getButton("Last "+this.getItemTitle(),"delete","Delete Last "+this.getItemTitle());this.delete_last_row_button.addEventListener("click",function(t){t.preventDefault();t.stopPropagation();var i=n.getValue();if(i.pop(),n.setValue(i),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});n.controls.appendChild(this.delete_last_row_button);this.remove_all_rows_button=this.getButton("All","delete","Delete All");this.remove_all_rows_button.addEventListener("click",function(t){if(t.preventDefault(),t.stopPropagation(),n.setValue([]),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});n.controls.appendChild(this.remove_all_rows_button)}});n.defaults.editors.multiple=n.AbstractEditor.extend({getDefault:function(){return this.schema.default||null},register:function(){if(this.editors){for(var n=0;n<this.editors.length;n++)this.editors[n]&&this.editors[n].unregister();this.editors[this.type]&&this.editors[this.type].register()}this._super()},getNumColumns:function(){return Math.max(this.editors[this.type].getNumColumns(),4)},enable:function(){if(this.editors)for(var n=0;n<this.editors.length;n++)this.editors[n]&&this.editors[n].enable();this.switcher.disabled=!1;this._super()},disable:function(){if(this.editors)for(var n=0;n<this.editors.length;n++)this.editors[n]&&this.editors[n].disable();this.switcher.disabled=!0;this._super()},unregister:function(){if(this._super(),this.editors)for(var n=0;n<this.editors.length;n++)this.editors[n]&&this.editors[n].unregister()},switchEditor:function(n){var i=this,r;if(this.editors[n]||this.buildChildEditor(n),i.type=n,i.register(),r=i.getValue(),t(i.editors,function(n,t){t&&(i.type===n?(t.setValue(r,!0),t.container.style.display=""):t.container.style.display="none")}),i.refreshValue(),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange()},buildChildEditor:function(n){var t=this,r=this.types[n],f=t.theme.getChildEditorHolder(),u,e;t.editor_holder.appendChild(f);typeof r=="string"?(u=i({},t.schema),u.type=r):(u=i({},t.schema,r),r.required&&r.required instanceof Array&&t.schema.required&&t.schema.required instanceof Array&&(u.required=t.schema.required.concat(r.required)));e=t.jsoneditor.getEditorClass(u,t.jsoneditor);t.editors[n]=t.jsoneditor.createEditor(e,{jsoneditor:t.jsoneditor,schema:u,container:f,path:t.path,parent:t,required:!0});t.editors[n].header&&(t.editors[n].header.style.display="none");t.editors[n].option=t.switcher_options[n];f.addEventListener("change_header_text",function(){t.refreshHeaderText()});n!==t.type&&(f.style.display="none")},build:function(){var r=this,e=this.container,u,f;this.header=this.label=this.theme.getFormInputLabel(this.getTitle());this.container.appendChild(this.header);this.types=[];this.schema.oneOf?(this.oneOf=!0,this.types=this.schema.oneOf,delete this.schema.oneOf):(this.schema.type&&this.schema.type!=="any"?this.types=this.schema.type instanceof Array?this.schema.type:[this.schema.type]:(this.types=["string","number","integer","boolean","object","array","null"],this.schema.disallow&&(u=this.schema.disallow,typeof schema.disallow=="object"&&schema.disallow instanceof Array||(u=[this.schema.disallow]),f=[],t(this.types,function(n,t){u.indexOf(t)===-1&&f.push(t)}),this.types=f)),delete this.schema.type);this.display_text=this.getDisplayText(this.types);this.switcher=this.theme.getSwitcher(this.display_text);e.appendChild(this.switcher);this.switcher.addEventListener("change",function(n){n.preventDefault();n.stopPropagation();r.switchEditor(r.display_text.indexOf(this.value))});this.switcher.style.marginBottom=0;this.switcher.style.width="auto";this.switcher.style.display="inline-block";this.switcher.style.marginLeft="5px";this.editor_holder=document.createElement("div");e.appendChild(this.editor_holder);this.type=0;this.editors=[];this.validators=[];this.switcher_options=this.theme.getSwitcherOptions(this.switcher);t(this.types,function(t,u){r.editors[t]=!1;var f;typeof u=="string"?(f=i({},r.schema),f.type=u):(f=i({},r.schema,u),u.required&&u.required instanceof Array&&r.schema.required&&r.schema.required instanceof Array&&(f.required=r.schema.required.concat(u.required)));r.validators[t]=new n.Validator(f,{required_by_default:r.jsoneditor.options.required_by_default,no_additional_properties:r.jsoneditor.options.no_additional_properties})});this.switchEditor(0);this.refreshValue();this.refreshHeaderText();this.register()},onChildEditorChange:function(){this.editors[this.type]&&(this.refreshHeaderText(),this.refreshValue());this._super()},refreshHeaderText:function(){var n=[],i;t(this.validators,function(t,i){n.push(i.schema)});i=this.getDisplayText(n);t(this.switcher_options,function(n,t){t.textContent=i[n]})},refreshValue:function(){this.value=this.editors[this.type].getValue()},setValue:function(n,i){var r=this;t(this.validators,function(t,i){if(!i.validate(n).length)return r.type=t,r.switcher.value=r.display_text[t],!1});this.switchEditor(this.type);this.editors[this.type].setValue(n,i);this.refreshValue();this.jsoneditor.notifyWatchers(this.path)},destroy:function(){t(this.editors,function(n,t){t&&t.destroy()});this.editor_holder.parentNode.removeChild(this.editor_holder);this.switcher.parentNode.removeChild(this.switcher);this._super()},showValidationErrors:function(n){var r=this;this.oneOf?t(this.editors,function(u,f){if(f){var e=r.path+".oneOf["+u+"]",o=[];t(n,function(n,t){if(t.path.substr(0,e.length)===e){var u=i({},t);u.path=r.path+u.path.substr(e.length);o.push(u)}});f.showValidationErrors(o)}}):t(this.editors,function(t,i){i&&i.showValidationErrors(n)})}});n.defaults.editors.enum=n.AbstractEditor.extend({getDefault:function(){return this.schema.enum[0]},addProperty:function(){this._super();this.display_area.style.display="";this.theme.enableHeader(this.title)},removeProperty:function(){this._super();this.display_area.style.display="none";this.theme.disableHeader(this.title)},getNumColumns:function(){return 4},build:function(){var i=this.getContainer(),n,t;for(this.title=this.header=this.label=this.getTheme().getFormInputLabel(this.getTitle()),this.container.appendChild(this.title),this.options.enum_titles=this.options.enum_titles||[],this.enum=this.schema.enum,this.selected=0,this.select_options=[],this.html_values=[],n=this,t=0;t<this.enum.length;t++)this.select_options[t]=this.options.enum_titles[t]||"Value "+(t+1),this.html_values[t]=this.getHTML(this.enum[t]);this.switcher=this.theme.getSwitcher(this.select_options);this.container.appendChild(this.switcher);this.switcher.style.width="auto";this.switcher.style.display="inline-block";this.switcher.style.marginLeft="5px";this.switcher.style.marginBottom=0;this.display_area=this.theme.getIndentedPanel();this.display_area.style.paddingTop=0;this.display_area.style.paddingBottom=0;this.container.appendChild(this.display_area);this.switcher.addEventListener("change",function(){if(n.selected=n.select_options.indexOf(this.value),n.value=n.enum[n.selected],n.refreshValue(),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange()});this.value=this.enum[0];this.refreshValue();this.jsoneditor.notifyWatchers(this.path);this.enum.length===1&&(this.switcher.style.display="none")},refreshValue:function(){var n=this,i;if(n.selected=-1,i=JSON.stringify(this.value),t(this.enum,function(t,r){if(i===JSON.stringify(r))return n.selected=t,!1}),n.selected<0){n.setValue(n.enum[0]);return}this.switcher.value=this.select_options[this.selected];this.display_area.innerHTML=this.html_values[this.selected]},enable:function(){this.always_disabled||(this.switcher.disabled=!1);this._super()},disable:function(){this.switcher.disabled=!0;this._super()},getHTML:function(n){var r=this,i;return n===null?"<em>null<\/em>":typeof n=="object"?(i="",t(n,function(t,u){var f=r.getHTML(u);n instanceof Array||(f="<div><em>"+t+"<\/em>: "+f+"<\/div>");i+="<li>"+f+"<\/li>"}),i=n instanceof Array?"<ol>"+i+"<\/ol>":"<ul style='margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;'>"+i+"<\/ul>"):typeof n=="boolean"?n?"true":"false":typeof n=="string"?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n},setValue:function(n){this.value!==n&&(this.value=n,this.refreshValue(),this.jsoneditor.notifyWatchers(this.path))},destroy:function(){this.display_area.parentNode.removeChild(this.display_area);this.title.parentNode.removeChild(this.title);this.switcher.parentNode.removeChild(this.switcher);this._super()}});n.defaults.editors.select=n.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},setValue:function(n){n=this.typecast(n||"");var t=n;(this.enum_values.indexOf(t)<0&&(t=this.enum_values[0]),this.value!==t)&&(this.input.value=this.enum_options[this.enum_values.indexOf(t)],this.value=t,this.jsoneditor.notifyWatchers(this.path))},register:function(){(this._super(),this.input)&&this.input.setAttribute("name",this.formname)},unregister:function(){(this._super(),this.input)&&this.input.removeAttribute("name")},getNumColumns:function(){for(var n=this.getTitle().length,t=0;t<this.enum_options.length;t++)n=Math.max(n,this.enum_options[t].length+4);return Math.min(12,Math.max(n/7,2))},typecast:function(n){return this.schema.type==="boolean"?!!n:this.schema.type==="number"?1*n:this.schema.type==="integer"?Math.floor(n*1):""+n},getValue:function(){return this.value},removeProperty:function(){this._super();this.input.style.display="none";this.description&&(this.description.style.display="none");this.theme.disableLabel(this.label)},addProperty:function(){this._super();this.input.style.display="";this.description&&(this.description.style.display="");this.theme.enableLabel(this.label)},build:function(){var n=this;if(this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.input_type="select",this.enum_options=[],this.enum_values=[],this.enum_display=[],this.schema.enum)t(this.schema.enum,function(t,i){n.enum_options[t]=""+i;n.enum_display[t]=""+i;n.enum_values[t]=n.typecast(i)});else if(this.schema.type==="boolean")n.enum_display=["true","false"],n.enum_options=["1",""],n.enum_values=[!0,!1];else throw"'select' editor requires the enum property to be set.";this.getOption("compact")&&this.container.setAttribute("class",this.container.getAttribute("class")+" compact");this.input=this.theme.getSelectInput(this.enum_options);this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display);(this.schema.readOnly||this.schema.readonly)&&(this.always_disabled=!0,this.input.disabled=!0);this.input.addEventListener("change",function(t){t.preventDefault();t.stopPropagation();var i=this.value,r=i;if(n.enum_options.indexOf(i)===-1&&(r=n.enum_options[0]),n.value=n.enum_values[n.enum_options.indexOf(i)],n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange();n.jsoneditor.notifyWatchers(n.path)});this.control=this.getTheme().getFormControl(this.label,this.input,this.description);this.container.appendChild(this.control);this.value=this.enum_values[0];window.$&&$.fn&&$.fn.select2&&this.enum_options.length>2&&$(this.input).select2();this.register();n.theme.afterInputReady(n.input);this.jsoneditor.notifyWatchers(this.path)},enable:function(){this.always_disabled||(this.input.disabled=!1);this._super()},disable:function(){this.input.disabled=!0;this._super()},destroy:function(){this.label&&this.label.parentNode.removeChild(this.label);this.description&&this.description.parentNode.removeChild(this.description);this.input.parentNode.removeChild(this.input);this._super()}});n.defaults.editors.multiselect=n.AbstractEditor.extend({getDefault:function(){return[]},build:function(){var i=this,n,r,t,u;for(this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.select_options={},this.select_values={},r=this.schema.items.enum||[],t=[],n=0;n<r.length;n++)this.sanitize(r[n])===r[n]&&(t.push(r[n]+""),this.select_values[r[n]+""]=r[n]);if(!this.schema.format&&t.length<8||this.schema.format==="checkbox"){for(this.input_type="checkboxes",this.inputs={},this.controls={},n=0;n<t.length;n++)this.inputs[t[n]]=this.theme.getCheckbox(),this.select_options[t[n]]=this.inputs[t[n]],u=this.theme.getCheckboxLabel(t[n]),this.controls[t[n]]=this.theme.getFormControl(u,this.inputs[t[n]]);this.control=this.theme.getMultiCheckboxHolder(this.controls,this.label,this.description)}else{for(this.input_type="select",this.input=this.theme.getSelectInput(t),this.input.multiple=!0,this.input.size=Math.min(10,t.length),n=0;n<t.length;n++)this.select_options[t[n]]=this.input.children[n];(this.schema.readOnly||this.schema.readonly)&&(this.always_disabled=!0,this.input.disabled=!0);this.control=this.getTheme().getFormControl(this.label,this.input,this.description)}this.container.appendChild(this.control);this.control.addEventListener("change",function(r){r.preventDefault();r.stopPropagation();var u=[];for(n=0;n<t.length;n++)(i.select_options[t[n]].selected||i.select_options[t[n]].checked)&&u.push(i.select_values[t[n]]);if(i.updateValue(u),i.parent)i.parent.onChildEditorChange(i);else i.jsoneditor.onChange();i.jsoneditor.notifyWatchers(i.path)})},setValue:function(n){var t;for(n=n||[],typeof n!="object"?n=[n]:n instanceof Array||(n=[]),t=0;t<n.length;t++)typeof n[t]!="string"&&(n[t]+="");for(t in this.select_options)this.select_options.hasOwnProperty(t)&&(this.select_options[t][this.input_type==="select"?"selected":"checked"]=n.indexOf(t)!==-1);if(this.updateValue(n))if(this.parent)this.onChildEditorChange(this);else this.jsoneditor.onChange();this.jsoneditor.notifyWatchers(this.path)},register:function(){(this._super(),this.input)&&this.input.setAttribute("name",this.formname)},unregister:function(){(this._super(),this.input)&&this.input.removeAttribute("name")},getNumColumns:function(){var n=this.getTitle().length;for(var t in this.select_values)this.select_values.hasOwnProperty(t)&&(n=Math.max(n,(this.select_values[t]+"").length+4));return Math.min(12,Math.max(n/7,2))},updateValue:function(n){for(var r,i=!1,u=[],t=0;t<n.length;t++){if(!this.select_options[n[t]+""]){i=!0;continue}r=this.sanitize(this.select_values[n[t]]);u.push(r);r!==n[t]&&(i=!0)}return this.value=u,i},sanitize:function(n){return this.schema.items.type==="number"?1*n:this.schema.items.type==="integer"?Math.floor(n*1):""+n},enable:function(){this.always_disabled||(this.input.disabled=!1);this._super()},disable:function(){this.input.disabled=!0;this._super()}});n.defaults.editors.base64=n.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},getNumColumns:function(){return 4},build:function(){var n=this;if(this.title=this.header=this.label=this.getTheme().getFormInputLabel(this.getTitle()),this.input=this.theme.getFormInputField("hidden"),this.container.appendChild(this.input),!this.schema.readOnly&&!this.schema.readonly){if(!window.FileReader)throw"FileReader required for base64 editor";this.uploader=this.theme.getFormInputField("file");this.uploader.addEventListener("change",function(t){if(t.preventDefault(),t.stopPropagation(),this.files&&this.files.length){var i=new FileReader;i.onload=function(t){if(n.value=t.target.result,n.refreshPreview(),n.watch_listener(),n.jsoneditor.notifyWatchers(n.path),n.parent)n.parent.onChildEditorChange(n);else n.jsoneditor.onChange();i=null};i.readAsDataURL(this.files[0])}})}this.preview=this.theme.getFormInputDescription(this.schema.description);this.container.appendChild(this.preview);this.control=this.getTheme().getFormControl(this.label,this.uploader||this.input,this.preview);this.container.appendChild(this.control);this.register()},refreshPreview:function(){var n,t;this.last_preview!==this.value&&(this.last_preview=this.value,this.preview.innerHTML="",this.value)&&(n=this.value.match(/^data:([^;,]+)[;,]/),n&&(n=n[1]),n?(this.preview.innerHTML="<strong>Type:<\/strong> "+n+", <strong>Size:<\/strong> "+Math.floor((this.value.length-this.value.split(",")[0].length-1)/1.33333)+" bytes",n.substr(0,5)==="image"&&(this.preview.innerHTML+="<br>",t=document.createElement("img"),t.style.maxWidth="100%",t.style.maxHeight="100px",t.src=this.value,this.preview.appendChild(t))):this.preview.innerHTML="<em>Invalid data URI<\/em>")},enable:function(){this.uploader&&(this.uploader.disabled=!1);this._super()},disable:function(){this.uploader&&(this.uploader.disabled=!0);this._super()},setValue:function(n){this.value!==n&&(this.value=n,this.input.value=this.value,this.refreshPreview(),this.watch_listener(),this.jsoneditor.notifyWatchers(this.path))},destroy:function(){this.preview.parentNode.removeChild(this.preview);this.title.parentNode.removeChild(this.title);this.input.parentNode.removeChild(this.input);this.uploader&&this.uploader.parentNode.removeChild(this.uploader);this._super()}});n.AbstractTheme=Class.extend({getContainer:function(){return document.createElement("div")},getFloatRightLinkHolder:function(){var n=document.createElement("div");return n.style=n.style||{},n.style.float="right",n.style["margin-left"]="10px",n},getModal:function(){var n=document.createElement("div");return n.style.backgroundColor="white",n.style.border="1px solid black",n.style.boxShadow="3px 3px black",n.style.position="absolute",n.style.zIndex="10",n.style.display="none",n},getGridContainer:function(){return document.createElement("div")},getGridRow:function(){var n=document.createElement("div");return n.className="row",n},getGridColumn:function(){return document.createElement("div")},setGridColumnSize:function(){},getLink:function(n){var t=document.createElement("a");return t.setAttribute("href","#"),t.appendChild(document.createTextNode(n)),t},disableHeader:function(n){n.style.color="#ccc"},disableLabel:function(n){n.style.color="#ccc"},enableHeader:function(n){n.style.color=""},enableLabel:function(n){n.style.color=""},getFormInputLabel:function(n){var t=document.createElement("label");return t.appendChild(document.createTextNode(n)),t},getCheckboxLabel:function(n){var t=this.getFormInputLabel(n);return t.style.fontWeight="normal",t},getHeader:function(n){var t=document.createElement("h3");return typeof n=="string"?t.textContent=n:t.appendChild(n),t},getCheckbox:function(){var n=this.getFormInputField("checkbox");return n.style.display="inline-block",n.style.width="auto",n},getMultiCheckboxHolder:function(n,t,i){var u=document.createElement("div"),r;t.style.display="block";u.appendChild(t);for(r in n)n.hasOwnProperty(r)&&(n[r].style.display="inline-block",n[r].style.marginRight="20px",u.appendChild(n[r]));return i&&u.appendChild(i),u},getSelectInput:function(n){var t=document.createElement("select");return n&&this.setSelectOptions(t,n),t},getSwitcher:function(n){var t=this.getSelectInput(n);return t.style.backgroundColor="transparent",t.style.height="auto",t.style.fontStyle="italic",t.style.fontWeight="normal",t.style.padding="0 0 0 3px",t},getSwitcherOptions:function(n){return n.getElementsByTagName("option")},setSwitcherOptions:function(n,t,i){this.setSelectOptions(n,t,i)},setSelectOptions:function(n,t,i){var r,u;for(i=i||[],n.innerHTML="",r=0;r<t.length;r++)u=document.createElement("option"),u.setAttribute("value",t[r]),u.textContent=i[r]||t[r],n.appendChild(u)},getTextareaInput:function(){var n=document.createElement("textarea");return n.style=n.style||{},n.style.width="100%",n.style.height="300px",n.style.boxSizing="border-box",n},getRangeInput:function(n,t,i){var r=this.getFormInputField("range");return r.setAttribute("min",n),r.setAttribute("max",t),r.setAttribute("step",i),r},getFormInputField:function(n){var t=document.createElement("input");return t.setAttribute("type",n),t},afterInputReady:function(){},getFormControl:function(n,t,i){var r=document.createElement("div");return r.className="form-control",n&&r.appendChild(n),t.type==="checkbox"?n.insertBefore(t,n.firstChild):r.appendChild(t),i&&r.appendChild(i),r},getIndentedPanel:function(){var n=document.createElement("div");return n.style=n.style||{},n.style.paddingLeft="10px",n.style.marginLeft="10px",n.style.borderLeft="1px solid #ccc",n},getChildEditorHolder:function(){return document.createElement("div")},getDescription:function(n){var t=document.createElement("p");return t.appendChild(document.createTextNode(n)),t},getCheckboxDescription:function(n){return this.getDescription(n)},getFormInputDescription:function(n){return this.getDescription(n)},getHeaderButtonHolder:function(){return this.getButtonHolder()},getButtonHolder:function(){return document.createElement("div")},getButton:function(n,t,i){var r=document.createElement("button");return this.setButtonText(r,n,t,i),r},setButtonText:function(n,t,i,r){n.innerHTML="";i&&(n.appendChild(i),n.innerHTML+=" ");n.appendChild(document.createTextNode(t));r&&n.setAttribute("title",r)},getTable:function(){return document.createElement("table")},getTableRow:function(){return document.createElement("tr")},getTableHead:function(){return document.createElement("thead")},getTableBody:function(){return document.createElement("tbody")},getTableHeaderCell:function(n){var t=document.createElement("th");return t.textContent=n,t},getTableCell:function(){return document.createElement("td")},getErrorMessage:function(n){var t=document.createElement("p");return t.style=t.style||{},t.style.color="red",t.appendChild(document.createTextNode(n)),t},addInputError:function(){},removeInputError:function(){},addTableRowError:function(){},removeTableRowError:function(){},getTabHolder:function(){var n=document.createElement("div");return n.innerHTML="<div style='float: left; width: 130px;' class='tabs'><\/div><div class='content' style='margin-left: 130px;'><\/div><div style='clear:both;'><\/div>",n},applyStyles:function(n,t){n.style=n.style||{};for(var i in t)t.hasOwnProperty(i)&&(n.style[i]=t[i])},closest:function(n,t){for(var r=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector,i;n&&n!==document;)try{if(i=r.bind(n),i(t))return n;n=n.parentNode}catch(u){return!1}return!1},getTab:function(n){var t=document.createElement("div");return t.appendChild(n),t.style=t.style||{},this.applyStyles(t,{border:"1px solid #ccc",borderWidth:"1px 0 1px 1px",textAlign:"center",lineHeight:"30px",borderRadius:"5px",borderBottomRightRadius:0,borderTopRightRadius:0,fontWeight:"bold",cursor:"pointer"}),t},getTabContentHolder:function(n){return n.children[1]},getTabContent:function(){return this.getIndentedPanel()},markTabActive:function(n){this.applyStyles(n,{opacity:1,background:"white"})},markTabInactive:function(n){this.applyStyles(n,{opacity:.5,background:""})},addTab:function(n,t){n.children[0].appendChild(t)},getBlockLink:function(){var n=document.createElement("a");return n.style.display="block",n},getBlockLinkHolder:function(){return document.createElement("div")},getLinksHolder:function(){return document.createElement("div")},createMediaLink:function(n,t,i){n.appendChild(t);i.style.width="100%";n.appendChild(i)},createImageLink:function(n,t,i){n.appendChild(t);t.appendChild(i)}});n.defaults.themes.bootstrap2=n.AbstractTheme.extend({getRangeInput:function(n,t,i){return this._super(n,t,i)},getGridContainer:function(){var n=document.createElement("div");return n.className="container-fluid",n},getGridRow:function(){var n=document.createElement("div");return n.className="row-fluid",n},getFormInputLabel:function(n){var t=this._super(n);return t.style.display="inline-block",t.style.fontWeight="bold",t},setGridColumnSize:function(n,t){n.className="span"+t},getSelectInput:function(n){var t=this._super(n);return t.style.width="auto",t.style.maxWidth="98%",t},getFormInputField:function(n){var t=this._super(n);return t.style.width="98%",t},afterInputReady:function(n){n.controlgroup||(n.controlgroup=this.closest(n,".control-group"),n.controls=this.closest(n,".controls"),this.closest(n,".compact")&&(n.controlgroup.className=n.controlgroup.className.replace(/control-group/g,"").replace(/[ ]{2,}/g," "),n.controls.className=n.controlgroup.className.replace(/controls/g,"").replace(/[ ]{2,}/g," "),n.style.marginBottom=0))},getIndentedPanel:function(){var n=document.createElement("div");return n.className="well well-small",n},getFormInputDescription:function(n){var t=document.createElement("p");return t.className="help-inline",t.textContent=n,t},getFormControl:function(n,t,i){var u=document.createElement("div"),r;return u.className="control-group",r=document.createElement("div"),r.className="controls",n&&t.getAttribute("type")==="checkbox"?(u.appendChild(r),n.className+=" checkbox",n.appendChild(t),r.appendChild(n),r.style.height="30px"):(n&&(n.className+=" control-label",u.appendChild(n)),r.appendChild(t),u.appendChild(r)),i&&r.appendChild(i),u},getHeaderButtonHolder:function(){var n=this.getButtonHolder();return n.style.marginLeft="10px",n},getButtonHolder:function(){var n=document.createElement("div");return n.className="btn-group",n},getButton:function(n,t,i){var r=this._super(n,t,i);return r.className+=" btn btn-default",r},getTable:function(){var n=document.createElement("table");return n.className="table table-bordered",n.style.width="auto",n.style.maxWidth="none",n},addInputError:function(n,t){n.controlgroup&&n.controls&&(n.controlgroup.className+=" error",n.errmsg?n.errmsg.style.display="":(n.errmsg=document.createElement("p"),n.errmsg.className="help-block errormsg",n.controls.appendChild(n.errmsg)),n.errmsg.textContent=t)},removeInputError:function(n){n.errmsg&&(n.errmsg.style.display="none",n.controlgroup.className=n.controlgroup.className.replace(/\s?error/g,""))},getTabHolder:function(){var n=document.createElement("div");return n.className="tabbable tabs-left",n.innerHTML="<ul class='nav nav-tabs span2' style='margin-right: 0;'><\/ul><div class='tab-content span10' style='overflow:visible;'><\/div>",n},getTab:function(n){var i=document.createElement("li"),t=document.createElement("a");return t.setAttribute("href","#"),t.appendChild(n),i.appendChild(t),i},getTabContentHolder:function(n){return n.children[1]},getTabContent:function(){var n=document.createElement("div");return n.className="tab-pane active",n},markTabActive:function(n){n.className+=" active"},markTabInactive:function(n){n.className=n.className.replace(/\s?active/g,"")},addTab:function(n,t){n.children[0].appendChild(t)}});n.defaults.themes.bootstrap3=n.AbstractTheme.extend({getSelectInput:function(n){var t=this._super(n);return t.className+="form-control",t},setGridColumnSize:function(n,t){n.className="col-md-"+t},afterInputReady:function(n){n.controlgroup||(n.controlgroup=this.closest(n,".form-group"),this.closest(n,".compact")&&(n.controlgroup.style.marginBottom=0))},getTextareaInput:function(){var n=document.createElement("textarea");return n.className="form-control",n},getRangeInput:function(n,t,i){return this._super(n,t,i)},getFormInputField:function(n){var t=this._super(n);return n!=="checkbox"&&(t.className+="form-control"),t},getFormControl:function(n,t,i){var r=document.createElement("div");return n&&t.type==="checkbox"?(r.className+=" checkbox",n.appendChild(t),n.style.fontSize="14px",r.style.marginTop="0",r.appendChild(n)):(r.className+=" form-group",n&&(n.className+=" control-label",r.appendChild(n)),r.appendChild(t)),i&&r.appendChild(i),r},getIndentedPanel:function(){var n=document.createElement("div");return n.className="well well-sm",n},getFormInputDescription:function(n){var t=document.createElement("p");return t.className="help-block",t.textContent=n,t},getHeaderButtonHolder:function(){var n=this.getButtonHolder();return n.style.marginLeft="10px",n},getButtonHolder:function(){var n=document.createElement("div");return n.className="btn-group",n},getButton:function(n,t,i){var r=this._super(n,t,i);return r.className+="btn btn-default",r},getTable:function(){var n=document.createElement("table");return n.className="table table-bordered",n.style.width="auto",n.style.maxWidth="none",n},addInputError:function(n,t){n.controlgroup&&(n.controlgroup.className+=" has-error",n.errmsg?n.errmsg.style.display="":(n.errmsg=document.createElement("p"),n.errmsg.className="help-block errormsg",n.controlgroup.appendChild(n.errmsg)),n.errmsg.textContent=t)},removeInputError:function(n){n.errmsg&&(n.errmsg.style.display="none",n.controlgroup.className=n.controlgroup.className.replace(/\s?has-error/g,""))},getTabHolder:function(){var n=document.createElement("div");return n.innerHTML="<div class='tabs list-group col-md-2'><\/div><div class='col-md-10'><\/div>",n.className="rows",n},getTab:function(n){var t=document.createElement("a");return t.className="list-group-item",t.setAttribute("href","#"),t.appendChild(n),t},markTabActive:function(n){n.className+=" active"},markTabInactive:function(n){n.className=n.className.replace(/\s?active/g,"")}});n.defaults.themes.foundation=n.AbstractTheme.extend({getChildEditorHolder:function(){var n=document.createElement("div");return n.style.marginBottom="15px",n},getSelectInput:function(n){var t=this._super(n);return t.style.minWidth="none",t.style.padding="5px",t.style.marginTop="3px",t},getSwitcher:function(n){var t=this._super(n);return t.style.paddingRight="8px",t},afterInputReady:function(n){this.closest(n,".compact")&&(n.style.marginBottom=0);n.group=this.closest(n,".form-control")},getFormInputLabel:function(n){var t=this._super(n);return t.style.display="inline-block",t},getFormInputField:function(n){var t=this._super(n);return t.style.width="100%",t.style.marginBottom=n==="checkbox"?"0":"12px",t},getFormInputDescription:function(n){var t=document.createElement("p");return t.textContent=n,t.style.marginTop="-10px",t.style.fontStyle="italic",t},getIndentedPanel:function(){var n=document.createElement("div");return n.className="panel",n},getHeaderButtonHolder:function(){var n=this.getButtonHolder();return n.style.display="inline-block",n.style.marginLeft="10px",n.style.verticalAlign="middle",n},getButtonHolder:function(){var n=document.createElement("div");return n.className="button-group",n},getButton:function(n,t,i){var r=this._super(n,t,i);return r.className+=" small button",r},addInputError:function(n,t){n.group&&(n.group.className+=" error",n.errmsg?n.errmsg.style.display="":(n.insertAdjacentHTML("afterend",'<small class="errormsg"><\/small>'),n.errmsg=n.parentNode.getElementsByClassName("errormsg")[0]),n.errmsg.textContent=t)},removeInputError:function(n){n.errmsg&&(n.group.className=n.group.className.replace(/ error/g,""),n.errmsg.style.display="none")}});n.defaults.themes.foundation3=n.defaults.themes.foundation.extend({getHeaderButtonHolder:function(){var n=this._super();return n.style.fontSize=".6em",n},getFormInputLabel:function(n){var t=this._super(n);return t.style.fontWeight="bold",t},getTabHolder:function(){var n=document.createElement("div");return n.className="row",n.innerHTML="<dl class='tabs vertical two columns'><\/dl><div class='tabs-content ten columns'><\/div>",n},setGridColumnSize:function(n,t){n.className="columns "+["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"][t]},getTab:function(n){var i=document.createElement("dd"),t=document.createElement("a");return t.setAttribute("href","#"),t.appendChild(n),i.appendChild(t),i},getTabContentHolder:function(n){return n.children[1]},getTabContent:function(){var n=document.createElement("div");return n.className="content active",n.style.paddingLeft="5px",n},markTabActive:function(n){n.className+=" active"},markTabInactive:function(n){n.className=n.className.replace(/\s*active/g,"")},addTab:function(n,t){n.children[0].appendChild(t)}});n.defaults.themes.foundation4=n.defaults.themes.foundation.extend({getHeaderButtonHolder:function(){var n=this._super();return n.style.fontSize=".6em",n},setGridColumnSize:function(n,t){n.className="columns large-"+t},getFormInputDescription:function(n){var t=this._super(n);return t.style.fontSize=".8rem",t},getFormInputLabel:function(n){var t=this._super(n);return t.style.fontWeight="bold",t}});n.defaults.themes.foundation5=n.defaults.themes.foundation.extend({getFormInputDescription:function(n){var t=this._super(n);return t.style.fontSize=".8rem",t},setGridColumnSize:function(n,t){n.className="columns medium-"+t},getButton:function(n,t,i){var r=this._super(n,t,i);return r.className=r.className.replace(/\s*small/g,"")+" tiny",r},getTabHolder:function(){var n=document.createElement("div");return n.innerHTML="<dl class='tabs vertical'><\/dl><div class='tabs-content'><\/div>",n},getTab:function(n){var i=document.createElement("dd"),t=document.createElement("a");return t.setAttribute("href","#"),t.appendChild(n),i.appendChild(t),i},getTabContentHolder:function(n){return n.children[1]},getTabContent:function(){var n=document.createElement("div");return n.className="content active",n.style.paddingLeft="5px",n},markTabActive:function(n){n.className+=" active"},markTabInactive:function(n){n.className=n.className.replace(/\s*active/g,"")},addTab:function(n,t){n.children[0].appendChild(t)}});n.defaults.themes.html=n.AbstractTheme.extend({getFormInputLabel:function(n){var t=this._super(n);return t.style.display="block",t.style.marginBottom="3px",t.style.fontWeight="bold",t},getFormInputDescription:function(n){var t=this._super(n);return t.style.fontSize=".8em",t.style.margin=0,t.style.display="inline-block",t.style.fontStyle="italic",t},getIndentedPanel:function(){var n=this._super();return n.style.border="1px solid #ddd",n.style.padding="5px",n.style.margin="5px",n.style.borderRadius="3px",n},getChildEditorHolder:function(){var n=this._super();return n.style.marginBottom="8px",n},getHeaderButtonHolder:function(){var n=this.getButtonHolder();return n.style.display="inline-block",n.style.marginLeft="10px",n.style.fontSize=".8em",n.style.verticalAlign="middle",n},getTable:function(){var n=this._super();return n.style.borderBottom="1px solid #ccc",n.style.marginBottom="5px",n},addInputError:function(n,t){if(n.style.borderColor="red",n.errmsg)n.errmsg.style.display="block";else{var i=this.closest(n,".form-control");n.errmsg=document.createElement("div");n.errmsg.setAttribute("class","errmsg");n.errmsg.style=n.errmsg.style||{};n.errmsg.style.color="red";i.appendChild(n.errmsg)}n.errmsg.innerHTML="";n.errmsg.appendChild(document.createTextNode(t))},removeInputError:function(n){n.style.borderColor="";n.errmsg&&(n.errmsg.style.display="none")}});n.defaults.themes.jqueryui=n.AbstractTheme.extend({getTable:function(){var n=this._super();return n.setAttribute("cellpadding",5),n.setAttribute("cellspacing",0),n},getTableHeaderCell:function(n){var t=this._super(n);return t.className="ui-state-active",t.style.fontWeight="bold",t},getTableCell:function(){var n=this._super();return n.className="ui-widget-content",n},getHeaderButtonHolder:function(){var n=this.getButtonHolder();return n.style.marginLeft="10px",n.style.fontSize=".6em",n.style.display="inline-block",n},getFormInputDescription:function(n){var t=this.getDescription(n);return t.style.marginLeft="10px",t.style.display="inline-block",t},getFormControl:function(n,t,i){var r=this._super(n,t,i);return t.type==="checkbox"?(r.style.lineHeight="25px",r.style.padding="3px 0"):r.style.padding="4px 0 8px 0",r},getDescription:function(n){var t=document.createElement("span");return t.style.fontSize=".8em",t.style.fontStyle="italic",t.textContent=n,t},getButtonHolder:function(){var n=document.createElement("div");return n.className="ui-buttonset",n.style.fontSize=".7em",n},getFormInputLabel:function(n){var t=document.createElement("label");return t.style.fontWeight="bold",t.style.display="block",t.textContent=n,t},getButton:function(n,t,i){var r=document.createElement("button"),u;return r.className="ui-button ui-widget ui-state-default ui-corner-all",t&&!n?(r.className+=" ui-button-icon-only",t.className+=" ui-button-icon-primary ui-icon-primary",r.appendChild(t)):t?(r.className+=" ui-button-text-icon-primary",t.className+=" ui-button-icon-primary ui-icon-primary",r.appendChild(t)):r.className+=" ui-button-text-only",u=document.createElement("span"),u.className="ui-button-text",u.textContent=n||i||".",r.appendChild(u),r.setAttribute("title",i),r},setButtonText:function(n,t,i,r){n.innerHTML="";n.className="ui-button ui-widget ui-state-default ui-corner-all";i&&!t?(n.className+=" ui-button-icon-only",i.className+=" ui-button-icon-primary ui-icon-primary",n.appendChild(i)):i?(n.className+=" ui-button-text-icon-primary",i.className+=" ui-button-icon-primary ui-icon-primary",n.appendChild(i)):n.className+=" ui-button-text-only";var u=document.createElement("span");u.className="ui-button-text";u.textContent=t||r||".";n.appendChild(u);n.setAttribute("title",r)},getIndentedPanel:function(){var n=document.createElement("div");return n.className="ui-widget-content ui-corner-all",n.style.padding="1em 1.4em",n.style.marginBottom="20px",n},afterInputReady:function(n){n.controls||(n.controls=this.closest(n,".form-control"))},addInputError:function(n,t){n.controls&&(n.errmsg?n.errmsg.style.display="":(n.errmsg=document.createElement("div"),n.errmsg.className="ui-state-error",n.controls.appendChild(n.errmsg)),n.errmsg.textContent=t)},removeInputError:function(n){n.errmsg&&(n.errmsg.style.display="none")},markTabActive:function(n){n.className=n.className.replace(/\s*ui-widget-header/g,"")+" ui-state-active"},markTabInactive:function(n){n.className=n.className.replace(/\s*ui-state-active/g,"")+" ui-widget-header"}});n.AbstractIconLib=Class.extend({mapping:{collapse:"",expand:"","delete":"",edit:"",add:"",cancel:"",save:"",moveup:"",movedown:""},icon_prefix:"",getIconClass:function(n){return this.mapping[n]?this.icon_prefix+this.mapping[n]:null},getIcon:function(n){var i=this.getIconClass(n),t;return i?(t=document.createElement("i"),t.className=i,t):null}});n.defaults.iconlibs.bootstrap2=n.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-up","delete":"trash",edit:"pencil",add:"plus",cancel:"ban-circle",save:"ok",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"icon-"});n.defaults.iconlibs.bootstrap3=n.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-right","delete":"remove",edit:"pencil",add:"plus",cancel:"floppy-remove",save:"floppy-saved",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"glyphicon glyphicon-"});n.defaults.iconlibs.fontawesome3=n.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-right","delete":"remove",edit:"pencil",add:"plus",cancel:"ban-circle",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"icon-"});n.defaults.iconlibs.fontawesome4=n.AbstractIconLib.extend({mapping:{collapse:"caret-square-o-down",expand:"caret-square-o-right","delete":"times",edit:"pencil",add:"plus",cancel:"ban",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"fa fa-"});n.defaults.iconlibs.foundation2=n.AbstractIconLib.extend({mapping:{collapse:"minus",expand:"plus","delete":"remove",edit:"edit",add:"add-doc",cancel:"error",save:"checkmark",moveup:"up-arrow",movedown:"down-arrow"},icon_prefix:"foundicon-"});n.defaults.iconlibs.foundation3=n.AbstractIconLib.extend({mapping:{collapse:"minus",expand:"plus","delete":"x",edit:"pencil",add:"page-add",cancel:"x-circle",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"fi-"});n.defaults.iconlibs.jqueryui=n.AbstractIconLib.extend({mapping:{collapse:"triangle-1-s",expand:"triangle-1-e","delete":"trash",edit:"pencil",add:"plusthick",cancel:"closethick",save:"disk",moveup:"arrowthick-1-n",movedown:"arrowthick-1-s"},icon_prefix:"ui-icon ui-icon-"});n.defaults.templates.default=function(){var n=function(r){var u={};return t(r,function(r,f){if(typeof f=="object"&&f!==null){var e={};t(f,function(n,t){e[r+"."+n]=t});i(u,n(e))}else u[r]=f}),u};return{compile:function(i){return function(r){var f=n(r),u=i+"";return t(f,function(n,t){u=u.replace(new RegExp("{{\\s*"+n+"\\s*}}","g"),t)}),u}}}};n.defaults.templates.ejs=function(){return window.EJS?{compile:function(n){var t=new EJS({text:n});return function(n){return t.render(n)}}}:!1};n.defaults.templates.handlebars=function(){return window.Handlebars};n.defaults.templates.hogan=function(){return window.Hogan?{compile:function(n){var t=Hogan.compile(n);return function(n){return t.render(n)}}}:!1};n.defaults.templates.markup=function(){return!window.Mark||!window.Mark.up?!1:{compile:function(n){return function(t){return Mark.up(n,t)}}}};n.defaults.templates.mustache=function(){return window.Mustache?{compile:function(n){return function(t){return Mustache.render(n,t)}}}:!1};n.defaults.templates.swig=function(){return window.swig};n.defaults.templates.underscore=function(){return window._?{compile:function(n){return function(t){return _.template(n,t)}}}:!1};n.defaults.theme="html";n.defaults.template="default";n.defaults.options={};n.plugins={ace:{theme:""},epiceditor:{},sceditor:{}};for(u in n.defaults.editors)n.defaults.editors.hasOwnProperty(u)&&(n.defaults.editors[u].options=n.defaults.editors.options||{});n.defaults.resolvers.unshift(function(n){if(typeof n.type!="string")return"multiple"});n.defaults.resolvers.unshift(function(n){if(typeof n.type=="string")return n.type});n.defaults.resolvers.unshift(function(n){if(n.type==="boolean")return"select"});n.defaults.resolvers.unshift(function(n){if(n.type==="any")return"multiple"});n.defaults.resolvers.unshift(function(n){if(n.type==="string"&&n.media&&n.media.binaryEncoding==="base64")return"base64"});n.defaults.resolvers.unshift(function(n){if(n.type=="array"&&n.format=="table")return"table"});n.defaults.resolvers.unshift(function(n){if(n.enum){if(n.type==="array"||n.type==="object")return"enum";if(n.type==="number"||n.type==="integer"||n.type==="string")return"select"}});n.defaults.resolvers.unshift(function(n){if(n.type==="array"&&n.items&&!(n.items instanceof Array)&&n.uniqueItems&&n.items.enum&&["string","number","integer"].indexOf(n.items.type)>=0)return"multiselect"});n.defaults.resolvers.unshift(function(n){if(n.oneOf)return"multiple"});(window.jQuery||window.Zepto)&&(window.$=window.$||{},$.jsoneditor=n.defaults,(window.jQuery||window.Zepto).fn.jsoneditor=function(t){var r=this,i=this.data("jsoneditor");if(t==="value"){if(!i)throw"Must initialize jsoneditor before getting/setting the value";if(arguments.length>1)i.setValue(arguments[1]);else return i.getValue()}else{if(t==="validate"){if(!i)throw"Must initialize jsoneditor before validating";return arguments.length>1?i.validate(arguments[1]):i.validate()}if(t==="destroy")i&&(i.destroy(),this.data("jsoneditor",null));else{i&&i.destroy();i=new n(this.get(0),t);this.data("jsoneditor",i);i.on("change",function(){r.trigger("change")});i.on("ready",function(){r.trigger("ready")})}}return this});window.JSONEditor=n})();!function(){function gi(n,t){return t>n?-1:n>t?1:n>=t?0:NaN}function au(n){return null!=n&&!isNaN(n)}function ul(n){return{left:function(t,i,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var f=r+u>>>1;n(t[f],i)<0?r=f+1:u=f}return r},right:function(t,i,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var f=r+u>>>1;n(t[f],i)>0?u=f:r=f+1}return r}}}function nk(n){return n.length}function tk(n){for(var t=1;n*t%1;)t*=10;return t}function fl(n,t){try{for(var i in t)Object.defineProperty(n.prototype,i,{value:t[i],enumerable:!1})}catch(r){n.prototype=t}}function et(){}function el(n){return ti+n in this}function ik(n){return n=ti+n,n in this&&delete this[n]}function ol(){var n=[];return this.forEach(function(t){n.push(t)}),n}function sl(){var n=0;for(var t in this)t.charCodeAt(0)===uu&&++n;return n}function hl(){for(var n in this)if(n.charCodeAt(0)===uu)return!1;return!0}function io(){}function rk(n,t,i){return function(){var r=i.apply(t,arguments);return r===t?n:r}}function ro(n,t){var i,u,r;if(t in n)return t;for(t=t.charAt(0).toUpperCase()+t.substring(1),i=0,u=ph.length;u>i;++i)if(r=ph[i]+t,r in n)return r}function c(){}function uo(){}function cl(n){function r(){for(var i,r=t,u=-1,f=r.length;++u<f;)(i=r[u].on)&&i.apply(this,arguments);return n}var t=[],i=new et;return r.on=function(r,u){var e,f=i.get(r);return arguments.length<2?f&&f.on:(f&&(f.on=null,t=t.slice(0,e=t.indexOf(f)).concat(t.slice(e+1)),i.remove(r)),u&&t.push(i.set(r,{on:u})),n)},r}function bt(){n.event.preventDefault()}function fo(){for(var i,t=n.event;i=t.sourceEvent;)t=i;return t}function eo(t){for(var i=new uo,r=0,u=arguments.length;++r<u;)i[arguments[r]]=cl(i);return i.of=function(r,u){return function(f){try{var e=f.sourceEvent=n.event;f.target=t;n.event=f;i[f.type].apply(r,u)}finally{n.event=e}}},i}function kt(n){return kf(n,e),n}function oo(n){return"function"==typeof n?n:function(){return wh(n,this)}}function ll(n){return"function"==typeof n?n:function(){return bh(n,this)}}function al(t,i){function r(){this.removeAttribute(t)}function u(){this.removeAttributeNS(t.space,t.local)}function f(){this.setAttribute(t,i)}function e(){this.setAttributeNS(t.space,t.local,i)}function o(){var n=i.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=i.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=n.ns.qualify(t),null==i?t.local?u:r:"function"==typeof i?t.local?s:o:t.local?e:f}function vl(n){return n.trim().replace(/\s+/g," ")}function yl(t){return new RegExp("(?:^|\\s+)"+n.requote(t)+"(?:\\s+|$)","g")}function pl(n){return(n+"").trim().split(/^|\s+/)}function wl(n,t){function r(){for(var r=-1;++r<i;)n[r](this,t)}function u(){for(var r=-1,u=t.apply(this,arguments);++r<i;)n[r](this,u)}n=pl(n).map(uk);var i=n.length;return"function"==typeof t?u:r}function uk(n){var t=yl(n);return function(i,r){if(u=i.classList)return r?u.add(n):u.remove(n);var u=i.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||i.setAttribute("class",vl(u+" "+n))):i.setAttribute("class",vl(u.replace(t," ")))}}function bl(n,t,i){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,i)}function f(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,i)}return null==t?r:"function"==typeof t?f:u}function kl(n,t){function i(){delete this[n]}function r(){this[n]=t}function u(){var i=t.apply(this,arguments);null==i?delete this[n]:this[n]=i}return null==t?i:"function"==typeof t?u:r}function dl(t){return"function"==typeof t?t:(t=n.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function so(n){return{__data__:n}}function gl(n){return function(){return yw(this,n)}}function fk(n){return arguments.length||(n=gi),function(t,i){return t&&i?n(t.__data__,i.__data__):!t-!i}}function dt(n,t){for(var i=0,u=n.length;u>i;i++)for(var f,e=n[i],r=0,o=e.length;o>r;r++)(f=e[r])&&t(f,r,i);return n}function na(n){return kf(n,ht),n}function ek(n){var t,i;return function(r,u,f){var e,o=n[f].update,s=o.length;for(f!=i&&(i=f,t=0),u>=t&&(t=u+1);!(e=o[t])&&++t<s;);return e}}function vu(){var n=this.__transition__;n&&++n.active}function ta(t,i,r){function o(){var n=this[u];n&&(this.removeEventListener(t,n,n.$),delete this[u])}function h(){var n=s(i,ni(arguments));o.call(this);this.addEventListener(t,this[u]=n,n.$=r);n._=i}function l(){var u,f=new RegExp("^__on([^.]+)"+n.requote(t)+"$"),i,r;for(i in this)(u=i.match(f))&&(r=this[i],this.removeEventListener(u[1],r,r.$),delete this[i])}var u="__on"+t,f=t.indexOf("."),s=ia,e;return f>0&&(t=t.substring(0,f)),e=gf.get(t),e&&(t=e,s=ok),f?i?h:o:i?c:l}function ia(t,i){return function(r){var u=n.event;n.event=r;i[0]=this.__data__;try{t.apply(this,i)}finally{n.event=u}}}function ok(n,t){var i=ia(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||i.call(t,n)}}function yu(){var t=".dragsuppress-"+ ++pw,u="click"+t,r=n.select(w).on("touchmove"+t,bt).on("dragstart"+t,bt).on("selectstart"+t,bt),i,f;return sr&&(i=yt.style,f=i[sr],i[sr]="none"),function(n){function e(){r.on(u,null)}r.on(t,null);sr&&(i[sr]=f);n&&(r.on(u,function(){bt();e()},!0),setTimeout(e,0))}}function ho(t,i){var u,r,f,e;return(i.changedTouches&&(i=i.changedTouches[0]),u=t.ownerSVGElement||t,u.createSVGPoint)?(r=u.createSVGPoint(),0>ne&&(w.scrollX||w.scrollY)&&(u=n.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"),f=u[0][0].getScreenCTM(),ne=!(f.f||f.e),u.remove()),ne?(r.x=i.pageX,r.y=i.pageY):(r.x=i.clientX,r.y=i.clientY),r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]):(e=t.getBoundingClientRect(),[i.clientX-e.left-t.clientLeft,i.clientY-e.top-t.clientTop])}function sk(){return n.event.changedTouches[0].identifier}function hk(){return n.event.target}function ck(){return w}function ra(n){return n>0?1:0>n?-1:0}function co(n,t,i){return(t[0]-n[0])*(i[1]-n[1])-(t[1]-n[1])*(i[0]-n[0])}function ua(n){return n>1?0:-1>n?f:Math.acos(n)}function nr(n){return n>1?v:-1>n?-v:Math.asin(n)}function lk(n){return((n=Math.exp(n))-1/n)/2}function fa(n){return((n=Math.exp(n))+1/n)/2}function ak(n){return((n=Math.exp(2*n))-1)/(n+1)}function ea(n){return(n=Math.sin(n/2))*n}function hi(){}function ot(n,t,i){return this instanceof ot?(this.h=+n,this.s=+t,void(this.l=+i)):arguments.length<2?n instanceof ot?new ot(n.h,n.s,n.l):ca(""+n,la,ot):new ot(n,t,i)}function lo(n,t,i){function e(n){return n>360?n-=360:0>n&&(n+=360),60>n?r+(u-r)*n/60:180>n?u:240>n?r+(u-r)*(240-n)/60:r}function f(n){return Math.round(255*e(n))}var r,u;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,i=0>i?0:i>1?1:i,u=.5>=i?i*(1+t):i+t-i*t,r=2*i-u,new b(f(n+120),f(n),f(n-120))}function tt(t,i,r){return this instanceof tt?(this.h=+t,this.c=+i,void(this.l=+r)):arguments.length<2?t instanceof tt?new tt(t.h,t.c,t.l):t instanceof it?sa(t.l,t.a,t.b):sa((t=aa((t=n.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new tt(t,i,r)}function ao(n,t,i){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new it(i,Math.cos(n*=u)*t,Math.sin(n)*t)}function it(n,t,i){return this instanceof it?(this.l=+n,this.a=+t,void(this.b=+i)):arguments.length<2?n instanceof it?new it(n.l,n.a,n.b):n instanceof tt?ao(n.l,n.c,n.h):aa((n=b(n)).r,n.g,n.b):new it(n,t,i)}function oa(n,t,i){var r=(n+16)/116,u=r+t/500,f=r-i/200;return u=vo(u)*kw,r=vo(r)*dw,f=vo(f)*gw,new b(po(3.2404542*u-1.5371385*r-.4985314*f),po(-.969266*u+1.8760108*r+.041556*f),po(.0556434*u-.2040259*r+1.0572252*f))}function sa(n,t,i){return n>0?new tt(Math.atan2(i,t)*s,Math.sqrt(t*t+i*i),n):new tt(NaN,NaN,n)}function vo(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function yo(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function po(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function b(n,t,i){return this instanceof b?(this.r=~~n,this.g=~~t,void(this.b=~~i)):arguments.length<2?n instanceof b?new b(n.r,n.g,n.b):ca(""+n,b,lo):new b(n,t,i)}function ha(n){return new b(n>>16,255&n>>8,255&n)}function pu(n){return ha(n)+""}function tr(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function ca(n,t,i){var s,u,r,f=0,e=0,o=0;if(s=/([a-z]+)\((.*)\)/i.exec(n))switch(u=s[2].split(","),s[1]){case"hsl":return i(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(bo(u[0]),bo(u[1]),bo(u[2]))}return(r=eu.get(n))?t(r.r,r.g,r.b):(null==n||"#"!==n.charAt(0)||isNaN(r=parseInt(n.substring(1),16))||(4===n.length?(f=(3840&r)>>4,f=f>>4|f,e=240&r,e=e>>4|e,o=15&r,o=o<<4|o):7===n.length&&(f=(16711680&r)>>16,e=(65280&r)>>8,o=255&r)),t(f,e,o))}function la(n,t,i){var f,s,e=Math.min(n/=255,t/=255,i/=255),r=Math.max(n,t,i),u=r-e,o=(r+e)/2;return u?(s=.5>o?u/(r+e):u/(2-r-e),f=n==r?(t-i)/u+(i>t?6:0):t==r?(i-n)/u+2:(n-t)/u+4,f*=60):(f=NaN,s=o>0&&1>o?0:f),new ot(f,s,o)}function aa(n,t,i){n=wo(n);t=wo(t);i=wo(i);var u=yo((.4124564*n+.3575761*t+.1804375*i)/kw),r=yo((.2126729*n+.7151522*t+.072175*i)/dw),f=yo((.0193339*n+.119192*t+.9503041*i)/gw);return it(116*r-16,500*(u-r),200*(r-f))}function wo(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function bo(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function o(n){return"function"==typeof n?n:function(){return n}}function a(n){return n}function ko(n){return function(t,i,r){return 2===arguments.length&&"function"==typeof i&&(r=i,i=null),wu(t,i,n,r)}}function wu(t,i,r,u){function c(){var t,n=e.status;if(!n&&e.responseText||n>=200&&300>n||304===n){try{t=r.call(f,e)}catch(i){return s.error.call(f,i),void 0}s.load.call(f,t)}else s.error.call(f,e)}var f={},s=n.dispatch("beforesend","progress","load","error"),o={},e=new XMLHttpRequest,h=null;return!w.XDomainRequest||"withCredentials"in e||!/^(http(s)?:)?\/\//.test(t)||(e=new XDomainRequest),"onload"in e?e.onload=e.onerror=c:e.onreadystatechange=function(){e.readyState>3&&c()},e.onprogress=function(t){var i=n.event;n.event=t;try{s.progress.call(f,e)}finally{n.event=i}},f.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?o[n]:(null==t?delete o[n]:o[n]=t+"",f)},f.mimeType=function(n){return arguments.length?(i=null==n?null:n+"",f):i},f.responseType=function(n){return arguments.length?(h=n,f):h},f.response=function(n){return r=n,f},["get","post"].forEach(function(n){f[n]=function(){return f.send.apply(f,[n].concat(ni(arguments)))}}),f.send=function(n,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),e.open(n,t,!0),null==i||"accept"in o||(o.accept=i+",*/*"),e.setRequestHeader)for(var c in o)e.setRequestHeader(c,o[c]);return null!=i&&e.overrideMimeType&&e.overrideMimeType(i),null!=h&&(e.responseType=h),null!=u&&f.on("error",u).on("load",function(n){u(null,n)}),s.beforesend.call(f,e),e.send(null==r?null:r),f},f.abort=function(){return e.abort(),f},n.rebind(f,s,"on"),null==u?f:f.get(vk(u))}function vk(n){return 1===n.length?function(t,i){n(null==t?i:null)}:n}function go(){var t=va(),n=ya()-t;n>24?(isFinite(n)&&(clearTimeout(he),he=setTimeout(go,n)),se=0):(se=1,ic(go))}function va(){var n=Date.now();for(pt=ee;pt;)n>=pt.t&&(pt.f=pt.c(n-pt.t)),pt=pt.n;return n}function ya(){for(var t,n=ee,i=1/0;n;)n.f?n=t?t.n=n.n:ee=n.n:(n.t<i&&(i=n.t),n=(t=n).n);return oe=t,i}function ns(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function yk(n,t){var i=Math.pow(10,3*r(8-t));return{scale:t>8?function(n){return n/i}:function(n){return n*i},symbol:n}}function pk(t){var f=t.decimal,e=t.thousands,i=t.grouping,r=t.currency,u=i?function(n){for(var r=n.length,u=[],f=0,t=i[0];r>0&&t>0;)u.push(n.substring(r-=t,r+t)),t=i[f=(f+1)%i.length];return u.reverse().join(e)}:a;return function(t){var o=tb.exec(t),w=o[1]||" ",s=o[2]||">",d=o[3]||"",b=o[4]||"",l=o[5],a=+o[6],v=o[7],e=o[8],i=o[9],h=1,y="",c="",k=!1,p;switch(e&&(e=+e.substring(1)),(l||"0"===w&&"="===s)&&(l=w="0",s="=",v&&(a-=Math.floor((a-1)/4))),i){case"n":v=!0;i="g";break;case"%":h=100;c="%";i="f";break;case"p":h=100;c="%";i="r";break;case"b":case"o":case"x":case"X":"#"===b&&(y="0"+i.toLowerCase());case"c":case"d":k=!0;e=0;break;case"s":h=-1;i="r"}return"$"===b&&(y=r[0],c=r[1]),"r"!=i||e||(i="g"),null!=e&&("g"==i?e=Math.max(1,Math.min(21,e)):("e"==i||"f"==i)&&(e=Math.max(0,Math.min(20,e)))),i=lrt.get(i)||wk,p=l&&v,function(t){var it=c,r,tt,g,o;if(k&&t%1)return"";r=0>t||0===t&&0>1/t?(t=-t,"-"):d;0>h?(tt=n.formatPrefix(t,e),t=tt.scale(t),it=tt.symbol+c):t*=h;t=i(t,e);var nt=t.lastIndexOf("."),b=0>nt?t:t.substring(0,nt),rt=0>nt?"":f+t.substring(nt+1);return!l&&v&&(b=u(b)),g=y.length+b.length+rt.length+(p?0:r.length),o=a>g?new Array(g=a-g+1).join(w):"",p&&(b=u(o+b)),r+=y,t=b+rt,("<"===s?r+t+o:">"===s?o+r+t:"^"===s?o.substring(0,g>>=1)+r+t+o.substring(g):r+(p?t:o+t))+it}}}function wk(n){return n+""}function at(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function ci(n,t,i){function e(t){var i=n(t),r=f(i,1);return r-t>t-i?i:r}function u(i){return t(i=n(new y(i-1)),1),i}function f(n,i){return t(n=new y(+n),i),n}function o(n,r,f){var e=u(n),o=[];if(f>1)for(;r>e;)i(e)%f||o.push(new Date(+e)),t(e,1);else for(;r>e;)o.push(new Date(+e)),t(e,1);return o}function s(n,t,i){try{y=at;var r=new at;return r._=n,o(r,t,i)}finally{y=Date}}n.floor=n;n.round=e;n.ceil=u;n.offset=f;n.range=o;var r=n.utc=bu(n);return r.floor=r,r.round=bu(e),r.ceil=bu(u),r.offset=bu(f),r.range=s,n}function bu(n){return function(t,i){try{y=at;var r=new at;return r._=t,n(r,i)._}finally{y=Date}}}function bk(t){function r(n){function t(t){for(var f,o,h,e=[],r=-1,s=0;++r<i;)37===n.charCodeAt(r)&&(e.push(n.substring(s,r)),null!=(o=ib[f=n.charAt(++r)])&&(f=n.charAt(++r)),(h=u[f])&&(f=h(t,null==o?"e"===f?" ":"0":o)),e.push(f),s=r+1);return e.push(n.substring(s,r)),e.join("")}var i=n.length;return t.parse=function(t){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},e=f(i,n,t,0),u,r;return e!=t.length?null:("p"in i&&(i.H=i.H%12+12*i.p),u=null!=i.Z&&y!==at,r=new(u?at:y),"j"in i?r.setFullYear(i.y,0,i.j):"w"in i&&("W"in i||"U"in i)?(r.setFullYear(i.y,0,1),r.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(r.getDay()+5)%7:i.w+7*i.U-(r.getDay()+6)%7)):r.setFullYear(i.y,i.m,i.d),r.setHours(i.H+Math.floor(i.Z/100),i.M+i.Z%100,i.S,i.L),u?r._:r)},t.toString=function(){return n},t}function f(n,t,i,r){for(var f,e,o,u=0,s=t.length,h=i.length;s>u;){if(r>=h)return-1;if(f=t.charCodeAt(u++),37===f){if(o=t.charAt(u++),e=k[o in ib?t.charAt(u++):o],!e||(r=e(n,i,r))<0)return-1}else if(f!=i.charCodeAt(r++))return-1}return r}function d(n,t,i){v.lastIndex=0;var r=v.exec(t.substring(i));return r?(n.w=ct.get(r[0].toLowerCase()),i+r[0].length):-1}function g(n,t,i){a.lastIndex=0;var r=a.exec(t.substring(i));return r?(n.w=ht.get(r[0].toLowerCase()),i+r[0].length):-1}function nt(n,t,i){b.lastIndex=0;var r=b.exec(t.substring(i));return r?(n.m=vt.get(r[0].toLowerCase()),i+r[0].length):-1}function tt(n,t,i){w.lastIndex=0;var r=w.exec(t.substring(i));return r?(n.m=lt.get(r[0].toLowerCase()),i+r[0].length):-1}function it(n,t,i){return f(n,u.c.toString(),t,i)}function rt(n,t,i){return f(n,u.x.toString(),t,i)}function ut(n,t,i){return f(n,u.X.toString(),t,i)}function ft(n,t,i){var r=l.get(t.substring(i,i+=2).toLowerCase());return null==r?-1:(n.p=r,i)}var et=t.dateTime,ot=t.date,st=t.time,c=t.periods,e=t.days,o=t.shortDays,s=t.months,h=t.shortMonths,u,k;r.utc=function(n){function t(n){try{y=at;var t=new y;return t._=n,i(t)}finally{y=Date}}var i=r(n);return t.parse=function(n){try{y=at;var t=i.parse(n);return t&&t._}finally{y=Date}},t.toString=i.toString,t};r.multi=r.utc.multi=ld;var l=n.map(),a=ku(e),ht=du(e),v=ku(o),ct=du(o),w=ku(s),lt=du(s),b=ku(h),vt=du(h);return c.forEach(function(n,t){l.set(n.toLowerCase(),t)}),u={a:function(n){return o[n.getDay()]},A:function(n){return e[n.getDay()]},b:function(n){return h[n.getMonth()]},B:function(n){return s[n.getMonth()]},c:r(et),d:function(n,t){return p(n.getDate(),t,2)},e:function(n,t){return p(n.getDate(),t,2)},H:function(n,t){return p(n.getHours(),t,2)},I:function(n,t){return p(n.getHours()%12||12,t,2)},j:function(n,t){return p(1+i.dayOfYear(n),t,3)},L:function(n,t){return p(n.getMilliseconds(),t,3)},m:function(n,t){return p(n.getMonth()+1,t,2)},M:function(n,t){return p(n.getMinutes(),t,2)},p:function(n){return c[+(n.getHours()>=12)]},S:function(n,t){return p(n.getSeconds(),t,2)},U:function(n,t){return p(i.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return p(i.mondayOfYear(n),t,2)},x:r(ot),X:r(st),y:function(n,t){return p(n.getFullYear()%100,t,2)},Y:function(n,t){return p(n.getFullYear()%1e4,t,4)},Z:hd,"%":function(){return"%"}},k={a:d,A:g,b:nt,B:tt,c:it,d:pa,e:pa,H:wa,I:wa,j:fd,L:sd,m:ud,M:ed,p:ft,S:od,U:dk,w:kk,W:gk,x:rt,X:ut,y:td,Y:nd,Z:id,"%":cd},r}function p(n,t,i){var u=0>n?"-":"",r=(u?-n:n)+"",f=r.length;return u+(i>f?new Array(i-f+1).join(t)+r:r)}function ku(t){return new RegExp("^(?:"+t.map(n.requote).join("|")+")","i")}function du(n){for(var i=new et,t=-1,r=n.length;++t<r;)i.set(n[t].toLowerCase(),t);return i}function kk(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+1));return r?(n.w=+r[0],i+r[0].length):-1}function dk(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i));return r?(n.U=+r[0],i+r[0].length):-1}function gk(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i));return r?(n.W=+r[0],i+r[0].length):-1}function nd(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+4));return r?(n.y=+r[0],i+r[0].length):-1}function td(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.y=rd(+r[0]),i+r[0].length):-1}function id(n,t,i){return/^[+-]\d{4}$/.test(t=t.substring(i,i+5))?(n.Z=-t,i+5):-1}function rd(n){return n+(n>68?1900:2e3)}function ud(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.m=r[0]-1,i+r[0].length):-1}function pa(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.d=+r[0],i+r[0].length):-1}function fd(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+3));return r?(n.j=+r[0],i+r[0].length):-1}function wa(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.H=+r[0],i+r[0].length):-1}function ed(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.M=+r[0],i+r[0].length):-1}function od(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+2));return r?(n.S=+r[0],i+r[0].length):-1}function sd(n,t,i){h.lastIndex=0;var r=h.exec(t.substring(i,i+3));return r?(n.L=+r[0],i+r[0].length):-1}function hd(n){var t=n.getTimezoneOffset(),i=t>0?"-":"+",u=~~(r(t)/60),f=r(t)%60;return i+p(u,"0",2)+p(f,"0",2)}function cd(n,t,i){rb.lastIndex=0;var r=rb.exec(t.substring(i,i+1));return r?i+r[0].length:-1}function ld(n){for(var i=n.length,t=-1;++t<i;)n[t][0]=this(n[t][0]);return function(t){for(var r=0,i=n[r];!i[1](t);)i=n[++r];return i[0](t)}}function ts(){}function ba(n,t,i){var r=i.s=n+t,u=r-n,f=r-u;i.t=n-f+(t-u)}function gu(n,t){n&&fc.hasOwnProperty(n.type)&&fc[n.type](n,t)}function is(n,t,i){var r,u=-1,f=n.length-i;for(t.lineStart();++u<f;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function ka(n,t){var i=-1,r=n.length;for(t.polygonStart();++i<r;)is(n[i],t,1);t.polygonEnd()}function ad(){function r(r,e){r*=u;e=e*u/2+f/4;var o=r-n,s=o>=0?1:-1,h=s*o,c=Math.cos(e),l=Math.sin(e),a=i*l,v=t*c+a*Math.cos(h),y=a*s*Math.sin(h);ii.add(Math.atan2(y,v));n=r;t=c;i=l}var e,o,n,t,i;k.point=function(s,h){k.point=r;n=(e=s)*u;t=Math.cos(h=(o=h)*u/2+f/4);i=Math.sin(h)};k.lineEnd=function(){r(e,o)}}function li(n){var t=n[0],i=n[1],r=Math.cos(i);return[r*Math.cos(t),r*Math.sin(t),Math.sin(i)]}function nf(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ir(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function rs(n,t){n[0]+=t[0];n[1]+=t[1];n[2]+=t[2]}function tf(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function rf(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t;n[1]/=t;n[2]/=t}function uf(n){return[Math.atan2(n[1],n[0]),nr(n[2])]}function ff(n,i){return r(n[0]-i[0])<t&&r(n[1]-i[1])<t}function us(n,t){n*=u;var i=Math.cos(t*=u);vr(i*Math.cos(n),i*Math.sin(n),Math.sin(t))}function vr(n,t,i){++su;pi+=(n-pi)/su;wi+=(t-wi)/su;wt+=(i-wt)/su}function da(){function r(r,f){r*=u;var c=Math.cos(f*=u),o=c*Math.cos(r),s=c*Math.sin(r),h=Math.sin(f),e=Math.atan2(Math.sqrt((e=t*h-i*s)*e+(e=i*o-n*h)*e+(e=n*s-t*o)*e),n*o+t*s+i*h);le+=e;ri+=e*(n+(n=o));ui+=e*(t+(t=s));lt+=e*(i+(i=h));vr(n,t,i)}var n,t,i;ut.point=function(f,e){f*=u;var o=Math.cos(e*=u);n=o*Math.cos(f);t=o*Math.sin(f);i=Math.sin(e);ut.point=r;vr(n,t,i)}}function ga(){ut.point=us}function vd(){function r(r,f){r*=u;var p=Math.cos(f*=u),e=p*Math.cos(r),o=p*Math.sin(r),s=Math.sin(f),c=t*s-i*o,l=i*e-n*s,a=n*o-t*e,v=Math.sqrt(c*c+l*l+a*a),w=n*e+t*o+i*s,y=v&&-ua(w)/v,h=Math.atan2(v,w);hr+=y*c;cr+=y*l;fi+=y*a;le+=h;ri+=h*(n+(n=e));ui+=h*(t+(t=o));lt+=h*(i+(i=s));vr(n,t,i)}var f,e,n,t,i;ut.point=function(o,s){f=o;e=s;ut.point=r;o*=u;var h=Math.cos(s*=u);n=h*Math.cos(o);t=h*Math.sin(o);i=Math.sin(s);vr(n,t,i)};ut.lineEnd=function(){r(f,e);ut.lineEnd=ga;ut.point=us}}function rr(){return!0}function nv(n,t,i,r,u){var h=[],s=[],o,l,v,f,c,a,e;if(n.forEach(function(n){var o,i,f,e,t,r;if(!((o=n.length-1)<=0)){if(i=n[0],f=n[o],ff(i,f)){for(u.lineStart(),e=0;o>e;++e)u.point((i=n[e])[0],i[1]);return u.lineEnd(),void 0}t=new ef(i,n,null,!0);r=new ef(i,null,t,!1);t.o=r;h.push(t);s.push(r);t=new ef(f,n,null,!1);r=new ef(f,null,t,!0);t.o=r;h.push(t);s.push(r)}}),s.sort(t),tv(h),tv(s),h.length){for(var e=0,y=i,a=s.length;a>e;++e)s[e].e=y=!y;for(v=h[0];;){for(f=v,c=!0;f.v;)if((f=f.n)===v)return;o=f.z;u.lineStart();do{if(f.v=f.o.v=!0,f.e){if(c)for(e=0,a=o.length;a>e;++e)u.point((l=o[e])[0],l[1]);else r(f.x,f.n.x,1,u);f=f.n}else{if(c)for(o=f.p.z,e=o.length-1;e>=0;--e)u.point((l=o[e])[0],l[1]);else r(f.x,f.p.x,-1,u);f=f.p}f=f.o;o=f.z;c=!c}while(!f.v);u.lineEnd()}}}function tv(n){if(r=n.length){for(var r,t,u=0,i=n[0];++u<r;)i.n=t=n[u],t.p=i,i=t;i.n=t=n[0];t.p=i}}function ef(n,t,i,r){this.x=n;this.z=t;this.o=i;this.e=r;this.v=!1;this.n=this.p=null}function iv(t,i,r,u){return function(f,e){function v(n,i){var r=f(n,i);t(n=r[0],i=r[1])&&e.point(n,i)}function d(n,t){var i=f(n,t);y.point(i[0],i[1])}function p(){o.point=d;y.lineStart()}function w(){o.point=v;y.lineEnd()}function b(n,t){c.push([n,t]);var i=f(n,t);a.point(i[0],i[1])}function g(){a.lineStart();c=[]}function nt(){var f,t,r;b(c[0][0],c[0][1]);a.lineEnd();var i,u=a.clean(),n=k.buffer(),t=n.length;if(c.pop(),l.push(c),c=null,t)if(1&u){if(i=n[0],t=i.length-1,r=-1,t>0){for(s||(e.polygonStart(),s=!0),e.lineStart();++r<t;)e.point((f=i[r])[0],f[1]);e.lineEnd()}}else t>1&&2&u&&n.push(n.pop().concat(n.shift())),h.push(n.filter(yd))}var h,l,c,y=i(e),tt=f.invert(u[0],u[1]),o={point:v,lineStart:p,lineEnd:w,polygonStart:function(){o.point=b;o.lineStart=g;o.lineEnd=nt;h=[];l=[]},polygonEnd:function(){o.point=v;o.lineStart=p;o.lineEnd=w;h=n.merge(h);var t=wd(tt,l);h.length?(s||(e.polygonStart(),s=!0),nv(h,pd,t,r,e)):t&&(s||(e.polygonStart(),s=!0),e.lineStart(),r(null,null,1,e),e.lineEnd());s&&(e.polygonEnd(),s=!1);h=l=null},sphere:function(){e.polygonStart();e.lineStart();r(null,null,1,e);e.lineEnd();e.polygonEnd()}},k=rv(),a=i(k),s=!1;return o}}function yd(n){return n.length>1}function rv(){var t,n=[];return{lineStart:function(){n.push(t=[])},point:function(n,i){t.push([n,i])},lineEnd:c,buffer:function(){var i=n;return n=[],t=null,i},rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))}}}function pd(n,i){return((n=n.x)[0]<0?n[1]-v-t:v-n[1])-((i=i.x)[0]<0?i[1]-v-t:v-i[1])}function wd(n,i){var e=n[0],nt=n[1],ct=[Math.sin(e),-Math.cos(e),0],a=0,tt=0,o,it,s,v,u,k,d;for(ii.reset(),o=0,it=i.length;it>o;++o)if(s=i[o],v=s.length,v)for(var h=s[0],y=h[0],rt=h[1]/2+f/4,ut=Math.sin(rt),ft=Math.cos(rt),c=1;;){c===v&&(c=0);n=s[c];var p=n[0],et=n[1]/2+f/4,ot=Math.sin(et),st=Math.cos(et),r=p-y,w=r>=0?1:-1,b=w*r,l=b>f,ht=ut*ot;if((ii.add(Math.atan2(ht*w*Math.sin(b),ft*st+ht*Math.cos(b))),a+=l?r+w*g:r,l^y>=e^p>=e)&&(u=ir(li(h),li(n)),rf(u),k=ir(ct,u),rf(k),d=(l^r>=0?-1:1)*nr(k[2]),(nt>d||nt===d&&(u[0]||u[1]))&&(tt+=l^r>=0?1:-1)),!c++)break;y=p;ut=ot;ft=st;h=n}return(-t>a||t>a&&0>ii)^1&tt}function bd(n){var o,u=NaN,i=NaN,e=NaN;return{lineStart:function(){n.lineStart();o=1},point:function(s,h){var c=s>0?f:-f,l=r(s-u);r(l-f)<t?(n.point(u,i=(i+h)/2>0?v:-v),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),n.point(s,i),o=0):e!==c&&l>=f&&(r(u-e)<t&&(u-=e*t),r(s-c)<t&&(s-=c*t),i=kd(u,i,s,h),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),o=0);n.point(u=s,i=h);e=c},lineEnd:function(){n.lineEnd();u=i=NaN},clean:function(){return 2-o}}}function kd(n,i,u,f){var e,o,s=Math.sin(n-u);return r(s)>t?Math.atan((Math.sin(i)*(o=Math.cos(f))*Math.sin(u)-Math.sin(f)*(e=Math.cos(i))*Math.sin(n))/(e*o*s)):(i+f)/2}function dd(n,i,u,e){var o,s;null==n?(o=u*v,e.point(-f,o),e.point(0,o),e.point(f,o),e.point(f,0),e.point(f,-o),e.point(0,-o),e.point(-f,-o),e.point(-f,0),e.point(-f,o)):r(n[0]-i[0])>t?(s=n[0]<i[0]?f:-f,o=u*s/2,e.point(-s,o),e.point(0,o),e.point(s,o)):e.point(i[0],i[1])}function gd(n){function s(n,t){return Math.cos(n)*Math.cos(t)>i}function c(n){var i,a,r,c,u;return{lineStart:function(){c=r=!1;u=1},point:function(v,y){var w,p=[v,y],b=s(v,y),d=e?b?0:h(v,y):b?h(v+(0>v?f:-f),y):0,k;(!i&&(c=r=b)&&n.lineStart(),b!==r&&(w=o(i,p),(ff(i,w)||ff(p,w))&&(p[0]+=t,p[1]+=t,b=s(p[0],p[1]))),b!==r)?(u=0,b?(n.lineStart(),w=o(p,i),n.point(w[0],w[1])):(w=o(i,p),n.point(w[0],w[1]),n.lineEnd()),i=w):l&&i&&e^b&&(d&a||!(k=o(p,i,!0))||(u=0,e?(n.lineStart(),n.point(k[0][0],k[0][1]),n.point(k[1][0],k[1][1]),n.lineEnd()):(n.point(k[1][0],k[1][1]),n.lineEnd(),n.lineStart(),n.point(k[0][0],k[0][1]))));!b||i&&ff(i,p)||n.point(p[0],p[1]);i=p;r=b;a=d},lineEnd:function(){r&&n.lineEnd();i=null},clean:function(){return u|(c&&r)<<1}}}function o(n,u,e){var et=li(n),ot=li(u),rt=[1,0,0],a=ir(et,ot),ut=nf(a,a),b=a[0],k=ut-b*b,g,o,it;if(!k)return!e&&n;var st=i*ut/k,ht=-i*b/k,ct=ir(rt,a),s=tf(rt,st),lt=tf(a,ht);rs(s,lt);var v=ct,p=nf(s,v),d=nf(v,v),ft=p*p-d*(nf(s,s)-1);if(!(0>ft)){if(g=Math.sqrt(ft),o=tf(v,(-p-g)/d),rs(o,s),o=uf(o),!e)return o;var w,h=n[0],y=u[0],c=n[1],l=u[1];h>y&&(w=h,h=y,y=w);var nt=y-h,tt=r(nt-f)<t,at=tt||t>nt;if(!tt&&c>l&&(w=c,c=l,l=w),at?tt?c+l>0^o[1]<(r(o[0]-h)<t?c:l):c<=o[1]&&o[1]<=l:nt>f^(h<=o[0]&&o[0]<=y))return it=tf(v,(-p+g)/d),rs(it,s),[o,uf(it)]}}function h(t,i){var u=e?n:f-n,r=0;return-u>t?r|=1:t>u&&(r|=2),-u>i?r|=4:i>u&&(r|=8),r}var i=Math.cos(n),e=i>0,l=r(i)>t,a=ss(n,6*u);return iv(s,c,a,e?[0,-n]:[-f,n-f])}function uv(n,t,i,r){return function(u){var f,a=u.a,v=u.b,c=a.x,l=a.y,y=v.x,p=v.y,e=0,o=1,s=y-c,h=p-l;if(f=n-c,s||!(f>0)){if(f/=s,0>s){if(e>f)return;o>f&&(o=f)}else if(s>0){if(f>o)return;f>e&&(e=f)}if(f=i-c,s||!(0>f)){if(f/=s,0>s){if(f>o)return;f>e&&(e=f)}else if(s>0){if(e>f)return;o>f&&(o=f)}if(f=t-l,h||!(f>0)){if(f/=h,0>h){if(e>f)return;o>f&&(o=f)}else if(h>0){if(f>o)return;f>e&&(e=f)}if(f=r-l,h||!(0>f)){if(f/=h,0>h){if(f>o)return;f>e&&(e=f)}else if(h>0){if(e>f)return;o>f&&(o=f)}return e>0&&(u.a={x:c+e*s,y:l+e*h}),1>o&&(u.b={x:c+o*s,y:l+o*h}),u}}}}}}function fv(i,u,f,e){function o(n,e){return r(n[0]-i)<t?e>0?0:3:r(n[0]-f)<t?e>0?2:1:r(n[1]-u)<t?e>0?1:0:e>0?3:2}function h(n,t){return s(n.x,t.x)}function s(n,t){var i=o(n,1),r=o(t,1);return i!==r?i-r:0===i?t[1]-n[1]:1===i?n[0]-t[0]:2===i?n[1]-t[1]:t[0]-n[0]}return function(t){function ft(n){for(var r=0,s=c.length,u=n[1],f=0;s>f;++f)for(var t,e=1,o=c[f],h=o.length,i=o[0];h>e;++e)t=o[e],i[1]<=u?t[1]>u&&co(i,t,n)>0&&++r:t[1]<=u&&co(i,t,n)<0&&--r,i=t;return 0!==r}function d(n,t,r,h){var c=0,l=0;if(null==n||(c=o(n,r))!==(l=o(t,r))||s(n,t)<0^r>0){do h.point(0===c||3===c?i:f,c>1?e:u);while((c=(c+r+4)%4)!==l)}else h.point(t[0],t[1])}function g(n,t){return n>=i&&f>=n&&t>=u&&e>=t}function nt(n,i){g(n,i)&&t.point(n,i)}function et(){k.point=tt;c&&c.push(v=[]);w=!0;l=!1;y=p=NaN}function ot(){r&&(tt(it,rt),ut&&l&&b.rejoin(),r.push(b.buffer()));k.point=nt;l&&t.lineEnd()}function tt(n,i){var r,u;n=Math.max(-ae,Math.min(ae,n));i=Math.max(-ae,Math.min(ae,i));r=g(n,i);(c&&v.push([n,i]),w)?(it=n,rt=i,ut=r,w=!1,r&&(t.lineStart(),t.point(n,i))):r&&l?t.point(n,i):(u={a:{x:y,y:p},b:{x:n,y:i}},ht(u)?(l||(t.lineStart(),t.point(u.a.x,u.a.y)),t.point(u.b.x,u.b.y),r||t.lineEnd(),a=!1):r&&(t.lineStart(),t.point(n,i),a=!1));y=n;p=i;l=r}var r,c,v,it,rt,ut,y,p,l,w,a,st=t,b=rv(),ht=uv(i,u,f,e),k={point:nt,lineStart:et,lineEnd:ot,polygonStart:function(){t=b;r=[];c=[];a=!0},polygonEnd:function(){t=st;r=n.merge(r);var u=ft([i,e]),f=a&&u,o=r.length;(f||o)&&(t.polygonStart(),f&&(t.lineStart(),d(null,null,1,t),t.lineEnd()),o&&nv(r,h,u,d,t),t.polygonEnd());r=c=v=null}};return k}}function ev(n,t){function i(i,r){return i=n(i,r),t(i[0],i[1])}return n.invert&&t.invert&&(i.invert=function(i,r){return i=t.invert(i,r),i&&n.invert(i[0],i[1])}),i}function fs(n){var t=0,i=f/3,r=es(n),u=r(t,i);return u.parallels=function(n){return arguments.length?r(t=n[0]*f/180,i=n[1]*f/180):[180*(t/f),180*(i/f)]},u}function ov(n,t){function f(n,t){var r=Math.sqrt(u-2*i*Math.sin(t))/i;return[r*Math.sin(n*=i),e-r*Math.cos(n)]}var r=Math.sin(n),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),e=Math.sqrt(u)/i;return f.invert=function(n,t){var r=e-t;return[Math.atan2(n,r)/i,nr((u-(n*n+r*r)*i*i)/(2*i))]},f}function ng(){function i(i,r){oc+=t*i-n*r;n=i;t=r}var r,u,n,t;ei.point=function(f,e){ei.point=i;r=n=f;u=t=e};ei.lineEnd=function(){i(r,u)}}function tg(n,t){ve>n&&(ve=n);n>pe&&(pe=n);ye>t&&(ye=t);t>we&&(we=t)}function ig(){function i(n,i){t.push("M",n,",",i,u)}function f(i,r){t.push("M",i,",",r);n.point=e}function e(n,i){t.push("L",n,",",i)}function r(){n.point=i}function o(){t.push("Z")}var u=sv(4.5),t=[],n={point:i,lineStart:function(){n.point=f},lineEnd:r,polygonStart:function(){n.lineEnd=o},polygonEnd:function(){n.lineEnd=r;n.point=i},pointRadius:function(t){return u=sv(t),n},result:function(){if(t.length){var n=t.join("");return t=[],n}}};return n}function sv(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function ai(n,t){pi+=n;wi+=t;++wt}function hv(){function i(i,r){var f=i-n,e=r-t,u=Math.sqrt(f*f+e*e);ri+=u*(n+i)/2;ui+=u*(t+r)/2;lt+=u;ai(n=i,t=r)}var n,t;ft.point=function(r,u){ft.point=i;ai(n=r,t=u)}}function cv(){ft.point=ai}function rg(){function i(i,r){var f=i-n,e=r-t,u=Math.sqrt(f*f+e*e);ri+=u*(n+i)/2;ui+=u*(t+r)/2;lt+=u;u=t*i-n*r;hr+=u*(n+i);cr+=u*(t+r);fi+=3*u;ai(n=i,t=r)}var r,u,n,t;ft.point=function(f,e){ft.point=i;ai(r=n=f,u=t=e)};ft.lineEnd=function(){i(r,u)}}function ug(n){function i(t,i){n.moveTo(t,i);n.arc(t,i,u,0,g)}function f(i,r){n.moveTo(i,r);t.point=e}function e(t,i){n.lineTo(t,i)}function r(){t.point=i}function o(){n.closePath()}var u=4.5,t={point:i,lineStart:function(){t.point=f},lineEnd:r,polygonStart:function(){t.lineEnd=o},polygonEnd:function(){t.lineEnd=r;t.point=i},pointRadius:function(n){return u=n,t},result:c};return t}function lv(n){function o(n){return(e?h:s)(n)}function s(t){return vv(t,function(i,r){i=n(i,r);t.point(i[0],i[1])})}function h(t){function y(i,r){i=n(i,r);t.point(i[0],i[1])}function c(){u=NaN;r.point=l;t.lineStart()}function l(r,c){var l=li([r,c]),a=n(r,c);i(u,f,v,o,s,h,u=a[0],f=a[1],v=r,o=l[0],s=l[1],h=l[2],e,t);t.point(u,f)}function a(){r.point=y;t.lineEnd()}function nt(){c();r.point=tt;r.lineEnd=it}function tt(n,t){l(p=n,rt=t);w=u;b=f;k=o;d=s;g=h;r.point=l}function it(){i(u,f,v,o,s,h,w,b,p,k,d,g,e,t);r.lineEnd=a;a()}var p,rt,w,b,k,d,g,v,u,f,o,s,h,r={point:y,lineStart:c,lineEnd:a,polygonStart:function(){t.polygonStart();r.lineStart=nt},polygonEnd:function(){t.polygonEnd();r.lineStart=c}};return r}function i(u,e,o,s,h,l,a,v,y,p,w,b,k,d){var it=a-u,rt=v-e,et=it*it+rt*rt;if(et>4*f&&k--){var nt=s+p,tt=h+w,g=l+b,ot=Math.sqrt(nt*nt+tt*tt+g*g),vt=Math.asin(g/=ot),st=r(r(g)-1)<t||r(o-y)<t?(o+y)/2:Math.atan2(tt,nt),ht=n(st,vt),ut=ht[0],ft=ht[1],ct=ut-u,lt=ft-e,at=rt*ct-it*lt;(at*at/et>f||r((it*ct+rt*lt)/et-.5)>.3||c>s*p+h*w+l*b)&&(i(u,e,o,s,h,l,ut,ft,st,nt/=ot,tt/=ot,g,k,d),d.point(ut,ft),i(ut,ft,st,nt,tt,g,a,v,y,p,w,b,k,d))}}var f=.5,c=Math.cos(30*u),e=16;return o.precision=function(n){return arguments.length?(e=(f=n*n)>0&&16,o):Math.sqrt(f)},o}function fg(n){var t=lv(function(t,i){return n([t*s,i*s])});return function(n){return yv(t(n))}}function av(n){this.stream=n}function vv(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function gt(n){return es(function(){return n})()}function es(t){function i(n){return n=v(n[0]*u,n[1]*u),[n[0]*r+h,c-n[1]*r]}function et(n){return n=v.invert((n[0]-h)/r,(c-n[1])/r),n&&[n[0]*s,n[1]*s]}function e(){v=ev(tt=os(k,d,g),o);var n=o(w,b);return h=y-n[0]*r,c=p+n[1]*r,l()}function l(){return f&&(f.valid=!1,f=null),i}var o,tt,v,h,c,f,it=lv(function(n,t){return n=o(n,t),[n[0]*r+h,c-n[1]*r]}),r=150,y=480,p=250,w=0,b=0,k=0,d=0,g=0,rt=ub,ut=a,nt=null,ft=null;return i.stream=function(n){return f&&(f.valid=!1),f=yv(rt(tt,it(ut(n)))),f.valid=!0,f},i.clipAngle=function(n){return arguments.length?(rt=null==n?(nt=n,ub):gd((nt=+n)*u),l()):nt},i.clipExtent=function(n){return arguments.length?(ft=n,ut=n?fv(n[0][0],n[0][1],n[1][0],n[1][1]):a,l()):ft},i.scale=function(n){return arguments.length?(r=+n,e()):r},i.translate=function(n){return arguments.length?(y=+n[0],p=+n[1],e()):[y,p]},i.center=function(n){return arguments.length?(w=n[0]%360*u,b=n[1]%360*u,e()):[w*s,b*s]},i.rotate=function(n){return arguments.length?(k=n[0]%360*u,d=n[1]%360*u,g=n.length>2?n[2]%360*u:0,e()):[k*s,d*s,g*s]},n.rebind(i,it,"precision"),function(){return o=t.apply(this,arguments),i.invert=o.invert&&et,e()}}function yv(n){return vv(n,function(t,i){n.point(t*u,i*u)})}function yr(n,t){return[n,t]}function pv(n,t){return[n>f?n-g:-f>n?n+g:n,t]}function os(n,t,i){return n?t||i?ev(bv(n),kv(t,i)):bv(n):t||i?kv(t,i):pv}function wv(n){return function(t,i){return t+=n,[t>f?t-g:-f>t?t+g:t,i]}}function bv(n){var t=wv(n);return t.invert=wv(-n),t}function kv(n,t){function e(n,t){var e=Math.cos(t),o=Math.cos(n)*e,s=Math.sin(n)*e,h=Math.sin(t),c=h*i+o*r;return[Math.atan2(s*u-c*f,o*i-h*r),nr(c*u+s*f)]}var i=Math.cos(n),r=Math.sin(n),u=Math.cos(t),f=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),o=Math.cos(n)*e,s=Math.sin(n)*e,h=Math.sin(t),c=h*u-s*f;return[Math.atan2(s*u+h*f,o*i+c*r),nr(c*i-o*r)]},e}function ss(n,t){var i=Math.cos(n),r=Math.sin(n);return function(u,f,e,o){var h=e*t,c,s;for(null!=u?(u=dv(i,u),f=dv(i,f),(e>0?f>u:u>f)&&(u+=e*g)):(u=n+e*g,f=n-.5*h),s=u;e>0?s>f:f>s;s-=h)o.point((c=uf([i,-r*Math.cos(s),-r*Math.sin(s)]))[0],c[1])}}function dv(n,i){var r=li(i),u;return r[0]-=n,rf(r),u=ua(-r[1]),((-r[2]<0?-u:u)+2*Math.PI-t)%(2*Math.PI)}function gv(i,r,u){var f=n.range(i,r-t,u).concat(r);return function(n){return f.map(function(t){return[n,t]})}}function ny(i,r,u){var f=n.range(i,r-t,u).concat(r);return function(n){return f.map(function(t){return[t,n]})}}function hs(n){return n.source}function cs(n){return n.target}function eg(n,t,i,r){var f=Math.cos(t),c=Math.sin(t),e=Math.cos(r),l=Math.sin(r),a=f*Math.cos(n),v=f*Math.sin(n),y=e*Math.cos(i),p=e*Math.sin(i),u=2*Math.asin(Math.sqrt(ea(r-t)+f*e*ea(i-n))),o=1/Math.sin(u),h=u?function(n){var t=Math.sin(n*=u)*o,i=Math.sin(u-n)*o,r=i*a+t*y,f=i*v+t*p,e=i*c+t*l;return[Math.atan2(f,r)*s,Math.atan2(e,Math.sqrt(r*r+f*f))*s]}:function(){return[n*s,t*s]};return h.distance=u,h}function og(){function f(f,e){var h=Math.sin(e*=u),s=Math.cos(e),o=r((f*=u)-i),c=Math.cos(o);sc+=Math.atan2(Math.sqrt((o=s*Math.sin(o))*o+(o=t*h-n*s*c)*o),n*h+t*s*c);i=f;n=h;t=s}var i,n,t;bi.point=function(r,e){i=r*u;n=Math.sin(e*=u);t=Math.cos(e);bi.point=f};bi.lineEnd=function(){bi.point=bi.lineEnd=c}}function pr(n,t){function i(t,i){var f=Math.cos(t),r=Math.cos(i),u=n(f*r);return[u*r*Math.sin(t),u*Math.sin(i)]}return i.invert=function(n,i){var r=Math.sqrt(n*n+i*i),u=t(r),f=Math.sin(u),e=Math.cos(u);return[Math.atan2(n*f,r*e),Math.asin(r&&i*f/r)]},i}function ty(n,i){function o(n,i){u>0?-v+t>i&&(i=-v+t):i>v-t&&(i=v-t);var f=u/Math.pow(e(i),r);return[f*Math.sin(r*n),u-f*Math.cos(r*n)]}var s=Math.cos(n),e=function(n){return Math.tan(f/4+n/2)},r=n===i?Math.sin(n):Math.log(s/Math.cos(i))/Math.log(e(i)/e(n)),u=s*Math.pow(e(n),r)/r;return r?(o.invert=function(n,t){var i=u-t,f=ra(r)*Math.sqrt(n*n+i*i);return[Math.atan2(n,i)/r,2*Math.atan(Math.pow(u/f,1/r))-v]},o):of}function iy(n,i){function e(n,t){var i=f-t;return[i*Math.sin(u*n),f-i*Math.cos(u*n)]}var o=Math.cos(n),u=n===i?Math.sin(n):(o-Math.cos(i))/(i-n),f=o/u+n;return r(u)<t?yr:(e.invert=function(n,t){var i=f-t;return[Math.atan2(n,i)/u,f-ra(u)*Math.sqrt(n*n+i*i)]},e)}function of(n,t){return[n,Math.log(Math.tan(f/4+t/2))]}function ry(n){var i,t=gt(n),r=t.scale,u=t.translate,e=t.clipExtent;return t.scale=function(){var n=r.apply(t,arguments);return n===t?i?t.clipExtent(null):t:n},t.translate=function(){var n=u.apply(t,arguments);return n===t?i?t.clipExtent(null):t:n},t.clipExtent=function(n){var h=e.apply(t,arguments),o,s;return h===t?(i=null==n)&&(o=f*r(),s=u(),e([[s[0]-o,s[1]-o],[s[0]+o,s[1]+o]])):i&&(h=null),h},t.clipExtent(null)}function ls(n,t){return[Math.log(Math.tan(f/4+t/2)),-n]}function ur(n){return n[0]}function wr(n){return n[1]}function uy(n){for(var u=n.length,i=[0,1],t=2,r=2;u>r;r++){for(;t>1&&co(n[i[t-2]],n[i[t-1]],n[r])<=0;)--t;i[t++]=r}return i.slice(0,t)}function sg(n,t){return n[0]-t[0]||n[1]-t[1]}function as(n,t,i){return(i[0]-t[0])*(n[1]-t[1])<(i[1]-t[1])*(n[0]-t[0])}function fy(n,t,i,r){var u=n[0],e=i[0],o=t[0]-u,s=r[0]-e,f=n[1],h=i[1],c=t[1]-f,l=r[1]-h,a=(s*(f-h)-l*(u-e))/(l*o-s*c);return[u+a*o,f+a*c]}function ey(n){var t=n[0],i=n[n.length-1];return!(t[0]-i[0]||t[1]-i[1])}function hg(){cf(this);this.edge=this.site=this.circle=null}function oy(n){var t=pc.pop()||new hg;return t.site=n,t}function vs(n){er(n);ar.remove(n);pc.push(n);cf(n)}function cg(n){var a=n.circle,o=a.x,s=a.cy,v={x:o,y:s},h=n.P,c=n.N,f=[n],u,i,e,l;for(vs(n),u=h;u.circle&&r(o-u.circle.x)<t&&r(s-u.circle.cy)<t;)h=u.P,f.unshift(u),vs(u),u=h;for(f.unshift(u),er(u),i=c;i.circle&&r(o-i.circle.x)<t&&r(s-i.circle.cy)<t;)c=i.N,f.push(i),vs(i),i=c;for(f.push(i),er(i),l=f.length,e=1;l>e;++e)i=f[e],u=f[e-1],sf(i.edge,u.site,i.site,v);u=f[0];i=f[l-1];i.edge=br(u.site,i.site,null,v);fr(u);fr(i)}function lg(n){for(var f,i,r,a,v,b=n.x,k=n.y,u=ar._;u;)if(a=sy(u,k)-b,a>t)u=u.L;else{if(v=b-ag(u,k),!(v>t)){a>-t?(i=u.P,r=u):v>-t?(i=u,r=u.N):i=r=u;break}if(!u.R){i=u;break}u=u.R}if(f=oy(n),ar.insert(i,f),i||r){if(i===r)return er(i),r=oy(i.site),ar.insert(f,r),f.edge=r.edge=br(i.site,f.site),fr(i),fr(r),void 0;if(!r)return f.edge=br(i.site,f.site),void 0;er(i);er(r);var e=i.site,y=e.x,p=e.y,o=n.x-y,s=n.y-p,h=r.site,c=h.x-y,l=h.y-p,d=2*(o*l-s*c),g=o*o+s*s,nt=c*c+l*l,w={x:(l*g-s*nt)/d+y,y:(o*nt-c*g)/d+p};sf(r.edge,e,h,w);f.edge=br(e,n,null,w);r.edge=br(n,h,null,w);fr(i);fr(r)}}function sy(n,t){var i=n.site,u=i.x,l=i.y,f=l-t,e;if(!f)return u;if(e=n.P,!e)return-1/0;i=e.site;var o=i.x,a=i.y,r=a-t;if(!r)return o;var s=o-u,h=1/f-1/r,c=s/r;return h?(-c+Math.sqrt(c*c-2*h*(s*s/(-2*r)-a+r/2+l-f/2)))/h+u:(u+o)/2}function ag(n,t){var r=n.N,i;return r?sy(r,t):(i=n.site,i.y===t?i.x:1/0)}function hy(n){this.site=n;this.edges=[]}function vg(n){for(var i,u,f,e,o,s,h,y,w,p,c=n[0][0],l=n[1][0],a=n[0][1],v=n[1][1],b=ki,k=b.length;k--;)if(o=b[k],o&&o.prepare())for(h=o.edges,y=h.length,s=0;y>s;)p=h[s].end(),f=p.x,e=p.y,w=h[++s%y].start(),i=w.x,u=w.y,(r(f-i)>t||r(e-u)>t)&&(h.splice(s,0,new hf(bg(o.site,p,r(f-c)<t&&v-e>t?{x:c,y:r(i-c)<t?u:v}:r(e-v)<t&&l-f>t?{x:r(u-v)<t?i:l,y:v}:r(f-l)<t&&e-a>t?{x:l,y:r(i-l)<t?u:a}:r(e-a)<t&&f-c>t?{x:r(u-a)<t?i:c,y:a}:null),o.site,null)),++y)}function cy(n,t){return t.angle-n.angle}function yg(){cf(this);this.x=this.y=this.arc=this.site=this.cy=null}function fr(n){var w=n.P,b=n.N,u,t;if(w&&b){var s=w.site,h=n.site,c=b.site;if(s!==c){var l=h.x,a=h.y,f=s.x-l,e=s.y-a,o=c.x-l,r=c.y-a,v=2*(f*r-e*o);if(!(v>=-dh)){var k=f*f+e*e,d=o*o+r*r,y=(r*k-e*d)/v,p=(f*d-o*k)/v,r=p+a,i=wc.pop()||new yg;for(i.arc=n,i.site=h,i.x=y+l,i.y=r+Math.sqrt(y*y+p*p),i.cy=r,n.circle=i,u=null,t=cu._;t;)if(i.y<t.y||i.y===t.y&&i.x<=t.x){if(!t.L){u=t.P;break}t=t.L}else{if(!t.R){u=t;break}t=t.R}cu.insert(u,i);u||(yc=i)}}}}function er(n){var t=n.circle;t&&(t.P||(yc=t.N),cu.remove(t),wc.push(t),cf(t),n.circle=null)}function pg(n){for(var i,u=lr,e=uv(n[0][0],n[0][1],n[1][0],n[1][1]),f=u.length;f--;)i=u[f],(!wg(i,n)||!e(i)||r(i.a.x-i.b.x)<t&&r(i.a.y-i.b.y)<t)&&(i.a=i.b=null,u.splice(f,1))}function wg(n,t){var f=n.b;if(f)return!0;var r,u,i=n.a,h=t[0][0],c=t[1][0],e=t[0][1],o=t[1][1],p=n.l,w=n.r,l=p.x,a=p.y,v=w.x,y=w.y,s=(l+v)/2,b=(a+y)/2;if(y===a){if(h>s||s>=c)return;if(l>v){if(i){if(i.y>=o)return}else i={x:s,y:e};f={x:s,y:o}}else{if(i){if(i.y<e)return}else i={x:s,y:o};f={x:s,y:e}}}else if(r=(l-v)/(y-a),u=b-r*s,-1>r||r>1)if(l>v){if(i){if(i.y>=o)return}else i={x:(e-u)/r,y:e};f={x:(o-u)/r,y:o}}else{if(i){if(i.y<e)return}else i={x:(o-u)/r,y:o};f={x:(e-u)/r,y:e}}else if(y>a){if(i){if(i.x>=c)return}else i={x:h,y:r*h+u};f={x:c,y:r*c+u}}else{if(i){if(i.x<h)return}else i={x:c,y:r*c+u};f={x:h,y:r*h+u}}return n.a=i,n.b=f,!0}function ly(n,t){this.l=n;this.r=t;this.a=this.b=null}function br(n,t,i,r){var u=new ly(n,t);return lr.push(u),i&&sf(u,n,t,i),r&&sf(u,t,n,r),ki[n.i].edges.push(new hf(u,n,t)),ki[t.i].edges.push(new hf(u,t,n)),u}function bg(n,t,i){var r=new ly(n,null);return r.a=t,r.b=i,lr.push(r),r}function sf(n,t,i,r){n.a||n.b?n.l===i?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=i)}function hf(n,t,i){var r=n.a,u=n.b;this.edge=n;this.site=t;this.angle=i?Math.atan2(i.y-t.y,i.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function ys(){this._=null}function cf(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function kr(n,t){var i=t,r=t.R,u=i.U;u?u.L===i?u.L=r:u.R=r:n._=r;r.U=u;i.U=r;i.R=r.L;i.R&&(i.R.U=i);r.L=i}function dr(n,t){var i=t,r=t.L,u=i.U;u?u.L===i?u.L=r:u.R=r:n._=r;r.U=u;i.U=r;i.L=r.R;i.L&&(i.L.U=i);r.R=i}function ay(n){for(;n.L;)n=n.L;return n}function ps(n,t){var u,f,r,i=n.sort(kg).pop(),e;for(lr=[],ki=new Array(n.length),ar=new ys,cu=new ys;;)if(r=yc,i&&(!r||i.y<r.y||i.y===r.y&&i.x<r.x))(i.x!==u||i.y!==f)&&(ki[i.i]=new hy(i),lg(i),u=i.x,f=i.y),i=n.pop();else{if(!r)break;cg(r.arc)}return t&&(pg(t),vg(t)),e={cells:ki,edges:lr},ar=cu=lr=ki=null,e}function kg(n,t){return t.y-n.y||t.x-n.x}function dg(n,t,i){return(n.x-i.x)*(t.y-n.y)-(n.x-t.x)*(i.y-n.y)}function gg(n){return n.x}function nn(n){return n.y}function vy(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function gr(n,t,i,r,u,f){if(!n(t,i,r,u,f)){var o=.5*(i+u),s=.5*(r+f),e=t.nodes;e[0]&&gr(n,e[0],i,r,o,s);e[1]&&gr(n,e[1],o,r,u,s);e[2]&&gr(n,e[2],i,s,o,f);e[3]&&gr(n,e[3],o,s,u,f)}}function ws(t,i){t=n.rgb(t);i=n.rgb(i);var r=t.r,u=t.g,f=t.b,e=i.r-r,o=i.g-u,s=i.b-f;return function(n){return"#"+tr(Math.round(r+e*n))+tr(Math.round(u+o*n))+tr(Math.round(f+s*n))}}function yy(n,t){var i,u={},r={};for(i in n)i in t?u[i]=vi(n[i],t[i]):r[i]=n[i];for(i in t)i in n||(r[i]=t[i]);return function(n){for(i in u)r[i]=u[i](n);return r}}function vt(n,t){return t-=n=+n,function(i){return n+t*i}}function py(n,t){var s,f,u,e=be.lastIndex=ke.lastIndex=0,r=-1,i=[],o=[];for(n+="",t+="";(s=be.exec(n))&&(f=ke.exec(t));)(u=f.index)>e&&(u=t.substring(e,u),i[r]?i[r]+=u:i[++r]=u),(s=s[0])===(f=f[0])?i[r]?i[r]+=f:i[++r]=f:(i[++r]=null,o.push({i:r,x:vt(s,f)})),e=ke.lastIndex;return e<t.length&&(u=t.substring(e),i[r]?i[r]+=u:i[++r]=u),i.length<2?o[0]?(t=o[0].x,function(n){return t(n)+""}):function(){return t}:(t=o.length,function(n){for(var u,r=0;t>r;++r)i[(u=o[r]).i]=u.x(n);return i.join("")})}function vi(t,i){for(var r,u=n.interpolators.length;--u>=0&&!(r=n.interpolators[u](t,i)););return r}function lf(n,t){for(var u=[],r=[],e=n.length,o=t.length,f=Math.min(n.length,t.length),i=0;f>i;++i)u.push(vi(n[i],t[i]));for(;e>i;++i)r[i]=n[i];for(;o>i;++i)r[i]=t[i];return function(n){for(i=0;f>i;++i)r[i]=u[i](n);return r}}function tn(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function wy(n){return function(t){return 1-n(1-t)}}function by(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function rn(n){return n*n}function un(n){return n*n*n}function fn(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,i=t*n;return 4*(.5>n?i:3*(n-t)+i-.75)}function en(n){return function(t){return Math.pow(t,n)}}function on(n){return 1-Math.cos(n*v)}function sn(n){return Math.pow(2,10*(n-1))}function hn(n){return 1-Math.sqrt(1-n*n)}function cn(n,t){var i;return arguments.length<2&&(t=.45),arguments.length?i=t/g*Math.asin(1/n):(n=1,i=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-i)*g/t)}}function ln(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function an(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function vn(t,i){t=n.hcl(t);i=n.hcl(i);var u=t.h,f=t.c,o=t.l,r=i.h-u,e=i.c-f,s=i.l-o;return isNaN(e)&&(e=0,f=isNaN(f)?i.c:f),isNaN(r)?(r=0,u=isNaN(u)?i.h:u):r>180?r-=360:-180>r&&(r+=360),function(n){return ao(u+r*n,f+e*n,o+s*n)+""}}function yn(t,i){t=n.hsl(t);i=n.hsl(i);var u=t.h,f=t.s,o=t.l,r=i.h-u,e=i.s-f,s=i.l-o;return isNaN(e)&&(e=0,f=isNaN(f)?i.s:f),isNaN(r)?(r=0,u=isNaN(u)?i.h:u):r>180?r-=360:-180>r&&(r+=360),function(n){return lo(u+r*n,f+e*n,o+s*n)+""}}function pn(t,i){t=n.lab(t);i=n.lab(i);var r=t.l,u=t.a,f=t.b,e=i.l-r,o=i.a-u,s=i.b-f;return function(n){return oa(r+e*n,u+o*n,f+s*n)+""}}function ky(n,t){return t-=n,function(i){return Math.round(n+t*i)}}function dy(n){var t=[n.a,n.b],i=[n.c,n.d],r=np(t),u=gy(t,i),f=np(wn(i,t,-u))||0;t[0]*i[1]<i[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1);this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-i[0],i[1]))*s;this.translate=[n.e,n.f];this.scale=[r,f];this.skew=f?Math.atan2(u,f)*s:0}function gy(n,t){return n[0]*t[0]+n[1]*t[1]}function np(n){var t=Math.sqrt(gy(n,n));return t&&(n[0]/=t,n[1]/=t),t}function wn(n,t,i){return n[0]+=i*t[0],n[1]+=i*t[1],n}function tp(t,i){var s,r=[],o=[],c=n.transform(t),l=n.transform(i),a=c.translate,u=l.translate,h=c.rotate,f=l.rotate,p=c.skew,v=l.skew,y=c.scale,e=l.scale;return a[0]!=u[0]||a[1]!=u[1]?(r.push("translate(",null,",",null,")"),o.push({i:1,x:vt(a[0],u[0])},{i:3,x:vt(a[1],u[1])})):u[0]||u[1]?r.push("translate("+u+")"):r.push(""),h!=f?(h-f>180?f+=360:f-h>180&&(h+=360),o.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:vt(h,f)})):f&&r.push(r.pop()+"rotate("+f+")"),p!=v?o.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:vt(p,v)}):v&&r.push(r.pop()+"skewX("+v+")"),y[0]!=e[0]||y[1]!=e[1]?(s=r.push(r.pop()+"scale(",null,",",null,")"),o.push({i:s-4,x:vt(y[0],e[0])},{i:s-2,x:vt(y[1],e[1])})):(1!=e[0]||1!=e[1])&&r.push(r.pop()+"scale("+e+")"),s=o.length,function(n){for(var t,i=-1;++i<s;)r[(t=o[i]).i]=t.x(n);return r.join("")}}function bn(n,t){return t=t-(n=+n)?1/(t-n):0,function(i){return(i-n)*t}}function kn(n,t){return t=t-(n=+n)?1/(t-n):0,function(i){return Math.max(0,Math.min(1,(i-n)*t))}}function dn(n){for(var f,t=n.source,i=n.target,u=gn(t,i),r=[t];t!==u;)t=t.parent,r.push(t);for(f=r.length;i!==u;)r.splice(f,0,i),i=i.parent;return r}function ip(n){for(var i=[],t=n.parent;null!=t;)i.push(n),n=t,t=t.parent;return i.push(n),i}function gn(n,t){if(n===t)return n;for(var r=ip(n),u=ip(t),i=r.pop(),f=u.pop(),e=null;i===f;)e=i,i=r.pop(),f=u.pop();return e}function ntt(n){n.fixed|=2}function ttt(n){n.fixed&=-7}function itt(n){n.fixed|=4;n.px=n.x;n.py=n.y}function rtt(n){n.fixed&=-5}function rp(n,t,i){var f=0,e=0,u;if(n.charge=0,!n.leaf)for(var r,o=n.nodes,h=o.length,s=-1;++s<h;)r=o[s],null!=r&&(rp(r,t,i),n.charge+=r.charge,f+=r.charge*r.cx,e+=r.charge*r.cy);n.point&&(n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5),u=t*i[n.point.index],n.charge+=n.pointCharge=u,f+=u*n.point.x,e+=u*n.point.y);n.cx=f/n.charge;n.cy=e/n.charge}function nu(t,i){return n.rebind(t,i,"sort","children","value"),t.nodes=t,t.links=ott,t}function tu(n,t){for(var r,u,i=[n];null!=(n=i.pop());)if(t(n),(u=n.children)&&(r=u.length))for(;--r>=0;)i.push(u[r])}function st(n,t){for(var e,u,f,i=[n],r=[];null!=(n=i.pop());)if(r.push(n),(u=n.children)&&(e=u.length))for(f=-1;++f<e;)i.push(u[f]);for(;null!=(n=r.pop());)t(n)}function utt(n){return n.children}function ftt(n){return n.value}function ett(n,t){return t.value-n.value}function ott(t){return n.merge(t.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function stt(n){return n.x}function htt(n){return n.y}function ctt(n,t,i){n.y0=t;n.y=i}function bs(t){return n.range(t.length)}function ks(n){for(var t=-1,r=n[0].length,i=[];++t<r;)i[t]=0;return i}function ltt(n){for(var i,t=1,r=0,u=n[0][1],f=n.length;f>t;++t)(i=n[t][1])>u&&(r=t,u=i);return r}function att(n){return n.reduce(vtt,0)}function vtt(n,t){return n+t[1]}function ytt(n,t){return up(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function up(n,t){for(var i=-1,r=+n[0],f=(n[1]-r)/t,u=[];++i<=t;)u[i]=f*i+r;return u}function ptt(t){return[n.min(t),n.max(t)]}function wtt(n,t){return n.value-t.value}function ds(n,t){var i=n._pack_next;n._pack_next=t;t._pack_prev=n;t._pack_next=i;i._pack_prev=t}function fp(n,t){n._pack_next=t;t._pack_prev=n}function ep(n,t){var i=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>i*i+r*r}function op(n){function h(n){c=Math.min(n.x-n.r,c);l=Math.max(n.x+n.r,l);a=Math.min(n.y-n.r,a);v=Math.max(n.y+n.r,v)}if((u=n.children)&&(s=u.length)){var u,i,r,t,f,e,o,s,c=1/0,l=-1/0,a=1/0,v=-1/0;if(u.forEach(btt),i=u[0],i.x=-i.r,i.y=0,h(i),s>1&&(r=u[1],r.x=r.r,r.y=0,h(r),s>2))for(t=u[2],hp(i,r,t),h(t),ds(i,t),i._pack_prev=t,ds(t,r),r=i._pack_next,f=3;s>f;f++){hp(i,r,t=u[f]);var y=0,p=1,w=1;for(e=r._pack_next;e!==r;e=e._pack_next,p++)if(ep(e,t)){y=1;break}if(1==y)for(o=i._pack_prev;o!==e._pack_prev&&!ep(o,t);o=o._pack_prev,w++);y?(w>p||p==w&&r.r<i.r?fp(i,r=e):fp(i=o,r),f--):(ds(i,t),r=t,h(t))}var k=(c+l)/2,d=(a+v)/2,b=0;for(f=0;s>f;f++)t=u[f],t.x-=k,t.y-=d,b=Math.max(b,t.r+Math.sqrt(t.x*t.x+t.y*t.y));n.r=b;u.forEach(ktt)}}function btt(n){n._pack_next=n._pack_prev=n}function ktt(n){delete n._pack_next;delete n._pack_prev}function sp(n,t,i,r){var u=n.children,f,e;if(n.x=t+=r*n.x,n.y=i+=r*n.y,n.r*=r,u)for(f=-1,e=u.length;++f<e;)sp(u[f],t,i,r)}function hp(n,t,i){var r=n.r+i.r,f=t.x-n.x,e=t.y-n.y,u,o,s,h;r&&(f||e)?(u=t.r+i.r,o=f*f+e*e,u*=u,r*=r,s=.5+(r-u)/(2*o),h=Math.sqrt(Math.max(0,2*u*(r+o)-(r-=o)*r-u*u))/(2*o),i.x=n.x+s*f+h*e,i.y=n.y+s*e-h*f):(i.x=n.x+r,i.y=n.y)}function cp(n,t){return n.parent==t.parent?1:2}function gs(n){var t=n.children;return t.length?t[0]:n.t}function nh(n){var t,i=n.children;return(t=i.length)?i[t-1]:n.t}function dtt(n,t,i){var r=i/(t.i-n.i);t.c-=r;t.s+=i;n.c+=r;t.z+=i;t.m+=i}function gtt(n){for(var t,i=0,f=0,r=n.children,u=r.length;--u>=0;)t=r[u],t.z+=i,t.m+=i,i+=t.s+(f+=t.c)}function nit(n,t,i){return n.a.parent===t.parent?n.a:i}function tit(t){return 1+n.max(t,function(n){return n.y})}function iit(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function lp(n){var t=n.children;return t&&t.length?lp(t[0]):n}function ap(n){var i,t=n.children;return t&&(i=t.length)?ap(t[i-1]):n}function th(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function vp(n,t){var u=n.x+t[3],f=n.y+t[0],i=n.dx-t[1]-t[3],r=n.dy-t[0]-t[2];return 0>i&&(u+=i/2,i=0),0>r&&(f+=r/2,r=0),{x:u,y:f,dx:i,dy:r}}function or(n){var t=n[0],i=n[n.length-1];return i>t?[t,i]:[i,t]}function af(n){return n.rangeExtent?n.rangeExtent():or(n.range())}function rit(n,t,i,r){var u=i(n[0],n[1]),f=r(t[0],t[1]);return function(n){return f(u(n))}}function ih(n,t){var i,r=0,u=n.length-1,f=n[r],e=n[u];return f>e&&(i=r,r=u,u=i,i=f,f=e,e=i),n[r]=t.floor(f),n[u]=t.ceil(e),n}function uit(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:hb}function fit(t,i,r,u){var o=[],s=[],f=0,e=Math.min(t.length,i.length)-1;for(t[e]<t[0]&&(t=t.slice().reverse(),i=i.slice().reverse());++f<=e;)o.push(r(t[f-1],t[f])),s.push(u(i[f-1],i[f]));return function(i){var r=n.bisect(t,i,1,e)-1;return s[r](o[r](i))}}function yp(n,t,i,r){function f(){var f=Math.min(n.length,t.length)>2?fit:rit,s=r?kn:bn;return e=f(n,t,s,i),o=f(t,n,s,vi),u}function u(n){return e(n)}var e,o;return u.invert=function(n){return o(n)},u.domain=function(t){return arguments.length?(n=t.map(Number),f()):n},u.range=function(n){return arguments.length?(t=n,f()):t},u.rangeRound=function(n){return u.range(n).interpolate(ky)},u.clamp=function(n){return arguments.length?(r=n,f()):r},u.interpolate=function(n){return arguments.length?(i=n,f()):i},u.ticks=function(t){return uh(n,t)},u.tickFormat=function(t,i){return fh(n,t,i)},u.nice=function(t){return pp(n,t),f()},u.copy=function(){return yp(n,t,i,r)},f()}function rh(t,i){return n.rebind(t,i,"range","rangeRound","interpolate","clamp")}function pp(n,t){return ih(n,uit(iu(n,t)[2]))}function iu(n,t){null==t&&(t=10);var r=or(n),f=r[1]-r[0],i=Math.pow(10,Math.floor(Math.log(f/t)/Math.LN10)),u=t/f*i;return.15>=u?i*=10:.35>=u?i*=5:.75>=u&&(i*=2),r[0]=Math.ceil(r[0]/i)*i,r[1]=Math.floor(r[1]/i)*i+.5*i,r[2]=i,r}function uh(t,i){return n.range.apply(n,iu(t,i))}function fh(t,i,u){var e=iu(t,i),f,o;if(u){if(f=tb.exec(u),f.shift(),"s"===f[8])return o=n.formatPrefix(Math.max(r(e[0]),r(e[1]))),f[7]||(f[7]="."+vf(o.scale(e[2]))),f[8]="f",u=n.format(f.join("")),function(n){return u(o.scale(n))+o.symbol};f[7]||(f[7]="."+eit(f[8],e));u=f.join("")}else u=",."+vf(e[2])+"f";return n.format(u)}function vf(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function eit(n,t){var i=vf(t[2]);return n in cb?Math.abs(i-vf(Math.max(r(t[0]),r(t[1]))))+ +("e"!==n):i-2*("%"===n)}function wp(t,i,r,u){function e(n){return(r?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(i)}function o(n){return r?Math.pow(i,n):-Math.pow(i,-n)}function f(n){return t(e(n))}return f.invert=function(n){return o(t.invert(n))},f.domain=function(n){return arguments.length?(r=n[0]>=0,t.domain((u=n.map(Number)).map(e)),f):u},f.base=function(n){return arguments.length?(i=+n,t.domain(u.map(e)),f):i},f.nice=function(){var n=ih(u.map(e),r?Math:lb);return t.domain(n),u=n.map(o),f},f.ticks=function(){var h=or(u),t=[],c=h[0],l=h[1],n=Math.floor(e(c)),s=Math.ceil(e(l)),a=i%1?2:i,f;if(isFinite(s-n)){if(r){for(;s>n;n++)for(f=1;a>f;f++)t.push(o(n)*f);t.push(o(n))}else for(t.push(o(n));n++<s;)for(f=a-1;f>0;f--)t.push(o(n)*f);for(n=0;t[n]<c;n++);for(s=t.length;t[s-1]>l;s--);t=t.slice(n,s)}return t},f.tickFormat=function(t,i){if(!arguments.length)return kc;arguments.length<2?i=kc:"function"!=typeof i&&(i=n.format(i));var u,s=Math.max(.1,t/f.ticks().length),h=r?(u=1e-12,Math.ceil):(u=-1e-12,Math.floor);return function(n){return n/o(h(e(n)+u))<=s?i(n):""}},f.copy=function(){return wp(t.copy(),i,r,u)},rh(f,t)}function bp(n,t,i){function r(t){return n(u(t))}var u=yf(t),f=yf(1/t);return r.invert=function(t){return f(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((i=t.map(Number)).map(u)),r):i},r.ticks=function(n){return uh(i,n)},r.tickFormat=function(n,t){return fh(i,n,t)},r.nice=function(n){return r.domain(pp(i,n))},r.exponent=function(e){return arguments.length?(u=yf(t=e),f=yf(1/t),n.domain(i.map(u)),r):t},r.copy=function(){return bp(n.copy(),t,i)},rh(r,n)}function yf(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function kp(t,i){function r(n){return u[((f.get(n)||("range"===i.t?f.set(n,t.push(n)):NaN))-1)%u.length]}function o(i,r){return n.range(t.length).map(function(n){return i+r*n})}var f,u,e;return r.domain=function(n){if(!arguments.length)return t;t=[];f=new et;for(var u,e=-1,o=n.length;++e<o;)f.has(u=n[e])||f.set(u,t.push(u));return r[i.t].apply(r,i.a)},r.range=function(n){return arguments.length?(u=n,e=0,i={t:"range",a:arguments},r):u},r.rangePoints=function(n,f){arguments.length<2&&(f=0);var s=n[0],h=n[1],c=(h-s)/(Math.max(1,t.length-1)+f);return u=o(t.length<2?(s+h)/2:s+c*f/2,c),e=0,i={t:"rangePoints",a:arguments},r},r.rangeBands=function(n,f,s){arguments.length<2&&(f=0);arguments.length<3&&(s=f);var h=n[1]<n[0],l=n[+h],a=n[1-h],c=(a-l)/(t.length-f+2*s);return u=o(l+c*s,c),h&&u.reverse(),e=c*(1-f),i={t:"rangeBands",a:arguments},r},r.rangeRoundBands=function(n,f,s){arguments.length<2&&(f=0);arguments.length<3&&(s=f);var h=n[1]<n[0],c=n[+h],a=n[1-h],l=Math.floor((a-c)/(t.length-f+2*s)),v=a-c-(t.length-f)*l;return u=o(c+Math.round(v/2),l),h&&u.reverse(),e=Math.round(l*(1-f)),i={t:"rangeRoundBands",a:arguments},r},r.rangeBand=function(){return e},r.rangeExtent=function(){return or(i.a[0])},r.copy=function(){return kp(t,i)},r.domain(t)}function dp(t,i){function f(){var f=0,e=i.length;for(r=[];++f<e;)r[f-1]=n.quantile(t,f/e);return u}function u(t){if(!isNaN(t=+t))return i[n.bisect(r,t)]}var r;return u.domain=function(n){return arguments.length?(t=n.filter(au).sort(gi),f()):t},u.range=function(n){return arguments.length?(i=n,f()):i},u.quantiles=function(){return r},u.invertExtent=function(n){return n=i.indexOf(n),0>n?[NaN,NaN]:[n>0?r[n-1]:t[0],n<r.length?r[n]:t[t.length-1]]},u.copy=function(){return dp(t,i)},f()}function gp(n,t,i){function r(t){return i[Math.max(0,Math.min(e,Math.floor(u*(t-n))))]}function f(){return u=i.length/(t-n),e=i.length-1,r}var u,e;return r.domain=function(i){return arguments.length?(n=+i[0],t=+i[i.length-1],f()):[n,t]},r.range=function(n){return arguments.length?(i=n,f()):i},r.invertExtent=function(t){return t=i.indexOf(t),t=0>t?NaN:t/u+n,[t,t+1/u]},r.copy=function(){return gp(n,t,i)},f()}function nw(t,i){function r(r){if(r>=r)return i[n.bisect(t,r)]}return r.domain=function(n){return arguments.length?(t=n,r):t},r.range=function(n){return arguments.length?(i=n,r):i},r.invertExtent=function(n){return n=i.indexOf(n),[t[n-1],t[n]]},r.copy=function(){return nw(t,i)},r}function tw(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(i){return arguments.length?(n=i.map(t),t):n},t.ticks=function(t){return uh(n,t)},t.tickFormat=function(t,i){return fh(n,t,i)},t.copy=function(){return tw(n)},t}function oit(n){return n.innerRadius}function sit(n){return n.outerRadius}function iw(n){return n.startAngle}function rw(n){return n.endAngle}function uw(n){function t(t){function a(){l.push("M",i(n(s),e))}for(var c,l=[],s=[],h=-1,v=t.length,y=o(r),p=o(u);++h<v;)f.call(this,c=t[h],h)?s.push([+y.call(this,c,h),+p.call(this,c,h)]):s.length&&(a(),s=[]);return s.length&&a(),l.length?l.join(""):null}var r=ur,u=wr,f=rr,i=d,s=i.key,e=.7;return t.x=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(f=n,t):f},t.interpolate=function(n){return arguments.length?(s="function"==typeof n?i=n:(i=de.get(n)||d).key,t):s},t.tension=function(n){return arguments.length?(e=n,t):e},t}function d(n){return n.join("L")}function hit(n){return d(n)+"Z"}function cit(n){for(var r=0,u=n.length,t=n[0],i=[t[0],",",t[1]];++r<u;)i.push("H",(t[0]+(t=n[r])[0])/2,"V",t[1]);return u>1&&i.push("H",t[0]),i.join("")}function eh(n){for(var i=0,u=n.length,t=n[0],r=[t[0],",",t[1]];++i<u;)r.push("V",(t=n[i])[1],"H",t[0]);return r.join("")}function oh(n){for(var i=0,u=n.length,t=n[0],r=[t[0],",",t[1]];++i<u;)r.push("H",(t=n[i])[0],"V",t[1]);return r.join("")}function lit(n,t){return n.length<4?d(n):n[1]+pf(n.slice(1,n.length-1),sh(n,t))}function ait(n,t){return n.length<3?d(n):n[0]+pf((n.push(n[0]),n),sh([n[n.length-2]].concat(n,[n[1]]),t))}function vit(n,t){return n.length<3?d(n):n[0]+pf(n,sh(n,t))}function pf(n,t){var o,h;if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return d(n);var c=n.length!=t.length,f="",s=n[0],i=n[1],e=t[0],r=e,u=1;if(c&&(f+="Q"+(i[0]-2*e[0]/3)+","+(i[1]-2*e[1]/3)+","+i[0]+","+i[1],s=n[1],u=2),t.length>1)for(r=t[1],i=n[u],u++,f+="C"+(s[0]+e[0])+","+(s[1]+e[1])+","+(i[0]-r[0])+","+(i[1]-r[1])+","+i[0]+","+i[1],o=2;o<t.length;o++,u++)i=n[u],r=t[o],f+="S"+(i[0]-r[0])+","+(i[1]-r[1])+","+i[0]+","+i[1];return c&&(h=n[u],f+="Q"+(i[0]+2*r[0]/3)+","+(i[1]+2*r[1]/3)+","+h[0]+","+h[1]),f}function sh(n,t){for(var r,u=[],f=(1-t)/2,e=n[0],i=n[1],o=1,s=n.length;++o<s;)r=e,e=i,i=n[o],u.push([f*(i[0]-r[0]),f*(i[1]-r[1])]);return u}function fw(n){if(n.length<3)return d(n);var o=1,s=n.length,t=n[0],i=t[0],r=t[1],u=[i,i,i,(t=n[1])[0]],f=[r,r,r,t[1]],e=[i,",",r,"L",nt(si,u),",",nt(si,f)];for(n.push(n[s-1]);++o<=s;)t=n[o],u.shift(),u.push(t[0]),f.shift(),f.push(t[1]),hh(e,u,f);return n.pop(),e.push("L",t),e.join("")}function yit(n){if(n.length<4)return d(n);for(var t,f=[],i=-1,e=n.length,r=[0],u=[0];++i<3;)t=n[i],r.push(t[0]),u.push(t[1]);for(f.push(nt(si,r)+","+nt(si,u)),--i;++i<e;)t=n[i],r.shift(),r.push(t[0]),u.shift(),u.push(t[1]),hh(f,r,u);return f.join("")}function pit(n){for(var f,t,i=-1,e=n.length,o=e+4,r=[],u=[];++i<4;)t=n[i%e],r.push(t[0]),u.push(t[1]);for(f=[nt(si,r),",",nt(si,u)],--i;++i<o;)t=n[i%e],r.shift(),r.push(t[0]),u.shift(),u.push(t[1]),hh(f,r,u);return f.join("")}function wit(n,t){var i=n.length-1;if(i)for(var r,u,e=n[0][0],o=n[0][1],s=n[i][0]-e,h=n[i][1]-o,f=-1;++f<=i;)r=n[f],u=f/i,r[0]=t*r[0]+(1-t)*(e+u*s),r[1]=t*r[1]+(1-t)*(o+u*h);return fw(n)}function nt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function hh(n,t,i){n.push("C",nt(vb,t),",",nt(vb,i),",",nt(yb,t),",",nt(yb,i),",",nt(si,t),",",nt(si,i))}function ch(n,t){return(t[1]-n[1])/(t[0]-n[0])}function bit(n){for(var t=0,e=n.length-1,i=[],f=n[0],r=n[1],u=i[0]=ch(f,r);++t<e;)i[t]=(u+(u=ch(f=r,r=n[t+1])))/2;return i[t]=u,i}function kit(n){for(var e,o,s,u,c=[],f=bit(n),i=-1,h=n.length-1;++i<h;)e=ch(n[i],n[i+1]),r(e)<t?f[i]=f[i+1]=0:(o=f[i]/e,s=f[i+1]/e,u=o*o+s*s,u>9&&(u=3*e/Math.sqrt(u),f[i]=u*o,f[i+1]=u*s));for(i=-1;++i<=h;)u=(n[Math.min(h,i+1)][0]-n[Math.max(0,i-1)][0])/(6*(1+f[i]*f[i])),c.push([u||0,f[i]*u||0]);return c}function dit(n){return n.length<3?d(n):n[0]+pf(n,kit(n))}function ew(n){for(var t,i,r,u=-1,f=n.length;++u<f;)t=n[u],i=t[0],r=t[1]+oi,t[0]=i*Math.cos(r),t[1]=i*Math.sin(r);return n}function ow(n){function t(t){function b(){p.push("M",i(n(w),s),a,l(n(y.reverse()),s),"Z")}for(var v,k,d,p=[],y=[],w=[],c=-1,g=t.length,nt=o(f),tt=o(e),it=f===r?function(){return k}:o(r),rt=e===u?function(){return d}:o(u);++c<g;)h.call(this,v=t[c],c)?(y.push([k=+nt.call(this,v,c),d=+tt.call(this,v,c)]),w.push([+it.call(this,v,c),+rt.call(this,v,c)])):y.length&&(b(),y=[],w=[]);return y.length&&b(),p.length?p.join(""):null}var f=ur,r=ur,e=0,u=wr,h=rr,i=d,c=i.key,l=i,a="L",s=.7;return t.x=function(n){return arguments.length?(f=r=n,t):r},t.x0=function(n){return arguments.length?(f=n,t):f},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(e=u=n,t):u},t.y0=function(n){return arguments.length?(e=n,t):e},t.y1=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(h=n,t):h},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?i=n:(i=de.get(n)||d).key,l=i.reverse||i,a=i.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(s=n,t):s},t}function git(n){return n.radius}function sw(n){return[n.x,n.y]}function nrt(n){return function(){var t=n.apply(this,arguments),i=t[0],r=t[1]+oi;return[i*Math.cos(r),i*Math.sin(r)]}}function trt(){return 64}function irt(){return"circle"}function hw(n){var t=Math.sqrt(n/f);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function ru(n,t){return kf(n,l),n.id=t,n}function lh(n,t,i,r){var u=n.id;return dt(n,"function"==typeof i?function(n,f,e){n.__transition__[u].tween.set(t,r(i.call(n,n.__data__,f,e)))}:(i=r(i),function(n){n.__transition__[u].tween.set(t,i)}))}function rrt(n){return null==n&&(n=""),function(){this.textContent=n}}function wf(t,i,r,u){var e=t.__transition__||(t.__transition__={active:0,count:0}),f=e[r],o;f||(o=u.time,f=e[r]={tween:new et,time:o,ease:u.ease,delay:u.delay,duration:u.duration},++e.count,n.timer(function(u){function v(u){return e.active>r?s():(e.active=r,f.event&&f.event.start.call(t,h,i),f.tween.forEach(function(n,r){(r=r.call(t,h,i))&&a.push(r)}),n.timer(function(){return l.c=y(u||1)?rr:y,1},0,o),void 0)}function y(n){if(e.active!==r)return s();for(var u=n/w,c=p(u),o=a.length;o>0;)a[--o].call(t,c);if(u>=1)return(f.event&&f.event.end.call(t,h,i),s())}function s(){return--e.count?delete e[r]:delete t.__transition__,1}var h=t.__data__,p=f.ease,c=f.delay,w=f.duration,l=pt,a=[];return l.t=c+o,u>=c?v(u-c):(l.c=v,void 0)},0,o))}function cw(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function lw(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function ah(n){return n.toISOString()}function vh(t,i,r){function u(n){return t(n)}function f(t,r){var e=t[1]-t[0],f=e/r,u=n.bisect(to,f);return u==to.length?[i.year,iu(t.map(function(n){return n/31536e6}),r)[2]]:u?i[f/to[u-1]<to[u]/f?u-1:u]:[rut,iu(t,r)[2]]}return u.invert=function(n){return yi(t.invert(n))},u.domain=function(n){return arguments.length?(t.domain(n),u):t.domain().map(yi)},u.nice=function(n,t){function r(i){return!isNaN(i)&&!n.range(i,yi(+i+1),t).length}var e=u.domain(),o=or(e),i=null==n?f(o,10):"number"==typeof n&&f(o,n);return i&&(n=i[0],t=i[1]),u.domain(ih(e,t>1?{floor:function(t){for(;r(t=n.floor(t));)t=yi(t-1);return t},ceil:function(t){for(;r(t=n.ceil(t));)t=yi(+t+1);return t}}:n))},u.ticks=function(n,t){var i=or(u.domain()),r=null==n?f(i,10):"number"==typeof n?f(i,n):!n.range&&[{range:n},t];return r&&(n=r[0],t=r[1]),n.range(i[0],yi(+i[1]+1),1>t?1:t)},u.tickFormat=function(){return r},u.copy=function(){return vh(t.copy(),i,r)},rh(u,t)}function yi(n){return new Date(n)}function urt(n){return JSON.parse(n.responseText)}function frt(n){var t=rt.createRange();return t.selectNode(rt.body),t.createContextualFragment(n.responseText)}var n={version:"3.4.11"},yh,r,ti,uu,ph,e,df,ht,kh,gf,sr,pw,ne,ie,nc,bw,re,ue,fu,eu,ee,oe,se,he,pt,ic,nb,ct,rc,ou,uc,fc,ce,ii,k,sc,bi,hc,cc,lc,ac,vc,hu,lr,ki,ar,yc,cu,pc,wc,lu,be,ke,eb,bc,ob,sb,hb,cb,kc,lb,oi,ab,de,dc,gc,bb,rl,gb;Date.now||(Date.now=function(){return+new Date});var aw=[].slice,ni=function(n){return aw.call(n)},rt=document,yt=rt.documentElement,w=window;try{ni(yt.childNodes)[0].nodeType}catch(uut){ni=function(n){for(var t=n.length,i=new Array(t);t--;)i[t]=n[t];return i}}try{rt.createElement("div").style.setProperty("opacity",0,"")}catch(fut){var bf=w.Element.prototype,ert=bf.setAttribute,ort=bf.setAttributeNS,vw=w.CSSStyleDeclaration.prototype,srt=vw.setProperty;bf.setAttribute=function(n,t){ert.call(this,n,t+"")};bf.setAttributeNS=function(n,t,i){ort.call(this,n,t,i+"")};vw.setProperty=function(n,t,i){srt.call(this,n,t+"",i)}}n.ascending=gi;n.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:NaN};n.min=function(n,t){var i,u,r=-1,f=n.length;if(1===arguments.length){for(;++r<f&&!(null!=(i=n[r])&&i>=i);)i=void 0;for(;++r<f;)null!=(u=n[r])&&i>u&&(i=u)}else{for(;++r<f&&!(null!=(i=t.call(n,n[r],r))&&i>=i);)i=void 0;for(;++r<f;)null!=(u=t.call(n,n[r],r))&&i>u&&(i=u)}return i};n.max=function(n,t){var i,u,r=-1,f=n.length;if(1===arguments.length){for(;++r<f&&!(null!=(i=n[r])&&i>=i);)i=void 0;for(;++r<f;)null!=(u=n[r])&&u>i&&(i=u)}else{for(;++r<f&&!(null!=(i=t.call(n,n[r],r))&&i>=i);)i=void 0;for(;++r<f;)null!=(u=t.call(n,n[r],r))&&u>i&&(i=u)}return i};n.extent=function(n,t){var i,r,f,u=-1,e=n.length;if(1===arguments.length){for(;++u<e&&!(null!=(i=f=n[u])&&i>=i);)i=f=void 0;for(;++u<e;)null!=(r=n[u])&&(i>r&&(i=r),r>f&&(f=r))}else{for(;++u<e&&!(null!=(i=f=t.call(n,n[u],u))&&i>=i);)i=void 0;for(;++u<e;)null!=(r=t.call(n,n[u],u))&&(i>r&&(i=r),r>f&&(f=r))}return[i,f]};n.sum=function(n,t){var r,u=0,f=n.length,i=-1;if(1===arguments.length)for(;++i<f;)isNaN(r=+n[i])||(u+=r);else for(;++i<f;)isNaN(r=+t.call(n,n[i],i))||(u+=r);return u};n.mean=function(n,t){var r,f=0,e=n.length,i=-1,u=e;if(1===arguments.length)for(;++i<e;)au(r=n[i])?f+=r:--u;else for(;++i<e;)au(r=t.call(n,n[i],i))?f+=r:--u;if(u)return f/u};n.quantile=function(n,t){var u=(n.length-1)*t+1,i=Math.floor(u),r=+n[i-1],f=u-i;return f?r+f*(n[i]-r):r};n.median=function(t,i){return arguments.length>1&&(t=t.map(i)),t=t.filter(au),t.length?n.quantile(t.sort(gi),.5):void 0};yh=ul(gi);n.bisectLeft=yh.left;n.bisect=n.bisectRight=yh.right;n.bisector=function(n){return ul(1===n.length?function(t,i){return gi(n(t),i)}:n)};n.shuffle=function(n){for(var r,i,t=n.length;t;)i=0|Math.random()*t--,r=n[t],n[t]=n[i],n[i]=r;return n};n.permute=function(n,t){for(var i=t.length,r=new Array(i);i--;)r[i]=n[t[i]];return r};n.pairs=function(n){for(var f,t=0,i=n.length-1,r=n[0],u=new Array(0>i?0:i);i>t;)u[t]=[f=r,r=n[++t]];return u};n.zip=function(){var r,t,e;if(!(r=arguments.length))return[];for(var i=-1,u=n.min(arguments,nk),f=new Array(u);++i<u;)for(t=-1,e=f[i]=new Array(r);++t<r;)e[t]=arguments[t][i];return f};n.transpose=function(t){return n.zip.apply(n,t)};n.keys=function(n){var t=[];for(var i in n)t.push(i);return t};n.values=function(n){var t=[];for(var i in n)t.push(n[i]);return t};n.entries=function(n){var t=[];for(var i in n)t.push({key:i,value:n[i]});return t};n.merge=function(n){for(var t,i,r,u=n.length,e=-1,f=0;++e<u;)f+=n[e].length;for(i=new Array(f);--u>=0;)for(r=n[u],t=r.length;--t>=0;)i[--f]=r[t];return i};r=Math.abs;n.range=function(n,t,i){if(arguments.length<3&&(i=1,arguments.length<2&&(t=n,n=0)),1/0==(t-n)/i)throw new Error("infinite range");var f,e=[],u=tk(r(i)),o=-1;if(n*=u,t*=u,i*=u,0>i)for(;(f=n+i*++o)>t;)e.push(f/u);else for(;(f=n+i*++o)<t;)e.push(f/u);return e};n.map=function(n){var t=new et,i;if(n instanceof et)n.forEach(function(n,i){t.set(n,i)});else for(i in n)t.set(i,n[i]);return t};fl(et,{has:el,get:function(n){return this[ti+n]},set:function(n,t){return this[ti+n]=t},remove:ik,keys:ol,values:function(){var n=[];return this.forEach(function(t,i){n.push(i)}),n},entries:function(){var n=[];return this.forEach(function(t,i){n.push({key:t,value:i})}),n},size:sl,empty:hl,forEach:function(n){for(var t in this)t.charCodeAt(0)===uu&&n.call(this,t.substring(1),this[t])}});ti="\x00";uu=ti.charCodeAt(0);n.nest=function(){function r(n,e,o){if(o>=i.length)return f?f.call(t,e):u?e.sort(u):e;for(var l,s,h,a,v=-1,y=e.length,p=i[o++],c=new et;++v<y;)(a=c.get(l=p(s=e[v])))?a.push(s):c.set(l,[s]);return n?(s=n(),h=function(t,i){s.set(t,r(n,i,o))}):(s={},h=function(t,i){s[t]=r(n,i,o)}),c.forEach(h),s}function e(n,t){if(t>=i.length)return n;var r=[],u=o[t++];return n.forEach(function(n,i){r.push({key:n,values:e(i,t)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var u,f,t={},i=[],o=[];return t.map=function(n,t){return r(t,n,0)},t.entries=function(t){return e(r(n.map,t,0),0)},t.key=function(n){return i.push(n),t},t.sortKeys=function(n){return o[i.length-1]=n,t},t.sortValues=function(n){return u=n,t},t.rollup=function(n){return f=n,t},t};n.set=function(n){var i=new io,t,r;if(n)for(t=0,r=n.length;r>t;++t)i.add(n[t]);return i};fl(io,{has:el,add:function(n){return this[ti+n]=!0,n},remove:function(n){return n=ti+n,n in this&&delete this[n]},values:ol,size:sl,empty:hl,forEach:function(n){for(var t in this)t.charCodeAt(0)===uu&&n.call(this,t.substring(1))}});n.behavior={};n.rebind=function(n,t){for(var i,r=1,u=arguments.length;++r<u;)n[i=arguments[r]]=rk(n,t,t[i]);return n};ph=["webkit","ms","moz","Moz","o","O"];n.dispatch=function(){for(var n=new uo,t=-1,i=arguments.length;++t<i;)n[arguments[t]]=cl(n);return n};uo.prototype.on=function(n,t){var r=n.indexOf("."),i="";if(r>=0&&(i=n.substring(r+1),n=n.substring(0,r)),n)return arguments.length<2?this[n].on(i):this[n].on(i,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(i,null);return this}};n.event=null;n.requote=function(n){return n.replace(hrt,"\\$&")};var hrt=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,kf={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var i in t)n[i]=t[i]},wh=function(n,t){return t.querySelector(n)},bh=function(n,t){return t.querySelectorAll(n)},crt=yt.matches||yt[ro(yt,"matchesSelector")],yw=function(n,t){return crt.call(n,t)};"function"==typeof Sizzle&&(wh=function(n,t){return Sizzle(n,t)[0]||null},bh=Sizzle,yw=Sizzle.matchesSelector);n.selection=function(){return kh};e=n.selection.prototype=[];e.select=function(n){var i,f,e,t,o=[],r,s,u,h;for(n=oo(n),r=-1,s=this.length;++r<s;)for(o.push(i=[]),i.parentNode=(e=this[r]).parentNode,u=-1,h=e.length;++u<h;)(t=e[u])?(i.push(f=n.call(t,t.__data__,u,r)),f&&"__data__"in t&&(f.__data__=t.__data__)):i.push(null);return kt(o)};e.selectAll=function(n){var u,t,f=[],i,e;for(n=ll(n),i=-1,e=this.length;++i<e;)for(var o=this[i],r=-1,s=o.length;++r<s;)(t=o[r])&&(f.push(u=ni(n.call(t,t.__data__,r,i))),u.parentNode=t);return kt(f)};df={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};n.ns={prefix:df,qualify:function(n){var t=n.indexOf(":"),i=n;return t>=0&&(i=n.substring(0,t),n=n.substring(t+1)),df.hasOwnProperty(i)?{space:df[i],local:n}:n}};e.attr=function(t,i){if(arguments.length<2){if("string"==typeof t){var r=this.node();return t=n.ns.qualify(t),t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}for(i in t)this.each(al(i,t[i]));return this}return this.each(al(t,i))};e.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var r=this.node(),u=(n=pl(n)).length,i=-1;if(t=r.classList){for(;++i<u;)if(!t.contains(n[i]))return!1}else for(t=r.getAttribute("class");++i<u;)if(!yl(n[i]).test(t))return!1;return!0}for(t in n)this.each(wl(t,n[t]));return this}return this.each(wl(n,t))};e.style=function(n,t,i){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(i in n)this.each(bl(i,n[i],t));return this}if(2>r)return w.getComputedStyle(this.node(),null).getPropertyValue(n);i=""}return this.each(bl(n,t,i))};e.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(kl(t,n[t]));return this}return this.each(kl(n,t))};e.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent};e.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML};e.append=function(n){return n=dl(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})};e.insert=function(n,t){return n=dl(n),t=oo(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})};e.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})};e.data=function(n,t){function e(n,i){var r,u,o,l=n.length,a=i.length,k=Math.min(l,a),v=new Array(a),c=new Array(a),y=new Array(l);if(t){var e,p=new et,w=new et,b=[];for(r=-1;++r<l;)e=t.call(u=n[r],u.__data__,r),p.has(e)?y[r]=u:p.set(e,u),b.push(e);for(r=-1;++r<a;)e=t.call(i,o=i[r],r),(u=p.get(e))?(v[r]=u,u.__data__=o):w.has(e)||(c[r]=so(o)),w.set(e,o),p.remove(e);for(r=-1;++r<l;)p.has(b[r])&&(y[r]=n[r])}else{for(r=-1;++r<k;)u=n[r],o=i[r],u?(u.__data__=o,v[r]=u):c[r]=so(o);for(;a>r;++r)c[r]=so(i[r]);for(;l>r;++r)y[r]=n[r]}c.update=v;c.parentNode=v.parentNode=y.parentNode=n.parentNode;s.push(c);f.push(v);h.push(y)}var r,o,i=-1,u=this.length;if(!arguments.length){for(n=new Array(u=(r=this[0]).length);++i<u;)(o=r[i])&&(n[i]=o.__data__);return n}var s=na([]),f=kt([]),h=kt([]);if("function"==typeof n)for(;++i<u;)e(r=this[i],n.call(r,r.parentNode.__data__,i));else for(;++i<u;)e(r=this[i],n);return f.enter=function(){return s},f.exit=function(){return h},f};e.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")};e.filter=function(n){var u,f,r,e=[],t,o,i,s;for("function"!=typeof n&&(n=gl(n)),t=0,o=this.length;o>t;t++)for(e.push(u=[]),u.parentNode=(f=this[t]).parentNode,i=0,s=f.length;s>i;i++)(r=f[i])&&n.call(r,r.__data__,i,t)&&u.push(r);return kt(e)};e.order=function(){for(var i=-1,f=this.length;++i<f;)for(var t,r=this[i],u=r.length-1,n=r[u];--u>=0;)(t=r[u])&&(n&&n!==t.nextSibling&&n.parentNode.insertBefore(t,n),n=t);return this};e.sort=function(n){n=fk.apply(this,arguments);for(var t=-1,i=this.length;++t<i;)this[t].sort(n);return this.order()};e.each=function(n){return dt(this,function(t,i,r){n.call(t,t.__data__,i,r)})};e.call=function(n){var t=ni(arguments);return n.apply(t[0]=this,t),this};e.empty=function(){return!this.node()};e.node=function(){for(var i,n=0,r=this.length;r>n;n++)for(var u=this[n],t=0,f=u.length;f>t;t++)if(i=u[t],i)return i;return null};e.size=function(){var n=0;return this.each(function(){++n}),n};ht=[];n.selection.enter=na;n.selection.enter.prototype=ht;ht.append=e.append;ht.empty=e.empty;ht.node=e.node;ht.call=e.call;ht.size=e.size;ht.select=function(n){for(var i,h,r,e,o,t,u,s=[],f=-1,c=this.length;++f<c;)for(o=(t=this[f]).update,s.push(r=[]),r.parentNode=t.parentNode,i=-1,h=t.length;++i<h;)(u=t[i])?(r.push(o[i]=e=n.call(t.parentNode,u.__data__,i,f)),e.__data__=u.__data__):r.push(null);return kt(s)};ht.insert=function(n,t){return arguments.length<2&&(t=ek(this)),e.insert.call(this,n,t)};e.transition=function(){for(var i,n,r=di||++wb,u=[],o=ge||{time:Date.now(),ease:fn,delay:0,duration:250},f=-1,s=this.length;++f<s;){u.push(i=[]);for(var e=this[f],t=-1,h=e.length;++t<h;)(n=e[t])&&wf(n,t,r,o),i.push(n)}return ru(u,r)};e.interrupt=function(){return this.each(vu)};n.select=function(n){var t=["string"==typeof n?wh(n,rt):n];return t.parentNode=yt,kt([t])};n.selectAll=function(n){var t=ni("string"==typeof n?bh(n,rt):n);return t.parentNode=yt,kt([t])};kh=n.select(yt);e.on=function(n,t,i){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(i in n)this.each(ta(i,n[i],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;i=!1}return this.each(ta(n,t,i))};gf=n.map({mouseenter:"mouseover",mouseleave:"mouseout"});gf.forEach(function(n){"on"+n in rt&&gf.remove(n)});sr="onselectstart"in rt?null:ro(yt.style,"userSelect");pw=0;n.mouse=function(n){return ho(n,fo())};ne=/WebKit/.test(w.navigator.userAgent)?-1:0;n.touches=function(n,t){return arguments.length<2&&(t=fo().touches),t?ni(t).map(function(t){var i=ho(n,t);return i.identifier=t.identifier,i}):[]};n.behavior.drag=function(){function t(){this.on("mousedown.drag",f).on("touchstart.drag",e)}function r(t,r,f,e,o){return function(){function w(){var t,i,n=r(v,h);n&&(t=n[0]-c[0],i=n[1]-c[1],p|=t|i,c=n,y({type:"drag",x:n[0]+s[0],y:n[1]+s[1],dx:t,dy:i}))}function b(){r(v,h)&&(d.on(e+l,null).on(o+l,null),g(p&&n.event.target===k),y({type:"dragend"}))}var s,a=this,k=n.event.target,v=a.parentNode,y=u.of(a,arguments),p=0,h=t(),l=".drag"+(null==h?"":"-"+h),d=n.select(f()).on(e+l,w).on(o+l,b),g=yu(),c=r(v,h);i?(s=i.apply(a,arguments),s=[s.x-c[0],s.y-c[1]]):s=[0,0];y({type:"dragstart"})}}var u=eo(t,"drag","dragstart","dragend"),i=null,f=r(c,n.mouse,ck,"mousemove","mouseup"),e=r(sk,n.touch,hk,"touchmove","touchend");return t.origin=function(n){return arguments.length?(i=n,t):i},n.rebind(t,u,"on")};var f=Math.PI,g=2*f,v=f/2,t=1e-6,dh=t*t,u=f/180,s=180/f,te=Math.SQRT2,gh=2,ww=4;n.interpolateZoom=function(n,t){function v(n){var t=n*p,r,h;return y?(r=fa(u),h=i/(gh*c)*(r*ak(te*t+u)-lk(u)),[o+h*f,s+h*e,i*r/fa(te*t+u)]):[o+n*f,s+n*e,i*Math.exp(te*t)]}var o=n[0],s=n[1],i=n[2],w=t[0],b=t[1],r=t[2],f=w-o,e=b-s,h=f*f+e*e,c=Math.sqrt(h),l=(r*r-i*i+ww*h)/(2*i*gh*c),a=(r*r-i*i-ww*h)/(2*r*gh*c),u=Math.log(Math.sqrt(l*l+1)-l),k=Math.log(Math.sqrt(a*a+1)-a),y=k-u,p=(y||Math.log(r/i))/te;return v.duration=1e3*p,v};n.behavior.zoom=function(){function i(n){n.on(nt,it).on(bw+".zoom",ht).on("dblclick.zoom",ct).on(tt,rt)}function s(n){return[(n[0]-t.x)/t.k,(n[1]-t.y)/t.k]}function st(n){return[n[0]*t.k+t.x,n[1]*t.k+t.y]}function h(n){t.k=Math.max(y[0],Math.min(y[1],n))}function o(n,i){i=st(i);t.x+=n[0]-i[0];t.y+=n[1]-i[1]}function p(){l&&l.domain(d.range().map(function(n){return(n-t.x)/t.k}).map(d.invert));a&&a.domain(g.range().map(function(n){return(n-t.y)/t.k}).map(g.invert))}function u(n){n({type:"zoomstart"})}function r(n){p();n({type:"zoom",scale:t.k,translate:[t.x,t.y]})}function f(n){n({type:"zoomend"})}function it(){function c(){h=1;o(n.mouse(t),y);r(i)}function l(){v.on(et,null).on(ot,null);p(h&&n.event.target===a);f(i)}var t=this,a=n.event.target,i=e.of(t,arguments),h=0,v=n.select(w).on(et,c).on(ot,l),y=s(n.mouse(t)),p=yu();vu.call(t);u(i)}function rt(){function y(){var r=n.touches(c);return w=t.k,r.forEach(function(n){n.identifier in i&&(i[n.identifier]=s(n))}),r}function p(){var c=n.event.target,u,s,f,p;n.select(c).on(ut,d).on(ft,g);b.push(c);for(var v=n.event.changedTouches,e=0,it=v.length;it>e;++e)i[v[e].identifier]=null;if(u=y(),s=Date.now(),1===u.length)500>s-k&&(f=u[0],p=i[f.identifier],h(2*t.k),o(f,p),bt(),r(l)),k=s;else if(u.length>1){var f=u[0],w=u[1],nt=f[0]-w[0],tt=f[1]-w[1];a=nt*nt+tt*tt}}function d(){for(var s,p,t,f,u,e,y=n.touches(c),v=0,b=y.length;b>v;++v,e=null)if(u=y[v],e=i[u.identifier]){if(f)break;t=u;f=e}e&&(s=(s=u[0]-t[0])*s+(s=u[1]-t[1])*s,p=a&&Math.sqrt(s/a),t=[(t[0]+u[0])/2,(t[1]+u[1])/2],f=[(f[0]+e[0])/2,(f[1]+e[1])/2],h(p*w));k=null;o(t,f);r(l)}function g(){var e;if(n.event.touches.length){for(var r=n.event.changedTouches,t=0,u=r.length;u>t;++t)delete i[r[t].identifier];for(e in i)return void y()}n.selectAll(b).on(v,null);et.on(nt,it).on(tt,rt);ot();f(l)}var w,c=this,l=e.of(c,arguments),i={},a=0,v=".zoom-"+n.event.changedTouches[0].identifier,ut="touchmove"+v,ft="touchend"+v,b=[],et=n.select(c).on(nt,null).on(tt,p),ot=yu();vu.call(c);p();u(l)}function ht(){var i=e.of(this,arguments);c?clearTimeout(c):(ut=s(ft=b||n.mouse(this)),vu.call(this),u(i));c=setTimeout(function(){c=null;f(i)},50);bt();h(Math.pow(2,.002*ie())*t.k);o(ft,ut);r(i)}function ct(){var i=e.of(this,arguments),c=n.mouse(this),a=s(c),l=Math.log(t.k)/Math.LN2;u(i);h(Math.pow(2,n.event.shiftKey?Math.ceil(l)-1:Math.floor(l)+1));o(c,a);r(i);f(i)}var ut,ft,b,c,k,d,l,g,a,t={x:0,y:0,k:1},v=[960,500],y=nc,nt="mousedown.zoom",et="mousemove.zoom",ot="mouseup.zoom",tt="touchstart.zoom",e=eo(i,"zoomstart","zoom","zoomend");return i.event=function(i){i.each(function(){var i=e.of(this,arguments),o=t;di?n.select(this).transition().each("start.zoom",function(){t=this.__chart__||{x:0,y:0,k:1};u(i)}).tween("zoom:zoom",function(){var u=v[0],s=v[1],f=u/2,e=s/2,h=n.interpolateZoom([(f-t.x)/t.k,(e-t.y)/t.k,u/t.k],[(f-o.x)/o.k,(e-o.y)/o.k,u/o.k]);return function(n){var o=h(n),s=u/o[2];this.__chart__=t={x:f-o[0]*s,y:e-o[1]*s,k:s};r(i)}}).each("end.zoom",function(){f(i)}):(this.__chart__=t,u(i),r(i),f(i))})},i.translate=function(n){return arguments.length?(t={x:+n[0],y:+n[1],k:t.k},p(),i):[t.x,t.y]},i.scale=function(n){return arguments.length?(t={x:t.x,y:t.y,k:+n},p(),i):t.k},i.scaleExtent=function(n){return arguments.length?(y=null==n?nc:[+n[0],+n[1]],i):y},i.center=function(n){return arguments.length?(b=n&&[+n[0],+n[1]],i):b},i.size=function(n){return arguments.length?(v=n&&[+n[0],+n[1]],i):v},i.x=function(n){return arguments.length?(l=n,d=n.copy(),t={x:0,y:0,k:1},i):l},i.y=function(n){return arguments.length?(a=n,g=n.copy(),t={x:0,y:0,k:1},i):a},n.rebind(i,e,"on")};nc=[0,1/0];bw="onwheel"in rt?(ie=function(){return-n.event.deltaY*(n.event.deltaMode?120:1)},"wheel"):"onmousewheel"in rt?(ie=function(){return n.event.wheelDelta},"mousewheel"):(ie=function(){return-n.event.detail},"MozMousePixelScroll");n.color=hi;hi.prototype.toString=function(){return this.rgb()+""};n.hsl=ot;re=ot.prototype=new hi;re.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new ot(this.h,this.s,this.l/n)};re.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new ot(this.h,this.s,n*this.l)};re.rgb=function(){return lo(this.h,this.s,this.l)};n.hcl=tt;ue=tt.prototype=new hi;ue.brighter=function(n){return new tt(this.h,this.c,Math.min(100,this.l+fe*(arguments.length?n:1)))};ue.darker=function(n){return new tt(this.h,this.c,Math.max(0,this.l-fe*(arguments.length?n:1)))};ue.rgb=function(){return ao(this.h,this.c,this.l).rgb()};n.lab=it;var fe=18,kw=.95047,dw=1,gw=1.08883,tc=it.prototype=new hi;tc.brighter=function(n){return new it(Math.min(100,this.l+fe*(arguments.length?n:1)),this.a,this.b)};tc.darker=function(n){return new it(Math.max(0,this.l-fe*(arguments.length?n:1)),this.a,this.b)};tc.rgb=function(){return oa(this.l,this.a,this.b)};n.rgb=b;fu=b.prototype=new hi;fu.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var i=this.r,r=this.g,u=this.b,t=30;return i||r||u?(i&&t>i&&(i=t),r&&t>r&&(r=t),u&&t>u&&(u=t),new b(Math.min(255,i/n),Math.min(255,r/n),Math.min(255,u/n))):new b(t,t,t)};fu.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new b(n*this.r,n*this.g,n*this.b)};fu.hsl=function(){return la(this.r,this.g,this.b)};fu.toString=function(){return"#"+tr(this.r)+tr(this.g)+tr(this.b)};eu=n.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});eu.forEach(function(n,t){eu.set(n,ha(t))});n.functor=o;n.xhr=ko(a);n.dsv=function(n,t){function i(n,i,r){arguments.length<3&&(r=i,i=null);var e=wu(n,t,null==i?u:f(i),r);return e.row=function(n){return arguments.length?e.response(null==(i=n)?u:f(n)):i},e}function u(n){return i.parse(n.responseText)}function f(n){return function(t){return i.parse(t.responseText,n)}}function e(t){return t.map(r).join(n)}function r(n){return o.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var o=new RegExp('["'+n+"\n]"),s=n.charCodeAt(0);return i.parse=function(n,t){var r;return i.parseRows(n,function(n,i){if(r)return r(n,i-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,i){return t(u(n),i)}:u})},i.parseRows=function(n,t){function h(){var f,t,u,h;if(i>=o)return e;if(r)return r=!1,c;if(f=i,34===n.charCodeAt(f)){for(t=f;t++<o;)if(34===n.charCodeAt(t)){if(34!==n.charCodeAt(t+1))break;++t}return i=t+2,u=n.charCodeAt(t+1),13===u?(r=!0,10===n.charCodeAt(t+2)&&++i):10===u&&(r=!0),n.substring(f+1,t).replace(/""/g,'"')}for(;o>i;){if(u=n.charCodeAt(i++),h=1,10===u)r=!0;else if(13===u)r=!0,10===n.charCodeAt(i)&&(++i,++h);else if(u!==s)continue;return n.substring(f,i-h)}return n.substring(f)}for(var f,u,r,c={},e={},l=[],o=n.length,i=0,a=0;(u=h())!==e;){for(f=[];u!==c&&u!==e;)f.push(u),u=h();(!t||(f=t(f,a++)))&&l.push(f)}return l},i.format=function(t){if(Array.isArray(t[0]))return i.formatRows(t);var f=new io,u=[];return t.forEach(function(n){for(var t in n)f.has(t)||u.push(f.add(t))}),[u.map(r).join(n)].concat(t.map(function(t){return u.map(function(n){return r(t[n])}).join(n)})).join("\n")},i.formatRows=function(n){return n.map(e).join("\n")},i};n.csv=n.dsv(",","text/csv");n.tsv=n.dsv("\t","text/tab-separated-values");n.touch=function(n,t,i){if(arguments.length<3&&(i=t,t=fo().changedTouches),t)for(var u,r=0,f=t.length;f>r;++r)if((u=t[r]).identifier===i)return ho(n,u)};ic=w[ro(w,"requestAnimationFrame")]||function(n){setTimeout(n,17)};n.timer=function(n,t,i){var u=arguments.length,f,r;2>u&&(t=0);3>u&&(i=Date.now());f=i+t;r={c:n,t:f,f:!1,n:null};oe?oe.n=r:ee=r;oe=r;se||(he=clearTimeout(he),se=1,ic(go))};n.timer.flush=function(){va();ya()};n.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};nb=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(yk);n.formatPrefix=function(t,i){var r=0;return t&&(0>t&&(t*=-1),i&&(t=n.round(t,ns(t,i))),r=1+Math.floor(1e-12+Math.log(t)/Math.LN10),r=Math.max(-24,Math.min(24,3*Math.floor((r-1)/3)))),nb[8+r/3]};var tb=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,lrt=n.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(t,i){return(t=n.round(t,ns(t,i))).toFixed(Math.max(0,Math.min(20,ns(t*(1+1e-15),i))))}}),i=n.time={},y=Date;at.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ct.setUTCDate.apply(this._,arguments)},setDay:function(){ct.setUTCDay.apply(this._,arguments)},setFullYear:function(){ct.setUTCFullYear.apply(this._,arguments)},setHours:function(){ct.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ct.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ct.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ct.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ct.setUTCSeconds.apply(this._,arguments)},setTime:function(){ct.setTime.apply(this._,arguments)}};ct=Date.prototype;i.year=ci(function(n){return n=i.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()});i.years=i.year.range;i.years.utc=i.year.utc.range;i.day=ci(function(n){var t=new y(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1});i.days=i.day.range;i.days.utc=i.day.utc.range;i.dayOfYear=function(n){var t=i.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var r=i[n]=ci(function(n){return(n=i.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var r=i.year(n).getDay();return Math.floor((i.dayOfYear(n)+(r+t)%7)/7)-(r!==t)});i[n+"s"]=r.range;i[n+"s"].utc=r.utc.range;i[n+"OfYear"]=function(n){var r=i.year(n).getDay();return Math.floor((i.dayOfYear(n)+(r+t)%7)/7)}});i.week=i.sunday;i.weeks=i.sunday.range;i.weeks.utc=i.sunday.utc.range;i.weekOfYear=i.sundayOfYear;var ib={"-":"",_:" ",0:"0"},h=/^\s*\d+/,rb=/^%/;n.locale=function(n){return{numberFormat:pk(n),timeFormat:bk(n)}};rc=n.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});n.format=rc.numberFormat;n.geo={};ts.prototype={s:0,t:0,add:function(n){ba(n,this.t,ou);ba(ou.s,this.s,this);this.s?this.t+=ou.t:this.s=ou.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};ou=new ts;n.geo.stream=function(n,t){n&&uc.hasOwnProperty(n.type)?uc[n.type](n,t):gu(n,t)};uc={Feature:function(n,t){gu(n.geometry,t)},FeatureCollection:function(n,t){for(var i=n.features,r=-1,u=i.length;++r<u;)gu(i[r].geometry,t)}};fc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates;t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var i=n.coordinates,r=-1,u=i.length;++r<u;)n=i[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){is(n.coordinates,t,0)},MultiLineString:function(n,t){for(var i=n.coordinates,r=-1,u=i.length;++r<u;)is(i[r],t,0)},Polygon:function(n,t){ka(n.coordinates,t)},MultiPolygon:function(n,t){for(var i=n.coordinates,r=-1,u=i.length;++r<u;)ka(i[r],t)},GeometryCollection:function(n,t){for(var i=n.geometries,r=-1,u=i.length;++r<u;)gu(i[r],t)}};n.geo.area=function(t){return ce=0,n.geo.stream(t,k),ce};ii=new ts;k={sphere:function(){ce+=4*f},point:c,lineStart:c,lineEnd:c,polygonStart:function(){ii.reset();k.lineStart=ad},polygonEnd:function(){var n=2*ii;ce+=0>n?4*f+n:n;k.lineStart=k.lineEnd=k.point=c}};n.geo.bounds=function(){function w(n,t){v.push(l=[i=n,f=n]);o>t&&(o=t);t>h&&(h=t)}function b(n,t){var d=li([n*u,t*u]),v;if(y){var b=ir(y,d),nt=[b[1],-b[0],0],c=ir(nt,b);rf(c);c=uf(c);var g=n-a,p=g>0?1:-1,l=c[0]*s*p,k=r(g)>180;k^(l>p*a&&p*n>l)?(v=c[1]*s,v>h&&(h=v)):(l=(l+360)%360-180,k^(l>p*a&&p*n>l))?(v=-c[1]*s,o>v&&(o=v)):(o>t&&(o=t),t>h&&(h=t));k?a>n?e(i,n)>e(i,f)&&(f=n):e(n,f)>e(i,f)&&(i=n):f>=i?(i>n&&(i=n),n>f&&(f=n)):n>a?e(i,n)>e(i,f)&&(f=n):e(n,f)>e(i,f)&&(i=n)}else w(n,t);y=d;a=n}function d(){c.point=b}function g(){l[0]=i;l[1]=f;c.point=w;y=null}function nt(n,t){if(y){var i=n-a;p+=r(i)>180?i+(i>0?360:-360):i}else it=n,rt=t;k.point(n,t);b(n,t)}function ut(){k.lineStart()}function ft(){nt(it,rt);k.lineEnd();r(p)>t&&(i=-(f=180));l[0]=i;l[1]=f;y=null}function e(n,t){return(t-=n)<0?t+360:t}function et(n,t){return n[0]-t[0]}function tt(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var i,o,f,h,a,it,rt,y,p,v,l,c={point:w,lineStart:d,lineEnd:g,polygonStart:function(){c.point=nt;c.lineStart=ut;c.lineEnd=ft;p=0;k.polygonStart()},polygonEnd:function(){k.polygonEnd();c.point=w;c.lineStart=d;c.lineEnd=g;0>ii?(i=-(f=180),o=-(h=90)):p>t?h=90:-t>p&&(o=-90);l[0]=i;l[1]=f}};return function(t){var a;if(h=f=-(i=o=1/0),v=[],n.geo.stream(t,c),a=v.length,a){v.sort(et);for(var u,s=1,r=v[0],y=[r];a>s;++s)u=v[s],tt(u[0],r)||tt(u[1],r)?(e(r[0],u[1])>e(r[0],r[1])&&(r[1]=u[1]),e(u[0],r[1])>e(r[0],r[1])&&(r[0]=u[0])):y.push(r=u);for(var p,u,w=-1/0,a=y.length-1,s=0,r=y[a];a>=s;r=u,++s)u=y[s],(p=e(r[1],u[0]))>w&&(w=p,i=u[0],f=r[1])}return v=l=null,1/0===i||1/0===o?[[NaN,NaN],[NaN,NaN]]:[[i,o],[f,h]]}}();n.geo.centroid=function(i){su=le=pi=wi=wt=ri=ui=lt=hr=cr=fi=0;n.geo.stream(i,ut);var r=hr,u=cr,f=fi,e=r*r+u*u+f*f;return dh>e&&(r=ri,u=ui,f=lt,t>le&&(r=pi,u=wi,f=wt),e=r*r+u*u+f*f,dh>e)?[NaN,NaN]:[Math.atan2(u,r)*s,nr(f/Math.sqrt(e))*s]};var su,le,pi,wi,wt,ri,ui,lt,hr,cr,fi,ut={sphere:c,point:us,lineStart:da,lineEnd:ga,polygonStart:function(){ut.lineStart=vd},polygonEnd:function(){ut.lineStart=da}},ub=iv(rr,bd,dd,[-f,-f/2]),ae=1e9;n.geo.clipExtent=function(){var t,i,r,u,n,f,e={stream:function(t){return n&&(n.valid=!1),n=f(t),n.valid=!0,n},extent:function(o){return arguments.length?(f=fv(t=+o[0][0],i=+o[0][1],r=+o[1][0],u=+o[1][1]),n&&(n.valid=!1,n=null),e):[[t,i],[r,u]]}};return e.extent([[0,0],[960,500]])};(n.geo.conicEqualArea=function(){return fs(ov)}).raw=ov;n.geo.albers=function(){return n.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};n.geo.albersUsa=function(){function r(n){var t=n[0],i=n[1];return u=null,s(t,i),u||(h(t,i),u)||c(t,i),u}var u,s,h,c,i=n.geo.albers(),f=n.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),e=n.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),o={point:function(n,t){u=[n,t]}};return r.invert=function(n){var u=i.scale(),o=i.translate(),t=(n[0]-o[0])/u,r=(n[1]-o[1])/u;return(r>=.12&&.234>r&&t>=-.425&&-.214>t?f:r>=.166&&.234>r&&t>=-.214&&-.115>t?e:i).invert(n)},r.stream=function(n){var t=i.stream(n),r=f.stream(n),u=e.stream(n);return{point:function(n,i){t.point(n,i);r.point(n,i);u.point(n,i)},sphere:function(){t.sphere();r.sphere();u.sphere()},lineStart:function(){t.lineStart();r.lineStart();u.lineStart()},lineEnd:function(){t.lineEnd();r.lineEnd();u.lineEnd()},polygonStart:function(){t.polygonStart();r.polygonStart();u.polygonStart()},polygonEnd:function(){t.polygonEnd();r.polygonEnd();u.polygonEnd()}}},r.precision=function(n){return arguments.length?(i.precision(n),f.precision(n),e.precision(n),r):i.precision()},r.scale=function(n){return arguments.length?(i.scale(n),f.scale(.35*n),e.scale(n),r.translate(i.translate())):i.scale()},r.translate=function(n){if(!arguments.length)return i.translate();var u=i.scale(),l=+n[0],a=+n[1];return s=i.translate(n).clipExtent([[l-.455*u,a-.238*u],[l+.455*u,a+.238*u]]).stream(o).point,h=f.translate([l-.307*u,a+.201*u]).clipExtent([[l-.425*u+t,a+.12*u+t],[l-.214*u-t,a+.234*u-t]]).stream(o).point,c=e.translate([l-.205*u,a+.212*u]).clipExtent([[l-.214*u+t,a+.166*u+t],[l-.115*u-t,a+.234*u-t]]).stream(o).point,r},r.scale(1070)};var ec,oc,ve,ye,pe,we,ei={point:c,lineStart:c,lineEnd:c,polygonStart:function(){oc=0;ei.lineStart=ng},polygonEnd:function(){ei.lineStart=ei.lineEnd=ei.point=c;ec+=r(oc/2)}},art={point:tg,lineStart:c,lineEnd:c,polygonStart:c,polygonEnd:c},ft={point:ai,lineStart:hv,lineEnd:cv,polygonStart:function(){ft.lineStart=rg},polygonEnd:function(){ft.point=ai;ft.lineStart=hv;ft.lineEnd=cv}};n.geo.path=function(){function t(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),f&&f.valid||(f=u(i)),n.geo.stream(t,f)),i.result()}function e(){return f=null,t}var o,s,u,i,f,r=4.5;return t.area=function(t){return ec=0,n.geo.stream(t,u(ei)),ec},t.centroid=function(t){return pi=wi=wt=ri=ui=lt=hr=cr=fi=0,n.geo.stream(t,u(ft)),fi?[hr/fi,cr/fi]:lt?[ri/lt,ui/lt]:wt?[pi/wt,wi/wt]:[NaN,NaN]},t.bounds=function(t){return pe=we=-(ve=ye=1/0),n.geo.stream(t,u(art)),[[ve,ye],[pe,we]]},t.projection=function(n){return arguments.length?(u=(o=n)?n.stream||fg(n):a,e()):o},t.context=function(n){return arguments.length?(i=null==(s=n)?new ig:new ug(n),"function"!=typeof r&&i.pointRadius(r),e()):s},t.pointRadius=function(n){return arguments.length?(r="function"==typeof n?n:(i.pointRadius(+n),+n),t):r},t.projection(n.geo.albersUsa()).context(null)};n.geo.transform=function(n){return{stream:function(t){var i=new av(t);for(var r in n)i[r]=n[r];return i}}};av.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};n.geo.projection=gt;n.geo.projectionMutator=es;(n.geo.equirectangular=function(){return gt(yr)}).raw=yr.invert=yr;n.geo.rotation=function(n){function t(t){return t=n(t[0]*u,t[1]*u),t[0]*=s,t[1]*=s,t}return n=os(n[0]%360*u,n[1]*u,n.length>2?n[2]*u:0),t.invert=function(t){return t=n.invert(t[0]*u,t[1]*u),t[0]*=s,t[1]*=s,t},t};pv.invert=yr;n.geo.circle=function(){function n(){var n="function"==typeof t?t.apply(this,arguments):t,f=os(-n[0]*u,-n[1]*u,0).invert,i=[];return r(null,null,1,{point:function(n,t){i.push(n=f(n,t));n[0]*=s;n[1]*=s}}),{type:"Polygon",coordinates:[i]}}var i,r,t=[0,0],f=6;return n.origin=function(i){return arguments.length?(t=i,n):t},n.angle=function(t){return arguments.length?(r=ss((i=+t)*u,f*u),n):i},n.precision=function(t){return arguments.length?(r=ss(i*u,(f=+t)*u),n):f},n.angle(90)};n.geo.distance=function(n,t){var i,f=(t[0]-n[0])*u,e=n[1]*u,o=t[1]*u,a=Math.sin(f),s=Math.cos(f),h=Math.sin(e),c=Math.cos(e),l=Math.sin(o),r=Math.cos(o);return Math.atan2(Math.sqrt((i=r*a)*i+(i=c*l-h*r*s)*i),h*l+c*r*s)};n.geo.graticule=function(){function i(){return{type:"MultiLineString",coordinates:d()}}function d(){return n.range(Math.ceil(f/v)*v,u,v).map(b).concat(n.range(Math.ceil(o/y)*y,e,y).map(k)).concat(n.range(Math.ceil(h/a)*a,s,a).filter(function(n){return r(n%v)>t}).map(g)).concat(n.range(Math.ceil(l/w)*w,c,w).filter(function(n){return r(n%y)>t}).map(nt))}var s,h,u,f,c,l,e,o,g,nt,b,k,a=10,w=a,v=90,y=360,p=2.5;return i.lines=function(){return d().map(function(n){return{type:"LineString",coordinates:n}})},i.outline=function(){return{type:"Polygon",coordinates:[b(f).concat(k(e).slice(1),b(u).reverse().slice(1),k(o).reverse().slice(1))]}},i.extent=function(n){return arguments.length?i.majorExtent(n).minorExtent(n):i.minorExtent()},i.majorExtent=function(n){return arguments.length?(f=+n[0][0],u=+n[1][0],o=+n[0][1],e=+n[1][1],f>u&&(n=f,f=u,u=n),o>e&&(n=o,o=e,e=n),i.precision(p)):[[f,o],[u,e]]},i.minorExtent=function(n){return arguments.length?(h=+n[0][0],s=+n[1][0],l=+n[0][1],c=+n[1][1],h>s&&(n=h,h=s,s=n),l>c&&(n=l,l=c,c=n),i.precision(p)):[[h,l],[s,c]]},i.step=function(n){return arguments.length?i.majorStep(n).minorStep(n):i.minorStep()},i.majorStep=function(n){return arguments.length?(v=+n[0],y=+n[1],i):[v,y]},i.minorStep=function(n){return arguments.length?(a=+n[0],w=+n[1],i):[a,w]},i.precision=function(n){return arguments.length?(p=+n,g=gv(l,c,90),nt=ny(h,s,p),b=gv(o,e,90),k=ny(f,u,p),i):p},i.majorExtent([[-180,-90+t],[180,90-t]]).minorExtent([[-180,-80-t],[180,80+t]])};n.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[u||i.apply(this,arguments),f||r.apply(this,arguments)]}}var u,f,i=hs,r=cs;return t.distance=function(){return n.geo.distance(u||i.apply(this,arguments),f||r.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,u="function"==typeof n?null:n,t):i},t.target=function(n){return arguments.length?(r=n,f="function"==typeof n?null:n,t):r},t.precision=function(){return arguments.length?t:0},t};n.geo.interpolate=function(n,t){return eg(n[0]*u,n[1]*u,t[0]*u,t[1]*u)};n.geo.length=function(t){return sc=0,n.geo.stream(t,bi),sc};bi={sphere:c,point:c,lineStart:og,lineEnd:c,polygonStart:c,polygonEnd:c};hc=pr(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(n.geo.azimuthalEqualArea=function(){return gt(hc)}).raw=hc;cc=pr(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},a);(n.geo.azimuthalEquidistant=function(){return gt(cc)}).raw=cc;(n.geo.conicConformal=function(){return fs(ty)}).raw=ty;(n.geo.conicEquidistant=function(){return fs(iy)}).raw=iy;lc=pr(function(n){return 1/n},Math.atan);(n.geo.gnomonic=function(){return gt(lc)}).raw=lc;of.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-v]};(n.geo.mercator=function(){return ry(of)}).raw=of;ac=pr(function(){return 1},Math.asin);(n.geo.orthographic=function(){return gt(ac)}).raw=ac;vc=pr(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(n.geo.stereographic=function(){return gt(vc)}).raw=vc;ls.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-v]};(n.geo.transverseMercator=function(){var n=ry(ls),i=n.center,t=n.rotate;return n.center=function(n){return n?i([-n[1],n[0]]):(n=i(),[n[1],-n[0]])},n.rotate=function(n){return n?t([n[0],n[1],n.length>2?n[2]+90:90]):(n=t(),[n[0],n[1],n[2]-90])},t([0,0,90])}).raw=ls;n.geom={};n.geom.hull=function(n){function t(n){if(n.length<3)return[];for(var l=o(i),a=o(r),h=n.length,u=[],c=[],t=0;h>t;t++)u.push([+l.call(this,n[t],t),+a.call(this,n[t],t),t]);for(u.sort(sg),t=0;h>t;t++)c.push([u[t][0],-u[t][1]]);var f=uy(u),e=uy(c),v=e[0]===f[0],y=e[e.length-1]===f[f.length-1],s=[];for(t=f.length-1;t>=0;--t)s.push(n[u[f[t]][2]]);for(t=+v;t<e.length-y;++t)s.push(n[u[e[t]][2]]);return s}var i=ur,r=wr;return arguments.length?t(n):(t.x=function(n){return arguments.length?(i=n,t):i},t.y=function(n){return arguments.length?(r=n,t):r},t)};n.geom.polygon=function(n){return kf(n,hu),n};hu=n.geom.polygon.prototype=[];hu.area=function(){for(var t,i=-1,r=this.length,n=this[r-1],u=0;++i<r;)t=n,n=this[i],u+=t[1]*n[0]-t[0]*n[1];return.5*u};hu.centroid=function(n){var i,r,u=-1,f=this.length,e=0,o=0,t=this[f-1];for(arguments.length||(n=-1/(6*this.area()));++u<f;)i=t,t=this[u],r=i[0]*t[1]-t[0]*i[1],e+=(i[0]+t[0])*r,o+=(i[1]+t[1])*r;return[e*n,o*n]};hu.clip=function(n){for(var f,e,o,t,i,r,s=ey(n),h=-1,c=this.length-ey(this),u=this[c-1];++h<c;){for(f=n.slice(),n.length=0,t=this[h],i=f[(o=f.length-s)-1],e=-1;++e<o;)r=f[e],as(r,u,t)?(as(i,u,t)||n.push(fy(i,r,u,t)),n.push(r)):as(i,u,t)&&n.push(fy(i,r,u,t)),i=r;s&&n.push(n[0]);u=t}return n};pc=[];wc=[];hy.prototype.prepare=function(){for(var t,n=this.edges,i=n.length;i--;)t=n[i].edge,t.b&&t.a||n.splice(i,1);return n.sort(cy),n.length};hf.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};ys.prototype={insert:function(n,t){var i,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;i=n}else this._?(n=ay(this._),t.P=null,t.N=n,n.P=n.L=t,i=n):(t.P=t.N=null,this._=t,i=null);for(t.L=t.R=null,t.U=i,t.C=!0,n=t;i&&i.C;)r=i.U,i===r.L?(u=r.R,u&&u.C?(i.C=u.C=!1,r.C=!0,n=r):(n===i.R&&(kr(this,i),n=i,i=n.U),i.C=!1,r.C=!0,dr(this,r))):(u=r.L,u&&u.C?(i.C=u.C=!1,r.C=!0,n=r):(n===i.L&&(dr(this,i),n=i,i=n.U),i.C=!1,r.C=!0,kr(this,r))),i=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P);n.P&&(n.P.N=n.N);n.N=n.P=null;var t,r,e,i=n.U,f=n.L,u=n.R;if(r=f?u?ay(u):f:u,i?i.L===n?i.L=r:i.R=r:this._=r,f&&u?(e=r.C,r.C=n.C,r.L=f,f.U=r,r!==u?(i=r.U,r.U=n.U,n=r.R,i.L=n,r.R=u,u.U=r):(r.U=i,i=r,n=r.R)):(e=n.C,n=r),n&&(n.U=i),!e){if(n&&n.C)return n.C=!1,void 0;do{if(n===this._)break;if(n===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,kr(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,dr(this,t),t=i.R);t.C=i.C;i.C=t.R.C=!1;kr(this,i);n=this._;break}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,dr(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,kr(this,t),t=i.L);t.C=i.C;i.C=t.L.C=!1;dr(this,i);n=this._;break}t.C=!0;n=i;i=i.U}while(!n.C);n&&(n.C=!1)}}};n.geom.voronoi=function(n){function i(n){var o=new Array(n.length),t=r[0][0],i=r[0][1],f=r[1][0],e=r[1][1];return ps(u(n),r).cells.forEach(function(r,u){var h=r.edges,s=r.site,c=o[u]=h.length?h.map(function(n){var t=n.start();return[t.x,t.y]}):s.x>=t&&s.x<=f&&s.y>=i&&s.y<=e?[[t,e],[f,e],[f,i],[t,i]]:[];c.point=n[u]}),o}function u(n){return n.map(function(n,i){return{x:Math.round(s(n,i)/t)*t,y:Math.round(h(n,i)/t)*t,i:i}})}var f=ur,e=wr,s=f,h=e,r=lu;return n?i(n):(i.links=function(n){return ps(u(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},i.triangles=function(n){var t=[];return ps(u(n)).cells.forEach(function(i,r){for(var l,e,o=i.site,s=i.edges.sort(cy),h=-1,c=s.length,u=s[c-1].edge,f=u.l===o?u.r:u.l;++h<c;)l=u,e=f,u=s[h].edge,f=u.l===o?u.r:u.l,r<e.i&&r<f.i&&dg(o,e,f)<0&&t.push([n[r],n[e.i],n[f.i]])}),t},i.x=function(n){return arguments.length?(s=o(f=n),i):f},i.y=function(n){return arguments.length?(h=o(e=n),i):e},i.clipExtent=function(n){return arguments.length?(r=null==n?lu:n,i):r===lu?null:r},i.size=function(n){return arguments.length?i.clipExtent(n&&[[0,0],n]):r===lu?null:r&&r[1]},i)};lu=[[-1e6,-1e6],[1e6,1e6]];n.geom.delaunay=function(t){return n.geom.voronoi().triangles(t)};n.geom.quadtree=function(n,t,i,u,f){function e(n){function it(n,t,i,u,f,e,o,s){var h,c,l;isNaN(i)||isNaN(u)||(n.leaf?(h=n.x,c=n.y,null!=h?r(h-i)+r(c-u)<.01?nt(n,t,i,u,f,e,o,s):(l=n.point,n.x=n.y=n.point=null,nt(n,l,h,c,f,e,o,s),nt(n,t,i,u,f,e,o,s)):(n.x=i,n.y=u,n.point=t)):nt(n,t,i,u,f,e,o,s))}function nt(n,t,i,r,u,f,e,o){var s=.5*(u+e),h=.5*(f+o),c=i>=s,l=r>=h,a=(l<<1)+c;n.leaf=!1;n=n.nodes[a]||(n.nodes[a]=vy());c?u=s:e=s;l?f=h:o=h;it(n,t,i,r,u,f,e,o)}var l,d,g,e,tt,a,v,y,p,ft=o(s),et=o(h),b,k,rt,ut,w;if(null!=t)a=t,v=i,y=u,p=f;else if(y=p=-(a=v=1/0),d=[],g=[],tt=n.length,c)for(e=0;tt>e;++e)l=n[e],l.x<a&&(a=l.x),l.y<v&&(v=l.y),l.x>y&&(y=l.x),l.y>p&&(p=l.y),d.push(l.x),g.push(l.y);else for(e=0;tt>e;++e)b=+ft(l=n[e],e),k=+et(l,e),a>b&&(a=b),v>k&&(v=k),b>y&&(y=b),k>p&&(p=k),d.push(b),g.push(k);if(rt=y-a,ut=p-v,rt>ut?p=v+rt:y=a+ut,w=vy(),w.add=function(n){it(w,n,+ft(n,++e),+et(n,e),a,v,y,p)},w.visit=function(n){gr(n,w,a,v,y,p)},e=-1,null==t){for(;++e<tt;)it(w,n[e],d[e],g[e],a,v,y,p);--e}else n.forEach(w.add);return d=g=n=l=null,w}var c,s=ur,h=wr;return(c=arguments.length)?(s=gg,h=nn,3===c&&(f=i,u=t,i=t=0),e(n)):(e.x=function(n){return arguments.length?(s=n,e):s},e.y=function(n){return arguments.length?(h=n,e):h},e.extent=function(n){return arguments.length?(null==n?t=i=u=f=null:(t=+n[0][0],i=+n[0][1],u=+n[1][0],f=+n[1][1]),e):null==t?null:[[t,i],[u,f]]},e.size=function(n){return arguments.length?(null==n?t=i=u=f=null:(t=i=0,u=+n[0],f=+n[1]),e):null==t?null:[u-t,f-i]},e)};n.interpolateRgb=ws;n.interpolateObject=yy;n.interpolateNumber=vt;n.interpolateString=py;be=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;ke=new RegExp(be.source,"g");n.interpolate=vi;n.interpolators=[function(n,t){var i=typeof t;return("string"===i?eu.has(t)||/^(#|rgb\(|hsl\()/.test(t)?ws:py:t instanceof hi?ws:Array.isArray(t)?lf:"object"===i&&isNaN(t)?yy:vt)(n,t)}];n.interpolateArray=lf;var fb=function(){return a},vrt=n.map({linear:fb,poly:en,quad:function(){return rn},cubic:function(){return un},sin:function(){return on},exp:function(){return sn},circle:function(){return hn},elastic:cn,back:ln,bounce:function(){return an}}),yrt=n.map({"in":a,out:wy,"in-out":by,"out-in":function(n){return by(wy(n))}});n.ease=function(n){var t=n.indexOf("-"),i=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return i=vrt.get(i)||fb,r=yrt.get(r)||a,tn(r(i.apply(null,aw.call(arguments,1))))};n.interpolateHcl=vn;n.interpolateHsl=yn;n.interpolateLab=pn;n.interpolateRound=ky;n.transform=function(t){var i=rt.createElementNS(n.ns.prefix.svg,"g");return(n.transform=function(n){if(null!=n){i.setAttribute("transform",n);var t=i.transform.baseVal.consolidate()}return new dy(t?t.matrix:eb)})(t)};dy.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};eb={a:1,b:0,c:0,d:1,e:0,f:0};n.interpolateTransform=tp;n.layout={};n.layout.bundle=function(){return function(n){for(var t=[],i=-1,r=n.length;++i<r;)t.push(dn(n[i]));return t}};n.layout.chord=function(){function c(){var v,t,b,c,a,k={},d=[],it=n.range(r),nt=[],p,w;for(i=[],u=[],v=0,c=-1;++c<r;){for(t=0,a=-1;++a<r;)t+=f[c][a];d.push(t);nt.push(n.range(r));v+=t}for(e&&it.sort(function(n,t){return e(d[n],d[t])}),o&&nt.forEach(function(n,t){n.sort(function(n,i){return o(f[t][n],f[t][i])})}),v=(g-h*r)/v,t=0,c=-1;++c<r;){for(b=t,a=-1;++a<r;){var y=it[c],tt=nt[y][a],rt=f[y][tt],ut=t,ft=t+=rt*v;k[y+"-"+tt]={index:y,subindex:tt,startAngle:ut,endAngle:ft,value:rt}}u[y]={index:y,startAngle:b,endAngle:t,value:(t-b)/v};t+=h}for(c=-1;++c<r;)for(a=c-1;++a<r;)p=k[c+"-"+a],w=k[a+"-"+c],(p.value||w.value)&&i.push(p.value<w.value?{source:w,target:p}:{source:p,target:w});s&&l()}function l(){i.sort(function(n,t){return s((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var i,u,f,r,e,o,s,t={},h=0;return t.matrix=function(n){return arguments.length?(r=(f=n)&&f.length,i=u=null,t):f},t.padding=function(n){return arguments.length?(h=n,i=u=null,t):h},t.sortGroups=function(n){return arguments.length?(e=n,i=u=null,t):e},t.sortSubgroups=function(n){return arguments.length?(o=n,i=null,t):o},t.sortChords=function(n){return arguments.length?(s=n,i&&l(),t):s},t.chords=function(){return i||c(),i},t.groups=function(){return u||c(),u},t};n.layout.force=function(){function d(n){return function(t,i,r,u){var e;if(t.point!==n){var o=t.cx-n.x,s=t.cy-n.y,h=u-i,f=o*o+s*s;if(f>h*h/k)return w>f&&(e=t.charge/f,n.px-=o*e,n.py-=s*e),!0;t.point&&f&&w>f&&(e=t.pointCharge/f,n.px-=o*e,n.py-=s*e)}return!t.charge}}function g(i){i.px=n.event.x;i.py=n.event.y;t.resume()}var h,r,c,l,v,t={},y=n.dispatch("start","tick","end"),f=[1,1],p=.9,o=prt,s=wrt,e=-30,w=brt,b=.1,k=.64,i=[],u=[];return t.tick=function(){if((r*=.99)<.005)return y.end({type:"end",alpha:r=0}),!0;for(var tt,t,w,g,k,s,h,a,nt=i.length,it=u.length,o=0;it>o;++o)t=u[o],w=t.source,g=t.target,h=g.x-w.x,a=g.y-w.y,(k=h*h+a*a)&&(k=r*l[o]*((k=Math.sqrt(k))-c[o])/k,h*=k,a*=k,g.x-=h*(s=w.weight/(g.weight+w.weight)),g.y-=a*s,w.x+=h*(s=1-s),w.y+=a*s);if((s=r*b)&&(h=f[0]/2,a=f[1]/2,o=-1,s))for(;++o<nt;)t=i[o],t.x+=(h-t.x)*s,t.y+=(a-t.y)*s;if(e)for(rp(tt=n.geom.quadtree(i),r,v),o=-1;++o<nt;)(t=i[o]).fixed||tt.visit(d(t));for(o=-1;++o<nt;)t=i[o],t.fixed?(t.x=t.px,t.y=t.py):(t.x-=(t.px-(t.px=t.x))*p,t.y-=(t.py-(t.py=t.y))*p);y.tick({type:"tick",alpha:r})},t.nodes=function(n){return arguments.length?(i=n,t):i},t.links=function(n){return arguments.length?(u=n,t):u},t.size=function(n){return arguments.length?(f=n,t):f},t.linkDistance=function(n){return arguments.length?(o="function"==typeof n?n:+n,t):o},t.distance=t.linkDistance,t.linkStrength=function(n){return arguments.length?(s="function"==typeof n?n:+n,t):s},t.friction=function(n){return arguments.length?(p=+n,t):p},t.charge=function(n){return arguments.length?(e="function"==typeof n?n:+n,t):e},t.chargeDistance=function(n){return arguments.length?(w=n*n,t):Math.sqrt(w)},t.gravity=function(n){return arguments.length?(b=+n,t):b},t.theta=function(n){return arguments.length?(k=n*n,t):Math.sqrt(k)},t.alpha=function(i){return arguments.length?(i=+i,r?r=i>0?i:0:i>0&&(y.start({type:"start",alpha:r=i}),n.timer(t.tick)),t):r},t.start=function(){function p(t,i){var f;if(!h){for(h=new Array(a),r=0;a>r;++r)h[r]=[];for(r=0;s>r;++r)f=u[r],h[f.source.index].push(f.target),h[f.target.index].push(f.source)}for(var e,o=h[n],r=-1,s=o.length;++r<s;)if(!isNaN(e=o[r][t]))return e;return Math.random()*i}for(var h,r,a=i.length,y=u.length,w=f[0],b=f[1],n=0;a>n;++n)(r=i[n]).index=n,r.weight=0;for(n=0;y>n;++n)r=u[n],"number"==typeof r.source&&(r.source=i[r.source]),"number"==typeof r.target&&(r.target=i[r.target]),++r.source.weight,++r.target.weight;for(n=0;a>n;++n)r=i[n],isNaN(r.x)&&(r.x=p("x",w)),isNaN(r.y)&&(r.y=p("y",b)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(c=[],"function"==typeof o)for(n=0;y>n;++n)c[n]=+o.call(this,u[n],n);else for(n=0;y>n;++n)c[n]=o;if(l=[],"function"==typeof s)for(n=0;y>n;++n)l[n]=+s.call(this,u[n],n);else for(n=0;y>n;++n)l[n]=s;if(v=[],"function"==typeof e)for(n=0;a>n;++n)v[n]=+e.call(this,i[n],n);else for(n=0;a>n;++n)v[n]=e;return t.resume()},t.resume=function(){return t.alpha(.1)},t.stop=function(){return t.alpha(0)},t.drag=function(){return h||(h=n.behavior.drag().origin(a).on("dragstart.force",ntt).on("drag.force",g).on("dragend.force",ttt)),arguments.length?(this.on("mouseover.force",itt).on("mouseout.force",rtt).call(h),void 0):h},n.rebind(t,y,"on")};var prt=20,wrt=1,brt=1/0;n.layout.hierarchy=function(){function n(u){var f,h=[u],c=[],o,e,s;for(u.depth=0;null!=(f=h.pop());)if(c.push(f),(e=r.call(n,f,f.depth))&&(o=e.length)){for(;--o>=0;)h.push(s=e[o]),s.parent=f,s.depth=f.depth+1;t&&(f.value=0);f.children=e}else t&&(f.value=+t.call(n,f,f.depth)||0),delete f.children;return st(u,function(n){var r,u;i&&(r=n.children)&&r.sort(i);t&&(u=n.parent)&&(u.value+=n.value)}),c}var i=ett,r=utt,t=ftt;return n.sort=function(t){return arguments.length?(i=t,n):i},n.children=function(t){return arguments.length?(r=t,n):r},n.value=function(i){return arguments.length?(t=i,n):t},n.revalue=function(i){return t&&(tu(i,function(n){n.children&&(n.value=0)}),st(i,function(i){var r;i.children||(i.value=+t.call(n,i,i.depth)||0);(r=i.parent)&&(r.value+=i.value)})),i},n};n.layout.partition=function(){function r(n,t,i,u){var f=n.children,o,s,h,e;if(n.x=t,n.y=n.depth*u,n.dx=i,n.dy=u,f&&(o=f.length))for(e=-1,i=n.value?i/n.value:0;++e<o;)r(s=f[e],t,h=s.value*i,u),t+=h}function u(n){var t=n.children,i=0,f,r;if(t&&(f=t.length))for(r=-1;++r<f;)i=Math.max(i,u(t[r]));return 1+i}function i(n,i){var e=f.call(this,n,i);return r(e[0],0,t[0],t[1]/u(e[0])),e}var f=n.layout.hierarchy(),t=[1,1];return i.size=function(n){return arguments.length?(t=n,i):t},nu(i,f)};n.layout.pie=function(){function t(e){var o=e.map(function(n,i){return+f.call(t,n,i)}),s=+("function"==typeof r?r.apply(this,arguments):r),l=(("function"==typeof u?u.apply(this,arguments):u)-s)/n.sum(o),c=n.range(e.length),h;return null!=i&&c.sort(i===bc?function(n,t){return o[t]-o[n]}:function(n,t){return i(e[n],e[t])}),h=[],c.forEach(function(n){var t;h[n]={data:e[n],value:t=o[n],startAngle:s,endAngle:s+=t*l}}),h}var f=Number,i=bc,r=0,u=g;return t.value=function(n){return arguments.length?(f=n,t):f},t.sort=function(n){return arguments.length?(i=n,t):i},t.startAngle=function(n){return arguments.length?(r=n,t):r},t.endAngle=function(n){return arguments.length?(u=n,t):u},t};bc={};n.layout.stack=function(){function t(s,h){var l=s.map(function(n,i){return r.call(t,n,i)}),a=l.map(function(n){return n.map(function(n,i){return[e.call(t,n,i),o.call(t,n,i)]})}),y=u.call(t,a,h);l=n.permute(l,y);a=n.permute(a,y);for(var v,p,w=f.call(t,a,h),b=l.length,k=l[0].length,c=0;k>c;++c)for(i.call(t,l[0][c],p=w[c],a[0][c][1]),v=1;b>v;++v)i.call(t,l[v][c],p+=a[v-1][c][1],a[v][c][1]);return s}var r=a,u=bs,f=ks,i=ctt,e=stt,o=htt;return t.values=function(n){return arguments.length?(r=n,t):r},t.order=function(n){return arguments.length?(u="function"==typeof n?n:ob.get(n)||bs,t):u},t.offset=function(n){return arguments.length?(f="function"==typeof n?n:sb.get(n)||ks,t):f},t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(o=n,t):o},t.out=function(n){return arguments.length?(i=n,t):i},t};ob=n.map({"inside-out":function(t){for(var i,u=t.length,f=t.map(ltt),e=t.map(att),l=n.range(u).sort(function(n,t){return f[n]-f[t]}),o=0,s=0,h=[],c=[],r=0;u>r;++r)i=l[r],s>o?(o+=e[i],h.push(i)):(s+=e[i],c.push(i));return c.reverse().concat(h)},reverse:function(t){return n.range(t.length).reverse()},"default":bs});sb=n.map({silhouette:function(n){for(var r,i,s=n.length,f=n[0].length,e=[],u=0,o=[],t=0;f>t;++t){for(r=0,i=0;s>r;r++)i+=n[r][t][1];i>u&&(u=i);e.push(i)}for(t=0;f>t;++t)o[t]=(u-e[t])/2;return o},wiggle:function(n){var i,t,r,u,h,c,f,e,o,a=n.length,l=n[0],v=l.length,s=[];for(s[0]=e=o=0,t=1;v>t;++t){for(i=0,u=0;a>i;++i)u+=n[i][t][1];for(i=0,h=0,f=l[t][0]-l[t-1][0];a>i;++i){for(r=0,c=(n[i][t][1]-n[i][t-1][1])/(2*f);i>r;++r)c+=(n[r][t][1]-n[r][t-1][1])/f;h+=c*n[i][t][1]}s[t]=e-=u?h/u*f:0;o>e&&(o=e)}for(t=0;v>t;++t)s[t]-=o;return s},expand:function(n){for(var t,r,u=n.length,f=n[0].length,o=1/u,e=[],i=0;f>i;++i){for(t=0,r=0;u>t;t++)r+=n[t][i][1];if(r)for(t=0;u>t;t++)n[t][i][1]/=r;else for(t=0;u>t;t++)n[t][i][1]=o}for(i=0;f>i;++i)e[i]=0;return e},zero:ks});n.layout.histogram=function(){function t(t,e){for(var o,s,l=[],h=t.map(r,this),a=u.call(this,h,e),c=f.call(this,a,h,e),e=-1,y=h.length,v=c.length-1,p=i?1:1/y;++e<v;)o=l[e]=[],o.dx=c[e+1]-(o.x=c[e]),o.y=0;if(v>0)for(e=-1;++e<y;)s=h[e],s>=a[0]&&s<=a[1]&&(o=l[n.bisect(c,s,1,v)-1],o.y+=p,o.push(t[e]));return l}var i=!0,r=Number,u=ptt,f=ytt;return t.value=function(n){return arguments.length?(r=n,t):r},t.range=function(n){return arguments.length?(u=o(n),t):u},t.bins=function(n){return arguments.length?(f="number"==typeof n?function(t){return up(t,n)}:o(n),t):f},t.frequency=function(n){return arguments.length?(i=!!n,t):i},t};n.layout.pack=function(){function i(n,i){var c=f.call(this,n,i),e=c[0],o=u[0],s=u[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t},h;return(e.x=e.y=0,st(e,function(n){n.r=+l(n.value)}),st(e,op),r)&&(h=r*(t?1:Math.max(2*e.r/o,2*e.r/s))/2,st(e,function(n){n.r+=h}),st(e,op),st(e,function(n){n.r-=h})),sp(e,o/2,s/2,t?1:1/Math.max(2*e.r/o,2*e.r/s)),c}var t,f=n.layout.hierarchy().sort(wtt),r=0,u=[1,1];return i.size=function(n){return arguments.length?(u=n,i):u},i.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,i):t},i.padding=function(n){return arguments.length?(r=+n,i):r},nu(i,f)};n.layout.tree=function(){function i(n,i){var p=e.call(this,n,i),c=p[0],v=o(c);if(st(v,s),v.parent.m=-v.z,tu(v,h),u)tu(c,f);else{var l=c,a=c,y=c;tu(c,function(n){n.x<l.x&&(l=n);n.x>a.x&&(a=n);n.depth>y.depth&&(y=n)});var w=r(l,a)/2-l.x,b=t[0]/(a.x+r(a,l)/2+w),k=t[1]/(y.depth||1);tu(c,function(n){n.x=(n.x+w)*b;n.y=n.depth*k})}return p}function o(n){for(var u,f={A:null,children:[n]},e=[f];null!=(u=e.pop());)for(var i,r=u.children,t=0,o=r.length;o>t;++t)e.push((r[t]=i={_:r[t],parent:u,children:(i=r[t].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:t}).a=i);return f.children[0]}function s(n){var i=n.children,f=n.parent.children,t=n.i?f[n.i-1]:null,u;i.length?(gtt(n),u=(i[0].z+i[i.length-1].z)/2,t?(n.z=t.z+r(n._,t._),n.m=n.z-u):n.z=u):t&&(n.z=t.z+r(n._,t._));n.parent.A=c(n,t,n.parent.A||f[0])}function h(n){n._.x=n.z+n.parent.m;n.m+=n.parent.m}function c(n,t,i){if(t){for(var s,u=n,e=n,f=t,o=u.parent.children[0],h=u.m,c=e.m,l=f.m,a=o.m;f=nh(f),u=gs(u),f&&u;)o=gs(o),e=nh(e),e.a=n,s=f.z+l-u.z-h+r(f._,u._),s>0&&(dtt(nit(f,n,i),n,s),h+=s,c+=s),l+=f.m,h+=u.m,a+=o.m,c+=e.m;f&&!nh(e)&&(e.t=f,e.m+=l-c);u&&!gs(o)&&(o.t=u,o.m+=h-a,i=n)}return i}function f(n){n.x*=t[0];n.y=n.depth*t[1]}var e=n.layout.hierarchy().sort(null).value(null),r=cp,t=[1,1],u=null;return i.separation=function(n){return arguments.length?(r=n,i):r},i.size=function(n){return arguments.length?(u=null==(t=n)?f:null,i):u?null:t},i.nodeSize=function(n){return arguments.length?(u=null==(t=n)?null:f,i):u?t:null},nu(i,e)};n.layout.cluster=function(){function i(n,i){var o,c=f.call(this,n,i),e=c[0],a=0;st(e,function(n){var t=n.children;t&&t.length?(n.x=iit(t),n.y=tit(t)):(n.x=o?a+=r(n,o):0,n.y=0,o=n)});var s=lp(e),h=ap(e),l=s.x-r(s,h)/2,v=h.x+r(h,s)/2;return st(e,u?function(n){n.x=(n.x-e.x)*t[0];n.y=(e.y-n.y)*t[1]}:function(n){n.x=(n.x-l)/(v-l)*t[0];n.y=(1-(e.y?n.y/e.y:1))*t[1]}),c}var f=n.layout.hierarchy().sort(null).value(null),r=cp,t=[1,1],u=!1;return i.separation=function(n){return arguments.length?(r=n,i):r},i.size=function(n){return arguments.length?(u=null==(t=n),i):u?null:t},i.nodeSize=function(n){return arguments.length?(u=null!=(t=n),i):u?t:null},nu(i,f)};n.layout.treemap=function(){function o(n,t){for(var r,i,u=-1,f=n.length;++u<f;)i=(r=n[u]).value*(0>t?0:t),r.area=isNaN(i)||0>=i?0:i}function a(n){var u=n.children;if(u&&u.length){var l,v,y,r=c(n),t=[],f=u.slice(),h=1/0,e="slice"===i?r.dx:"dice"===i?r.dy:"slice-dice"===i?1&n.depth?r.dy:r.dx:Math.min(r.dx,r.dy);for(o(f,r.dx*r.dy/n.value),t.area=0;(y=f.length)>0;)t.push(l=f[y-1]),t.area+=l.area,"squarify"!==i||(v=p(t,e))<=h?(f.pop(),h=v):(t.area-=t.pop().area,s(t,e,r,!1),e=Math.min(r.dx,r.dy),t.length=t.area=0,h=1/0);t.length&&(s(t,e,r,!0),t.length=t.area=0);u.forEach(a)}}function v(n){var u=n.children;if(u&&u.length){var i,r=c(n),f=u.slice(),t=[];for(o(f,r.dx*r.dy/n.value),t.area=0;i=f.pop();)t.push(i),t.area+=i.area,null!=i.z&&(s(t,i.z?r.dx:r.dy,r,!f.length),t.length=t.area=0);u.forEach(v)}}function p(n,t){for(var i,r=n.area,u=0,f=1/0,o=-1,s=n.length;++o<s;)(i=n[o].area)&&(f>i&&(f=i),i>u&&(u=i));return r*=r,t*=t,r?Math.max(t*u*e/r,r/(t*f*e)):1/0}function s(n,t,i,r){var f,h=-1,c=n.length,o=i.x,s=i.y,e=t?u(n.area/t):0;if(t==i.dx){for((r||e>i.dy)&&(e=i.dy);++h<c;)f=n[h],f.x=o,f.y=s,f.dy=e,o+=f.dx=Math.min(i.x+i.dx-o,e?u(f.area/e):0);f.z=!0;f.dx+=i.x+i.dx-o;i.y+=e;i.dy-=e}else{for((r||e>i.dx)&&(e=i.dx);++h<c;)f=n[h],f.x=o,f.y=s,f.dx=e,s+=f.dy=Math.min(i.y+i.dy-s,e?u(f.area/e):0);f.z=!1;f.dy+=i.y+i.dy-s;i.x+=e;i.dx-=e}}function t(n){var i=r||h(n),t=i[0];return t.x=0,t.y=0,t.dx=f[0],t.dy=f[1],r&&h.revalue(t),o([t],t.dx*t.dy/t.value),(r?v:a)(t),l&&(r=i),i}var r,h=n.layout.hierarchy(),u=Math.round,f=[1,1],y=null,c=th,l=!1,i="squarify",e=.5*(1+Math.sqrt(5));return t.size=function(n){return arguments.length?(f=n,t):f},t.padding=function(n){function u(i){var r=n.call(t,i,i.depth);return null==r?th(i):vp(i,"number"==typeof r?[r,r,r,r]:r)}function i(t){return vp(t,n)}if(!arguments.length)return y;var r;return c=null==(y=n)?th:"function"==(r=typeof n)?u:"number"===r?(n=[n,n,n,n],i):i,t},t.round=function(n){return arguments.length?(u=n?Math.round:Number,t):u!=Number},t.sticky=function(n){return arguments.length?(l=n,r=null,t):l},t.ratio=function(n){return arguments.length?(e=n,t):e},t.mode=function(n){return arguments.length?(i=n+"",t):i},nu(t,h)};n.random={normal:function(n,t){var i=arguments.length;return 2>i&&(t=1),1>i&&(n=0),function(){var r,u,i;do r=2*Math.random()-1,u=2*Math.random()-1,i=r*r+u*u;while(!i||i>1);return n+t*r*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var t=n.random.normal.apply(n,arguments);return function(){return Math.exp(t())}},bates:function(t){var i=n.random.irwinHall(t);return function(){return i()/t}},irwinHall:function(n){return function(){for(var t=0,i=0;n>i;i++)t+=Math.random();return t}}};n.scale={};hb={floor:a,ceil:a};n.scale.linear=function(){return yp([0,1],[0,1],vi,!1)};cb={s:1,g:1,p:1,r:1,e:1};n.scale.log=function(){return wp(n.scale.linear().domain([0,1]),10,!0,[1,10])};kc=n.format(".0e");lb={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};n.scale.pow=function(){return bp(n.scale.linear(),1,[0,1])};n.scale.sqrt=function(){return n.scale.pow().exponent(.5)};n.scale.ordinal=function(){return kp([],{t:"range",a:[[]]})};n.scale.category10=function(){return n.scale.ordinal().range(krt)};n.scale.category20=function(){return n.scale.ordinal().range(drt)};n.scale.category20b=function(){return n.scale.ordinal().range(grt)};n.scale.category20c=function(){return n.scale.ordinal().range(nut)};var krt=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(pu),drt=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(pu),grt=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(pu),nut=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(pu);n.scale.quantile=function(){return dp([],[])};n.scale.quantize=function(){return gp(0,1,[0,1])};n.scale.threshold=function(){return nw([.5],[0,1])};n.scale.identity=function(){return tw([0,1])};n.svg={};n.svg.arc=function(){function n(){var e=t.apply(this,arguments),n=i.apply(this,arguments),o=r.apply(this,arguments)+oi,s=u.apply(this,arguments)+oi,h=(o>s&&(h=o,o=s,s=h),s-o),c=f>h?"0":"1",l=Math.cos(o),a=Math.sin(o),v=Math.cos(s),y=Math.sin(s);return h>=ab?e?"M0,"+n+"A"+n+","+n+" 0 1,1 0,"+-n+"A"+n+","+n+" 0 1,1 0,"+n+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+n+"A"+n+","+n+" 0 1,1 0,"+-n+"A"+n+","+n+" 0 1,1 0,"+n+"Z":e?"M"+n*l+","+n*a+"A"+n+","+n+" 0 "+c+",1 "+n*v+","+n*y+"L"+e*v+","+e*y+"A"+e+","+e+" 0 "+c+",0 "+e*l+","+e*a+"Z":"M"+n*l+","+n*a+"A"+n+","+n+" 0 "+c+",1 "+n*v+","+n*y+"L0,0Z"}var t=oit,i=sit,r=iw,u=rw;return n.innerRadius=function(i){return arguments.length?(t=o(i),n):t},n.outerRadius=function(t){return arguments.length?(i=o(t),n):i},n.startAngle=function(t){return arguments.length?(r=o(t),n):r},n.endAngle=function(t){return arguments.length?(u=o(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+i.apply(this,arguments))/2,f=(r.apply(this,arguments)+u.apply(this,arguments))/2+oi;return[Math.cos(f)*n,Math.sin(f)*n]},n};oi=-v;ab=g-t;n.svg.line=function(){return uw(a)};de=n.map({linear:d,"linear-closed":hit,step:cit,"step-before":eh,"step-after":oh,basis:fw,"basis-open":yit,"basis-closed":pit,bundle:wit,cardinal:vit,"cardinal-open":lit,"cardinal-closed":ait,monotone:dit});de.forEach(function(n,t){t.key=n;t.closed=/-closed$/.test(n)});var vb=[0,2/3,1/3,0],yb=[0,1/3,2/3,0],si=[0,1/6,2/3,1/6];n.svg.line.radial=function(){var n=uw(ew);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n};eh.reverse=oh;oh.reverse=eh;n.svg.area=function(){return ow(a)};n.svg.area.radial=function(){var n=ow(ew);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n};n.svg.chord=function(){function n(n,u){var f=h(this,i,n,u),e=h(this,r,n,u);return"M"+f.p0+c(f.r,f.p1,f.a1-f.a0)+(l(f,e)?t(f.r,f.p1,f.r,f.p0):t(f.r,f.p1,e.r,e.p0)+c(e.r,e.p1,e.a1-e.a0)+t(e.r,e.p1,f.r,f.p0))+"Z"}function h(n,t,i,r){var o=t.call(n,i,r),f=u.call(n,o,r),h=e.call(n,o,r)+oi,c=s.call(n,o,r)+oi;return{r:f,a0:h,a1:c,p0:[f*Math.cos(h),f*Math.sin(h)],p1:[f*Math.cos(c),f*Math.sin(c)]}}function l(n,t){return n.a0==t.a0&&n.a1==t.a1}function c(n,t,i){return"A"+n+","+n+" 0 "+ +(i>f)+",1 "+t}function t(n,t,i,r){return"Q 0,0 "+r}var i=hs,r=cs,u=git,e=iw,s=rw;return n.radius=function(t){return arguments.length?(u=o(t),n):u},n.source=function(t){return arguments.length?(i=o(t),n):i},n.target=function(t){return arguments.length?(r=o(t),n):r},n.startAngle=function(t){return arguments.length?(e=o(t),n):e},n.endAngle=function(t){return arguments.length?(s=o(t),n):s},n};n.svg.diagonal=function(){function n(n,u){var e=t.call(this,n,u),o=i.call(this,n,u),s=(e.y+o.y)/2,f=[e,{x:e.x,y:s},{x:o.x,y:s},o];return f=f.map(r),"M"+f[0]+"C"+f[1]+" "+f[2]+" "+f[3]}var t=hs,i=cs,r=sw;return n.source=function(i){return arguments.length?(t=o(i),n):t},n.target=function(t){return arguments.length?(i=o(t),n):i},n.projection=function(t){return arguments.length?(r=t,n):r},n};n.svg.diagonal.radial=function(){var t=n.svg.diagonal(),i=sw,r=t.projection;return t.projection=function(n){return arguments.length?r(nrt(i=n)):i},t};n.svg.symbol=function(){function n(n,r){return(dc.get(t.call(this,n,r))||hw)(i.call(this,n,r))}var t=irt,i=trt;return n.type=function(i){return arguments.length?(t=o(i),n):t},n.size=function(t){return arguments.length?(i=o(t),n):i},n};dc=n.map({circle:hw,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*pb)),i=t*pb;return"M0,"+-t+"L"+i+",0 0,"+t+" "+-i+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/no),i=t*no/2;return"M0,"+i+"L"+t+","+-i+" "+-t+","+-i+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/no),i=t*no/2;return"M0,"+-i+"L"+t+","+i+" "+-t+","+i+"Z"}});n.svg.symbolTypes=dc.keys();var di,ge,no=Math.sqrt(3),pb=Math.tan(30*u),l=[],wb=0;l.call=e.call;l.empty=e.empty;l.node=e.node;l.size=e.size;n.transition=function(n){return arguments.length?di?n.transition():n:kh.transition()};n.transition.prototype=l;l.select=function(n){var f,i,t,e=this.id,o=[],r,s;for(n=oo(n),r=-1,s=this.length;++r<s;){o.push(f=[]);for(var h=this[r],u=-1,c=h.length;++u<c;)(t=h[u])&&(i=n.call(t,t.__data__,u,r))?("__data__"in t&&(i.__data__=t.__data__),wf(i,u,e,t.__transition__[e]),f.push(i)):f.push(null)}return ru(o,e)};l.selectAll=function(n){var s,u,t,f,h,e=this.id,c=[],i,l,r,v;for(n=ll(n),i=-1,l=this.length;++i<l;)for(var a=this[i],o=-1,y=a.length;++o<y;)if(t=a[o])for(h=t.__transition__[e],u=n.call(t,t.__data__,o,i),c.push(s=[]),r=-1,v=u.length;++r<v;)(f=u[r])&&wf(f,r,e,h),s.push(f);return ru(c,e)};l.filter=function(n){var u,f,i,e=[],t,o;for("function"!=typeof n&&(n=gl(n)),t=0,o=this.length;o>t;t++){e.push(u=[]);for(var f=this[t],r=0,s=f.length;s>r;r++)(i=f[r])&&n.call(i,i.__data__,r,t)&&u.push(i)}return ru(e,this.id)};l.tween=function(n,t){var i=this.id;return arguments.length<2?this.node().__transition__[i].tween.get(n):dt(this,null==t?function(t){t.__transition__[i].tween.remove(n)}:function(r){r.__transition__[i].tween.set(n,t)})};l.attr=function(t,i){function f(){this.removeAttribute(r)}function e(){this.removeAttributeNS(r.space,r.local)}function o(n){return null==n?f:(n+="",function(){var t,i=this.getAttribute(r);return i!==n&&(t=u(i,n),function(n){this.setAttribute(r,t(n))})})}function s(n){return null==n?e:(n+="",function(){var t,i=this.getAttributeNS(r.space,r.local);return i!==n&&(t=u(i,n),function(n){this.setAttributeNS(r.space,r.local,t(n))})})}if(arguments.length<2){for(i in t)this.attr(i,t[i]);return this}var u="transform"==t?tp:vi,r=n.ns.qualify(t);return lh(this,"attr."+t,i,r.local?s:o)};l.attrTween=function(t,i){function u(n,t){var u=i.call(this,n,t,this.getAttribute(r));return u&&function(n){this.setAttribute(r,u(n))}}function f(n,t){var u=i.call(this,n,t,this.getAttributeNS(r.space,r.local));return u&&function(n){this.setAttributeNS(r.space,r.local,u(n))}}var r=n.ns.qualify(t);return this.tween("attr."+t,r.local?f:u)};l.style=function(n,t,i){function u(){this.style.removeProperty(n)}function f(t){return null==t?u:(t+="",function(){var r,u=w.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=vi(u,t),function(t){this.style.setProperty(n,r(t),i)})})}var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(i in n)this.style(i,n[i],t);return this}i=""}return lh(this,"style."+n,t,f)};l.styleTween=function(n,t,i){function r(r,u){var f=t.call(this,r,u,w.getComputedStyle(this,null).getPropertyValue(n));return f&&function(t){this.style.setProperty(n,f(t),i)}}return arguments.length<3&&(i=""),this.tween("style."+n,r)};l.text=function(n){return lh(this,"text",n,rrt)};l.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})};l.ease=function(t){var i=this.id;return arguments.length<1?this.node().__transition__[i].ease:("function"!=typeof t&&(t=n.ease.apply(n,arguments)),dt(this,function(n){n.__transition__[i].ease=t}))};l.delay=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:dt(this,"function"==typeof n?function(i,r,u){i.__transition__[t].delay=+n.call(i,i.__data__,r,u)}:(n=+n,function(i){i.__transition__[t].delay=n}))};l.duration=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:dt(this,"function"==typeof n?function(i,r,u){i.__transition__[t].duration=Math.max(1,n.call(i,i.__data__,r,u))}:(n=Math.max(1,n),function(i){i.__transition__[t].duration=n}))};l.each=function(t,i){var r=this.id,u,f;return arguments.length<2?(u=ge,f=di,di=r,dt(this,function(n,i,u){ge=n.__transition__[r];t.call(n,n.__data__,i,u)}),ge=u,di=f):dt(this,function(u){var f=u.__transition__[r];(f.event||(f.event=n.dispatch("start","end"))).on(t,i)}),this};l.transition=function(){for(var u,f,n,t,s=this.id,e=++wb,o=[],r=0,h=this.length;h>r;r++){o.push(u=[]);for(var f=this[r],i=0,c=f.length;c>i;i++)(n=f[i])&&(t=Object.create(n.__transition__[s]),t.delay+=t.duration,wf(n,i,e,t)),u.push(n)}return ru(o,e)};n.svg.axis=function(){function i(i){i.each(function(){var v,ut=n.select(this),p=this.__chart__||o,i=this.__chart__=o.copy(),ot=null==h?i.ticks?i.ticks.apply(i,s):i.domain():h,st=null==e?i.tickFormat?i.tickFormat.apply(i,s):a:e,w=ut.selectAll(".tick").data(ot,i),y=w.enter().insert("g",".domain").attr("class","tick").style("opacity",t),ht=n.transition(w.exit()).style("opacity",t).remove(),it=n.transition(w.order()).style("opacity",1),l=af(i),ft=ut.selectAll(".domain").data([0]),b=(ft.enter().append("path").attr("class","domain"),n.transition(ft)),rt,et;y.append("line");y.append("text");var k=y.select("line"),d=it.select("line"),g=w.select("text").text(st),nt=y.select("text"),tt=it.select("text");switch(c){case"bottom":v=cw;k.attr("y2",r);nt.attr("y",Math.max(r,0)+f);d.attr("x2",0).attr("y2",r);tt.attr("x",0).attr("y",Math.max(r,0)+f);g.attr("dy",".71em").style("text-anchor","middle");b.attr("d","M"+l[0]+","+u+"V0H"+l[1]+"V"+u);break;case"top":v=cw;k.attr("y2",-r);nt.attr("y",-(Math.max(r,0)+f));d.attr("x2",0).attr("y2",-r);tt.attr("x",0).attr("y",-(Math.max(r,0)+f));g.attr("dy","0em").style("text-anchor","middle");b.attr("d","M"+l[0]+","+-u+"V0H"+l[1]+"V"+-u);break;case"left":v=lw;k.attr("x2",-r);nt.attr("x",-(Math.max(r,0)+f));d.attr("x2",-r).attr("y2",0);tt.attr("x",-(Math.max(r,0)+f)).attr("y",0);g.attr("dy",".32em").style("text-anchor","end");b.attr("d","M"+-u+","+l[0]+"H0V"+l[1]+"H"+-u);break;case"right":v=lw;k.attr("x2",r);nt.attr("x",Math.max(r,0)+f);d.attr("x2",r).attr("y2",0);tt.attr("x",Math.max(r,0)+f).attr("y",0);g.attr("dy",".32em").style("text-anchor","start");b.attr("d","M"+u+","+l[0]+"H0V"+l[1]+"H"+u)}i.rangeBand?(rt=i,et=rt.rangeBand()/2,p=i=function(n){return rt(n)+et}):p.rangeBand?p=i:ht.call(v,i);y.call(v,p);it.call(v,i)})}var e,o=n.scale.linear(),c=gc,r=6,u=6,f=3,s=[10],h=null;return i.scale=function(n){return arguments.length?(o=n,i):o},i.orient=function(n){return arguments.length?(c=n in bb?n+"":gc,i):c},i.ticks=function(){return arguments.length?(s=arguments,i):s},i.tickValues=function(n){return arguments.length?(h=n,i):h},i.tickFormat=function(n){return arguments.length?(e=n,i):e},i.tickSize=function(n){var t=arguments.length;return t?(r=+n,u=+arguments[t-1],i):r},i.innerTickSize=function(n){return arguments.length?(r=+n,i):r},i.outerTickSize=function(n){return arguments.length?(u=+n,i):u},i.tickPadding=function(n){return arguments.length?(f=+n,i):f},i.tickSubdivide=function(){return arguments.length&&i},i};gc="bottom";bb={top:1,right:1,bottom:1,left:1};n.svg.brush=function(){function f(t){t.each(function(){var i=n.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",b).on("touchstart.brush",b),h=i.selectAll(".background").data([0]),e,t,o,s;h.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");e=i.selectAll(".resize").data(l,a);e.exit().remove();e.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return tut[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");e.style("display",f.empty()?"none":null);o=n.transition(i);s=n.transition(h);r&&(t=af(r),s.attr("x",t[0]).attr("width",t[1]-t[0]),y(o));u&&(t=af(u),s.attr("y",t[0]).attr("height",t[1]-t[0]),p(o));v(o)})}function v(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+t[+/e$/.test(n)]+","+i[+/^s/.test(n)]+")"})}function y(n){n.select(".extent").attr("x",t[0]);n.selectAll(".extent,.n>rect,.s>rect").attr("width",t[1]-t[0])}function p(n){n.select(".extent").attr("y",i[0]);n.selectAll(".extent,.e>rect,.w>rect").attr("height",i[1]-i[0])}function b(){function ht(){32==n.event.keyCode&&(b||(a=null,l[0]-=t[1],l[1]-=i[1],b=2),bt())}function ct(){32==n.event.keyCode&&2==b&&(l[0]+=t[1],l[1]+=i[1],b=0,bt())}function g(){var f=n.mouse(tt),e=!1;nt&&(f[0]+=nt[0],f[1]+=nt[1]);b||(n.event.altKey?(a||(a=[(t[0]+t[1])/2,(i[0]+i[1])/2]),l[0]=t[+(f[0]<a[0])],l[1]=i[+(f[1]<a[1])]):a=null);lt&&ot(f,r,0)&&(y(k),e=!0);at&&ot(f,u,1)&&(p(k),e=!0);e&&(v(k),rt({type:"brush",mode:b?"move":"resize"}))}function ot(n,r,u){var f,y,k=af(r),p=k[0],w=k[1],c=l[u],v=u?i:t,d=v[1]-v[0];return b&&(p-=c,w-=d+c),f=(u?h:s)?Math.max(p,Math.min(w,n[u])):n[u],b?y=(f+=c)+d:(a&&(c=Math.max(p,Math.min(w,2*a[u]-f))),f>c?(y=f,f=c):y=c),v[0]!=f||v[1]!=y?(u?o=null:e=null,v[0]=f,v[1]=y,!0):void 0}function st(){g();k.style("pointer-events","all").selectAll(".resize").style("display",f.empty()?"none":null);n.select("body").style("cursor",null);ut.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);vt();rt({type:"brushend"})}var a,nt,tt=this,it=n.select(n.event.target),rt=c.of(tt,arguments),k=n.select(tt),d=it.datum(),lt=!/^(n|s)$/.test(d)&&r,at=!/^(e|w)$/.test(d)&&u,b=it.classed("extent"),vt=yu(),l=n.mouse(tt),ut=n.select(w).on("keydown.brush",ht).on("keyup.brush",ct),ft,et;(n.event.changedTouches?ut.on("touchmove.brush",g).on("touchend.brush",st):ut.on("mousemove.brush",g).on("mouseup.brush",st),k.interrupt().selectAll("*").interrupt(),b)?(l[0]=t[0]-l[0],l[1]=i[0]-l[1]):d?(ft=+/w$/.test(d),et=+/^n/.test(d),nt=[t[1-ft]-l[0],i[1-et]-l[1]],l[0]=t[ft],l[1]=i[et]):n.event.altKey&&(a=l.slice());k.style("pointer-events","none").selectAll(".resize").style("display",null);n.select("body").style("cursor",it.style("cursor"));rt({type:"brushstart"});g()}var e,o,c=eo(f,"brushstart","brush","brushend"),r=null,u=null,t=[0,0],i=[0,0],s=!0,h=!0,l=nl[0];return f.event=function(r){r.each(function(){var u=c.of(this,arguments),r={x:t,y:i,i:e,j:o},f=this.__chart__||r;this.__chart__=r;di?n.select(this).transition().each("start.brush",function(){e=f.i;o=f.j;t=f.x;i=f.y;u({type:"brushstart"})}).tween("brush:brush",function(){var n=lf(t,r.x),f=lf(i,r.y);return e=o=null,function(e){t=r.x=n(e);i=r.y=f(e);u({type:"brush",mode:"resize"})}}).each("end.brush",function(){e=r.i;o=r.j;u({type:"brush",mode:"resize"});u({type:"brushend"})}):(u({type:"brushstart"}),u({type:"brush",mode:"resize"}),u({type:"brushend"}))})},f.x=function(n){return arguments.length?(r=n,l=nl[!r<<1|!u],f):r},f.y=function(n){return arguments.length?(u=n,l=nl[!r<<1|!u],f):u},f.clamp=function(n){return arguments.length?(r&&u?(s=!!n[0],h=!!n[1]):r?s=!!n:u&&(h=!!n),f):r&&u?[s,h]:r?s:u?h:null},f.extent=function(n){var s,h,c,l,a;return arguments.length?(r&&(s=n[0],h=n[1],u&&(s=s[0],h=h[0]),e=[s,h],r.invert&&(s=r(s),h=r(h)),s>h&&(a=s,s=h,h=a),(s!=t[0]||h!=t[1])&&(t=[s,h])),u&&(c=n[0],l=n[1],r&&(c=c[1],l=l[1]),o=[c,l],u.invert&&(c=u(c),l=u(l)),c>l&&(a=c,c=l,l=a),(c!=i[0]||l!=i[1])&&(i=[c,l])),f):(r&&(e?(s=e[0],h=e[1]):(s=t[0],h=t[1],r.invert&&(s=r.invert(s),h=r.invert(h)),s>h&&(a=s,s=h,h=a))),u&&(o?(c=o[0],l=o[1]):(c=i[0],l=i[1],u.invert&&(c=u.invert(c),l=u.invert(l)),c>l&&(a=c,c=l,l=a))),r&&u?[[s,c],[h,l]]:r?[s,h]:u&&[c,l])},f.clear=function(){return f.empty()||(t=[0,0],i=[0,0],e=o=null),f},f.empty=function(){return!!r&&t[0]==t[1]||!!u&&i[0]==i[1]},n.rebind(f,c,"on")};var tut={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},nl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],tl=i.format=rc.timeFormat,kb=tl.utc,db=kb("%Y-%m-%dT%H:%M:%S.%LZ");tl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?ah:db;ah.parse=function(n){var t=new Date(n);return isNaN(t)?null:t};ah.toString=db.toString;i.second=ci(function(n){return new y(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()});i.seconds=i.second.range;i.seconds.utc=i.second.utc.range;i.minute=ci(function(n){return new y(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()});i.minutes=i.minute.range;i.minutes.utc=i.minute.utc.range;i.hour=ci(function(n){var t=n.getTimezoneOffset()/60;return new y(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()});i.hours=i.hour.range;i.hours.utc=i.hour.utc.range;i.month=ci(function(n){return n=i.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()});i.months=i.month.range;i.months.utc=i.month.utc.range;var to=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],il=[[i.second,1],[i.second,5],[i.second,15],[i.second,30],[i.minute,1],[i.minute,5],[i.minute,15],[i.minute,30],[i.hour,1],[i.hour,3],[i.hour,6],[i.hour,12],[i.day,1],[i.day,2],[i.week,1],[i.month,1],[i.month,3],[i.year,1]],iut=tl.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",rr]]),rut={range:function(t,i,r){return n.range(Math.ceil(t/r)*r,+i,r).map(yi)},floor:a,ceil:a};il.year=i.year;i.scale=function(){return vh(n.scale.linear(),il,iut)};rl=il.map(function(n){return[n[0].utc,n[1]]});gb=kb.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",rr]]);rl.year=i.year.utc;i.scale.utc=function(){return vh(n.scale.linear(),rl,gb)};n.text=ko(function(n){return n.responseText});n.json=function(n,t){return wu(n,"application/json",urt,t)};n.html=function(n,t){return wu(n,"text/html",frt,t)};n.xml=ko(function(n){return n.responseXML});"function"==typeof define&&define.amd?define(n):"object"==typeof module&&module.exports&&(module.exports=n);this.d3=n}();var MemoryStats=function(){var o=100,s=0,r=document.createElement("div"),t,i,n,u,h,f,e;for(r.id="stats",r.style.cssText="width:80px;opacity:0.9;cursor:pointer",t=document.createElement("div"),t.id="ms",t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;",r.appendChild(t),i=document.createElement("div"),i.id="msText",i.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="Memory",t.appendChild(i),n=document.createElement("div"),n.id="msGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",t.appendChild(n);n.children.length<74;)u=document.createElement("span"),u.style.cssText="width:1px;height:30px;float:left;background-color:#131",n.appendChild(u);return h=function(n,t,i){var r=n.appendChild(n.firstChild);r.style.height=t+"px";i&&(r.style.backgroundColor=i)},window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome ."),f=Date.now(),e=performance.memory.usedJSHeapSize,{domElement:r,update:function(){function a(n,t){var i,r;return n==0?"n/a":(t=t!==undefined?t:0,i=Math.pow(10,t),r=Math.floor(Math.log(n)/Math.log(1024)),Math.round(n*i/Math.pow(1024,r))/i+" "+["Bytes","KB","MB","GB","TB"][r])}var r,u,t,c,l;Date.now()-f<1e3/30||(f=Date.now(),r=performance.memory.usedJSHeapSize-e,e=performance.memory.usedJSHeapSize,u=r<0?"#830":"#131",t=performance.memory.usedJSHeapSize,o=Math.min(o,t),s=Math.max(s,t),i.textContent="Mem: "+a(t,2),c=t/31457280,l=Math.min(30,30-c*30),h(n,l,u))}}},sbxLogger={log:function(n){sandbox.volatile.env==="IDE"||sandbox.volatile.env==="IDE WJS"?($("#UI_TxtLogText").val($("#UI_TxtLogText").val()+n+"\r\n"),sandbox.volatile.flashTextTab||(sandbox.volatile.flashTextTab=!0,$($($("#UI_TabsOutput").find("ul")[0]).find("li")[1]).find("a").effect("pulsate",{},1e3),setTimeout(function(){sandbox.volatile.flashTextTab=!1},4e3))):console.log(n)},logObject:function(n,t){t&&typeof t=="string"&&this.log(t+" = ");sandbox.volatile.env==="SBL"||sandbox.volatile.env=="SBL WJS"?console.dir(n):this.log(JSON.stringify(n,null,"\t"))},clearLog:function(){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&$("#UI_TxtLogText").val("")},trace:function(){var n,t;try{throw new Error("");}catch(i){n=i.stack||""}return n=n.split("\n").map(function(n){return n.trim()}),t=n.splice(n[0]=="Error"?2:1),this.log(t),t},inspect:function(n,t){t=t||"Trident Object Inspector";var i=prettyPrint(n,{});$(i).dialog({title:t,width:"auto",maxHeight:$(window).height()-50})},notify:function(n){alertify.log(n)},notifySuccess:function(n){alertify.success(n)},notifyError:function(n){alertify.error(n)}},sandboxMedia={playAudio:function(n){var t=new Audio;t.src=n;t.load();t.play()},speak:function(n){if(!this.isSpeechAvailable){sandbox.logger.notifyError("Speech API is not supported by this browser");return}var t=new SpeechSynthesisUtterance(n);window.speechSynthesis.speak(t)},isSpeechAvailable:typeof SpeechSynthesisUtterance!="undefined"},sandboxMemstats={on:function(){sandbox.volatile.memStats=new MemoryStats;sandbox.volatile.memStats.domElement.style.position="fixed";sandbox.volatile.memStats.domElement.style.left="210px";sandbox.volatile.memStats.domElement.style.top="5px";document.body.appendChild(sandbox.volatile.memStats.domElement);sandbox.volatile.memStatsRequestId=requestAnimationFrame(function n(){sandbox.volatile.memStats.update();sandbox.volatile.memStatsRequestId=requestAnimationFrame(n)})},off:function(){sandbox.volatile.memStats!=null&&(window.cancelAnimationFrame(sandbox.volatile.memStatsRequestId),document.body.removeChild(sandbox.volatile.memStats.domElement),sandbox.volatile.memStats=null,sandbox.volatile.memStatsRequestId=null)}},sandboxFiles={programPicked:function(){var t,n;sandbox.ide.clean();t=document.getElementById("sb_file").files[0];t&&(n=new FileReader,n.readAsText(t,"UTF-8"),n.onload=sandbox.files.programLoaded,n.onerror=sandbox.files.genericLoadError)},programLoaded:function(n){var r=n.target.result,t=JSON.parse(r),i;$("#sb_txt_ProgramName").val(t.progName);sandbox.volatile.markupHash=CryptoJS.SHA1(t.htmlText).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(t.scriptText).toString();sandbox.volatile.editorMarkup.setValue(t.htmlText);sandbox.volatile.editorScript.setValue(t.scriptText);i=$("#sb_file");i.replaceWith(i=i.clone(!0))},programSave:function(){var t,n,e,r,o,s;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sb_save");return}if(t=$("#sb_txt_ProgramName").val(),t==""){alertify.error("You need to enter a program name first");return}n=$("#sb_file");n.replaceWith(n=n.clone(!0));var i=t,u=sandbox.volatile.editorMarkup.getValue(),f=sandbox.volatile.editorScript.getValue();if(sandbox.volatile.markupHash=CryptoJS.SHA1(u).toString(),sandbox.volatile.scriptHash=CryptoJS.SHA1(f).toString(),e={progName:i,htmlText:u,scriptText:f},r=JSON.stringify(e,null,2),typeof Blob=="undefined"){alert("no blobs available (incompatible browser?)");return}window.navigator.msSaveBlob===undefined?(o=new Blob([r],{type:"application/octet-stream"}),saveAs(o,i+".prg")):(s=new Blob([r]),window.navigator.msSaveBlob(s,i+".prg"))},genericLoadError:function(){alertify.error("load error")},userfileShow:function(){$("#sb_div_userfile").show()},userfileHide:function(){$("#sb_div_userfile").hide()},userfilePicked:function(){var t=document.getElementById("sb_user_file").files[0],n;t&&(n=new FileReader,n.readAsText(t,"UTF-8"),n.onload=sandbox.files.userfileLoaded,n.onerror=sandbox.files.genericLoadError)},userfileLoaded:function(n){var i=$("#sb_user_file").val().replace(/^.*[\\\/]/,""),r=n.target.result,t=$("#sb_user_file");t.replaceWith(t=t.clone(!0));sandbox.files.userfileHide();typeof sandbox.events.userLoadCallback==typeof Function&&setTimeout(function(){sandbox.events.userLoadCallback(r,i)},250)},userdataShow:function(){$("#sb_div_userdatafile").show()},userdataHide:function(){$("#sb_div_userdatafile").hide()},userdataPicked:function(){var t=document.getElementById("sb_user_datafile").files[0],n;t&&(n=new FileReader,n.readAsDataURL(t,"UTF-8"),n.onload=sandbox.files.userdataLoaded,n.onerror=sandbox.files.genericLoadError)},userdataLoaded:function(n){var i=$("#sb_user_datafile").val().replace(/^.*[\\\/]/,""),t=$("#sb_user_datafile");t.replaceWith(t=t.clone(!0));sandbox.files.userdataHide();typeof sandbox.events.userdataLoadCallback==typeof Function&&setTimeout(function(){sandbox.events.userdataLoadCallback(n.target.result,i)},250)},templatePrompt:function(){alertify.confirm("This will un-hide a file picker you use to pick the the SandboxLoader.htm file at the root of your Trident Sandbox Installation.  Once you do this it will generate and prompt to save a standalone htm version of the program currently loaded.  Continue?",function(n){n&&$("#sb_div_compile_standalone").show()})},templatePicked:function(){var t=document.getElementById("sb_file_template").files[0],n;t&&(n=new FileReader,n.readAsText(t,"UTF-8"),n.onload=sandbox.files.templateLoaded,n.onerror=sandbox.files.genericLoadError)},templateLoaded:function(n){var r,i;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.files.templateLoaded");return}var t=n.target.result,u=sandbox.volatile.editorMarkup.getValue(),f=sandbox.volatile.editorScript.getValue();t=t.replace("<!--TRIDENT_HTML-->",u);t=t.replace("/*TRIDENT_SCRIPT*/",f);typeof Blob=="undefined"?alert("no blobs available (incompatible browser?)"):(r=new Blob([t]),window.navigator.msSaveBlob(r,$("#sb_txt_ProgramName").val()+".htm"));i=$("#sb_file_template");i.replaceWith(i=i.clone(!0));setTimeout(function(){$("#sb_div_compile_standalone").hide()},200)},exportDatabaseKeys:function(){filename=filename||"TridentDB.backup";var i=[],n,r=0,t;sandbox.db.getAllKeys(function(u){for(u.length==0&&alertify.log("Nothing to backup, TridentDB is empty"),n=0;n<u.length;n++)t=u[n],sandbox.db.getAppKey(t.app,t.key,function(n){i.push(n);++r==u.length&&sandbox.files.saveTextFile(filename,JSON.stringify(i))})})},dataUrlToBlob:function(n){for(var i=atob(n.split(",")[1]),u=n.split(",")[0].split(":")[1].split(";")[0],f=new ArrayBuffer(i.length),r=new Int8Array(f),t=0;t<i.length;t++)r[t]=i.charCodeAt(t)&255;return new Blob([r],{type:u})},saveTextFile:function(n,t){var i=$("#sb_user_file"),r,u;i.replaceWith(i=i.clone(!0));typeof Blob=="undefined"?alert("no blobs available (incompatible browser?)"):window.navigator.msSaveBlob===undefined?(r=new Blob([t],{type:"application/octet-stream"}),saveAs(r,n)):(u=new Blob([t]),window.navigator.msSaveBlob(u,n))},saveDataURL:function(n,t){var i=sandbox.files.dataUrlToBlob(t);window.navigator.msSaveBlob===undefined?saveAs(i,n):window.navigator.msSaveOrOpenBlob(i,n)},saveOrOpenTextFile:function(n,t){var i=$("#sb_user_file"),r;i.replaceWith(i=i.clone(!0));typeof Blob=="undefined"?alert("no blobs available (incompatible browser?)"):(r=new Blob([t]),window.navigator.msSaveOrOpenBlob(r,n))}},sandboxDashboard={tdbplot:null,lsplot:null,gaugeLS:null,gaugeTDB:null,adapterSet:function(n){var t,i;switch(n){case"memory":sandbox.settings.set("databaseAdapter","memory");sandbox.dbInit();alertify.log("adapter changed");break;case"trident":sandbox.settings.set("databaseAdapter","trident");sandbox.dbInit();alertify.log("adapter changed");break;case"service":t=$("#sb_txt_adapter_service_loc").val();sandbox.settings.set("databaseAdapter","service");sandbox.settings.set("databaseServiceLocation",t);sandbox.dbInit();alertify.log("adapter changed");break;case"user":i=$("#sb_txt_adapter_user").val();sandbox.settings.set("databaseAdapter",i);sandbox.dbInit();alertify.log("adapter changed")}},show:function(){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!=="SBL WJS"){var n=1024;$(window).width()<1044&&(n=$(window).width()-20);$("#sb_trident_usage").dialog({modal:!0,width:n,title:"Trident Sandbox Storage Summary",open:function(){$("#UI_TabsDashboard").tabs("option","active")!=0?$("#UI_TabsDashboard").tabs("option","active",0):sandbox.dashboard.calcSummaryUsage()},buttons:{Ok:function(){$(this).dialog("destroy");sandbox.db!=null&&(sandbox.db.name=="indexedDB"?$("#sb_spn_indexeddb_status").text("Yes"):$("#sb_spn_indexeddb_status").html("Yes <span style='font-family:Symbol'>Å<\/span>"));sandbox.ide.refreshSlots()},Cancel:function(){$(this).dialog("destroy")}}})}},calcSummaryUsage:function(){$("#spn_TridentDatabaseUsage").text("");$("#ui_gaugeTDBspin").show();setTimeout(function(){sandbox.dashboard.calcSummaryUsageAction()},100)},calcSummaryUsageAction:function(){var t=0,n,i,r,u;if(sandbox.dashboard.gaugeLS&&sandbox.dashboard.gaugeLS.destroy(),sandbox.dashboard.gaugeTDB&&sandbox.dashboard.gaugeTDB.destroy(),n=0,localStorage)for(i=0;i<localStorage.length;i++)r=localStorage[localStorage.key(i)].length,n+=r;($("#spn_LocalStorageUsage").text(n+" bytes ("+Math.round(n/1048576*100)/100+"MB)"),u=[n/1048576],sandbox.dashboard.gaugeLS=$.jqplot("ui_gaugeLS",[u],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:"(Actual) Usage in MB",labelPosition:"bottom",min:0,max:5,intervals:[1.25,2.5,3.5,5],intervalColors:["#66cc66","#93b75f","#E7E658","#cc6666"]}}}),$("#UI_TabsDashboard").tabs("option","active")==0)&&($("#ui_gaugeTDBspin").hide(),sandbox.db.getAllKeys(function(n){for(var r,i=0;i<n.length;i++)t+=n[i].size;$("#spn_TridentDatabaseUsage").text(t+" bytes ("+Math.round(t/1048576*100)/100+"MB)");r=[t/1048576];sandbox.dashboard.gaugeLS=$.jqplot("ui_gaugeTDB",[r],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:"(Actual) Usage in MB",labelPosition:"bottom",min:0,max:120,intervals:[30,60,90,120],intervalColors:["#66cc66","#93b75f","#E7E658","#cc6666"]}}})}))},doBackup:function(){for(var i,u,f,n=$(".tfilechk:checked"),r=[],t=0;t<n.length;t++)i=n[t].name,i=i.replace("file",""),u=parseInt(i),f=t==n.length-1,sandbox.db.getAppKeyById(u,function(t){if(t==null||t.id==0){alertify.log("GetAppKeyById failed");return}if(r.push(t),r.length==n.length){var i=$("#txtBackupName").val();sandbox.files.saveTextFile($("#sb_database_backup_filename").val(),JSON.stringify(r))}})},calcTridentDbUsage:function(){$("#ui_tdb_spnTotalSize").text("");$("#ui_chartTDBspin").show();setTimeout(function(){sandbox.dashboard.calcTridentDbUsageAction()},100)},calcTridentDbUsageAction:function(){var t,i,n;$("#ui_tdb_txtAppName").val("");$("#ui_tdb_txtKeyName").val("");$("#ui_tdb_txtKeySize").val("");sandbox.dashboard.tdbplot&&sandbox.dashboard.tdbplot.destroy();t=[];i=null;$("#ui_tdb_selTridentDB").html("");n=0;sandbox.db.getAllKeys(function(r){var f,u;for(i=r.length,r.length==0&&($("#ui_chartTDBspin").hide(),$("#ui_tdb_spnTotalSize").text("0 bytes.")),f=0;f<r.length;f++)if(u=r[f],$("#ui_tdb_selTridentDB").append($("<option>",{value:u.id,text:u.app+";"+u.key})),n+=u.size,t.push([u.key.slice(0,20),u.size]),--i==0){if($("#UI_TabsDashboard").tabs("option","active")!=2)return;if(n==0?$("#ui_div_trident_usage").hide():$("#ui_div_trident_usage").show(),$("#ui_tdb_spnTotalSize").text(n+" bytes ("+Math.round(n/1048576*100)/100+"MB) "+sandbox.db.name+" adapter"),$("#ui_chartTDBspin").hide(),t.length==0)return;sandbox.dashboard.tdbplot=jQuery.jqplot("ui_tdb_chartTridentUsage",[t],{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0}},legend:{show:!1,location:"e"},highlighter:{show:!0,formatString:"%s",tooltipLocation:"sw",useAxesFormatters:!1}})}})},activateAdapterTab:function(){$("#sb_lbl_adapter_name").text(sandbox.db.name)},populateBackupTab:function(){sandbox.db.getAllKeys(function(n){var f=document.getElementById("sb_backup_keys"),u,i,t,r;for($("#sb_backup_keys").empty(),u=0;u<n.length;u++)i=n[u],t=document.createElement("input"),t.type="checkbox",t.className="tfilechk",t.name="file"+i.id,t.id="file"+i.id,t.style.color="#000",r=document.createElement("label"),r.htmlFor="file"+i.id,r.style.fontSize="20px",r.appendChild(document.createTextNode(i.app+";"+i.key)),r.click=function(){},f.appendChild(t),f.appendChild(r),f.appendChild(document.createElement("br"))})},restoreData:null,restoreFilePicked:function(){var r=document.getElementById("sb_restore_file").files[0],n,t;r&&(n=new FileReader,n.readAsText(r,"UTF-8"),t=$("#sb_restore_file"),t.replaceWith(t=t.clone(!0)),n.onload=function(n){var e=document.getElementById("sb_restore_keys"),o,f,r,t,u;for($("#sb_restore_keys").empty(),o=n.target.result,f=JSON.parse(o),sandbox.dashboard.restoreData=f,i=0;i<f.length;i++)r=f[i],t=document.createElement("input"),t.type="checkbox",t.className="trfilechk",t.name="file"+r.id,t.id="file"+r.id,t.style.color="#000",t.checked=!0,u=document.createElement("label"),u.htmlFor="file"+r.id,u.style.fontSize="20px",u.appendChild(document.createTextNode(r.app+";"+r.key)),u.click=function(){},e.appendChild(t),e.appendChild(u),e.appendChild(document.createElement("br"))},n.onerror=sandbox.files.genericLoadError)},doRestore:function(){var r,u,n,i,f,t;if(sandbox.dashboard.restoreData==null||sandbox.dashboard.restoreData.length==0){alertify.log("nothing selected to restore");return}for(r=$(".trfilechk:checked"),u=[],n=0;n<r.length;n++)i=r[n].name,i=i.replace("file",""),f=parseInt(i),u.push(f);for(n=0;n<sandbox.dashboard.restoreData.length;n++)t=sandbox.dashboard.restoreData[n],u.indexOf(t.id)!==-1&&sandbox.db.setAppKey(t.app,t.key,t.val);setTimeout(function(){sandbox.ide.refreshSlots();sandbox.logger.notifySuccess("Restore Completed.","Trident Database")},300)},deleteTridentKey:function(){var n=$("#ui_tdb_selTridentDB option:selected").val();sandbox.db.deleteAppKey(parseInt(n),function(){sandbox.dashboard.calcTridentDbUsage()})},selTdbChanged:function(){var n=$("#ui_tdb_selTridentDB option:selected").val();sandbox.db.getAppKeyById(parseInt(n),function(n){n.app=="TridentFiles"?$("#ui_tdb_download").show():$("#ui_tdb_download").hide();$("#ui_tdb_txtAppName").val(n.app);$("#ui_tdb_txtKeyName").val(n.key);$("#ui_tdb_txtKeySize").val(n.val.length+" bytes")})},downloadTridentFile:function(){var n=$("#ui_tdb_selTridentDB option:selected").val();sandbox.db.getAppKeyById(parseInt(n),function(n){var t=n.key.replace("TridentFiles;",""),i=n.val;sandbox.files.saveDataURL(t,i)})},renameTridentKey:function(){var n=$("#ui_tdb_selTridentDB option:selected").val();sandbox.db.getAppKeyById(parseInt(n),function(t){sandbox.db.setAppKey(t.app,$("#ui_tdb_txtKeyName").val(),t.val,function(t){t.success&&sandbox.db.deleteAppKey(parseInt(n),function(){sandbox.dashboard.calcTridentDbUsage()})})})},calcLocalStorageUsage:function(){var i,t,n,f,r,u;if(localStorage){for(sandbox.dashboard.lsplot&&sandbox.dashboard.lsplot.destroy(),i=[],$("#ui_ls_txtKeyName").val(""),$("#ui_ls_txtKeySize").val(""),$("#ui_ls_txtLocalStorageValue").val(""),$("#ui_ldb_selLocalStorage").html(""),t=0,n=0;n<localStorage.length;n++)f=localStorage.key(n),r=localStorage[localStorage.key(n)].length,i.push([f,r]),t+=r,$("#ui_ldb_selLocalStorage").append($("<option>",{value:localStorage.key(n),text:localStorage.key(n)}));(u=$("#ui_ldb_selLocalStorage option"),u.sort(function(n,t){return n.text>t.text?1:n.text<t.text?-1:0}),$("#ui_ldb_selLocalStorage").empty().append(u),t==0?$("#ui_div_local_usage").hide():$("#ui_div_local_usage").show(),$("#ui_ldb_spnTotalSize").text("Total Size of Local Storage : "+t+" bytes ("+Math.round(t/1048576*100)/100+"MB)"),i.length!=0)&&(sandbox.dashboard.lsplot=jQuery.jqplot("ui_ldb_chartLocalUsage",[i],{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0}},highlighter:{show:!0,formatString:"%s",tooltipLocation:"sw",useAxesFormatters:!1},legend:{show:!1,location:"e"}}))}},saveLSKey:function(){var n=$("#ui_ls_txtKeyName").val(),t=$("#ui_ls_txtLocalStorageValue").val();localStorage[n]=t;sandbox.dashboard.calcLocalStorageUsage()},selectLSKey:function(){var n=$("#ui_ldb_selLocalStorage option:selected").text();$("#ui_ls_txtKeyName").val(n);$("#ui_ls_txtKeySize").val(localStorage[n].length+" bytes");$("#ui_ls_txtLocalStorageValue").val(localStorage[n])},deleteLSKey:function(){var n=$("#ui_ldb_selLocalStorage option:selected").text();if(n==""){alertify.error("You need to select key from the list before deleting");return}localStorage.removeItem(n);sandbox.dashboard.calcLocalStorageUsage()}},sandboxUnits={logMarkupUnits:function(){sandbox.db.getAppKeys("SandboxMarkupUnits",function(n){for(var t=0;t<n.length;t++)sandbox.logger.log(n[t].key)})},saveMarkupUnit:function(n){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"){var t=sandbox.volatile.editorMarkup.getValue();sandbox.db.setAppKey("SandboxMarkupUnits",n,t,function(n){return n.success?!0:(alertify.error("Error calling SetAppKey()"),!1)})}},loadMarkupUnit:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&sandbox.db.getAppKey("SandboxMarkupUnits",n,function(n){if(n==null||n.id==0)return alertify.error("No markup unit by that name"),!1;sandbox.volatile.markupHash=CryptoJS.SHA1(n.val).toString();sandbox.volatile.editorMarkup.setValue(n.val)})},getMarkupUnit:function(n,t){sandbox.db.getAppKey("SandboxMarkupUnits",n,function(n){if(n==null||n.id==0)return alertify.error("No markup unit by that name"),!1;t(n.val)})},logScriptUnits:function(){sandbox.db.getAppKeys("SandboxScriptUnits",function(n){for(var t=0;t<n.length;t++)sandbox.logger.log(n[t].key)})},saveScriptUnit:function(n){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"){var t=sandbox.volatile.editorScript.getValue();sandbox.db.setAppKey("SandboxScriptUnits",n,t,function(n){return n.success?!0:(alertify.error("Error calling SetAppKey()"),!1)})}},loadScriptUnit:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&sandbox.db.getAppKey("SandboxScriptUnits",n,function(n){if(n==null||n.id==0)return alertify.error("No script unit by that name"),!1;sandbox.volatile.scriptHash=CryptoJS.SHA1(n.val).toString();sandbox.volatile.editorScript.setValue(n.val)})},importScriptUnit:function(n,t){sandbox.db.getAppKey("SandboxScriptUnits",n,function(n){if(n==null||n.id==0)return alertify.error("No script unit by that name"),!1;this.appendScriptUnit(n.val,t)})},appendScriptUnit:function(n,t){var i=document.createElement("script");i.innerHTML=n;document.getElementById("UI_LibUnitPlaceholder").appendChild(i);typeof t=="function"&&setTimeout(function(){t()},200)},clearScriptUnits:function(){$("#UI_LibUnitPlaceholder").empty()}},sandboxAppCache={progressAC:function(){sandbox.volatile.appCacheProgress++;switch(sandbox.volatile.env){case"IDE":$("#sb_spn_appcache_progress").text("("+Math.floor(sandbox.volatile.appCacheProgress*100/147)+"%)");break;case"IDE WJS":$("#sb_spn_appcache_progress").text("("+Math.floor(sandbox.volatile.appCacheProgress*100/147)+"%)");break;case"SBL":$("#sb_spn_ac_progress").text("("+Math.floor(sandbox.volatile.appCacheProgress*100/147)+"%)");break;case"SBL WJS":$("#sb_spn_ac_progress").text("("+Math.floor(sandbox.volatile.appCacheProgress*100/147)+"%)");break;case"SA":$("#sb_spn_ac_progress").text("("+Math.floor(sandbox.volatile.appCacheProgress*100/147)+"%)")}},logACEvent:function(){sandbox.volatile.appCached=!0;var n=sandbox.appcache.getACStatus();n=="Update ready"&&($("#sb_spn_appcache_progress").text(""),setTimeout(function(){sandbox.appcache.promptUpdate()},200));sandbox.volatile.env==="SBL"||sandbox.volatile.env=="SBL WJS"?(n=="Idle"&&setTimeout(function(){$("#divAppCache").hide(500)},1e3),$("#sb_spn_ac_status").text(n)):$("#sb_spn_appcache_status").text(n)},getACStatus:function(){var n,t;try{if(n="Not supported",window.applicationCache){t=window.applicationCache;switch(t.status){case t.UNCACHED:n="Not cached";break;case t.IDLE:n="Idle";$("#sb_spn_appcache_progress").text("");(sandbox.volatile.env=="IDE"||sandbox.volatile.env=="IDE WJS")&&sandbox.ide.fitEditors();break;case t.CHECKING:n="Checking";break;case t.DOWNLOADING:n="Downloading";break;case t.UPDATEREADY:n="Update ready";break;case t.OBSOLETE:n="Obsolete";break;default:n="Unexpected Status ( "+t.status.toString()+")"}}return n}catch(i){alertify.log(i);sandbox.logger.log(i)}},promptUpdate:function(){alertify.confirm("An update exists to your AppCache install.  Do you want to install it and reload this page?",function(n){if(n){try{applicationCache.swapCache()}catch(t){}location.reload()}})}},sandboxUI={setDarkTheme:function(){sandbox.ui.setBackgroundColor("#444");$("#UI_MainPlaceholder").css("color","#fff")},setLightTheme:function(){sandbox.ui.setBackgroundColor("#fff");$("#UI_MainPlaceholder").css("color","#000")},setBackgroundColor:function(n){sandbox.volatile.env==="SBL"||sandbox.volatile.env=="SBL WJS"?($("body").css("background-color",n),$("#UI_MainPlaceholder").css("background-color",n)):($("#UI_Tab_Main").css("background-color",n),$("#UI_MainPlaceholder").css("background-color",n))},clearMain:function(){$("#UI_MainPlaceholder").empty()},fullscreen:function(n){n||(n=document.getElementById("UI_MainPlaceholder"));n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()},fullscreenExit:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},fullscreenToggle:function(){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,n;t?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(n=document.documentElement,n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen())},showPasswordDialog:function(n){typeof n!="function"&&sandbox.logger.log("Call to sandbox.ide.showPasswordDialog() with invalid callback param.");$("#UI_PasswordDialog").show();$("#sb_password_text").focus();$("#sb_password_ok").unbind("click");$("#sb_password_ok").bind("click",function(){n($("#sb_password_text").val())})}},sandboxEvents={windowResize:null,databaseChanged:null,userLoadCallback:null,userdataLoadCallback:null,clean:null},sandboxIDE={run:function(){if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.run");return}$("#divMobileWindowMode").is(":visible")?sandbox.ide.setMobileMode(3):sandbox.volatile.windowMode==1&&sandbox.ide.setWindowMode(2);sandbox.ide.clearOutput();var t=sandbox.volatile.editorMarkup.getValue(),n=sandbox.volatile.editorScript.getValue();n.substring(0,250).indexOf("FLAG_StartPrgFullscreen")!=-1&&document.getElementById("UI_MainPlaceholder").msRequestFullscreen();setTimeout(function(){$("#UI_MainPlaceholder").append(t);var i=document.createElement("script");i.innerHTML=n;setTimeout(function(){document.getElementById("UI_MainPlaceholder").appendChild(i)},150)},250)},launch:function(){var n;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.launch");return}if(n=$("#sb_txt_ProgramName").val(),n==""){alertify.log("Load a program or give this one a program name");return}var t=CryptoJS.SHA1(sandbox.volatile.editorMarkup.getValue()).toString(),i=CryptoJS.SHA1(sandbox.volatile.editorScript.getValue()).toString(),r=$("#sb_sel_trident_slot").find(":selected").text();if(n==r&&t==sandbox.volatile.markupHash&&i==sandbox.volatile.scriptHash){sandbox.volatile.env=="IDE"&&window.open("SandboxLoader.htm#RunSlot="+$("#sb_txt_ProgramName").val(),"_blank");sandbox.volatile.env=="IDE WJS"&&window.open("SandboxLoaderWJS.htm#RunSlot="+$("#sb_txt_ProgramName").val(),"_blank");return}sandbox.ide.saveSlot(function(){sandbox.volatile.env=="IDE"&&window.open("SandboxLoader.htm#RunSlot="+$("#sb_txt_ProgramName").val(),"_blank");sandbox.volatile.env=="IDE WJS"&&window.open("SandboxLoaderWJS.htm#RunSlot="+$("#sb_txt_ProgramName").val(),"_blank")})},clean:function(){var n,t;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.clean");return}$("#sb_password_text").val("");$("#sb_password_ok").unbind("click");n="<h3>My Sandbox Program<\/h3>\r\n";sandbox.volatile.env=="IDE WJS"&&(n="<h3>My Sandbox WinJS Program<\/h3>\r\n");t="// Recommended practice is to place variables in this object and then delete in cleanup\r\nvar sbv = {\r\n\tmyVar : null,\r\n\tmyVar2 : 2\r\n};\r\n\r\nsandbox.events.clean = function()\r\n{\r\n\tdelete sbv.myVar;\r\n\tdelete sbv.myVar2;\r\n};\r\n";sandbox.volatile.editorMarkup.setValue(n);sandbox.volatile.editorScript.setValue(t);sandbox.volatile.markupHash=CryptoJS.SHA1(sandbox.volatile.editorMarkup.getValue()).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(sandbox.volatile.editorScript.getValue()).toString();$("#sb_txt_ProgramName").val("New Program");sandbox.ide.clearOutput()},clearOutput:function(){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"){if(sandbox.events.windowResize=null,sandbox.events.databaseChanged=null,sandbox.events.userLoadCallback=null,sandbox.events.userdataLoadCallback=null,sandbox.volatile.markupCursor=null,sandbox.volatile.scriptCursor=null,sandbox.logger.clearLog(),sandbox.files.userfileHide(),typeof sandbox.events.clean==typeof Function)try{try{sandbox.events.clean()}catch(n){sandbox.logger.notifyError(n,"sandbox.events.clean");sandbox.logger.log(n)}sandbox.events.clean=null}catch(t){alertify.error("sandbox.events.clean: "+t)}document.title="Trident Sandbox "+sandbox.volatile.env+"v"+sandbox.volatile.version;$("#sb_password_text").val("");$("#sb_password_ok").unbind("click");$("#sb_div_restorefile").hide();switch(sandbox.volatile.env){case"IDE":sandbox.ui.setLightTheme();break;case"IDE WJS":sandbox.ui.setDarkTheme()}setTimeout(function(){sandbox.ui.clearMain();sandbox.volatile.vars=null},100);sandbox.ide.setActiveTab(0)}},inspectSelection:function(){var strSelection,scriptSelection,markupSelection,objResult,tbl;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.inspectSelection");return}if(scriptSelection=sandbox.volatile.editorScript.getSelection(),markupSelection=sandbox.volatile.editorMarkup.getSelection(),scriptSelection!=""&&markupSelection!=""&&alertify.error("Ambiguous selection; Highlighted code exists in both editors; using Script selection","",0),scriptSelection==""&&markupSelection==""){alertify.alert("This feature requires you to select a variable or object in the script editor before clicking 'Inspect'.");return}strSelection=scriptSelection!=""?scriptSelection:markupSelection;try{objResult=eval(strSelection)}catch(exc){alertify.error("malformed inspection selection");return}tbl=prettyPrint(objResult,{});$(tbl).dialog({title:"Trident Object/Variable Inspector",width:"auto",maxHeight:$(window).height()-50})},refreshSlots:function(n){$("#sb_sel_trident_slot").html("<option><\/option>");sandbox.db.getAppKeys("SandboxSaveSlots",function(t){var i,r;if(t!=null){for(i=0;i<t.length;i++)$("#sb_sel_trident_slot").append($("<option><\/option>").attr("value",t[i].id).text(t[i].key));r=$("#sb_sel_trident_slot option");r.sort(function(n,t){return n.text>t.text?1:n.text<t.text?-1:0});$("#sb_sel_trident_slot").empty().append(r);sandbox.ide.fitEditors();typeof n=="function"&&n()}else alertify.error("check database configuration")})},runApp:function(n){n=n.replace("%20"," ");n=n.replace(/[^a-zA-Z 0-9\-]+/g,"");n="samples\\"+n+".prg";sandbox.volatile.env==="SBL WJS"&&sandbox.ui.setDarkTheme();jQuery.ajax({type:"GET",url:n,cache:sandbox.settings.cacheSamples==="true"||!navigator.onLine,dataType:"json",success:function(n){var t=n,i,r;sandbox.volatile.env==="IDE"||sandbox.volatile.env=="IDE WJS"?($("#sb_txt_ProgramName").val(t.progName),sandbox.volatile.editorMarkup.setValue(t.htmlText),sandbox.volatile.editorScript.setValue(t.scriptText),sandbox.volatile.markupHash=CryptoJS.SHA1(t.htmlText).toString(),sandbox.volatile.scriptHash=CryptoJS.SHA1(t.scriptText).toString(),i=$("#sb_file"),i.replaceWith(i=i.clone(!0)),sandbox.ide.setWindowMode(3),sandbox.ide.run()):($("#UI_MainPlaceholder").append(t.htmlText),document.title=t.progName,r=document.createElement("script"),r.innerHTML=t.scriptText,setTimeout(function(){document.getElementById("UI_MainPlaceholder").appendChild(r)},350))},error:function(n){sandbox.logger.log("If you are hosting this on your own server, make sure to add mime type for .prg files as text/json");sandbox.logger.log(n.status+" : "+n.statusText);alertify.log(n.status+" : "+n.statusText);alertify.log("See user log for more info")}})},runSlot:function(n){sandbox.volatile.env==="SBL WJS"&&sandbox.ui.setDarkTheme();sandbox.db.getAppKey("SandboxSaveSlots",n,function(n){if(n==null||n.id==0){alertify.error("No save at that slot");return}var t=JSON.parse(n.val);document.title=t.progName;t.scriptText.substring(0,250).indexOf("FLAG_StartPrgFullscreen")!=-1&&document.getElementById("UI_Tab_Main").msRequestFullscreen();setTimeout(function(){$("#UI_MainPlaceholder").append(t.htmlText);var n=document.createElement("script");n.innerHTML=t.scriptText;setTimeout(function(){document.getElementById("UI_MainPlaceholder").appendChild(n)},150)},sandbox.volatile.autorunActive?500:250)})},editApp:function(n){if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.editApp");return}n=n.replace("%20"," ");n=n.replace(/[^a-zA-Z 0-9\-]+/g,"");n="samples\\"+n+".prg";jQuery.ajax({type:"GET",url:n,cache:sandbox.settings.cacheSamples==="true"||!navigator.onLine,dataType:"json",success:function(n){var t=n,i;$("#sb_txt_ProgramName").val(t.progName+" Copy");sandbox.volatile.editorMarkup.setValue(t.htmlText);sandbox.volatile.editorScript.setValue(t.scriptText);sandbox.volatile.markupHash=CryptoJS.SHA1(t.htmlText).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(t.scriptText).toString();i=$("#sb_file");i.replaceWith(i=i.clone(!0));sandbox.ide.setWindowMode(2)},error:function(n){sandbox.logger.log("If you are hosting this on your own server, make sure to add mime type for .prg files as text/json");sandbox.logger.log(n.status+" : "+n.statusText);alertify.log(n.status+" : "+n.statusText);alertify.log("See user log for more info")}})},browseSamples:function(){if(typeof sandbox.events.clean==typeof Function)try{sandbox.events.clean();sandbox.events.clean=null}catch(n){}sandbox.volatile.isHosted?(sandbox.volatile.onlineSamples=!1,sandbox.ide.browseSamplesAction()):alertify.confirm("Go online to access samples?",function(n){n?(sandbox.volatile.onlineSamples=!0,sandbox.ide.browseSamplesAction()):(sandbox.volatile.onlineSamples=!1,sandbox.logger.log("Since you chose not to go online you may encounter permissions errors attempting to load samples using this browser.  You can always use the file pickers to manually load each sample individually offline from your samples folder."),sandbox.ide.browseSamplesAction())})},browseSamplesAction:function(){var n="";if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.browseSamplesAction");return}sandbox.volatile.onlineSamples&&(n="http://www.obeliskos.com/TridentSandbox/",alertify.log("Accessing Online Samples Browser"));setTimeout(function(){var t=n;switch(sandbox.volatile.env){case"IDE":t+="samples/Hosted Samples Browser.prg";break;case"IDE WJS":t+="samples/Samples Browser WJS.prg"}jQuery.ajax({type:"GET",url:t,cache:sandbox.settings.cacheSamples==="true"||!navigator.onLine,dataType:"json",success:function(n){var t=n,i;$("#sb_txt_ProgramName").val(t.progName);sandbox.volatile.editorMarkup.setValue(t.htmlText);sandbox.volatile.editorScript.setValue(t.scriptText);sandbox.volatile.markupHash=CryptoJS.SHA1(t.htmlText).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(t.scriptText).toString();i=$("#sb_file");i.replaceWith(i=i.clone(!0));sandbox.ide.setWindowMode(3);sandbox.ide.run()},error:function(n){sandbox.logger.log("If you are hosting this on your own server, make sure to add mime type for .prg files as text/json");sandbox.logger.log(n.status+" : "+n.statusText);alertify.log(n.status+" : "+n.statusText);alertify.log("See user log for more info")}})},250)},runAutorun:function(){sandbox.volatile.autorunActive=!1;sandbox.db.getAppKey("SandboxScriptUnits","autorun",function(n){n!=null&&n.id!=0&&(sandbox.volatile.autorunActive=!0,API_AppendUnitScript(n.val))})},loadSlot:function(n){if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sb_load_run");return}var t=CryptoJS.SHA1(sandbox.volatile.editorMarkup.getValue()).toString(),i=CryptoJS.SHA1(sandbox.volatile.editorScript.getValue()).toString();if(t!=sandbox.volatile.markupHash||i!=sandbox.volatile.scriptHash){alertify.confirm("You have pending changes, are you sure?",function(t){t?sandbox.ide.loadSlotAction(n):$("#sb_sel_trident_slot").val($("#sb_txt_ProgramName").val())});return}sandbox.ide.loadSlotAction(n)},loadSlotAction:function(){if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.loadSlotAction");return}var n=$("#sb_sel_trident_slot").find(":selected").text();n!=""&&sandbox.db.getAppKey("SandboxSaveSlots",n,function(n){var t=JSON.parse(n.val);sandbox.volatile.markupHash=CryptoJS.SHA1(t.htmlText).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(t.scriptText).toString();$("#sb_txt_ProgramName").val(t.progName);sandbox.volatile.editorMarkup.setValue(t.htmlText);sandbox.volatile.editorScript.setValue(t.scriptText);typeof autorun!="undefined"&&autorun&&sandbox.ide.run()})},saveSlot:function(n){var f,i;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.saveSlot");return}var e=$("#sb_sel_trident_slot").find(":selected").text(),t=$("#sb_txt_ProgramName").val(),r=sandbox.volatile.editorMarkup.getValue(),u=sandbox.volatile.editorScript.getValue();sandbox.volatile.markupHash=CryptoJS.SHA1(r).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1(u).toString();f={progName:t,htmlText:r,scriptText:u};i=JSON.stringify(f,null,2);e!=t?alertify.confirm("Are you sure you want to save into slot "+t,function(r){if(r)try{sandbox.db.setAppKey("SandboxSaveSlots",t,i,function(i){i.success?(sandbox.ide.refreshSlots(function(){$("#sb_sel_trident_slot option").filter(function(){return $(this).text()==t}).prop("selected",!0)}),typeof n=="function"&&n()):alertify.error("error calling SetKey()")})}catch(r){alertify.error("Error encountered during save to TridentDB : "+r.message)}}):sandbox.db.setAppKey("SandboxSaveSlots",t,i,function(t){t.success?(alertify.success("saved"),typeof n=="function"&&n()):alertify.error("Error encountered during save")})},deleteSlot:function(){var n=$("#sb_sel_trident_slot").find(":selected").text();n!=""&&alertify.confirm("Are you sure you want to delete Trident Program Slot : "+n,function(t){t?sandbox.db.getAppKey("SandboxSaveSlots",n,function(n){sandbox.db.deleteAppKey(n.id,function(n){n?sandbox.ide.refreshSlots():alertify.log("Error encountered during delete")})}):alertify.error("No save at that slot")})},toggleHeaderFont:function(){var n=$("#sb_header_caption").css("font-family");n.indexOf("Heorot")!=-1?($("#sb_header_caption").css("font-family","Sans"),$("#sb_header_caption2").css("font-family","Sans")):($("#sb_header_caption").css("font-family","Heorot"),$("#sb_header_caption2").css("font-family","Heorot"))},newProgram:function(){if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.newProgram");return}var n=CryptoJS.SHA1(sandbox.volatile.editorMarkup.getValue()).toString(),t=CryptoJS.SHA1(sandbox.volatile.editorScript.getValue()).toString();if(sandbox.settings.pend_changes_warn){if(n!=sandbox.volatile.markupHash||t!=sandbox.volatile.scriptHash){alertify.confirm("You have pending changes, are you sure?",function(n){if(n){sandbox.volatile.windowMode==3&&sandbox.ide.setWindowMode(2);sandbox.ide.clean();return}});return}sandbox.volatile.windowMode==3&&sandbox.ide.setWindowMode(2);sandbox.ide.clean();return}sandbox.volatile.windowMode==3&&sandbox.ide.setWindowMode(2);sandbox.ide.clean()},toggleMarkup:function(){sandbox.volatile.scriptCursor=sandbox.volatile.editorScript.getCursor();sandbox.volatile.editorMode=sandbox.editorModeEnum.Markup;sandbox.ide.fitEditors();sandbox.volatile.markupCursor&&(sandbox.volatile.editorMarkup.setCursor(sandbox.volatile.markupCursor),sandbox.volatile.editorMarkup.refresh());sandbox.volatile.editorMarkup.focus()},toggleScript:function(){sandbox.volatile.markupCursor=sandbox.volatile.editorMarkup.getCursor();sandbox.volatile.editorMode=sandbox.editorModeEnum.Script;sandbox.ide.fitEditors();sandbox.volatile.scriptCursor&&(sandbox.volatile.editorScript.setCursor(sandbox.volatile.scriptCursor),sandbox.volatile.editorScript.refresh());sandbox.volatile.editorScript.focus()},toggleSplit:function(){sandbox.volatile.editorMode==sandbox.editorModeEnum.Split&&(sandbox.volatile.splitMode=sandbox.volatile.splitMode==0?1:0);sandbox.volatile.editorMode=sandbox.editorModeEnum.Split;sandbox.ide.fitEditors()},fitLog:function(){var n=80,t=$("#sb_div_caption").is(":visible"),i=$("#sb_div_mainloader").is(":visible"),u=!0,f=!window.screenTop&&!window.screenY,r;f&&(r=document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement,r&&(t=!1,i=!1,r.id=="divCode"&&(u=!1)));n+=$("#UI_TabsOutput").find(".ui-tabs-nav").height();(t||i||u)&&(t&&(n+=$("#sb_div_caption").height()),i&&(n+=$("#sb_div_mainloader").height()+4));sandbox.volatile.env=="IDE WJS"&&(n+=$("#UI_TxtLogConsole").height()+4+14);$("#UI_TxtLogText").height($(window).height()-n)},fitEditors:function(){var r,u;if(sandbox.volatile.env=="SBL"||sandbox.volatile.env=="SBL WJS"){console.log("ignoring call to sandbox.ide.fitEditors");console.trace();return}$(window).width()<1100?($(".divWideButtons").hide(),$(".divTinyButtons").show()):($(".divWideButtons").show(),$(".divTinyButtons").hide());var n=$("#ui_editor_toolbar").height()+12,t=$("#sb_div_caption").is(":visible"),i=$("#sb_div_mainloader").is(":visible"),f=!0,e=!window.screenTop&&!window.screenY;e&&(r=document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement,r&&(t=!1,i=!1,r.id=="divCode"&&(f=!1)));(t||i||f)&&(t&&(n+=$("#sb_div_caption").height()),i&&(n+=$("#sb_div_mainloader").height()+4));switch(sandbox.volatile.editorMode){case sandbox.editorModeEnum.Markup:$("#ui_div_markup").css("width","100%");$("#ui_div_script").css("width","100%");sandbox.volatile.editorMarkup.getWrapperElement().style.display="block";sandbox.volatile.editorScript.getWrapperElement().style.display="none";sandbox.volatile.editorMarkup.setSize("100%",$(window).height()-n);$("#sb_btn_markup_fs").prop("disabled","");$("#sb_btn_script_fs").prop("disabled","disabled");break;case sandbox.editorModeEnum.Split:sandbox.volatile.editorMarkup.getWrapperElement().style.display="block";sandbox.volatile.editorScript.getWrapperElement().style.display="block";u=($(window).height()-n)/2;sandbox.volatile.splitMode==0?($("#ui_div_markup").css("width","100%"),$("#ui_div_script").css("width","100%"),sandbox.volatile.editorMarkup.setSize("100%",u),sandbox.volatile.editorScript.setSize("100%",u)):($("#ui_div_markup").css("width","50%"),$("#ui_div_script").css("width","50%"),sandbox.volatile.editorMarkup.setSize("100%",$(window).height()-n),sandbox.volatile.editorScript.setSize("100%",$(window).height()-n));$("#sb_btn_markup_fs").prop("disabled","");$("#sb_btn_script_fs").prop("disabled","");break;case sandbox.editorModeEnum.Script:$("#ui_div_markup").css("width","100%");$("#ui_div_script").css("width","100%");sandbox.volatile.editorMarkup.getWrapperElement().style.display="none";sandbox.volatile.editorScript.getWrapperElement().style.display="block";sandbox.volatile.editorScript.setSize("100%",$(window).height()-n);$("#sb_btn_markup_fs").prop("disabled","disabled");$("#sb_btn_script_fs").prop("disabled","")}},consoleEval:function(){sandbox.volatile.lastConsoleCommand=$("#UI_TxtLogConsole").val();sandbox.logger.log("=> "+sandbox.volatile.lastConsoleCommand);setTimeout(function(){try{var res=eval(sandbox.volatile.lastConsoleCommand);res!=null&&sandbox.logger.log("result: "+res)}catch(err){sandbox.logger.log("Error : "+err.message)}},100);$("#UI_TxtLogConsole").val("")},fullscreenDevArea:function(){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,n;t?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(n=tblCode,n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen())},setActiveTab:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&$("#UI_TabsOutput").tabs("option","active",n)},toggleMaximize:function(){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"){var n=$("#sb_div_caption").is(":visible");n?$("#sb_div_caption").hide():$("#sb_div_caption").show();sandbox.ide.fitEditors();sandbox.ide.fitLog()}},setToolbarMode:function(n,t){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(n?$("#sb_div_caption").show():$("#sb_div_caption").hide(),t?$("#sb_div_mainloader").show():$("#sb_div_mainloader").hide(),sandbox.ide.fitLog(),sandbox.ide.fitEditors())},setWindowMode:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(n==1&&(sandbox.volatile.windowMode=n,$("#tdOutput").attr("width","0%"),$("#tdCode").attr("width","100%"),$("#divCode").show(),$("#tblCode").css("table-layout",""),$("#UI_TabsOutput").hide(),$(".CodeMirror").each(function(n,t){t.CodeMirror.refresh()})),n==2&&(sandbox.volatile.windowMode=n,$("#tdCode").attr("width","50%"),$("#tdOutput").attr("width","50%"),$("#divCode").show(),$("#tblCode").css("table-layout","fixed"),$("#UI_TabsOutput").show(),$(".CodeMirror").each(function(n,t){t.CodeMirror.refresh()})),n==3&&(sandbox.volatile.windowMode=n,$("#tdCode").attr("width","0%"),$("#tdOutput").attr("width","100%"),$("#divCode").hide(),$("#tblCode").css("table-layout",""),$("#UI_TabsOutput").show()))},setMobileMode:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(n==1&&(sandbox.volatile.windowMode=n,$("#tdOutput").attr("width","0%"),$("#tdCode").attr("width","100%"),$("#divCode").show(),$("#tblCode").css("table-layout",""),$("#UI_TabsOutput").hide(),sandbox.volatile.editorMode=sandbox.editorModeEnum.Markup,sandbox.ide.fitEditors(),$(".CodeMirror").each(function(n,t){t.CodeMirror.refresh()})),n==2&&(sandbox.volatile.windowMode=n,$("#tdOutput").attr("width","0%"),$("#tdCode").attr("width","100%"),$("#divCode").show(),$("#tblCode").css("table-layout",""),$("#UI_TabsOutput").hide(),sandbox.volatile.editorMode=sandbox.editorModeEnum.Script,sandbox.ide.fitEditors(),$(".CodeMirror").each(function(n,t){t.CodeMirror.refresh()})),n==3&&(sandbox.volatile.windowMode=n,$("#tdCode").attr("width","0%"),$("#tdOutput").attr("width","100%"),$("#divCode").hide(),$("#tblCode").css("table-layout",""),$("#UI_TabsOutput").show()))},restoreLayout:function(){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(sandbox.ui.fullscreenExit(),sandbox.ide.setToolbarMode(!0,!0),sandbox.ide.setWindowMode(2))},selectTheme:function(){if(sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"){var n=$("#selTheme option:selected").val();localStorage&&sandbox.settings.set("editorTheme",n);sandbox.volatile.editorMarkup.setOption("theme",n);sandbox.volatile.editorScript.setOption("theme",n)}},applyMobileMode:function(n){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(localStorage&&n&&sandbox.settings.set("ideMode","mobile"),$("#divMobileWindowMode").css("display","inline"),$("#divDesktopEditorMode").hide(),$("#divDesktopWindowMode").hide(),sandbox.ide.setMobileMode(1))},applyDesktopMode:function(){sandbox.volatile.env!=="SBL"&&sandbox.volatile.env!="SBL WJS"&&(localStorage&&sandbox.settings.set("ideMode","desktop"),$("#divMobileWindowMode").hide(),$("#divDesktopEditorMode").show(),$("#divDesktopWindowMode").show(),sandbox.ide.setWindowMode(2),sandbox.volatile.editorMode=sandbox.editorModeEnum.Split,sandbox.ide.fitEditors())}},API_GetURLParameter,API_PlaySoundURI,API_LogMessage,API_LogObject,API_ClearLog,VAR_TRIDENT_API,VAR_TRIDENT_VERSION,sandbox={db:null,logger:sbxLogger,media:sandboxMedia,files:sandboxFiles,units:sandboxUnits,ide:sandboxIDE,ui:sandboxUI,events:sandboxEvents,appcache:sandboxAppCache,memstats:sandboxMemstats,dashboard:sandboxDashboard,editorModeEnum:Object.freeze({Markup:1,Split:2,Script:3}),volatile:{version:"2.02",env:"",online:function(){return navigator.onLine},vars:null,markupHash:null,scriptHash:null,isHosted:document.URL.indexOf("file://")===-1,markupHash:null,scriptHash:null,editorMarkup:null,editorScript:null,editorMode:2,windowMode:2,flashTextTab:!1,lastConsoleCommand:"",appCacheProgress:0,appCached:!1,autorunActive:!1,onlineSamples:!0,memStats:null,memStatsRequestId:null,markupCursor:null,scriptCursor:null,splitMode:0,envTest:function(n){return n.indexOf(this.env)!==-1}},settings:{headerText:"Trident Sandbox Development Environment",headerTextWJS:"Trident Sandbox with WinJS framework",headerFont:"Heorot",editorTheme:"vibrant-ink",autorunSlot:"",skipAutorun:"false",errorPopups:"true",pendingChangesWarning:"true",ideMode:"desktop",databaseAdapter:"trident",databaseServiceLocation:"",cacheSamples:"false",load:function(){if(localStorage)for(var n in this)typeof this[n]!="function"&&(typeof localStorage[n]!="undefined"?this[n]=localStorage[n]:localStorage[n]=this[n])},set:function(n,t){this[n]=t;localStorage&&(localStorage[n]=t)}},hashparams:{Theme:"",memstats:"",LoadSlot:"",RunSlot:"",RunApp:"",EditApp:"",SkipAutorun:"false",load:function(){var n,t;for(n in this)typeof this[n]!="function"&&(t=this.getParameter(n),this[n]=typeof t!="undefined"?t:t)},getParameter:function(n){for(var i,u=window.location.hash.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return decodeURIComponent(i[1])}},nullFunction:function(){},dbInit:function(n){n=n||this.nullFunction;sandbox.volatile.envTest(["IDE","IDE WJS"])&&$("#sb_div_ls_slots").css("display","inline-block");indexedDB||sandbox.volatile.isHosted||sandbox.settings.databaseAdapter!=="trident"||(sandbox.settings.databaseAdapter="memory");switch(sandbox.settings.databaseAdapter){case"trident":sandbox.db=new TridentIndexedAdapter({upgradeCallback:function(){sandbox.logger.log("Upgrading")},successCallback:function(){sandbox.logger.log("Trident indexedDB adapter initialized successfully.");sandbox.volatile.env==="IDE"||sandbox.volatile.env=="IDE WJS"?($("#sb_spn_indexeddb_status").text("Yes"),sandbox.ide.refreshSlots(n)):n()},errorCallback:function(){sandbox.logger.log("Error opening TridentSandboxDB (indexedDB).")}});VAR_TRIDENT_API=sandbox.db;break;case"service":sandbox.db=new TridentServiceAdapter({serviceLocation:sandbox.settings.databaseServiceLocation,successCallback:function(){sandbox.logger.log("Trident service adapter initialized successfully.");sandbox.volatile.env==="IDE"||sandbox.volatile.env=="IDE WJS"?($("#sb_spn_indexeddb_status").html("Yes <span style='font-family:Symbol'>Å<\/span>"),sandbox.ide.refreshSlots(n)):n()}});VAR_TRIDENT_API=sandbox.db;break;case"":case"memory":sandbox.db=new TridentMemoryAdapter({successCallback:function(){sandbox.logger.log("In-memory database adapter initialized.");sandbox.logger.log("You may use database backup and restore to save keys to a file, if needed.")}});break;default:sandbox.db=new window[sandbox.settings.databaseAdapter]({successCallback:function(){$("#sb_spn_indexeddb_status").text("Yes");(sandbox.volatile.env==="IDE"||sandbox.volatile.env=="IDE WJS")&&sandbox.ide.refreshSlots(n)},errorCallback:function(){sandbox.logger.log("Error opening adapter "+sandbox.settings.databaseAdapter)}});VAR_TRIDENT_API=sandbox.db}},dbAdapterChanged:function(){sandbox.db.adapter.name=="indexedDB"?$("#sb_spn_indexeddb_status").text("Yes"):$("#sb_spn_indexeddb_status").html("Yes <span style='font-family:Symbol'>Å<\/span>");sandbox.ide.refreshSlots()},initialize:function(n){if(API_LogMessage=this.logger.log,API_LogObject=this.logger.logObject,API_GetURLParameter=sandbox.hashparams.getParameter,API_PlaySoundURI=sandbox.media.playAudio,API_ClearLog=sandbox.logger.clearLog,VAR_TRIDENT_API=sandbox.db,VAR_TRIDENT_VERSION=sandbox.volatile.version,n=n||{},n.hasOwnProperty("env")&&(this.volatile.env=n.env),window.onerror=function(n,t,i,r){if(sandbox.settings.errorPopups)return alertify.error(n+" (line "+i+" col "+r+")"),sandbox.logger.log(n+" (line "+i+" col "+r+")"),!0},alertify.set({buttonReverse:!0}),typeof Uint8ClampedArray=="undefined"&&(Uint8ClampedArray=Uint8Array),sandbox.settings.load(),sandbox.hashparams.load(),sandbox.volatile.env==="IDE"||sandbox.volatile.env==="IDE WJS"){shortcut.add("Alt+R",function(){sandbox.ide.run()});shortcut.add("Alt+S",function(){indexedDB?sandbox.ide.saveSlot():sandbox.files.programSave()});shortcut.add("Alt+Q",function(){sandbox.volatile.editorMode==sandbox.editorModeEnum.Markup?sandbox.ide.toggleSplit():sandbox.ide.toggleMarkup()});shortcut.add("Alt+W",function(){sandbox.volatile.editorMode==sandbox.editorModeEnum.Script?sandbox.ide.toggleSplit():sandbox.ide.toggleScript()});shortcut.add("Alt+I",function(){sandbox.ide.inspectSelection()});shortcut.add("Alt+1",function(){sandbox.ide.setWindowMode(1)});shortcut.add("Alt+2",function(){sandbox.ide.setWindowMode(2)});shortcut.add("Alt+3",function(){sandbox.ide.setWindowMode(3)});$("#sb_txt_ProgramName").val("");$("#divCode").css("display","block");$("#UI_TabsOutput").tabs();$("#UI_TabsDashboard").tabs();$("#sb_radioset").buttonset();sandbox.logger.clearLog();sandbox.volatile.env==="IDE"?(document.title="Trident Sandbox v"+sandbox.volatile.version,$("#sb_txt_Markup").val("<!-- Welcome to TridentSandbox v"+sandbox.volatile.version+"\r\n\r\nCtrl-Space : Bring up code completion list\r\nF11 : (while in an editor) will toggle fullscreen editing.\r\nESC : will also exit fullscreen mode. \r\nAlt+R : Run\r\nAlt+L : If Hosted/AppCached, Save and Launch in new Window\r\nAlt+S : Save\r\nAlt+Q : Toggle Markup\r\nAlt+W : Toggle Script\r\nAlt+I : Inspect\r\nAlt+1/2/3 : Switch between the three window modes\r\nCtrl+Q : Within an editor (on a code fold line) will toggle fold\r\nCtrl-F : Find text (In editor this will do basic search)\r\nCtrl-G : Find next\r\nShift-Ctrl-F : Replace\r\nShift-Ctrl-R : Replace All\r\n-->")):(document.title="Trident Sandbox WJS v"+sandbox.volatile.version,$("#sb_txt_Markup").val("<!-- Welcome to TridentSandbox v"+sandbox.volatile.version+"\r\n\r\nCtrl-Space : Bring up code completion list\r\nF11 : (while in an editor) will toggle fullscreen editing.\r\nESC : will also exit fullscreen mode. \r\nAlt+R : Run\r\nAlt+L : If Hosted/AppCached, Save and Launch in new Window\r\nAlt+S : Save\r\nAlt+Q : Toggle Markup\r\nAlt+W : Toggle Script\r\nAlt+I : Inspect\r\nAlt+1/2/3 : Switch between the three window modes\r\nCtrl+Q : Within an editor (on a code fold line) will toggle fold\r\nCtrl-F : Find text (In editor this will do basic search)\r\nCtrl-G : Find next\r\nShift-Ctrl-F : Replace\r\nShift-Ctrl-R : Replace All\r\n-->"));$("#sb_txt_Script").val("// script editor tips : \r\n// autoindenting is turned on\r\n// the horizontal slashes indicate forced tabs (instead of smart indenting)\r\n// use shift-tab to use auto-indention for a line instead (cleans up tab slashes)\r\n// use ctrl-a or select multiple lines and then press shift-tab to smart indent them\r\n// the javascript linter may notify you of issues with your code, such as : \r\n\r\nfunction badCode() {\r\n\tvar test=[]\r\n\r\n\tvar test = 'a';\r\n}");$("#UI_TabsDashboard").on("tabsactivate",function(n,t){var i=t.newTab.index();switch(i){case 0:sandbox.dashboard.calcSummaryUsage();break;case 1:sandbox.dashboard.calcLocalStorageUsage();break;case 2:sandbox.dashboard.calcTridentDbUsage();break;case 3:sandbox.dashboard.populateBackupTab();break;case 5:sandbox.dashboard.activateAdapterTab()}});document.URL.indexOf("file://")==-1||localStorage||indexedDB?($(".ui_btn_launch").show(),$(".ui_gen_sa").hide(),shortcut.add("Alt+L",function(){sandbox.ide.launch()})):$("#sb_div_diagnostic").hide();sandbox.volatile.markupHash=CryptoJS.SHA1($("#sb_txt_Markup").val()).toString();sandbox.volatile.scriptHash=CryptoJS.SHA1($("#sb_txt_Script").val()).toString();sandbox.volatile.editorMarkup=CodeMirror.fromTextArea(document.getElementById("sb_txt_Markup"),{smartIndent:!0,autoCloseTags:!0,lineNumbers:!0,theme:sandbox.settings.editorTheme,mode:"htmlmixed",matchTags:!0,foldGutter:!0,showCursorWhenSelecting:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],indentUnit:4,tabSize:4,extraKeys:{"Ctrl-Q":function(n){n.foldCode(n.getCursor())},"Ctrl-Space":"autocomplete",F11:function(n){n.setOption("fullScreen",!n.getOption("fullScreen"))},Esc:function(n){n.getOption("fullScreen")&&n.setOption("fullScreen",!1)}}});sandbox.volatile.editorScript=CodeMirror.fromTextArea(document.getElementById("sb_txt_Script"),{smartIndent:!0,lineNumbers:!0,theme:sandbox.settings.editorTheme,mode:{name:"javascript",globalVars:!0},matchBrackets:!0,foldGutter:!0,showCursorWhenSelecting:!0,gutters:["CodeMirror-linenumbers","CodeMirror-lint-markers","CodeMirror-foldgutter"],lint:!0,indentUnit:4,tabSize:4,extraKeys:{"Ctrl-Q":function(n){n.foldCode(n.getCursor())},"Ctrl-Space":"autocomplete",F11:function(n){n.setOption("fullScreen",!n.getOption("fullScreen"))},Esc:function(n){n.getOption("fullScreen")&&n.setOption("fullScreen",!1)}}});sandbox.settings.editorTheme&&sandbox.settings.editorTheme!==""&&($("#selTheme option").filter(function(){return $(this).text()==sandbox.settings.editorTheme}).prop("selected",!0),sandbox.volatile.editorMarkup.setOption("theme",sandbox.settings.editorTheme),sandbox.volatile.editorScript.setOption("theme",sandbox.settings.editorTheme));sandbox.settings.headerFont&&($("#sb_header_caption").css("font-family",sandbox.settings.headerFont),$("#sb_header_caption2").css("font-family",sandbox.settings.headerFont));sandbox.volatile.env=="IDE"?sandbox.settings.headerText&&($("#sb_header_caption").text(sandbox.settings.headerText),$("#sb_header_caption2").text(sandbox.settings.headerText)):sandbox.settings.headerTextWJS&&($("#sb_header_caption").text(sandbox.settings.headerTextWJS),$("#sb_header_caption2").text(sandbox.settings.headerTextWJS));$(".tlt").textillate();sandbox.ide.fitLog();sandbox.ide.fitEditors();localStorage&&($("#sb_spn_localstorage_status").text("Yes"),$("#ui_show_dashboard").show());sandbox.hashparams.getParameter("memstats")&&sandbox.memstats.on();sandbox.settings.ideMode==="mobile"&&sandbox.ide.applyMobileMode();indexedDB?$("#sb_spn_indexeddb_status").text("Yes"):$("#sb_help_link").prop("href","docs/Welcome.htm")}if($(window).resize(function(){sandbox.volatile.envTest(["IDE","IDE WJS"])&&(sandbox.ide.fitLog(),sandbox.ide.fitEditors());typeof sandbox.events.windowResize==typeof Function&&sandbox.events.windowResize()}),window.onhashchange=sandbox.volatile.envTest(["SBL","SBL WJS"])?function(){location.reload()}:function(){var t=sandbox.hashparams.getParameter("LoadSlot"),n,i,r;t!=null&&t!=$("#txtProgramName").val()?(sandbox.ide.clean(),$("#sb_sel_trident_slot").val(t),setTimeout(function(){sandbox.ide.loadSlot()},250)):(n=sandbox.hashparams.getParameter("RunSlot"),n!=null&&n!=$("#txtProgramName").val()?(sandbox.ide.clean(),$("#sb_sel_trident_slot").val(n),setTimeout(function(){sandbox.ide.loadSlot(!0)},250)):(i=sandbox.hashparams.getParameter("RunApp"),i!=null?(sandbox.ide.clean(),setTimeout(function(){sandbox.ide.runApp(i)},200)):(r=sandbox.hashparams.getParameter("EditApp"),r!=null&&(sandbox.ide.clean(),setTimeout(function(){sandbox.ide.editApp(r)},200)))))},sandbox.dbInit(function(){sandbox.postInit()}),sandbox.volatile.isHosted){var t=window.applicationCache;window.applicationCache&&(t.addEventListener("error",sandbox.appcache.logACEvent,!1),t.addEventListener("checking",sandbox.appcache.logACEvent,!1),t.addEventListener("noupdate",sandbox.appcache.logACEvent,!1),t.addEventListener("downloading",sandbox.appcache.logACEvent,!1),t.addEventListener("progress",sandbox.appcache.progressAC,!1),t.addEventListener("updateready",sandbox.appcache.logACEvent,!1),t.addEventListener("cached",sandbox.appcache.logACEvent,!1))}sandbox.volatile.envTest(["SBL","SBL WJS"])&&document.URL.indexOf("file://")==-1&&$("#UI_MainPlaceholder").empty();sandbox.volatile.envTest(["IDE","IDE WJS"])&&(window.onbeforeunload=function(){sandbox.logger.clearLog();var n=CryptoJS.SHA1(sandbox.volatile.editorMarkup.getValue()).toString(),t=CryptoJS.SHA1(sandbox.volatile.editorScript.getValue()).toString();if((n!=sandbox.volatile.markupHash||t!=sandbox.volatile.scriptHash)&&sandbox.settings.pendingChangesWarning=="true")return"You have unsaved changes, are you sure you want to leave this page?"})},postInit:function(){if(sandbox.hashparams.getParameter("LoadSlot")){sandbox.volatile.envTest(["IDE","IDE WJS"])&&(sandbox.ide.clean(),$("#sb_sel_trident_slot").val(sandbox.hashparams.getParameter("LoadSlot")),setTimeout(function(){sandbox.ide.loadSlot()},200));return}if(sandbox.hashparams.getParameter("RunSlot")){sandbox.volatile.env=="IDE"||sandbox.volatile.env=="IDE WJS"?(sandbox.ide.clean(),$("#sb_sel_trident_slot").val(sandbox.hashparams.getParameter("RunSlot")),setTimeout(function(){sandbox.ide.loadSlot(!0)},200)):sandbox.ide.runSlot(sandbox.hashparams.getParameter("RunSlot"));return}if(sandbox.hashparams.getParameter("RunApp")){(sandbox.volatile.env=="IDE"||sandbox.volatile.env=="IDE WJS")&&sandbox.ide.clean();setTimeout(function(){sandbox.ide.runApp(sandbox.hashparams.getParameter("RunApp"))},200);return}if(sandbox.hashparams.getParameter("EditApp")){(sandbox.volatile.env=="IDE"||sandbox.volatile.env=="IDE WJS")&&(sandbox.ide.clean(),setTimeout(function(){sandbox.ide.editApp(sandbox.hashparams.getParameter("EditApp"))},200));return}(sandbox.volatile.env==="SBL"||sandbox.volatile.env==="SBL WJS")&&(sandbox.hashparams.getParameter("RunSlot")||sandbox.hashparams.getParameter("RunApp")||sandbox.ide.runApp("SandboxLanding"))}};TridentMemoryAdapter.prototype.getAllKeys=function(n){var t=this.kvpColl.find();t||(t=[]);t=t.map(function(n){return{id:n.$loki,app:n.app,key:n.key,size:n.app.length+n.key.length+n.val.length}});typeof n=="function"&&n(t)};TridentMemoryAdapter.prototype.getAppKeys=function(n,t){var i=this.kvpColl.find({app:n});i||(i=[]);i=i.map(function(n){return{id:n.$loki,app:n.app,key:n.key,size:n.app.length+n.key.length+n.val.length}});typeof t=="function"&&t(i)};TridentMemoryAdapter.prototype.getAppKey=function(n,t,i){var r=this.kvpColl.findOne({$and:[{app:n},{key:t}]});if(typeof i=="function"){if(!r){i(r);return}i({id:r.$loki,app:r.app,key:r.key,val:r.val})}};TridentMemoryAdapter.prototype.getAppKeyById=function(n,t){var i=this.kvpColl.get(n);if(typeof t=="function"){if(!i){t(null);return}t({id:i.$loki,app:i.app,key:i.key,val:i.val})}};TridentMemoryAdapter.prototype.setAppKey=function(n,t,i,r){var u=this.kvpColl.findOne({$and:[{app:n},{key:t}]});u?(u.val=i,this.kvpColl.update(u)):this.kvpColl.insert({app:n,key:t,val:i});typeof r=="function"&&r({success:!0})};TridentMemoryAdapter.prototype.deleteAppKey=function(n,t){var i=this.kvpColl.get(n);if(!i){typeof t=="function"&&t({success:!1});return}this.kvpColl.remove(n);typeof t=="function"&&t({success:!0})};TridentIndexedAdapter.prototype.initializeDatabase=function(){var t=indexedDB.open("TridentSandboxDB",1),n=this;t.onupgradeneeded=function(t){if(n.db=t.target.result,n.db.objectStoreNames.contains("TridentSandboxKVP")&&n.db.deleteObjectStore("TridentSandboxKVP"),!n.db.objectStoreNames.contains("TridentSandboxKVP")){var i=n.db.createObjectStore("TridentSandboxKVP",{keyPath:"id",autoIncrement:!0});i.createIndex("app","app",{unique:!1});i.createIndex("key","key",{unique:!1});i.createIndex("appkey","appkey",{unique:!0})}n.upgradeCallback()};t.onsuccess=function(t){n.db=t.target.result;n.successCallback(n)};t.onerror=function(){n.errorCallback()}};TridentIndexedAdapter.prototype.getAllKeys=function(n){var i=this.db.transaction(["TridentSandboxKVP"],"readonly"),r=i.objectStore("TridentSandboxKVP"),t=r.openCursor();t.onsuccess=function(n,t){return function(i){var u=i.target.result,r,f;u?(r=u.value,f={id:r.id,app:r.app,key:r.key,size:r.app.length*2+r.key.length*2+r.val.length+1},n.push(f),u.continue()):typeof t=="function"&&t(n)}}([],n);t.onerror=function(n){return function(){typeof n=="function"&&n(null)}}(n)};TridentIndexedAdapter.prototype.getAppKeys=function(n,t){var r=this.db.transaction(["TridentSandboxKVP"],"readonly"),u=r.objectStore("TridentSandboxKVP"),f=u.index("app"),e=IDBKeyRange.only(n),i=f.openCursor(e);i.onsuccess=function(n,t){return function(i){var u=i.target.result,r,f;u?(r=u.value,f={id:r.id,app:r.app,key:r.key,size:r.app.length*2+r.key.length*2+r.val.length+1},n.push(f),u.continue()):typeof t=="function"&&t(n)}}([],t);i.onerror=function(n){return function(){typeof n=="function"&&n(null)}}(t)};TridentIndexedAdapter.prototype.getAppKey=function(n,t,i){var u=this.db.transaction(["TridentSandboxKVP"],"readonly"),f=u.objectStore("TridentSandboxKVP"),e=f.index("appkey"),o=n+","+t,r=e.get(o);r.onsuccess=function(n){return function(t){if(typeof n=="function"){var i=t.target.result;typeof i=="undefined"&&(i={id:0,success:!1});n(i)}}}(i);r.onerror=function(n){return function(){typeof n=="function"&&n({id:0,success:!1})}}(i)};TridentIndexedAdapter.prototype.getAppKeyById=function(n,t){var i=this.db.transaction(["TridentSandboxKVP"],"readonly"),r=i.objectStore("TridentSandboxKVP"),u=r.get(n);u.onsuccess=function(n){return function(t){typeof n=="function"&&n(t.target.result)}}(t)};TridentIndexedAdapter.prototype.setAppKey=function(n,t,i,r){var e=this.db.transaction(["TridentSandboxKVP"],"readwrite"),u=e.objectStore("TridentSandboxKVP"),o=u.index("appkey"),s=n+","+t,f=o.get(s);f.onsuccess=function(f){var e=f.target.result,o;e?e.val=i:e={app:n,key:t,appkey:n+","+t,val:i};o=u.put(e);o.onerror=function(n){return function(){typeof n=="function"&&n({success:!1})}}(r);o.onsuccess=function(n){return function(){typeof n=="function"&&n({success:!0})}}(r)};f.onerror=function(n){return function(){typeof n=="function"&&n({success:!1})}}(r)};TridentIndexedAdapter.prototype.deleteAppKey=function(n,t){var r=this.db.transaction(["TridentSandboxKVP"],"readwrite"),u=r.objectStore("TridentSandboxKVP"),i=u.delete(n);i.onsuccess=function(n){return function(){typeof n=="function"&&n({success:!0})}}(t);i.onerror=function(n){return function(){typeof n=="function"&&n(!1)}}(t)};TridentServiceAdapter.prototype.getAllKeys=function(n){$.ajax({url:this.serviceLocation+"GetAllKeys",type:"POST",cache:!1,dataType:"json",usercallback:n,success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback(null)}})};TridentServiceAdapter.prototype.getAppKeys=function(n,t){var i={App:n};$.ajax({url:this.serviceLocation+"GetAppKeys",type:"POST",data:i,cache:!1,usercallback:t,dataType:"json",success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback(null)}})};TridentServiceAdapter.prototype.getAppKey=function(n,t,i){var r={App:n,Key:t};$.ajax({url:this.serviceLocation+"GetKey",type:"POST",data:r,cache:!1,dataType:"json",usercallback:i,success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback(null)}})};TridentServiceAdapter.prototype.getAppKeyById=function(n,t){var i={id:n};$.ajax({url:this.serviceLocation+"GetKeyById",type:"POST",data:i,cache:!1,dataType:"json",usercallback:t,success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback(null)}})};TridentServiceAdapter.prototype.setAppKey=function(n,t,i,r){var u={app:n,key:t,val:i};$.ajax({url:this.serviceLocation+"SetKey",type:"POST",data:u,cache:!1,dataType:"json",usercallback:r,success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback(null)}})};TridentServiceAdapter.prototype.deleteAppKey=function(n,t){var i={id:n};$.ajax({url:this.serviceLocation+"RemoveKey",type:"POST",data:i,cache:!1,dataType:"json",usercallback:t,success:function(n){typeof this.usercallback=="function"&&this.usercallback(n)},error:function(){typeof this.usercallback=="function"&&this.usercallback({success:!1})}})};TridentList.prototype.makeBright=function(){this.listSettings.bright=!0;$("#"+this.listSettings.listElementId).attr("class","tlist-bright");$("#"+this.listSettings.listElementId).find("div.tlistitem").attr("class","tlistitem-bright");$("#"+this.listSettings.listElementId).find("div.tlistitem-selected").attr("class","tlistitem-selected-bright");$("#"+this.listSettings.listElementId).find("span.tlistitem-caption").attr("class","tlistitem-caption-bright");$("#"+this.listSettings.listElementId).find("span.tlistitem-description").attr("class","tlistitem-description-bright")};TridentList.prototype.setCaptionColor=function(n){$("#"+this.listSettings.listElementId).find("span.tlistitem-caption").css("color",n);$("#"+this.listSettings.listElementId).find("span.tlistitem-caption-bright").css("color",n)};TridentList.prototype.clearList=function(){$("#"+this.listSettings.listElementId).empty()};TridentList.prototype.addListItem=function(n,t,i,r){var o=document.createElement("span"),f,u,e,s;o.className=this.listSettings.bright?"tlistitem-caption-bright":"tlistitem-caption";$(o).text(t);f=document.createElement("span");f.className=this.listSettings.bright?"tlistitem-description-bright":"tlistitem-description";typeof i!="undefined"&&(typeof r!="undefined"&&r?$(f).html(i):$(f).text(i));u=document.createElement("div");u.className=this.listSettings.bright?"tlistitem-bright":"tlistitem";$(u).attr("data-item-id",n);u.appendChild(o);u.appendChild(document.createElement("br"));u.appendChild(f);u.onclick=function(n,t){return function(){t.bright?($("#"+t.listElementId).find("div.tlistitem-selected-bright").attr("class","tlistitem-bright"),this.className="tlistitem-selected-bright"):($("#"+t.listElementId).find("div.tlistitem-selected").attr("class","tlistitem"),this.className="tlistitem-selected");t.selectedId=n;t.clickCallback&&t.clickCallback(t.listElementId,n)}}(n,this.listSettings);e=document.createElement("li");$(e).attr("data-item-id",n);e.appendChild(u);s=document.getElementById(this.listSettings.listElementId);s.appendChild(e)};TridentList.prototype.addListItemRaw=function(n,t){var i=document.createElement("div"),r,u;i.className=this.listSettings.bright?"tlistitem-bright":"tlistitem";$(i).attr("data-item-id",n);$(i).html(t);i.onclick=function(n,t){return function(){t.bright?($("#"+t.listElementId).find("div.tlistitem-selected-bright").attr("class","tlistitem-bright"),this.className="tlistitem-selected-bright"):($("#"+t.listElementId).find("div.tlistitem-selected").attr("class","tlistitem"),this.className="tlistitem-selected");t.selectedId=n;t.clickCallback&&t.clickCallback(t.listElementId,n)}}(n,this.listSettings);r=document.createElement("li");$(r).attr("data-item-id",n);r.appendChild(i);u=document.getElementById(this.listSettings.listElementId);u.appendChild(r)};TridentList.prototype.deleteListItem=function(n){n==null&&(n=this.listSettings.selectedId);$("#"+this.listSettings.listElementId).find("li[data-item-id="+n+"]").remove();this.listSettings.selectedId=null};TridentList.prototype.updateListItem=function(n,t,i){var r=$("#"+this.listSettings.listElementId).find("li[data-item-id="+n+"]");this.listSettings.bright?($(r).find("span.tlistitem-caption-bright").text(t),$(r).find("span.tlistitem-description-bright").text(i)):($(r).find("span.tlistitem-caption").text(t),$(r).find("span.tlistitem-description").text(i))};TridentList.prototype.setSelection=function(n){$("#"+this.listSettings.listElementId).find("div.tlistitem-selected").attr("class","tlistitem");$("#"+this.listSettings.listElementId).find("div.tlistitem-selected-bright").attr("class","tlistitem-bright");var t=$("#"+this.listSettings.listElementId).find("div[data-item-id="+n+"]");t&&t.length>0?(this.listSettings.bright?$(t).addClass("tlistitem-selected-bright"):$(t).addClass("tlistitem-selected"),this.listSettings.selectedId=n):this.listSettings.selectedId=null};
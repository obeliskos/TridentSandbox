(function(n){function r(t,i,r){var u,f;if(r=r||{},r.axesDefaults=r.axesDefaults||{},r.legend=r.legend||{},r.seriesDefaults=r.seriesDefaults||{},u=!1,r.seriesDefaults.renderer==n.jqplot.FunnelRenderer)u=!0;else if(r.series)for(f=0;f<r.series.length;f++)r.series[f].renderer==n.jqplot.FunnelRenderer&&(u=!0);u&&(r.axesDefaults.renderer=n.jqplot.FunnelAxisRenderer,r.legend.renderer=n.jqplot.FunnelLegendRenderer,r.legend.preDraw=!0,r.sortData=!1,r.seriesDefaults.pointLabels={show:!1})}function u(){for(var t=0;t<this.series.length;t++)this.series[t].renderer.constructor==n.jqplot.FunnelRenderer&&this.series[t].highlightMouseOver&&(this.series[t].highlightMouseDown=!1)}function f(){for(var t=0;t<this.series.length;t++)this.series[t].seriesColors=this.seriesColors,this.series[t].colorGenerator=n.jqplot.colorGenerator}function i(n,t,i){var r=n.series[t],u=n.plugins.funnelRenderer.highlightCanvas;u._ctx.clearRect(0,0,u._ctx.canvas.width,u._ctx.canvas.height);r._highlightedPoint=i;n.plugins.funnelRenderer.highlightedSeriesIndex=t;r.renderer.drawSection.call(r,u._ctx,r._vertices[i],r.highlightColors[i],!1)}function t(n){var i=n.plugins.funnelRenderer.highlightCanvas,t;for(i._ctx.clearRect(0,0,i._ctx.canvas.width,i._ctx.canvas.height),t=0;t<n.series.length;t++)n.series[t]._highlightedPoint=null;n.plugins.funnelRenderer.highlightedSeriesIndex=null;n.target.trigger("jqplotDataUnhighlight")}function e(n,r,u,f,e){var o,h,s;f?(o=[f.seriesIndex,f.pointIndex,f.data],h=jQuery.Event("jqplotDataMouseOver"),h.pageX=n.pageX,h.pageY=n.pageY,e.target.trigger(h,o),!e.series[o[0]].highlightMouseOver||o[0]==e.plugins.funnelRenderer.highlightedSeriesIndex&&o[1]==e.series[o[0]]._highlightedPoint||(s=jQuery.Event("jqplotDataHighlight"),s.which=n.which,s.pageX=n.pageX,s.pageY=n.pageY,e.target.trigger(s,o),i(e,o[0],o[1]))):f==null&&t(e)}function o(n,r,u,f,e){var o,s;f?(o=[f.seriesIndex,f.pointIndex,f.data],!e.series[o[0]].highlightMouseDown||o[0]==e.plugins.funnelRenderer.highlightedSeriesIndex&&o[1]==e.series[o[0]]._highlightedPoint||(s=jQuery.Event("jqplotDataHighlight"),s.which=n.which,s.pageX=n.pageX,s.pageY=n.pageY,e.target.trigger(s,o),i(e,o[0],o[1]))):f==null&&t(e)}function s(n,i,r,u,f){var e=f.plugins.funnelRenderer.highlightedSeriesIndex;e!=null&&f.series[e].highlightMouseDown&&t(f)}function h(n,t,i,r,u){if(r){var e=[r.seriesIndex,r.pointIndex,r.data],f=jQuery.Event("jqplotDataClick");f.which=n.which;f.pageX=n.pageX;f.pageY=n.pageY;u.target.trigger(f,e)}}function c(n,i,r,u,f){var s,o,e;u&&(s=[u.seriesIndex,u.pointIndex,u.data],o=f.plugins.funnelRenderer.highlightedSeriesIndex,o!=null&&f.series[o].highlightMouseDown&&t(f),e=jQuery.Event("jqplotDataRightClick"),e.which=n.which,e.pageX=n.pageX,e.pageY=n.pageY,f.target.trigger(e,s))}function l(){var i,r;this.plugins.funnelRenderer&&this.plugins.funnelRenderer.highlightCanvas&&(this.plugins.funnelRenderer.highlightCanvas.resetCanvas(),this.plugins.funnelRenderer.highlightCanvas=null);this.plugins.funnelRenderer={};this.plugins.funnelRenderer.highlightCanvas=new n.jqplot.GenericCanvas;i=n(this.targetId+" .jqplot-data-label");i.length?n(i[0]).before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this)):this.eventCanvas._elem.before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this));r=this.plugins.funnelRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(n){t(n.data.plot)})}n.jqplot.FunnelRenderer=function(){n.jqplot.LineRenderer.call(this)};n.jqplot.FunnelRenderer.prototype=new n.jqplot.LineRenderer;n.jqplot.FunnelRenderer.prototype.constructor=n.jqplot.FunnelRenderer;n.jqplot.FunnelRenderer.prototype.init=function(t,i){var y,r,v;for(this.padding={top:20,right:20,bottom:20,left:20},this.sectionMargin=6,this.fill=!0,this.shadowOffset=2,this.shadowAlpha=.07,this.shadowDepth=5,this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColors=[],this.widthRatio=.2,this.lineWidth=2,this.dataLabels="percent",this.showDataLabels=!1,this.dataLabelFormatString=null,this.dataLabelThreshold=3,this._type="funnel",this.tickRenderer=n.jqplot.FunnelTickRenderer,t.highlightMouseDown&&t.highlightMouseOver==null&&(t.highlightMouseOver=!1),n.extend(!0,this,t),this._highlightedPoint=null,this._bases=[],this._atot,this._areas=[],this._lengths=[],this._angle,this._dataIndices=[],this._unorderedData=n.extend(!0,[],this.data),y=n.extend(!0,[],this.data),r=0;r<y.length;r++)y[r].push(r);for(this.data.sort(function(n,t){return t[1]-n[1]}),y.sort(function(n,t){return t[1]-n[1]}),r=0;r<y.length;r++)this._dataIndices.push(y[r][2]);if(this.highlightColors.length==0)for(r=0;r<this.seriesColors.length;r++){var p=n.jqplot.getColorComponents(this.seriesColors[r]),a=[p[0],p[1],p[2]],w=a[0]+a[1]+a[2];for(v=0;v<3;v++)a[v]=w>570?a[v]*.8:a[v]+.4*(255-a[v]),a[v]=parseInt(a[v],10);this.highlightColors.push("rgb("+a[0]+","+a[1]+","+a[2]+")")}i.postParseOptionsHooks.addOnce(f);i.postInitHooks.addOnce(u);i.eventListenerHooks.addOnce("jqplotMouseMove",e);i.eventListenerHooks.addOnce("jqplotMouseDown",o);i.eventListenerHooks.addOnce("jqplotMouseUp",s);i.eventListenerHooks.addOnce("jqplotClick",h);i.eventListenerHooks.addOnce("jqplotRightClick",c);i.postDrawHooks.addOnce(l)};n.jqplot.FunnelRenderer.prototype.setGridData=function(){for(var i=0,t=[],n=0;n<this.data.length;n++)i+=this.data[n][1],t.push([this.data[n][0],this.data[n][1]]);for(n=0;n<t.length;n++)t[n][1]=t[n][1]/i;this._bases=new Array(t.length+1);this._lengths=new Array(t.length);this.gridData=t};n.jqplot.FunnelRenderer.prototype.makeGridData=function(){for(var i=0,t=[],n=0;n<this.data.length;n++)i+=this.data[n][1],t.push([this.data[n][0],this.data[n][1]]);for(n=0;n<t.length;n++)t[n][1]=t[n][1]/i;return this._bases=new Array(t.length+1),this._lengths=new Array(t.length),t};n.jqplot.FunnelRenderer.prototype.drawSection=function(n,t,i,r){function f(){n.beginPath();n.fillStyle=i;n.strokeStyle=i;n.lineWidth=o;n.moveTo(t[0][0],t[0][1]);for(var r=1;r<4;r++)n.lineTo(t[r][0],t[r][1]);n.closePath();e?n.fill():n.stroke()}var e=this.fill,o=this.lineWidth,u;if(n.save(),r)for(u=0;u<this.shadowDepth;u++)n.save(),n.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI)),f();else f();if(r)for(u=0;u<this.shadowDepth;u++)n.restore();n.restore()};n.jqplot.FunnelRenderer.prototype.draw=function(t,i,r,u){function at(n){var t=(p[1]-tt[1])/(p[0]-tt[0]),r=p[1]-t*p[0],i=n+p[1];return[(i-r)/t,i]}function vt(n){var t=(w[1]-lt[1])/(w[0]-lt[0]),r=w[1]-t*w[0],i=n+w[1];return[(i-r)/t,i]}var a=r!=undefined?r:{},h=0,y=0,c=1,e,ut,st,nt,ft,et,ht,ct,v,yt,f,s,l,k;if(this._areas=[],r.legendInfo&&r.legendInfo.placement=="insideGrid"){e=r.legendInfo;switch(e.location){case"nw":h=e.width+e.xoffset;break;case"w":h=e.width+e.xoffset;break;case"sw":h=e.width+e.xoffset;break;case"ne":h=e.width+e.xoffset;c=-1;break;case"e":h=e.width+e.xoffset;c=-1;break;case"se":h=e.width+e.xoffset;c=-1;break;case"n":y=e.height+e.yoffset;break;case"s":y=e.height+e.yoffset;c=-1}}var d=c==1?this.padding.left+h:this.padding.left,g=c==1?this.padding.top+y:this.padding.top,pt=c==-1?this.padding.right+h:this.padding.right,wt=c==-1?this.padding.bottom+y:this.padding.bottom,dt=a.shadow!=undefined?a.shadow:this.shadow,gt=a.showLine!=undefined?a.showLine:this.showLine,ni=a.fill!=undefined?a.fill:this.fill,bt=t.canvas.width,kt=t.canvas.height;for(this._bases[0]=bt-d-pt,ut=this._length=kt-g-wt,st=this._bases[0]*this.widthRatio,this._atot=ut/2*(this._bases[0]+this._bases[0]*this.widthRatio),this._angle=Math.atan((this._bases[0]-st)/2/ut),f=0;f<i.length;f++)this._areas.push(i[f][1]*this._atot);for(ht=0,ct=.0001,f=0;f<this._areas.length;f++){for(nt=this._areas[f]/this._bases[f],ft=999999,this._lengths[f]=nt,et=0;ft>this._lengths[f]*ct&&et<100;)this._lengths[f]=this._areas[f]/(this._bases[f]-this._lengths[f]*Math.tan(this._angle)),ft=Math.abs(this._lengths[f]-nt),this._bases[f+1]=this._bases[f]-2*this._lengths[f]*Math.tan(this._angle),nt=this._lengths[f],et++;ht+=this._lengths[f]}this._vertices=new Array(i.length);var p=[d,g],w=[d+this._bases[0],g],tt=[d+(this._bases[0]-this._bases[this._bases.length-1])/2,g+this._length],lt=[tt[0]+this._bases[this._bases.length-1],tt[1]];var it=h,rt=y,b=0,o=0;for(f=0;f<i.length;f++)this._vertices[f]=[],s=this._vertices[f],v=this.sectionMargin,f==0&&(o=0),f==1?o=v/3:f>0&&f<i.length-1?o=v/2:f==i.length-1&&(o=2*v/3),s.push(at(b+o)),s.push(vt(b+o)),b+=this._lengths[f],f==0?o=-2*v/3:f>0&&f<i.length-1?o=-v/2:f==i.length-1&&(o=0),s.push(vt(b+o)),s.push(at(b+o));if(this.shadow)for(yt="rgba(0,0,0,"+this.shadowAlpha+")",f=0;f<i.length;f++)this.renderer.drawSection.call(this,t,this._vertices[f],yt,!0);for(f=0;f<i.length;f++)if(s=this._vertices[f],this.renderer.drawSection.call(this,t,s,this.seriesColors[f]),this.showDataLabels&&i[f][1]*100>=this.dataLabelThreshold){this.dataLabels=="label"?(l=this.dataLabelFormatString||"%s",k=n.jqplot.sprintf(l,i[f][0])):this.dataLabels=="value"?(l=this.dataLabelFormatString||"%d",k=n.jqplot.sprintf(l,this.data[f][1])):this.dataLabels=="percent"?(l=this.dataLabelFormatString||"%d%%",k=n.jqplot.sprintf(l,i[f][1]*100)):this.dataLabels.constructor==Array&&(l=this.dataLabelFormatString||"%s",k=n.jqplot.sprintf(l,this.dataLabels[this._dataIndices[f]]));var ti=this._radius*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge,it=(s[0][0]+s[1][0])/2+this.canvas._offsets.left,rt=(s[1][1]+s[2][1])/2+this.canvas._offsets.top,ot=n('<span class="jqplot-funnel-series jqplot-data-label" style="position:absolute;">'+k+"<\/span>").insertBefore(u.eventCanvas._elem);it-=ot.width()/2;rt-=ot.height()/2;it=Math.round(it);rt=Math.round(rt);ot.css({left:it,top:rt})}};n.jqplot.FunnelAxisRenderer=function(){n.jqplot.LinearAxisRenderer.call(this)};n.jqplot.FunnelAxisRenderer.prototype=new n.jqplot.LinearAxisRenderer;n.jqplot.FunnelAxisRenderer.prototype.constructor=n.jqplot.FunnelAxisRenderer;n.jqplot.FunnelAxisRenderer.prototype.init=function(t){this.tickRenderer=n.jqplot.FunnelTickRenderer;n.extend(!0,this,t);this._dataBounds={min:0,max:100};this.min=0;this.max=100;this.showTicks=!1;this.ticks=[];this.showMark=!1;this.show=!1};n.jqplot.FunnelLegendRenderer=function(){n.jqplot.TableLegendRenderer.call(this)};n.jqplot.FunnelLegendRenderer.prototype=new n.jqplot.TableLegendRenderer;n.jqplot.FunnelLegendRenderer.prototype.constructor=n.jqplot.FunnelLegendRenderer;n.jqplot.FunnelLegendRenderer.prototype.init=function(t){this.numberRows=null;this.numberColumns=null;n.extend(!0,this,t)};n.jqplot.FunnelLegendRenderer.prototype.draw=function(){var d=this,w,t,r,u,a,f,v,e,y,p,b,o;if(this.show){w=this._series;t="position:absolute;";t+=this.background?"background:"+this.background+";":"";t+=this.border?"border:"+this.border+";":"";t+=this.fontSize?"font-size:"+this.fontSize+";":"";t+=this.fontFamily?"font-family:"+this.fontFamily+";":"";t+=this.textColor?"color:"+this.textColor+";":"";t+=this.marginTop!=null?"margin-top:"+this.marginTop+";":"";t+=this.marginBottom!=null?"margin-bottom:"+this.marginBottom+";":"";t+=this.marginLeft!=null?"margin-left:"+this.marginLeft+";":"";t+=this.marginRight!=null?"margin-right:"+this.marginRight+";":"";this._elem=n('<table class="jqplot-table-legend" style="'+t+'"><\/table>');var h=!1,c=!1,i,s,l=w[0],k=new n.jqplot.ColorGenerator(l.seriesColors);if(l.show)for(r=l.data,this.numberRows?(i=this.numberRows,s=this.numberColumns?this.numberColumns:Math.ceil(r.length/i)):this.numberColumns?(s=this.numberColumns,i=Math.ceil(r.length/this.numberColumns)):(i=r.length,s=1),o=0,u=0;u<i;u++)for(f=c?n('<tr class="jqplot-table-legend"><\/tr>').prependTo(this._elem):n('<tr class="jqplot-table-legend"><\/tr>').appendTo(this._elem),a=0;a<s;a++)o<r.length&&(y=this.labels[o]||r[o][0].toString(),b=k.next(),h=c?u==i-1?!1:!0:u>0?!0:!1,p=h?this.rowSpacing:"0",v=n('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+p+';"><div><div class="jqplot-table-legend-swatch" style="border-color:'+b+';"><\/div><\/div><\/td>'),e=n('<td class="jqplot-table-legend" style="padding-top:'+p+';"><\/td>'),this.escapeHtml?e.text(y):e.html(y),c?(e.prependTo(f),v.prependTo(f)):(v.appendTo(f),e.appendTo(f)),h=!0),o++}return this._elem};n.jqplot.preInitHooks.push(r);n.jqplot.FunnelTickRenderer=function(){n.jqplot.AxisTickRenderer.call(this)};n.jqplot.FunnelTickRenderer.prototype=new n.jqplot.AxisTickRenderer;n.jqplot.FunnelTickRenderer.prototype.constructor=n.jqplot.FunnelTickRenderer})(jQuery);
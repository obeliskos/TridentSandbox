{
  "progName": "Trident DB Usage",
  "htmlText": "<style>\n    fieldset { \n        padding: 1em;\n        font:80%/1 sans-serif;\n        border:1px solid black; \n    }\n    label.lb4 {\n        float:left;\n        width:15%;\n        margin-right:0.5em;\n        padding-top:0.2em;\n        text-align:right;\n        font-weight:bold;\n    }\n\n    legend {\n        padding: 0.2em 0.5em;\n        border:1px solid black;\n        color:black;\n        font-size:90%;\n        text-align:right;\n    }\n\n</style>\n\n<h3>Trident DB Usage</h3>\n\n<table>\n    <tr>\n        <td>\n            Trident DB size total : <span id='spnTotalSize'></span>\n        </td>\n        <td>\n            <span id='spnKeySize'></span> \n        </td>\n    </tr>\n    <tr>\n        <td valign='top'><div id=\"chart1\" style=\"width:320px\" ></div><br/></td>\n        <td valign='top'>\n            <br/>\n            <select id=\"selTridentDB\" size=12 onchange=\"selChanged()\" style=\"min-width:150px\"></select><br/>\n        </td>\n    </tr>\n</table>\n\n<fieldset>\n    <legend>Trident Key Settings :</legend>\n    <input type='hidden' id='hfKeyId'/>\n    <input type='text' id='txtAppName' style='width:400px'/>\n    <label class=\"lb4\" for=\"txtAppName\">App Name : </label><br/><br/>\n    <input type='text' id='txtKeyName' style='width:400px'/>\n    <label class=\"lb4\" for=\"txtKeyName\">Key Name : </label><br/><br/>\n    <textarea spellcheck='false' style=\"width:80%; height:160px;\" id='txtTridentValue'></textarea>\n    <label class=\"lb4\" for=\"txtTridentValue\">Key Value : </label><br/><br/>\n    <span style=\"float:left; margin-left:120px\">\n        <button class=\"minimal\" onclick=\"doAdd();\"><i class=\"fa fa-plus-circle\"></i> New</button>\n        <button class=\"minimal\" onclick=\"doUpdate();\"><i class=\"fa fa-save\"></i> Save</button>\n        <button class=\"minimal\" onclick=\"doDelete();\"><i class=\"fa fa-trash-o\"></i> Delete</button>\n    </span>\n</fieldset>\n\n",
  "scriptText": "var sbv = {\n    arrayLS : [],\n    totalSize : 0,\n    plot1 : null,\n    loopCounter: 0\n};\n\nsandbox.events.clean = function() {\n    delete sbv.arrayLS;\n\n    if (sbv.plot1) {\n        sbv.plot1.destroy();\n    }\n\n    delete sbv.plot1;\n};\n\nif (!sandbox.db) {\n    alertify.log(\"This sample only works in a hosted or appcache environment\");\n}\nelse {\n    loadTridentDB();\n}\n\nfunction loadTridentDB() {\n\n    $(\"#txtTridentValue\").val(\"\");\n    $(\"#spnKeySize\").text(\"Key Size : \");\n\n    $(\"#hfKeyId\").text(\"0\");\n    $(\"#txtAppName\").val(\"\");\n    $(\"#txtKeyName\").val(\"\");\n    $(\"#txtTridentValue\").text(\"\");\n\n    // if already plotted, destroy old plot before replotting\n    if (sbv.plot1) {\n        sbv.plot1.destroy();\n    }\n\n    // clear array of [key,sizes]\n    sbv.arrayLS = [];\n\n    // repopulate the listbox while simulatenously building the arrayLS data for plot\n    $(\"#selTridentDB\").html(\"\");\n\n    //var totalSize = 0;\n    sbv.totalSize = 0;\n\n    // The TridentAPI GetAllKeys doesn't return value so we need\n    // need extra call to GetKeyById so we can calculate size \n    sandbox.db.getAllKeys(function(result) {\n        sbv.loopCounter = result.length;\n\n        for (var idx = 0; idx < result.length; idx++) {\n            sandbox.db.getAppKeyById(result[idx].id, function (result) {\n                //$(\"#txtKey\").val(result.key);\n                //$(\"#txtVal\").val(result.val);\n                var currObject = result;\n\n                $('#selTridentDB').append($('<option>', {\n                    value: currObject.id,\n                    text: currObject.app + \";\" + currObject.key\n                }));          \n\n                var keySize = currObject.val.length + currObject.app.length + currObject.key.length;\n                sbv.totalSize += keySize;\n\n                sbv.arrayLS.push([currObject.key.slice(0,20), keySize]);\n\n                if (--sbv.loopCounter == 0) {\n                    $(\"#spnTotalSize\").text(sbv.totalSize + \" bytes\");\n\n                    if (sbv.arrayLS.length == 0) {\n                        alertify.log(\"no data\");\n                        return;\n                    }\n\n                    sbv.plot1 = jQuery.jqplot ('chart1', [sbv.arrayLS], \n                                               { \n                        seriesDefaults: {\n                            // Make this a pie chart.\n                            renderer: jQuery.jqplot.PieRenderer, \n                            rendererOptions: {\n                                // Put data labels on the pie slices.\n                                // By default, labels show the percentage of the slice.\n                                showDataLabels: true\n                            }\n                        }, \n                        legend: { show:false, location: 'e' },\n                        highlighter: {\n                            show: true,\n                            formatString:'%s', \n                            tooltipLocation:'sw', \n                            useAxesFormatters:false\n                        }\n                    });\t\n                }\n            });\n        }\n    });\n}\n\nfunction selChanged() {\n    var key = $(\"#selTridentDB option:selected\").val();\n\n    sandbox.db.getAppKeyById(parseInt(key), function (result) {\n        $(\"#hfKeyId\").text(result.id);\n\n        $(\"#txtAppName\").val(result.app);\n        $(\"#txtKeyName\").val(result.key);\n        $(\"#txtTridentValue\").val(result.val);\n        $(\"#spnKeySize\").text(\"Key Size : \" + (result.val.length + result.app.length + result.key.length) + \" bytes\");\n    });\n}\n\nfunction doDelete() {\n    var objId = $(\"#selTridentDB option:selected\").val();\n\n    if (objId == null) return;\n\n    // confirm object deletion\n    alertify.confirm(\"Are you sure you want to delete object with id \" + objId, function (e) {\n        if (e) {\n            // user clicked \"ok\"\n            sandbox.db.deleteAppKey(parseInt(objId));\n\n            setTimeout(function () { loadTridentDB(); }, 500);\n        }\n    });\n}\n\nfunction doAdd() {\n    $(\"#hfKeyId\").text(\"0\");\n    $(\"#txtAppName\").val(\"\");\n    $(\"#txtKeyName\").val(\"\");\n    $(\"#txtTridentValue\").text(\"\");\n}\n\nfunction doUpdate() {\n    var isAdd = ($(\"#hfKeyId\").text() == \"0\");\n\n    if (isAdd) {\n        var kn = $(\"#txtKeyName\").val();\n        var kv = $(\"#txtTridentValue\").text();\n        var app = $(\"#txtAppName\").val();\n        sandbox.db.setAppKey(app, kn, kv, function(result) {\n            loadTridentDB();\n        });\n\n        return;\n    }\n\n    var objId = $(\"#selTridentDB option:selected\").val();\n\n    if (objId == null) return;\n\n    // confirm object deletion\n    alertify.confirm(\"Are you sure you want to rename object with id \" + objId, function (e) {\n        if (e) {\n            // user clicked \"ok\"\n\n            sandbox.db.GetAppKeyById(parseInt(objId), function(result) {\n                var kn = $(\"#txtKeyName\").val();\n                var kv = $(\"#txtTridentValue\").text();\n                var app = $(\"#txtAppName\").val();\n\n                if (kn != result.key || app != result.app) {\n                    sandbox.db.DeleteAppKey(parseInt(objId), function(result) {\n                        sandbox.db.setAppKey(app, kn, kv, function(result) {\n                            loadTridentDB();\n                        });\n                    });\n                }\n                else {\n                    sandbox.db.SetAppKey(app, kn, kv, function(result) {\n                        loadTridentDB();\n                    });\n                }\n            });\n        }\n    });\n}\n\n\n"
}
{
  "progName": "Trident DB Usage",
  "htmlText": "<style>\nfieldset { \n\tpadding: 1em;\n    font:80%/1 sans-serif;\n\tborder:1px solid black; \n}\nlabel.lb4 {\n\tfloat:left;\n    width:15%;\n    margin-right:0.5em;\n    padding-top:0.2em;\n    text-align:right;\n    font-weight:bold;\n}\n\nlegend {\n    padding: 0.2em 0.5em;\n    border:1px solid black;\n    color:black;\n    font-size:90%;\n    text-align:right;\n}\n\n</style>\n\n<h3>Trident DB Usage</h3>\n\n<table>\n<tr>\n<td>\n\tTrident DB size total : <span id='spnTotalSize'></span>\n</td>\n<td>\n\t<span id='spnKeySize'></span> \n</td>\n</tr>\n<tr>\n<td valign='top'><div id=\"chart1\" style=\"width:320px\" ></div><br/></td>\n<td valign='top'>\n\t<br/>\n    <select id=\"selTridentDB\" size=12 onchange=\"selChanged()\" style=\"min-width:150px\"></select><br/>\n</td>\n</tr>\n</table>\n\n<fieldset>\n\t<legend>Trident Key Settings :</legend>\n    <input type='hidden' id='hfKeyId'/>\n    <input type='text' id='txtAppName' style='width:400px'/>\n    <label class=\"lb4\" for=\"txtAppName\">App Name : </label><br/><br/>\n\t<input type='text' id='txtKeyName' style='width:400px'/>\n\t<label class=\"lb4\" for=\"txtKeyName\">Key Name : </label><br/><br/>\n\t<textarea spellcheck='false' style=\"width:80%; height:160px;\" id='txtTridentValue'></textarea>\n    <label class=\"lb4\" for=\"txtTridentValue\">Key Value : </label><br/><br/>\n\t<span style=\"float:left; margin-left:120px\">\n    \t<button class=\"minimal\" onclick=\"doAdd();\"><i class=\"fa fa-plus-circle\"></i> New</button>\n\t\t<button class=\"minimal\" onclick=\"doUpdate();\"><i class=\"fa fa-save\"></i> Save</button>\n\t\t<button class=\"minimal\" onclick=\"doDelete();\"><i class=\"fa fa-trash-o\"></i> Delete</button>\n\t</span>\n</fieldset>\n\n",
  "scriptText": "var sbv = {\n\tarrayLS : [],\n    totalSize : 0,\n\tplot1 : null,\n    loopCounter: 0\n}\n\nsandbox.events.clean = function() {\n\tdelete sbv.arrayLS;\n\n\tif (sbv.plot1) {\n\t\tsbv.plot1.destroy();\n\t}\n\n\tdelete sbv.plot1;\n}\n\nif (!sandbox.db) {\n\talertify.log(\"This sample only works in a hosted or appcache environment\");\n}\nelse {\n\tloadTridentDB();\n}\n\nfunction loadTridentDB() {\n    \n\t$(\"#txtTridentValue\").val(\"\");\n\t$(\"#spnKeySize\").text(\"Key Size : \");\n    \n\t$(\"#hfKeyId\").text(\"0\");\n    $(\"#txtAppName\").val(\"\");\n    $(\"#txtKeyName\").val(\"\");\n    $(\"#txtTridentValue\").text(\"\");\n    \n\t// if already plotted, destroy old plot before replotting\n\tif (sbv.plot1) {\n\t\tsbv.plot1.destroy();\n\t}\n    \n    // clear array of [key,sizes]\n    sbv.arrayLS = [];\n\n\t// repopulate the listbox while simulatenously building the arrayLS data for plot\n\t$(\"#selTridentDB\").html(\"\");\n\t\n    //var totalSize = 0;\n    sbv.totalSize = 0;\n\n\t// The TridentAPI GetAllKeys doesn't return value so we need\n    // need extra call to GetKeyById so we can calculate size \n\tsandbox.db.GetAllKeys(function(result) {\n    \tsbv.loopCounter = result.length;\n    \n\t\tfor (var idx = 0; idx < result.length; idx++) {\n        \tVAR_TRIDENT_API.GetAppKeyById(result[idx].id, function (result) {\n                //$(\"#txtKey\").val(result.key);\n                //$(\"#txtVal\").val(result.val);\n          \t\tvar currObject = result;\n          \n\t\t\t\t$('#selTridentDB').append($('<option>', {\n\t    \t\t\tvalue: currObject.id,\n\t    \t\t\ttext: currObject.app + \";\" + currObject.key\n\t\t\t\t}));          \n          \n    \t      \tvar keySize = currObject.val.length + currObject.app.length + currObject.key.length;\n        \t    sbv.totalSize += keySize;\n            \n            \tsbv.arrayLS.push([currObject.key.slice(0,20), keySize]);\n                \n                if (--sbv.loopCounter == 0) {\n    \t\t        $(\"#spnTotalSize\").text(sbv.totalSize + \" bytes\");\n\n\t\t\t\t\tif (sbv.arrayLS.length == 0) {\n\t            \t\talertify.log(\"no data\");\n\t                \treturn;\n            \t\t}\n\n            \t\tsbv.plot1 = jQuery.jqplot ('chart1', [sbv.arrayLS], \n            \t\t{ \n            \t    \tseriesDefaults: {\n\t        \t            // Make this a pie chart.\n\t    \t                renderer: jQuery.jqplot.PieRenderer, \n\t\t                    rendererOptions: {\n    \t                    \t// Put data labels on the pie slices.\n        \t            \t    // By default, labels show the percentage of the slice.\n            \t    \t        showDataLabels: true\n            \t\t        }\n        \t        \t}, \n\t\t\t\t\t\tlegend: { show:false, location: 'e' },\n\t\t\t\t\t\thighlighter: {\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tformatString:'%s', \n\t\t\t\t\t\t\ttooltipLocation:'sw', \n\t\t\t\t\t\t\tuseAxesFormatters:false\n\t\t\t\t\t\t}\n\t            \t});\t\n                }\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction selChanged() {\n\tvar key = $(\"#selTridentDB option:selected\").val();\n\n\tsandbox.db.GetAppKeyById(parseInt(key), function (result) {\n\t\t$(\"#hfKeyId\").text(result.id);\n    \n    \t$(\"#txtAppName\").val(result.app);\n        $(\"#txtKeyName\").val(result.key);\n      \t$(\"#txtTridentValue\").val(result.val);\n      \t$(\"#spnKeySize\").text(\"Key Size : \" + (result.val.length + result.app.length + result.key.length) + \" bytes\");\n    });\n}\n\nfunction doDelete() {\n   \tvar objId = $(\"#selTridentDB option:selected\").val();\n\n\tif (objId == null) return;\n\n\t// confirm object deletion\n\talertify.confirm(\"Are you sure you want to delete object with id \" + objId, function (e) {\n\t\tif (e) {\n\t\t\t// user clicked \"ok\"\n\t\t\tsandbox.db.DeleteAppKey(parseInt(objId));\n\n\t\t\tsetTimeout(function () { loadTridentDB() }, 500);\n\t\t}\n\t});\n}\n\nfunction doAdd() {\n\t$(\"#hfKeyId\").text(\"0\");\n    $(\"#txtAppName\").val(\"\");\n    $(\"#txtKeyName\").val(\"\");\n    $(\"#txtTridentValue\").text(\"\");\n}\n\nfunction doUpdate() {\n\tvar isAdd = ($(\"#hfKeyId\").text() == \"0\");\n\n    if (isAdd) {\n\t\tvar kn = $(\"#txtKeyName\").val();\n\t\tvar kv = $(\"#txtTridentValue\").text();\n\t\tvar app = $(\"#txtAppName\").val();\n\t\tsandbox.db.SetAppKey(app, kn, kv, function(result) {\n\t\t\tloadTridentDB();\n\t\t});\n        \n        return;\n    }\n    \n   \tvar objId = $(\"#selTridentDB option:selected\").val();\n\n\tif (objId == null) return;\n\n\t// confirm object deletion\n\talertify.confirm(\"Are you sure you want to rename object with id \" + objId, function (e) {\n   \t\tif (e) {\n       \t\t// user clicked \"ok\"\n                \n            sandbox.db.GetAppKeyById(parseInt(objId), function(result) {\n\t\t\t\tvar kn = $(\"#txtKeyName\").val();\n\t\t\t\tvar kv = $(\"#txtTridentValue\").text();\n\t\t\t\tvar app = $(\"#txtAppName\").val();\n                    \n\t\t\t\tif (kn != result.key || app != result.app) {\n\t\t\t\t\tsandbox.db.DeleteAppKey(parseInt(objId), function(result) {\n\t\t\t\t\t\tVAR_TRIDENT_API.SetAppKey(app, kn, kv, function(result) {\n\t\t\t\t\t\t\tloadTridentDB();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsandbox.db.SetAppKey(app, kn, kv, function(result) {\n\t\t\t\t\t\tloadTridentDB();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\n\n"
}
{
  "progName": "CryptoJS Notepad",
  "htmlText": "<h3>Crypto.JS Notepad</h3>\n\n<table style='width:100%;background-color:#ddd'>\n\t<tr style='background-color:#ddd'>\n    \t<td style='padding:5px'>Note Name : <input type='text' id='txtNoteName' style='width:150px'></input>&nbsp;\n        \t<button id='btnSave' title='Save to Trident DB' onclick='saveNote()'><i class=\"fa fa-floppy-o\"></i></button>&nbsp;\n        \t<button title='New' onclick='newNote()'><i class=\"fa fa-file-o\"></i></button>&nbsp;\n            <button title='Export / Save Locally' onclick='exportNote()'><i class=\"fa fa-download\"></i></button>&nbsp;\n            <button title='Import / Load Local File' onclick='importNote()'><i class=\"fa fa-arrow-up\"></i></button>\n        </td>\n        <td>\n\t\t\t<div id='divDbActions' style='display:inline'>\n\t\t\t\tNotes List : <select id='selNotes' onchange='noteSelected()'></select>&nbsp;\n            \t<button title='Delete selected note from Trident DB' onclick='deleteNote()'><i class=\"fa fa-trash-o\"></i></button>\n\t\t\t</div>\n        </td>\n    </tr>\n</table>\n\n<textarea rows='15' cols='92' style=\"width:'640px'; height:'300px'\" id=\"area1\"></textarea>\n\n<div id='divPassword' style='display:none'>\n<i class=\"fa fa-key\"></i> Enter Password : \n<input id='txtDialogPassword'  onKeyDown=\"if (event.keyCode==13) sandboxVars.dlgOkButton.focus()\" type='password'></input>\n</div>\n\n<input type='hidden' id='hfPassword'></input>",
  "scriptText": "var sandboxVars = {\n\tarea1var : new nicEditor({fullPanel : true}).panelInstance('area1'),\n    dlgOkButton : null\n}\n$(\"#UI_TabsOutput\")\nfunction EVT_CleanSandbox() {\n\tdelete sandboxVars.area1var;\n}\n\nif (!window.indexedDB) {\n\t$(\"#btnSave\").hide();\n    $(\"#divDbActions\").hide();\n}\n\n//API_SetWindowMode(3);\nretrieveAllAppKeys();\n\nfunction newNote() {\n\t$(\"#hfPassword\").val(\"\");\n\n\tvar nicE = new nicEditors.findEditor('area1');\n\tvar htmlSceneText = nicE.setContent(\"\");\n\t$(\"#txtNoteName\").val(\"\");\n}\n\nfunction saveNote() {\n\t$(\"#txtDialogPassword\").val($(\"#hfPassword\").val());\n\tvar noteName = $(\"#txtNoteName\").val();\n\tif (noteName == \"\") {\n\t\talertify.alert(\"Please enter a note name\");\n\t\treturn;\n\t}\n\n\t$(\"#divPassword\").dialog({ \n    \ttitle: 'Password',\n    \topen: function() {\n      \t\tvar buttonPane = $(this).next();\n      \t\tbuttonPane.find('button:first').addClass('ui-state-default');\n\t\t\tsandboxVars.dlgOkButton = buttonPane.find('button:first');\n    \t},\n        buttons : {\n        \tOk : function() { \n\t\t\t\t// Can't just use jquery selector for txtDialogPassword\n                // since the jquery ui dialog mechanism clones it\n                // use this jquery selector to get the actual txt they\n                // just entered\n    \t\t\tvar pass = $(this).find(\"input\").val();\n                $(\"#hfPassword\").val(pass);\n\n\t\t\t\tif (pass.length < 6) {\n    \t\t\t\talertify.alert(\"Password must be at least six characters\");\n        \t\t\treturn;\n    \t\t\t}\n    \n\t\t\t\tvar nicE = new nicEditors.findEditor('area1');\n\t\t\t\tvar htmlEditText = nicE.getContent();\n\n\t\t\t\tvar encrypted = CryptoJS.AES.encrypt(htmlEditText, pass).toString();\n\n  \t\t\t\tAPI_SetIndexedAppKey('CryptoNotepad', noteName, encrypted);\n    \n    \t\t\tretrieveAllAppKeys();\n\n\t\t\t\t$(this).dialog( \"destroy\" );\n            },\n            \"Close\" : function() {\n            \t$(this).dialog( \"destroy\" );\n            }\n        }\n\n\t});\n}\n\nfunction deleteNote() {\n\talertify.confirm(\"Are you sure you want to delete the selected note?\", function (e) {\n    \t\tif (e) {\n        \t\t// user clicked \"ok\"\n                $(\"#hfPassword\").val(\"\");\n                \n   \t\t\t\tvar objId = $(\"#selNotes option:selected\").val();\n              \tAPI_DelIndexedAppKey(parseInt(objId));\n                \n    \t\t\tretrieveAllAppKeys();\n                \n                $(\"#txtNoteName\").val(\"\");\n                \n\t\t\t\tvar nicE = new nicEditors.findEditor('area1');\n\t\t\t\tnicE.setContent(\"\");\n    \t\t} \n\t});\n\t\n}\n\n// When user changes dropdown selection, get the whole object and update text fields\nfunction noteSelected() {\n    $(\"#txtDialogPassword\").val(\"\");\n    $(\"#hfPassword\").val(\"\");\n    \n\t$(\"#divPassword\").dialog({ \n    \topen: function() {\n      \t\tvar buttonPane = $(this).next();\n      \t\tbuttonPane.find('button:first').addClass('ui-state-default');\n\t\t\tsandboxVars.dlgOkButton = buttonPane.find('button:first');\n    \t},\n    \ttitle: 'Password',\n        buttons : {\n        \tOk : function() { \n\t\t\t\tvar objId = $(\"#selNotes option:selected\").val();\n\n\t\t\t\t// Can't just use jquery selector for txtDialogPassword\n                // since the jquery ui dialog mechanism clones it\n                // use this jquery selector to get the actual txt they\n                // just entered\n    \t\t\tvar pass = $(this).find(\"input\").val();\n                $(\"#hfPassword\").val(pass);\n                \n  \t\t\t\tAPI_GetIndexedAppKeyById(parseInt(objId), function(e) {\n\t\t\t\t\tvar res = e.target.result;\n      \t\t\t\t$(\"#txtNoteName\").val(res.key);\n        \t\t\tvar encNote = res.val;\n\t\t\t\t\tvar decrypted = CryptoJS.AES.decrypt(encNote, pass);\n\n\t\t\t\t\tvar nicE = new nicEditors.findEditor('area1');\n\t\t\t\t\tvar htmlSceneText = nicE.setContent(decrypted.toString(CryptoJS.enc.Utf8));\n    \t\t\t});\n                \n\t\t\t\t$(this).dialog( \"destroy\" );\n\t\t\t},\n            Cancel : function() {\n\t\t\t\t$(this).dialog( \"destroy\" );\n            }\n        }\n\t});\n}\n\n// Show all Trident App/Key/Val objects filtered by our app name ('CryptoNotepad') \n// We call API_GetIndexedAppCursor passing our app name and callback\n// Our callback is called for every object and we must manually advance the cursor.\nfunction retrieveAllAppKeys()\n{\n\tif (!window.indexedDB) return;\n    \n    $(\"#selNotes\").html(\"<option></option>\");\n  \n  \t// The anonymous function callback is called once per row returned \n\tAPI_GetIndexedAppCursor('CryptoNotepad', function(e) {\n\t  \tvar cursor = e.target.result;\n      \n\t\tif(cursor) {\n          \tvar currObject = cursor.value;\n          \n\t\t\t$('#selNotes').append($('<option>', {\n    \t\t\tvalue: currObject.id,\n    \t\t\ttext: currObject.key\n\t\t\t}));          \n          \n            cursor.continue();\n\t\t}\n\t});\n}\n\n//\n// IMPORT EXPORT FUNCTIONS\n//\n\nfunction exportNote() {\n\t$(\"#txtDialogPassword\").val($(\"#hfPassword\").val());\n\n\t$(\"#divPassword\").dialog({ \n    \ttitle: 'Password',\n    \topen: function() {\n      \t\tvar buttonPane = $(this).next();\n      \t\tbuttonPane.find('button:first').addClass('ui-state-default');\n\t\t\tsandboxVars.dlgOkButton = buttonPane.find('button:first');\n    \t},\n        buttons : {\n        \tOk : function() { \n\t\t\t\t// Can't just use jquery selector for txtDialogPassword\n                // since the jquery ui dialog mechanism clones it\n                // use this jquery selector to get the actual txt they\n                // just entered\n    \t\t\tvar pass = $(this).find(\"input\").val();\n    \t\t\tif (pass.length < 6) {\n    \t\t\t\talertify.alert(\"Password must be at least six characters\");\n        \t\t\treturn;\n    \t\t\t}\n    \n    \t\t\tvar noteName = $(\"#txtNoteName\").val();\n    \t\t\tif (noteName == \"\") {\n\t\t\t\t\talertify.alert(\"Please enter a note name\");\n        \t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar nicE = new nicEditors.findEditor('area1');\n\t\t\t\tvar htmlEditText = nicE.getContent();\n\n\t\t\t\tvar encrypted = CryptoJS.AES.encrypt(htmlEditText, pass).toString();\n\n    \t\t\tAPI_SaveTextFile(noteName + '.cnp', encrypted)\t\n\n    \n    \t\t\tretrieveAllAppKeys();\n                \n\t\t\t\t$(this).dialog( \"destroy\" );\n\t\t\t},\n            Cancel : function() {\n\t\t\t\t$(this).dialog( \"destroy\" );\n            }\n\t\t}\n\t});\n}\n\nfunction importNote() {\n\tAPI_ShowLoad();\n}\n\nfunction EVT_UserLoadCallback(filestring, filename) {\n\tAPI_HideUserLoader();\n    \n    $(\"#txtNoteName\").val(filename.replace(\".cnp\", \"\"));\n    \n\t$(\"#txtDialogPassword\").val($(\"#hfPassword\").val());\n\n\t$(\"#divPassword\").dialog({ \n    \ttitle: 'Password',\n    \topen: function() {\n      \t\tvar buttonPane = $(this).next();\n      \t\tbuttonPane.find('button:first').addClass('ui-state-default');\n\t\t\tsandboxVars.dlgOkButton = buttonPane.find('button:first');\n    \t},\n        buttons : {\n        \tOk : function() { \n\t\t\t\t// Can't just use jquery selector for txtDialogPassword\n                // since the jquery ui dialog mechanism clones it\n                // use this jquery selector to get the actual txt they\n                // just entered\n    \t\t\tvar pass = $(this).find(\"input\").val();\n                \n\t\t\t\tvar encNote = filestring;\n\t\t\t\tvar decrypted = CryptoJS.AES.decrypt(encNote, pass);\n\n\t\t\t\tvar nicE = new nicEditors.findEditor('area1');\n\t\t\t\tvar htmlSceneText = nicE.setContent(decrypted.toString(CryptoJS.enc.Utf8));\n\n\t\t\t\t$(this).dialog( \"destroy\" );\n\t\t\t},\n            Cancel : function() {\n\t\t\t\t$(this).dialog( \"destroy\" );\n            }\n\t\t}\n\t});\n}\n\n"
}
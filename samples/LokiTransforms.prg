{
  "progName": "LokiTransforms",
  "htmlText": "<h3>Loki Transforms Sample</h3>\n\n<span><i>Sample names to search for include 'odin', 'thor', and 'Svafrlami'</i></span>\n<br/><br/>\n\n<label>Name Filter: </label><br/>\n<input id=\"txtFilter\" type=\"text\"/>\n<button onclick=\"doFilter();\">\n    Run Transform\n</button>",
  "scriptText": "sandbox.events.clean = function() {\n    if (db) db.close();\n};\n\n// We use use custom adapter that saves into our Trident Database\nvar ia = new LokiTridentAdapter(\"LokiTransformsSample\", sandbox.db);\n\n// otherwise native loki adapter use is as below (both written by me)\n//var ia = new LokiIndexedAdapter(\"LokiTransformsSample\");\n\nvar db = new loki(\"LokiTransformsDB\", { \n    adapter: ia,\n    autosave: true, // not really relevant here since we dont update data\n    autosaveInterval: 5000,\n    autoload: true,\n    autoloadCallback: function() {\n        var coll = db.getCollection(\"ItemsCollection\");\n        \n        // The first time this is run, the database will be blank so initialize it here\n        if (coll === null) {\n            coll = db.addCollection(\"ItemsCollection\");\n            coll.insert({ name : 'mjolnir', owner: 'thor', maker: 'dwarves' });\n            coll.insert({ name : 'gungnir', owner: 'odin', maker: 'elves' });\n            coll.insert({ name : 'tyrfing', owner: 'Svafrlami', maker: 'dwarves' });\n            coll.insert({ name : 'draupnir', owner: 'odin', maker: 'elves' });\n            \n            var tx = [\n                {\n                    type: 'find',\n                    value: {\n                        owner: '[%lktxp]OwnerName'\n                    }\n                }\n            ];\n            \n            coll.addTransform(\"OwnerLookup\", tx);\n        }\n    }\n});\n\nfunction doFilter() {\n    var filter = $(\"#txtFilter\").val();\n    \n    var result = db.getCollection(\"ItemsCollection\").chain(\"OwnerLookup\", { OwnerName: filter }).data();\n    \n    sandbox.logger.inspect(result);\n}\n"
}
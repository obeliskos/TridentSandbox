{
  "progName": "Hosted Files Database",
  "htmlText": "<style> /* Simple styles for the file drop target */\n    #droptarget { border: solid black 2px; width: 200px; height: 200px; }\n    #droptarget.active { border: solid red 4px; }\n</style>\n\n<ul class=\"tnavlist\">\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(1);\" href=\"javascript:void(0)\"><i class=\"fa fa-home\"></i> Home</a></li>\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(2);\" href=\"javascript:void(0)\"><i class=\"fa fa-info-circle\"></i> About</a></li>\n</ul>\n\n<div id=\"divMain\">\n    <h3>Hosted File Database</h3>\n    <table width='100%'>\n        <tr>\n            <td valign='top'>\n                <label>Pick file(s) :</label><br/>\n                <input style='height:30px;width:200px;' id='customFile' type=\"file\" name=\"customFile\" onchange=\"custom_load()\" multiple />\n                <br/><br/>-or-<br/><br/>\n                <div id=\"droptarget\">Drop file(s) here</div>\n            </td>\n            <td valign='top'>\n                <label style='display:inline-block; width:120px'>Action :</label>\n                <input class=\"vpatel\" type=\"radio\" id=\"radio1\" name=\"radios\" value=\"all\" checked onclick=\"modeImport()\">\n                <label for=\"radio1\">Import into TridentDB</label>\n                <input class=\"vpatel\" type=\"radio\" id=\"radio2\" name=\"radios\"value=\"false\" onclick=\"modeGenerate()\">\n                <label for=\"radio2\">Generate DataURI</label>\n                <br/><br/>\n                <fieldset id=\"fieldset-import\" style=\"padding:10px\">\n                    <legend style=\"color:#888\">\n                        Import into TridentDB\n                    </legend>\n                    Files stored in the TridentDB with app name of 'TridentFiles' : <br/>\n                    <select size=14 id=\"selFiles\" style=\"width:600px\"></select><br/><br/>\n                    <button class=\"minimal\" onclick=\"deleteFile()\">Delete</button> \n                    <button class=\"minimal\" onclick=\"downloadFile()\">Download</button> \n                </fieldset>\n                <fieldset id=\"fieldset-generate\" style=\"display:none; padding:10px\">\n                    <legend style=\"color:#888\">\n                        Generate DataURI\n                    </legend>\n                    Data URI of single (or first) file picked or dropped :\n                    <br/><br/>\n                    <textarea id=\"txt-datauri\" type=\"text\" rows=15 cols=80/>\n                    <br/>\n                    <label>DataURI string length : </label>\n                    <label id=\"lbl-datauri-length\">0</label>\n                </fieldset>\n            </td>\n        </tr>\n    </table>\n\n</div>\n\n<div id=\"divAbout\" style=\"display:none\">\n    <h3>\n        About Hosted Files Database\n    </h3>\n\n    <p>\n        This Utility allows you to 'upload' files into the TridentDB.&nbsp;  Your files are not \n        going to any server, they are being stored into the TridentDB which is an indexedDB \n        database stored in your browser's sandbox storage.&nbsp;  You have a limited amount of \n        this sandboxed storage.&nbsp;  For Internet Explorer 10/11 it is probably about 120megs.&nbsp;  \n        To monitor the amount of storage used, you can use the 'Storage Summary' function \n        of Trident Sandbox to guage how much sandbox storage space you have used/left.\n    </p>\n\n    <p>\n        You can use this utility to store whatever files you want, but it is intended for \n        storing images or other media within your websites.&nbsp; The files are stored as \n        DataUrls (base64 encoded with mime type header) and you can use these dataurls in \n        place of an internet url.&nbsp; It's like a hyperlink to hardcoded/embedded/inline file. \n        For example you can retrieve a file from the trident db \n        as a data url string and set the 'src' property of an IMG tag to that string and it \n        will display the image.&nbsp; The same could apply to an html 5 video or audio tag \n        with mp3's or AVIs.&nbsp; This allows hosted/appcached environments to add media to their \n        pages.\n    </p>\n    <p>\n        <a class=\"TridentLinkSmall\" href=\"http://www.html5rocks.com/en/tutorials/workers/basics/\" target=\"_blank\">Web Workers</a> should support DataUrls but i have yet to test this.&nbsp; \n        If so, you might also store web worker script as datauri to run in hosted environments and \n        message back and forth.&nbsp;  \n    </p>\n</div>",
  "scriptText": "// This program lets you import files from your local filesystem into the \n// TridentDB (for hosted/appcached environments only). We are storing them  \n// with an app name of 'TridentFiles' and for the key we use the filename\n// We can then get these files (as a dataurl) and use them within any of our programs.\n// DataURL is base64 encoded which adds overhead, so monitor consumption within\n// the 'Storage Summary' feature of Trident Sandbox.\n// This is intended mainly for images but the dataurl adds the mime type into the \n// encoding so you can determine exactly what type of file it contains by either\n// the filename (key) or the dataurl itself (starting bytes of val)\n\nfunction showDiv(divId) {\n    $(\"#divMain\").hide();\n    $(\"#divAbout\").hide();\n\n    switch (divId) {\n        case 1 : $(\"#divMain\").show(); break;\n        case 2 : $(\"#divAbout\").show(); break;\n    }\n}\n\nfunction modeImport() {\n    $(\"#fieldset-generate\").hide();\n    $(\"#fieldset-import\").show();\n}\n\nfunction modeGenerate() {\n    $(\"#fieldset-import\").hide();\n    $(\"#fieldset-generate\").show();\n}\n\nfunction custom_load()\n{\n    var pickedFiles = $(\"#customFile\")[0].files;\n\n    for(i=0; i<pickedFiles.length; i++) {\n        var pfile = pickedFiles[i];//document.getElementById('customFile').files[0];\n\n        var reader = new FileReader();\n        reader.onload = (function(loadedFile) {\n            var loadedName = loadedFile.name;\n            return function(evt) {\n                if (document.getElementById(\"radio1\").checked) {\n                    sandbox.db.setAppKey(\"TridentFiles\", loadedName, evt.target.result);\n\n                    setTimeout(function () { retrieveAllHostedFiles(); }, 1000);\n                }\n                else {\n                    $(\"#lbl-datauri-length\").text(evt.target.result.length);\n                    $(\"#txt-datauri\").text(evt.target.result);\n                    $(\"#txt-datauri\").select();\n                }\n            };\n        })(pfile);\n\n        reader.onerror = function(evt) {\n            alertify.error(\"error\");\n        };\n\n        reader.readAsDataURL(pfile, \"UTF-8\");\n\n    }\n}\n\nfunction retrieveAllHostedFiles()\n{\n    $(\"#selFiles\").html(\"\");\n\n    sandbox.db.getAppKeys(\"TridentFiles\", function(result) {\n        for (var idx = 0; idx < result.length; idx++) {\n            var currObject = result[idx];\n\n            $('#selFiles').append($('<option>', {\n                value: currObject.id,\n                text: currObject.key\n            }));          \n        }\n    });\n}\n\nfunction deleteFile() {\n    var filename = $(\"#selFiles option:selected\").text();\n    var fileId = $(\"#selFiles option:selected\").val();\n\n    // confirm object deletion\n    alertify.confirm(\"Are you sure you want to delete \" + filename, function (e) {\n        if (e) {\n            // user clicked \"ok\"\n            sandbox.db.deleteAppKey(parseInt(fileId), function(result) {\n                if (result) {\n                    setTimeout(function () { retrieveAllHostedFiles(); }, 250);\n\n                }\n                else {\n                    alertify.log(\"Error deleting file unit\");\n                }\n            });\n        }\n    });\n}\n\nfunction downloadFile() {\n    var objId = $(\"#selFiles option:selected\").val();\n\n    // user clicked \"ok\"\n\n    sandbox.db.getAppKeyById(parseInt(objId), function (result) {\n        if(result == null || result.id === 0) {\n            alertify.error(\"GetAppKeyById returned nothing\");\n            return;\n        }\n\n        var fileName = result.key.replace(\"TridentFiles;\", \"\");\n        var dataURL = result.val;\n        sandbox.files.saveDataURL(fileName, dataURL);\n\n    });\n\n}\n\nfunction initDropTarget() {\n    // Find the element we want to add handlers to.\n    var droptarget = document.getElementById(\"droptarget\");\n\n    // When the user starts dragging files over the droptarget, highlight it.\n    droptarget.ondragenter = function(e) {\n        // If the drag is something other than files, ignore it.\n        // The HTML5 dropzone attribute will simplify this when implemented.\n        var types = e.dataTransfer.types;\n        if (!types ||\n            (types.contains && types.contains(\"Files\")) ||\n            (types.indexOf && types.indexOf(\"Files\") != -1)) {\n            droptarget.classList.add(\"active\"); // Highlight droptarget\n            return false;                       // We're interested in the drag\n        }\n    };\n    // Unhighlight the drop zone if the user moves out of it\n    droptarget.ondragleave = function() {\n        droptarget.classList.remove(\"active\");\n    };\n\n    // This handler just tells the browser to keep sending notifications\n    droptarget.ondragover = function(e) { return false; };\n\n    // When the user drops files on us, get their URLs and display thumbnails.\n    droptarget.ondrop = function(e) {\n        var files = e.dataTransfer.files;            // The dropped files\n        for(var i = 0; i < files.length; i++) {      // Loop through them all\n            var f = files[i];\n            var reader = new FileReader();\n            reader.onload = (function(thefile) {\n                return function(e) {\n                    if (document.getElementById(\"radio1\").checked) {\n                        sandbox.db.setAppKey(\"TridentFiles\", thefile.name, e.target.result);\n\n                        setTimeout(function () { retrieveAllHostedFiles(); }, 1000);\n                    }\n                    else {\n                        $(\"#lbl-datauri-length\").text(e.target.result.length);\n                        $(\"#txt-datauri\").text(e.target.result);\n                        $(\"#txt-datauri\").select();\n                    }\n                };\n            })(f);\n            reader.readAsDataURL(f);\n        }\n\n        droptarget.classList.remove(\"active\");       // Unhighlight droptarget\n        return false;                                // We've handled the drop\n    };\n}\n\ninitDropTarget();\nretrieveAllHostedFiles();\n\n// Here is how you might retrieve and use an image uploaded by the above method \n\n//sandbox.db.getAppKey(\"TridentFiles\", \"myimage.jpg\", function(result) {\n//\tvar img = new Image;\n//\timg.src = result.val;\t// e.target.result is trident db obj\n//\tdocument.getElementById('UI_MainPlaceholder').appendChild(img);     \n//});\n\n"
}
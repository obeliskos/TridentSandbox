{
  "progName": "Antikythera",
  "htmlText": "<style>\n    select.unitlist  {\n        width:100%;\n        font-size:20px;\n    }\n\n    fieldset { \n        padding: 1em;\n        font:80%/1 sans-serif;\n        border:1px solid black; \n    }\n    label.lb4 {\n        float:left;\n        width:25%;\n        margin-right:0.5em;\n        padding-top:0.2em;\n        text-align:right;\n        font-weight:bold;\n    }\n\n    legend {\n        padding: 0.2em 0.5em;\n        border:1px solid black;\n        color:black;\n        font-size:90%;\n        text-align:right;\n    }\n\n</style>\n\n<ul class=\"tnavlist\">\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(1);\" href=\"javascript:void(0)\"><i class=\"fa fa-list-ol\"></i> Summary</a></li>\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(2);\" href=\"javascript:void(0)\"><i class=\"fa fa-gear\"></i> Set Dates</a></li>\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(3);\" href=\"javascript:void(0)\"><i class=\"fa fa-info-circle\"></i> About</a></li>\n</ul>\n\n<div id=\"divSummary\">\n    <h3>Antikythera : TaskList Summary</h3>\n\n    <table>\n        <tr>\n            <td>\n                <div id=\"divTiles\"></div>\n            </td>\n        </tr>\n        <tr>\n            <td style=\"padding-top:10px\">\n                <input class=\"vpatel\" type=\"radio\" id=\"radio1\" name=\"radios\" value=\"all\" onclick=\"refreshTasks('Two Month')\" checked='checked'>\n                <label for=\"radio1\">Two Month &plusmn;</label>\n                <input class=\"vpatel\" type=\"radio\" id=\"radio3\" name=\"radios\" value=\"true\" onclick=\"refreshTasks('Upcoming')\">\n                <label for=\"radio3\">Upcoming</label>\n                <input class=\"vpatel\" type=\"radio\" id=\"radio4\" name=\"radios\" value=\"true\" onclick=\"refreshTasks('Previous')\">\n                <label for=\"radio4\">Previous</label>\n\n                <ul id=\"taskListView\" class=\"tlist\"></ul><br/>\n\n                <button class=\"minimal\" onclick=\"refreshTasks()\">Refresh</button>\n            </td>\n        </tr>\n    </table>\n\n</div>\n\n<div id=\"divConfig\" style=\"display:none\">\n    <h3>Configure Dates</h3>\n    <ul id=\"editListView\" class=\"tlist\"></ul><br/>\n    <button class=\"minimal\" onclick=\"addTask()\"><i class=\"fa fa-plus\"></i> Add</button>&nbsp;\n    <button class=\"minimal\" onclick=\"editTask()\"><i class=\"fa fa-pencil-square-o\"></i> Edit</button>&nbsp;\n    <button class=\"minimal\" onclick=\"deleteTask()\"><i class=\"fa fa-trash-o\"></i> Delete</button>&nbsp;\n    <br/><br/>\n    <div id=\"divTaskEdit\" style=\"display:none\">\n        <fieldset>\n            <legend>Task Settings :</legend>\n            <input id=\"hfTaskId\" type=\"hidden\" />\n            <label class=\"lb4\" for=\"txtTaskDate\">Task Date :</label>\n            <input id=\"txtTaskDate\" style=\"width:240px\"/>\n            <label style=\"padding-left:30px\" for=\"chkTaskDone\">Task Complete : </label>\n            <input id=\"chkTaskDone\" type=\"checkbox\"/><br/><br/>\n            <label class=\"lb4\" for=\"txtTaskName\">Task Name : </label>\n            <input id=\"txtTaskName\" style=\"width:240px\"/><br/><br/>\n            <label class=\"lb4\" for=\"txtTaskDescription\">Task Description : </label>\n            <textarea id=\"txtTaskDescription\" spellcheck='false' style=\"width:65%; height:80px;\"></textarea><br/><br/>\n            <label class=\"lb4\" for=\"txtRecurInterval\">Repeat Every :</label>\n            <input id=\"txtRecurInterval\" style=\"width:50px\"/>\n            <select id=\"selRecurPattern\">\n                <option value=\"0\">None</option>\n                <option value=\"1\">Days</option>\n                <option value=\"2\">Weeks</option>\n                <option value=\"3\">Months</option>\n                <option value=\"4\">Years</option>\n            </select>\n            <label>,&nbsp; until : </label>\n            <input id=\"txtRecurUntil\" style=\"width:100px\"/>\n            <label>&nbsp; (leave blank for indefinite)</label>\n\n            <br/><br/> <br/>   \n            <span style=\"float:right; margin-right:100px\">\n                <button class=\"minimal\" onclick=\"saveTask()\"><i class=\"fa fa-save\"></i> Save</button>\n                <button class=\"minimal\" onclick=\"$('#divTaskEdit').hide();\"><i class=\"fa fa-ban\"></i> Cancel</button>\n            </span>\n        </fieldset>\n    </div>\n\n</div>\n\n<div id=\"divAbout\" style=\"display:none\">\n    <h3>About Antikythera</h3>\n\n    <p>Antikythera is a 'Days Since / Days Until' program which allows you to enter tasks to be reminded of.&nbsp; The program \n        will synchronize them and report on how long ago or soon they will occur in the future.\n    </p>\n    <p>\n        The Summary Page consists of a Metro.JS Live Tile view as well as a Trident list for viewing raw data on projections.\n        The live tiles show future tasks up to a year and past tasks up to a month.  For any given \n        recurring task, only the next (future) occurence is shown.  Tasks designated as 'done' do not appear.\n    </p>\n</div>",
  "scriptText": "var sbv = {\n    db: new loki('Tasks'),\n    taskList: null,\n\n    taskLV: null,\n    editLV: null,\n\n    RecurModeEnum:  Object.freeze({\"None\":0, \"Days\":1, \"Weeks\":2, \"Months\":3, \"Years\":4 })\n\n};\n\nsandbox.events.clean = function() {\n    $(\".live-tile, .flip-list\").not(\".exclude\").liveTile('stop');\n    delete sbv.taskList;\n    delete sbv.db;\n    delete sbv.taskLV;\n    delete sbv.RecurModeEnum;\n};\n\nfunction showDiv(divIndex) {\n    $(\"#divSummary\").hide();\n    $(\"#divConfig\").hide();\n    $(\"#divAbout\").hide();\n\n    switch(divIndex) {\n        case 1: $(\"#divSummary\").show(); break;\n        case 2: $(\"#divConfig\").show(); break;\n        case 3: $(\"#divAbout\").show(); break;\n    }\n}\n\nfunction dbInit() {\n\n    sbv.taskLV = new TridentList(\"taskListView\", taskSelected);\n    sbv.taskLV.makeBright();\n\n    sbv.editLV = new TridentList(\"editListView\", taskSelected);\n    sbv.editLV.makeBright();\n\n    sbv.taskList = sbv.db.addCollection('tasks');\n\n    if (sandbox.db) {\n\n        sandbox.db.getAppKey('Antikythera', 'TaskList', function(result) {\n            if (result == null || result.id === 0) return;\n\n            sbv.db.loadJSON(result.val);\n\n            // we rehydrated loki db object and collections but old collection references still\n            // point to old db object. \n            sbv.taskList = sbv.db.getCollection(\"tasks\");\n\n            refreshTasks('Two Month');\n        });\n    }\n    else {\n        alertify.log(\"Trident Database is not available.\");\n    }\n\n\n}\n\nfunction dbSave() {\n    if(sandbox.db) {\n        sandbox.db.setAppKey('Antikythera', 'TaskList', JSON.stringify(sbv.db), function(result) {\n            if (result) alertify.log('Antikythera database saved to Trident Database');\n            else alertify.error('Unable to save record');\n        });\n    }\n    else {\n        alertify.log(\"Trident Database is not available.\");\n    }\n}\n\nfunction taskSelected(sender, key) {\n    $('#divTaskEdit').hide();    \n}\n\nfunction getTasks() {\n    var arrCopy = sbv.taskList.data.slice(0);\n\n    var sorted = arrCopy.sort(function (x, y) { \n        if (moment(x.taskDate) < moment(y.taskDate)) return 1;\n        if (moment(x.taskDate) > moment(y.taskDate)) return -1;\n        return 0;\n    });\n\n    return sorted;\n}\n\nfunction sortTasks(mode) {\n    // clone array so sorting occurs in copy\n    var arrCopy = sbv.taskList.data.slice(0);\n\n    if (mode == 'Upcoming') {\n        //arrCopy = arrCopy.filter(function(x) { return (moment(x.taskDate) >= moment().startOf('day')) });\n        arrCopy = projectTasks(moment().startOf('day'), moment().add('years', 1));\n\n        var sorted = arrCopy.sort(function (x, y) { \n            if (moment(x.taskDate) > moment(y.taskDate)) return 1;\n            if (moment(x.taskDate) < moment(y.taskDate)) return -1;\n            return 0;\n        });\n\n        return sorted;\n    }\n\n    if (mode == 'Two Month') {\n        arrCopy = projectTasks(null, null);\n\n        var sorted = arrCopy.sort(function (x, y) { \n            if (moment(x.taskDate) < moment(y.taskDate)) return 1;\n            if (moment(x.taskDate) > moment(y.taskDate)) return -1;\n            return 0;\n        });\n\n        return sorted;\n    }\n\n    if (mode == 'Tiles') {\n        var start = moment().startOf('day').subtract('month', 1);\n        var end = moment().startOf('day').add('years', 1);\n        arrCopy = projectTasks(start, end, true);\n\n        var sorted = arrCopy.sort(function (x, y) { \n            if (moment(x.taskDate) < moment(y.taskDate)) return 1;\n            if (moment(x.taskDate) > moment(y.taskDate)) return -1;\n            return 0;\n        });\n\n        return sorted;\n    }\n\n    if (mode == 'All') {\n        var sorted = arrCopy.sort(function (x, y) { \n            if (moment(x.taskDate) < moment(y.taskDate)) return 1;\n            if (moment(x.taskDate) > moment(y.taskDate)) return -1;\n            return 0;\n        });\n\n        return sorted;\n    }\n\n    if (mode == 'Previous') {\n        arrCopy = arrCopy.filter(function(x) { return (moment(x.taskDate) < moment()); });\n\n        var sorted = arrCopy.sort(function (x, y) { \n            if (moment(x.taskDate) < moment(y.taskDate)) return 1;\n            if (moment(x.taskDate) > moment(y.taskDate)) return -1;\n            return 0;\n        });\n\n        return sorted;\n    }\n\n}\n\nfunction copyTask(task) {\n    var copy = { \n        taskName: task.taskName, \n        taskDesc: task.taskDesc, \n        taskDate: Date.parse(taskDate),\n        taskDone: taskDone,\n        recurPattern: recurPattern, \n        recurInterval: recurInterval,\n        recurUntil: recurUntil,\n        category: null,\n        color: null,\n        priority: null\n    };\n}\n\nfunction projectTasks(startDate, endDate, firstOccurrenceOnly) \n{\n    var arrCopy = sbv.taskList.data.slice(0);\n    arrCopy = arrCopy.filter(function(x) { return (!x.taskDone); });\n\n    var result = [];\n\n    firstOccurrenceOnly = (typeof firstOccurrenceOnly == 'undefined' ? false : firstOccurrenceOnly);\n\n    if (startDate == null) startDate = moment().startOf('day').subtract('months', 2);\n    if (endDate == null) endDate = moment().startOf('day').add('months', 2);\n\n    // for each recurring task, project\n    for(idx=0; idx < arrCopy.length; idx++) {\n        var task = arrCopy[idx];\n\n        if (task.recurPattern === 0) {\n            if (moment(task.taskDate) >= startDate && moment(task.taskDate) <= endDate) result.push(task);\n        }\n        else {\n            var arrDates = [ ];\n            var fif = false;  // first occurrence found flag\n\n            var runDate = moment(task.taskDate);\n            while (runDate <= endDate && !fif) {\n                if (runDate > startDate) {\n                    var newTask = jQuery.extend({}, task); // Shallow copy\n                    newTask.taskDate = runDate;\n                    newTask.nonPersistent = (runDate > moment(task.taskDate));\t// 'projected' designation\n\n                    if (firstOccurrenceOnly && (runDate > moment())) fif = true; \n\n                    result.push(newTask);\n                }\n\n                // Progress date\n                switch (task.recurPattern) {\n                    case 0 : runDate = endDate; break; // bad task has no interval so terminate\n                    case 1 : runDate = moment(runDate).add('days', task.recurInterval).toDate(); break; // days\n                    case 2 : runDate = moment(runDate).add('weeks', task.recurInterval).toDate(); break; // weeks\n                    case 3 : runDate = moment(runDate).add('months', task.recurInterval).toDate(); break; // months\n                    case 4 : runDate = moment(runDate).add('years', task.recurInterval).toDate(); break; // years\n                }\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction generateTiles(tasks) {\n    $(\".live-tile, .flip-list\").not(\".exclude\").liveTile('stop');\n    $(\"#divTiles\").empty();\n\n    for(idx=0; idx < tasks.length; idx++) {\n        var delay = Math.floor(Math.random() * 400) + 4800;\n\n        var color = \"red\";\n        switch ((idx+1)%4) {\n            case 0 : color = \"red\"; break;\n            case 1 : color = \"green\"; break;\n            case 2 : color = \"blue\"; break;\n            case 3 : color = \"mango\"; break;\n            case 4 : break;\n        }\n\n        var listitemDiv = document.createElement(\"div\");\n        listitemDiv.className = color + \" live-tile\";\n        $(listitemDiv).attr(\"data-mode\", \"carousel\"); // flip, carousel, flip-list\n        $(listitemDiv).attr(\"data-delay\", delay.toString());\n\n        var t1 = document.createElement(\"div\");\n\n        var numberDiv = document.createElement(\"div\");\n        $(numberDiv).css(\"height\", \"110px\");\n        $(numberDiv).css(\"line-height\", \"110px\");\n        $(numberDiv).css(\"text-align\", \"center\");\n        $(numberDiv).css(\"font-size\", \"64px\");\n        var delta = moment(tasks[idx].taskDate).diff(moment().startOf('day'), 'days');\n        $(numberDiv).text(delta);\n        var pos = (parseInt(delta) >= 0);\n\n        var descSpan = document.createElement(\"span\");\n        descSpan.className = \"tile-title\";\n        var desc = (pos?\"Days Until\":\"Days Since\") + \"<br/><br/><b>\" + tasks[idx].taskName + \"</b>\";\n        $(descSpan).html(desc);\n\n        t1.appendChild(numberDiv);\n        t1.appendChild(descSpan);\n        listitemDiv.appendChild(t1);\n\n        var t2 = document.createElement(\"div\");\n\n        var numberDiv2 = document.createElement(\"div\");\n        $(numberDiv2).css(\"height\", \"100px\");\n        $(numberDiv2).css(\"line-height\", \"100px\");\n        $(numberDiv2).css(\"text-align\", \"center\");\n        $(numberDiv2).css(\"font-size\", \"52px\");\n        $(numberDiv2).text(delta);\n\n        var descSpan2 = document.createElement(\"span\");\n        descSpan2.className = \"tile-title\";\n        var desc2 = (pos?\"Days Until\":\"Days Since\") + \"<br/><br/>\" + tasks[idx].taskDesc;\n        $(descSpan2).html(desc2);\n\n        t2.appendChild(numberDiv2);\n        t2.appendChild(descSpan2);\n        listitemDiv.appendChild(t2);\n\n\n\n        $(\"#divTiles\").append(listitemDiv);\n    }\n\n    $(\".live-tile, .flip-list\").not(\".exclude\").liveTile();\n}\n\nfunction refreshTasks(mode) {\n    sbv.taskLV.clearList();\n    sbv.editLV.clearList();\n\n    if (mode == null) {\n        var radio = $(\".vpatel:checked\").attr(\"id\");\n\n        switch(radio) {\n            case \"radio1\" : mode = \"Two Month\"; break;\n            case \"radio3\" : mode = \"Upcoming\"; break;\n            case \"radio4\" : mode = \"Previous\"; break;\n        }\n    }\n\n    var sortedTasks = sortTasks(mode);\n    var tileTasks = sortTasks(\"Tiles\");\n    var allTasks = getTasks();\n\n    generateTiles(tileTasks);\n\n    for (idx = 0; idx < sortedTasks.length; idx++) {\n        var obj = sortedTasks[idx];\n        var recStatus = \"\";\n        if (obj.recurPattern !== 0) {\n            recStatus = (obj.nonPersistent?\"Recurring | \":\"Recurring Start |\");\n        }\n\n        sbv.taskLV.addListItem(obj.$loki, obj.taskName, \"<span style='color:#464'>\" + moment(obj.taskDate).format('L') + \"</span> (\" + moment(obj.taskDate).diff(moment(), 'days') + \" days) \" + recStatus + obj.taskDesc, true);\n    }\n\n    for (idx = 0; idx < allTasks.length; idx++) {\n        var obj = allTasks[idx];\n\n        sbv.editLV.addListItem(obj.$loki, obj.taskName, \"<span style='color:#464'>\" + moment(obj.taskDate).format('L') + \"</span> (\" + moment(obj.taskDate).diff(moment(), 'days') + \" days) \" + recStatus + obj.taskDesc, true);\n    }\n\n}\n\nfunction addTask() {\n    $(\"#txtTaskText\").text(\"\");\n    $(\"#hfTaskId\").val(\"\");\n    $(\"#divTaskEdit\").show();\n\n    $(\"#txtTaskDate\").val(\"\");\n    $(\"#txtTaskName\").val(\"\");\n    $(\"#txtTaskDescription\").text(\"\");\n    $(\"#chkTaskDone\").prop('checked', false);\n    $(\"#txtRecurInterval\").val(\"\");\n    $(\"#selRecurPattern\").val(0);\n}\n\nfunction editTask() {\n    var taskId = sbv.editLV.listSettings.selectedId;\n\n    var task = sbv.taskList.get(parseInt(taskId));\n\n    $(\"#hfTaskId\").val(taskId);\n    $(\"#txtTaskDate\").val(moment(task.taskDate).format('L'));\n\n    $(\"#txtTaskName\").val(task.taskName);\n    $(\"#txtTaskDescription\").val(task.taskDesc);\n\n    $(\"#chkTaskDone\").prop('checked', task.taskDone);\n    $(\"#txtRecurInterval\").val(task.recurInterval);\n    $(\"#selRecurPattern\").val(task.recurPattern);\n\n    if (task.recurUntil != null) {\n        $(\"#txtRecurUntil\").val(moment(task.recurUntil).format('L'));\n    }\n    else  {\n        $(\"#txtRecurUntil\").val(\"\");\n    }\n\n    $(\"#divTaskEdit\").show();\n\n}\n\nfunction deleteTask() {\n    var key = sbv.editLV.listSettings.selectedId;\n\n    alertify.confirm(\"Are you sure you want to delete this task?\", function (e) {\n        if (e) {\n            sbv.taskList.remove(sbv.taskList.get(key));\n            refreshTasks();\n            dbSave();\n        } \n    });\n}\n\nfunction saveTask() {\n    var key = $(\"#hfTaskId\").val();\n\n    var taskDate = $(\"#txtTaskDate\").val();\n    var taskName = $(\"#txtTaskName\").val();\n    var taskDesc = $(\"#txtTaskDescription\").text();\n    var taskDone = $(\"#chkTaskDone\").is(':checked');\n\n    var recurIntervalText = $(\"#txtRecurInterval\").val();\n    var recurInterval = 0;\n    if (recurIntervalText !== \"\") recurInterval = parseInt(recurIntervalText);\n\n    var recurPatternVal = $(\"#selRecurPattern\").val();\n    var recurPattern = parseInt(recurPatternVal.toString());\n\n    var recurUntilText = $(\"#txtRecurUntil\").val();\n    var recurUntil = null;\n    if (recurUntilText !== \"\") recurUntil = moment(recurUntilText).format('L');\n\n    if (taskDate === \"\") {\n        alertify.error(\"Task Date is required\");\n        return;\n    }\n\n    if (taskName === \"\") {\n        alertify.error(\"Task Name is required\");\n        return;\n    }\n\n    if (key === \"\") {\n        // Unused/Unset properties allocated for future use\n        sbv.taskList.insert({ \n            taskName: taskName, \n            taskDesc: taskDesc, \n            taskDate: moment(taskDate).format('L'),\n            taskDone: taskDone,\n            recurPattern: recurPattern, \n            recurInterval: recurInterval,\n            recurUntil: recurUntil,\n            nonPersistent : false,\n            category: null,\n            color: null,\n            priority: null\n        });\n    }\n    else {\n        var task = sbv.taskList.get(parseInt(key));\n\n        task.taskDate = moment(taskDate).format('L');\n        task.taskName = taskName;\n        task.taskDesc = taskDesc;\n        task.taskDone = taskDone;\n        task.recurPattern = recurPattern;\n        task.recurInterval = recurInterval;\n        task.recurUntil = recurUntil;\n        task.category = null;\n        task.color = null;\n        task.priority = null;\n    }\n\n    refreshTasks();\n\n    $(\"#divTaskEdit\").hide();\n\n    dbSave();\n}\n\n\n\n$(\"#txtRecurUntil\").datepicker({ appendTo: \"#UI_MainPlaceholder\", changeMonth: true, changeYear: true });\n$(\"#txtTaskDate\").datepicker({ changeMonth: true, changeYear: true });\n\ndbInit();"
}
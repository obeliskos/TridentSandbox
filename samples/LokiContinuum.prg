{
  "progName": "LokiContinuum",
  "htmlText": "<style>\n    fieldset.lcfs {\n        color: #fff;\n    }\n    legend.lclg {\n        color: #fff;\n        font-weight: bold;\n    }\n</style>\n\n<ul class=\"tnavlist\">\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(1);\" href=\"javascript:void(0)\"><i class=\"fa fa-bank\"></i> Funds </a></li>\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(2);\" href=\"javascript:void(0)\"><i class=\"fa fa-cogs\"></i> Actors </a></li>\n    <li class=\"tnavli\"><a class=\"tnava\" onclick=\"showDiv(3);\" href=\"javascript:void(0)\"><i class=\"fa fa-info-circle\"></i> About</a></li>\n</ul>\n<br/>\n\n<div id=\"divMain\">\n    <fieldset class=\"lcfs\">\n        <legend class=\"lclg\">\n            Projection Window\n        </legend>\n        <table width='100%'>\n            <tr>\n                <td style=\"width:250px\"><label>Start :</label> <input style=\"width:140px\" id='txt-start'/></td>\n                <td style=\"width:250px\"><label>End :</label> <input style=\"width:140px\" id='txt-end'/></td>\n                <td>\n                    <button class='minimal' onclick='runProjection()' style='width:180px'>Run Projection</button>&nbsp;\n                    <button class='minimal' onclick='resetData()' style='width:200px'>Reset Sample Data</button>\n                </td>\n            </tr>\n        </table>\n    </fieldset>\n\n    <br/>\n\n    <div id='div-main'>\n        <table width=\"100%\">\n            <tr>\n                <td valign=\"top\" style=\"width:650px\">\n                    <fieldset class=\"lcfs\" style=\"background-color:#9a9\">\n                        <legend class=\"lclg\">\n                            Activity Graph\n                        </legend>\n                        <div id=\"activityChart\" style=\"height:300px; width:500px;\"></div>\n                    </fieldset>\n                </td>\n                <td valign=\"top\">\n                    <div id=\"divFunds\">\n                        <fieldset class=\"lcfs\">\n                            <legend class=\"lclg\">\n                                Funds\n                            </legend>\n                            <table>\n                                <tr valign='top'>\n                                    <td width=\"280px\">\n                                        <select id='select-funds' onchange=\"fundSelected()\" size=8 style='width:260px'/>\n                                        <br/>\n                                        <button class='minimal' style=\"width:260px\" onclick='viewVolBals()'>View Volatile Balances</button>\n                                        <br/>\n                                        <button class='minimal' style=\"width:260px\" onclick='viewVolTrans()'>View Volatile Transactions</button>\n                                    </td>\n                                    <td>\n                                        <input type=\"hidden\" id=\"hf-fund-id\"/>\n                                        <fieldset class=\"lcfs\">\n                                            <legend class=\"lclg\">\n                                                Edit Fund Details\n                                            </legend>\n                                            <table>\n                                                <tr>\n                                                    <td>Name :</td>\n                                                    <td><input type='text' id='txt-fund-name'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>FundClass :</td>\n                                                    <td>\n                                                        <select id='select-fund-class'/>\n                                                    </td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Inception Date :</td>\n                                                    <td><input type='text' id='txt-fund-inceptiondate'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Inception Balance :</td>\n                                                    <td><input type='text' id='txt-fund-inceptionbalance'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Hide from graph :</td>\n                                                    <td><input type='checkbox' id='chk-fund-hidden'/></td>\n                                                </tr>\n                                            </table>\n                                        </fieldset>\n                                        <br/>\n                                        <button class=\"minimal\" onclick=\"newFund()\">New</button>\n                                        <button class=\"minimal\" onclick=\"saveFund()\">Save</button>\n                                        <button class=\"minimal\" onclick=\"deleteFund()\">Delete</button>        \n                                    </td>\n                                </tr>\n                            </table>\n                        </fieldset>\n                    </div>\n                    \n                    <div id=\"divActors\" style='display:none'>\n                        <fieldset class=\"lcfs\">\n                            <legend class=\"lclg\">\n                                Actors\n                            </legend>\n                            <table>\n                                <tr valign='top'>\n                                    <td><select id='select-actors' onchange=\"actorSelected()\" size=8 style='width:200px'/></td>\n                                    <td>\n                                        <input type=\"hidden\" id=\"hf-actor-id\"/>\n                                        <fieldset class=\"lcfs\">\n                                            <legend class=\"lclg\">\n                                                Edit Actor Details\n                                            </legend>\n                                            <table>\n                                                <tr>\n                                                    <td>Name :</td>\n                                                    <td><input type='text' id='txt-actor-name'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Amount :</td>\n                                                    <td><input type='text' id='txt-actor-amount'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Fund (Primary) :</td>\n                                                    <td>\n                                                        <select id='select-fund-primary'/>\n                                                    </td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Fund (Secondary) :</td>\n                                                    <td><select id='select-fund-secondary'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Periodicity :</td>\n                                                    <td><select id='select-actor-periodicity'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Periodicity Units :</td>\n                                                    <td><input type='text' id='txt-actor-periodicityunits'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>TriggerDate Initial :</td>\n                                                    <td><input type='text' id='txt-actor-triginitial'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>TriggerDate End :</td>\n                                                    <td><input type='text' id='txt-actor-trigend'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Is Interest Accrual :</td>\n                                                    <td><input type='checkbox' id='chk-actor-accrual' /></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Compound Interest Rate :</td>\n                                                    <td><input type='text' id='txt-actor-cir'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Is Loan Payment :</td>\n                                                    <td><input type='checkbox' id='chk-actor-isloanpmt'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Loan Interest Rate :</td>\n                                                    <td><input type='text' id='txt-actor-loanapr'/></td>\n                                                </tr>\n                                                <tr>\n                                                    <td>Loan Duration in Years :</td>\n                                                    <td><input type='text' id='txt-actor-loandur'/></td>\n                                                </tr>\n                                            </table>\n                                        </fieldset>\n                                        <br/>\n                                        <button class=\"minimal\" onclick=\"newActor()\">New</button>\n                                        <button class=\"minimal\" onclick=\"saveActor()\">Save</button>\n                                        <button class=\"minimal\" onclick=\"deleteActor()\">Delete</button>        \n                                    </td>\n                                </tr>\n                            </table>\n                        </fieldset>\n                    </div>\n                    \n                    <div id=\"divAbout\" style='display:none; padding-left:20px;'>\n                        <h3>Loki Continuum</h3>\n\n                        <h4>\n                            A financial simulation engine modeling funds, actors, transactions.\n                        </h4>\n\n                        <p>\n                            This is a simple, initial port of a <a class=\"TridentLinkSmall\" href=\"https://continuum.codeplex.com/\" target=\"_blank\">c#.net program</a> to test capabilities of lokijs and javascript.  \n                            This example uses autosave/autoload to automatically persist to and from indexedDB... this choice done mainly to test lokijs.  \n                            Ideally you would tweak and experiment and then manually save.  You can however reset back to original \n                            sample data.\n                        </p>\n\n                        <p>\n                            <b><i>Note : </i></b>when rendering far into the future, your checking account will grow abnormally high. \n                            This is because we are not modeling 'waste'/junk spending.  Normally you would dump excess income into savings or \n                            model actual expenditures that use up your free income.  If you recognize and justify this 'waste', you \n                            can set that funds 'hide from graphs' property to leave it off the chart and keep it from increasing the \n                            scale of the chart.  This will make it more likely to clearly see the balances of other funds.\n                        </p>\n\n                        <p>\n                            Due to indexedDB's asynchronous behavior i cannot reliably save during onbeforeunload page events \n                            (generated when a person leaves the web page) so it would be best to wait until autosave \n                            timer has had a chance to save (configured here for about every 5 seconds) before \n                            shutting down the webpage or changing to another webpage in the address bar.\n                        </p>\n\n                        <p>\n                            This example demonstrates using lokijs with object prototype (classes), autosave, autoload, \n                            $or queries, fine grained serialization by overriding Fund.toJSON().  It uses a simplistic \n                            user interface to allow future forked samples based on knockout.js, WinJS, or other Model/View framworks.\n                        </p>\n\n                        <p>\n                            Currently Historical Balances are not implemented, nor are volatile actors used to force \n                            chart/data points for first/last day of projection range as well as 'today' points.\n                        </p>\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n\n",
  "scriptText": "/*\n\tThis is a port of a c#.net program to test capabilities of loki and javascript.  \n\n    It demonstrates using loki with autosave/autoload with a lokiIndexedAdapter.\n    lokiIndexedAdapter uses different datastore than tridentdb but it functions\n    essentially the same (i wrote both).  lokiIndexedAdapter can be used in\n    non-TridentSandbox applications and is included with lokijs distribution.\n\n    I also employ typed collections, and the LokiContinuum engine is encapsulated.\n    Date Manipulation is best stored in unix ms format for serialization.\n    I also have AddDate utility function in case moment.js is not available.\n*/\n\nif (sandbox.volatile.envTest([\"IDE\", \"SBL\"])) {\n    sandbox.ui.setDarkTheme();\n}\n\nvar sbv = {\n    jqplot : null,\n    idbAdapter : new LokiIndexedAdapter('LokiContinuum'),\n    dbg : ''\n};\n\nsandbox.events.clean = function() {\n    continuum.db.close();\n\n    if (sbv.jqplot != null) { sbv.jqplot.destroy(); }\n};\n\nfunction showDiv(divIndex) {\n    $(\"#divFunds\").hide();\n    $(\"#divActors\").hide();\n    $(\"#divAbout\").hide();\n\n    switch(divIndex) {\n        case 1: $(\"#divFunds\").show(); break;\n        case 2: $(\"#divActors\").show(); break;\n        case 3: $(\"#divAbout\").show(); break;\n    }\n}\n\n// LokiContinuum - a financial simulation engine, modeling funds, actors, transactions.\n// We create here a LokiContinuum class which we will use as an interface to the \n// loki continuum 'engine'.\n\nvar LokiContinuum = (function() {\n\n    var singletonContinuum = null;\n\n    // in unix ms time format, this is April 17, 3026 07:15:33 AM\n    var MAX_DATE = 33333333333333;\n    var MIN_DATE = 0;\n\n    var BalanceTypeEnum = Object.freeze({\"HistoricalBalance\":1, \"VolatileBalance\":2, \"VolatileTransaction\":3, \"InceptionBalance\":4 });\n    var FundClassEnum = Object.freeze({\"Spending\":1, \"Debt\":2, \"DebtEquity\":3, \"Savings\":4 });\n    var ActorPeriodicityEnum = Object.freeze({'Daily':1, 'Weekly':2, 'Monthly':3, 'Yearly':4, 'OnceOnly':5 });\n    var ActivityTypeEnum = Object.freeze({'Actor': 1, 'FundReconcile': 2});\n\n    function AddDate(unixDate, offset, offsetType) {\n        var oldDate = new Date();\n        oldDate.setTime(unixDate);\n        var year = parseInt(oldDate.getFullYear(), 10);\n        var month = parseInt(oldDate.getMonth(), 10);\n        var date = parseInt(oldDate.getDate(), 10);\n        var hour = parseInt(oldDate.getHours(), 10);\n        var newDate;\n\n        switch (offsetType) {\n            case \"years\":\n            case \"Y\":\n            case \"y\":\n                newDate = new Date(year + offset, month, date, hour);\n                break;\n            case \"months\":\n            case \"M\":\n            case \"m\":\n                newDate = new Date(year, month + offset, date, hour);\n                break;\n            case \"days\":\n            case \"D\":\n            case \"d\":\n                newDate = new Date(year, month, date + offset, hour);\n                break;\n            case \"weeks\":\n            case \"W\":\n            case \"w\":\n                newDate = new Date(year, month, date + offset*7, hour);\n                break;\n            case \"hours\":\n            case \"H\":\n            case \"h\":\n                newDate = new Date(year, month, date, hour + offset);\n                break;\n        }\n\n        return newDate.getTime();            \n    } \n\n    /**\n *\n * Projector - this class is the top level interface to Continuum,\n *     facilitating access to Actors and Funds and a loki database in which is stores them.\n *\n */\n\n    function Projector(universeName, dbOptions) \n    {\n        singletonContinuum = this;\n\n        this.universeName = universeName;\n\n        this.enums = {\n            BalanceType: BalanceTypeEnum,\n            FundClass: FundClassEnum,\n            ActorPeriodicity: ActorPeriodicityEnum,\n            ActivityType: ActivityTypeEnum\n        };\n\n        this.MAX_DATE = MAX_DATE;\n        this.MIN_DATE = MIN_DATE;\n\n        this.AddDate = AddDate;\n\n        dbOptions.actors = { proto: Actor };\n        dbOptions.funds = { proto: Fund };\n\n        this.db = new loki(this.universeName, dbOptions); \n        this.vol = null;\n        this.activities = this.db.anonym([]);\n    }\n\n    Projector.prototype.initializeDatabase = function()\n    {\n        this.db.removeCollection('actors');\n        this.db.removeCollection('funds');\n        this.db.removeCollection('settings');\n        this.db.addCollection('actors');\n        this.db.addCollection('funds');\n        var pm = this.db.addCollection('settings');\n\n        var settings = {\n            key: 'ProjectorSettings',\n            val: {\n                universeName: 'default',\n                inceptionDate: (new Date()).getTime(),\n                pastWindow: 4, //The number of months in the past to render by default\n                futureWindow: 6 // The number of months in the future to render by default\n            }\n        };\n\n        pm.insert(settings);\n    };\n\n    Projector.prototype.getFundCollection = function()\n    {\n        return this.db.getCollection(\"funds\");\n    };\n\n    Projector.prototype.getActorCollection = function()\n    {\n        return this.db.getCollection(\"actors\");\n    };\n\n    Projector.prototype.addFund = function(options) \n    {\n        var fund = new Fund(options);\n\n        this.db.getCollection(\"funds\").insert(fund);\n\n        return fund;\n    };\n\n    Projector.prototype.addActor = function(options)\n    {\n        var actor = new Actor(options);\n\n        this.db.getCollection(\"actors\").insert(actor);\n\n        return actor;\n    };\n\n    Projector.prototype.activitiesByFund = function(fundId)\n    {\n        var filtered = [];\n        var idx;\n\n        for(idx=0; idx<this.activities.data.length; idx++)\n        {\n            if (this.activities.data[idx].doesAffectFund(fundId)) filtered.push(this.activities.data[idx]);\n        }\n\n        return filtered;\n    };\n\n    Projector.prototype.renderUniverse = function(start, end) {\n        var idx;\n        var actorColl = this.db.getCollection(\"actors\");\n        var actors = actorColl.find();\n        var aa = [];\n\n        this.activities.clear();\n\n        for(idx=0; idx<actors.length; idx++) {\n            if (!actors.isDisabled) {\n                aa = actors[idx].projectActivities(start, end);\n                this.activities.insert(aa);\n            }\n        }\n\n        //foreach (Fund f in Funds)\n        //{\n        //  Activities.AddRange(f.ProjectActivities(StartDate, EndDate));\n        //}\n\n        // Volatile Actors were used for forcing 0 amount transactions\n        // on first day, today, and last day to force plot points for those days\n\n        //foreach (Actor actor in VolatileActors)\n        //{\n        //  Activities.AddRange(actor.ProjectActivities(StartDate, EndDate));\n        //}\n\n        // Sequence activities chronologically\n        var sortedActivities = this.activities.chain().simplesort('activityDate').data();\n        //Activities.Sort(new ActivityComparer());\n\n        // Execute activities to generate volatile transactions and balances\n        for(idx=0; idx<sortedActivities.length; idx++) {\n            sortedActivities[idx].execute();\n        }\n    };\n\n    /**\n * Balance\n */\n\n    // consolidating Balance and Tranction classes\n    // transactions inherited balance and added 'affectingActor' reference\n    function Balance(amount, balanceDate, description, affectingActor) {\n        this.amount = amount;\n        this.balanceDate = balanceDate;\n        this.description = description;\n        this.affectingActor = affectingActor;\n    }\n\n    Balance.prototype.toString = function() {\n        return this.balanceDate + ';' + this.amount + ';' + this.description;\n    };\n\n    /**\n * Fund\n */\n\n    function Fund(options) {\n        options = options || {};\n\n        this.inceptionBalance = options.inceptionBalance || 0.0;\n        this.inceptionDate = options.inceptionDate;\n        this.name = options.name;\n        this.fundClass = options.fundClass;\n        this.isBenchmark = options.isBenchmark || false;\n\n        this.equityOffset = options.equityOffset || 0.0;\n        this.isHidden = options.isHidden || false;\n        this.historicalBalances = options.historicalBalances || [];\n\n        // volatile, not saved\n        this.interimBalance = new Balance(this.inceptionBalance, this.inceptionDate, 'inception', null);\n        this.volatileBalances = [];\n        this.volatileTransactions = [];\n    }\n\n    // can't use serializereplacer as this is nested serialization and replacer\n    // is controlled at top level of serialization (loki db),\n    // which knows nothing of our Fund class structure).\n    Fund.prototype.toJSON = function() \n    {\n        // to avoid serialization of volatileBalances and volatileTransactions,\n        // we will clone our fund and leave those properties empty [] (their default)\n        var clone = new Fund({\n            inceptionBalance: this.inceptionBalance,\n            inceptionDate: this.inceptionDate,\n            name: this.name,\n            fundClass: this.fundClass,\n            isBenchmark: this.isBenchmark,\n            equityOffset : this.equityOffset,\n            isHidden : this.isHidden,\n            historicalBalances : this.historicalBalances\n        });\n\n        // need loki id to be same as well as meta\n        clone.$loki = this.$loki;\n        clone.meta = this.meta;\n\n        return clone;\n    };\n\n    Fund.prototype.projectActivities = function(startDate, endDate) \n    {\n\n    };\n\n    Fund.prototype.postVolatile = function(amount, postDate, name, affectingActor)\n    {\n        // round amount to 2 decimals\n        // amount = decimal.Round(amount, 2);\n        var postAmount = amount;\n        if (this.fundClass == FundClassEnum.Debt || this.fundClass == FundClassEnum.DebtEquity) \n        {\n            postAmount = postAmount * -1;\n        }\n\n        var trans = new Balance(postAmount, postDate, name, affectingActor);\n\n        this.volatileTransactions.push(trans);\n\n        // Make a copy so underlying balance reference isn't affected\n        var bal = new Balance(this.interimBalance.amount + trans.amount, postDate, name, affectingActor);\n        this.interimBalance = bal;\n\n        this.volatileBalances.push(bal);\n\n        return bal;\n    };\n\n    Fund.prototype.resetVolatile = function()\n    {\n        this.volatileBalances = [];\n        this.volatileTransactions = [];\n        this.interimBalance = new Balance(this.inceptionBalance, this.inceptionDate, 'inception', null);\n    };\n\n    /**\n * Actor\n */\n\n    function Actor(options) {\n        options = options || {};\n\n        this.name = options.name;\n        this.fundPrimary = options.fundPrimary;\n        this.fundSecondary = options.fundSecondary; // optional feeder fund\n        this.periodicity = options.periodicity;\n        this.periodicityUnits = options.periodicityUnits;\n        this.triggerDateInitial = options.triggerDateInitial;\n        this.triggerAmount = options.triggerAmount;\n        this.triggerDateEnd = options.triggerDateEnd || MAX_DATE;\n        this.isLoanPayment = options.isLoanPayment || false;\n        this.interestRate = options.interestRate;\n        this.isCompoundInterestAccrual = options.isCompoundInterestAccrual || false;\n        this.compoundInterestRate = options.compoundInterestRate;\n        this.loanDurationYears = options.loanDurationYears;\n        this.isDisabled = options.isDisabled || false;\n\n        // null out?  this was not being serialized\n        this.nextTriggerDate = null;\n    }\n\n    Actor.prototype.synchronize = function(syncDate) {\n        this.nextTriggerDate = this.triggerDateInitial;\n\n        if (this.triggerDateInitial >= syncDate) return;\n\n        while (this.nextTriggerDate <= syncDate) {\n            switch(this.periodicity) {\n                case ActorPeriodicityEnum.Daily : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'days');\n                    break;\n                case ActorPeriodicityEnum.Weekly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'weeks');\n                    break;\n                case ActorPeriodicityEnum.Monthly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'months');\n                    break;\n                case ActorPeriodicityEnum.Yearly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'years');\n                    break;\n                case ActorPeriodicityEnum.OnceOnly : \n                    this.nextTriggerDate = MAX_DATE;\n                    break;\n            }\n\n            // If next trigger occurs after the Actor range ends, \n            // flag actor termination with NextTriggerDate as maxvalue\n            if (this.triggerDateEnd != MAX_DATE && this.triggerDateEnd < this.nextTriggerDate) {\n                this.nextTriggerDate = MAX_DATE;\n            }\n        }\n    };\n\n    Actor.prototype.projectActivities = function(startDate, endDate) {\n        this.synchronize(startDate);\n\n        var activities = [];\n\n        if (this.nextTriggerDate > endDate) return activities;\n\n        while (this.nextTriggerDate <= endDate) {\n            // next trigger fires within projection range, so add\n            activities.push(new Activity(this.nextTriggerDate, ActivityTypeEnum.Actor, null, this));\n\n            // progress nextTriggerDate to next trigger date\n            switch(this.periodicity) \n            {\n                case ActorPeriodicityEnum.Daily: \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'days');\n                    break;\n                case ActorPeriodicityEnum.Weekly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'weeks');\n                    break;\n                case ActorPeriodicityEnum.Monthly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'months');\n                    break;\n                case ActorPeriodicityEnum.Yearly : \n                    this.nextTriggerDate = \n                        AddDate(\n                        this.nextTriggerDate, \n                        this.periodicityUnits, \n                        'years');\n                    break;\n                case ActorPeriodicityEnum.OnceOnly : \n                    this.nextTriggerDate = MAX_DATE;\n                    break;\n                default :\n                    alertify.log('Unknown actor periodicity');\n                    break;\n            }\n\n            // If next trigger occurs after the Trigger Ends, flag actor termination with NextTriggerDate as maxvalue\n            if (this.triggerDateEnd != MAX_DATE && this.triggerDateEnd < this.nextTriggerDate) {\n                this.nextTriggerDate = MAX_DATE;\n            }\n        }\n\n        return activities;\n    };\n\n    Actor.prototype.executeActivity = function(activity)\n    {\n        // Lookup fund object, given its id reference property\n        var fpr = singletonContinuum.db.getCollection(\"funds\").get(this.fundPrimary);\n        var fsr = null;\n\n        if (this.fundSecondary) fsr = singletonContinuum.db.getCollection(\"funds\").get(this.fundSecondary);\n\n        if (fpr.fundClass == FundClassEnum.Debt || fpr.FundClass == FundClassEnum.DebtEquity) \n        {\n            // loan seems paid off, lets just copy existing balances into activity for charting\n            if (fpr.interimBalance.amount <= 0.0) {\n                activity.renderedBalancePrimary = fpr.interimBalance;\n                activity.renderedBalanceSecondary = fsr.interimBalance;\n                return;\n            }\n        }\n\n        // handle loan payment\n        if (this.isLoanPayment) \n        {\n            // Calculate Monthly Payment - using double type for Math.Pow\n            var p = fpr.inceptionBalance;\n            var i = this.interestRate / 1200;\n            var m = this.loanDurationYears * 12;\n            var monthlyPayment = p * (i / (1 - Math.pow( (1 + i), -m) ));\n\n            // If you know the Fund balance on the payment date you can calculate \n            // how much of that is interest... the rest goes to principle\n\n            // Interest Portion = most recent Balance * Annual Interest rate / 12 (assumes monthly payments)\n            // We are expecting InterimBalance to be kept up to date by our \n            //    chronological calls to PostVolatileTransaction\n            var actualInterestRate = this.interestRate / 100;\n            var interestPaid = fpr.interimBalance.amount * actualInterestRate / 12;\n            var principlePaid = monthlyPayment - interestPaid;\n\n            // Monthly Payment calculations dont include overhead of escrow, insurance, etc.\n            // So the monthly payment calculation was only to calculate the principle\n            // We will use Actor TriggerAmount as Monthly Payment\n\n            // Only Posting Portion of Monthly payment added to Principle (Equity)\n            activity.renderedBalancePrimary = fpr.postVolatile(principlePaid, activity.activityDate, this.name + \" (Principle)\", this.$loki);\n\n            // Usually you will need feeder account but benchmark loans might not want to have one\n            if (fsr != null)\n            {\n                // split the pull from feeder fund into principle and interest for later analysis\n                fsr.postVolatile(-(this.triggerAmount - principlePaid), activity.activityDate, this.name + \" (Overhead)\", this.$loki);\n                activity.renderedBalanceSecondary = fsr.postVolatile(-principlePaid, activity.activityDate, this.name + \" (Principle)\", this.$loki);\n            }\n\n            return;\n        }\n\n        // handle interest accrual\n        if (this.isCompoundInterestAccrual)\n        {\n            if (this.periodicity != ActorPeriodicityEnum.Monthly) {\n                API_LogMessage(\"An interest accrual actor \" + this.name + \" is not set to monthly periodicity!\");    \n            }\n            else {\n                var calculatedRate = this.periodicityUnits / 12.0 * this.compoundInterestRate / 100.0;\n                var interestAccrued = fpr.interimBalance.amount * calculatedRate;\n\n                activity.renderedBalancePrimary = fpr.postVolatile(interestAccrued, activity.activityDate, this.name, this.$loki);\n            }\n\n            return;\n        }\n\n        // all other actors post only trigger amounts\n        activity.renderedBalancePrimary = fpr.postVolatile(this.triggerAmount, activity.activityDate, this.name, this.$loki);\n\n        // if feeder fund specifies, remove trigger amount from that\n        if (this.fundSecondary != null) \n        {\n            fsr = singletonContinuum.db.getCollection(\"funds\").get(this.fundSecondary);\n            activity.renderedBalanceSecondary = fsr.postVolatile(this.triggerAmount * -1, activity.activityDate, this.name, this.$loki);\n        }\n    };\n\n    /**\n * Activity\n */\n    function Activity(activityDate, activityType, affectingFund, affectingActor, balancePrimary) {\n        this.activityDate = activityDate;\n        this.activityType = activityType;\n        this.affectingFund = affectingFund;\n        this.affectingActor = affectingActor;\n        this.renderedBalancePrimary = balancePrimary;\n        this.renderedBalanceSecondary = null;\n    }\n\n    Activity.prototype.execute = function()\n    {\n        switch(this.activityType)\n        {\n            case ActivityTypeEnum.Actor: \n                this.affectingActor.executeActivity(this); \n                break;\n            case ActivitiyTypeEnum.FundReconcile: \n                this.affectingFund.executeActivity(this); \n                break;\n            default :\n                throw \"Unknown Activity Type\";\n        }\n    };\n\n    Activity.prototype.doesAffectFund = function(fundId)\n    {\n        if (this.activityType == ActivityTypeEnum.FundReconcile)\n        {\n            if (this.affectingFund == fundId) return true;\n        }\n\n        if (this.activityType == ActivityTypeEnum.Actor)\n        {\n            if (this.affectingActor.fundPrimary == fundId) return true;\n            if (this.affectingActor.fundSecondary == fundId) return true;\n        }\n\n        return false;\n    };\n\n    return Projector;\n}());\n\n// misc helper routines\nfunction addTestData() {\n    // set up funds\n    var fundSavings = continuum.addFund({\n        inceptionBalance: 1000, \n        inceptionDate: (new Date()).getTime(), \n        name: \"savings\", \n        fundClass: continuum.enums.FundClass.Savings, \n        isBenchmark : false\n    });\n    var fundChecking = continuum.addFund({\n        inceptionBalance: 500, \n        inceptionDate: (new Date()).getTime(), \n        name: \"checking\", \n        fundClass: continuum.enums.FundClass.Spending, \n        isBenchmark: false\n    });\n    var fundMortgage = continuum.addFund({\n        inceptionBalance: 100000, \n        inceptionDate: (new Date()).getTime(), \n        name: \"mortgage\", \n        fundClass: continuum.enums.FundClass.DebtEquity, \n        isBenchmark: false\n    });\n    var fundAutoLoan = continuum.addFund({\n        inceptionBalance: 20000, \n        inceptionDate: (new Date()).getTime(), \n        name: \"auto loan\", \n        fundClass: continuum.enums.FundClass.Debt, \n        isBenchmark: false\n    });\n\n    // set up actors\n    var actorSavingsPlan = continuum.addActor({\n        name: 'saving plan', \n        fundPrimary: fundSavings.$loki, \n        periodicity: continuum.enums.ActorPeriodicity.Monthly, \n        periodicityUnits: 1, \n        triggerDateInitial: (new Date()).getTime(), \n        triggerAmount: 250\n    });\n\n    var actorSavingsAccrual = continuum.addActor({\n        name: 'savings accrue',\n        fundPrimary: fundSavings.$loki,\n        periodicity: continuum.enums.ActorPeriodicity.Monthly,\n        periodicityUnits: 1,\n        triggerDateInitial: (new Date()).getTime(),\n        compoundInterestRate: 3,\n        isCompoundInterestAccrual : true\n    });\n\n    var actorPaycheck = continuum.addActor({\n        name: 'paycheck', \n        fundPrimary: fundChecking.$loki, \n        periodicity: continuum.enums.ActorPeriodicity.Weekly, \n        periodicityUnits: 1, \n        triggerDateInitial: (new Date()).getTime(), \n        triggerAmount: 1000\n    });\n\n    var actorMortgagePayment = continuum.addActor({\n        name: 'mortgage payment', \n        fundPrimary: fundMortgage.$loki, // apply payment to\n        fundSecondary: fundChecking.$loki, // feeder fund\n        periodicity: continuum.enums.ActorPeriodicity.Monthly, \n        periodicityUnits: 1, \n        triggerDateInitial: (new Date()).getTime(), \n        triggerAmount: 800,\n        isLoanPayment: true,\n        loanDurationYears: 30,\n        interestRate: 3.0\n    });\n\n    var actorCarPayment = continuum.addActor({\n        name: 'auto loan', \n        fundPrimary: fundAutoLoan.$loki, \n        fundSecondary: fundChecking.$loki, // feeder fund is checking\n        periodicity: continuum.enums.ActorPeriodicity.Monthly, \n        periodicityUnits: 1, \n        triggerDateInitial: (new Date()).getTime(),\n        triggerDateEnd: continuum.AddDate((new Date()).getTime(), 5, \"years\"),\n        triggerAmount: 300,\n        isLoanPayment: true,\n        loanDurationYears: 5,\n        interestRate: 4.0\n    });\n\n}\n\nfunction loadSelects()\n{\n    var fclass;\n    $('#select-fund-class').html(\"<option></option>\");\n\n    for(fclass in continuum.enums.FundClass) {\n        $('#select-fund-class').append($('<option>', {\n            value: continuum.enums.FundClass[fclass],\n            text: fclass\n        }));\n    }\n\n    var ape;\n    $('#select-actor-periodicity').html('<option></option>');\n\n    for(ape in continuum.enums.ActorPeriodicity) {\n        $('#select-actor-periodicity').append($('<option>', {\n            value: continuum.enums.ActorPeriodicity[ape],\n            text: ape\n        }));\n    }\n}\n\nfunction renderLists() {\n    $('#select-funds').empty();\n    $('#select-fund-primary').html(\"<option></option>\");\n    $('#select-fund-secondary').html(\"<option></option>\");\n    $('#select-actors').empty();\n\n    var idx;\n    var funds = continuum.getFundCollection().find();\n\n    for(idx=0; idx< funds.length; idx++) {\n        $('#select-funds').append($('<option>', {\n            value: funds[idx].$loki,\n            text: funds[idx].name\n        }));\n\n        $('#select-fund-primary').append($('<option>', {\n            value: funds[idx].$loki,\n            text: funds[idx].name\n        }));\n\n        $('#select-fund-secondary').append($('<option>', {\n            value: funds[idx].$loki,\n            text: funds[idx].name\n        }));\n    }\n\n    var actors = continuum.getActorCollection().find();\n\n    for(idx=0; idx< actors.length; idx++) {\n        $('#select-actors').append($('<option>', {\n            value: actors[idx].$loki,\n            text: actors[idx].name\n        }));\n    }\n\n    // now that fund and actor lists have been reloaded,\n    // clear the detail screens\n    clearFundDetails();\n    clearActorDetails();\n}\n\nfunction chartActivity(startDate, endDate)\n{\n    var funds = continuum.getFundCollection();\n    var idx, actIdx;\n    var fundRef;\n    var activity = null;\n    var fundActivities;\n    var pointData = null;\n    var fundChartData = [];\n    var allChartData = [];\n    var allSeriesData = [];\n    var seriesStyles = [\n        {\n            // Use a thicker, 5 pixel line and 10 pixel\n            // filled square markers.\n            label:'',\n            lineWidth:5, \n            markerOptions: { style:\"filledSquare\", size:10 }\n        },\n        { \n            // Use (open) circlular markers.\n            label:'',\n            markerOptions: { style:\"circle\" }\n        },\n        {\n            // Change our line width and use a diamond shaped marker.\n            label:'',\n            lineWidth:2, \n            markerOptions: { style:'dimaond' }\n        }\n        /*          ,\n          {\n            // Don't show a line, just show markers.\n            // Make the markers 7 pixels with an 'x' style\n            label:'',\n            showLine:false, \n            markerOptions: { size: 7, style:\"x\" }\n          }\n     */\n    ];\n    var currStyle;\n\n    for (idx=0; idx < funds.data.length; idx++)\n    {\n        fundRef = funds.data[idx];\n\n        if (fundRef.isHidden) continue;\n\n        fundChartData = [];\n\n        fundActivities = continuum.activitiesByFund(fundRef.$loki);\n\n        for(actIdx=0; actIdx < fundActivities.length; actIdx++) {\n            activity = fundActivities[actIdx];\n\n            if (activity.activityDate >= startDate) {\n                pointData = null;\n                if (activity.activityType == continuum.enums.ActivityType.Actor)\n                {\n                    if (activity.affectingActor.fundPrimary == fundRef.$loki)\n                    {\n                        pointData = [\n                            (new Date()).setTime(activity.activityDate),\n                            activity.renderedBalancePrimary.amount\n                        ];\n                    }\n\n                    if (activity.affectingActor.fundSecondary == fundRef.$loki)\n                    {\n                        pointData = [\n                            (new Date()).setTime(activity.activityDate),\n                            activity.renderedBalanceSecondary.amount\n                        ];\n                    }\n                }\n\n                if (activity.activityType == continuum.enums.ActivityType.FundReconcile &&\n                    activity.affectingFund == fundRef.$loki)\n                {\n                    pointData = [\n                        (new Date()).setTime(activity.activityDate),\n                        activity.renderedBalancePrimary\n                    ];\n                }\n\n                if (pointData != null) {\n                    fundChartData.push(pointData);\n                }\n            }\n        }\n\n        allChartData.push(fundChartData);\n\n        //currStyle = JSON.parse(JSON.stringify(seriesStyles[idx%3]));\n        currStyle = JSON.parse(JSON.stringify(seriesStyles[1]));\n        currStyle.label = fundRef.name;\n        allSeriesData.push(currStyle);\n    }\n\n    if (sbv.jqplot != null) { sbv.jqplot.destroy(); }\n\n    sbv.jqplot = $.jqplot ('activityChart', allChartData, {\n        // Give the plot a title.\n        title: 'Activity Graph',\n        axes:{\n            xaxis:{\n                renderer:$.jqplot.DateAxisRenderer,\n                tickOptions:{formatString:'%#m/%#d/%y'}\n            }\n        },\n        legend: {show:true, placement: 'outside'},\n        series:allSeriesData\n    });\n}\n\nfunction clearFundDetails()\n{\n    $(\"#hf-fund-id\").val(\"\");\n    $(\"#txt-fund-name\").val(\"\");\n    $(\"#select-fund-class\").val(\"\");\n    $(\"#txt-fund-inceptionbalance\").val(\"0.0\");\n    $(\"#txt-fund-inceptiondate\").val(\"\");\n    $(\"#chk-fund-hidden\").prop(\"checked\", false);\n}\n\nfunction fundSelected()\n{\n    var selFund = $(\"#select-funds option:selected\").val();\n    var fundId = parseInt(selFund, 10);\n    var fund = continuum.getFundCollection().get(fundId);\n\n    $(\"#hf-fund-id\").val(fund.$loki);\n    $(\"#txt-fund-name\").val(fund.name);\n    $(\"#select-fund-class\").val(fund.fundClass);\n    $(\"#txt-fund-inceptionbalance\").val(fund.inceptionBalance);\n    $(\"#txt-fund-inceptiondate\").val(moment(fund.inceptionDate).format(\"MM/DD/YYYY\"));\n    $(\"#chk-fund-hidden\").prop(\"checked\", fund.isHidden);\n}\n\nfunction clearActorDetails()\n{\n    $(\"#hf-actor-id\").val(\"\");\n    $(\"#txt-actor-name\").val(\"\");\n    $(\"#txt-actor-amount\").val(\"\");\n    $(\"#select-fund-primary\").val(\"\");\n    $(\"#select-fund-secondary\").val(\"\");\n    $(\"#select-actor-periodicity\").val(\"\");\n    $(\"#txt-actor-periodicityunits\").val(\"1\");\n    $(\"#txt-actor-triginitial\").val(\"\");\n    $(\"#txt-actor-trigend\").val(\"\");\n\n    $(\"#chk-actor-accrual\").prop(\"checked\", false);\n    $(\"#txt-actor-cir\").val(\"\");\n    $(\"#chk-actor-isloanpmt\").prop(\"checked\", false);\n    $(\"#txt-actor-loanapr\").val(\"\");\n    $(\"#txt-actor-loandur\").val(\"\");\n}\n\nfunction actorSelected()\n{\n    var selActor = $(\"#select-actors option:selected\").val();\n    var actorId = parseInt(selActor, 10);\n    var actor = continuum.getActorCollection().get(actorId);\n\n    $(\"#hf-actor-id\").val(actor.$loki);\n    $(\"#txt-actor-name\").val(actor.name);\n    $(\"#txt-actor-amount\").val(actor.triggerAmount);\n    $(\"#select-fund-primary\").val(actor.fundPrimary);\n    $(\"#select-fund-secondary\").val(actor.fundSecondary);\n    $(\"#select-actor-periodicity\").val(actor.periodicity);\n    $(\"#txt-actor-periodicityunits\").val(actor.periodicityUnits);\n    $(\"#txt-actor-triginitial\").val(moment(actor.triggerDateInitial).format(\"MM/DD/YYYY\"));\n    $(\"#txt-actor-trigend\").val(moment(actor.triggerDateEnd).format(\"MM/DD/YYYY\"));\n\n    $(\"#chk-actor-accrual\").prop(\"checked\", actor.isCompoundInterestAccrual);\n    $(\"#txt-actor-cir\").val(actor.compoundInterestRate);\n    $(\"#chk-actor-isloanpmt\").prop(\"checked\", actor.isLoanPayment);\n    $(\"#txt-actor-loanapr\").val(actor.interestRate);\n    $(\"#txt-actor-loandur\").val(actor.loanDurationYears);\n}\n\nfunction runProjection() \n{\n    var funds = continuum.getFundCollection();\n\n    funds.find().forEach(function(fund)\n                         {\n        fund.resetVolatile();\n    });\n\n    var startText = $(\"#txt-start\").val();\n    var endText = $(\"#txt-end\").val();\n\n    var start = (new Date(startText)).getTime(); \n    var end = (new Date(endText)).getTime();\n\n    if (end <= start) \n    {\n        end = parseInt(moment(start).add(6, \"months\").format(\"x\"), 10);\n\n        $(\"#txt-end\").val(moment(end).format(\"MM/DD/YYYY\"));\n    }\n\n    renderLists();\n\n    continuum.renderUniverse(continuum.MIN_DATE, end);\n    chartActivity(start, end);\n}\n\nfunction viewVolBals()\n{\n    var selFund = $(\"#select-funds option:selected\").val();\n\n    if (selFund == null) {\n        alertify.error(\"select a fund first\");\n        return;\n    }\n\n    var fundId = parseInt(selFund, 10);\n    var fund = continuum.getFundCollection().get(fundId);\n\n    sandbox.logger.inspect(fund.volatileBalances);\n}\n\nfunction viewVolTrans()\n{\n    var selFund = $(\"#select-funds option:selected\").val();\n\n    if (selFund == null) {\n        alertify.error(\"select a fund first\");\n        return;\n    }\n\n    var fundId = parseInt(selFund, 10);\n    var fund = continuum.getFundCollection().get(fundId);\n\n    sandbox.logger.inspect(fund.volatileTransactions);\n}\n\nfunction newFund()\n{\n    clearFundDetails();\n}\n\nfunction saveFund()\n{\n    var selFund, fundId, fund, hfFundId;\n\n    hfFundId = $(\"#hf-fund-id\").val();\n    if (hfFundId === \"\") {\n        var newFundOptions = {\n            name: $(\"#txt-fund-name\").val(),\n            fundClass : parseInt($(\"#select-fund-class\").val(), 10),\n            inceptionBalance: parseFloat($(\"#txt-fund-inceptionbalance\").val()),\n            inceptionDate: parseInt(\n                moment( $(\"#txt-fund-inceptiondate\").val() ).format(\"x\"),\n                10\n            ),\n            isHidden : $(\"#chk-fund-hidden\").is(\":checked\")\n        };\n\n        fund = continuum.addFund(newFundOptions);\n\n        runProjection();\n\n        return;\n    }\n\n    selFund = $(\"#select-funds option:selected\").val();\n    fundId = parseInt(selFund, 10);\n    fund = continuum.getFundCollection().get(fundId);\n\n    fund.name = $(\"#txt-fund-name\").val();\n    fund.fundClass = parseInt($(\"#select-fund-class\").val(), 10);\n    fund.inceptionBalance = parseFloat($(\"#txt-fund-inceptionbalance\").val());\n    fund.inceptionDate = parseInt(\n        moment( $(\"#txt-fund-inceptiondate\").val() ).format(\"x\"),\n        10\n    );\n    fund.isHidden = $(\"#chk-fund-hidden\").is(\":checked\");\n\n    continuum.getFundCollection().update(fund);\n\n    runProjection();\n}\n\nfunction deleteFund()\n{\n    var selFund = $(\"#select-funds option:selected\").val();\n    selFund = selFund || \"\";\n\n    if (selFund === \"\") {\n        alertify.log(\"select a fund\");\n        return;\n    }\n\n    var fundId = parseInt(selFund, 10);\n    var fund = continuum.getFundCollection().get(fundId);\n\n    var actors = continuum.getActorCollection().find({'$or': [\n        { 'fundPrimary' : fund.$loki },\n        { 'fundSecondary' : fund.$loki }\n    ]});\n\n    // don't delete fund unless there are no actors using it\n    if (actors.length > 0) {\n        alertify.error(\"delete all actors associated with this fund first\");\n        return;\n    }\n\n    continuum.getFundCollection().remove(fund);\n\n    runProjection();\n}\n\nfunction newActor()\n{\n    clearActorDetails();\n}\n\nfunction saveActor()\n{\n    var selActor, actorId, actor, hfActorId;\n\n    var trigAmount = $(\"#txt-actor-amount\").val();\n    trigAmount = (trigAmount===\"\") ? 0 : parseInt(trigAmount, 10);\n    var fp = $(\"#select-fund-primary\").val();\n    fp = (fp === \"\") ? null : parseInt(fp, 10);\n    var fs = $(\"#select-fund-secondary\").val();\n    fs = (fs === \"\") ? null : parseInt(fs, 10);\n    var ap = $(\"#select-actor-periodicity\").val();\n    ap = (ap === \"\") ? null : parseInt(ap, 10);\n    var apUnits = $(\"#txt-actor-periodicityunits\").val();\n    apUnits = (apUnits === \"\") ? 0 : parseInt(apUnits, 10);\n    var tdi = $(\"#txt-actor-triginitial\").val();\n    tdi = (tdi === \"\") ? MIN_DATE : parseInt(moment(tdi).format(\"x\"), 10);\n    var tde = $(\"#txt-actor-trigend\").val();\n    tde = (tde === \"\") ? MIN_DATE : parseInt(moment(tde).format(\"x\"), 10);\n    var cir = $(\"#txt-actor-cir\").val();\n    cir = (cir === \"\") ? null : parseFloat(cir);\n    var lir = $(\"#txt-actor-loanapr\").val();\n    lir = (lir === \"\") ? null : parseFloat(lir);\n    var ldur = $(\"#txt-actor-loandur\").val();\n    ldur = (ldur === \"\") ? 0 : parseInt(ldur, 10);\n\n    hfActorId = $(\"#hf-actor-id\").val();\n    if (hfActorId === \"\") {\n        var newActorOptions = {\n            name: $(\"#txt-actor-name\").val(),\n            triggerAmount: trigAmount,\n            fundPrimary: fp,\n            fundSecondary: fs,\n            periodicity: ap,\n            periodicityUnits: apUnits,\n            triggerDateInitial: tdi,\n            triggerDateEnd: tde,\n            isCompoundInterestAccrual: $(\"#chk-actor-accrual\").is(\":checked\"),\n            compoundInterestRate: cir,\n            isLoanPayment: $(\"#chk-actor-isloanpmt\").is(\":checked\"),\n            interestRate: lir,\n            loanDurationYears: ldur\n        };\n\n        actor = continuum.addActor(newActorOptions);\n\n        runProjection();\n\n        return;\n    }\n\n    selActor = $(\"#select-actors option:selected\").val();\n    actorId = parseInt(selActor, 10);\n    actor = continuum.getActorCollection().get(actorId);\n\n    actor.name = $(\"#txt-actor-name\").val();\n    actor.triggerAmount = trigAmount;\n    actor.fundPrimary = fp;\n    actor.fundSecondary = fs;\n    actor.periodicity = ap;\n    actor.periodicityUnits = apUnits;\n    actor.triggerDateInitial = tdi;\n    actor.triggerDateEnd = tde;\n    actor.isCompoundInterestAccrual = $(\"#chk-actor-accrual\").is(\":checked\");\n    actor.compoundInterestRate = cir;\n    actor.isLoanPayment = $(\"#chk-actor-isloanpmt\").is(\":checked\");\n    actor.interestRate = lir;\n    actor.loanDurationYears = ldur;\n\n    continuum.getActorCollection().update(actor);\n\n    runProjection();\n}\n\nfunction deleteActor()\n{\n    var selActor = $(\"#select-actors option:selected\").val();\n    selActor = selActor || \"\";\n\n    if (selActor === \"\") {\n        alertify.log(\"select an actor\");\n        return;\n    }\n\n    var actorId = parseInt(selActor, 10);\n    var actor = continuum.getActorCollection().get(actorId);\n\n    continuum.getActorCollection().remove(actor);\n\n    runProjection();\n}\n\nfunction resetData() \n{\n    alertify.confirm(\"This will revert the data to original sample, are you sure?\", function (e) {\n        if (e) {\n            continuum.initializeDatabase();\n            addTestData();\n            runProjection();\n        } \n    });\n}\n\n$(\"#txt-start\").datepicker({ changeMonth: true, changeYear: true });\n$(\"#txt-end\").datepicker({ changeMonth: true, changeYear: true });\n$(\"#txt-fund-inceptiondate\").datepicker({ changeMonth: true, changeYear: true });\n$(\"#txt-actor-triginitial\").datepicker({ changeMonth: true, changeYear: true });\n$(\"#txt-actor-trigend\").datepicker({ changeMonth: true, changeYear: true });\n\n$(\"#txt-start\").val(moment().add(-2, \"months\").format(\"MM/DD/YYYY\"));\n$(\"#txt-end\").val(moment().add(5, \"months\").format(\"MM/DD/YYYY\"));\n\nfunction dbLoaderCallback()\n{\n    if (continuum.db.collections.length === 0) {\n        continuum.initializeDatabase();\n        addTestData();\n    }\n\n    runProjection();\n}\n\ncontinuum = new LokiContinuum(\"ContinuumDB\", {\n    autoload: true,\n    autoloadCallback : dbLoaderCallback,\n    autosave: true, \n    autosaveInterval: 4000,\n    adapter: sbv.idbAdapter\n});\n\nloadSelects();\n\n\n\n\n"
}